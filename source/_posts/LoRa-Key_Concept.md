---
title: 【译】LoRa 中的关键概念
date: 2020-05-25 11:20:00
tags:
- 中文
- 翻译
- LoRaWAN
- LoRa
- IoT
categories:
- LoRa
---

原文链接：https://docs.exploratory.engineering/lora/lora_key_concepts/

# LoRaWAN 关键概念

LoRaWAN 设备的配置可能会令人困惑。您需要跟踪两个关键点，EUI 和必须的各种各样奇怪的配置参数。


# 设备 EUI，网络 EUI，应用 EUI 和 DevAddr

在 LoRaWAN 中，网络，应用程序和设备由 EUI64 标识符标识。EUI64是全球唯一的标识符。您可以在此处了解更多信息：[https://standards.ieee.org/develop/regauth/tut/eui64.pdf](https://standards.ieee.org/develop/regauth/tut/eui64.pdf)。EUI 用于在后端服务器内部标识 LoRaWAN 所有的（虚拟）部分。

DevAddr 值是特定网络中设备的唯一标识符。它由 NwkID 和 NetAddr 的两个不同部分组成，这是一个32位无符号整数，用于标识你的设备，是设备加入网络后用于标识设备的标识符。


# 网络和应用程序会话密钥

LoRaWAN 中的加密相对简单。如果您使用ABP（“个性化激活”设备；具有预配置密钥的设备），则可能需要担心两个密钥：

- 网络会话密钥是网络和设备已知的每个设备的唯一密钥，该密钥用于不携带任何有效负载的内部管理消息。该密钥用于向发送到设备的消息添加校验和。
- 应用程序会话密钥是应用程序和设备已知的每个设备的唯一密钥，用于加密来自设备的有效负载的密钥，使得任何人都很难窃听与后端服务器的通信。该密钥也用于计算校验和。


# ABP 与 OTAA 设备

LoRaWAN 网络中有两种设备，即“ABP”设备和“ OTAA”设备：

## ABP（个性化激活）设备

这种设备带有三项信息：`网络会话密钥`，`应用程序会话密钥`和`设备地址`。

这些设备通电后可以立即开始发送，但是每个设备都需要一组唯一的密钥。如果有人闯入您的设备并拿到了密钥，你可以轻松地仅对受影响的一台设备进行布建，而无需更改其他的设备。

这种设备类型的最大缺点是，您必须跟踪加电之间往返于后端服务器的消息的帧计数器。通常，后端服务器会忽略帧计数器与预期的计数器不同的消息，但是您可以在测试设备时取消此检查。注意：关闭此检查会使设备容易受到重放攻击，因此通常保留用于测试。

## OTAA（空中激活）设备

这是最常见的设备类型。在配置它们时，这些设备中的每一个都将获得三部分信息：`应用程序密钥`，`应用程序EUI`和`设备EUI`。打开设备电源后，它将启动加入网络过程，在此过程中它将根据现有的应用程序密钥协商一组新的密钥。协商完成后（通常在不到五秒钟的时间内），其行为将类似于 ABP 设备。

如果关闭设备电源，则启动时它必须再次加入网络。自然，对 OTAA 设备来说最重要的是应用程序密钥。如果有人设法从您的一台设备上抢走密钥，则攻击者可能会假冒您网络中的任何设备。另一方面，使用OTAA设备可以轻松管理大量设备，因为您无需管理很多密钥。

## 选择

您选择哪种设备类型取决于您计划如何配置新设备。开启时，无论您的设备是否在网关范围内，ABP 设备都可以立即开始发送。另一方面，如果您的设备大多位于网关的范围内，并且会在没有任何板载存储的情况下频繁上下电，则可以使用 OTAA 设备。开发新设备时，OTAA设备最为方便。


# 什么是“私人网络”？

如果您看到配置文件中某处提到的“专用网络”，就像其他许多人一样——你可能想知道它的真正含义，因为它是您设置的参数，但是没有再次看到。

LoRaWAN 中的专用网络是一种设备（和网关）网络，它接受带有专用前导码（作为消息的第一位发送的标识符）而不是标准的前导码的消息。LoRaWAN 中只有两种类型的前导码：标准的 LoRaWAN 公共前导或私有前导。

如果发送了私有前导码，则数据格式完全取决于设备和后端服务器。如果要与其他网络兼容（并且兼容），需要保持私有网络标志为关闭状态。

# ADR 自适应数据速率

ADR（自适应数据速率）是后端服务器可用来让设备以尽可能低的功率传输的技巧。如果设备靠近网关，则设备可以以较低的功率和较高的数据速率进行传输，使用尽可能少的功率。如果两个或三个网关可以接收到设备的消息，则可以调回传输功率并节省能源。

# 消息类型：确认的和不确认的消息

LoRaWAN 定义了两种消息-确认的和不确认的。确认的消息需要后端服务器的确认，如果没有收到确认，则消息将以不同的扩展因子和带宽重新发送。

同样，后端服务器将重新传输确认的消息，直到设备确认响应。

由于 LoRaWAN 仅使用了一个确认标志，因此无法确认旧消息。

# 上下游消息

迟早有人会提到“上游”和“下游”。如果您在设备上工作，则无法完全直观地了解是哪个方向，但是请记住上游方向朝着网关天线去的方向，下游方向是从网关天线出发的方向。但如果将设备放在气象气球中，则会这个规则不再适用。

# 我让我的设备发送消息时，它没有发送！

如果您在设备上安排一条消息，有时您会感到该消息会在设备上保留很长一段时间，直到发送出去为止，其他情况下，消息会立即发送出去。

这是因为 LoRaWAN 设备必须始终遵守的 ISM 频段上的占空比限制（即发送和不发送所花费的时间的比率）。对于某些频率，最大占空比为1％，而对于其他频率，最大占空比仅为0.1％。如果您花费一秒钟发送一条消息，则必须等待99秒，然后才能在占空比为1％时发送另一条消息，而如果占空比为0.1％，则可能必须等待15分钟以上。
