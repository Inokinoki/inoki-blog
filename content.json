{"meta":{"title":"Inoki in the world","subtitle":null,"description":null,"author":"Inoki","url":"https://blog.inoki.cc","root":"/"},"pages":[{"title":"About me å…³äº","date":"2025-03-08T09:40:48.611Z","updated":"2025-03-08T09:40:48.611Z","comments":true,"path":"about/index.html","permalink":"https://blog.inoki.cc/about/index.html","excerpt":"","text":"To be continuedâ€¦"},{"title":"all-archives","date":"2025-03-08T09:40:48.611Z","updated":"2025-03-08T09:40:48.611Z","comments":false,"path":"all-archives/index.html","permalink":"https://blog.inoki.cc/all-archives/index.html","excerpt":"","text":""},{"title":"all-categories","date":"2025-03-08T09:40:48.611Z","updated":"2025-03-08T09:40:48.611Z","comments":false,"path":"all-categories/index.html","permalink":"https://blog.inoki.cc/all-categories/index.html","excerpt":"","text":""},{"title":"Springer Free Books","date":"2025-03-08T09:40:48.612Z","updated":"2025-03-08T09:40:48.612Z","comments":true,"path":"book/Springer-free-books.html","permalink":"https://blog.inoki.cc/book/Springer-free-books.html","excerpt":"","text":"From Reddit: Fundamentals of Power Electronics http://link.springer.com/openurl?genre=book&amp;isbn=978-0-306-48048-5 Handbook of the Life Course http://link.springer.com/openurl?genre=book&amp;isbn=978-0-306-48247-2 All of Statistics http://link.springer.com/openurl?genre=book&amp;isbn=978-0-387-21736-9 Social Anxiety and Social Phobia in Youth http://link.springer.com/openurl?genre=book&amp;isbn=978-0-387-22592-0 Discrete Mathematics http://link.springer.com/openurl?genre=book&amp;isbn=978-0-387-21777-2 Developmental Neurobiology http://link.springer.com/openurl?genre=book&amp;isbn=978-0-387-28117-9 Intuitive Probability and Random Processes using MATLABÂ® http://link.springer.com/openurl?genre=book&amp;isbn=978-0-387-24158-6 Handbook of Disaster Research http://link.springer.com/openurl?genre=book&amp;isbn=978-0-387-32353-4 Handbook of the Sociology of Gender http://link.springer.com/openurl?genre=book&amp;isbn=978-0-387-36218-2 Handbook of Sociological Theory http://link.springer.com/openurl?genre=book&amp;isbn=978-0-387-36274-8 Clinical Neuroanatomy http://link.springer.com/openurl?genre=book&amp;isbn=978-0-387-36601-2 Acquired Brain Injury http://link.springer.com/openurl?genre=book&amp;isbn=978-0-387-37575-5 Numerical Optimization http://link.springer.com/openurl?genre=book&amp;isbn=978-0-387-40065-5 Handbook of Biological Confocal Microscopy http://link.springer.com/openurl?genre=book&amp;isbn=978-0-387-45524-2 Ceramic Materials http://link.springer.com/openurl?genre=book&amp;isbn=978-0-387-46271-4 Principles of Fluorescence Spectroscopy http://link.springer.com/openurl?genre=book&amp;isbn=978-0-387-46312-4 Fundamentals of Biomechanics http://link.springer.com/openurl?genre=book&amp;isbn=978-0-387-49312-1 Primer on the Rheumatic Diseases http://link.springer.com/openurl?genre=book&amp;isbn=978-0-387-68566-3 International Handbook of Historical Archaeology http://link.springer.com/openurl?genre=book&amp;isbn=978-0-387-72071-5 Database Marketing http://link.springer.com/openurl?genre=book&amp;isbn=978-0-387-72579-6 Composite Materials http://link.springer.com/openurl?genre=book&amp;isbn=978-0-387-74365-3 Time Series Analysis http://link.springer.com/openurl?genre=book&amp;isbn=978-0-387-75959-3 Transmission Electron Microscopy http://link.springer.com/openurl?genre=book&amp;isbn=978-0-387-76501-3 Handbook of Quantitative Criminology http://link.springer.com/openurl?genre=book&amp;isbn=978-0-387-77650-7 Plant Physiological Ecology http://link.springer.com/openurl?genre=book&amp;isbn=978-0-387-78341-3 Introductory Statistics with R http://link.springer.com/openurl?genre=book&amp;isbn=978-0-387-79054-1 The Elements of Statistical Learning http://link.springer.com/openurl?genre=book&amp;isbn=978-0-387-84858-7 Psychology, Religion, and Spirituality http://link.springer.com/openurl?genre=book&amp;isbn=978-0-387-87573-6 Introductory Time Series with R http://link.springer.com/openurl?genre=book&amp;isbn=978-0-387-88698-5 Child Neuropsychology http://link.springer.com/openurl?genre=book&amp;isbn=978-0-387-88963-4 A Beginnerâ€™s Guide to R http://link.springer.com/openurl?genre=book&amp;isbn=978-0-387-93837-0 Geomorphology of Desert Environments http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4020-5719-9 The Joy of Science http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4020-6099-1 Fatigue of Structures and Materials http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4020-6808-9 Essential Astrophysics http://link.springer.com/openurl?genre=book&amp;isbn=978-3-642-35963-7 Introduction to Evolutionary Computing http://link.springer.com/openurl?genre=book&amp;isbn=978-3-662-44874-8 Data Analysis http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-03762-2 International Perspectives on Psychotherapy http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-56194-3 Electrical Machines http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4614-0400-2 Mechanics and Thermodynamics http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-27877-3 Applied Behavior Analysis http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-44794-0 Reading, Writing, and Proving http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4419-9479-0 Linear and Nonlinear Programming http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-18842-3 Introduction to Partial Differential Equations http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-48936-0 Energy Storage http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-21239-5 Metabolism of Human Diseases http://link.springer.com/openurl?genre=book&amp;isbn=978-3-7091-0715-7 Sensory Evaluation of Food http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4419-6488-5 Fundamentals of Robotic Mechanical Systems http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-01851-5 Integrative Human Biochemistry http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4939-3058-6 Philosophy of Science for Scientists http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-26551-3 Particles and Nuclei http://link.springer.com/openurl?genre=book&amp;isbn=978-3-662-46321-5 Data Structures and Algorithms with Python http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-13072-9 LGBT-Parent Families http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4614-4556-2 Integrated Neuroscience http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4615-1077-2 Introduction to Partial Differential Equations http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-02099-0 Microeconomics http://link.springer.com/openurl?genre=book&amp;isbn=978-3-642-37434-0 System Dynamics http://link.springer.com/openurl?genre=book&amp;isbn=978-981-10-2045-2 Cosmology for the Curious http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-57040-2 Methods of Mathematical Modelling http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-23042-9 Introduction to Logic Circuits &amp; Logic Design with Verilog http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-53883-9 Structural Analysis http://link.springer.com/openurl?genre=book&amp;isbn=978-90-481-2516-6 Engineering Flow and Heat Exchange http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4899-7454-9 Enterprise Risk Management Models http://link.springer.com/openurl?genre=book&amp;isbn=978-3-662-53785-5 Reactive Power Control in AC Power Systems http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-51118-4 Principles of Microeconomics http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-57589-6 Additive Manufacturing Technologies http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4419-1120-9 Principles of Physics http://link.springer.com/openurl?genre=book&amp;isbn=978-3-642-23026-4 Fundamentals of Biomechanics http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-44738-4 Irrigation and Drainage Engineering http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-05699-9 LaTeX in 24 Hours http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-47831-9 Psychology of Perception http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-31791-5 Extragalactic Astronomy and Cosmology http://link.springer.com/openurl?genre=book&amp;isbn=978-3-642-54083-7 Automata and Computability http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4612-1844-9 The Algorithm Design Manual http://link.springer.com/openurl?genre=book&amp;isbn=978-1-84800-070-4 Chemical Thermodynamics http://link.springer.com/openurl?genre=book&amp;isbn=978-3-642-19864-9 Computational Physics http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-61088-7 Introduction to Statistics and Data Analysis http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-46162-5 Grammar for Teachers http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-33916-0 Time Series Econometrics http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-32862-1 Electrochemistry http://link.springer.com/openurl?genre=book&amp;isbn=978-3-642-30250-3 Classical Fourier Analysis http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4939-1194-3 Human Chromosomes http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4613-0139-4 Phylogenomics http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-54064-1 Quantum Theory for Mathematicians http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4614-7116-5 Evidence-Based Critical Care http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-43341-7 Clinical Assessment of Child and Adolescent Personality and Behavior http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4419-0641-0 Design Research in Information Systems http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4419-5653-8 Intermediate Physics for Medicine and Biology http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-12682-1 Principles of Data Mining http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4471-7307-6 Fundamental Astronomy http://link.springer.com/openurl?genre=book&amp;isbn=978-3-662-53045-0 Fundamentals of Business Process Management http://link.springer.com/openurl?genre=book&amp;isbn=978-3-642-33143-5 Brownian Motion, Martingales, and Stochastic Calculus http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-31089-3 UML @ Classroom http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-12742-2 Design and Analysis of Experiments http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-52250-0 Foundations for Designing User-Centered Systems http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4471-5134-0 Handbook of Consumer Finance Research http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-28887-1 Principles of Terrestrial Ecosystem Ecology http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4419-9504-9 Applied Multivariate Statistical Analysis http://link.springer.com/openurl?genre=book&amp;isbn=978-3-662-45171-7 Strategic International Management http://link.springer.com/openurl?genre=book&amp;isbn=978-3-8349-6331-4 Computer Vision http://link.springer.com/openurl?genre=book&amp;isbn=978-1-84882-935-0 Engineering Electromagnetics http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-07806-9 Data Mining http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-14142-8 International Trade Theory and Policy http://link.springer.com/openurl?genre=book&amp;isbn=978-3-642-37314-5 Alternative Energy Sources http://link.springer.com/openurl?genre=book&amp;isbn=978-3-642-20951-2 Introduction to Electronic Commerce and Social Commerce http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-50091-1 Computational Geometry http://link.springer.com/openurl?genre=book&amp;isbn=978-3-540-77974-2 Elementary Mechanics Using Python http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-19596-4 Energy Economics http://link.springer.com/openurl?genre=book&amp;isbn=978-3-662-53022-1 Biomedical Informatics http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4471-4474-8 Robotics, Vision and Control http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-54413-7 Acid-Base Diagrams http://link.springer.com/openurl?genre=book&amp;isbn=978-3-642-37902-4 Brewing Science: A Multidisciplinary Approach http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-46394-0 Learning Landscape Ecology http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4939-6374-4 Probability http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4612-4374-8 Modeling Life http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-59731-7 Introduction to Plasma Physics and Controlled Fusion http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-22309-4 Engineering Mechanics 1 http://link.springer.com/openurl?genre=book&amp;isbn=978-3-642-30319-7 Principles of Polymer Chemistry http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4614-2212-9 A Primer on Scientific Programming with Python http://link.springer.com/openurl?genre=book&amp;isbn=978-3-662-49887-3 Climate Change Science: A Modern Synthesis http://link.springer.com/openurl?genre=book&amp;isbn=978-94-007-5757-8 Solar PV and Wind Energy Conversion Systems http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-14941-7 Statistical Analysis and Data Display http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4939-2122-5 Business Process Management Cases http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-58307-5 Elementary Analysis http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4614-6271-2 Cryptography Made Simple http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-21936-3 Fluid Dynamics http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-09351-2 Social Media Management http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-21990-5 Statistics in Criminal Justice http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4614-9170-5 Supply Chain Management and Advanced Planning http://link.springer.com/openurl?genre=book&amp;isbn=978-3-642-55309-7 Probability Theory http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4471-5201-9 Statistics and Data Analysis for Financial Engineering http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4939-2614-5 Readings in Formal Epistemology http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-20451-2 Differential Equations and Their Applications http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4612-4360-1 Nanotechnology: Principles and Practices http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-09171-6 Epidemiological Research: Terms and Concepts http://link.springer.com/openurl?genre=book&amp;isbn=978-94-007-1171-6 Multinational Management http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-23012-2 Partial Differential Equations http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4614-4809-9 Bayesian and Frequentist Regression Methods http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4419-0925-1 Strategic International Management http://link.springer.com/openurl?genre=book&amp;isbn=978-3-658-07884-3 Basic Concepts in Computational Physics http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-27265-8 Eye Tracking Methodology http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-57883-5 Writing for Publication http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-31650-5 Mathematical Physics http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-01195-0 Correctional Counseling and Treatment http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-54349-9 Thermodynamics and Energy Conversion http://link.springer.com/openurl?genre=book&amp;isbn=978-3-662-43715-5 The Action Research Planner http://link.springer.com/openurl?genre=book&amp;isbn=978-981-4560-67-2 Stochastic Processes and Calculus http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-23428-1 Statistical Analysis of Clinical Data on a Pocket Calculator http://link.springer.com/openurl?genre=book&amp;isbn=978-94-007-1211-9 Clinical Data Analysis on a Pocket Calculator http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-27104-0 The Data Science Design Manual http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-55444-0 An Introduction to Machine Learning http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-63913-0 Guide to Discrete Mathematics http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-44561-8 Petroleum Geoscience http://link.springer.com/openurl?genre=book&amp;isbn=978-3-642-34132-8 Structure Determination by X-ray Crystallography http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4614-3954-7 Introduction to Time Series and Forecasting http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-29854-2 Principles of Mobile Communication http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-55615-4 Cardiovascular Biomechanics http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-46407-7 Introduction to Smooth Manifolds http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4419-9982-5 Taxation in European Union http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-53919-5 Essentials of Cerebellum and Cerebellar Disorders http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-24551-5 Language Across the Curriculum &amp; CLIL in English as an Additional Language (EAL) Contexts http://link.springer.com/openurl?genre=book&amp;isbn=978-981-10-1802-2 Multivariate Calculus and Geometry http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4471-6419-7 Statistics and Analysis of Scientific Data http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4939-6572-4 Modelling Computing Systems http://link.springer.com/openurl?genre=book&amp;isbn=978-1-84800-322-4 Search Methodologies http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4614-6940-7 Representation Theory http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4612-0979-9 Linear Algebra Done Right http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-11080-6 Stellar Structure and Evolution http://link.springer.com/openurl?genre=book&amp;isbn=978-3-642-30304-3 Evolutionary Thinking in Medicine http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-29716-3 Understanding Cryptography http://link.springer.com/openurl?genre=book&amp;isbn=978-3-642-04101-3 Linear Algebra http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-24346-7 Algebra http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4613-0041-0 Understanding Analysis http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4939-2712-8 Plate Tectonics http://link.springer.com/openurl?genre=book&amp;isbn=978-3-540-76504-2 Linear Programming http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4614-7630-6 The Nature of Scientific Knowledge http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-33405-9 Leadership Today http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-31036-7 Physics of Semiconductor Devices http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4939-1151-6 Corporate Social Responsibility http://link.springer.com/openurl?genre=book&amp;isbn=978-3-642-40975-2 Ordinary Differential Equations http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4614-3618-8 Electronic Commerce http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-10091-3 Ceramic Materials http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4614-3523-5 Foundations of Analytical Chemistry http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-62872-1 Life Cycle Assessment http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-56475-3 A Clinical Guide to the Treatment of the Human Stress Response http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4614-5538-7 Computational Physics http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-00401-3 Handbook of LGBT Elders http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-03623-6 Handbook of Cardiac Anatomy, Physiology, and Devices http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-19464-6 Quantum Mechanics http://link.springer.com/openurl?genre=book&amp;isbn=978-3-642-20556-9 Understanding Statistics Using R http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4614-6227-9 Mass Spectrometry http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-54398-7 Statistical Mechanics for Engineers http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-15018-5 The Gastrointestinal System http://link.springer.com/openurl?genre=book&amp;isbn=978-94-017-8771-0 Additive Manufacturing Technologies http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4939-2113-3 Magnetic Interactions in Molecules and Solids http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-22951-5 Electricity and Magnetism http://link.springer.com/openurl?genre=book&amp;isbn=978-4-431-54526-2 Survival Analysis http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4419-6646-9 Foundations of Quantum Mechanics http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-65867-4 An Introduction to Statistical Learning http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4614-7138-7 Introduction to MathematicaÂ® for Physicists http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-00894-3 Statistical Learning from a Regression Perspective http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-44048-4 Applied Partial Differential Equations http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-12493-3 Principles of Astrophysics http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4614-9236-8 Air Pollution and Greenhouse Gases http://link.springer.com/openurl?genre=book&amp;isbn=978-981-287-212-8 Polymer Synthesis: Theory and Practice http://link.springer.com/openurl?genre=book&amp;isbn=978-3-642-28980-4 Sustainable Supply Chains http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-29791-0 Robotics http://link.springer.com/openurl?genre=book&amp;isbn=978-1-84628-642-1 Econometrics http://link.springer.com/openurl?genre=book&amp;isbn=978-3-642-20059-5 The Sea Floor http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-51412-3 SPSS for Starters and 2nd Levelers http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-20600-4 Regression Modeling Strategies http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-19425-7 Legal Dynamics of EU External Relations http://link.springer.com/openurl?genre=book&amp;isbn=978-3-662-54817-2 Food Analysis Laboratory Manual http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-44127-6 Principles of Musical Acoustics http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4614-6786-1 Fundamentals of Structural Engineering http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-24331-3 Basics of Laser Physics http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-50651-7 Applied Quantitative Finance http://link.springer.com/openurl?genre=book&amp;isbn=978-3-662-54486-0 Handbook of Marriage and the Family http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4614-3987-5 Solid-State Physics http://link.springer.com/openurl?genre=book&amp;isbn=978-3-540-93804-0 Electrochemical Impedance Spectroscopy and its Applications http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4614-8933-7 Economics as Applied Ethics http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-50319-6 Electronics for Embedded Systems http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-39439-8 Concise Guide to Software Engineering http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-57750-0 Fundamentals of Multimedia http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-05290-8 Logistics http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-01769-3 Group Theory Applied to Chemistry http://link.springer.com/openurl?genre=book&amp;isbn=978-94-007-6863-5 The Psychology of Social Status http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4939-0867-7 A Modern Introduction to Probability and Statistics http://link.springer.com/openurl?genre=book&amp;isbn=978-1-84628-168-6 Complex Analysis http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4419-7288-0 Food Chemistry http://link.springer.com/openurl?genre=book&amp;isbn=978-3-540-69934-7 Exam Survival Guide: Physical Chemistry http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-49810-2 The Python Workbook http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-14240-1 Practical Electrical Engineering http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-21173-2 Strategic Retail Management http://link.springer.com/openurl?genre=book&amp;isbn=978-3-658-10183-1 Food Analysis http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-45776-5 Psychoeducational Assessment and Report Writing http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4939-1911-6 Machine Learning in Medicine - a Complete Overview http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-15195-3 Evidence-Based Interventions for Children with Challenging Behavior http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4614-7807-2 Principles of Quantum Mechanics http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4757-0576-8 Recommender Systems http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-29659-3 Pharmaceutical Biotechnology http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4614-6486-0 Python Programming Fundamentals http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4471-6642-9 The Finite Element Method and Applications in Engineering Using ANSYSÂ® http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4899-7550-8 Group Theory http://link.springer.com/openurl?genre=book&amp;isbn=978-3-540-32899-5 Object-Oriented Analysis, Design and Implementation http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-24280-4 Introduction to Embedded Systems http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4614-3143-5 Elementary Mechanics Using Matlab http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-19587-2 An Introduction to Biomechanics http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4939-2623-7 New Introduction to Multiple Time Series Analysis http://link.springer.com/openurl?genre=book&amp;isbn=978-3-540-27752-1 Introduction to Data Science http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-50017-1 Calculus With Applications http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4614-7946-8 An Introduction to Soil Mechanics http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-61185-3 Game Theory http://link.springer.com/openurl?genre=book&amp;isbn=978-3-662-46950-7 Fundamentals of Clinical Trials http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-18539-2 The Finite Volume Method in Computational Fluid Dynamics http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-16874-6 The ASCRS Textbook of Colon and Rectal Surgery http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-25970-3 Applied Predictive Modeling http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4614-6849-3 Introduction to Logic Circuits &amp; Logic Design with VHDL http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-34195-8 Sustainability Science http://link.springer.com/openurl?genre=book&amp;isbn=978-94-017-7242-6 Physical Chemistry from a Different Angle http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-15666-8 The Physics of Semiconductors http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-23880-7 Energy Harvesting and Energy Efficiency http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-49875-1 Python For ArcGIS http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-18398-5 Statics and Mechanics of Structures http://link.springer.com/openurl?genre=book&amp;isbn=978-94-007-6113-1 Real Analysis http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4939-2766-1 MATLAB for Psychologists http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4614-2197-9 Physical Asset Management http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-14777-2 Essentials of Food Science http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4614-9138-5 Quantum Mechanics http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4612-1272-0 Probability Theory http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4471-5361-0 Concise Guide to Databases http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4471-5601-7 Digital Image Processing http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4471-6684-9 Chemical and Bioprocess Engineering http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4614-9126-2 Transmission Electron Microscopy http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4757-2519-3 Guide to Computer Network Security http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-55606-2 Introduction to Law http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-57252-9 Advanced Quantum Mechanics http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-25675-7 Bayesian Essentials with R http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4614-8687-9 Robotics, Vision and Control http://link.springer.com/openurl?genre=book&amp;isbn=978-3-642-20144-8 Applied Chemistry http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4614-4262-2 Advanced Organic Chemistry http://link.springer.com/openurl?genre=book&amp;isbn=978-0-387-44899-2 Advanced Organic Chemistry http://link.springer.com/openurl?genre=book&amp;isbn=978-0-387-71481-3 International Humanitarian Action http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-14454-2 Breast Cancer http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-48848-6 Travel Marketing, Tourism Economics and the Airline Product http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-49849-2 Electronic Commerce 2018 http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-58715-8 Disability and Vocational Rehabilitation in Rural Settings http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-64786-9 Teaching Medicine and Medical Ethics Using Popular Culture http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-65451-5 Market Research http://link.springer.com/openurl?genre=book&amp;isbn=978-981-10-5218-7 Scanning Electron Microscopy and X-Ray Microanalysis http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4939-6676-9 ArcGIS for Environmental and Water Issues http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-61158-7 Physics from Symmetry http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-66631-0 Communication and Bioethics at the End of Life http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-70920-8 Foundations of Programming Languages http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-70790-7 Problems in Classical Electromagnetism http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-63133-2 Polymer Chemistry http://link.springer.com/openurl?genre=book&amp;isbn=978-3-662-49279-6 Probability and Statistics for Computer Science http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-64410-3 Empathetic Space on Screen http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-66772-0 Political Social Work http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-68588-5 Introductory Quantum Mechanics http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-68598-4 Guide to Competitive Programming http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-72547-5 Introduction to Artificial Intelligence http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-58487-4 Bioinformatics for Evolutionary Biologists http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-67395-0 Concepts, Methods and Practical Applications in Applied Demography http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-65439-3 Introduction to Deep Learning http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-73004-2 Energy and the Wealth of Nations http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-66219-0 A Beginnerâ€™s Guide to Scala, Object Orientation and Functional Programming http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-75771-1 Lessons on Synthetic Bioarchitectures http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-73123-0 Managing Sustainable Business http://link.springer.com/openurl?genre=book&amp;isbn=978-94-024-1144-7 Engineering Mechanics 2 http://link.springer.com/openurl?genre=book&amp;isbn=978-3-662-56272-7 Fundamentals of Business Process Management http://link.springer.com/openurl?genre=book&amp;isbn=978-3-662-56509-4 Clinical Methods in Medical Family Therapy http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-68834-3 Guide to Scientific Computing in C++ http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-73132-2 Motivation and Action http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-65094-4 Perspectives on Elderly Crime and Victimization http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-72682-3 Knowledge Management http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-59978-6 An Introduction to Zooarchaeology http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-65682-3 Abstract Algebra http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-77649-1 Criminal Justice and Mental Health http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-76442-9 Philosophy of Race http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-78729-9 Of Cigarettes, High Heels, and Other Interesting Things http://link.springer.com/openurl?genre=book&amp;isbn=978-1-349-95348-6 Applied Bioinformatics http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-68301-0 Linear Algebra and Analytic Geometry for Physical Sciences http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-78361-1 Building Energy Modeling with OpenStudio http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-77809-9 Customer Relationship Management http://link.springer.com/openurl?genre=book&amp;isbn=978-3-662-55381-7 The A-Z of the PhD Trajectory http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-77425-1 Strategic Human Resource Management and Employment Relations http://link.springer.com/openurl?genre=book&amp;isbn=978-981-13-0399-9 Applied Linear Algebra http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-91041-3 Witnessing Torture http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-74965-5 Proofs from THE BOOK http://link.springer.com/openurl?genre=book&amp;isbn=978-3-662-57265-8 Introduction to General Relativity http://link.springer.com/openurl?genre=book&amp;isbn=978-981-13-1090-4 Introduction to Particle and Astroparticle Physics http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-78181-5 Fundamentals of Java Programming http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-89491-1 Optimization of Process Flowsheets through Metaheuristic Techniques http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-91722-1 Robotics http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-72911-4 Business Ethics - A Philosophical and Behavioral Approach http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-91575-3 A First Introduction to Quantum Physics http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-92207-2 Argumentation Theory: A Pragma-Dialectical Perspective http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-95381-6 Logical Foundations of Cyber-Physical Systems http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-63588-0 Off-Grid Electrical Systems in Developing Countries http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-91890-7 Entertainment Science http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-89292-4 Physics of Oscillations and Waves http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-72314-3 Introduction to Programming with Fortran http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-75502-1 Fundamentals of Solid State Engineering http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-75708-7 Introduction to Digital Systems Design http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-92804-3 Neural Networks and Deep Learning http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-94463-0 Data Science and Predictive Analytics http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-72347-1 Systems Programming in Unix/Linux http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-92429-8 Analytical Corporate Finance http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-95762-3 Fraud and Corruption http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-92333-8 Conferencing and Presentation English for Young Academics http://link.springer.com/openurl?genre=book&amp;isbn=978-981-13-2475-8 A Concise Guide to Market Research http://link.springer.com/openurl?genre=book&amp;isbn=978-3-662-56707-4 Global Supply Chain and Operations Management http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-94313-8 Introduction to Parallel Computing http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-98833-7 Mathematical Logic http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-97298-5 Stability and Control of Linear Systems http://link.springer.com/openurl?genre=book&amp;isbn=978-3-030-02405-5 Introduction to Formal Philosophy http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-77434-3 Analysis for Computer Scientists http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-91155-7 International Business Management http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-96622-9 Research Methods for the Digital Humanities http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-96713-4 Introductory Computer Forensics http://link.springer.com/openurl?genre=book&amp;isbn=978-3-030-00581-8 Control Engineering http://link.springer.com/openurl?genre=book&amp;isbn=978-981-10-8297-9 Control Engineering: MATLAB Exercises http://link.springer.com/openurl?genre=book&amp;isbn=978-981-10-8321-1 ENZYMES: Catalysis, Kinetics and Mechanisms http://link.springer.com/openurl?genre=book&amp;isbn=978-981-13-0785-0 Automatic Control with Experiments http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-75804-6 Internet of Things From Hype to Reality http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-99516-8 Quantitative Methods for the Social Sciences http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-99118-4 A Pythagorean Introduction to Number Theory http://link.springer.com/openurl?genre=book&amp;isbn=978-3-030-02604-2 Philosophical and Mathematical Logic http://link.springer.com/openurl?genre=book&amp;isbn=978-3-030-03255-5 Structural Dynamics http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-94743-3 Plant Physiology, Development and Metabolism http://link.springer.com/openurl?genre=book&amp;isbn=978-981-13-2023-1 Quantum Mechanics for Pedestrians 1 http://link.springer.com/openurl?genre=book&amp;isbn=978-3-030-00464-4 Plant Anatomy http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-77315-5 Quantum Mechanics for Pedestrians 2 http://link.springer.com/openurl?genre=book&amp;isbn=978-3-030-00467-5 Excel Data Analysis http://link.springer.com/openurl?genre=book&amp;isbn=978-3-030-01279-3 Quick Start Guide to VHDL http://link.springer.com/openurl?genre=book&amp;isbn=978-3-030-04516-6 Java in Two Semesters http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-99420-8 Managing Media and Digital Organizations http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-71288-8 Media and Digital Management http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-72000-5 An Anthology of London in Literature, 1558-1914 http://link.springer.com/openurl?genre=book&amp;isbn=978-3-030-05609-4 Astronautics http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-74373-8 Perceptual Organization http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-96337-2 Research Methods for Social Justice and Equity in Education http://link.springer.com/openurl?genre=book&amp;isbn=978-3-030-05900-2 Educational Technology http://link.springer.com/openurl?genre=book&amp;isbn=978-981-13-6643-7 Quick Start Guide to Verilog http://link.springer.com/openurl?genre=book&amp;isbn=978-3-030-10552-5 Spine Surgery http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-98875-7 Introduction to Logic Circuits &amp; Logic Design with VHDL http://link.springer.com/openurl?genre=book&amp;isbn=978-3-030-12489-2 Social Justice Theory and Practice for Social Work http://link.springer.com/openurl?genre=book&amp;isbn=978-981-13-3621-8 School Leadership and Educational Change in Singapore http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-74746-0 Digital Business Models http://link.springer.com/openurl?genre=book&amp;isbn=978-3-030-13005-3 Introduction to Logic Circuits &amp; Logic Design with Verilog http://link.springer.com/openurl?genre=book&amp;isbn=978-3-030-13605-5 Pharmaceutical Biotechnology http://link.springer.com/openurl?genre=book&amp;isbn=978-3-030-00710-2 Mapping Global Theatre Histories http://link.springer.com/openurl?genre=book&amp;isbn=978-3-030-12727-5 Social Marketing in Action http://link.springer.com/openurl?genre=book&amp;isbn=978-3-030-13020-6 Analyzing Qualitative Data with MAXQDA http://link.springer.com/openurl?genre=book&amp;isbn=978-3-030-15671-8 Handbook of Evolutionary Research in Archaeology http://link.springer.com/openurl?genre=book&amp;isbn=978-3-030-11117-5 Evidence-Based Practice in Clinical Social Work http://link.springer.com/openurl?genre=book&amp;isbn=978-3-030-15224-6 Foundations of Behavioral Health http://link.springer.com/openurl?genre=book&amp;isbn=978-3-030-18435-3 Social Psychology in Action http://link.springer.com/openurl?genre=book&amp;isbn=978-3-030-13788-5 Essentials of Business Analytics http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-68837-4 A Course in Rasch Measurement Theory http://link.springer.com/openurl?genre=book&amp;isbn=978-981-13-7496-8 Multimedia Big Data Computing for IoT Applications http://link.springer.com/openurl?genre=book&amp;isbn=978-981-13-8759-3 Policing and Minority Communities http://link.springer.com/openurl?genre=book&amp;isbn=978-3-030-19182-5 A Beginners Guide to Python 3 Programming http://link.springer.com/openurl?genre=book&amp;isbn=978-3-030-20290-3 Advanced Guide to Python 3 Programming http://link.springer.com/openurl?genre=book&amp;isbn=978-3-030-25943-3 Food Fraud Prevention http://link.springer.com/openurl?genre=book&amp;isbn=978-1-4939-9621-6 Plant Ecology http://link.springer.com/openurl?genre=book&amp;isbn=978-3-662-56233-8 Mathematical Physics http://link.springer.com/openurl?genre=book&amp;isbn=978-3-319-01195-0"},{"title":"all-tags","date":"2025-03-08T09:40:48.612Z","updated":"2025-03-08T09:40:48.612Z","comments":false,"path":"all-tags/index.html","permalink":"https://blog.inoki.cc/all-tags/index.html","excerpt":"","text":""},{"title":"Book list ä¹¦å•","date":"2025-03-08T09:40:48.612Z","updated":"2025-03-08T09:40:48.612Z","comments":true,"path":"book/index.html","permalink":"https://blog.inoki.cc/book/index.html","excerpt":"","text":"Compiler ç¼–è¯‘å™¨ ã€ŠCompilers: Principales, Techniques and Toolsã€‹ Algorithm ç®—æ³• ã€ŠIntroduction to Algorithmsã€‹ ã€ŠMastering Algorithms with Cã€‹ Computer Graphics è®¡ç®—æœºå›¾å½¢å­¦ ã€ŠComputer Graphics with OpenGLã€‹ Mobile Applications ç§»åŠ¨åº”ç”¨ Programming Languages ç¼–ç¨‹è¯­è¨€ ã€ŠC++ Primerã€‹ ã€ŠLearn Objective-C on the Macã€‹ Applications åº”ç”¨ ã€ŠFFmpeg Beginnerâ€™s handbookã€‹ ã€ŠC++ GUI Programming with Qtã€‹ Linux ã€ŠLinux Device Driverã€‹ ã€ŠA Heavy Commented Linux Kernel Source Codeã€‹ Cybersecutiry ç½‘ç»œå®‰å…¨ ã€ŠGray Hat Python: Python Programming for Hackers and Reverse Engineersã€‹ Web ç½‘é¡µæŠ€æœ¯ ã€ŠWebKit æŠ€æœ¯å†…å¹•ã€‹ Other books about Computer Science å…¶ä»– ã€ŠCode: The Hidden Language of Computer Hardware and Softwareã€‹ ã€ŠThe Art of Unix Programmingã€‹ ã€ŠUnix Network Programmingã€‹"},{"title":"å‹æƒ…é“¾æ¥","date":"2025-03-08T09:40:48.612Z","updated":"2025-03-08T09:40:48.612Z","comments":true,"path":"links/index.html","permalink":"https://blog.inoki.cc/links/index.html","excerpt":"","text":""},{"title":"ä¹¦å•","date":"2025-03-08T09:40:48.612Z","updated":"2025-03-08T09:40:48.612Z","comments":false,"path":"books/index.html","permalink":"https://blog.inoki.cc/books/index.html","excerpt":"","text":""},{"title":"Links å‹æƒ…é“¾æ¥","date":"2025-03-08T09:40:48.612Z","updated":"2025-03-08T09:40:48.612Z","comments":true,"path":"links-backup/index.html","permalink":"https://blog.inoki.cc/links-backup/index.html","excerpt":"","text":"Here are some links, there may be interesting for you ğŸ˜ƒ Claude - å°‘å¹´å¿ƒäº‹ç•¶æ‹é›²ï¼Œèª°å¿µå¹½å¯’åå—šå‘ƒã€‚ Darkflames - æ˜¯æ¼†é»‘çƒˆç„°ï¼Œä¹Ÿæ˜¯ Developer / ä¸šä½™æ‘„å½± / èƒ¶ç‰‡çˆ±å¥½è€…ã€‚ Edward Elric - æ˜¯ Eå“¥ å¤§å¼ºå¼ºã€‚ Dmcimiâ€™s blog &amp; Lovelyâ€™s blog - å¤©ä¸‹é£äº‘å‡ºæˆ‘è¾ˆï¼Œä¸€å…¥æ±Ÿæ¹–å²æœˆå‚¬"}],"posts":[{"title":"å¼¹æŒ‡åå¹´é—´","slug":"My-10-years","date":"2024-06-08T17:19:00.000Z","updated":"2025-03-08T09:40:48.585Z","comments":true,"path":"2024/06/08/My-10-years/","link":"","permalink":"https://blog.inoki.cc/2024/06/08/My-10-years/","excerpt":"","text":"åˆæ˜¯ä¸€å¹´é«˜è€ƒå­£ï¼Œå±äºæˆ‘çš„é‚£ä¸ªå¹´ä»£è½¬çœ¼å°±è¿‡å»äº†åå¹´ã€‚ é‚£å¹´å¤å¤©ï¼Œå¾…ä¸€åˆ‡å°˜åŸƒè½å®šæ—¶ï¼Œåˆšå¥½æ˜¯å°æ—¶å€™æœ€å–œæ¬¢çš„åŠ¨æ¼«ã€Šæ•°ç å®è´ã€‹åäº”å‘¨å¹´ï¼Œæˆ‘é•¿å¤§äº†ï¼Œå¤ªä¸€ä»–ä»¬ä¹Ÿåœ¨åäº”å‘¨å¹´çš„çºªå¿µå‰§åœºç‰ˆé•¿å¤§äº†ã€‚å’Œç”°å…‰å¸åœ¨é‚£ä¸€å¹´çš„å‘¨å¹´åº†å…¸ä¸Šåˆå”±èµ·äº†è¿™é¦–æ­Œï¼Œå¬å¾—å‡ºä»–å› é¼»å’½ç™Œå¯¼è‡´çš„åŠ›ä¸ä»å¿ƒã€‚ å€Ÿç€é‚£æ ·çš„å¥‘æœºï¼Œæˆ‘è¿½å¿†äº†è‡ªå·±çš„é‚£åå¤šå¹´ã€‚ å¦‚ä»Šåˆè¿‡å»äº†åå¹´æ•´ï¼Œå·²ç»æ­¥å…¥ã€Šæ•°ç å®è´ã€‹ç¬¬ä¸€ä»£çš„ç¬¬äºŒåäº”ä¸ªå¹´å¤´ï¼Œå†å»æŸ¥çœ‹å’Œç”°å…‰å¸çš„ç»´åŸºç™¾ç§‘ï¼Œå°±ä¼šå‘ç°æ—©å·²ç‰¹æ„æ³¨æ˜äº†â€œå·²æ•…â€ï¼Œäº«å¹´å››åäºŒå²ã€‚æ˜¯å•Šï¼Œäººç”Ÿè‹¦çŸ­ã€å¦‚æµ®èé£˜å¿½ä¸å®šï¼Œé‡å¼±æ°´è€Œç»ˆã€‚ è€Œæˆ‘åœ¨è¿™æœŸé—´ä¸ºä¸–ç•Œç•™ä¸‹äº†ä»€ä¹ˆï¼Œæœ‰æ²¡æœ‰æ´»æˆè‡ªå·±æƒ³è¦çš„æ¨¡æ ·ï¼Ÿ æ— é™å¤§çš„æ¢¦ï¼ˆç„¡é™å¤§ãªå¤¢ï¼‰ åœ¨è¯»åˆä¸­æ—¶ï¼Œå› ä¸ºçœ‹ã€Šæ¢ç´¢å‘ç°ã€‹èŠ‚ç›®é‡Œä¸€ä¸ªè·å…°æ°”è±¡å­¦å®¶ç”¨è®¡ç®—æœºåšå¤©æ°”ä»¿çœŸçš„ä¸€ä¸ªå¥‘æœºï¼Œæˆ‘æ„è¯†åˆ°äº†è®¡ç®—æœºç¨‹åºè®¾è®¡åœ¨æœªæ¥ä¼šæ˜¯ä»»ä½•ä¸“ä¸šéƒ½ä¸å¯æˆ–ç¼ºçš„èƒ½åŠ›ï¼Œå› æ­¤å®šä¸‹äº†å¤§å­¦å‰è¦åˆæ­¥å…·å¤‡å†™ç¨‹åºçš„èƒ½åŠ›ã€‚è€Œè‡³äºé«˜è€ƒåçš„ä¸“ä¸šå’Œå°±ä¸šé€‰æ‹©ï¼Œåˆ™æ˜¯å»ï¼šè¯»ä¸€ä¸ªå¾®ç”µå­å’Œé›†æˆç”µè·¯è®¾è®¡ä¸“ä¸šï¼Œç„¶åå»æ—¥ä¼/éŸ©ä¼å°±ä¸šï¼Œæ¯•ä¸šçš„è–ªé…¬ç›®æ ‡æ˜¯â€”â€”â€”â€”ä¸€åƒä¸‡æ—¥å…ƒå¹´æ”¶ï¼ äºæ˜¯åœ¨é«˜äºŒå·¦å³ï¼Œæˆ‘æ”¾å¼ƒäº†æ‰€è°“çš„å¥¥æ—åŒ¹å…‹ç«èµ›çš„æœºä¼šï¼Œæ‹¿è°­æµ©å¼ºçš„ã€ŠC è¯­è¨€ç¨‹åºè®¾è®¡ã€‹å­¦ä¹ äº† C è¯­è¨€çš„åŸºç¡€ï¼Œå¹¶å…·æœ‰äº†ä¸€å®šçš„å†™ç®—æ³•çš„èƒ½åŠ›ã€‚é‰´äºè‡ªå·±æ˜¯ç»“åˆå¯¹è®¡ç®—æœºä½“ç³»æ¶æ„åŸºæœ¬çš„è®¤è¯†å­¦ä¹ çš„ï¼Œé‚£äº›å¥‡æ·«å·§è®¡å¹¶æ²¡æœ‰å½±å“åˆ°æˆ‘ï¼Œç›¸åï¼Œè¿™æœ¬ä¹¦åè€Œå¯¹æˆ‘çš„ C è¯­è¨€èƒ½åŠ›æå‡éå¸¸å¤§ï¼ˆè¿˜æ˜¯èƒ½å¤Ÿâ€œå–å…¶ç²¾åã€å¼ƒå…¶ç³Ÿç²•â€æ›´é‡è¦å•Šï¼‰ã€‚ç„¶å ActionScriptï¼ˆå› ä¸ºåš Flashï¼‰å’Œ Javaï¼ˆä¸ºäº†å­¦ä¸€é—¨é¢å‘å¯¹è±¡çš„ç¨‹åºè¯­è¨€ï¼Œä½† C++ çš„ä¹¦å¤ªåšäº†ï¼Œä¸é€‚åˆé«˜ä¸­ç”Ÿé—²æš‡æ—¶é—´è‡ªå­¦ï¼‰ä¹Ÿå¾ˆè‡ªç„¶åœ°å…¥é—¨äº†ã€‚å¹¶ä¸”å› ä¸ºå½“æ—¶ Android/iOS å¼€å‘æ­£ç«ï¼Œè¿˜æ‹¿ Java è°ƒç”¨åŸºç¡€çš„ API å†™äº†è‡ªå·±çš„ç¬¬ä¸€ä¸ª Android ç¨‹åºã€‚åŒæ—¶è¿˜å¼€å§‹å­¦ä¹ æ—¥è¯­ï¼Œä¸ºäº†è‡ªå·±çš„æ¢¦æƒ³åšå‡†å¤‡ã€‚ åœ¨é«˜ä¸‰é‚£ä¸ªå¤å¤©ï¼Œé«˜è€ƒå•ç§‘å¤§å¹…å¤±åˆ©å¯¼è‡´è‡ªå·±ä¸æ¢¦æ ¡å—è¾•åŒ—è¾™ã€‚è™½ç„¶ç­ä¸»ä»»æ„¿æ„ç ´ä¾‹è®©æˆ‘å¤è¯»ï¼Œä½†æ˜¯æˆ‘çŸ¥é“é«˜è€ƒæœ¬èº«çš„å¹¶ä¸æ˜¯å®Œå…¨å®šç»ˆèº«çš„æ„ä¹‰ï¼šé«˜ä¸­å­¦ä¹ çš„çŸ¥è¯†åªæ˜¯ä¸ºäº†åº”è¯•ã€ä¸ºäº†æ‹¿åˆ°ä¸€ä¸ªèƒ½å¤Ÿå»å¤§å­¦å­¦ä¹ çš„å…¥åœºåˆ¸ï¼Œå®ƒæœ¬èº«çš„å†…å®¹å…¶å®éå¸¸æµ…æ˜¾æ˜“æ‡‚ã€‚ä¸ºäº†å»æ¢¦æ ¡å’Œæ¢¦æƒ³çš„ä¸“ä¸šï¼Œå†æµªè´¹è‡ªå·±ä¸€å¹´çš„å…‰é˜´ä¸æ–­åœ°é‡å¤å’Œç»ƒä¹ ï¼Œè¿™å¹¶ä¸åˆé€‚ã€‚ è€Œä¸”æ˜¾è€Œæ˜“è§çš„ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œè¿™æ ·èƒ½å»çš„å­¦æ ¡çš„æ•™å­¦ã€å­¦æœ¯æ°´å¹³è¿˜æœ‰èµ„æºéƒ½ä¸ä¼šå¤šå¥½ï¼Œæˆ‘å¯¹å…¶ä¸­çš„å¾®ç”µå­å’Œé›†æˆç”µè·¯è®¾è®¡ä¸“ä¸šä¸æŠ¥ä»»ä½•ä¿¡å¿ƒã€‚å‡ ç•ªå–èˆåï¼Œæˆ‘é‡æ–°è§„åˆ’äº†è·¯çº¿ï¼šé‚£å°±å…ˆå»è¿™ä¸ªå­¦æ ¡ç›¸å¯¹è¾ƒå¥½çš„é€šä¿¡ä¸“ä¸šï¼Œå¹¶ä¸”ä¸€æ­¥æ­¥è½¬å‘è®¡ç®—æœºç¡¬ä»¶æ–¹å‘ï¼Œå¦‚æœæœ‰æœºä¼šå‡ºå›½è¯»ç ”æ·±é€ ã€å°±æ¯«ä¸çŠ¹è±«ï¼Œä»¥æ­¤æ¥å¼¥è¡¥å­¦æ ¡æ°´å¹³çš„å·®è·ã€‚ äºæ˜¯æ¯«æ— æ‚¬å¿µåœ°è¢«å½•å–ï¼ŒæŒ‰éƒ¨å°±ç­åœ°å¼€å§‹ä¸“ä¸šçš„å­¦ä¹ ï¼Œå› ä¸ºå­¦æ ¡æ°´å¹³é™åˆ¶ã€è¯¾ç¨‹æœ¬èº«éš¾åº¦éƒ½ä¸é«˜ï¼Œè€Œå­¦æ ¡çš„æ”¿ç­–ä¹Ÿæ¯”è¾ƒå¥½ï¼Œæ¯”å¦‚è¯¾å¯ä»¥ä¸å»ï¼Œé€‰æ‹©ç›´æ¥ä½¿ç”¨æœŸæœ«è€ƒè¯•æˆç»©ä½œä¸ºæœ€ç»ˆæˆç»©ã€‚äºæ˜¯ä¸€ç›´ä»¥æ¥æˆç»©éƒ½ä¸é”™ï¼Œä¿æŒåœ¨é™¢å†…å‰ 5%ï¼Œæ¯å¹´å¥–å­¦é‡‘åŸºæœ¬å¯ä»¥è¦†ç›–åŸºç¡€çš„å­¦è´¹ï¼Œæœ‰äº›è¯¾ç¨‹æœ¬èº«ä¹Ÿè›®æœ‰æ„æ€ï¼Œç‰¹åˆ«æ˜¯è®¡ç®—æœºç½‘ç»œé€šä¿¡æ­£æˆ³ä¸­æˆ‘çš„å¿ƒã€‚åŒæ—¶ï¼Œæˆ‘èƒ½å¤Ÿæ‹¥æœ‰æ›´å¤šé—²æš‡æ—¶é—´ã€æ¥å­¦ä¹ è‡ªå·±æƒ³å­¦çš„åˆ«çš„ä¸œè¥¿ï¼šå¤§ä¸€å°±å¼€å§‹åœ¨ ARM æ ‘è“æ´¾ä¸Šè·‘ golang å’Œ Dockerï¼ŒæŠ˜è…¾ Linux é©±åŠ¨ï¼Œå†™å†™ Web å’Œ Vanilla JavaScriptã€‚åæ¥ï¼Œå­¦æ ¡æä¾›äº†æœºä¼šå‡ºå›½äº¤æ¢ï¼Œå¹¶å¯ä»¥ç›´æ¥å…‘æ¢äº¤æ¢å­¦æ ¡çš„ç¡•å£«å­¦åˆ†ï¼Œäºæ˜¯é ç€æˆç»©ä¸é”™è¿™ä¸€ç‚¹å°±å¾ˆè½»æ¾åœ°ç”³è¯·åˆ°äº†æ¬§æ´²ã€‚ åœ¨ç¡•å£«è¯¾ç¨‹æœŸé—´ï¼Œè¯¾ç¨‹çš„æ°´å¹³å’Œéš¾åº¦ç¡®å®ä¸ä¸€æ ·ï¼Œæˆ‘é€‰æ‹©äº†è®¡ç®—æœºé‡Œé¢çš„åµŒå…¥å¼ä¸“ä¸šæ¥ä½œä¸ºç¡•å£«ä¸“ä¸šï¼Œå› æ­¤æœ‰æœºä¼šæ¥è§¦åˆ° ROSï¼ˆæœºå™¨äººæ“ä½œç³»ç»Ÿçš„è‡ªåŠ¨é©¾é©¶ï¼‰ã€è™šæ‹Ÿç°å®è®¾å¤‡ã€ARM æ±‡ç¼–åµŒå…¥å¼ç­‰ï¼Œå¹¶ä¸”å’Œå½“æ—¶åœ¨è¯»çš„åšå£«ç”Ÿä¸€èµ·å·¥ä½œï¼Œæˆ‘è´Ÿè´£ç§‘å­¦è®¡ç®—æ¨¡æ‹Ÿç¨‹åºçš„è®¾è®¡ï¼Œå‘äº†ä»–ä»¬é¢†åŸŸé¡¶åˆŠçš„è®ºæ–‡ã€‚åŒæ—¶å› ä¸ºèƒŒæ™¯åˆé€‚ï¼ŒæˆåŠŸè¿›å…¥äº†æ¬§æ´²æŸå®¶äº”ç™¾å¼ºåšæ–°èƒ½æºæ±½è½¦ç›¸å…³çš„å®ä¹ ã€‚ åœ¨å¼€å§‹å®ä¹ ä¹‹å‰ï¼Œå¯¹äºå¼€æºçš„çƒ­æƒ…å’Œè¿˜ç®—æˆç†Ÿçš„æŠ€æœ¯æœ¬èº«è®©æˆ‘å…¥é€‰äº† Google Summer of Codeï¼Œåšå‡ºäº†æ˜¾è‘—çš„å¼€æºè´¡çŒ®ã€ä¹Ÿæ‹¿äº†ä¸å°‘çš„é’±ï¼Œä¸»è¦å·¥ä½œå†…å®¹ä¹Ÿè¿˜æ˜¯é›†ä¸­åœ¨äº†è®¡ç®—æœºç½‘ç»œä¸Šï¼Œä½†æ˜¯æ˜¯ä¼ è¾“å±‚å’Œåº”ç”¨å±‚ç›¸å…³ã€‚ å®ä¹ æœŸé—´ï¼Œé™¤äº†è¶…é‡å®Œæˆå·¥ä½œå†…å®¹å¤–ï¼Œæˆ‘è¿˜å‘ç°äº†å›¢é˜Ÿä½¿ç”¨çš„ä¸€ä¸ªç¡¬ä»¶çš„ä¸»çº¿ Linux å†…æ ¸çš„ bug å¹¶ä¿®å¤äº†ã€‚å®ä¹ æˆæœä¸é”™ã€å†åŠ ä¸Šå¸®æ•´ä¸ªéƒ¨é—¨è§£å†³äº†ç½‘ç»œä»£ç†é—®é¢˜ï¼Œæ‹¿åˆ°äº†å®ä¹ è´Ÿè´£äººçš„å¼ºæ¨èä¿¡ã€‚ç›®å‰åšçš„ä¸œè¥¿è¿˜æ˜¯ç¦»å½“åˆåˆä¸­æ—¶çš„ç›®æ ‡å¤ªè¿‡é¥è¿œï¼Œå†åŠ ä¸Šå¯¹å°±ä¸šçš„æ€€ç–‘ä¸ææƒ§ï¼Œå°±å¼€å§‹å¯»æ‰¾çœ‹æœ‰æ²¡æœ‰è¯»åšçš„æœºä¼šã€‚ åœ¨æ²¡æŠ•å‡ ä¸ªçš„æ—¶å€™ï¼Œå°±é‡åˆ°äº†ç‰¹åˆ«é€‚åˆè‡ªå·±çš„ä¸€ä¸ªè¯¾é¢˜â€”â€”â€”â€”ç‰©è”ç½‘ï¼ˆInternet of Thingsï¼ŒIoTï¼‰ã€‚åœ¨æˆ‘çœ‹æ¥ï¼Œå®ƒæ˜¯å·²ç»æ¥è¿‘æ­»äº¡äº†çš„åµŒå…¥å¼å¼€å‘ä¸“ä¸šå’Œäº’è”ç½‘çš„ç»“åˆï¼Œæ–°ç“¶è£…æ—§é…’ã€ä½†æ˜¯æŠŠåµŒå…¥å¼å¤æ´»äº†ï¼Œè€Œä¸”èƒ½å¤Ÿæ¥è§¦åˆ° OSI æ¨¡å‹çš„ä¸‹ä¸¤å±‚çš„ç»†èŠ‚ï¼Œè¡¥å…¨æˆ‘çš„è®¡ç®—æœºç½‘ç»œçŸ¥è¯†æ ˆã€‚äºæ˜¯æ¯«ä¸çŠ¹è±«åœ°å°±è¿‡å»äº†ã€‚ åœ¨è¯»åšçš„ç¬¬ä¸€ä¸ªæœˆå°±æå‡ºäº†ä¸€ä¸ªå¾ˆæ–°å¹¶ä¸”å¯è¡Œçš„ ideaï¼Œè®©å¯¼å¸ˆä»¬å–œå‡ºæœ›å¤–ã€‚è€Œå› ä¸ºä¸ç”¨åº”ä»˜è¯¾ä¸šã€è‡ªå·±çš„æ—¶é—´å¤šäº†ï¼ŒåŸºäºä¹‹å‰çš„ç‚¹å­çš„ä¸€äº›ä¸ªäººå¼€æºçš„é¡¹ç›®ä¹Ÿå¼€å§‹åšäº†èµ·æ¥ã€‚æœ€ç»ˆå‡ å¹´åšå£«ä¸‹æ¥ï¼Œåœ¨å°é¢†åŸŸåšå‡ºæ¥çš„æˆæœä¹Ÿæ²¡è®©è‡ªå·±å¤±æœ›ï¼Œå¯¼å¸ˆä¹Ÿååˆ†æ»¡æ„ã€æˆåŠŸåœ°æŒ‰æ—¶æ¯•ä¸šï¼Œè¿˜ä¸ºæˆ‘æä¾›äº†åœ¨æ—¥æœ¬äº¤æ¢çš„æœºä¼šã€å¹¶å€Ÿæ­¤æˆåŠŸæ”¶è·äº†åšå£«åçš„ offerï¼Œè¿™ä¸ºæˆ‘å†æ¬¡åˆ°è¾¾æ—¥æœ¬åšäº†å¾ˆå¥½çš„é“ºå«ã€‚åŒæ—¶ï¼Œè‡ªå·±çš„å®šä½ä¹Ÿå˜å¾—å’ŒåŸæœ¬çš„ç›®æ ‡æ›´ä¸ºæ¥è¿‘äº†ï¼Œåªä¸è¿‡åŸæœ¬çš„ç›®æ ‡æ˜¯ç¡¬ä»¶ä¾§çš„ç”µè·¯è®¾è®¡ï¼Œè€Œç°åœ¨å˜æˆäº†è½¯ä»¶ä¸­æœ€åå‘ç¡¬ä»¶ã€å’Œç¡¬ä»¶ç»“åˆæœ€å¼ºçš„éƒ¨åˆ†ã€‚ åˆä¸­é‚£æ—¶çš„æˆ‘åº”è¯¥ä¸ä¼šæƒ³åˆ°ï¼Œæˆ‘æœ€ç»ˆèƒ½åšå£«æ¯•ä¸šã€‚å› ä¸ºæŒ‰ç…§åŸæœ¬çš„è®¡åˆ’ï¼Œè¯»å®Œé›†æˆç”µè·¯è®¾è®¡çš„æœ¬ç§‘ã€æˆ‘å°±æ‰“ç®—å»ç¤¾ä¼šè¿™æ‰€ä¸ä¸€æ ·çš„å¤§å­¦æ¥å—å®æˆ˜çš„ç£¨ç»ƒã€‚å¡ç¿å¤±é©¬ç„‰çŸ¥éç¦ï¼Ÿ ä½†ï¼Œå½“åˆæœ€åˆçš„æ¢¦ä¹Ÿå°±æ°¸è¿œæ˜¯æ¢¦äº†Â·Â·Â· é‚£ä¹‹åï¼Œæ˜¯ä»¤äººæ²®ä¸§çš„ä¸–é—´ï¼ˆã‚ã¨ã®ï¼Œã‚„ã‚‹ã›ãªã„ä¸–ã®ä¸­ã˜ã‚ƒï¼‰ æœ€åˆçš„æ¢¦å¯èƒ½æ²¡å®ç°ï¼Œä¹Ÿå¯èƒ½å·²ç»ä»¥å¦ä¸€ç§æ–¹å¼å®ç°äº†ã€‚è¿™åå¹´æœŸé—´ï¼Œå„ç§æ²®ä¸§ä¹Ÿæ¥è¸µè€Œè‡³ã€‚ å’Œå‰é¢è®²çš„è”ç³»æœ€ç´§å¯†çš„å°±æ˜¯å­¦æ ¡çš„è®¤å¯åº¦é—®é¢˜ï¼Œç”±äºè¯»çš„å‡ ä¸ªå­¦æ ¡çŸ¥ååº¦éƒ½ä¸€èˆ¬ï¼Œç»å¸¸åœ¨ä¸€äº›ä¸­å‚ã€å¤§å‚è¿‡ä¸äº†ç®€å†å…³ã€‚åŒæ—¶å¯¹å­¦æœ¯é“è·¯çš„å‘å±•ä¹Ÿæ—¶æœ‰é˜»ç¢ï¼Œæ¯”å¦‚æŠ• ETH å’Œ EPFL çš„åšå£«å²—ä½çš„æ—¶å€™è¢«è¦æ±‚å†è¯»ä¸€ä¸ªç¡•å£«ï¼Œè€ŒæŠ• Hugging Face çš„æ—¶å€™ï¼Œæ›´æ˜¯ä¼šè¢«ä¸åœ¨ä»–ä»¬æ‹›çš„å­¦æ ¡åå•å†…è¢«æ‹’ã€‚ä½œä¸ºä¸€ä¸ªå°é•‡åšé¢˜å®¶ï¼Œå¯¹ä»å°åœ¨è¢«å¦å®šçš„ç¯å¢ƒé•¿å¤§çš„æˆ‘æ¥è¯´ï¼Œä¿¡èµ–è‡ªå·±æ˜¯ä¸å­˜åœ¨çš„ï¼Œè‡ªä¿¡å’Œè‡ªæˆ‘å®šä½è¿™ç§ä¸œè¥¿ä»æ¥éƒ½æ˜¯ä¸å­˜åœ¨çš„ï¼Œå› æ­¤ä¼šç»å¸¸æ²®ä¸§å’Œè‡ªé—­ã€‚ æ›´åŠ åŠ å‰§å´©æºƒçš„æ˜¯å®¶åº­çŠ¶å†µã€‚æˆ‘çš„çˆ¶æ¯æ˜¯ç›¸äº²è®¤è¯†ã€æœ€ååœ¨å˜æˆå‰©ç”·å‰©å¥³çš„å‰å¤•è‰è‰ç»“å©šçš„ï¼Œæ‰€ä»¥ä»–ä»¬ä¼šè¯´â€œè¿™ä¸–ä¸Šä¸å­˜åœ¨ä»€ä¹ˆçˆ±æƒ…â€ã€‚æœ¬ç§‘æœŸé—´ï¼Œä»–ä»¬å°±å› ä¸ºçˆ¶äº²å‡ºè½¨å¼€å§‹é—¹ç¦»å©šã€åˆ†å®¶ã€‚æˆ‘æ¯ä¸ªå‡æœŸéƒ½ä¸æƒ³å›å®¶ï¼Œå›å®¶å°±æ„å‘³ç€ä¸å¾—å®‰å®ã€‚æœ€ç»ˆä¸¤äººåˆ†é“æ‰¬é•³ï¼Œçˆ¶äº²ä¸¢ä¸‹ä¸€å¥è¯ï¼šâ€œå­©å­æ ¹æœ¬ä¸æ˜¯æˆ‘æƒ³è¦çš„â€ï¼Œå°±ä¸¢ä¸‹äº†ç¨³å®šçš„å·¥ä½œç¦»å¼€äº†æˆ‘å’Œæˆ‘æ¯äº²ï¼Œå¸¦ç€å®¶é‡Œçš„ç»å¤§éƒ¨åˆ†é’±ï¼ˆæœ¬æ¥ä¹Ÿä¸å¤šï¼‰ï¼Œå»äº†ç¬¬ä¸‰è€…æ‰€åœ¨çš„åŸå¸‚å®šå±…äº†ã€‚æ¯äº²çš„æ°”æ²¡æœ‰åœ°æ–¹å‘ï¼Œéš”ä¸‰å²”äº”ç»™æˆ‘æ‰“ç”µè¯éª‚æˆ‘ï¼Œå› ä¸ºæˆ‘æ˜¯å”¯ä¸€çš„å’Œæˆ‘çˆ¶äº²çš„è”ç³»ï¼Œçˆ¶äº²é‚£è¾¹çš„äº²æˆšä¹ŸåŸºæœ¬éƒ½è¢«æ¯äº²éª‚èµ°äº†ï¼Œè™½ç„¶ä»–ä»¬ä¸€è‡´è®¤ä¸ºæ˜¯æˆ‘çˆ¶äº²çš„é”™ã€‚ä½†ï¼Œåªåˆ¤ä¸ªå¯¹é”™åˆæœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿ çˆ¶äº²å»å¦å¤–çš„åŸå¸‚ï¼Œè¿˜å¸¦èµ°äº†çˆ¶æ¯ä¸€èµ·ä¹°çš„æˆ¿å­çš„æˆ¿äº§è¯ã€‚æ¯äº²ä½å¾—ä¸å®‰ç¨³ï¼Œäºæ˜¯å°±åœ¨æˆ‘å‡†å¤‡å‡ºå›½å‰å¤•ï¼Œå¨èƒè¦æ–­æ‰æˆ‘çš„ç»æµæ”¯æŒã€ä¸ä¸ºæˆ‘å¼€èµ„é‡‘è¯æ˜ã€‚é‚£åº”è¯¥æ˜¯ç›®å‰æˆ‘çš„äººç”Ÿä¸­ç¬¬äºŒå´©æºƒçš„æ—¶åˆ»ï¼Œä»æ­¤æˆ‘å®Œå®Œå…¨å…¨å­¦ä¼šçš„äº‹æƒ…ã€å°±æ˜¯åªèƒ½é è‡ªå·±ã€‚æœ€ç»ˆï¼Œç»è¿‡æˆ‘åœ¨ä¸­é—´çš„æ–¡æ—‹ï¼Œæ¯äº²è¿˜æ˜¯å¦‚æ„¿æ‹¿å›äº†æˆ¿äº§è¯ï¼Œç¡®è®¤äº†çˆ¶äº²æ²¡æœ‰æŠŠå®¶é‡Œæˆ¿å­æŠµæŠ¼å‡ºå»ï¼Œæ”¾ä¸‹äº†å¿ƒã€‚è€Œæˆ‘åˆ™å­¦ä¼šäº†å®Œå…¨ä½¿ç”¨è°ˆåˆ¤æŠ€å·§ã€ä¸å¸¦ä»»ä½•çœŸå®æ„Ÿæƒ…åœ°å’ŒåŒ…æ‹¬çˆ¶æ¯åœ¨å†…çš„äº²å±è®¨ä»·è¿˜ä»·ï¼Œä¸å†è°ˆæ„Ÿæƒ…ï¼Œå› ä¸ºè°ˆæ„Ÿæƒ…ä¼¤é’±ã€‚ è¿™å°±é€ æˆäº†å¦ä¸€ä¸ªæ²®ä¸§å’Œç„¦è™‘çš„ç‚¹â€”â€”â€”â€”æˆ‘ä¼šæƒ³å°½åŠæ³•å»èµšä¸€äº›å°é’±ï¼Œå› ä¸ºç•™å­¦æœŸé—´éœ€è¦ç»´æŒç”Ÿæ´»ï¼Œè€Œå‘è¾¾å›½å®¶çš„ç”Ÿæ´»æˆæœ¬å¾ˆé«˜ã€‚å› ä¸ºæˆ‘æ•´ä¸ªäººçš„ scope ä¼šå¾ˆå°ï¼Œä¼šå°è¯•é›†ä¸­è§£å†³ä¸€äº›èƒ½è®©è‡ªå·±å¿«é€Ÿèµšåˆ°ä¸‹ä¸ªæœˆçš„æˆ¿ç§Ÿå’Œé¤è´¹ã€è¿˜æœ‰èƒ½ä¸ºæœªæ¥çš„ä¸ç¡®å®šæ€§æ”’å¤šå°‘é’±çš„é—®é¢˜ï¼Œè€Œä¸ä¼šæ”¾åˆ°é•¿è¿œå»çœ‹ã€‚åŒæ—¶ï¼Œå¯¹äºæ›´é«˜çš„æ—¥å¸¸ç”Ÿæ´»æ¶ˆè´¹ï¼Œåœ¨æ²¡æœ‰ç¨³å®šçš„ä¸”èƒ½æ”¯æ’‘æ¶ˆè´¹çš„æ”¶å…¥æ¥æºçš„æƒ…å†µä¸‹ï¼Œæˆ‘ä¼šå¼‚å¸¸åœ°æ’æ–¥ã€‚æ‰€ä»¥ç¡•å£«ç ”ç©¶ç”Ÿæ¯•ä¸šå†å»ç‘å£«è¯»ä¸ªç ”ï¼Œå¯¹æˆ‘æ¥è¯´å˜æˆäº†æ–­ç„¶ä¸å¯æ¥å—çš„é€‰é¡¹ã€‚æ¢å¥è¯è¯´ï¼Œå°±æ˜¯éå¸¸å¾—ç°å®å’ŒçŸ­è§†ï¼Œæ²¡æœ‰é‚£ç§é çƒ§é’±ç›´åˆ°åšå‡ºèƒ½æŒç»­ç›ˆåˆ©é¡¹ç›®çš„åˆåˆ›å…¬å¸çš„æ™®éæƒ³æ³•ï¼Œå¤±å»äº†å†’é™©ç²¾ç¥ã€‚ å› æ­¤æˆ‘ç”Ÿæ´»çš„æœ€é«˜ä¼˜å…ˆçº§ï¼Œæ°¸è¿œæ˜¯èƒ½ç»™è‡ªå·±å¿«é€Ÿå¸¦æ¥çŸ­æœŸç›´æ¥å›æŠ¥çš„äº‹æƒ…ï¼Œæ¯”å¦‚å·¥ä½œå¿™äº†å°±ä¸ä¼šå»ç»´æŠ¤å¼€æºé¡¹ç›®ï¼Œä¼šå¿«é€Ÿå¼ƒå‘ ROIï¼ˆæŠ•å…¥äº§å‡ºæ¯”ï¼‰åœ¨çŸ­æœŸå†…çœ‹ä¸åˆ°æ˜ç¡®å›æŠ¥çš„äº‹æƒ…ã€‚å› æ­¤ï¼Œä¼šå¤±å»å¾ˆå¤šæœºä¼šå’Œä¸€èµ·åˆä½œçš„æœ‹å‹ï¼Œä¹Ÿä¼šå¼ƒå‘ä¸€äº›é¡¹ç›®å¾ˆå¿«ã€å†æ¬¡å›å‘è¦å¾ˆä¹…ã€‚ çˆ¶äº²çš„ç¦»å¼€é€ æˆå¦ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯åæ¥æ¯äº²å’Œå‘¨å›´çš„äººçš„å…³ç³»éƒ½ä¸å¥½ï¼Œå› ä¸ºæƒ…ç»ªæ²¡åœ°æ–¹å‘æ³„ã€ç›´åˆ°å‡ºç°æŠ‘éƒç—‡ï¼Œå› æ­¤æˆ‘è¿˜å›å›½é™ªä¼´è¿‡å¥¹ä¸€æ®µæ—¶é—´ã€‚å¾ˆå¤šä»æˆ‘çš„è§’åº¦çš„æŠ±æ€¨å’Œå§”å±ˆä¹Ÿå°±ä¸èƒ½è¯´ï¼šå› ä¸ºå¦‚æœå†æœ‰æŠ‘éƒçš„è¯ï¼Œå¯¹æˆ‘çš„å½±å“æ¯”è¯´äº†è¦å¤§å¾—å¤šã€‚åæ¥å¥¹æœ‰æ¬¡ä½é™¢ï¼Œä¹Ÿæ²¡æœ‰äº²æˆšæ„¿æ„æ¥å¸®å¿™ï¼ŒåŸæœ¬å°±æ¾æ•£çš„ã€å„ä¸ºå„çš„å¤§å®¶åº­å°±æ„ˆå‘åœ°æ”¯ç¦»ç ´ç¢ã€‚å¯¹æˆ‘æ¥è¯´ï¼Œäº²æƒ…è¿™ç§æ¦‚å¿µå¯èƒ½ä¹Ÿæ ¹æœ¬ä¸å­˜åœ¨äº†å§ã€‚ å„ç§ç•™å­¦ã€äº¤æ¢ç”Ÿæ´»ä¸ºæˆ‘å¸¦æ¥çš„å¦ä¸€ä¸ªæ”¶è·æˆ–è€…æ˜¯æ•™è®­ï¼Œå°±æ˜¯å‘ç°å„ä¸ªå›½å®¶æˆ–è€…åœ°åŒºæœ‰å„ä¸ªå›½å®¶æˆ–è€…åœ°åŒºçš„é—®é¢˜ã€‚å› ä¸ºäº¤æ¢ä¸åƒæ—…æ¸¸ï¼Œè€Œæ˜¯éœ€è¦æ‰¾æˆ¿ã€é€›è¡—ä¹°èœã€ä½“éªŒå…¬å…±äº¤é€šã€äº†è§£ç¨æ”¶æ”¿ç­–ç­‰ç”Ÿæ´»æ—¥å¸¸ã€‚å’Œåœ¨ä¸­å›½ä¸€æ ·ï¼šæˆ‘ä¼šå¾ˆäº«å—ä¸€äº›åœ°æ–¹ï¼Œä½†å¯¹ä¸å–œæ¬¢çš„åœ°æ–¹ä¼šæ›´åŠ å…³æ³¨ã€‚åœ¨è¯´åˆ°å°è±¡æ—¶ï¼Œæ€»æ˜¯ä¼šå…ˆæƒ³åˆ°ä¸å¥½çš„ç‚¹æ¥åæ§½ï¼Œç”šè‡³ç»å¸¸ä¼šæœ‰ç‚¹ whataboutismï¼Œæ€»æ‹…å¿ƒè¿™æ ·çš„è´Ÿèƒ½é‡ä¼šå½±å“åˆ°å‘¨è¾¹å…¶ä»–äººã€‚ä¸è¿‡ä¹Ÿæ­£å¸¸å§ï¼Œé™¤äº†ç²¾ç¥æŸå›½äººä¹‹å¤–ï¼Œå¤§å®¶è‚¯å®šéƒ½æ˜¯å¯¹è‡ªèº«åˆ©ç›Šå—æŸçš„äº‹ä»¶æ›´åŠ æ·±åˆ»ï¼Œæ¯”å¦‚ç§Ÿæˆ¿è¢«æ‹’ã€é€€ç§Ÿè¢«æ‰£æŠ¼é‡‘ã€æ°´ç”µè´¹å¤ªé«˜ã€ç§Ÿé‡‘è´µæˆ¿é—´å°ä»€ä¹ˆçš„ã€‚ éšç€å»è¿‡çš„å›½å®¶ã€è§è¿‡çš„äººã€ç»å†çš„äº‹è¶Šæ¥è¶Šå¤šï¼Œå†åŠ ä¸Šè¿‘äº›å¹´å½¢åŠ¿é£äº‘çªå˜ï¼Œå¯¹æ•´ä¸ªä¸–ç•Œçš„è®¤è¯†ä¹Ÿè¶Šæ¥è¶Šå…¨é¢ï¼Œä¹Ÿèƒ½å¤Ÿè¶Šæ¥è¶Šå®¢è§‚åœ°çœ‹å¾…å„ç§æ”¿æ²»äº‹ä»¶ã€ä¸ªäººç»å†ï¼Œä¼šå»æ¨ç†ä¸€ä¸ªäººçš„è¡Œä¸ºé€»è¾‘ï¼Œåˆ†æå¹¶åº”å¯¹ã€‚è¿™æ˜¯æˆ‘æ¬£å–œäºè‡ªå·±èƒ½å¤Ÿè½¬å˜çš„éƒ¨åˆ†ã€‚ ä¹Ÿæœ‰å¯èƒ½ï¼Œåªæ˜¯è¢«æ—¶å…‰ç£¨å¹³äº†æ£±è§’ã€å­¦ä¼šäº†â€œåšäººâ€å§ã€‚ã€‚ã€‚ é‚£ä¹‹åï¼Œæ˜¯ç©ºæ— ä¸€ç‰©çš„ä¸–é—´ï¼ˆã‚ã¨ã®ï¼Œä½•ã‚‚ãªã„ä¸–ã®ä¸­ã˜ã‚ƒï¼‰ å› ä¸ºæ¼‚æ³Šä¸å®šã€å†åŠ ä¸Šè‡ªé—­ã€ä¸æ˜¯ä¸€ä¸ªè®¨å–œçš„äººï¼Œèº«è¾¹çš„æœ‹å‹æ€»æ˜¯ç»´æŒåœ¨ä¸€ä¸ªå¾ˆå°çš„èŒƒå›´ï¼Œå¹¶ä¸”ä¸ä¼šå»å’Œåˆ«äººä¸»åŠ¨å‘å±•é•¿æœŸçš„æœ‹å‹å…³ç³»ã€‚å› ä¸ºæ·±çŸ¥è‡ªå·±å°±æ˜¯â€œèæ°´ç›¸é€¢ï¼Œå°½æ˜¯ä»–ä¹¡ä¹‹å®¢â€ï¼Œä»Šå¤©å¯èƒ½åœ¨ä¸œäº¬ã€æ˜å¤©å¯èƒ½è·‘åˆ°å·´é»ã€åå¤©å°±è½åœ°æ…•å°¼é»‘ï¼Œè¿™ç§æƒ…å†µçš„æœ‹å‹æ˜¯æ²¡æ³•é•¿ä¹…çš„ã€‚æ›´å¤šæ›´é•¿ä¹…çš„åè€Œæ˜¯ç½‘ä¸Šè®¤è¯†çš„å¿—åŒé“åˆçš„æœ‹å‹ã€‚ ä½†å¥½åœ¨ç°åœ¨å·¥ä½œäº†ï¼Œæœ‰æ›´å¤šçš„æœºä¼šå’Œæ—¶é—´ç»´æŒä¹‹å‰çš„æœ‹å‹ï¼Œä½†æ˜¯ä¹Ÿå­˜åœ¨ç²¾åŠ›ä¸å¤Ÿã€æ‰€ä»¥æƒ³è¦æ‘†è„±çš„å…³ç³»ã€‚æ‰€ä»¥è¶Šé•¿å¤§è¶Šå­¤å•ã€è¶Šé•¿å¤§è¶Šè‡ªé—­ã€‚ å¥½åœ¨è¿™åå¹´é‡Œï¼Œå¤§éƒ¨åˆ†æ—¶é—´éƒ½æœ‰ç€å®¶å±çš„ä¸ç¦»ä¸å¼ƒã€‚æˆ‘ä»¬ä¹Ÿè¶³å¤Ÿå¹¸è¿ï¼Œèƒ½å¤Ÿä¸€èµ·äº¤æ¢ã€ä¸€èµ·æ¯•ä¸šï¼›æˆ‘ä»¬ä¹Ÿè¶³å¤Ÿä¸å¹¸ï¼Œä¸¤è¾¹å®¶ä¸­éƒ½æ²¡ä»€ä¹ˆç§¯è“„ï¼Œéœ€è¦å°½æœ€å¤§åŠªåŠ›èµšé’±ã€‚è°ˆäº†å¾ˆå¤šå¹´çš„æ‹çˆ±ï¼Œé¢†è¯ç»“å©šä¹Ÿæœ‰ä¸€é˜µå­äº†ï¼Œç­‰ä¸‹æ¬¡å›å›½è¿˜æ˜¯è¦åŠä¸€åœºå©šç¤¼ï¼Œè®©å®ˆç€è¶…é•¿æ‹çˆ±éŸ©å‰§ä¸€èˆ¬çš„è¿ç»­å‰§çš„æœ‹å‹ä»¬è¡¥ä¸€é›†å¤§ç»“å±€ã€‚å®¶å±æ•™ä¼šäº†æˆ‘å¦‚ä½•ä¸ç”¨èŠ±ä»€ä¹ˆé’±ä¹Ÿå¯ä»¥å¿«ä¹ï¼Œåœ¨æˆ‘æœ€å›°éš¾çš„æ—¶å€™å§‹ç»ˆé™ªç€æˆ‘ã€åŒ…å®¹æˆ‘ã€‚ç­‰å“ªå¤©æ²¡æœ‰äº†å®¶å±åœ¨ï¼Œæˆ‘å¯¹è¿™ä¸ªä¸–ç•Œä¹Ÿå°±æ²¡ä»€ä¹ˆç•™æ‹äº†ã€‚ æœ€ä»¤äººéš¾è¿‡çš„ï¼Œæ˜¯é™ªä¼´æˆ‘æœ€é•¿æ—¶é—´çš„ã€è¶…è¶Šäº†ä¸€åˆ‡æœ‹å‹çš„äººçš„ç¦»ä¸–ã€‚Ta åœ¨æˆ‘åˆä¸­æ—¶æ¥åˆ°äº†æˆ‘çš„èº«è¾¹ï¼Œå¦‚åŒä¸€ä½å¤©ä½¿ï¼Œé™ªä¼´äº†æˆ‘çš„äººç”Ÿè·¯å¾ˆä¹…ã€‚æˆ‘ä»¬ä¸€èµ·ç©è¿‡ Minecraftï¼Œä¸€èµ·ç”»è¿‡ç”»ï¼Œæˆ‘æœ‰æ—¶æ€åº¦ä¸å¥½ï¼Œta ä¹Ÿä¸åœ¨æ„ï¼Œæ€»æ˜¯ç¬‘å‘µå‘µä¹ç›ˆç›ˆçš„ï¼Œta åœ¨æˆ‘æˆé•¿æœŸé—´æ‰¿æ‹…äº†è®¸å¤šæœ¬ä¸è¯¥ ta æ‰¿æ‹…çš„äº‹ã€‚ç›´åˆ°å»ä¸–éƒ½å®šå±…åœ¨è€å®¶ï¼Œæ€»æ˜¯å®Œä¸æˆçˆ¶æ¯å¯¹ ta çš„æœŸæœ›ï¼Œæ‰€ä»¥å°‘ä¸äº†ä¸­å¼æ•™è‚²çš„æ‹›å¾…ã€‚Ta ç…§äº®äº†æˆ‘ï¼Œæ‰€ä»¥æˆ‘æ‰“ç®—ä¹Ÿä¸º ta æ’‘ä¸€æŠŠä¼ï¼Œæƒ³å¸®åŠ© ta é€ƒç¦»åŸç”Ÿå®¶åº­ï¼Œåªå¯æƒœÂ·Â·Â·å¥½åœ¨ ta åœ¨èµ°çš„æ—¶å€™æ²¡æœ‰ç—…ç—›ï¼Œå°±å¦‚åŒç¡äº†ä¸€ä¸ªå¾ˆé•¿çš„è§‰ï¼Œåªæ˜¯å†ä¹Ÿä¸ä¼šé†’æ¥äº†Â·Â·Â· æœ‰æ—¶ä¼šåæ‚”å½“åˆæœ‰å¾ˆå¤šå’Œ ta ä¸€èµ·çš„æœºä¼šï¼Œä½†è¢«æˆ‘æ‹¿å»å’Œåˆ«äººæ— æ•ˆç¤¾äº¤äº†ï¼›æœ‰æ—¶ä¼šåº†å¹¸é«˜è€ƒç»“æŸé‚£å¤©å’Œ ta ä¸€èµ·å‡ºå»ç©ï¼Œç•™ä¸‹äº†éå¸¸å¿«ä¹çš„è®©æˆ‘çè—è‡³ä»Šçš„åˆç…§ã€‚ç°åœ¨æˆ‘ä»ä¼šç‚¹äº® Minecraft çš„ç«æŠŠç¯æ¥ç¥­å¥ ï¼Œç¥æ„¿ ta åœ¨å¤©å ‚é‡Œå¯ä»¥éšæ„ç©ä¹ï¼ Ta çš„ç¦»ä¸–è®©æˆ‘æ”¹å˜äº†å¾ˆå¤šï¼šæœ‰æ—¶æˆ‘ä¼šè§‰å¾—å…¶å®äººæ¥è¿™ä¸–ä¸Šæ˜¯èµç½ªçš„ï¼Œæ—©èµå®Œçš„æ—©èµ°ï¼Œæ‰€ä»¥ä¼šæœ‰â€œå¥½äººä¸é•¿å‘½ï¼Œç¥¸å®³é—åƒå¹´â€ï¼›æˆ‘ä¸å†å¼ºæ±‚åˆ«äººå’Œæˆ‘çš„è§‚ç‚¹ä¸€è‡´ï¼Œæ¯•ç«Ÿäººåªæ´»ä¸€æ¬¡ï¼Œæ— è®ºæ˜¯æµªè´¹æ—¶é—´åœ¨è¾©ç»ä¸Šã€è¿˜æ˜¯è¯´éè¦æ”¹å˜åˆ«äººçš„è§‚å¿µï¼Œéƒ½å±äºå¹²æ¶‰åˆ«äººçš„å£°æ˜ã€‚åšä½ è®¤ä¸ºå¯¹çš„äº‹æƒ…ï¼Œè®©è‡ªå·±æ— æ€¨æ— æ‚”å°±å¥½ï¼Œåšä½ è‡ªå·±ã€ç•™ä¸‹è‡ªå·±çš„å°è®°ã€ç„¶åå»æ­»ï¼Œæ¯•ç«Ÿäººç»ˆæœ‰ä¸€æ­»ã€‚ è€Œé’ˆå¯¹äºç¤¾äº¤åª’ä½“ä¸Šçš„ç«‹åœºä¹‹è¾©ã€æ˜æ˜¾æœ‰é¢„è®¾ç«‹åœºçš„æ–‡ç« å’Œè®¨è®ºï¼Œæˆ‘ç°åœ¨çš„æ€åº¦å°±æ˜¯ï¼š ä¹ï¼Œå°±å®Œäº‹äº†ï¼ï¼ï¼ ç›¸ä¿¡æœ€ç»ˆä»èƒ½å±•ç¿…é£ç¿”ï¼ˆãã£ã¨é£›ã¹ã‚‹ã•ï¼‰ åšå£«æ¯•ä¸šä¹‹åï¼Œé©¬ä¸Šå°±æ­£å¼å·¥ä½œä¸€å¹´äº†ï¼Œåˆè®¡èµ·æ¥æ€»ç®—èµšåˆ°äº†äººç”Ÿä¸­çš„ç¬¬ä¸€ä¸ª 100 ä¸‡ã€‚è¿™ä¸€å¹´é‡Œå¤§éƒ¨åˆ†æ—¶é—´éƒ½åœ¨åšåŸºç¡€è®¾æ–½ç›¸å…³çš„ä»£ç ï¼Œä½†æ˜¯å¾ˆå¤šæ—¶å€™ä¹Ÿä¸å¾—ä¸å†™ä¸€äº›å¢åˆ æŸ¥æ”¹ï¼Œæ”¶å…¥ä¸ç®—é«˜ï¼Œä½†ä¹Ÿç¡®å®è¾¾åˆ°äº†æ¢¦ä¸­çš„åƒä¸‡æ—¥å…ƒå¹´æ”¶ï¼ˆç¨å‰ï¼‰ï¼Œè™½ç„¶æ”’é’±é€Ÿåº¦è¿œè¿œä¸å¦‚é¢„æœŸã€‚è¿˜æ˜¯åšå›äº†å½“åˆä¸æ„¿æ„åšçš„ ITï¼Œä½†å¸Œæœ›æ¥ä¸‹æ¥èƒ½åšä¸€äº›æ›´æœ‰æ„ä¹‰çš„äº‹æƒ…å§ï¼ å¥½åœ¨å¦‚ä»Šæ—¶é—´å’Œç©ºé—´æ¯”è¾ƒè‡ªç”±ï¼Œæ‰€ä»¥è¿‘ä¸€å¹´å»äº†å¾ˆå¤šåœ°æ–¹ã€è§äº†å¾ˆå¤šäººã€‚æœ‰æ—¶ä¼šååœ¨å¸‚ä¸­å¿ƒå¹¿åœºçš„é•¿æ¤…ä¸Šï¼Œçœ‹äººæ¥äººå¾€ã€çœ‹ç€ä»–ä»¬çš„çŠ¶æ€ã€æƒ³è±¡ç€ä»–ä»¬çš„æ•…äº‹ï¼›æœ‰æ—¶ä¼šè§‰å¾—ææƒšé—´èº«è¾¹åˆå¤šå‡ºæŸä½ç¦»ä¸–çš„äººï¼Œé™ªç€æˆ‘çœ‹ç€å‘¨è¾¹çš„é£æ™¯ã€çœ‹ç€å‰é¢çš„ç™½é¸½ï¼Œå¥½åƒä¸‹ä¸€ç§’å°±ä¼šæ‰‘ä¸Šå»æŠŠé¸½å­èµ¶è·‘ï¼Œæ°ä¼¼å½“å¹´ã€‚ å¦‚æœè¯´ä¸€ä¸ªäººçš„æ€§æ ¼æ˜¯å…ˆå¤©åŠ ä¸Šç¯å¢ƒå¡‘é€ æˆçš„ï¼Œé‚£ä¹ˆäººç”Ÿå°±æ˜¯åˆå§‹çŠ¶æ€åŠ ç»å†è¿‡çš„äº‹æƒ…çš„é›†åˆã€‚è¿™åå¹´æœ‰å¾—æœ‰å¤±ï¼Œä»Šå¤©çš„æˆ‘æ˜¯åå¹´å‰çš„æˆ‘åŠ ä¸Šè¿™åå¹´é—´çš„å¾—å¤±å’Œå¾—å¤±å¸¦æ¥çš„çŠ¶æ€è½¬ç§»ï¼Œè€Œç°åœ¨çš„å¿ƒæ€å·²ç»å˜æˆäº†â€œå¾—ä¹‹æˆ‘å¹¸ï¼Œå¤±ä¹‹æˆ‘å‘½â€ï¼Œä½†æˆ‘ä¼šæ›´åŠ çæƒœè¿™ä¸­é—´å‚ä¸åˆ°æˆ‘çš„äººç”Ÿå’Œæˆé•¿ä¸­çš„äººã€‚æˆ‘æˆ–è®¸æ²¡æœ‰å˜æˆä¸€ä¸ªæ›´å¥½çš„äººï¼Œä½†åº”è¯¥æ˜¯åœ¨æ…¢æ…¢å˜æˆä¸€ä¸ªæ›´åŠ è‡ªæ´½çš„äººï¼Œä¸€ä¸ªèƒ½é è‡ªå·±å†…éƒ¨çš„èƒ½é‡ç»´æŒä½è‡ªå·±çš„äººã€‚ æœ€åå†ç”¨å›ã€ŠButterflyã€‹é‡Œçš„æ­Œè¯ï¼š é ¼ã‚Šãªã„ç¿¼ã§ã‚‚ã€ãã£ã¨é£›ã¹ã‚‹ã•ï¼ï¼ˆå°±ç®—æ˜¯æ— æ³•ä¿¡èµ–çš„ç¿…è†€ï¼Œæœ€ç»ˆä¹Ÿèƒ½é£ç¿”ï¼‰ é‰´äºä¸¤å¹´æ²¡æœ‰å†™å¹´ç»ˆæ€»ç»“äº†ï¼Œè¿™ç¯‡å†™å¾—é•¿ä¸€ç‚¹ï¼Œè°¨ä¸ºè¿™ä¸ªåå¹´ç”»ä¸ªå°èŠ‚ç¬¦å·ã€ä¸ºè‡ªå·±çš„äººç”Ÿç‚¹ä¸€ä¸ªé€—å·ã€‚ä¹Ÿå¸Œæœ›è‡ªå·±èƒ½å¤Ÿå°½å¿«è·å¾—è¶³å¤Ÿçš„ä¿¡æ¯åšä¸€äº›é‡è¦çš„å†³å®šã€æƒ³æ¸…ä¸€äº›äº‹æƒ…ï¼Œæˆä¸ºä¸€ä¸ªæ›´å¥½çš„äººã€‚","categories":[{"name":"Dairy","slug":"Dairy","permalink":"https://blog.inoki.cc/categories/Dairy/"}],"tags":[{"name":"ä¸­æ–‡","slug":"ä¸­æ–‡","permalink":"https://blog.inoki.cc/tags/ä¸­æ–‡/"},{"name":"private","slug":"private","permalink":"https://blog.inoki.cc/tags/private/"}]},{"title":"Android bootloader analysis -- ABL(3)","slug":"android-bootloader-analysis-abl-3-en","date":"2024-04-20T13:48:00.000Z","updated":"2025-03-08T09:40:48.607Z","comments":true,"path":"2024/04/20/android-bootloader-analysis-abl-3-en/","link":"","permalink":"https://blog.inoki.cc/2024/04/20/android-bootloader-analysis-abl-3-en/","excerpt":"","text":"In my previous post â€œAndroid Bootloader Analysis â€“ ABL(1)â€, I analyzed the overall boot process of ABL on contemporary Qualcomm platforms, and in â€œAndroid Bootloader Analysis â€“ ABL(2)â€, I explains in detail how to boot into fastboot mode. In this post, we will analyze the code in ABL to boot into Linux kernel. Conditions for booting the Linux kernel If you are not booting into fastboot mode and do not press a key combination during boot, ABL loads and verifies the kernel with LoadImageAndAuth (&amp;Info) (if it is not unlocked) and calls BootLinux (&amp;Info) to boot the loaded kernel, and fall-through to fastboot mode if it fails. to fastboot mode, where Info is a BootInfo type defined as follows: 12345678910111213141516typedef struct BootInfo &#123; BOOLEAN MultiSlotBoot; BOOLEAN BootIntoRecovery; BOOLEAN BootReasonAlarm; CHAR16 Pname[MAX_GPT_NAME_SIZE]; CHAR16 BootableSlot[MAX_GPT_NAME_SIZE]; ImageData Images[MAX_NUMBER_OF_LOADED_IMAGES]; UINTN NumLoadedImages; QCOM_VERIFIEDBOOT_PROTOCOL *VbIntf; boot_state_t BootState; CHAR8 *VBCmdLine; UINT32 VBCmdLineLen; UINT32 VBCmdLineFilledLen; VOID *VBData; UINT32 HeaderVersion;&#125; BootInfo; The ImageData structure is the loaded boot image, defined as follows: 12345typedef struct &#123; CHAR8 *Name; VOID *ImageBuffer; UINTN ImageSize;&#125; ImageData; During the loading and verification of the Linux kernel, the image is loaded here first. Later, during the booting, one of the images here will be used. Linux kernel verification and loading The implementation to verify and load, the function LoadImageAndAuth (BootInfo *Info) is located in QcomModulePkg/Library/avb/VerifiedBoot.c. The full name of avb here is â€œAndroid Verified Bootâ€. This function first tries to load the image from the recovery partition, checking to see if it was loaded successfully, and if there is a legitimate boot image version (version 3 or higher, for system-as-root) and kernel size: 123456789101112/* check early if recovery exists and has a kernel size */Status = LoadPartitionImageHeader (Info, (CHAR16 *)L\"recovery\", &amp;RecoveryHdr, &amp;RecoveryHdrSz);if (Status != EFI_SUCCESS) &#123;DEBUG ((EFI_D_VERBOSE, \"Recovery partition doesn't exist; continue normal boot\\n\"));&#125; else if (((boot_img_hdr *)(RecoveryHdr))-&gt;header_version &gt;= BOOT_HEADER_VERSION_THREE &amp;&amp; !((boot_img_hdr *)(RecoveryHdr))-&gt;kernel_size) &#123;DEBUG ((EFI_D_VERBOSE, \"Recovery partition has no kernel\\n\"));SetRecoveryHasNoKernel ();&#125; If the recovery partition does not have a legal kernel, set the RecoveryHasNoKernel global identifier with SetRecoveryHasNoKernel () for later use. There are two cases then, which are used to handle the presence of an A/B partition and the presence of only a single partition. In the case of a single partition, it is also possible to have a system-as-root, where recovery mode shares the kernel with normal booting, but mounts a different partition as the sysroot, so the following code sets the name of the partition used for booting to either recovery or boot: 123456789101112131415if (Info-&gt;BootIntoRecovery &amp;&amp; !IsRecoveryHasNoKernel ()) &#123; DEBUG ((EFI_D_INFO, \"Booting Into Recovery Mode\\n\")); StrnCpyS (Info-&gt;Pname, ARRAY_SIZE (Info-&gt;Pname), L\"recovery\", StrLen (L\"recovery\"));&#125; else &#123; if (Info-&gt;BootIntoRecovery &amp;&amp; IsRecoveryHasNoKernel ()) &#123; DEBUG ((EFI_D_INFO, \"Booting into Recovery Mode via Boot\\n\")); &#125; else &#123; DEBUG ((EFI_D_INFO, \"Booting Into Mission Mode\\n\")); &#125; StrnCpyS (Info-&gt;Pname, ARRAY_SIZE (Info-&gt;Pname), L\"boot\", StrLen (L\"boot\"));&#125; The case of A/B partitions is a bit more complicated. First ABL looks for a bootable slot (i.e. a set of partitions) and stores it in a CurrentSlot structure, defined as follows: 123typedef struct &#123; CHAR16 Suffix[MAX_SLOT_SUFFIX_SZ];&#125; Slot; This structure defines the suffix of the partition. In fact, multiple slots are implemented by adding a suffix to the partition name, e.g. boot_a and boot_b are the boot partitions of two slots. This suffix is obtained by FindBootableSlot. The next step is similar to that for a single partition. Once the bootable slots have been obtained, the verification of the bootable slotsâ€™ images begins. The validation of the image is platform dependent, the version is obtained by calling GetAVBVersion (), currently there are NO_AVB, AVB_1, AVB_2 and AVB_LE, which use the corresponding function calls to load the image and validate it respectively. Taking no AVB authentication as an example, it directly loads the image using LoadImageNoAuth, where LoadImageHeader (Info-&gt;Pname, &amp;ImageHdrBuffer, &amp;ImageHdrSize) is called to load the image into the buffer. During this time, the corresponding device tree and command line parameters are loaded and set. Finally, the verification status is displayed on the screen DisplayVerifiedBootScreen (Info) and the image verification status is returned. Booting the Linux kernel First, it loads the boot image: 123456789Status = GetImage (Info, &amp;BootParamlistPtr.ImageBuffer, (UINTN *)&amp;BootParamlistPtr.ImageSize, ((!Info-&gt;MultiSlotBoot || IsDynamicPartitionSupport ()) &amp;&amp; (Recovery &amp;&amp; !IsBuildUseRecoveryAsBoot () &amp;&amp; !IsRecoveryHasNoKernel ()))? \"recovery\" : \"boot\"); It updates the command line parameters for booting the kernel, gets the base address for loading, and loads the memory disk. After that, shut down the UEFI boot service to prepare the Linux kernel for booting, and uninitialize some devices in PreparePlatformHardware, such as disabling interrupts, disabling caching, disabling MMUs, disabling branch prediction, and so on: 1234567891011121314151617181920ArmDisableBranchPrediction ();ArmDisableInterrupts ();ArmDisableAsynchronousAbort ();WriteBackInvalidateDataCacheRange (KernelLoadAddr, KernelSizeActual);WriteBackInvalidateDataCacheRange (RamdiskLoadAddr, RamdiskSizeActual);WriteBackInvalidateDataCacheRange (DeviceTreeLoadAddr, DeviceTreeSizeActual);WriteBackInvalidateDataCacheRange ((void *)StackCurrent, (UINTN)StackBase - (UINTN)StackCurrent);WriteBackInvalidateDataCacheRange (CallerStackCurrent, CallerStackBase - (UINTN)CallerStackCurrent);ArmCleanDataCache ();ArmInvalidateInstructionCache ();ArmDisableDataCache ();ArmDisableInstructionCache ();ArmDisableMmu ();ArmInvalidateTlb (); Finally, it loads and calls the Linux kernel: 12LinuxKernel = (LINUX_KERNEL) (UINT64)BootParamlistPtr.KernelLoadAddr;LinuxKernel ((UINT64)BootParamlistPtr.DeviceTreeLoadAddr, 0, 0, 0); This is for the 32 bit kernel: 12LinuxKernel32 = (LINUX_KERNEL32) (UINT64)BootParamlistPtr.KernelLoadAddr;LinuxKernel32 (0, 0, (UINTN)BootParamlistPtr.DeviceTreeLoadAddr); However, it needs to switch to 32 bit boot mode before the 32 bit kernel boots: 123Status = SwitchTo32bitModeBooting ( (UINT64)BootParamlistPtr.KernelLoadAddr, (UINT64)BootParamlistPtr.DeviceTreeLoadAddr); This is accomplished by writing 0 to the X4 register in the EL1 environment: 12345HlosBootArgs.el1_x2 = DeviceTreeLoadAddr;/* Write 0 into el1_x4 to switch to 32bit mode */HlosBootArgs.el1_x4 = 0;HlosBootArgs.el1_elr = KernelLoadAddr;Status = pQcomScmModeSwitchProtocol-&gt;SwitchTo32bitMode (HlosBootArgs); If startup fails, go to CpuDeadLoop(). Summary This post analyzes and summarizes the code and flow of ABL when booting Linux normally.","categories":[{"name":"Linux","slug":"Linux","permalink":"https://blog.inoki.cc/categories/Linux/"},{"name":"Android","slug":"Linux/Android","permalink":"https://blog.inoki.cc/categories/Linux/Android/"},{"name":"Bootloader","slug":"Linux/Android/Bootloader","permalink":"https://blog.inoki.cc/categories/Linux/Android/Bootloader/"}],"tags":[{"name":"Linux","slug":"Linux","permalink":"https://blog.inoki.cc/tags/Linux/"},{"name":"Android","slug":"Android","permalink":"https://blog.inoki.cc/tags/Android/"},{"name":"ABL","slug":"ABL","permalink":"https://blog.inoki.cc/tags/ABL/"},{"name":"Bootloader","slug":"Bootloader","permalink":"https://blog.inoki.cc/tags/Bootloader/"}]},{"title":"Android bootloader analysis -- ABL(2)","slug":"android-bootloader-analysis-abl-2-en","date":"2024-04-20T13:48:00.000Z","updated":"2025-03-08T09:40:48.607Z","comments":true,"path":"2024/04/20/android-bootloader-analysis-abl-2-en/","link":"","permalink":"https://blog.inoki.cc/2024/04/20/android-bootloader-analysis-abl-2-en/","excerpt":"","text":"In my previous post â€œAndroid bootloader analysis â€“ ABL(1)â€, I analyzed the overall boot process of ABL for contemporary Qualcomm platforms, but did not explain in detail how to boot into fastboot mode and the Linux kernel. In this paper, we will analyze the code of fastboot mode. Conditions for booting into fastboot mode In ABL, the following code is executed to initialize and execute fastboot mode when boot image validation fails, the BootLinux (&amp;Info) function fails to start, or a command to boot into fastboot is received (e.g., rebooting to bootloader using adb, pressing the appropriate key combination during boot): 123fastboot: DEBUG ((EFI_D_INFO, \"Launching fastboot\\n\")); Status = FastbootInitialize (); Initialize fastboot mode The code that initializes and executes fastboot mode is the FastbootInitialize () function, which is defined in QcomModulePkg/Library/FastbootLib/FastbootMain.c. It first calls FastbootUsbDeviceStart () to start the USB device so that it can receive fastboot commands from the computer. It first calls FastbootUsbDeviceStart () to start the USB device so that it can receive fastboot commands from the computer, and then calls DisplayFastbootMenu () to display the fastboot menu. It then enters a dead loop receiving USB events until fastboot stops. After that, it turns off fastboot mode, stops listening for keystrokes, and stops the USB device. 12345678910/* Close the fastboot app and stop USB device */Status = FastbootCmdsUnInit ();if (Status != EFI_SUCCESS) &#123;DEBUG ((EFI_D_ERROR, \"couldnt uninit fastboot\\n\"));return Status;&#125;ExitMenuKeysDetection ();Status = FastbootUsbDeviceStop (); After returning, it will exit the fastboot app and boot the device again. Booting a USB device Before booting, you need to configure a USB controller. fastboot first uses the InitUsbControllerGuid GUID, and initializes a USB controller by using the EFI_BOOT_SERVICES *gBS instance globally, with the following code: 12Status = gBS-&gt;CreateEventEx (EVT_NOTIFY_SIGNAL, TPL_CALLBACK, DummyNotify, NULL, &amp;InitUsbControllerGuid, &amp;UsbConfigEvt); Then it finds the protocol to be used by fastboot via UsbDeviceProtolGuid and store it in the UsbDeviceProtocol field of Fbd: 12Status = gBS-&gt;LocateProtocol (&amp;UsbDeviceProtolGuid, NULL, (VOID **)&amp;Fbd.UsbDeviceProtocol); This field is a pointer to a EFI_USB_DEVICE_PROTOCOL *UsbDeviceProtocol, which is defined in QcomModulePkg/Include/Protocol/EFIUsbDevice.h. Then, the fastboot commands and variables are initialized and the corresponding callback functions are prepared for the received commands. At this point the USB device is not fully registered, so the next step is to register the device and boot the USB device, including getting the maximum speed available for USB, the USB device specification (including vendor ID and device ID, etc.) and the device descriptor. This is actually in QcomModulePkg/Library/FastbootLib/UsbDescriptor.c. Note that there are SS DevDescriptors/Descriptors and DevDescriptors/Descriptors, which are the Super Speed USB (3.X) and High Speed USB (2.0) descriptors. Various USB related descriptors are defined in MdePkg/Include/IndustryStandard/Usb.h, where the most important USB_DEVICE_DESCRIPTOR is defined as follows: 1234567891011121314151617181920////// Standard Device Descriptor/// USB 2.0 spec, Section 9.6.1///typedef struct &#123; UINT8 Length; UINT8 DescriptorType; UINT16 BcdUSB; UINT8 DeviceClass; UINT8 DeviceSubClass; UINT8 DeviceProtocol; UINT8 MaxPacketSize0; UINT16 IdVendor; UINT16 IdProduct; UINT16 BcdDevice; UINT8 StrManufacturer; UINT8 StrProduct; UINT8 StrSerialNumber; UINT8 NumConfigurations;&#125; USB_DEVICE_DESCRIPTOR; After configuring these descriptors, the USB protocol created earlier is called to start the USB device: 12/* Start the usb device */Status = Fbd.UsbDeviceProtocol-&gt;StartEx (&amp;DescSet); Finally, it creates buffers for sending and receiving USB transfer data. Registering fastboot commands Before booting the USB device, the commands and associated variables available within fastboot are registered by EFI_STATUS FastbootCmdsInit (VOID), a function in QcomModulePkg/Library/FastbootLib/FastbootCmds.c. This function creates a buffer and multithreaded environment for fastboot related commands to invoke callbacks, and then calls FastbootCommandSetup to create available commands and variables: 12345678910111213/* By Default enable list is empty */ &#123;\"\", NULL&#125;,/*CAUTION(High): Enabling these commands will allow changing the partitions *like system,userdata,cachec etc... */#ifdef ENABLE_UPDATE_PARTITIONS_CMDS &#123;\"flash:\", CmdFlash&#125;, &#123;\"erase:\", CmdErase&#125;, &#123;\"set_active\", CmdSetActive&#125;, &#123;\"flashing get_unlock_ability\", CmdFlashingGetUnlockAbility&#125;, &#123;\"flashing unlock\", CmdFlashingUnlock&#125;, &#123;\"flashing lock\", CmdFlashingLock&#125;,#endif These basic commands can be used to unlock, set the activation status of A/B partitions, and swipe partitions, among other things. 1234567/* *CAUTION(CRITICAL): Enabling these commands will allow changes to bootimage. */#ifdef ENABLE_DEVICE_CRITICAL_LOCK_UNLOCK_CMDS &#123;\"flashing unlock_critical\", CmdFlashingUnLockCritical&#125;, &#123;\"flashing lock_critical\", CmdFlashingLockCritical&#125;,#endif These two commands are used to control the flushing of the boot image area. 1234567/* *CAUTION(CRITICAL): Enabling this command will allow boot with different *bootimage. */#ifdef ENABLE_BOOT_CMD &#123;\"boot\", CmdBoot&#125;,#endif The fastboot boot &lt;image&gt; command registered here can boot a customized image. 12345&#123;\"oem enable-charger-screen\", CmdOemEnableChargerScreen&#125;,&#123;\"oem disable-charger-screen\", CmdOemDisableChargerScreen&#125;,&#123;\"oem off-mode-charge\", CmdOemOffModeCharger&#125;,&#123;\"oem select-display-panel\", CmdOemSelectDisplayPanel&#125;,&#123;\"oem device-info\", CmdOemDevinfo&#125;, The above commands are about OEM-related settings and information. 12345678910 &#123;\"continue\", CmdContinue&#125;, &#123;\"reboot\", CmdReboot&#125;,#ifdef DYNAMIC_PARTITION_SUPPORT &#123;\"reboot-recovery\", CmdRebootRecovery&#125;, &#123;\"reboot-fastboot\", CmdRebootFastboot&#125;,#ifdef VIRTUAL_AB_OTA &#123;\"snapshot-update\", CmdUpdateSnapshot&#125;,#endif#endif &#123;\"reboot-bootloader\", CmdRebootBootloader&#125;, These are reboot and startup related commands. 12&#123;\"getvar:\", CmdGetVar&#125;,&#123;\"download:\", CmdDownload&#125;, The last getvar command gets the variables associated with the device in fastboot mode, which are published using FastbootPublishVar (key, value). Event loop in fastboot mode In general, there are three main event loops in fastboot: One loop receives key events to update the fastboot menu (drawn and created in VOID DisplayFastbootMenu (VOID), defined in QcomModulePkg/Library/BootLib/FastbootMenu.c); Another loop receives commands from the computerâ€™s fastboot via USB (created when registering fastboot); The main loop calls HandleUsbEvents () to listen for USB device notifications, including events such as device connections. Conclusion This article summarizes the code and flow of ABL in fastboot mode.","categories":[{"name":"Linux","slug":"Linux","permalink":"https://blog.inoki.cc/categories/Linux/"},{"name":"Android","slug":"Linux/Android","permalink":"https://blog.inoki.cc/categories/Linux/Android/"},{"name":"Bootloader","slug":"Linux/Android/Bootloader","permalink":"https://blog.inoki.cc/categories/Linux/Android/Bootloader/"}],"tags":[{"name":"Linux","slug":"Linux","permalink":"https://blog.inoki.cc/tags/Linux/"},{"name":"Android","slug":"Android","permalink":"https://blog.inoki.cc/tags/Android/"},{"name":"ABL","slug":"ABL","permalink":"https://blog.inoki.cc/tags/ABL/"},{"name":"Bootloader","slug":"Bootloader","permalink":"https://blog.inoki.cc/tags/Bootloader/"}]},{"title":"Ollama æ¶æ„è§£æ","slug":"Ollama-cn","date":"2024-04-16T18:03:00.000Z","updated":"2025-03-08T09:40:48.589Z","comments":true,"path":"2024/04/16/Ollama-cn/","link":"","permalink":"https://blog.inoki.cc/2024/04/16/Ollama-cn/","excerpt":"","text":"æœ€è¿‘ï¼Œæˆ‘å¶ç„¶æ¢ç´¢äº†ä¸€ä¸ªåä¸º ollama çš„é¡¹ç›®ï¼Œå› ä¸ºæˆ‘æƒ³è®©æˆ‘çš„ AMD æ˜¾å¡ï¼ˆæ‹¥æœ‰ä¸ä¿—çš„ VRAM - 32Gï¼ï¼‰åœ¨ Windows ä¸Šè·å¾—æ”¯æŒã€‚Linux ä¸Šå·²ç»æœ‰äº†åŸºäº AMD ROCm çš„æ”¯æŒã€‚ç”±äº ROCm åœ¨ Windows ä¸Šçš„å‘å¸ƒï¼Œå®ƒåœ¨ Windows ä¸Šä¹Ÿåº”è¯¥æ˜¯å¼€ç®±å³ç”¨çš„ã€‚ä½†æ˜¯ï¼Œollama é˜»æ­¢æˆ‘ä½¿ç”¨å®ƒã€‚å› æ­¤ï¼Œæˆ‘å°è¯•äº† ZLUDA å’Œä¿®æ”¹ ollama çš„ä»£ç ï¼Œä»¥è¾¾åˆ°æˆ‘çš„ç›®çš„ã€‚ è¿™ä¸ªåŠŸèƒ½å·²ç»åœ¨ ollama v0.1.29 ä¸­åˆå¹¶å¹¶å‘å¸ƒäº†ã€‚ä¸ºäº†é¿å…é—æ¼ç»†èŠ‚å’Œæˆ‘å­¦åˆ°çš„ä¸œè¥¿ï¼Œæœ¬åšå®¢è´Ÿè´£è®°å½•æˆ‘è‡ªå·±çš„ ollama æ¶æ„ã€‚ åœ¨æˆ‘çœ‹æ¥ï¼Œollamaæ˜¯llama.cppçš„ä¸€ä¸ªç²¾ç®€ä½†è¶³å¤Ÿæ™ºèƒ½çš„å°è£…ã€‚**å®ƒå¯¹ç»ˆç«¯ç”¨æˆ·éå¸¸å‹å¥½ï¼Œæä¾›äº†ç½‘ç»œæ¥å£å’Œ cliï¼Œä»¥ä¾¿è¿è¡Œå¤šä¸ªå¤§å‹è¯­è¨€æ¨¡å‹ (LLM) å¹¶ä¸ä¹‹äº¤äº’ã€‚**äº‹å®ä¸Šï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ˜¯ç”±llama.cppåŠ è½½å¹¶è¿è¡Œæ¨¡å‹ï¼Œè€Œollamaåªæ˜¯llama.cppçš„&quot;é¢†èˆªå‘˜&quot;ï¼ˆæ˜¯çš„ï¼Œæˆ‘ç”¨äº†ç†Ÿæ‚‰ç”Ÿæˆå¼äººå·¥æ™ºèƒ½çš„äººéƒ½ç†Ÿæ‚‰çš„ä¸€ä¸ªè¯ï¼‰ã€‚ç¨åä¼šå¯¹è¿™éƒ¨åˆ†å†…å®¹è¿›è¡Œè®¨è®ºã€‚ è¿™ç¯‡æ–‡ç« å‡å®šä½ èƒ½å¤Ÿé˜…è¯» golang ä»£ç æˆ–å…¶ä»–ç±»ä¼¼ C è¯­è¨€çš„ä»£ç ã€‚å¯¹äºä»£ç ä¸­çš„å…³é”®ç‚¹ï¼Œæˆ‘ä¼šç»™å‡ºä¸€äº›ç®€çŸ­çš„æè¿°æˆ–ç±»æ¯”ï¼Œä»¥ä¾¿å¸®åŠ©æ›´å¥½åœ°ç†è§£ã€‚ åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†é¦–å…ˆä»‹ç»ollamaçš„é¡¹ç›®ç»“æ„ã€‚ç„¶åï¼Œå°†ä»‹ç»å›´ç»•llama.cppçš„æ ¸å¿ƒæ¶æ„å’Œå®ç°ï¼Œä»¥åŠæ„å»ºç³»ç»Ÿã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘å°†ä»‹ç»ollamaå¦‚ä½•é€‰æ‹©è¿è¡Œ LLM çš„è®¾å¤‡ï¼ˆä¸€èˆ¬æŒ‡ç¡¬ä»¶ï¼‰ã€‚æœ€åï¼Œå°†ä»‹ç» Web æœåŠ¡ã€å®¢æˆ·ç«¯å’Œå®ç”¨ç¨‹åºä»¥åŠå…¶ä»–éƒ¨åˆ†ï¼Œä½œä¸ºæœ¬ç¯‡æ–‡ç« çš„ç»“æŸã€‚ é¡¹ç›®ç»“æ„ ä½ å¯ä»¥åœ¨ GitHub ä¸Šè·å– ollama çš„æºä»£ç ã€‚è¯¥é¡¹ç›®ä¸»è¦ä½¿ç”¨ Golang ç¼–å†™ï¼Œä¸‹è¡¨æ˜¯æ¯ä¸ªç›®å½•çš„ç®€è¦è¯´æ˜ï¼š ç›®å½•åç§° æè¿° api Go ç¼–å†™çš„çš„å®¢æˆ·ç«¯ API åº“ app æ¡Œé¢åº”ç”¨ç¨‹åºï¼ˆä¸»è¦æ˜¯ä¸€ä¸ªæ‰˜ç›˜ï¼‰ auth éªŒè¯ cmd å‘½ä»¤å’Œç›¸å…³çš„å¤„ç†ç¨‹åº docs æ–‡æ¡£ examples ä½¿ç”¨ ollama çš„ç¤ºä¾‹ format ç”¨äºå•ä½å’Œæ—¶é—´çš„æ ¼å¼å¤„ç†çš„å·¥å…· gpu GPU å’ŒåŠ é€Ÿè®¾å¤‡çš„æ£€æµ‹ llm ç”¨äºè¿è¡Œ llama.cpp çš„å®ç° macapp Mac æ¡Œé¢åº”ç”¨ç¨‹åº openai ç”¨äº ollama çš„ OpenAI API å…¼å®¹å°è£… parser æ¨¡å‹ä¿¡æ¯å’Œæ¶ˆæ¯çš„è§£æå™¨ progress æ˜¾ç¤ºåŠ è½½è¿›åº¦çš„å®ç”¨ç¨‹åº readline ä»ç»ˆç«¯è¯»å–è¾“å…¥çš„å®ç”¨ç¨‹åº scripts ç”¨äºæ„å»ºå’Œå‘å¸ƒçš„è„šæœ¬ server Go ç¼–å†™çš„ Web æœåŠ¡å®ç° version ç‰ˆæœ¬ä¿¡æ¯ è¯·æ³¨æ„ï¼Œç”±äºé¡¹ç›®æ­£åœ¨å¼€å‘ä¸­ï¼Œè¿™äº›ç›®å½•å¯èƒ½éšæ—¶è¢«æ›´æ”¹ã€‚ å¹•åè‹±é›„ï¼šllama.cpp è®©æˆ‘ä»¬å…ˆæ¥ä»‹ç»ä¸€ä¸‹åœ¨ ollama ä¸­è¿è¡Œ LLM çš„æ ¸å¿ƒ llama.cppã€‚ llama.cpp ä½œä¸º git å­æ¨¡å—åŒ…å«åœ¨ ollama ä¸­ã€‚æ‚¨å¯ä»¥åœ¨ llm ç›®å½•ä¸­æ‰¾åˆ°å®ƒã€‚åœ¨åŒä¸€ç›®å½•ä¸‹è¿˜æœ‰å›´ç»•å®ƒæ‰€éœ€çš„æ–‡ä»¶ï¼Œç¨åæˆ‘ä»¬å°†è¯¦ç»†ä»‹ç»å®ƒä»¬ã€‚ llama.cpp é¡¹ç›®æœ¬èº«æ˜¯ä¸€ä¸ªå¼€æºåº“ï¼Œæœ€å¼€å§‹æ˜¯ç”¨äºæ¨æ–­çº¯ C/C++ çš„ Meta LLaMA æ¨¡å‹ã€‚å®ƒåæ¥è¢«æ‰©å±•ç”¨äºè¿è¡Œæ›´å¤šæ¨¡å‹ï¼Œæ¯”å¦‚ Mistral å’Œ Google Gemmaï¼ˆæœ€è¿‘æ‰æ”¯æŒï¼‰ã€‚å®ƒåˆ©ç”¨åŒä¸€ä½œè€…åˆ›å»ºçš„å¦ä¸€ä¸ªé¡¹ç›® ggml çš„åŠŸèƒ½ï¼Œå¯åœ¨ä¸åŒå¹³å°ä¸ŠåŸç”Ÿè¿è¡Œï¼ˆä¸ Python é¡¹ç›®ç›¸æ¯”ï¼‰ã€‚ æ”¯æŒçš„åç«¯ ç›®å‰ï¼Œllama.cpp é€šè¿‡ ggml æ”¯æŒçš„ä¸€äº›æ¨ç†åç«¯å¦‚ä¸‹ï¼š llama.cppå¯è¿è¡Œ x86 ä¸Šçš„ AVXã€AVX2 å’Œ AVX512ï¼Œæˆ– ARM ä¸Šçš„ NEONã€‚ é€šè¿‡ MPIï¼ˆå¦‚ MPICH å’Œ OpenMPIï¼‰ï¼Œggml å¯ä»¥åœ¨ CPU æˆ– CPU é›†ç¾¤ä¸Šè¿è¡Œæ¨¡å‹ã€‚ Apple Metalé›†æˆæ”¯æŒmacOSå’ŒiOSä¸Šçš„GPUï¼ŒåŒ…æ‹¬Macä¸Šçš„GPUå’ŒiOSè®¾å¤‡æˆ–Apple Silicon Macä¸Šçš„Appleåˆ¶é€ çš„GPUã€‚ åŸºäºBLASæ¶æ„çš„ggmlä½¿ç”¨äº†ä¸€ä¸ªå¤è€çš„å¼€æ”¾æ ‡å‡†OpenCLã€‚ cuBLAS &quot;æ”¯æŒè‹±ä¼Ÿè¾¾â„¢ï¼ˆNVIDIAÂ®ï¼‰å…¬å¸çš„GPUã€‚ æœ€è¿‘çš„AMD GPUé€šè¿‡hipBLASæ”¯æŒï¼Œå®ƒæ˜¯AMD ROCmçš„ä¸€éƒ¨åˆ†ï¼Œä¸cuBLASçš„åº”ç”¨ç¨‹åºæ¥å£å‡ ä¹ç›¸åŒã€‚ æœ€è¿‘å¼•èµ·æˆ‘æ³¨æ„çš„æ˜¯ llama.cpp ä¸­çš„ Vulkan æ”¯æŒã€‚è¿™é¡¹ï¼ˆæœ‰äº›æ¼æ´ï¼‰æ”¯æŒæœ€åˆæ˜¯ç”± Nomic é€šè¿‡å…¶ kompute æ¡†æ¶å¯åŠ¨çš„ã€‚æœ€è¿‘çš„è¿›å±•æ˜¯åœ¨ ggml ä¸­ç›´æ¥ä½¿ç”¨ Vulkan åº“çš„å®ç°ã€‚ è¿™äº›åç«¯å…è®¸å¼€å‘äººå‘˜è¿è¡Œå¯åœ¨ä»å°å¼ç”µè„‘åˆ°æ™ºèƒ½æ‰‹æœºç­‰å¤šä¸ªå¹³å°ä¸Šè¿è¡Œçš„ LLMã€‚æ­¤å¤–ï¼Œllama.cpp è¿˜ä¸º Linuxï¼ˆåŒ…æ‹¬ Android Linuxï¼‰ã€Windowsã€macOS å’Œå…¶ä»–å„ç§æ“ä½œç³»ç»Ÿï¼ˆå¦‚ iOSï¼Œå‚è§ whispher.cpp on iOSï¼‰ç”šè‡³ WebAssemblyï¼ˆwhispher.wasmï¼‰æä¾›åŸç”Ÿæ”¯æŒã€‚ å› æ­¤ï¼Œollama åœ¨è¯ç”Ÿä¹‹åˆå°±åº”æ”¯æŒå„ç§å¹³å°å’Œæ“ä½œç³»ç»Ÿã€‚ æ„å»ºç³»ç»Ÿ æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹æ„å»ºç³»ç»Ÿï¼Œäº†è§£ ollama å¦‚ä½•ä¸ llama.cpp åä½œã€‚ C æˆ– C++ é¡¹ç›®é€šå¸¸ä½¿ç”¨ cmakeï¼ˆå°½ç®¡ç°åœ¨æœ‰äº†æ›´å¤šé€‰æ‹©ï¼‰æ¥å¤„ç†ç¼–è¯‘ã€é“¾æ¥ç­‰å·¥ä½œã€‚llama.cpp ä¹Ÿæ˜¯å¦‚æ­¤ï¼šå®ƒä½¿ç”¨ç¼–è¯‘å®šä¹‰ï¼ˆæˆ–è€…è¯´ flagï¼‰æ¥åˆ©ç”¨ä¸åŒçš„åç«¯ã€‚ä¾‹å¦‚ LLAMA_AVXã€LLAMA_AVX2ã€LLAMA_AVX512ç”¨äºæ”¯æŒ AVXï¼› ç”¨äº Apple Metal æ”¯æŒçš„ LLAMA_METALï¼› ç”¨äº NVIDIA CUDA æ”¯æŒçš„ LLAMA_CUBLASï¼› ä»¥åŠ LLAMA_HIPBLAS ç”¨äº AMD ROCm æ”¯æŒã€‚ ä¸è¿‡ï¼Œollama æœ¬èº«æ˜¯ä¸€ä¸ª go é¡¹ç›®ï¼Œåˆ©ç”¨çš„æ˜¯ go æä¾›çš„æ„å»ºç³»ç»Ÿã€‚è¿™ä¸¤ä¸ªæ„å»ºç³»ç»Ÿå…±å­˜ï¼Œä»¥æ„å»ºä¸åŒçš„éƒ¨åˆ†ï¼š cmake ç”¨ ollama.cpp ä¸­çš„ä¸€äº›æ–‡ä»¶æ„å»º llama.cppï¼Œä»¥è¿›è¡Œâ€œé¢†èˆªâ€å¹¶æä¾›æ¥å£ï¼› go æ„å»ºç³»ç»Ÿç¼–è¯‘ã€é“¾æ¥å’Œæ‰“åŒ…å…¶ä½™éƒ¨åˆ†ï¼Œä»¥ç”Ÿæˆ ollama çš„åº”ç”¨ç¨‹åºå’Œ cliã€‚ é™¤äº†çº¯ go ä»£ç ï¼Œgo ç¼–è¯‘ç³»ç»Ÿè¿˜éœ€è¦ cgo æ¥ç¼–è¯‘ä¸€äº› C è¯­è¨€ä»£ç ã€‚åœ¨ llm ç›®å½•ï¼ˆç”¨äºåŠ è½½å’Œæä¾›æ¥å£çš„ dyn_ext_server.c æ–‡ä»¶ï¼‰å’Œ gpu ç›®å½•ï¼ˆç”¨äºæ£€æµ‹ GPU çš„ C æˆ– Objective-C å®ç° gpu_info_cuda.cã€gpu_info_rocm.c å’Œ gpu_info_darwin.mï¼‰ä¸­æœ‰ä¸€äº›ä¾‹å­ã€‚ é€šè¿‡åˆ©ç”¨ go generateï¼Œollama ä¸­çš„ go ç¼–è¯‘ç³»ç»Ÿè¿˜å¯ä»¥è¿è¡Œè°ƒç”¨ cmake çš„å‘½ä»¤æ¥æ„å»º llama.cppã€‚è¿™é¡¹å·¥ä½œä½äº llm/generate ç›®å½•ä¸­ï¼Œä¾‹å¦‚åœ¨ Linux ä¸Šï¼š 123package generate//go:generate bash ./gen_linux.sh llm/generate/generate_darwin.go å‘Šè¯‰ go generate è¿è¡Œ gen_linux.sh è„šæœ¬æ¥æ„å»º llama.cpp çš„éƒ¨åˆ†ã€‚ ä¸€äº›é€‚ç”¨äºä¸åŒå¹³å°çš„è„šæœ¬ ç›®å‰æœ‰ gen_common.shã€gen_linux.sh å’Œ gen_darwin.shï¼Œç”¨äºåœ¨ç±» Unix æ“ä½œç³»ç»Ÿï¼ˆå¦‚ macOS å’Œ Linuxï¼‰ä¸Šä¸º ollama åˆ›å»º llama.cppã€‚åŒæ—¶ï¼Œåœ¨ Windows ä¸Šä½¿ç”¨çš„æ˜¯ gen_windows.ps1 PowerShell è„šæœ¬ã€‚ è®©æˆ‘ä»¬ä»¥åœ¨ Linux ä¸Šæ„å»ºæ”¯æŒ AVX çš„ llama.cpp ä¸ºä¾‹ï¼š 123456init_varsCMAKE_DEFS=\"$&#123;COMMON_CPU_DEFS&#125; -DLLAMA_AVX=on -DLLAMA_AVX2=off -DLLAMA_AVX512=off -DLLAMA_FMA=off -DLLAMA_F16C=off $&#123;CMAKE_DEFS&#125;\"BUILD_DIR=\"$&#123;LLAMACPP_DIR&#125;/build/linux/$&#123;ARCH&#125;/cpu_avx\"echo \"Building AVX CPU\"buildcompress_libs å‰ä¸‰è¡Œåˆå§‹åŒ–å˜é‡ï¼Œä¸ºç¼–è¯‘åšå‡†å¤‡ã€‚init_vars è°ƒç”¨äº† gen_common.sh ä¸­çš„ä¸€ä¸ªå­ç¨‹åºæ¥å‡†å¤‡å¸¸ç”¨å˜é‡ï¼Œä¾‹å¦‚ 12CMAKE_DEFS=\"\"CMAKE_TARGETS=\"--target ext_server\" å…¶ä¸­ CMAKE_TARGETS å°†æŠŠæ„å»ºç›®æ ‡è®¾ç½®ä¸º ext_serverã€‚è¯¥ç›®æ ‡æ˜¯ä¸€ä¸ªåº“ï¼Œç”¨äºä» llama.cpp ä¸º ollama æä¾›æ¥å£å’Œå‡½æ•°ï¼Œæˆ‘ä»¬å°†åœ¨ä¸‹ä¸€èŠ‚è®¨è®ºå®ƒã€‚ åœ¨ CMAKE_DEFS ä¸­ï¼Œåªæœ‰ LLAMA_AVX æ˜¯å¯ç”¨çš„ã€‚è€Œ COMMON_CPU_DEFS çš„å®šä¹‰å¦‚ä¸‹ï¼Œä»¥æ„å»ºç‹¬ç«‹äºä½ç½®ä»£ç çš„åŠ¨æ€åº“ï¼ˆå¯¹äº gccï¼Œå®ƒå°†è¢«è½¬æ¢ä¸º -fpic æ ‡å¿—ï¼‰ï¼š 1COMMON_CPU_DEFS=\"-DCMAKE_POSITION_INDEPENDENT_CODE=on -DLLAMA_NATIVE=off\" å®ƒåœ¨ç»ˆç«¯è¾“å‡º â€œBuilding AVX CPUâ€ ä¹‹åï¼Œç”± build å­ç¨‹åºè°ƒç”¨ cmakeï¼š 12345678910111213build() &#123; cmake -S $&#123;LLAMACPP_DIR&#125; -B $&#123;BUILD_DIR&#125; $&#123;CMAKE_DEFS&#125; cmake --build $&#123;BUILD_DIR&#125; $&#123;CMAKE_TARGETS&#125; -j8 mkdir -p $&#123;BUILD_DIR&#125;/lib/ g++ -fPIC -g -shared -o $&#123;BUILD_DIR&#125;/lib/libext_server.$&#123;LIB_EXT&#125; \\ $&#123;GCC_ARCH&#125; \\ $&#123;WHOLE_ARCHIVE&#125; $&#123;BUILD_DIR&#125;/examples/server/libext_server.a $&#123;NO_WHOLE_ARCHIVE&#125; \\ $&#123;BUILD_DIR&#125;/common/libcommon.a \\ $&#123;BUILD_DIR&#125;/libllama.a \\ -Wl,-rpath,\\$ORIGIN \\ -lpthread -ldl -lm \\ $&#123;EXTRA_LIBS&#125;&#125; é€šè¿‡ cmake ç¼–è¯‘åï¼Œå®ƒå°†ç”Ÿæˆä¸€ä¸ª libext_server åŠ¨æ€é“¾æ¥åº“ï¼ˆWindows ä¸‹ä¸º .dllï¼ŒLinux/BSD ä¸‹ä¸º .soï¼ŒmacOS ä¸‹ä¸º .dylibï¼‰ã€‚è¯¥åº“åŒ…å« llama.cpp ä¸‹ examples/server çš„ç¼–è¯‘ä»£ç ï¼ˆexamples/server/libext_server.aï¼‰ã€å‘½ä»¤ä»£ç å’Œ llama.cpp çš„æ ¸å¿ƒä»£ç â€”â€” common/libcommoa.a å’Œ libllama.aã€‚å®ƒä»¬å°†ä½œä¸ºå¯æ‰§è¡Œæ–‡ä»¶çš„&quot;è½½è·&quot;åµŒå…¥ä¸» go ç¨‹åºï¼Œä»¥æ–¹ä¾¿åˆ†å‘ã€‚ æœ€åï¼Œå®ƒä¼šå‹ç¼©è½½è·ï¼Œä½¿å¯æ‰§è¡Œæ–‡ä»¶æ›´å°ï¼š 1234567891011121314compress_libs() &#123; echo \"Compressing payloads to reduce overall binary size...\" pids=\"\" rm -rf $&#123;BUILD_DIR&#125;/lib/*.$&#123;LIB_EXT&#125;*.gz for lib in $&#123;BUILD_DIR&#125;/lib/*.$&#123;LIB_EXT&#125;* ; do gzip --best -f $&#123;lib&#125; &amp; pids+=\" $!\" done echo for pid in $&#123;pids&#125;; do wait $pid done echo \"Finished compression\"&#125; åŠ¨æ€é“¾æ¥åº“æœ€ç»ˆå°†ä½äºæ„å»ºæ–‡ä»¶å¤¹ä¸­çš„ â€œcpu_avxâ€ ç›®å½•ä¸‹ã€‚å¦‚æœä¸ºå…¶ä»–å˜ä½“ï¼ˆå¦‚ GPUï¼‰æ„å»ºï¼Œå®ƒä»¬å°†ä½äºæ„å»ºæ–‡ä»¶å¤¹ä¸­çš„ä¸åŒç›®å½•ä¸‹ã€‚ ä¸º llama.cpp é¢†èˆª ç„¶åï¼Œè®©æˆ‘ä»¬å›åˆ° llm ç›®å½•ï¼Œçœ‹çœ‹ ollama ä¸­å»ºç«‹åœ¨ llama.cpp åŸºç¡€ä¸Šçš„å®ç°ã€‚å¯¹äº ollama æ¥è¯´ï¼Œå¼•å¯¼ llama.cpp çš„æœ€é‡è¦éƒ¨åˆ†æ˜¯ï¼š åœ¨ ext_server ä¸­ï¼ŒåŒ…è£…å™¨å®ç°æä¾›äº† ollama å¯ä»¥è°ƒç”¨çš„å‡½æ•°ï¼Œä¾‹å¦‚ llama_server_init æ¥åˆå§‹åŒ–ä¸€ä¸ª llama.cpp å®ä¾‹ï¼Œllama_server_completion æ¥å®Œæˆä¸€æ¬¡èŠå¤©ï¼Œæˆ–è€… llama_server_embedding æ¥è®¡ç®—æ–‡æœ¬çš„åµŒå…¥ã€‚ ext_server ä¸­è¿˜åŒ…å«ä¸€ä¸ªé¢å¤–çš„ makefile (CMakeLists)ï¼Œç”¨äºå°† llama.cpp/examples/server ç¤ºä¾‹ä½œä¸ºåº“æ¥æ„å»ºä»£ç ã€‚ç„¶åï¼Œå®ƒå¯ä»¥è¢« llm ä¸‹çš„ dyn_ext_server ä»£ç åŠ è½½ï¼Œä¸ llama.cpp å®ä¾‹ä¸€èµ·æä¾›æœåŠ¡ã€‚ ä½¿ç”¨ go embed package å°†åº“åµŒå…¥ go ç¨‹åºï¼Œå¹¶åœ¨è¿è¡Œæ—¶æå–ã€‚ æ­¤å¤–ï¼Œè°ƒç”¨ ext_server ä¸­çš„å‡½æ•°æ—¶ä¼šæºå¸¦ llm ç›®å½•ä¸­å®šä¹‰çš„ä¸€äº›å‚æ•°ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œè¯·æ±‚å’Œå“åº”éƒ½ä»¥ JSON æ ¼å¼ä¼ é€’ï¼Œå¹¶åŒ…å«æ›´å¤šç»“æ„ä¿¡æ¯ã€‚å®ƒä»¬å®šä¹‰åœ¨ ggml.goï¼ˆæè¿°æ¨¡å‹ï¼‰å’Œ llama.goï¼ˆæè¿°ä¸åŒçš„è¯·æ±‚å’Œå“åº”ï¼‰ä¸­ã€‚ ä¸ºäº†åŠ¨æ€ç®¡ç† llama.cpp å®ä¾‹ï¼Œollama ä¸ºåŸå§‹çš„ llama.cpp æä¾›äº†ä¸€äº›è¡¥ä¸ã€‚ è®©æˆ‘ä»¬é€ä¸€ç ”ç©¶å®ƒä»¬ã€‚ 1. å¤–éƒ¨æœåŠ¡å™¨ æˆ‘ä»¬é¦–å…ˆæ¥çœ‹çœ‹ ext_serverã€‚æˆ‘ä»¬å·²ç»çŸ¥é“ï¼ŒåŠ¨æ€åº“æ˜¯åœ¨ç”Ÿæˆè¿‡ç¨‹ä¸­æ„å»ºçš„ã€‚ä½†å¦‚ä½•ä½¿ç”¨å®ƒä»¬å‘¢ï¼Ÿ åœ¨ llm/dyn_ext_server.go ä¸­ï¼ŒnewDynExtServer è´Ÿè´£åŠ è½½åŠ¨æ€åº“ã€åˆå§‹åŒ– llama.cpp å®ä¾‹å¹¶å¯åŠ¨äº‹ä»¶å¾ªç¯ä»¥æ¥æ”¶ä»»ä½•è¯·æ±‚å¹¶ç”Ÿæˆå“åº”ã€‚ åŠ¨æ€é“¾æ¥åº“çš„åŠ è½½å’ŒæœåŠ¡å™¨çš„å¯åŠ¨ åœ¨ newDynExtServer ä¸­ï¼Œgo å‡½æ•°ä¼šè°ƒç”¨ä¸€ä¸ªä»¥ dyn_init å‘½åçš„ C å‡½æ•°æ¥åŠ è½½åŠ¨æ€åº“ã€‚æè¿°å’Œæ‰€éœ€å‡½æ•°è¢«åŠ è½½åˆ° struct_dynamic_llama_server æè¿°ä¸­ï¼Œå¹¶å°è£…åœ¨ dynExtServerï¼ˆä¸€ä¸ª go ç»“æ„ï¼‰ä¸­ã€‚ ç„¶åï¼Œå®ƒä»¬ä¼šè¢«ç”¨äºå¦ä¸€ä¸ª C å‡½æ•° dyn_llama_server_initï¼Œå…¶ä¸­åŒ…å«è¿è¡Œ llama.cpp æœåŠ¡å™¨çš„å‚æ•°ï¼Œç”¨äºæœåŠ¡å™¨å®ä¾‹åˆå§‹åŒ–ã€‚ å¦‚æœæ²¡æœ‰é—®é¢˜ï¼ŒnewDynExtServer å°†è°ƒç”¨åˆå§‹åŒ–è¿‡ç¨‹ä¸­çš„æœ€åä¸€ä¸ª C å‡½æ•° dyn_llama_server_startã€‚æœåŠ¡å™¨å°†å¼€å§‹è¿è¡Œï¼Œå¹¶èƒ½æ¥æ”¶æ¥è‡ª ollama çš„è¯·æ±‚ã€‚ ä¸Šè¿° C å‡½æ•°ä½äº llm/dyn_ext_server.c ä¸­ï¼Œå¹¶åœ¨ llm/dyn_ext_server.h ä¸­å£°æ˜ã€‚è®©æˆ‘ä»¬å¿«é€Ÿäº†è§£ä¸€ä¸‹ dyn_initï¼š 12void dyn_init(const char *libPath, struct dynamic_llama_server *s, ext_server_resp_t *err); å®ƒæ¥æ”¶åº“è·¯å¾„ libPath ä½œä¸ºå‚æ•°ï¼Œå¹¶é€šè¿‡ C æŒ‡é’ˆï¼ˆå¯¹äºä¸ç†Ÿæ‚‰ C çš„äººæ¥è¯´å°±æ˜¯å†…å­˜åœ°å€ï¼Œgo èƒ½å¤Ÿåƒ go ç»“æ„ä½“ä¸€æ ·å¤„ç†å®ƒä»¬ï¼Œå­˜å‚¨å®ƒä»¬å¹¶ä¼ é€’ç»™å…¶ä»– C å‡½æ•°ï¼‰è¿”å›ä¸€ä¸ª dynamic_llama_server å®ä¾‹æˆ–ä¸€ä¸ªé”™è¯¯ã€‚ dynamic_llama_server ç»“æ„èƒ½å¤Ÿå­˜å‚¨å¿…è¦çš„ C å‡½æ•°åœ°å€ï¼Œä»¥åŠåŠ è½½çš„åŠ¨æ€é“¾æ¥åº“çš„å¼•ç”¨ã€‚å…¶å®šä¹‰å¦‚ä¸‹ï¼š 123456789101112131415161718192021struct dynamic_llama_server &#123; void *handle; void (*llama_server_init)(ext_server_params_t *sparams, ext_server_resp_t *err); void (*llama_server_start)(); void (*llama_server_stop)(); void (*llama_server_completion)(const char *json_req, ext_server_resp_t *resp); void (*llama_server_completion_next_result)(const int task_id, ext_server_task_result_t *result); void (*llama_server_completion_cancel)(const int task_id, ext_server_resp_t *err); void (*llama_server_release_task_result)(ext_server_task_result_t *result); void (*llama_server_tokenize)(const char *json_req, char **json_resp, ext_server_resp_t *err); void (*llama_server_detokenize)(const char *json_req, char **json_resp, ext_server_resp_t *err); void (*llama_server_embedding)(const char *json_req, char **json_resp, ext_server_resp_t *err); void (*llama_server_release_json_resp)(char **json_resp);&#125;; dyn_init çš„æ ¸å¿ƒåŠŸèƒ½æ˜¯åŠ è½½ç”± libPath æŒ‡ç¤ºçš„åŠ¨æ€é“¾æ¥åº“ï¼Œè¯»å–ç¬¦å·è¡¨ï¼Œæ‰¾åˆ°æ‰€éœ€çš„ C å‡½æ•°åœ°å€ï¼Œå¹¶å°†å…¶å­˜å‚¨åˆ° dynamic_llama_server ç»“æ„çš„å®ä¾‹ä¸­ã€‚libPath å¯ä»¥æ˜¯ä»¥ libext_server ä¸ºå‰ç¼€çš„å·²æ„å»ºåŠ¨æ€é“¾æ¥åº“çš„è·¯å¾„ã€‚è¿™æ ·ï¼ŒåŸºäº llama.cpp çš„å†…ç½®åº“å°±å¯ä»¥è¢« ollama ä½¿ç”¨ã€‚ åŠ è½½åï¼Œå¯¹ dyn_llama_server_start å’Œ dyn_llama_server_start çš„è°ƒç”¨å®é™…ä¸Šæ˜¯ç›´æ¥è°ƒç”¨åŠ¨æ€åº“ä¸­çš„ C å‡½æ•°ï¼š 123456789inline void dyn_llama_server_init(struct dynamic_llama_server s, ext_server_params_t *sparams, ext_server_resp_t *err) &#123; s.llama_server_init(sparams, err);&#125;inline void dyn_llama_server_start(struct dynamic_llama_server s) &#123; s.llama_server_start();&#125; è°ƒç”¨ dyn_llama_server_start åï¼Œä»åŠ¨æ€åº“åˆ›å»ºçš„ llama.cpp æœåŠ¡å™¨å°±å¯ä»¥è¿›è¡Œé¢„æµ‹äº†ã€‚ é¢„æµ‹ å½“ ollama æ”¶åˆ°é¢„æµ‹è¯·æ±‚æ—¶ï¼Œå®ƒä¼šè°ƒç”¨ dynExtServer å®ä¾‹ä¸Šçš„ Predictã€‚è¯¥å‡½æ•°èƒ½å¤Ÿæ ¼å¼åŒ–è¯·æ±‚ï¼ˆç¨åä¼šçœ‹åˆ°ï¼‰ï¼Œå¹¶è°ƒç”¨ C å‡½æ•° dyn_llama_server_completion å¼€å§‹é¢„æµ‹ï¼š 12345inline void dyn_llama_server_completion(struct dynamic_llama_server s, const char *json_req, ext_server_resp_t *resp) &#123; s.llama_server_completion(json_req, resp);&#125; æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œå®ƒä¹Ÿæ˜¯ç›´æ¥è°ƒç”¨ä»æ„å»ºåœ¨ llama.cpp ä¸Šçš„åŠ¨æ€åº“ä¸­åŠ è½½çš„å‡½æ•°ã€‚ ç”±äºåœ¨ Predict å‡½æ•°ä¸­ä½¿ç”¨äº† fn func(PredictResult)å‚æ•°ï¼Œè¿™éƒ¨åˆ†çš„ä¸€ä¸ªéå¸¸å¥½çš„è®¾è®¡å°±æ˜¯æµå¼å“åº”ã€‚è¿™æ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå¯ä»¥åœ¨æ”¶åˆ°å“åº”åç«‹å³è¿ç»­å‘é€ï¼š 12345if p.Content != \"\" &#123; fn(PredictResult&#123; Content: p.Content, &#125;)&#125; å®ƒè¿˜ä¾èµ–äºå¯¹ dyn_llama_server_completion_next_result çš„ä¾¿æ·è°ƒç”¨ï¼ˆå°½ç®¡å®ƒä¹Ÿæ˜¯ç›´æ¥è°ƒç”¨åŸºäº llama.cpp çš„åŠ¨æ€åº“ä¸­åŠ è½½çš„ C å‡½æ•° llama_server_completion_next_resultï¼‰ã€‚ å…¶ä»– å…¶ä»–è°ƒç”¨ä¹Ÿç±»ä¼¼ã€‚æ‚¨å¯ä»¥åœ¨ llm/dyn_ext_server.go å’Œ llm/dyn_ext_server.c ä¸­æ‰¾åˆ°å®ƒä»¬ï¼Œä¾‹å¦‚ dyn_llama_server_tokenize, dyn_llama_server_detokenize ç”¨äº token åŒ–æˆ–å» token åŒ–ï¼Œä»¥åŠ dyn_llama_server_embedding ç”¨äºè®¡ç®—åµŒå…¥ï¼ˆembeddingï¼‰ã€‚ 2. llama.cpp ä½œä¸º ollama çš„æœåŠ¡å™¨ æ¥ä¸‹æ¥è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ C éƒ¨åˆ†ï¼šollama è¯´å¦‚ä½•ä½¿ç”¨ llama.cpp ä½œä¸º LLM æœåŠ¡å™¨çš„ã€‚ åœ¨ llm/dyn_ext_server.go çš„å¼€å¤´ï¼Œcgo çš„æ³¨é‡Šä¸­æœ‰ä¸€äº›æ„å»ºæ³¨é‡Šï¼š 123456789101112131415161718/*#cgo CFLAGS: -I$&#123;SRCDIR&#125;/ext_server -I$&#123;SRCDIR&#125;/llama.cpp -I$&#123;SRCDIR&#125;/llama.cpp/common -I$&#123;SRCDIR&#125;/llama.cpp/examples/server#cgo CFLAGS: -DNDEBUG -DLLAMA_SERVER_LIBRARY=1 -D_XOPEN_SOURCE=600 -DACCELERATE_NEW_LAPACK -DACCELERATE_LAPACK_ILP64#cgo CFLAGS: -Wmissing-noreturn -Wextra -Wcast-qual -Wno-unused-function -Wno-array-bounds#cgo CPPFLAGS: -Ofast -Wextra -Wno-unused-function -Wno-unused-variable -Wno-deprecated-declarations#cgo darwin CFLAGS: -D_DARWIN_C_SOURCE#cgo darwin CPPFLAGS: -DGGML_USE_ACCELERATE#cgo darwin CPPFLAGS: -DGGML_USE_METAL -DGGML_METAL_NDEBUG#cgo darwin LDFLAGS: -lc++ -framework Accelerate#cgo darwin LDFLAGS: -framework Foundation -framework Metal -framework MetalKit -framework MetalPerformanceShaders#cgo linux CFLAGS: -D_GNU_SOURCE#cgo linux LDFLAGS: -lrt -ldl -lstdc++ -lm#cgo linux windows LDFLAGS: -lpthread#include &lt;stdlib.h&gt;#include \"dyn_ext_server.h\"*/ å®ƒä»¬å¯ä»¥ä¸ºä¸åŒçš„å¹³å°è®¾ç½®ä¸åŒçš„ç¼–è¯‘å’Œé“¾æ¥æ ‡å¿—ï¼ˆdarwin ç”¨äº macOSï¼Œå½“ç„¶ linux ç”¨äº Linuxï¼Œè€Œ windows ç”¨äº Windowsï¼‰ã€‚è¿™æ ·ï¼Œcgo å°±èƒ½æ‰¾åˆ° C å¤´æ–‡ä»¶ï¼ˆç°æœ‰ç±»å‹å’Œå‡½æ•°çš„å£°æ˜ï¼‰ï¼Œå°† llm/dyn_ext_server.c ä¸ go éƒ¨åˆ†ç¼–è¯‘å’Œé“¾æ¥ã€‚ ç„¶åï¼Œè®©æˆ‘ä»¬ä»åŠ¨æ€åº“ä¸­æŸ¥çœ‹ ollama ä¸­ä½¿ç”¨çš„ C å‡½æ•°ã€‚ä½œä¸ºä¸¤ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬ä» llama_server_init å’Œ llama_server_start å¼€å§‹ã€‚ å®ƒä»¬çš„å®ç°ä½äº llm/ext_server/ext_server.cppï¼Œåœ¨ llm/ext_server/CMakeLists.txtä¸­è¢«è®¾ç½®ä¸ºä»¥ ext_server å‘½åçš„ç›®æ ‡åº“ã€‚åœ¨æ„å»ºç›®æ ‡æ—¶ï¼Œè¯¥æ–‡ä»¶å°†ä¸ llama.cpp ç¤ºä¾‹æœåŠ¡å™¨ä¸€èµ·ç¼–è¯‘ã€‚ç¼–è¯‘ç»“æœå°±æ˜¯æˆ‘ä»¬æåˆ°çš„åŠ¨æ€é“¾æ¥åº“ä¹‹ä¸€ã€‚ å› æ­¤ï¼Œext_server.cpp ä¸­çš„ C å‡½æ•°å¯ä»¥ä» ollama ä¸­è°ƒç”¨ï¼Œå¹¶èƒ½åˆ©ç”¨ llama.cpp ä¸­çš„å‡½æ•°ã€‚å®ƒå®é™…ä¸Šæ˜¯ä¸¤ä¸ªé¡¹ç›®ä¹‹é—´çš„æ¡¥æ¢ï¼Œä½¿ llama.cpp ä¸­çš„ç¤ºä¾‹æœåŠ¡å™¨æˆä¸º ollama çš„ LLM æœåŠ¡å™¨ï¼ˆæˆ–ç§° llama æœåŠ¡å™¨ï¼‰ã€‚ åœ¨åˆå§‹åŒ–è¿‡ç¨‹ä¸­ï¼Œllama_server_init ä¼šè§£æå‚æ•°ï¼Œä¸ºæœåŠ¡å™¨åˆ›å»ºä¸Šä¸‹æ–‡ï¼Œå¹¶è°ƒç”¨ llama.cpp æä¾›çš„å‡½æ•°ï¼š 1234567891011121314151617void llama_server_init(ext_server_params *sparams, ext_server_resp_t *err) &#123; /* ... */ llama = new llama_server_context; /* ... */ llama_backend_init(); llama_numa_init(params.numa); /* ... */ if (!llama-&gt;load_model(params)) &#123; // an error occurred that was not thrown err-&gt;id = -1; snprintf(err-&gt;msg, err-&gt;msg_len, \"error loading model %s\", params.model.c_str()); return; &#125; /* ... */ llama-&gt;initialize(); /* ... */&#125; ä¾‹å¦‚ï¼Œå®ƒä¼šè°ƒç”¨ llama_backend_init æ¥åˆå§‹åŒ–åç«¯ï¼ˆå¯ä»¥æ˜¯ AVXã€CUDA ç­‰ï¼‰ï¼Œè°ƒç”¨ llama_numa_init æ¥åˆå§‹åŒ– NUMAï¼ˆå¦‚æœå­˜åœ¨ï¼‰ã€‚ç„¶åï¼Œå®ƒä¼šè°ƒç”¨æœåŠ¡å™¨ä¸Šä¸‹æ–‡ä¸­çš„ load_model å‡½æ•°ï¼Œä½¿ç”¨ç»™å®šå‚æ•°åŠ è½½æ¨¡å‹ï¼Œå¹¶ä½¿ç”¨ initialize å‡½æ•°å®Œæˆåˆå§‹åŒ–ã€‚ å¦‚æœå‡ºç°é”™è¯¯ï¼Œé”™è¯¯ä¿¡æ¯å°†è¢«æ ¼å¼åŒ–ä¸º err å‚æ•°è¿”å›ï¼Œå¹¶åœ¨ go éƒ¨åˆ†è¿›è¡Œå¤„ç†ã€‚ åŒæ—¶ï¼Œåœ¨ llama_server_start ä¸­ï¼š 123456789101112131415161718192021222324252627282930void llama_server_start() &#123; assert(llama != NULL); // TODO mutex to protect thread creation ext_server_thread = std::thread([&amp;]() &#123; try &#123; LOG_TEE(\"llama server main loop starting\\n\"); ggml_time_init(); llama-&gt;queue_tasks.on_new_task(std::bind( &amp;llama_server_context::process_single_task, llama, std::placeholders::_1)); llama-&gt;queue_tasks.on_finish_multitask(std::bind( &amp;llama_server_context::on_finish_multitask, llama, std::placeholders::_1)); llama-&gt;queue_tasks.on_all_tasks_finished(std::bind( &amp;llama_server_context::run_on_all_tasks_finished, llama)); llama-&gt;queue_results.on_multitask_update(std::bind( &amp;llama_server_queue::update_multitask, &amp;llama-&gt;queue_tasks, std::placeholders::_1, std::placeholders::_2, std::placeholders::_3 )); llama-&gt;queue_tasks.start_loop(); &#125; catch (std::exception &amp;e) &#123; LOG_TEE(\"caught exception in llama server main loop: %s\\n\", e.what()); &#125; catch (...) &#123; LOG_TEE(\"caught unknown exception in llama server main loop\\n\"); &#125; LOG_TEE(\"\\nllama server shutting down\\n\"); llama_backend_free(); &#125;);&#125; å®ƒä¸ºä»»åŠ¡å¤„ç†è®¾ç½®ä¸€äº›å›è°ƒï¼Œå¹¶åœ¨ä¸€ä¸ªæ–°çº¿ç¨‹ä¸­å¯åŠ¨ä¸€ä¸ªäº‹ä»¶å¾ªç¯ã€‚äº‹ä»¶å¾ªç¯è´Ÿè´£é¢„æµ‹ã€‚è¿™æ ·ï¼Œå¯¹ llama_server_start çš„è°ƒç”¨å°±ä¼šç«‹å³è¿”å›ã€‚ æ­¤ç±» C å‡½æ•°çš„æ›´è¯¦ç»†å®ç°å¯ä»¥åœ¨åŒä¸€æ–‡ä»¶ä¸­æ‰¾åˆ°ï¼Œå³ llm/ext_server/ext_server.cppã€‚ 3. å°†åº“ä½œä¸ºè½½è·åµŒå…¥ ç„¶åï¼Œè®©æˆ‘ä»¬æ¥æ¢ç©¶ä¸€ä¸‹è½½è·æ˜¯å¦‚ä½•å®Œæˆçš„ã€‚ åœ¨ä»¥ payload_* ä¸ºå‰ç¼€çš„ go æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° ollama çš„é€‰æ‹©ã€‚ä¾‹å¦‚ï¼Œåœ¨llm/payload_linux.goä¸­ï¼Œæœ‰ä¸¤è¡ŒåµŒå…¥äº†æ¯ä¸ªext_serveråº“çš„ä¸åŒå˜ä½“ï¼š 12//go:embed llama.cpp/build/linux/*/*/lib/*var libEmbed embed.FS llama.cpp/build/linux/*/*/lib/ ä¸‹çš„æ‰€æœ‰å†…ç½®åº“éƒ½ä½¿ç”¨ç±»æ–‡ä»¶ç³»ç»Ÿæ¥å£ä½œä¸ºè½½è·åµŒå…¥ã€‚è¿™æ ·ï¼Œollama å°±å¯ä»¥åƒåœ¨æ–‡ä»¶ç³»ç»Ÿä¸­è¯»å†™ä¸€æ ·è®¿é—®å®ƒä»¬ã€‚ åœ¨åˆå§‹åŒ– ollama çš„è¿‡ç¨‹ä¸­ï¼Œllm/payload_common.go ä¸­çš„ Init å°†è°ƒç”¨ nativeInitï¼š 123func Init() error &#123; return nativeInit()&#125; å®ƒçš„ä¸»è¦å·¥ä½œæ˜¯å°†åŠ¨æ€åº“ä»æ–‡ä»¶ç³»ç»Ÿæå–åˆ°ä¸´æ—¶ä½ç½®ï¼Œå¹¶æ£€æŸ¥é©±åŠ¨ç¨‹åºçš„è®¿é—®æƒé™ï¼ˆå¦‚é€‚ç”¨ï¼‰ï¼š 123libs, err := extractDynamicLibs(payloadsDir, \"llama.cpp/build/*/*/*/lib/*\")/* ... */err := verifyDriverAccess() æå–å®Œæˆåï¼Œollama å¯ä»¥æ ¼å¼åŒ–åº“è·¯å¾„ï¼ˆå¤–éƒ¨æœåŠ¡å™¨å°èŠ‚ä¸­çš„ dyn_init å‡½æ•°ä¸­ä½¿ç”¨çš„ libPathï¼‰ã€‚é€‰æ‹©è¿è¡Œç¯å¢ƒå’ŒåŒ¹é…åº“çš„æ–¹æ³•å°†åœ¨å†³å®šè¿è¡Œä½ç½® å°èŠ‚ä¸­ä»‹ç»ã€‚ 4. æ ¼å¼åŒ–è¯·æ±‚å’Œå“åº” æˆ‘ä»¬å†æ¥çœ‹çœ‹ C è¯­è¨€å‡½æ•°ä¸­ä½¿ç”¨çš„å‡½æ•°å‚æ•°ã€‚ 1234567891011inline void dyn_llama_server_init(struct dynamic_llama_server s, ext_server_params_t *sparams, ext_server_resp_t *err) &#123; s.llama_server_init(sparams, err);&#125;inline void dyn_llama_server_completion(struct dynamic_llama_server s, const char *json_req, ext_server_resp_t *resp) &#123; s.llama_server_completion(json_req, resp);&#125; åœ¨å®ƒä»¬çš„å‡½æ•°ç­¾åä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ƒä»¬ä½¿ç”¨çš„å‡½æ•°å‚æ•°ï¼š åœ¨ dyn_llama_server_init ä¸­ä½¿ç”¨äº† ext_server_params_t å‚æ•°ï¼Œåœ¨ dyn_llama_server_completion ä¸­ä½¿ç”¨äº† json_req å­—èŠ‚æ•°ç»„ã€‚ ext_server_params_t å‚æ•°æ˜¯ä¸€ä¸ª C ç»“æ„ï¼ŒåŒ…å«å¯åŠ¨ llama æœåŠ¡å™¨çš„é…ç½®ï¼Œç¨åå°†åœ¨ llm/ext_server/server.cpp ä¸­è§£é‡Šï¼ˆç”±äºç¯‡å¹…æœ‰é™ï¼Œæˆ‘ä»¬ä¸å±•å¼€è¿™éƒ¨åˆ†å†…å®¹ï¼‰ã€‚ åŒæ—¶ï¼Œå®Œæˆè°ƒç”¨çš„ json_req åœ¨ llm/ext_server/ext_server.cpp ä¸­ä½¿ç”¨å¦‚ä¸‹ï¼š 123456789101112131415161718void llama_server_completion(const char *json_req, ext_server_resp_t *resp) &#123; assert(llama != NULL &amp;&amp; json_req != NULL &amp;&amp; resp != NULL); resp-&gt;id = -1; resp-&gt;msg[0] = '\\0'; try &#123; if (shutting_down) &#123; throw std::runtime_error(\"server shutting down\"); &#125; json data = json::parse(json_req); resp-&gt;id = llama-&gt;queue_tasks.get_new_id(); llama-&gt;queue_results.add_waiting_task_id(resp-&gt;id); llama-&gt;request_completion(resp-&gt;id, data, false, false, -1); &#125; catch (std::exception &amp;e) &#123; snprintf(resp-&gt;msg, resp-&gt;msg_len, \"exception %s\", e.what()); &#125; catch (...) &#123; snprintf(resp-&gt;msg, resp-&gt;msg_len, \"Unknown exception during completion\"); &#125;&#125; äº‹å®ä¸Šï¼Œå®ƒåŒ…å« json æ ¼å¼çš„å®Œæˆè¯·æ±‚ï¼ŒåŒ…æ‹¬æç¤ºè¯ã€æ¸©åº¦ç­‰ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ° llama_server_completion ä¸ºå…¶åˆ›å»ºäº†ä¸€ä¸ªä»»åŠ¡ï¼Œå¹¶é€šè¿‡æ­£å¸¸è·¯å¾„ä¸­çš„ resp è¿”å›ä»»åŠ¡ IDã€‚å¦åˆ™ï¼Œå®ƒå°†æ ¼å¼åŒ–é”™è¯¯ä¿¡æ¯å¹¶è¿”å›ã€‚ å¦‚æœæ‚¨å¯¹å…¶è¯¦ç»†æ ¼å¼æ„Ÿå…´è¶£ï¼Œè¯·æŸ¥çœ‹ llm/dyn_ext_server.go æ–‡ä»¶ã€‚ 5. è¡¥ä¸ ä¸ºäº†é€‚åº”åœ¨ ollama ä¸­ä½¿ç”¨å¤šä¸ª llama æœåŠ¡å™¨ï¼Œå®ƒè¿˜å¯¹åŸå§‹ç‰ˆæœ¬çš„ llama.cpp åšäº†ä¸€äº›é¢å¤–çš„ä¿®æ”¹ã€‚ ä¾‹å¦‚ï¼Œä»¥ä¸‹è¡¥ä¸å¯¼å‡ºäº† ggml_free_cublas å¹¶è°ƒç”¨å®ƒæ¥é‡Šæ”¾ä¸€ä¸ª llama æœåŠ¡å™¨å®ä¾‹ï¼š 1234567891011121314151617181920212223diff --git a/examples/server/server.cpp b/examples/server/server.cppindex 7800c6e7..be30db23 100644--- a/examples/server/server.cpp+++ b/examples/server/server.cpp@@ -30,6 +30,10 @@ #include &lt;atomic&gt; #include &lt;signal.h&gt; +#ifdef GGML_USE_CUBLAS+extern \"C\" GGML_CALL void ggml_free_cublas(void);+#endif+ using json = nlohmann::json; struct server_params@@ -353,6 +357,9 @@ struct llama_server_context llama_free_model(model); model = nullptr; &#125;+#ifdef GGML_USE_CUBLAS+ ggml_free_cublas();+#endif &#125; åšä¸ªå°æ€»ç»“ é€šè¿‡å¯¹ llama.cpp çš„æ‰€æœ‰é¢å¤–æ¨¡å—å’Œä¿®æ”¹ï¼Œollama èƒ½å¤Ÿæ ¹æ®éœ€è¦å¯åŠ¨ llama æœåŠ¡å™¨ï¼Œé€šè¿‡ä¸åŒç¼–è¯‘åŠ¨æ€åº“ä¸­å¯¹ä¸åŒç¡¬ä»¶çš„æ”¯æŒåŠ¨æ€é€‰æ‹©ç¡¬ä»¶ï¼ˆå‚è§ æ„å»ºç³»ç»Ÿï¼‰ã€‚è¿è¡Œ llama æœåŠ¡å™¨åï¼Œollama æä¾›çš„é¢å¤–æ¨¡å—å…è®¸å‘é€å®Œæˆè¯·æ±‚ï¼Œå¹¶åœ¨ç¨åæ£€ç´¢å›å¤ã€‚ ç°åœ¨ï¼Œæˆ‘ä»¬åº”è¯¥æ¸…æ¥šåœ°äº†è§£äº†åé¢çš„ ollama æ¶æ„ï¼ˆæˆ‘ä»¬ä¹Ÿå¯ä»¥ç§°å…¶ä¸ºåç«¯ï¼‰ã€‚å…³äºåç«¯çš„æ›´å¤šç»†èŠ‚ï¼Œè¯»è€…å¯ä»¥æŸ¥çœ‹æºä»£ç ï¼Œå› ä¸ºå®ƒä»¬ä¸Šä¼šç»å¸¸æ›´æ”¹ã€‚æ¯•ç«Ÿï¼Œollama æ­£åœ¨ç§¯æå¼€å‘ä¸­ã€‚ ä½†æ˜¯ï¼Œæ­¤æ—¶è¿˜æœ‰ä¸€äº›è°œå›¢ï¼š åœ¨åç«¯æ–¹é¢ï¼šollama å¦‚ä½•çŸ¥é“é€‰æ‹©å“ªç§ç¡¬ä»¶å’ŒåŠ¨æ€åº“ï¼Ÿ åœ¨å‰ç«¯æ–¹é¢ï¼šå®ƒæä¾›å“ªç§å‰ç«¯ï¼Ÿ ä¸‹é¢çš„ç« èŠ‚å¯èƒ½å°±æ˜¯è¿™äº›é—®é¢˜çš„ç­”æ¡ˆã€‚ å†³å®šè¿è¡Œä½ç½® è®©æˆ‘ä»¬å›åˆ°åŠ¨æ€åº“å’Œ dyn_init ä¸­çš„ libPath å‚æ•°ï¼Œåœ¨ åŠ¨æ€é“¾æ¥åº“çš„åŠ è½½å’ŒæœåŠ¡å™¨çš„å¯åŠ¨ ä¸­æåˆ°è¿‡ã€‚æˆ‘ä»¬åœ¨ Embed libraries as payloadsä¸­å·²ç»çŸ¥é“ï¼Œollama ä¼šå°†åµŒå…¥çš„åŠ¨æ€åº“æå–åˆ°ä¸€ä¸ªä¸´æ—¶ç›®å½•ï¼Œå¹¶é€šè¿‡æ ¼å¼åŒ–å’Œä¼ é€’ libPath åˆ° dyn_init æ¥åŠ è½½å®ƒä»¬ã€‚ é—®é¢˜æ˜¯ï¼š ollama å¦‚ä½•é€šè¿‡ä¼ é€’ä¸åŒçš„ libPath å‚æ•°æ¥é€‰æ‹©åº“ï¼Ÿ åœ¨llm/dyn_ext_server.goä¸­å®ç°çš„newDynExtServerå‡½æ•°ä¸­ï¼ŒlibPathä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°libraryè¢«ä¼ é€’ã€‚åœ¨ Windows ç¯å¢ƒä¸‹ï¼Œå®ƒé€šè¿‡è°ƒç”¨ gpu.UpdatePath(filepath.Dir(library)) è¿›è¡Œæ›´æ–°ï¼Œä»¥ä¾¿åœ¨ PATH ä¸­æ·»åŠ çˆ¶ç›®å½•ã€‚è¿™æ ·å°±å¯ä»¥æ— ç¼åŠ è½½åŠ¨æ€é“¾æ¥åº“ã€‚ä¸è¿‡ï¼Œåœ¨ Linux æˆ– macOS ä¸Šä¸å¿…è¿™æ ·åšã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“è¿™é‡Œçš„ libPath å·²ç»æ˜¯åŠ¨æ€é“¾æ¥åº“æ–‡ä»¶çš„å®Œæ•´è·¯å¾„ã€‚ç„¶åï¼Œè®©æˆ‘ä»¬æ£€æŸ¥ç”Ÿæˆ libPath çš„ä½ç½®ã€‚ é€šè¿‡ç®€å•æœç´¢ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ llm/llm.go ä¸‹çš„ newLlmServer å‡½æ•°ä¸­æ‰¾åˆ°ç­”æ¡ˆï¼š 123456789err2 := fmt.Errorf(\"unable to locate suitable llm library\")for _, dynLib := range dynLibs &#123; srv, err := newDynExtServer(dynLib, model, adapters, projectors, opts) if err == nil &#123; return srv, nil &#125; slog.Warn(fmt.Sprintf(\"Failed to load dynamic library %s %s\", dynLib, err)) err2 = err&#125; å®ƒä¼šéå† dynLibs ä»¥è°ƒç”¨ newDynExtServer å‡½æ•°ã€‚ä¸€æ—¦åŠ è½½æˆåŠŸï¼Œå®ƒå°±ä¼šè¿”å› llama æœåŠ¡å™¨å®ä¾‹ã€‚ åœ¨ newLlmServer å¼€å§‹çš„åœ°æ–¹ï¼ŒdynLibs ä¸€èˆ¬åœ¨ getDynLibs å‡½æ•°ä¸­æ£€ç´¢ï¼Œè¿™æ˜¯ä¸€ä¸ªè¦å°è¯•çš„åŠ¨æ€é“¾æ¥åº“çš„æœ‰åºåˆ—è¡¨ï¼š 1234func newLlmServer(gpuInfo gpu.GpuInfo, model string, adapters, projectors []string, opts api.Options) (LLM, error) &#123; dynLibs := getDynLibs(gpuInfo) /* ... */&#125; é¡ºåºæ˜¯ä¸€ç§åå¥½ï¼Œå®ƒä» gpuInfo gpu.GpuInfo ä¸­è·å– GPU ä¿¡æ¯ã€‚å®ƒå¹¶ä¸å¼ºåˆ¶æ˜¯ â€œGPU ä¿¡æ¯â€ï¼Œå®ƒä¹Ÿå¯ä»¥æŒ‡ç¤ºä½¿ç”¨æŸä¸ª CPU å˜ä½“ã€‚æˆ‘æƒ³ ollama å›¢é˜Ÿå¯èƒ½å¾ˆå¿«å°±ä¼šä¿®æ”¹å®ƒã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œè¿”å›çš„ dynLibs æ¥è‡ª llm/payload_common.go ä¸­çš„é”®å€¼æ˜ å°„ availableDynLibsã€‚å®ƒæ˜¯åœ¨æå–æ‰€æœ‰åŠ¨æ€åº“ä¹‹ååœ¨ nativeInit ä¸­ç”Ÿæˆçš„ï¼š 1234567891011func nativeInit() error &#123; /* ... */ /* Extract dynamic libraries in temporary directory */ /* ... */ for _, lib := range libs &#123; // The last dir component is the variant name variant := filepath.Base(filepath.Dir(lib)) availableDynLibs[variant] = lib &#125; /* ... */&#125; å®ƒçš„å…³é”®å­—æ˜¯å…¨è·¯å¾„ä¸­é™¤åº“æ–‡ä»¶åä¹‹å¤–çš„æœ€åä¸€ä¸ªç»„æˆéƒ¨åˆ†ã€‚ä¾‹å¦‚ï¼Œåœ¨æˆ‘çš„ç”µè„‘ä¸Šæ˜¯ cpuã€cpu_avxã€cpu_avx2ã€cuda_v11.3 å’Œ rocm_v5.7ã€‚è€Œå¯¹åº”å€¼å½“ç„¶æ˜¯å®Œæ•´è·¯å¾„ã€‚ æˆ‘ä»¬å¯ä»¥å…ˆçœ‹çœ‹ getDynLibs å‡½æ•°ï¼ˆåœ¨ llm/payload_common.go ä¸­å®ç°ï¼‰çš„ä¸€èˆ¬å¤„ç†è¿‡ç¨‹ï¼Œå¿½ç•¥ä¸€äº›ç‰¹å®šå¹³å°çš„æƒ…å†µã€‚ ç¬¬ä¸€æ­¥æ˜¯ä» â€œGPU ä¿¡æ¯â€ ä¸­æ‰¾åˆ°ä¸è¯·æ±‚å®Œå…¨åŒ¹é…çš„å†…å®¹ï¼š 123456789101112131415exactMatch := \"\"dynLibs := []string&#123;&#125;altDynLibs := []string&#123;&#125;requested := gpuInfo.Libraryif gpuInfo.Variant != \"\" &#123; requested += \"_\" + gpuInfo.Variant&#125;// Try to find an exact matchfor cmp := range availableDynLibs &#123; if requested == cmp &#123; exactMatch = cmp dynLibs = []string&#123;availableDynLibs[cmp]&#125; break &#125;&#125; å®ƒä¼šæ ¹æ® â€œGPU ä¿¡æ¯â€ ä¸­çš„ Library å­—æ®µç”Ÿæˆä¸€ä¸ª requested å­—ç¬¦ä¸²å˜é‡ï¼Œå¹¶é™„åŠ ä¸€ä¸ª å˜ä½“ï¼ˆVariantï¼‰ã€‚å¦‚æœæœ‰ä¸€ä¸ªä¸ requested å­—ç¬¦ä¸²å®Œå…¨åŒ¹é…çš„åº“ï¼ŒdynLibs ä¸­çš„ç¬¬ä¸€ä¸ªåº“è·¯å¾„å°†æ˜¯æ‰€è¯·æ±‚åº“çš„è·¯å¾„ã€‚ç¬¬ä¸€ä¸ªåº“è·¯å¾„ä¹Ÿå°†æ˜¯åŠ è½½è¿‡ç¨‹ä¸­é¦–å…ˆå°è¯•çš„è·¯å¾„ã€‚ ç„¶åï¼Œå®ƒä¼šå°è¯•ä¸å®Œå…¨åŒ¹é…çš„ GPU åº“ï¼ˆå¯èƒ½å­˜åœ¨ç‰ˆæœ¬ä¸åŒ¹é…ç­‰æƒ…å†µï¼‰ï¼š 123456789101112// Then for GPUs load alternates and sort the list for consistent load orderingif gpuInfo.Library != \"cpu\" &#123; for cmp := range availableDynLibs &#123; if gpuInfo.Library == strings.Split(cmp, \"_\")[0] &amp;&amp; cmp != exactMatch &#123; altDynLibs = append(altDynLibs, cmp) &#125; &#125; slices.Sort(altDynLibs) for _, altDynLib := range altDynLibs &#123; dynLibs = append(dynLibs, availableDynLibs[altDynLib]) &#125;&#125; æ¥ä¸‹æ¥ï¼Œå®ƒä¼šè°ƒç”¨å¦ä¸€ä¸ªå®ç”¨ç¨‹åº GetCPUVariantï¼Œå°è¯•ä¼˜å…ˆé€‰æ‹©æœ€å¿«ï¼ˆå¯èƒ½ï¼‰çš„ CPU å˜ä½“ï¼š 123456789101112131415161718// Load up the best CPU variant if not primary requestedif gpuInfo.Library != \"cpu\" &#123; variant := gpu.GetCPUVariant() // If no variant, then we fall back to default // If we have a variant, try that if we find an exact match // Attempting to run the wrong CPU instructions will panic the // process if variant != \"\" &#123; for cmp := range availableDynLibs &#123; if cmp == \"cpu_\"+variant &#123; dynLibs = append(dynLibs, availableDynLibs[cmp]) break &#125; &#125; &#125; else &#123; dynLibs = append(dynLibs, availableDynLibs[\"cpu\"]) &#125;&#125; è¯¥å®ç”¨ç¨‹åºåœ¨ gpu/cpu_common.go ä¸­å®šä¹‰ã€‚å®ƒèƒ½æ£€æµ‹ x86 å¹³å°ä¸Šçš„ CPU æ‰©å±•ï¼š 12345678910111213func GetCPUVariant() string &#123; if cpu.X86.HasAVX2 &#123; slog.Info(\"CPU has AVX2\") return \"avx2\" &#125; if cpu.X86.HasAVX &#123; slog.Info(\"CPU has AVX\") return \"avx\" &#125; slog.Info(\"CPU does not have vector extensions\") // else LCD return \"\"&#125; è¯¥é¡ºåºå°†æŠŠ avx2 ä½œä¸ºæœ€é«˜ä¼˜å…ˆçº§ï¼Œç„¶åæ˜¯ avxï¼Œæœ€åæ˜¯çº¯ CPU å˜ä½“ã€‚æœ€åï¼Œå¦‚æœä¸Šè¿°æ–¹æ³•éƒ½ä¸å¥æ•ˆï¼Œå®ƒå°†å›é€€åˆ° CPU å˜ä½“ï¼š 1234567891011func getDynLibs(gpuInfo gpu.GpuInfo) []string &#123; /* Apple specific loading */ /* ... */ // Finally, if we didn't find any matches, LCD CPU FTW if len(dynLibs) == 0 &#123; dynLibs = []string&#123;availableDynLibs[\"cpu\"]&#125; &#125; slog.Debug(fmt.Sprintf(\"ordered list of LLM libraries to try %v\", dynLibs)) return dynLibs&#125; ç„¶åï¼ŒdynLibs å°†è¢«è¿”å›ä»¥è¿›è¡ŒåŠ è½½å°è¯•ã€‚ ç°åœ¨æˆ‘ä»¬å¯ä»¥æ¢è®¨ä¸€ä¸‹å¦‚ä½•ç”Ÿæˆ â€œGPU ä¿¡æ¯â€ gpuInfoï¼Œä»è€Œä½¿åå¥½æˆä¸ºå¯èƒ½ã€‚llm/llm.goä¸­çš„ New å‡½æ•°ä»¥ â€œGPU ä¿¡æ¯â€ ä¸ºç¬¬ä¸€ä¸ªå‚æ•°è°ƒç”¨ newLlmServerã€‚å®ƒå®Œæˆäº†è®¸å¤šé‡è¦å·¥ä½œï¼š æ‰“å¼€ã€åŠ è½½å¹¶æ£€æµ‹ LLM çš„å‚æ•°ã€‚ åŠ è½½ â€œGPU ä¿¡æ¯â€ï¼šinfo := gpu.GetGPUInfo()ã€‚ æ£€æŸ¥ VRAM å’Œæ¨¡å‹ä¸ç¡¬ä»¶çš„å…¼å®¹æ€§ã€‚ åˆå§‹æ£€æµ‹åœ¨ 2 ä¸­è¿›è¡Œã€‚ä¸è¿‡ï¼Œä¹Ÿæœ‰å¯èƒ½æ¨¡å‹è¢«æ ‡è®°ä¸ºä¸æ¨¡å‹ä¸å…¼å®¹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒå°†å›é€€åˆ°å…·æœ‰æœ€å¿«å˜ä½“çš„ CPUï¼š 12info.Library = \"cpu\"info.Variant = gpu.GetCPUVariant() è®©æˆ‘ä»¬é‡ç‚¹å…³æ³¨ 2ï¼Œçœ‹çœ‹åœ¨ GetGPUInfo å‡½æ•°ä¸­å‘ç”Ÿäº†ä»€ä¹ˆã€‚ Apple Metal è®©æˆ‘ä»¬ä»æœ€ç‰¹æ®Šçš„å¹³å°å¼€å§‹ã€‚è‹¹æœ macOS å¹³å°ï¼ŒåŒ…æ‹¬ XNU å†…æ ¸å’Œç”¨æˆ·ç©ºé—´ï¼Œé€šå¸¸è¢«ç§°ä¸º â€œDarwinâ€ã€‚ åœ¨å‰é¢æåˆ°çš„ getDynLibs ä¸­ï¼ŒDarwin å¹³å°ä¸Šçš„æ£€æµ‹éå¸¸ç®€å•ï¼š 1234567891011// Short circuit if we know we're using the default built-in (darwin only)if gpuInfo.Library == \"default\" &#123; return []string&#123;\"default\"&#125;&#125;// TODO - temporary until we have multiple CPU variations for Darwin// Short circuit on darwin with metal onlyif len(availableDynLibs) == 1 &#123; if _, onlyMetal := availableDynLibs[\"metal\"]; onlyMetal &#123; return []string&#123;availableDynLibs[\"metal\"]&#125; &#125;&#125; It uses default library according to the â€œGPU informationâ€, or just use metal. The gpu.GetGPUInfo() is in gpu/gpu_darwin.go, as simple as possible: å®ƒä¼šæ ¹æ® â€œGPU ä¿¡æ¯â€ ä½¿ç”¨ default åº“ï¼Œæˆ–è€…ç›´æ¥ä½¿ç”¨ metalã€‚gpu.GetGPUInfo() åœ¨ gpu/gpu_darwin.go ä¸­ï¼Œéå¸¸ç®€å•ï¼š 1234567891011121314func GetGPUInfo() GpuInfo &#123; mem, _ := getCPUMem() if runtime.GOARCH == \"amd64\" &#123; return GpuInfo&#123; Library: \"cpu\", Variant: GetCPUVariant(), memInfo: mem, &#125; &#125; return GpuInfo&#123; Library: \"metal\", memInfo: mem, &#125;&#125; æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå®ƒè·å–å†…å­˜ä¿¡æ¯ï¼Œå¹¶æ£€æµ‹ ollama æ˜¯å¦è¿è¡Œåœ¨è‹±ç‰¹å°” x86_64/amd64 å¹³å°ä¸Šã€‚å¦‚æœæ˜¯ï¼Œå®ƒå°±ä¼šä½¿ç”¨æ‰©å±•é€Ÿåº¦æœ€å¿«çš„ CPUã€‚å¦åˆ™ï¼Œåªæœ‰ ARM Mac æ‰èƒ½åˆ©ç”¨ Metal API åŠ é€Ÿã€‚ æ®æˆ‘æ‰€çŸ¥ï¼Œè‹±ç‰¹å°” Mac ä¸Šçš„ AMD æ˜¾å¡åº”è¯¥ä¹Ÿæ”¯æŒ Metalã€‚ä½† ollama ä¸ä¼šåœ¨è‹±ç‰¹å°” Mac ä¸Šä½¿ç”¨å®ƒã€‚å¯èƒ½åªæ˜¯å› ä¸ºé©±åŠ¨ç¨‹åºæˆ–æ˜¾å¡æœ¬èº«è¿‡æ—¶äº†ã€‚ Nvidia CUDA å’Œ AMD ROCm ç„¶åï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹ Nvidia å’Œ AMD GPU çš„é€šç”¨æ£€æµ‹ï¼Œå› ä¸ºå®ƒä»¬åœ¨ ollama ä¸­æ˜¯è€¦åˆåœ¨ä¸€èµ·çš„ã€‚ å®ç°æ–¹æ³•åœ¨ gpu/gpu.goä¸­ï¼š 123456789101112131415161718192021222324252627func GetGPUInfo() GpuInfo &#123; // TODO - consider exploring lspci (and equivalent on windows) to check for // GPUs so we can report warnings if we see Nvidia/AMD but fail to load the libraries gpuMutex.Lock() defer gpuMutex.Unlock() if gpuHandles == nil &#123; initGPUHandles() &#125; // All our GPU builds on x86 have AVX enabled, so fallback to CPU if we don't detect at least AVX cpuVariant := GetCPUVariant() if cpuVariant == \"\" &amp;&amp; runtime.GOARCH == \"amd64\" &#123; slog.Warn(\"CPU does not have AVX or AVX2, disabling GPU support.\") &#125; var memInfo C.mem_info_t resp := GpuInfo&#123;&#125; /* Getting the actual GPU information */ /* ... */ /* Fallback to CPU if no GPU detected */ /* ... */ resp.DeviceCount = uint32(memInfo.count) resp.FreeMemory = uint64(memInfo.free) resp.TotalMemory = uint64(memInfo.total) return resp&#125; ç¬¬ä¸€ä¸ªç¨‹åºå—è°ƒç”¨ initGPUHandles æ¥å®šä¹‰è¦æœç´¢çš„ GPU åº“ï¼Œä»¥ä¾¿ä½¿ç”¨å®ƒä»¬è·å– GPU ä¿¡æ¯ã€‚å¯¹äº Nvidiaï¼Œå®ƒä¼šæ£€æµ‹ Windows ä¸Šç‹¬ç«‹æ˜¾å¡çš„ nvml.dllï¼ŒLinux ä¸Šçš„ libnvidia-ml.soï¼Œä»¥åŠæŸäº›ç‰¹æ®Šè®¾å¤‡ä¸Šçš„ libcudart.so*ï¼Œä¾‹å¦‚ Jetson ç³»åˆ—ï¼ˆæ„Ÿè°¢ æœ€è¿‘çš„ PRï¼‰ã€‚ ç¬¬äºŒä¸ªç¨‹åºå—æ£€æµ‹ CPU å˜ä½“ï¼Œå®ƒè¦æ±‚ CPU è‡³å°‘æœ‰ AVX å˜ä½“æ‰èƒ½æ”¯æŒ GPUã€‚ ç„¶åï¼Œå®ƒä¼šæ£€æŸ¥å¥æŸ„ï¼Œå¹¶ä½¿ç”¨ç›¸å…³åº“æŸ¥æ‰¾ç›¸åº”çš„ GPUã€‚ å¯¹äº Nvidia ç‹¬ç«‹ GPUï¼š 1234567891011121314151617181920if gpuHandles.nvml != nil &amp;&amp; (cpuVariant != \"\" || runtime.GOARCH != \"amd64\") &#123; C.nvml_check_vram(*gpuHandles.nvml, &amp;memInfo) if memInfo.err != nil &#123; slog.Info(fmt.Sprintf(\"[nvidia-ml] error looking up NVML GPU memory: %s\", C.GoString(memInfo.err))) C.free(unsafe.Pointer(memInfo.err)) &#125; else if memInfo.count &gt; 0 &#123; // Verify minimum compute capability var cc C.nvml_compute_capability_t C.nvml_compute_capability(*gpuHandles.nvml, &amp;cc) if cc.err != nil &#123; slog.Info(fmt.Sprintf(\"[nvidia-ml] error looking up NVML GPU compute capability: %s\", C.GoString(cc.err))) C.free(unsafe.Pointer(cc.err)) &#125; else if cc.major &gt; CudaComputeMin[0] || (cc.major == CudaComputeMin[0] &amp;&amp; cc.minor &gt;= CudaComputeMin[1]) &#123; slog.Info(fmt.Sprintf(\"[nvidia-ml] NVML CUDA Compute Capability detected: %d.%d\", cc.major, cc.minor)) resp.Library = \"cuda\" &#125; else &#123; slog.Info(fmt.Sprintf(\"[nvidia-ml] CUDA GPU is too old. Falling back to CPU mode. Compute Capability detected: %d.%d\", cc.major, cc.minor)) &#125; &#125;&#125; å®ƒè°ƒç”¨åœ¨ gpu/gpu_info_nvml.c ä¸­å®ç°çš„ C å‡½æ•° nvml_check_vramï¼Œä»¥è·å– VRAMã€‚å¦‚æœå‘ç°ä¸€ä¸ªå¯ç”¨è®¾å¤‡ï¼Œå®ƒè¿˜ä¼šé€šè¿‡ nvml_compute_capability æ£€æŸ¥è®¡ç®—èƒ½åŠ›ï¼Œä»¥ç¡®ä¿è¯¥è®¾å¤‡å¯ç”¨ã€‚ è¿™æ ·çš„è®¾è®¡ä½¿æˆ‘æ— æ³•åœ¨ Windows ä¸‹ä½¿ç”¨ ZLUDA é€šè¿‡ ollama åœ¨ AMD æ˜¾å¡ä¸Šè¿è¡Œ LLMã€‚å› ä¸ºå½“æ—¶ ZLUDA å°†æ­¤åŠŸèƒ½æ ‡è®°ä¸ºæœªå®ç°ã€‚ç„¶è€Œï¼Œæˆ‘çš„ AMD æ˜¾å¡å·²ç»æ”¯æŒè¯¥åŠŸèƒ½ã€‚ç°åœ¨æˆ‘ä¸å†éœ€è¦ ZLUDA äº†ã€‚ åœ¨æœ¬ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘é€‰æ‹©è·³è¿‡ Cudart æ”¯æŒï¼Œå› ä¸ºå®ƒå¹¶ä¸å¸¸è§ã€‚ç°åœ¨è®©æˆ‘ä»¬æ¥çœ‹çœ‹æœ€è¿‘ä»¤äººå…´å¥‹çš„ AMD æ”¯æŒï¼ é’ˆå¯¹ AMD çš„ GetGPUInfo ä»£ç éå¸¸ç®€çŸ­ï¼š 123456else &#123; AMDGetGPUInfo(&amp;resp) if resp.Library != \"\" &#123; return resp &#125;&#125; ä½ å¯èƒ½ä¼šæ³¨æ„åˆ°ï¼Œè¿™æ˜¯ä¸€ä¸ª elseã€‚å› æ­¤ï¼Œä¸ if å­å¥ä¸€èµ·ï¼Œåªæœ‰åœ¨æœªæ£€æµ‹åˆ° Nvidia å¤„ç†å™¨çš„æƒ…å†µä¸‹ï¼Œæ‰ä¼šå°è¯• AMDã€‚è¿™å°†å¯¼è‡´ä¸€ä¸ªé—®é¢˜ï¼šå½“å®‰è£…äº† Nvidia GPU åº“ï¼Œä½†æœªæ£€æµ‹åˆ° GPU æˆ–æ£€æµ‹åˆ°çš„ GPU ä¸å…¼å®¹æ—¶ï¼ŒAMD æ˜¾å¡ä¹Ÿæ°¸è¿œä¸ä¼šè¢«æ£€æµ‹åˆ°ã€‚æˆ‘ä¸ºæ­¤å¼€è®¾äº†ä¸€ä¸ªé—®é¢˜ã€‚ å¥½äº†ï¼Œè®©æˆ‘ä»¬å›åˆ° GetGPUInfoã€‚å¦‚æœæ£€æµ‹åˆ° Nvidia æ˜¾å¡ï¼Œâ€œGPU ä¿¡æ¯â€ ä¸­çš„ Library å°†è®¾ä¸º cudaã€‚å¦‚æœæ˜¯ AMD æ˜¾å¡ï¼Œåˆ™ä¼šè®¾ç½®ä¸º rocm ã€‚ å› æ­¤ï¼Œå¦‚æœæ£€æµ‹æˆåŠŸï¼Œâ€œGPU ä¿¡æ¯â€ å°†ä¸ availableDynLibs é…åˆï¼Œä¸º cuda_* æˆ– rocm_* å˜ä½“ä¼˜å…ˆé€‰æ‹©åº“è·¯å¾„ã€‚ è¿™å°±æ­ç¤ºäº† GPU æ˜¯å¦‚ä½•è¢«æ£€æµ‹åˆ°çš„ï¼Œä»¥åŠä»ä¸€å †åŠ¨æ€åº“ä¸­åˆ›å»º llama æœåŠ¡å™¨æ—¶å¯èƒ½ä½¿ç”¨çš„ GPUã€‚ Web service and client ç½‘ç»œæœåŠ¡å’Œå®¢æˆ·ç«¯ è®©æˆ‘ä»¬æ¥çœ‹çœ‹ â€œå‰ç«¯â€ï¼åœ¨ ollama ä¸­ç¡®å®æ²¡æœ‰æ‰€è°“çš„å‰ç«¯ã€‚ç›¸åï¼Œå®ƒå’Œå…¶ä»–å¤§å¤šæ•° LLM æœåŠ¡ä¸€æ ·ï¼Œæä¾›äº†ä¸€ç³»åˆ— Web APIã€‚ åŸºæœ¬çš„ Web API åœ¨serverä¸­å®ç°ï¼Œä¸»è¦åœ¨server/routes.goæ¨¡å—ä¸­ã€‚å®Œæ•´çš„ API å¯åœ¨ GitHub ä¸Šæ‰¾åˆ°ã€‚åœ¨æ­¤ï¼Œæˆ‘ä»¬ä¹Ÿä»…ä»¥ chat çš„ completion ç«¯ç‚¹ä¸ºä¾‹ï¼Œå¿«é€Ÿä» API å»ºç«‹èµ·åˆ°æˆ‘ä»¬åœ¨ä¸Šé¢è§£æè¿‡çš„éƒ¨åˆ†çš„æ¦‚è§ˆã€‚è¿™ä¸ªç«¯ç‚¹å®šä¹‰å¦‚ä¸‹ï¼š 1r.POST(&quot;/api/chat&quot;, ChatHandler) å…¶ä¸­ ChatHandler æ˜¯å¤„ç†è¯·æ±‚çš„å›è°ƒã€‚å®ƒä»¥ var req api.ChatRequest ç»“æ„åˆ›å»ºå¹¶è§£æè¯·æ±‚ã€‚å¤„ç†ç¨‹åºä¼šåšå¾ˆå¤šäº‹æƒ…ï¼Œæ¯”å¦‚åŠ è½½æ¨¡å‹ï¼Œä»¥ç¡®ä¿é¢„æµ‹æ˜¯å¯èƒ½çš„ã€‚ ä¸€åˆ‡å‡†å¤‡å°±ç»ªåï¼Œæœ€é‡è¦çš„äº‹æƒ…å°±æ¥äº†ï¼š 12345678910// Start predictionpredictReq := llm.PredictOpts&#123; Prompt: prompt, Format: req.Format, Images: images, Options: opts,&#125;if err := loaded.runner.Predict(c.Request.Context(), predictReq, fn); err != nil &#123; ch &lt;- gin.H&#123;\"error\": err.Error()&#125;&#125; å®ƒç”¨æç¤ºï¼ˆç”¨æˆ·è¾“å…¥ã€æç¤ºç­‰ï¼‰ã€å›¾åƒå’Œå…¶ä»–é€‰é¡¹å‡†å¤‡é¢„æµ‹è¯·æ±‚ã€‚ç„¶åï¼Œå®ƒè°ƒç”¨ runner çš„ Prediction å‡½æ•°ï¼Œå…¶ä¸­ runner éœ€è¦å®ç° llm æ¨¡å—ä¸‹çš„ LLM æ¥å£ï¼š 1234567891011var loaded struct &#123; mu sync.Mutex runner llm.LLM expireAt time.Time expireTimer *time.Timer *Model *api.Options&#125; LLM æ¥å£çš„å®šä¹‰å¦‚ä¸‹ï¼š 1234567type LLM interface &#123; Predict(context.Context, PredictOpts, func(PredictResult)) error Embedding(context.Context, string) ([]float64, error) Encode(context.Context, string) ([]int, error) Decode(context.Context, []int) (string, error) Close()&#125; Predict çš„å®ç°æ¥è‡ª é¢„æµ‹ä¸€èŠ‚ä¸­æè¿°çš„ dynExtServerã€‚ç„¶åï¼Œå®ƒå°†è°ƒç”¨ dyn_llama_server_completion ä»åŠ¨æ€åº“ä¸­è¯·æ±‚å¯åŠ¨ llama æœåŠ¡å™¨ã€‚ Ollama çš„ Go API åœ¨é¡¹ç›®å†…éƒ¨ï¼Œollama åœ¨ Go çš„ api ä¸‹ç›´æ¥æä¾›äº†ä¸€ä¸ªå°è£…ã€‚ç”¨æˆ·å¯ä»¥åˆ©ç”¨å®ƒæ›´æ–¹ä¾¿åœ°è°ƒç”¨ç½‘ç»œ APIã€‚äº‹å®ä¸Šï¼Œollama æœ¬èº«ä¹Ÿä½¿ç”¨ Go å°è£…æä¾›å®é™…çš„å‰ç«¯â€”â€”ç»ˆç«¯ç”¨æˆ·ç•Œé¢ã€‚ æ­¤å¤–è¿˜æœ‰ Python å’Œ JavaScript/TypeScript ç»‘å®šï¼š https://github.com/ollama/ollama-python https://github.com/ollama/ollama-js OpenAI API å°è£…å™¨ å°½ç®¡æœ‰æœ¬åœ° API ç«¯ç‚¹ï¼Œollama è¿˜åœ¨ server/routes.go ä¸­æä¾›äº†ä¸ OpenAI API å…¼å®¹ï¼ˆéƒ¨åˆ†å…¼å®¹ï¼‰çš„ç«¯ç‚¹ï¼š 12// Compatibility endpointsr.POST(&quot;/v1/chat/completions&quot;, openai.Middleware(), ChatHandler) å®ƒå®é™…ä¸Šæ˜¯ä» OpenAI è¯·æ±‚åˆ° ollama æœ¬æœºè¯·æ±‚çš„è½¬æ¢å™¨ï¼Œåä¹‹äº¦ç„¶ã€‚ å¦‚æœæ‚¨æ„Ÿå…´è¶£ï¼Œå¯ä»¥æŸ¥çœ‹ openai/openai.goã€‚ å…¶ä»–å®ç”¨ç¨‹åº ç»ˆç«¯ UI åˆ©ç”¨ Web API ç«¯ç‚¹çš„ Go åŒ…è£…å™¨æ¥æä¾›åŸºäºç»ˆç«¯çš„å¯¹è¯ã€‚ å®ƒéœ€è¦ä¸€äº›å®ç”¨ç¨‹åºï¼Œä¾‹å¦‚ readline æ¥ä¸ç»ˆç«¯ä¸­çš„ç”¨æˆ·è¾“å…¥è¿›è¡Œäº¤äº’ï¼Œä»¥åŠ progress æ¥æ˜¾ç¤ºè¿›åº¦ã€‚ æ­¤å¤–ï¼Œè¿˜æœ‰ç”¨äº API ç«¯ç‚¹è®¤è¯çš„ authï¼Œç”¨äºcliå‘½ä»¤æä¾›è€…çš„ cmdï¼Œç”¨äºå•ä½è½¬æ¢çš„ formatï¼Œç”¨äºæ¨¡å‹æ–‡ä»¶è§£æçš„ parser ç­‰ã€‚å¯ä»¥æ ¹æ®æ‚¨çš„æ„æ„¿è¯¦ç»†æŸ¥çœ‹æºä»£ç ã€‚è¿™ç¯‡æ–‡ç« å·²ç»è¶³å¤Ÿé•¿äº†ï¼Œå¹¶ä¸”åªå…³æ³¨ ollama çš„æ•´ä½“æ¶æ„ã€‚æˆ‘ä¹Ÿå¸Œæœ›çœ‹åˆ°æ›´å¤šçš„æœ‰å…³å®ƒçš„å…¶ä»–æ–‡ç«  ğŸ˜‰ ç»“è®º æœ€åï¼Œåœ¨ç»“æŸå‰ï¼Œè¿™é‡Œç»™å‡ºä¸€ä¸ªå…³äº ollama æ¶æ„çš„ç®€å•å›¾ï¼š æˆ‘ä»è¦è¯´ï¼šollama æ˜¯ llama.cpp çš„ä¸€ä¸ªè–„ï¼ˆä¹Ÿè®¸ä¸æ˜¯é‚£ä¹ˆè–„ï¼‰ä½†è¶³å¤Ÿæ™ºèƒ½çš„å°è£…ã€‚ å°½ç®¡å®ƒä»ç„¶æœ‰ä¸€äº›ç¼ºç‚¹ï¼Œä½†æˆ‘ä»¬ç¡®å®éœ€è¦å°½å¯èƒ½å¤šçš„æ­¤ç±»å°è£…ï¼Œä»¥ä½¿æœ€ç»ˆç”¨æˆ·çš„ç”Ÿæ´»æ›´è½»æ¾ã€‚","categories":[{"name":"AI","slug":"AI","permalink":"https://blog.inoki.cc/categories/AI/"},{"name":"LLM","slug":"AI/LLM","permalink":"https://blog.inoki.cc/categories/AI/LLM/"}],"tags":[{"name":"ç¿»è¯‘","slug":"ç¿»è¯‘","permalink":"https://blog.inoki.cc/tags/ç¿»è¯‘/"},{"name":"ä¸­æ–‡","slug":"ä¸­æ–‡","permalink":"https://blog.inoki.cc/tags/ä¸­æ–‡/"},{"name":"LLM","slug":"LLM","permalink":"https://blog.inoki.cc/tags/LLM/"},{"name":"ollama","slug":"ollama","permalink":"https://blog.inoki.cc/tags/ollama/"}]},{"title":"On the architecture of ollama","slug":"Ollama","date":"2024-04-15T15:34:00.000Z","updated":"2025-03-08T09:40:48.590Z","comments":true,"path":"2024/04/15/Ollama/","link":"","permalink":"https://blog.inoki.cc/2024/04/15/Ollama/","excerpt":"","text":"Recently, I took a chance to explore ollama project, because I want to enable the support of my AMD graphic card (with a not bad VRAM - 32G!) on Windows. There is already the support on Linux, based on AMD ROCm. It should be kind of out-of-box on Windows, thanks to the release of ROCm on Windows. But ollama prevents me from using it. So, I tried both ZLUDA and modified the code of ollama to get what I wanted. This feature is already merged and released in ollama v0.1.29. To avoid missing the details and the things I 've learnt, this blog is in charge of noting the architecture of ollama for myself. To me, ollama is a thin but smart enough wrapper to llama.cpp. It is really end-user friendly, and provides a web interface and a cli interface, in order to run and interact with a lot of Large Language Models (LLMs). Indeed, in most cases, itâ€™s llama.cpp who loads and runs the models, and ollama just â€œpilotsâ€ (yes, I use a term that AI generations are familiar with) the llama.cpp. I will give a discussion about this part later. This post assumes that you are able to read golang code or some other C-like code. For special points in the code, I would give some brief descriptions or metaphors for better understanding. In this post, I will first give the project structure of ollama. Then, the core architecture and implementations around llama.cpp along with the build systems will be described. Next, I will describe how ollama chooses the device (hardware in general) to run an LLM. Finally, the web service, client and the utilities along with the other parts will be introduced, to finish the post. Project structure You can get the source code of ollama on GitHub. The project is mainly written in Golang. Here is a table of brief descriptions for each directory: Dir name Description api Client API lib in go app Desktop application (mainly a tray) auth Authentication cmd Commands and handlers docs Documentations examples Examples to use ollama format Utility to format units and time gpu GPU and acceleration detection llm Implementations to run llama.cpp macapp Desktop application for Mac openai OpenAI API wrapper for ollama parser Model information and message parser progress Utility to show loading progress readline Utility to read inputs from terminal scripts Scripts for build and publish server Server implementation in go version Version information Notice that the directories can be changed anytime, since the project is under active development. The hero behind: llama.cpp Letâ€™s first start by an introduction to the core, llama.cpp. The llama.cpp is included as a submodule in ollama. You can find it in llm directory. There are also the needed files around it in the same directory. We will see them in details later. The llama.cpp project itself is an Open Source library for the inference of Metaâ€™s LLaMA model in pure C/C++, at very first. And it is extended to run more models, such as Mistral, and Google Gemma (supported very recently). It leverages the capability of ggml, another project created by the same author, to run it natively on different platforms (compared to Python project). Supported backends Currently, some of the supported inference backends in llama.cpp are as follows through ggml: It can run AVX, AVX2 and AVX512 on x86 for llama.cpp, or NEON on ARM. With MPI (e.g. MPICH and OpenMPI), ggml allows to run models on CPU or CPU clusters. Apple Metal is integrated to support GPUs on macOS and iOS, including GPUs on Mac and Apple made GPU on iOS devices or Apple Silicon Mac. An old open standard, OpenCL is used by ggml based on the BLAS architecture. NVIDIA GPUs are supported by cuBLAS. Recent AMD GPUs are supported through hipBLAS, which is parts of AMD ROCm with almost same APIs as cuBLAS. What caught my attention recently, is the Vulkan support in llama.cpp. The (buggy) support was initially started by Nomic through their kompute framework. The recent progress is a pure implementation in ggml using the Vulkan libs directly. These backends allow developers to run LLMs that work across multiple platforms, from desktop computers to smartphones and beyond. Additionally, llama.cpp also provides native support for Linux (including Android Linux), Windows, macOS, and various other operating systems, such as iOS (see whispher.cpp on iOS) and even WebAssembly (whispher.wasm). Therefore, it should be very nature that ollama is born with the supports of the platforms and operating systems. Build system Next, letâ€™s take a look at the build system to know how ollama plays with llama.cpp. C or Cpp projects usually come up with cmake (although there are more choices now) to handle the compilation, linking, etc. So does llama.cpp: it uses compile definitions (or flags) to leverage different backends. For instance: LLAMA_AVX, LLAMA_AVX2, LLAMA_AVX512 for the AVX supports; LLAMA_METAL for the Apple Metal support; LLAMA_CUBLAS for the NVIDIA CUDA support; and LLAMA_HIPBLAS for the AMD ROCm support. However, ollama itself is a go project leveraging the build system provided by go. Both of the two build systems co-exist to build the different parts: cmake builds llama.cpp with a few files from ollama.cpp, to pilot and provide interfaces; go build systems compile, link and pack the rest parts to make an application and cli of ollama. Apart from pure go code, the go build systems need cgo to build some C-family code as well. There are examples in llm directory (dyn_ext_server.c file to load and provide interfaces) and gpu directory (gpu_info_cuda.c, gpu_info_rocm.c and gpu_info_darwin.m are C or Objective-C implementations to detect GPUs). The go build system in ollama also run the commands to call cmake for the llama.cpp building, by leveraging go generate. This work lays in the llm/generate directory, e.g. on Linux: 123package generate//go:generate bash ./gen_linux.sh llm/generate/generate_darwin.go tells go generate to run the gen_linux.sh script to build the llama.cpp part. Some scripts for different platforms Currently, there are gen_common.sh, gen_linux.sh and gen_darwin.sh to build llama.cpp for ollama on Unix-like OS, such as macOS and Linux. Meanwhile, itâ€™s gen_windows.ps1 PowerShell script on Windows. Letâ€™s take an example to build llama.cpp with AVX support on Linux: 123456init_varsCMAKE_DEFS=\"$&#123;COMMON_CPU_DEFS&#125; -DLLAMA_AVX=on -DLLAMA_AVX2=off -DLLAMA_AVX512=off -DLLAMA_FMA=off -DLLAMA_F16C=off $&#123;CMAKE_DEFS&#125;\"BUILD_DIR=\"$&#123;LLAMACPP_DIR&#125;/build/linux/$&#123;ARCH&#125;/cpu_avx\"echo \"Building AVX CPU\"buildcompress_libs The first three lines initialize the variables to prepare the build. The init_vars calls a sub-procedure in gen_common.sh to prepare common variables such as: 12CMAKE_DEFS=\"\"CMAKE_TARGETS=\"--target ext_server\" where CMAKE_TARGETS will set the build target to ext_server. This target is a library to provide interfaces and functions from llama.cpp to ollama, we will talk about it in the next section. In CMAKE_DEFS, only LLAMA_AVX is enabled. And COMMON_CPU_DEFS is defined as follows, to make dynamic library with position independent code (for gcc it will be converted to a -fpic flag): 1COMMON_CPU_DEFS=\"-DCMAKE_POSITION_INDEPENDENT_CODE=on -DLLAMA_NATIVE=off\" It outputs â€œBuilding AVX CPUâ€ in the terminal. The build sub-procedure then calls cmake: 12345678910111213build() &#123; cmake -S $&#123;LLAMACPP_DIR&#125; -B $&#123;BUILD_DIR&#125; $&#123;CMAKE_DEFS&#125; cmake --build $&#123;BUILD_DIR&#125; $&#123;CMAKE_TARGETS&#125; -j8 mkdir -p $&#123;BUILD_DIR&#125;/lib/ g++ -fPIC -g -shared -o $&#123;BUILD_DIR&#125;/lib/libext_server.$&#123;LIB_EXT&#125; \\ $&#123;GCC_ARCH&#125; \\ $&#123;WHOLE_ARCHIVE&#125; $&#123;BUILD_DIR&#125;/examples/server/libext_server.a $&#123;NO_WHOLE_ARCHIVE&#125; \\ $&#123;BUILD_DIR&#125;/common/libcommon.a \\ $&#123;BUILD_DIR&#125;/libllama.a \\ -Wl,-rpath,\\$ORIGIN \\ -lpthread -ldl -lm \\ $&#123;EXTRA_LIBS&#125;&#125; After the build by cmake, it will make a libext_server dynamic library (.dll on Windows, .so on Linux/BSD, and .dylib on macOS). The library contains the compiled code from examples/server under llama.cpp (examples/server/libext_server.a), command and core code of llama.cpp - common/libcommoa.a and libllama.a. They will be embedded into the main go program to facilitate the distribution, as â€œpayloadsâ€ of the executable. Finally, it compresses the payloads to make the executable smaller: 1234567891011121314compress_libs() &#123; echo \"Compressing payloads to reduce overall binary size...\" pids=\"\" rm -rf $&#123;BUILD_DIR&#125;/lib/*.$&#123;LIB_EXT&#125;*.gz for lib in $&#123;BUILD_DIR&#125;/lib/*.$&#123;LIB_EXT&#125;* ; do gzip --best -f $&#123;lib&#125; &amp; pids+=\" $!\" done echo for pid in $&#123;pids&#125;; do wait $pid done echo \"Finished compression\"&#125; The dynamic library will finally reside under a cpu_avx directory in the build folder. If it builds for the other variants (such as GPUs), they will be in different directories in the build folder. Pilot llama.cpp Then, let us go back to the llm directory, to see the implementations in ollama built on top of llama.cpp. The most important parts for ollama to pilot llama.cpp are: In ext_server, the wrapper implementations provides the functions that ollama can call, such as llama_server_init to init an llama.cpp instance, llama_server_completion to complete a chat, or llama_server_embedding to compute the embeddings for texts. An extra makefile (CMakeLists) is also contained in ext_server, to build the code with the llama.cpp/examples/server example as a library. It can then be loaded by dyn_ext_server code under llm, to serve with the llama.cpp instance. The libraries are embedded into the go program using go embed package, and extract during the runtime. Besides, the calls to the functions in ext_server carry the some parameters defined in llm directory. In general, the requests and responses are passed in JSON format, and contains more structural information. They are defined in such as ggml.go (describing the models) and llama.go (describing the different requests and responses). To dynamically manage the llama.cpp instances, ollama provides some patches to the original llama.cpp. Letâ€™s study them one by one. 1. External server We first take a look at ext_server. We already know that the dynamic libraries are built during the generation. But how will they be used? In llm/dyn_ext_server.go, the newDynExtServer is in charge of loading the dynamic libraries, initialize a llama.cpp instance and start the event loop to receive any requests and generate the responses. Dynamic library loading and server starting In newDynExtServer, the go function calls a C function named by dyn_init to load the dynamic library. The description and the needed functions are loaded into a struct_dynamic_llama_server description, and wrapped in dynExtServer, a go struct. They are then used in a another C function, dyn_llama_server_init, with the parameters to run a llama.cpp server, for the server instance initialization. Without issue, newDynExtServer will call the last C function during the initialization, dyn_llama_server_start. The server will be running and is then able to receive requests from ollama. The aforementioned C functions are in llm/dyn_ext_server.c and declared in llm/dyn_ext_server.h. Letâ€™s take a quick look at dyn_init: 12void dyn_init(const char *libPath, struct dynamic_llama_server *s, ext_server_resp_t *err); It accepts a library path libPath as argument, and returns a dynamic_llama_server instance or an error through the C pointers (or memory address to those who are not familiar with C, go is able to handle them like go struct, store them and pass to the other C functions). The dynamic_llama_server struct is capable of storing the address of necessary C functions, and the reference to the loaded dynamic library. Its definition is as below: 123456789101112131415161718192021struct dynamic_llama_server &#123; void *handle; void (*llama_server_init)(ext_server_params_t *sparams, ext_server_resp_t *err); void (*llama_server_start)(); void (*llama_server_stop)(); void (*llama_server_completion)(const char *json_req, ext_server_resp_t *resp); void (*llama_server_completion_next_result)(const int task_id, ext_server_task_result_t *result); void (*llama_server_completion_cancel)(const int task_id, ext_server_resp_t *err); void (*llama_server_release_task_result)(ext_server_task_result_t *result); void (*llama_server_tokenize)(const char *json_req, char **json_resp, ext_server_resp_t *err); void (*llama_server_detokenize)(const char *json_req, char **json_resp, ext_server_resp_t *err); void (*llama_server_embedding)(const char *json_req, char **json_resp, ext_server_resp_t *err); void (*llama_server_release_json_resp)(char **json_resp);&#125;; The core functionality of dyn_init is to load a dynamic library indicated by libPath, read the symbol tables, find the addresses of needed C functions, and store them into an instance of dynamic_llama_server structure. The libPath could be the path of one of the built dynamic libraries with the libext_server prefix. So that the built libraries based on llama.cpp can be used by ollama. Once loaded, the calls to dyn_llama_server_start and dyn_llama_server_start are indeed direct calls to the C functions from the dynamic libraries: 123456789inline void dyn_llama_server_init(struct dynamic_llama_server s, ext_server_params_t *sparams, ext_server_resp_t *err) &#123; s.llama_server_init(sparams, err);&#125;inline void dyn_llama_server_start(struct dynamic_llama_server s) &#123; s.llama_server_start();&#125; After calling dyn_llama_server_start, the llama.cpp server created from a dynamic library is ready to make predictions. Prediction When ollama receives a prediction request, it calls Predict on a dynExtServer instance. This function is able to formats the request (will see this later), and calls a C function, dyn_llama_server_completion, for start the prediction: 12345inline void dyn_llama_server_completion(struct dynamic_llama_server s, const char *json_req, ext_server_resp_t *resp) &#123; s.llama_server_completion(json_req, resp);&#125; As you see, itâ€™s also a direct call to the function loaded from one of the dynamic libraries built on top of llama.cpp. A really good design in this part is the stream-like response, thanks to the fn func(PredictResult) argument in the Predict function. It is a callback function, which allows to send continuously the responses as soon as it gets: 12345if p.Content != \"\" &#123; fn(PredictResult&#123; Content: p.Content, &#125;)&#125; It also relies on the convenient call to dyn_llama_server_completion_next_result (although itâ€™s also a direct call to a loaded C function llama_server_completion_next_result from a dynamic library based on llama.cpp). Others The other calls are similar as well. You can find them in llm/dyn_ext_server.go and llm/dyn_ext_server.c, such as dyn_llama_server_tokenize, dyn_llama_server_detokenize for tokenization or detokenization, and dyn_llama_server_embedding for computing the embeddings. 2. llama.cpp as a server for ollama Letâ€™s next check the C parts: how ollama uses llama.cpp as an LLM server. In the beginning of llm/dyn_ext_server.go, there are a bench of build instructions in the comments for cgo: 123456789101112131415161718/*#cgo CFLAGS: -I$&#123;SRCDIR&#125;/ext_server -I$&#123;SRCDIR&#125;/llama.cpp -I$&#123;SRCDIR&#125;/llama.cpp/common -I$&#123;SRCDIR&#125;/llama.cpp/examples/server#cgo CFLAGS: -DNDEBUG -DLLAMA_SERVER_LIBRARY=1 -D_XOPEN_SOURCE=600 -DACCELERATE_NEW_LAPACK -DACCELERATE_LAPACK_ILP64#cgo CFLAGS: -Wmissing-noreturn -Wextra -Wcast-qual -Wno-unused-function -Wno-array-bounds#cgo CPPFLAGS: -Ofast -Wextra -Wno-unused-function -Wno-unused-variable -Wno-deprecated-declarations#cgo darwin CFLAGS: -D_DARWIN_C_SOURCE#cgo darwin CPPFLAGS: -DGGML_USE_ACCELERATE#cgo darwin CPPFLAGS: -DGGML_USE_METAL -DGGML_METAL_NDEBUG#cgo darwin LDFLAGS: -lc++ -framework Accelerate#cgo darwin LDFLAGS: -framework Foundation -framework Metal -framework MetalKit -framework MetalPerformanceShaders#cgo linux CFLAGS: -D_GNU_SOURCE#cgo linux LDFLAGS: -lrt -ldl -lstdc++ -lm#cgo linux windows LDFLAGS: -lpthread#include &lt;stdlib.h&gt;#include \"dyn_ext_server.h\"*/ They are able to set different build and link flags for different platforms (darwin for macOS, and of course linux for Linux while windows for Windows). So that cgo is able to find the C header files (declarations of the existing types and functions) to compile and link llm/dyn_ext_server.c with the go parts. Letâ€™s then go to check the C functions used in ollama, from the dynamic library. As two examples, we start with llama_server_init and llama_server_start. Their implementations are located in llm/ext_server/ext_server.cpp, which is set as a library target named by ext_server in llm/ext_server/CMakeLists.txt. During the building the target, this file will be compiled with llama.cpp example server together. The compiled result is one of the dynamic libraries that we mentioned. As a result, the C functions in ext_server.cpp can be called from ollama, and are able to leverage the functions in llama.cpp. It actually acts as a bridge between the two projects, and makes the example server in llama.cpp a server for ollama. During the initialization, llama_server_init parses the parameters to create a context for the server, and calls the functions provided by llama.cpp: 1234567891011121314151617void llama_server_init(ext_server_params *sparams, ext_server_resp_t *err) &#123; /* ... */ llama = new llama_server_context; /* ... */ llama_backend_init(); llama_numa_init(params.numa); /* ... */ if (!llama-&gt;load_model(params)) &#123; // an error occurred that was not thrown err-&gt;id = -1; snprintf(err-&gt;msg, err-&gt;msg_len, \"error loading model %s\", params.model.c_str()); return; &#125; /* ... */ llama-&gt;initialize(); /* ... */&#125; For example, it calls llama_backend_init to initialize the backend (could be AVX, CUDA, etc), and llama_numa_init to initialize the NUMA (if exists). Then it calls the load_model function in the server context with the given parameters to load the model and finalize the initialization with initialize function. In case of error, the error messages are formatted to the err argument to return and be processed in go parts. Meanwhile in llama_server_start: 123456789101112131415161718192021222324252627282930void llama_server_start() &#123; assert(llama != NULL); // TODO mutex to protect thread creation ext_server_thread = std::thread([&amp;]() &#123; try &#123; LOG_TEE(\"llama server main loop starting\\n\"); ggml_time_init(); llama-&gt;queue_tasks.on_new_task(std::bind( &amp;llama_server_context::process_single_task, llama, std::placeholders::_1)); llama-&gt;queue_tasks.on_finish_multitask(std::bind( &amp;llama_server_context::on_finish_multitask, llama, std::placeholders::_1)); llama-&gt;queue_tasks.on_all_tasks_finished(std::bind( &amp;llama_server_context::run_on_all_tasks_finished, llama)); llama-&gt;queue_results.on_multitask_update(std::bind( &amp;llama_server_queue::update_multitask, &amp;llama-&gt;queue_tasks, std::placeholders::_1, std::placeholders::_2, std::placeholders::_3 )); llama-&gt;queue_tasks.start_loop(); &#125; catch (std::exception &amp;e) &#123; LOG_TEE(\"caught exception in llama server main loop: %s\\n\", e.what()); &#125; catch (...) &#123; LOG_TEE(\"caught unknown exception in llama server main loop\\n\"); &#125; LOG_TEE(\"\\nllama server shutting down\\n\"); llama_backend_free(); &#125;);&#125; It sets some callbacks for the task processing, and starts an event loop in a new thread. The event loop is in charge of the predictions. So that the call to llama_server_start is returned immediately. More detailed implementations of such C functions can be found in the same file, i.e. llm/ext_server/ext_server.cpp. 3. Embed libraries as payloads Then, letâ€™s explore how the payloads are done. In the go files with payload_* prefix, we can see the choice of ollama. For instance, there is two lines to embed every ext_server libraries with different variants in llm/payload_linux.go: 12//go:embed llama.cpp/build/linux/*/*/lib/*var libEmbed embed.FS All the built libraries under llama.cpp/build/linux/*/*/lib/ are embedded as payloads using a filesystem like interface. So that ollama can access them like reading and writing in a filesystem. During the initialization of ollama, Init in llm/payload_common.go will call nativeInit: 123func Init() error &#123; return nativeInit()&#125; It mainly works on extracting the dynamic libraries from the file system to a temporary location, and check driver access permission if applicable: 123libs, err := extractDynamicLibs(payloadsDir, \"llama.cpp/build/*/*/*/lib/*\")/* ... */err := verifyDriverAccess() After the extraction, ollama is able to format the library path (libPath used in the dyn_init function in the External server subsection). The way to choose the running environment and the matching library will be presented in the Decide where to run section. 4. Formatted request and response Letâ€™s then go back to the function arguments used in the C functions. 1234567891011inline void dyn_llama_server_init(struct dynamic_llama_server s, ext_server_params_t *sparams, ext_server_resp_t *err) &#123; s.llama_server_init(sparams, err);&#125;inline void dyn_llama_server_completion(struct dynamic_llama_server s, const char *json_req, ext_server_resp_t *resp) &#123; s.llama_server_completion(json_req, resp);&#125; In their function signatures, we can see the function arguments they use: ext_server_params_t in dyn_llama_server_init, and a json_req byte array in dyn_llama_server_completion. The ext_server_params_t argument is a C struct carrying the configurations to launch the llama server, which will be interpreted later in llm/ext_server/server.cpp(We do not expand this part due to shortage of pages). Meanwhile, the json_req for the completion call is used as follows, in llm/ext_server/ext_server.cpp: 123456789101112131415161718void llama_server_completion(const char *json_req, ext_server_resp_t *resp) &#123; assert(llama != NULL &amp;&amp; json_req != NULL &amp;&amp; resp != NULL); resp-&gt;id = -1; resp-&gt;msg[0] = '\\0'; try &#123; if (shutting_down) &#123; throw std::runtime_error(\"server shutting down\"); &#125; json data = json::parse(json_req); resp-&gt;id = llama-&gt;queue_tasks.get_new_id(); llama-&gt;queue_results.add_waiting_task_id(resp-&gt;id); llama-&gt;request_completion(resp-&gt;id, data, false, false, -1); &#125; catch (std::exception &amp;e) &#123; snprintf(resp-&gt;msg, resp-&gt;msg_len, \"exception %s\", e.what()); &#125; catch (...) &#123; snprintf(resp-&gt;msg, resp-&gt;msg_len, \"Unknown exception during completion\"); &#125;&#125; Indeed, it contains the completion request in json format, including the prompt, temperature, etc. We can see that llama_server_completion creates a task for it and return the task ID through resp in the normal path. Otherwise, it formats the error information for returning. If you are interested in its detailed format, please check llm/dyn_ext_server.go file. 5. Patches There are a few extra modifications on the original version of llama.cpp, to adapt the usage of multiple llama servers in ollama. For example, the following patch exports ggml_free_cublas and call it to release an instance of llama server: 1234567891011121314151617181920212223diff --git a/examples/server/server.cpp b/examples/server/server.cppindex 7800c6e7..be30db23 100644--- a/examples/server/server.cpp+++ b/examples/server/server.cpp@@ -30,6 +30,10 @@ #include &lt;atomic&gt; #include &lt;signal.h&gt; +#ifdef GGML_USE_CUBLAS+extern \"C\" GGML_CALL void ggml_free_cublas(void);+#endif+ using json = nlohmann::json; struct server_params@@ -353,6 +357,9 @@ struct llama_server_context llama_free_model(model); model = nullptr; &#125;+#ifdef GGML_USE_CUBLAS+ ggml_free_cublas();+#endif &#125; Wrap them up With all the extra modules and modifications on llama.cpp, ollama is thus able to start a llama server as needed, dynamically choosing the hardware with the supports of different hardware in the different compiled dynamic libraries (see Build system). After running the llama server, the extra modules provided by ollama allow to send the completion request, and retrieve the replies later. Til now, it should be clear with a global view on the ollama architecture behind (or we can call it backend, as usual). For the details in the backend, readers can check the source code since they are subjective to be changed very often. After all, ollama is under active development. There are still a few mysteries: backend side: how ollama knows which hardware and which dynamic libraries to choose? frontend side: which kind of frontend does it provide? The following sections might be the answers for these questions. Decide where to run Letâ€™s go back to the dynamic libraries and libPath argument in the dyn_init, mentioned in Dynamic library loading and server starting. We have already known in Embed libraries as payloads, that ollama will extract the embedded dynamic libraries to a temporary directory, and load them by formatting and passing libPath to dyn_init. The question is: how ollama chooses the libraries by passing the different libPath argument? The libPath is passed as the first argument library in the newDynExtServer function implemented in llm/dyn_ext_server.go. It is updated on Windows by a call to gpu.UpdatePath(filepath.Dir(library)), in order to add the parent directory to the PATH. So that the dynamic libraries can be loaded seamlessly. However, itâ€™s not necessary to do so on Linux or macOS. Therefore, we can know that the libPath here is already a full path to the dynamic library files. Letâ€™s then check where the libPath is generated. A simple search gives a response in the newLlmServer function under llm/llm.go: 123456789err2 := fmt.Errorf(\"unable to locate suitable llm library\")for _, dynLib := range dynLibs &#123; srv, err := newDynExtServer(dynLib, model, adapters, projectors, opts) if err == nil &#123; return srv, nil &#125; slog.Warn(fmt.Sprintf(\"Failed to load dynamic library %s %s\", dynLib, err)) err2 = err&#125; It iterates the dynLibs to call newDynExtServer function. Once there is one successful loading, it returns the llama server instance. At the beginning of newLlmServer, the dynLibs are generally retrieved in getDynLibs function, which is an ordered list of dynamic libraries to try: 1234func newLlmServer(gpuInfo gpu.GpuInfo, model string, adapters, projectors []string, opts api.Options) (LLM, error) &#123; dynLibs := getDynLibs(gpuInfo) /* ... */&#125; The order is a preference, which takes the GPU information from gpuInfo gpu.GpuInfo. It is not forced to be the â€œGPU informationâ€, it can also indicate to use a certain CPU variant. I think ollama team may change it very soon. In general, the returned dynLibs are from a key-value mapping availableDynLibs in llm/payload_common.go. It is generated in nativeInit, after the extraction of all the dynamic libraries: 1234567891011func nativeInit() error &#123; /* ... */ /* Extract dynamic libraries in temporary directory */ /* ... */ for _, lib := range libs &#123; // The last dir component is the variant name variant := filepath.Base(filepath.Dir(lib)) availableDynLibs[variant] = lib &#125; /* ... */&#125; The key is the last component of the full path, except the library file name. For example, it is be cpu, cpu_avx, cpu_avx2, cuda_v11.3 and rocm_v5.7 on my PC. And the values are certainly the full path. We can first take a look at the general processing in getDynLibs function(which is implemented in llm/payload_common.go), by ignoring some platform-specific cases. The first step is to find the exact match of the requested one from the â€œGPU informationâ€: 123456789101112131415exactMatch := \"\"dynLibs := []string&#123;&#125;altDynLibs := []string&#123;&#125;requested := gpuInfo.Libraryif gpuInfo.Variant != \"\" &#123; requested += \"_\" + gpuInfo.Variant&#125;// Try to find an exact matchfor cmp := range availableDynLibs &#123; if requested == cmp &#123; exactMatch = cmp dynLibs = []string&#123;availableDynLibs[cmp]&#125; break &#125;&#125; It makes a requested string by Library with an appended Variant from the â€œGPU informationâ€. If there is one matched exactly to the requested string, the first library path in dynLibs would be the path to the requested library. The first library path will also be the first to try during the loading. It then tries GPU libraries with not exact matches (where there could be some version mismatches, etc.): 123456789101112// Then for GPUs load alternates and sort the list for consistent load orderingif gpuInfo.Library != \"cpu\" &#123; for cmp := range availableDynLibs &#123; if gpuInfo.Library == strings.Split(cmp, \"_\")[0] &amp;&amp; cmp != exactMatch &#123; altDynLibs = append(altDynLibs, cmp) &#125; &#125; slices.Sort(altDynLibs) for _, altDynLib := range altDynLibs &#123; dynLibs = append(dynLibs, availableDynLibs[altDynLib]) &#125;&#125; Next, it tries to prioritize the fastest (maybe) CPU variant by calling another utility function GetCPUVariant: 123456789101112131415161718// Load up the best CPU variant if not primary requestedif gpuInfo.Library != \"cpu\" &#123; variant := gpu.GetCPUVariant() // If no variant, then we fall back to default // If we have a variant, try that if we find an exact match // Attempting to run the wrong CPU instructions will panic the // process if variant != \"\" &#123; for cmp := range availableDynLibs &#123; if cmp == \"cpu_\"+variant &#123; dynLibs = append(dynLibs, availableDynLibs[cmp]) break &#125; &#125; &#125; else &#123; dynLibs = append(dynLibs, availableDynLibs[\"cpu\"]) &#125;&#125; This utility is defined in gpu/cpu_common.go. It detects the CPU extensions on x86 platform: 12345678910111213func GetCPUVariant() string &#123; if cpu.X86.HasAVX2 &#123; slog.Info(\"CPU has AVX2\") return \"avx2\" &#125; if cpu.X86.HasAVX &#123; slog.Info(\"CPU has AVX\") return \"avx\" &#125; slog.Info(\"CPU does not have vector extensions\") // else LCD return \"\"&#125; The order will give avx2 as the highest preference, then avx, and finally the pure CPU variant. Finally, it fallbacks to CPU variant if none of the above methods work: 1234567891011func getDynLibs(gpuInfo gpu.GpuInfo) []string &#123; /* Apple specific loading */ /* ... */ // Finally, if we didn't find any matches, LCD CPU FTW if len(dynLibs) == 0 &#123; dynLibs = []string&#123;availableDynLibs[\"cpu\"]&#125; &#125; slog.Debug(fmt.Sprintf(\"ordered list of LLM libraries to try %v\", dynLibs)) return dynLibs&#125; The dynLibs are then returned for the loading tries. We can now explore how the â€œGPU informationâ€ gpuInfo is generated to make the preference possible. The New function in llm/llm.go calls newLlmServer with the â€œGPU informationâ€ as the first argument. It completes many important works: Open, load and detect the parameters of an LLM. Load â€œGPU informationâ€: info := gpu.GetGPUInfo(). Check the VRAM and the compatibility of the model to the hardware. The initial detection is performed in 2. However, it is also possible that the model is marked as incompatible to the model. In this case, it will fallback to the CPU with the fastest variant: 12info.Library = \"cpu\"info.Variant = gpu.GetCPUVariant() Letâ€™s only concentrate on 2, to see what happened in the GetGPUInfo function. Apple Metal Letâ€™s start with the most special platform. Apple macOS platform, including the XNU kernel and the userspace, is usually called darwin. In the aforementioned getDynLibs, the Darwin detection is very simple: 1234567891011// Short circuit if we know we're using the default built-in (darwin only)if gpuInfo.Library == \"default\" &#123; return []string&#123;\"default\"&#125;&#125;// TODO - temporary until we have multiple CPU variations for Darwin// Short circuit on darwin with metal onlyif len(availableDynLibs) == 1 &#123; if _, onlyMetal := availableDynLibs[\"metal\"]; onlyMetal &#123; return []string&#123;availableDynLibs[\"metal\"]&#125; &#125;&#125; It uses default library according to the â€œGPU informationâ€, or just use metal. The gpu.GetGPUInfo() is in gpu/gpu_darwin.go, as simple as possible: 1234567891011121314func GetGPUInfo() GpuInfo &#123; mem, _ := getCPUMem() if runtime.GOARCH == \"amd64\" &#123; return GpuInfo&#123; Library: \"cpu\", Variant: GetCPUVariant(), memInfo: mem, &#125; &#125; return GpuInfo&#123; Library: \"metal\", memInfo: mem, &#125;&#125; We can see that, it gets the memory information and detects whether ollama is running on the Intel x86_64/amd64 platform. If so, it just uses the CPU with the fastest extension. Otherwise, only ARM Mac can leverage the Metal API to accelerate. From my best know, the AMD graphic cards on Intel Mac should also have Metal support. But it will not be used on Intel Mac by ollama. Probably, itâ€™s just due to the outdated drivers or the outdated graphic cards itself. Nvidia CUDA and AMD ROCm We then check the general detection of Nvidia and AMD GPUs, since they are kind of coupled together in ollama. The implementation is in gpu/gpu.go: 123456789101112131415161718192021222324252627func GetGPUInfo() GpuInfo &#123; // TODO - consider exploring lspci (and equivalent on windows) to check for // GPUs so we can report warnings if we see Nvidia/AMD but fail to load the libraries gpuMutex.Lock() defer gpuMutex.Unlock() if gpuHandles == nil &#123; initGPUHandles() &#125; // All our GPU builds on x86 have AVX enabled, so fallback to CPU if we don't detect at least AVX cpuVariant := GetCPUVariant() if cpuVariant == \"\" &amp;&amp; runtime.GOARCH == \"amd64\" &#123; slog.Warn(\"CPU does not have AVX or AVX2, disabling GPU support.\") &#125; var memInfo C.mem_info_t resp := GpuInfo&#123;&#125; /* Getting the actual GPU information */ /* ... */ /* Fallback to CPU if no GPU detected */ /* ... */ resp.DeviceCount = uint32(memInfo.count) resp.FreeMemory = uint64(memInfo.free) resp.TotalMemory = uint64(memInfo.total) return resp&#125; The first block calls initGPUHandles to define the GPU libraries to search, in order to use them to get the GPU information. For Nvidia, it detects nvml.dll for discrete graphic cards on Windows, libnvidia-ml.so on Linux, and libcudart.so* on some special devices, such as Jetson family (thanks to a recent PR). The second block detects the CPU variant, it somehow requires at least AVX variant from the CPU to enable the GPU support. It then checks the handles and uses the libraries to lookup GPUs accordingly. For Nvidia discrete GPUs: 1234567891011121314151617181920if gpuHandles.nvml != nil &amp;&amp; (cpuVariant != \"\" || runtime.GOARCH != \"amd64\") &#123; C.nvml_check_vram(*gpuHandles.nvml, &amp;memInfo) if memInfo.err != nil &#123; slog.Info(fmt.Sprintf(\"[nvidia-ml] error looking up NVML GPU memory: %s\", C.GoString(memInfo.err))) C.free(unsafe.Pointer(memInfo.err)) &#125; else if memInfo.count &gt; 0 &#123; // Verify minimum compute capability var cc C.nvml_compute_capability_t C.nvml_compute_capability(*gpuHandles.nvml, &amp;cc) if cc.err != nil &#123; slog.Info(fmt.Sprintf(\"[nvidia-ml] error looking up NVML GPU compute capability: %s\", C.GoString(cc.err))) C.free(unsafe.Pointer(cc.err)) &#125; else if cc.major &gt; CudaComputeMin[0] || (cc.major == CudaComputeMin[0] &amp;&amp; cc.minor &gt;= CudaComputeMin[1]) &#123; slog.Info(fmt.Sprintf(\"[nvidia-ml] NVML CUDA Compute Capability detected: %d.%d\", cc.major, cc.minor)) resp.Library = \"cuda\" &#125; else &#123; slog.Info(fmt.Sprintf(\"[nvidia-ml] CUDA GPU is too old. Falling back to CPU mode. Compute Capability detected: %d.%d\", cc.major, cc.minor)) &#125; &#125;&#125; It calls a C function nvml_check_vram implemented in gpu/gpu_info_nvml.c to get the VRAM. If found one usable device, it will also check the compute capability through nvml_compute_capability, to make sure that the device is usable. This design has prevented me from using ZLUDA to run an LLM through ollama on my AMD graphic card on Windows. Because ZLUDA was marking this function as unimplemented at that time. However, there is already the support to my AMD graphic card. I do not need the ZLUDA anymore now. I just would just skip the Cudart support because itâ€™s not a common case. Letâ€™s go through the recent exciting AMD support now! The code in GetGPUInfo for AMD is very short: 123456else &#123; AMDGetGPUInfo(&amp;resp) if resp.Library != \"\" &#123; return resp &#125;&#125; You may notice that it is an â€œelseâ€. So, along with the â€œifâ€ clause, AMD will be tried, only if Nvidia handle is not detected. This would cause an issue: when there are Nvidia GPU libraries installed, however no GPU detected or the detected GPUs are not compatible, AMD graphic cards would never be detected as well. I opened an issue for this. OK, let go back to the GetGPUInfo. If Nvidia graphic card is detected, the Library in the â€œGPU informationâ€ will be set to cuda. For AMD, it will be rocm. So, if the detection succeeded, the â€œGPU informationâ€ will work with the availableDynLibs to prioritize the library paths for cuda_* or rocm_* variants. That unveils how the GPUs are detected and potentially used when creating the llama servers from a bunch of dynamic libraries. Web service and client Letâ€™s then take a look at the â€œfrontendâ€! There is indeed no so-called frontend in ollama. Instead, it provides a bench of Web APIs, just like most of the other LLM services. The basic Web APIs are implemented in server, mostly in the server/routes.go module. The full API endpoints are available at GitHub. Here, we also just take the chat completion endpoint as a quick example to build the view from the API endpoint to what we have seen above. The endpoint is defined as: 1r.POST(&quot;/api/chat&quot;, ChatHandler) where ChatHandler is a callback to handle the request. It creates and parses the request in a var req api.ChatRequest struct. The handler will do a lot of things such as loading the model, to make sure that the prediction is possible. When everything is ready, the most important thing is here: 12345678910// Start predictionpredictReq := llm.PredictOpts&#123; Prompt: prompt, Format: req.Format, Images: images, Options: opts,&#125;if err := loaded.runner.Predict(c.Request.Context(), predictReq, fn); err != nil &#123; ch &lt;- gin.H&#123;\"error\": err.Error()&#125;&#125; It prepares the prediction request with the prompt (user inputs, prompts, etc.), images, and other options. Then it calls the Prediction function of runner, where the runner needs to implement the LLM interface under the llm module: 1234567891011var loaded struct &#123; mu sync.Mutex runner llm.LLM expireAt time.Time expireTimer *time.Timer *Model *api.Options&#125; The LLM interface is: 1234567type LLM interface &#123; Predict(context.Context, PredictOpts, func(PredictResult)) error Embedding(context.Context, string) ([]float64, error) Encode(context.Context, string) ([]int, error) Decode(context.Context, []int) (string, error) Close()&#125; And the implementation of Predict is from dynExtServer described in Prediction section. It will then call dyn_llama_server_completion and thus request the started llama server from one of the dynamic libraries. So, we have the link now. Go API of Ollama Intrinsically, ollama provides a wrapper in Go under api. Users can leverage it to call the Web APIs easier. Indeed, ollama itself also uses the Go wrapper to provide the actual frontend - a terminal UI. There are also Python and JavaScript/TypeScript bindings: https://github.com/ollama/ollama-python https://github.com/ollama/ollama-js OpenAI API wrapper Despite of the native API endpoints, ollama also provides an OpenAI API-compatible (well, partially compatible) endpoint in server/routes.go: 12// Compatibility endpointsr.POST(&quot;/v1/chat/completions&quot;, openai.Middleware(), ChatHandler) Itâ€™s indeed a convertor from OpenAI requests to ollama native requests, and vice-versa for responses. You can check openai/openai.go if itâ€™s interesting to you. Other utilities The terminal UI leverages the Go wrapper of the Web API endpoints to provide a terminal-based conversations. It needs some utilities such as readline to interact with the user inputs in the terminal, and progress to show the progress. There are also the auth for API endpoint authentication, cmd for cli commands provider, format for unit conversion, parser for model file parsing, etc. Check them in detail as your wish. This post has been long enough and just concentrate on the overall architecture of ollama. I am also eager to seeing the other posts about it ğŸ˜‰ Conclusion Finally, I would end up with a simple figure for the ollama architecture before runtime: I would say as well: ollama is a thin (maybe not so thin) but smart enough wrapper of llama.cpp. Although it still has a few drawbacks, we really need as many these kinds of wrappers as possible, to make the life easier for any end-users.","categories":[{"name":"AI","slug":"AI","permalink":"https://blog.inoki.cc/categories/AI/"},{"name":"LLM","slug":"AI/LLM","permalink":"https://blog.inoki.cc/categories/AI/LLM/"}],"tags":[{"name":"LLM","slug":"LLM","permalink":"https://blog.inoki.cc/tags/LLM/"},{"name":"ollama","slug":"ollama","permalink":"https://blog.inoki.cc/tags/ollama/"}]},{"title":"åœ¨ Proxy ç¯å¢ƒä¸­ä½¿ç”¨ GitHub SSH çš„ git æ“ä½œ","slug":"GitHub-ssh-connection-behind-proxy","date":"2024-03-08T06:02:23.000Z","updated":"2025-03-08T09:40:48.565Z","comments":true,"path":"2024/03/08/GitHub-ssh-connection-behind-proxy/","link":"","permalink":"https://blog.inoki.cc/2024/03/08/GitHub-ssh-connection-behind-proxy/","excerpt":"","text":"ä¸Šæ¬¡å›å›½ï¼Œå‘ç°å¢™åˆé«˜äº†ï¼šGitHub çš„ SSH ç«¯å£ï¼ˆ22ï¼‰ç°åœ¨ä¼šå®Œå…¨è¢«é˜»æ–­ï¼Œå¯¼è‡´æ— æ³•æ­£å¸¸ä½¿ç”¨ SSH åè®®è¿›è¡Œ git cloneã€git pull ç­‰æ“ä½œã€‚ äº‹å®ä¸Šï¼Œå°ç¦ 22 ç«¯å£åœ¨å…¬å¸ç½‘ç»œç¯å¢ƒä¸­ä¹Ÿå¯èƒ½æ˜¯ä¸€ä¸ªå¾ˆæ™®éçš„æ“ä½œï¼Œç”¨äºç¦æ­¢å‘˜å·¥éšæ„ä½¿ç”¨ ssh ç™»å½•ä¸å—æ§çš„æœºå™¨ã€‚ è¿™ç§æƒ…å†µä¸‹ï¼ŒGitHub å®˜æ–¹æ˜¯æ¨èä½¿ç”¨ HTTPS åè®®è¿›è¡Œå…‹éš†çš„ï¼Œä½†æ˜¯éœ€è¦é…ç½® GitHub çš„ login é›†æˆæˆ–è€…æ˜¯ä½¿ç”¨ token æ¥è¿›è¡Œç§æœ‰ä»“åº“çš„æ“ä½œã€‚ä½†å¦‚æœä»ç„¶å¸Œæœ›ä½¿ç”¨ SSHï¼Œå¯ä»¥å‚è€ƒæœ¬æ–‡çš„åšæ³•ï¼Œä»…æ­¤è®°å½•ä¸€ä¸‹ã€‚ é—®é¢˜ç°è±¡ é¦–å…ˆå¯ä»¥æµ‹è¯•ä¸€ä¸‹ SSH æ˜¯ä¸æ˜¯è¢«é˜»æ–­äº†ï¼Œå½“ä½ å°è¯•ä½¿ç”¨ SSH è¿æ¥ GitHub æ—¶ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š 1$ ssh -T git@github.com å¦‚æœé‡åˆ°è¿æ¥è¶…æ—¶æˆ–è¢«æ‹’ç»çš„æƒ…å†µï¼Œé‚£ä¹ˆå°±æ˜¯è¢«é˜»æ–­äº†ï¼ŒåŒæ—¶ HTTP_PROXYã€HTTPS_PROXY å’Œ ALL_PROXY ä»…å¯¹ HTTPS åè®®çš„ git æ“ä½œæœ‰æ•ˆï¼Œå¹¶ä¸ä¼šå¯¹ SSH åè®®çš„ git æ“ä½œç”Ÿæ•ˆã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒGitHub æä¾›äº†åŸºäº HTTPSï¼ˆ443ï¼‰ç«¯å£çš„ SSH åè®®çš„è¿æ¥æ–¹å¼ï¼Œå¯ä»¥ç»•å¼€é’ˆå¯¹ SSH 22 ç«¯å£çš„å°ç¦ã€‚ å¦‚æœæ”¹ç”¨ 443 ç«¯å£ä¸Šçš„ SSH è¿æ¥å¯ä»¥æˆåŠŸçš„è¯ï¼ˆè¯´æ˜ä¸æ˜¯åŸºäºåè®®è¯†åˆ«å°ç¦çš„ï¼‰ï¼š 123$ ssh -T -p 443 git@ssh.github.com# Hi USERNAME! You've successfully authenticated, but GitHub does not# provide shell access. é‚£ä¹ˆå°±å¯ä»¥é‡‡ç”¨è¿™ç§æ–¹å¼ã€‚ æ–¹æ¡ˆ 1ï¼šæ‰‹åŠ¨æ›´æ”¹ SSH å‘½ä»¤ åœ¨ git clone æˆ– git pull ç­‰å‘½ä»¤ä¸­æ‰‹åŠ¨ä½¿ç”¨ ssh.github.com å¹¶æŒ‡å®š SSH ç«¯å£ä¸º 443ã€‚ä¾‹å¦‚ï¼š 1git clone ssh://git@ssh.github.com:443/your-repo.git æˆ–è€…åœ¨å·²æœ‰çš„ä»“åº“ä¸­ä¿®æ”¹è¿œç¨‹ URLï¼š 1git remote set-url origin ssh://git@ssh.github.com:443/your-repo.git ä½†è¿™å°±éœ€è¦å¯¹æ‰€ç”¨åˆ°çš„ä»“åº“éƒ½è¿›è¡Œä¿®æ”¹ï¼Œå¤ªéº»çƒ¦äº†ã€‚ æ–¹æ¡ˆ 2ï¼šä¿®æ”¹ SSH é…ç½®æ–‡ä»¶ ä½ ä¹Ÿå¯ä»¥ç›´æ¥ä¿®æ”¹ SSH é…ç½®æ–‡ä»¶ï¼ˆ~/.ssh/configï¼‰ï¼Œè®© SSH å°† github.com ç›´æ¥å½“ä½œ ssh.github.com çš„åˆ«åæ¥è¿æ¥ GitHubï¼Œå¹¶è‡ªåŠ¨ä½¿ç”¨ 443 ç«¯å£ã€‚ ç¼–è¾‘ ~/.ssh/configï¼ˆå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œå¯ä»¥æ‰‹åŠ¨åˆ›å»ºï¼‰ï¼š 123456echo \"Host github.com Hostname ssh.github.com Port 443 User git\" &gt;&gt; ~/.ssh/config ç„¶åæµ‹è¯• SSH è¿æ¥ï¼š 1$ ssh -T git@github.com å¦‚æœè¾“å‡ºå¦‚ä¸‹ä¿¡æ¯ï¼Œè¯´æ˜é…ç½®æˆåŠŸï¼š 12# Hi USERNAME! You&apos;ve successfully authenticated, but GitHub does not# provide shell access æ–¹æ¡ˆ 3ï¼šå¼ºåˆ¶ä½¿ç”¨ SOCKS5 ä»£ç†è¿›è¡Œ SSH è¿æ¥ å¦‚æœä½ ä¸æƒ³ä½¿ç”¨ ssh.github.comï¼Œå¹¶ä¸”å·²ç»åœ¨æœ¬åœ°é…ç½®äº† SOCKS5 ä»£ç†ï¼Œå¯ä»¥è®© git SSH é€šè¿‡ä»£ç†è¿æ¥ GitHubã€‚ åœ¨ ~/.ssh/config æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š 123Host github.com Hostname github.com ProxyCommand nc -X 5 -x 127.0.0.1:1080 %h %p å…¶ä¸­ 127.0.0.1:1080 æ˜¯æœ¬åœ° SOCKS5 ä»£ç†çš„åœ°å€ï¼Œæ ¹æ®ä½ çš„ä»£ç†å·¥å…·è°ƒæ•´ã€‚ ä¹Ÿå¯ä»¥ä½¿ç”¨ GIT_SSH_COMMAND ç¯å¢ƒå˜é‡æ¥ä¿®æ”¹é»˜è®¤ SSH è¿æ¥å‘½ä»¤ï¼Œè¯¦æƒ…å¯å‚è€ƒ git çš„æ–‡æ¡£ã€‚ ç»“è®º å¦‚æœå½“å‰ç½‘ç»œå°ç¦äº† 22 ç«¯å£æ—¶ï¼Œä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸‰ç§æ–¹æ³•ç»•è¿‡é’ˆå¯¹ GitHub çš„å°é”ï¼š ç›´æ¥ä½¿ç”¨ ssh://git@ssh.github.com:443/your-repo.git è¿›è¡Œ Git æ“ä½œã€‚ ä¿®æ”¹ ~/.ssh/configï¼Œè®© GitHub è¿æ¥è‡ªåŠ¨èµ° ssh.github.com çš„ 443 ç«¯å£ã€‚ ä½¿ç”¨ SOCKS5 ä»£ç†ï¼Œè®© SSH é€šè¿‡ä»£ç†è®¿é—® GitHubã€‚ ä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„ç½‘ç»œç¯å¢ƒé€‰æ‹©æœ€é€‚åˆçš„æ–¹æ³•ï¼Œç¡®ä¿é¡ºç•…åœ°è®¿é—® GitHubã€‚","categories":[{"name":"Network","slug":"Network","permalink":"https://blog.inoki.cc/categories/Network/"},{"name":"Protocol","slug":"Protocol","permalink":"https://blog.inoki.cc/categories/Protocol/"},{"name":"Proxy","slug":"Network/Proxy","permalink":"https://blog.inoki.cc/categories/Network/Proxy/"}],"tags":[{"name":"GitHub","slug":"GitHub","permalink":"https://blog.inoki.cc/tags/GitHub/"},{"name":"SSH","slug":"SSH","permalink":"https://blog.inoki.cc/tags/SSH/"},{"name":"git","slug":"git","permalink":"https://blog.inoki.cc/tags/git/"},{"name":"Proxy","slug":"Proxy","permalink":"https://blog.inoki.cc/tags/Proxy/"}]},{"title":"ã€è¯‘ã€‘è§£é‡Š SDXL çš„éšç©ºé—´","slug":"Explaining-the-SDXL-latent-space","date":"2024-02-18T03:57:50.000Z","updated":"2025-03-08T09:40:48.564Z","comments":true,"path":"2024/02/18/Explaining-the-SDXL-latent-space/","link":"","permalink":"https://blog.inoki.cc/2024/02/18/Explaining-the-SDXL-latent-space/","excerpt":"","text":"åŸæ–‡åœ°å€ï¼šhttps://huggingface.co/blog/TimothyAlexisVass/explaining-the-sdxl-latent-space ç®€çŸ­çš„èƒŒæ™¯ ç‰¹åˆ«æ„Ÿè°¢ Ollin Boer Bohan Haomingã€ Cristina Segalin å’Œ Birchlabs æä¾›çš„ä¿¡æ¯ã€è®¨è®ºå’ŒçŸ¥è¯†å¸®åŠ©ï¼ æˆ‘æ­£åœ¨ä¸º SDXL æ¨ç†è¿‡ç¨‹åˆ›å»ºæ ¡æ­£æ»¤æ³¢å™¨ï¼Œä»¥ç”¨äºæˆ‘ä¸ºæ‰©æ•£æ¨¡å‹åˆ›å»ºçš„ç”¨æˆ·ç•Œé¢ã€‚ åœ¨æ‹¥æœ‰å¤šå¹´çš„å›¾åƒæ ¡æ­£ç»éªŒåï¼Œæˆ‘å¸Œæœ›èƒ½å¤Ÿä»æ ¹æœ¬ä¸Šæ”¹è¿› SDXL çš„å®é™…è¾“å‡ºã€‚è¦åˆ›å»ºçš„ç”¨æˆ·ç•Œé¢ä¸­æœ‰è®¸å¤šæˆ‘æƒ³è¦çš„æŠ€æœ¯ï¼Œæˆ‘å¼€å§‹ç€æ‰‹è‡ªå·±è§£å†³è¿™äº›é—®é¢˜ã€‚æˆ‘æ³¨æ„åˆ°ï¼ŒSDXL çš„è¾“å‡ºå‡ ä¹æ€»æ˜¯æœ‰è§„å¾‹åœ°å‡ºç°å™ªç‚¹æˆ–è¿‡äºå¹³æ»‘ã€‚ç”±äºæ ‡æ¸…æ¨¡å‹çš„å·¥ä½œåŸç†ï¼Œè‰²å½©ç©ºé—´æ€»æ˜¯éœ€è¦ç™½å¹³è¡¡ï¼Œè‰²å½©èŒƒå›´æœ‰åå·®å’Œé™åˆ¶ã€‚ å¦‚æœå¯ä»¥åœ¨å®é™…è¾“å‡ºä¹‹å‰æ”¹å–„ä¿¡æ¯å’Œè‰²å½©èŒƒå›´ï¼Œé‚£ä¹ˆåœ¨å›¾åƒç”Ÿæˆå¹¶è½¬æ¢ä¸º 8 ä½ RGB ä¹‹åçš„åæœŸå¤„ç†ä¸­è¿›è¡Œä¿®æ­£å°±æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰äº†ã€‚ è¦åˆ›å»ºæ»¤é•œå’Œä¿®æ­£å·¥å…·ï¼Œæœ€é‡è¦çš„æ˜¯è¦äº†è§£ä½ æ­£åœ¨å¤„ç†çš„æ•°æ®ã€‚è¿™ä¿ƒä½¿æˆ‘å¼€å§‹å¯¹ SDXL çš„éšå±‚è¿›è¡Œå®éªŒæ€§æ¢ç´¢ï¼Œä»¥æœŸäº†è§£å®ƒä»¬ã€‚åŸºäº SDXL æ¶æ„çš„æ‰©æ•£æ¨¡å‹æ‰€ä½¿ç”¨çš„å¼ é‡å¦‚ä¸‹æ‰€ç¤ºï¼š 1[batch_size, 4 channels, height (y), width (x)] æˆ‘çš„ç¬¬ä¸€ä¸ªé—®é¢˜å¾ˆç®€å•ï¼šâ€œè¿™ 4 ä¸ªé€šé“åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿâ€ æˆ‘å¾—åˆ°çš„å¤§å¤šæ•°å›ç­”éƒ½æ˜¯â€œè¿™ä¸æ˜¯äººç±»èƒ½ç†è§£çš„ä¸œè¥¿â€ã€‚ä½†æˆ‘è®¤ä¸ºè¿™ç»å¯¹æ˜¯å¯ä»¥ç†è§£çš„ï¼Œç”šè‡³æ˜¯éå¸¸å®¹æ˜“ç†è§£å’Œæœ‰ç”¨çš„çŸ¥è¯†ã€‚ SDXL éšå±‚çš„ 4 ä¸ªé€šé“ å¯¹äºç”± SDXL ç”Ÿæˆçš„ 1024Ã—1024 åƒç´ çš„å›¾åƒï¼Œéšå±‚çš„å¼ é‡ä¸º 128Ã—128 åƒç´ ï¼Œå…¶ä¸­éšç©ºé—´ä¸­çš„æ¯ä¸ªåƒç´ ä»£è¡¨åƒç´ ç©ºé—´ä¸­çš„ 64 (8Ã—8) ä¸ªåƒç´ ã€‚å¦‚æœæˆ‘ä»¬å°†éšå±‚ç”Ÿæˆå¹¶è§£ç ä¸ºæ ‡å‡†çš„ 8 ä½ jpg å›¾åƒï¼Œé‚£ä¹ˆï¼š 8 ä½åƒç´ ç©ºé—´æ‹¥æœ‰ 3 ä¸ªé€šé“ çº¢è‰² Â®ã€ç»¿è‰² (G) å’Œè“è‰² (B)ï¼Œæ¯ä¸ªé€šé“æœ‰ 256 ä¸ªå¯èƒ½çš„å€¼ï¼ŒèŒƒå›´åœ¨ 0-255 ä¹‹é—´ã€‚å› æ­¤ï¼Œè¦å­˜å‚¨ 64 ä¸ªåƒç´ çš„å…¨éƒ¨ä¿¡æ¯ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ¯ä¸ªéšå±‚åƒç´ çš„æ¯ä¸ªé€šé“ä¸­å­˜å‚¨ 64Ã—256 = 16384 ä¸ªå€¼ã€‚ å›¾åƒçš„ SDXL éšå±‚è¡¨ç¤ºæœ‰ 4 ä¸ªé€šé“ï¼š 0ï¼šäº®åº¦ 1ï¼šé’è‰²/çº¢è‰² =&gt; ç›¸å½“äº rgb(0, 255, 255)/rgb(255, 0, 0) 2ï¼šæ·¡ç´«è‰²/ä¸­ç´«è‰² =&gt; ç›¸å½“äº rgb(127, 255, 0)/rgb(127, 0, 255) 3ï¼šå›¾æ¡ˆ/ç»“æ„ã€‚ å¦‚æœåœ¨è§£ç æ—¶æ¯ä¸ªå€¼çš„èŒƒå›´éƒ½åœ¨ -4 å’Œ 4 ä¹‹é—´ï¼Œé‚£ä¹ˆåœ¨åŠç²¾åº¦çš„ 16 ä½æµ®ç‚¹æ ¼å¼ä¸­ï¼Œæ¯ä¸ªéšå±‚åƒç´ çš„ 4 ä¸ªé€šé“éƒ½å¯ä»¥åŒ…å« 16384 ä¸ªä¸åŒçš„å€¼ã€‚ é€šè¿‡çº¿æ€§è¿‘ä¼¼å°† SDXL æ½œåœ¨åƒç´ ç›´æ¥è½¬æ¢ä¸º RGB æœ‰äº†è¿™ç§ç†è§£ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ›å»ºä¸€ä¸ªè¿‘ä¼¼å‡½æ•°ï¼Œå°†éšå±‚åƒç´ ç›´æ¥è½¬æ¢ä¸º RGBï¼š 1234567891011121314def latents_to_rgb(latents): weights = ( (60, -60, 25, -70), (60, -5, 15, -50), (60, 10, -5, -35) ) weights_tensor = torch.t(torch.tensor(weights, dtype=latents.dtype).to(latents.device)) biases_tensor = torch.tensor((150, 140, 130), dtype=latents.dtype).to(latents.device) rgb_tensor = torch.einsum(\"...lxy,lr -&gt; ...rxy\", latents, weights_tensor) + biases_tensor.unsqueeze(-1).unsqueeze(-1) image_array = rgb_tensor.clamp(0, 255)[0].byte().cpu().numpy() image_array = image_array.transpose(1, 2, 0) # Change the order of dimensions return Image.fromarray(image_array) SDXL è‰²å½©èŒƒå›´åå‘é»„è‰²çš„å¯èƒ½åŸå›  è‡ªç„¶ç•Œä¸­è“è‰²æˆ–ç™½è‰²çš„ä¸œè¥¿ç›¸å¯¹è¾ƒå°‘ã€‚åœ¨å¤©ç©ºä¸­ï¼Œè¿™äº›é¢œè‰²åœ¨å®œäººçš„æ¡ä»¶ä¸‹æœ€ä¸ºçªå‡ºã€‚å› æ­¤ï¼Œé€šè¿‡å›¾åƒäº†è§£ç°å®çš„æ¨¡å‹ä¼šä»¥äº®åº¦ï¼ˆé€šé“ 0ï¼‰ã€é’è‰²/çº¢è‰²ï¼ˆé€šé“ 1ï¼‰å’Œæ·¡ç´«è‰²/ä¸­ç´«è‰²ï¼ˆé€šé“ 2ï¼‰æ¥æ€è€ƒï¼Œå…¶ä¸­çº¢è‰²å’Œç»¿è‰²ä¸ºä¸»ï¼Œè“è‰²ä¸ºè¾…ã€‚ è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ SDXL ç”Ÿæˆå¾€å¾€åå‘äºé»„è‰²ï¼ˆçº¢+ç»¿ï¼‰ã€‚ åœ¨æ¨ç†è¿‡ç¨‹ä¸­ï¼Œå¼ é‡ä¸­çš„å€¼å°†ä»æœ€å°å€¼ -30 å’Œæœ€å¤§å€¼ 30 å¼€å§‹ï¼Œè§£ç æ—¶çš„æœ€å°/æœ€å¤§è¾¹ç•Œçº¦ä¸º -4 è‡³ 4ã€‚ ç†è§£è¿™äº›è¾¹ç•Œçš„ä¸€ä¸ªå…³é”®æ˜¯çœ‹è§£ç è¿‡ç¨‹ä¸­å‘ç”Ÿäº†ä»€ä¹ˆï¼š 12decoded = vae.decode(latents / vae.scaling_factor).sample # (SDXL vae.scaling_factor = 0.13025)decoded = decoded.div(2).add(0.5).clamp(0, 1) # The dynamics outside of 0 to 1 at this point will be lost å¦‚æœè¿™ä¸€ç‚¹ä¸Šçš„å€¼è¶…å‡ºäº† 0 åˆ° 1 çš„èŒƒå›´ï¼Œå°±ä¼šä¸¢å¤±ä¸€äº›ä¿¡æ¯ã€‚å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬èƒ½åœ¨å»å™ªè¿‡ç¨‹ä¸­è¿›è¡Œä¿®æ­£ï¼Œä»¥æ»¡è¶³ VAE çš„æœŸæœ›ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šå¾—åˆ°æ›´å¥½çš„ç»“æœã€‚ ä»€ä¹ˆéœ€è¦ä¿®æ­£ï¼Ÿ å¦‚ä½•é”åŒ–æ¨¡ç³Šçš„å›¾åƒã€è¿›è¡Œç™½å¹³è¡¡ã€æ”¹å–„ç»†èŠ‚ã€å¢åŠ å¯¹æ¯”åº¦æˆ–æ‰©å¤§è‰²å½©èŒƒå›´ï¼Ÿæœ€å¥½çš„æ–¹æ³•æ˜¯ä»æ¸…æ™°çš„å›¾åƒå¼€å§‹ï¼Œå›¾åƒç™½å¹³è¡¡æ­£ç¡®ï¼Œå¯¹æ¯”åº¦é«˜ï¼Œç»†èŠ‚æ¸…æ™°ï¼ŒèŒƒå›´å¤§ã€‚ æ¨¡ç³Šæ¸…æ™°çš„å›¾åƒã€æ”¹å˜è‰²å½©å¹³è¡¡ã€é™ä½å¯¹æ¯”åº¦ã€è·å¾—ä¸åˆç†çš„ç»†èŠ‚å’Œé™åˆ¶è‰²å½©èŒƒå›´è¿œæ¯”æ”¹å–„å›¾åƒè¦å®¹æ˜“å¾—å¤šã€‚ SDXL æœ‰ä¸€ä¸ªéå¸¸æ˜æ˜¾çš„å€¾å‘ï¼Œå°±æ˜¯è‰²å½©åå·®å’Œå°†æ•°å€¼ç½®äºå®é™…è¾¹ç•Œä¹‹å¤–ï¼ˆä¸Šå›¾ï¼‰ã€‚å°†æ•°å€¼å±…ä¸­å¹¶ä½¿å…¶åœ¨è¾¹ç•Œå†…ï¼ˆä¸‹å›¾ï¼‰ï¼Œå°±å¯ä»¥è½»æ¾è§£å†³è¿™ä¸ªé—®é¢˜ï¼š è¿™æ®µä»£ç å¯ä»¥å°†é¢œè‰²ä¿®æ­£ï¼š 1234def center_tensor(input_tensor, per_channel_shift=1, full_tensor_shift=1, channels=[0, 1, 2, 3]): for channel in channels: input_tensor[0, channel] -= input_tensor[0, channel].mean() * per_channel_shift return input_tensor - input_tensor.mean() * full_tensor_shift SDXL çš„ç¤ºä¾‹è¾“å‡ºçš„ä¾‹å­ ç”Ÿæˆæ—¶ä½¿ç”¨çš„éšæœºæ•°ã€å‚æ•°å’Œ prompt å¦‚ä¸‹ï¼š 12345678seed: 77777777guidance_scale: 20 # A high guidance scale can be fixed toosteps with base: 23steps with refiner: 10prompt: Cinematic.Beautiful smile action woman in detailed white mecha gundam armor with red details,green details,blue details,colorful,star wars universe,lush garden,flowers,volumetric lighting,perfect eyes,perfect teeth,blue sky,bright,intricate details,extreme detail of environment,infinite focus,well lit,interesting clothes,radial gradient fade,directional particle lighting,wownegative_prompt: helmet, bokeh, painting, artwork, blocky, blur, ugly, old, boring, photoshopped, tired, wrinkles, scar, gray hair, big forehead, crosseyed, dumb, stupid, cockeyed, disfigured, crooked, blurry, unrealistic, grayscale, bad anatomy, unnatural irises, no pupils, blurry eyes, dark eyes, extra limbs, deformed, disfigured eyes, out of frame, no irises, assymetrical face, broken fingers, extra fingers, disfigured hands è¯·æ³¨æ„ï¼Œæˆ‘ç‰¹æ„é€‰æ‹©äº†è¾ƒé«˜çš„å¼•å¯¼æ¯”ä¾‹ï¼ˆguidance_scale å‚æ•°ï¼‰ã€‚ å¦‚ä½•ä¿®å¤è¿™å¼ å›¾ç‰‡ï¼Ÿå®ƒä¸€åŠæ˜¯ç»˜ç”»ï¼Œä¸€åŠæ˜¯ç…§ç‰‡ã€‚è‰²å½©èŒƒå›´åå‘é»„è‰²ã€‚ä¸‹è¾¹æ˜¯è®¾ç½®å®Œå…¨ç›¸åŒçš„ä¿®å¤åçš„ç”Ÿæˆå›¾åƒã€‚ ä½†æ˜¯ï¼Œå¦‚æœå°† guidance_scale è®¾ç½®ä¸º 7.5ï¼Œæˆ‘ä»¬ä»ç„¶å¯ä»¥å¾—å‡ºè¿™æ ·çš„ç»“è®ºï¼šä¿®å¤åçš„è¾“å‡ºæ•ˆæœæ›´å¥½ï¼Œæ²¡æœ‰ä¸åˆç†çš„ç»†èŠ‚ï¼Œç™½å¹³è¡¡ä¹Ÿæ­£ç¡®ã€‚ æˆ‘ä»¬å¯ä»¥åœ¨æ½œç©ºé—´ä¸­åšå¾ˆå¤šäº‹æƒ…æ¥æ™®éæ”¹è¿›ä¸€æ¬¡ç”Ÿæˆï¼Œä¹Ÿå¯ä»¥é’ˆå¯¹ä¸€æ¬¡ç”Ÿæˆä¸­çš„ç‰¹å®šé”™è¯¯åšä¸€äº›éå¸¸ç®€å•çš„äº‹æƒ…æ¥è¿›è¡Œä¿®å¤ï¼š ç¦»ç¾¤å€¼å»é™¤ è¿™å°†é€šè¿‡ä¿®å‰ªç¦»åˆ†å¸ƒå¹³å‡å€¼æœ€è¿œçš„å€¼æ¥æ§åˆ¶ä¸åˆç†ç»†èŠ‚çš„æ•°é‡ã€‚å®ƒè¿˜æœ‰åŠ©äºä»¥æ›´é«˜çš„å¼•å¯¼æ¯”ä¾‹ï¼ˆguidance_scale å‚æ•°ï¼‰ç”Ÿæˆã€‚ 123456789101112131415# Shrinking towards the mean (will also remove outliers)def soft_clamp_tensor(input_tensor, threshold=3.5, boundary=4): if max(abs(input_tensor.max()), abs(input_tensor.min())) &lt; 4: return input_tensor channel_dim = 1 max_vals = input_tensor.max(channel_dim, keepdim=True)[0] max_replace = ((input_tensor - threshold) / (max_vals - threshold)) * (boundary - threshold) + threshold over_mask = (input_tensor &gt; threshold) min_vals = input_tensor.min(channel_dim, keepdim=True)[0] min_replace = ((input_tensor + threshold) / (min_vals + threshold)) * (-boundary + threshold) - threshold under_mask = (input_tensor &lt; -threshold) return torch.where(over_mask, max_replace, torch.where(under_mask, min_replace, input_tensor)) è‰²å½©å¹³è¡¡å’Œå¢åŠ èŒƒå›´ æˆ‘æœ‰ä¸¤ç§ä¸»è¦æ–¹æ³•æ¥å®ç°è¿™ä¸€ç›®æ ‡ã€‚ç¬¬ä¸€ç§æ˜¯åœ¨å¯¹æ•°å€¼è¿›è¡Œå½’ä¸€åŒ–å¤„ç†æ—¶å‘å¹³å‡å€¼æ”¶ç¼©ï¼ˆè¿™ä¹Ÿä¼šå»é™¤å¼‚å¸¸å€¼ï¼‰ï¼Œç¬¬äºŒç§æ˜¯åœ¨æ•°å€¼åå‘æŸç§é¢œè‰²æ—¶è¿›è¡Œä¿®æ­£ã€‚è¿™ä¹Ÿæœ‰åŠ©äºä»¥æ›´é«˜çš„æŒ‡å¯¼å°ºåº¦ç”Ÿæˆã€‚ 12345# Center tensor (balance colors)def center_tensor(input_tensor, channel_shift=1, full_shift=1, channels=[0, 1, 2, 3]): for channel in channels: input_tensor[0, channel] -= input_tensor[0, channel].mean() * channel_shift return input_tensor - input_tensor.mean() * full_shift å¼ é‡æœ€å¤§åŒ– è¿™åŸºæœ¬ä¸Šæ˜¯é€šè¿‡å°†å¼ é‡ä¹˜ä»¥ä¸€ä¸ªéå¸¸å°çš„é‡ï¼Œå¦‚ 1e-5ï¼Œè¿›è¡Œå‡ ä¸ªæ­¥éª¤ï¼Œå¹¶ç¡®ä¿æœ€ç»ˆå¼ é‡åœ¨è½¬æ¢ä¸º RGB ä¹‹å‰ä½¿ç”¨äº†å…¨éƒ¨å¯èƒ½çš„èŒƒå›´ï¼ˆæ¥è¿‘ -4/4ï¼‰ã€‚è¯·è®°ä½ï¼Œåœ¨åƒç´ ç©ºé—´ä¸­ï¼Œç”¨å®Œæ•´çš„åŠ¨æ€é™ä½å¯¹æ¯”åº¦ã€é¥±å’Œåº¦å’Œé”åº¦æ¯”å¢åŠ å¯¹æ¯”åº¦ã€é¥±å’Œåº¦å’Œé”åº¦æ›´å®¹æ˜“ã€‚ 123456789# Maximize/normalize tensordef maximize_tensor(input_tensor, boundary=4, channels=[0, 1, 2]): min_val = input_tensor.min() max_val = input_tensor.max() normalization_factor = boundary / max(abs(min_val), abs(max_val)) input_tensor[0, channels] *= normalization_factor return input_tensor å›è°ƒå®ç°ç¤ºä¾‹ 1234567891011121314151617def callback(pipe, step_index, timestep, cbk): if timestep &gt; 950: threshold = max(cbk[\"latents\"].max(), abs(cbk[\"latents\"].min())) * 0.998 cbk[\"latents\"] = soft_clamp_tensor(cbk[\"latents\"], threshold*0.998, threshold) if timestep &gt; 700: cbk[\"latents\"] = center_tensor(cbk[\"latents\"], 0.8, 0.8) if timestep &gt; 1 and timestep &lt; 100: cbk[\"latents\"] = center_tensor(cbk[\"latents\"], 0.6, 1.0) cbk[\"latents\"] = maximize_tensor(cbk[\"latents\"]) return cbkimage = base( prompt, guidance_scale = guidance_scale, callback_on_step_end=callback, callback_on_step_end_inputs=[\"latents\"]).images[0] è¿™ä¸‰ç§æ–¹æ³•çš„ç®€å•å®ç°è¢«ç”¨äºæœ€åä¸€ç»„å›¾åƒï¼Œå³èŠ±å›­ä¸­çš„å¦‡å¥³ã€‚ å¢åŠ è‰²å½©èŒƒå›´/æ¶ˆé™¤è‰²å½©åå·® åœ¨å¸¸è§„è¾“å‡ºä¸­ï¼ŒSDXL å°†é¢œè‰²èŒƒå›´é™åˆ¶ä¸ºçº¢è‰²å’Œç»¿è‰²ã€‚å› ä¸ºæç¤ºä¸­æ²¡æœ‰ä»»ä½•å†…å®¹è¡¨æ˜æœ‰è“è‰²è¿™ç§ä¸œè¥¿ã€‚è¿™æ˜¯ç›¸å½“ä¸é”™çš„ä¸€æ¬¡ç”Ÿæˆï¼Œä½†é¢œè‰²èŒƒå›´å´å—åˆ°äº†é™åˆ¶ã€‚ å¦‚æœä½ ç»™åˆ«äººä¸€ä¸ªé»‘è‰²ã€çº¢è‰²ã€ç»¿è‰²å’Œé»„è‰²çš„è°ƒè‰²æ¿ï¼Œç„¶åå‘Šè¯‰ä»–è¦ç”»å‡ºæ™´æœ—çš„è“å¤©ï¼Œé‚£ä¹ˆå¾ˆè‡ªç„¶çš„ååº”å°±æ˜¯è¦æ±‚ä½ æä¾›è“è‰²å’Œç™½è‰²ã€‚ è¦åœ¨ç”Ÿæˆä¸­åŒ…å«è“è‰²ï¼Œæˆ‘ä»¬åªéœ€åœ¨è‰²å½©ç©ºé—´å—é™æ—¶é‡æ–°è°ƒæ•´è‰²å½©ç©ºé—´ï¼ŒSDXL å°±ä¼šåœ¨ç”Ÿæˆä¸­é€‚å½“åœ°åŒ…å«å®Œæ•´çš„è‰²å½©å…‰è°±ã€‚ é«˜æŒ‡å¯¼å°ºåº¦ä¸‹çš„é•¿æç¤ºæˆä¸ºå¯èƒ½ ä¸‹é¢æ˜¯ä¸€ä¸ªå…¸å‹çš„ä¾‹å­ï¼Œé¢œè‰²èŒƒå›´çš„å¢åŠ ä½¿æ•´ä¸ªæç¤ºè¯æˆä¸ºå¯èƒ½ï¼Œæœ¬ç¤ºä¾‹åº”ç”¨äº†å‰é¢æ‰€ç¤ºçš„ç®€å•ã€ç”Ÿç¡¬çš„ä¿®æ”¹ï¼Œä»¥æ›´æ¸…æ¥šåœ°è¯´æ˜ä¸¤è€…çš„åŒºåˆ«ï¼š 1prompt: Photograph of woman in red dress in a luxury garden surrounded with blue, yellow, purple and flowers in many colors, high class, award-winning photography, Portra 400, full format. blue sky, intricate details even to the smallest particle, extreme detail of the environment, sharp portrait, well lit, interesting outfit, beautiful shadows, bright, photoquality, ultra realistic, masterpiece","categories":[{"name":"AI","slug":"AI","permalink":"https://blog.inoki.cc/categories/AI/"},{"name":"Stable Diffusion","slug":"AI/Stable-Diffusion","permalink":"https://blog.inoki.cc/categories/AI/Stable-Diffusion/"}],"tags":[{"name":"ç¿»è¯‘","slug":"ç¿»è¯‘","permalink":"https://blog.inoki.cc/tags/ç¿»è¯‘/"},{"name":"ä¸­æ–‡","slug":"ä¸­æ–‡","permalink":"https://blog.inoki.cc/tags/ä¸­æ–‡/"},{"name":"AI","slug":"AI","permalink":"https://blog.inoki.cc/tags/AI/"},{"name":"Stable Diffusion","slug":"Stable-Diffusion","permalink":"https://blog.inoki.cc/tags/Stable-Diffusion/"},{"name":"SDXL","slug":"SDXL","permalink":"https://blog.inoki.cc/tags/SDXL/"}]},{"title":"ã€è¯‘ã€‘å…³äº USB-C çš„ä¸€åˆ‡ï¼šç¤ºä¾‹ç”µè·¯","slug":"All-about-USB-C-example-circuits","date":"2023-09-14T23:42:00.000Z","updated":"2025-03-08T09:40:48.547Z","comments":true,"path":"2023/09/14/All-about-USB-C-example-circuits/","link":"","permalink":"https://blog.inoki.cc/2023/09/14/All-about-USB-C-example-circuits/","excerpt":"","text":"åŸæ–‡é“¾æ¥ï¼šhttps://hackaday.com/2023/08/07/all-about-usb-c-example-circuits/ åœ¨ä¸Šä¸€ç¯‡ USB-C æ–‡ç« å‘è¡¨åçš„å…­ä¸ªæœˆé‡Œï¼Œæˆ‘æƒ³äº†å¾ˆå¤šå¯ä»¥æ”¹è¿›è¿™äº›æ–‡ç« çš„æ–¹æ³•ã€‚å½“ç„¶ï¼Œæœ‰è¿™ç§æ„Ÿè§‰æ˜¯æ­£å¸¸çš„ï¼Œç”šè‡³æ˜¯æ„æ–™ä¹‹ä¸­çš„ã€‚æˆ‘ç°åœ¨è®¤ä¸ºï¼Œæˆ‘å¯ä»¥å¼¥è¡¥ä¸€äº›ä¸è¶³ã€‚ä¾‹å¦‚ï¼Œæˆ‘æ²¡æœ‰æä¾›è¶³å¤Ÿçš„ç”µè·¯ç¤ºä¾‹ï¼Œè€Œæœ‰æ—¶ä¸€å¼ åŸç†å›¾æ¯”åƒè¨€ä¸‡è¯­èƒ½è¡¨è¾¾çš„æ›´å¤šã€‚ è®©æˆ‘ä»¬æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼æˆ‘å°†ä¸ºä½ æä¾›ä½ å¯èƒ½çœŸçš„æƒ³åˆ¶ä½œçš„ USB-C è®¾å¤‡çš„åŸç†å›¾ã€‚æˆ‘è¿˜å°†åœ¨æœ¬æ–‡ä¸­åˆ†äº«å¤§é‡é›†æˆç”µè·¯çš„é›¶ä»¶ç¼–å·ï¼Œå½“ç„¶ï¼Œæˆ‘å¹¶æ²¡æœ‰è¯¦å°½æ— é—åœ°æ”¶é›†æ‰€æœ‰é›†æˆç”µè·¯ã€‚ æˆ‘ä»¬å·²ç»åœ¨ç¬¬ä¸€ç¯‡æ–‡ç« ä¸­çœ‹åˆ°äº†ç¬¬ä¸€ä¸ªç¤ºä¾‹ç”µè·¯â€”â€”æ”¯æŒ USB 2.0 å’Œ 5V ç”µæºçš„è®¾å¤‡ä¾§ï¼ˆé¢å‘ä¸Šæ¸¸ï¼‰USB-C ç«¯å£ã€‚æ‚¨å¿…é¡»æœ‰ 5.1KÎ© ç”µé˜»å™¨ï¼Œæ¯ä¸ªå¼•è„šä¸€ä¸ªç”µé˜»å™¨ï¼Œå¹¶è®°ä½è¿æ¥ä¸¤ä¸ªæ•°æ®å¼•è„šï¼Œå¿…è¦æ—¶ä½¿ç”¨é€šå­”ã€‚å¦‚æœæ‚¨æƒ³ç¡®å®šå¯ç”¨ç”µæµçš„å¤§å°ï¼Œä¹Ÿå¯ä»¥å°† ADC æˆ–æ¯”è¾ƒå™¨ä¸€èµ·è¿æ¥åˆ° CC å¼•è„šä¸Šï¼Œä¸è¿‡é€šå¸¸æƒ…å†µä¸‹ï¼Œæ‚¨çš„è®¾å¤‡åŠŸè€—å¾ˆä½ï¼Œæ²¡æœ‰å¿…è¦è¿™ä¹ˆéº»çƒ¦ã€‚ ç°åœ¨ï¼Œå¦‚æœæ‚¨æƒ³åˆ¶ä½œå¸¦æœ‰ USB-C æ’å¤´çš„è®¾å¤‡ï¼Œæ¥çº¿æ–¹æ³•ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚å”¯ä¸€çš„åŒºåˆ«æ˜¯ï¼Œæ‚¨åªéœ€å¡«å……ä¸€ä¸ª CC ä¸‹æ‹‰å¼•è„šï¼Œå¹¶è¿æ¥ä¸€å¯¹ D+/D- å¼•è„šï¼Œè€Œä¸æ˜¯ä¸¤å¯¹ã€‚åœ¨å®é™…æ“ä½œä¸­ï¼Œå¦‚æœæ¥ä¸Šç¬¬äºŒå¯¹ USB 2.0 å¼•è„šï¼Œä¹Ÿä¸ä¼šå‘ç”Ÿä»€ä¹ˆä¸å¥½çš„äº‹æƒ…ï¼Œåªæ˜¯æŒ‰ç…§æ ‡å‡†ï¼Œè¿™æ ·åšå¾ˆä¸é›…è§‚ï¼›å®ƒæ›¾ç»ä¸æŸç§ç«¯å£å’Œç”µç¼†ï¼ˆVirtualLink ç”µç¼†ï¼‰ç›¸å†²çªï¼Œä½†ç°åœ¨å·²ç»ä¸å†å‡ºå”®äº†ã€‚ ä¸è¿‡ï¼Œå¦‚æœåœ¨ä¸¤ä¸ª CC å¼•è„šä¸Šéƒ½æ¥ä¸Š 5.1KÎ© ä¸‹æ‹‰ç”µé˜»ï¼Œå°±èƒ½æ„å¤–åœ°åˆ¶ä½œå‡ºä¸€ä¸ªé»‘å®¢é…ä»¶ï¼šè°ƒè¯•æ¨¡å¼é€‚é…å™¨ï¼Œå®ƒèƒ½å¸®åŠ©ä½ ä»æŸäº› USB-C ç«¯å£è·å¾—é¢å¤–çš„ä¿¡å·ã€‚ä¾‹å¦‚ï¼Œåœ¨ Framework ç¬”è®°æœ¬ç”µè„‘ä¸Šï¼Œé…å¤‡ USB-C æ’å¤´çš„ç”µè·¯æ¿ä¸Šçš„ä¸¤ä¸ªä¸‹æ‹‰å¼•è„šä¼šå°† USB-C ç«¯å£åˆ‡æ¢åˆ°è°ƒè¯•æ¨¡å¼ï¼Œå¹¶æš´éœ² SBU å¼•è„šä¸Šçš„ Embedded Controller çš„ UART è¿æ¥ã€‚é™¤éæ‚¨è¦åˆ¶ä½œè¿™æ ·çš„è°ƒè¯•é…ä»¶ï¼Œå¦åˆ™æ‚¨åªéœ€å¡«å……å…¶ä¸­ä¸€ä¸ªä¸‹æ‹‰ç”µé˜»ï¼Œå¹¶ç›¸åº”åœ°ä¸º USB 2.0 æ•°æ®å¼•è„šå¸ƒçº¿å³å¯ã€‚ å¦ä¸€æ–¹é¢ä¹ŸåŒæ ·ç®€å• å¦‚æœæ‚¨æƒ³åˆ¶ä½œä¸€ä¸ªä¸»æœºç«¯å£å‘¢ï¼Ÿä»ä¸€æ–¹é¢çœ‹ï¼Œè¿™æ›´å®¹æ˜“ï¼Œå› ä¸ºæ‚¨ä¸ä¸€å®šéœ€è¦è¿›è¡Œä»»ä½• ADC æµ‹é‡ã€‚ç›¸åï¼Œæ‚¨å¯ä»¥æ·»åŠ ä¸Šæ‹‰ç”µé˜»ï¼Œä¸åŒçš„å€¼é€‚ç”¨äºä¸åŒçš„å¯ç”¨ç”µæµã€‚å¹¶éæ‰€æœ‰è®¾å¤‡éƒ½ä¼šæ£€æŸ¥ä¸Šæ‹‰æ˜¯å¦å­˜åœ¨ï¼Œä½†æ‰‹æœºä¼šï¼Œæ‰€ä»¥å¦‚æœä½ åˆ¶ä½œä¸€ä¸ªä¸´æ—¶çš„ USB-C å……ç”µå™¨ï¼Œå¦‚æœæ²¡æœ‰ä¸Šæ‹‰ç”µé˜»ï¼Œæ‰‹æœºæˆ–ç¬”è®°æœ¬ç”µè„‘å¯èƒ½æ— æ³•å°†å…¶è¯†åˆ«ä¸ºæœ‰æ•ˆçš„å……ç”µæ–¹å¼ã€‚æ·»åŠ ä¸Šæ‹‰ç”µé˜»ä¹Ÿä¸ä¼šèŠ±å¾ˆå¤šé’±ï¼ æ›´é‡è¦çš„æ˜¯ï¼Œæ‚¨å¯èƒ½éœ€è¦æ§åˆ¶ VBUSï¼Œåªæœ‰åœ¨æ£€æµ‹åˆ° CC å¼•è„šä¹‹ä¸€å‡ºç°ä¸‹æ‹‰åæ‰å°†å…¶æ¥é€šã€‚å¦‚æœä¸è¿™æ ·åšï¼Œä¸ä¸€å®šä¼šæœ‰é—®é¢˜ï¼Œä½†å®ƒç¡®å®æ¶µç›–äº†ä¸€äº›é‡è¦çš„è¾¹ç¼˜æƒ…å†µï¼Œæ¯”å¦‚æœ‰äººå°† USB-A è½¬ USB-C ç”µç¼†æ’å…¥ä½ çš„ç«¯å£ï¼ æˆ‘ä»æœªåšè¿‡è¿™ç§ç”µè·¯ï¼Œä½†åœ¨æˆ‘çœ‹æ¥ï¼Œä½¿ç”¨ä¸¤ä¸ªåœºæ•ˆåº”ç®¡å°±è¶³å¤Ÿäº†ï¼Œæ¯ä¸ª CC å¼•è„šä¸€ä¸ªï¼Œä¸¤ä¸ªå¹¶è”ã€‚è¿™ä¸ªç”µè·¯å¯èƒ½æœ‰è¾¹ç¼˜æƒ…å†µï¼Œæ¬¢è¿æ”¹è¿›ï¼å¦ä¸€æ–¹é¢ï¼Œæˆ‘æ›¾å¤šæ¬¡å°†é…å¤‡ä¸‹æ‹‰åŠŸèƒ½çš„ USB-C ç«¯å£æ–­è·¯å™¨ç”¨ä½œä¸»æœºç«¯å£ï¼Œå› æ­¤è¿™ç»å¯¹ä¸æ˜¯ç¡¬æ€§è¦æ±‚ï¼Œè€Œä¸”æ‚¨ä¹Ÿä¸ä¸€å®šéœ€è¦åŠ¨ç”¨æ‚¨çš„ FET æ”¶è—ã€‚ å¦‚æœè¦æ„å»ºä¸»æœºç«¯å£ï¼Œæ€»å…±éœ€è¦åšä¸¤ä»¶äº‹ï¼Œè€Œè¿™ä¸¤ä»¶äº‹éƒ½ä¸å¤ªéœ€è¦ã€‚æ­¤å¤–ï¼Œå¦‚æœä½ æƒ³åœ¨ç”µè·¯ä¸Šåšå¾—æ›´å¤æ‚ä¸€äº›ï¼Œæˆ–è€…ç”šè‡³æƒ³åšä¸€ä¸ªåŒåŠŸèƒ½ç«¯å£ï¼Œä¹Ÿæœ‰ä¸€äº›é›†æˆç”µè·¯å¯ä»¥å¸®åŠ©ä½ å®Œæˆ USB-C çš„è¿™ä¸€éƒ¨åˆ†ï¼ ä¾‹å¦‚ï¼ŒWUSB3801ã€‚å®ƒæ—¢èƒ½æ£€æµ‹æºæï¼Œä¹Ÿèƒ½æ£€æµ‹æ¼æï¼Œå†…éƒ¨æœ‰æ‰€æœ‰éœ€è¦çš„ä¸Šæ‹‰å’Œä¸‹æ‹‰åŠŸèƒ½ï¼Œç”šè‡³è¿˜èƒ½å®ç°åŒåŠŸèƒ½ç«¯å£ï¼Œè®©æ‚¨å¯ä»¥æ„å»ºä»»ä½•ç±»å‹çš„ 5 V ç”µæºç«¯å£ã€‚å®ƒå¯ä»¥é€šè¿‡å‡ ä¸ª GPIO è¾“å‡ºç«¯å£çŠ¶æ€ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ I2C è¿æ¥åˆ°å¾®æ§åˆ¶å™¨ï¼Œç”šè‡³è¿˜æœ‰ä¸€ä¸ª ID å¼•è„šï¼Œè¿™æ ·å°±å¯ä»¥ç”¨ USB-C ç«¯å£å®Œå…¨å–ä»£ MicroUSB ç«¯å£ï¼WUSB3801 ä½“ç§¯å°ã€å¯ç„Šæ¥ï¼Œè€Œä¸”ç”¨é€”å¹¿æ³›ã€‚ä¾‹å¦‚ï¼Œåœ¨ Hackaday Discord æœåŠ¡å™¨ä¸Šï¼Œæœ‰äººåˆ¶ä½œäº†ä¸€ä¸ª WUSB3801 ç”µè·¯ï¼Œå®ƒå¯ä»¥æ ¹æ®æ‰€è¿æ¥çš„ USB-C ç«¯å£æ˜¯å¦èƒ½æä¾› 3 å®‰åŸ¹çš„ç”µæµæ¥é™åˆ¶é”‚ç¦»å­å……ç”µå™¨çš„ç”µæµã€‚ æ— è®ºæ‚¨æƒ³æ„å»ºä¸€ä¸ªæºç«¯å£ã€ä¸€ä¸ªæ±‡æµç«¯å£ï¼Œç”šè‡³æ˜¯ä¸€ä¸ªå¯ä»¥åŒæ—¶å®ç°è¿™ä¸¤ç§åŠŸèƒ½çš„ç«¯å£ï¼ŒWUSB301ï¼ˆæˆ–è®¸å¤šç±»ä¼¼çš„é›†æˆç”µè·¯ï¼Œå¦‚ TUSB320ï¼‰éƒ½å°†æ˜¯æ‚¨çš„ç†æƒ³è§£å†³æ–¹æ¡ˆã€‚æˆ‘å¯¹ WUSB3801 æœ‰ä¸€ç‚¹ä¸æ»¡ï¼Œé‚£å°±æ˜¯å®ƒæ²¡æœ‰æä¾›ç”¨äºç¡®å®šå½“å‰æ’å…¥ç«¯å£ææ€§çš„ GPIO - ä¸ºæ­¤ï¼Œæ‚¨å¿…é¡»ä½¿ç”¨ I2C æ¥å£ã€‚ä¸ºä»€ä¹ˆéœ€è¦çŸ¥é“ç«¯å£ææ€§å‘¢ï¼ŸåŸå› å°±åœ¨äºé«˜é€Ÿæ¥å£ï¼Œè€Œ USB 3.0 æ¥å£æ— ç–‘æ˜¯ USB-C çš„ä¸»æµæ¥å£ï¼Œè¿™ä»…ä»…æ˜¯å› ä¸ºå®ƒéå¸¸å®¹æ˜“å®ç°ã€‚ é«˜é€Ÿã€ä½†ä½ä»· ä½¿ç”¨ USB-C æ’å¤´åˆ¶é€  USB 3.0 è®¾å¤‡ä¸ä½¿ç”¨ USB-C æ’å¤´åˆ¶é€  USB 2.0 è®¾å¤‡ä¸€æ ·ç®€å•ã€‚USB 3.0 å¢åŠ äº†ä¸¤ä¸ªé«˜é€Ÿå·®åˆ†å¯¹ï¼Œè€Œ USB-C è¿æ¥å™¨åˆ™æœ‰å››ä¸ªå·®åˆ†å¯¹ä½ç½®ã€‚æœ‰äº†è¿™ä¸ªæ’å¤´ï¼Œæ‚¨å°±å¯ä»¥å°† USB 3.0 SSRX è¿æ¥åˆ° USB-C RX1ï¼Œå°† USB 3.0 SSTX è¿æ¥åˆ° USB-C TX1ï¼Œç„¶ååœ¨ CC1 ä¸Šæ’å…¥ä¸€ä¸ªä¸‹æ‹‰ç”µé˜»ï¼Œè¿™æ ·å°±å¤§åŠŸå‘Šæˆäº†ã€‚é™¤äº† USB 3.0 é“¾è·¯å¯èƒ½éœ€è¦çš„ä¸²è”ç”µå®¹å¤–ï¼Œæ²¡æœ‰ä»»ä½•é¢å¤–çš„å…ƒä»¶ï¼Œè¿™äº›å…ƒä»¶ä¸æ™®é€šçš„å®ç°æ–¹å¼å¹¶æ— ä¸åŒã€‚ ç°åœ¨ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆä½ ä¼šçœ‹åˆ°å¾ˆå¤š USB é—ªå­˜ç›˜é‡‡ç”¨ USB-C æ’å¤´çš„åŸå› â€”â€”æ·»åŠ  USB-C æ’å¤´éå¸¸ç®€å•ï¼Œä½ ä¸éœ€è¦å¼„æ¸…æ¥š CC å¼•è„šï¼Œä¹Ÿä¸éœ€è¦æ·»åŠ ä»»ä½•é¢å¤–çš„å…ƒä»¶ã€‚ä¸è¿‡ï¼Œå¦‚æœè¦æ·»åŠ ä¸€ä¸ªæ”¯æŒ USB 3.0 çš„ USB-C æ’åº§ï¼Œåˆ™éœ€è¦æ·»åŠ é¢å¤–çš„ç»„ä»¶ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œå°† USB 3.0 USB-C é—ªå­˜ç›˜æ’å…¥ USB-C æ’åº§ï¼Œæ ¹æ®æ¥å£æ–¹å‘çš„æ–¹å‘ï¼Œæ’é’ˆæœ€ç»ˆä¼šä½äºä¸¤ä¸ªä½ç½®ä¸­çš„ä¸€ä¸ªã€‚ä½ ä¸ä¼šæƒ³æŠŠæ’åº§çš„ TX/RX å¼•è„šè¿æ¥åœ¨ä¸€èµ·ï¼Œé‚£æ ·ä¼šæœ‰å¾ˆå¤§çš„ä¿¡å·å®Œæ•´æ€§é—®é¢˜ï¼Œæ‰€ä»¥å¦‚æœä½ è¦æ·»åŠ ä¸€ä¸ªæ”¯æŒ USB 3.0 çš„ USB-C æ’åº§ï¼Œä½ éœ€è¦ä¸€ä¸ªå¤ç”¨å™¨æ¥å¤„ç†é«˜é€Ÿä¿¡å·çš„æ¥å£æ–¹å‘ã€‚ ç°åœ¨ï¼Œè¿™ç§ USB-C èŠ¯ç‰‡å·²ç»å±¡è¯•ä¸çˆ½ï¼Œè‡³å°‘æœ‰åå‡ å®¶ä¸åŒçš„åˆ¶é€ å•†ç”Ÿäº§è¿™ç§èŠ¯ç‰‡ã€‚æœ‰äº›å¤šè·¯å¤ç”¨å™¨ä¼šæœ‰ä¸€ä¸ª POL è¾“å…¥ï¼Œç”¨äºå°† USB 3.0 ä¿¡å·æ‰‹åŠ¨åˆ‡æ¢åˆ°ä¸¤ä¸ªå¯èƒ½çš„ä½ç½®â€”â€”è¿™äº›å¤šè·¯å¤ç”¨å™¨åº”ä¸æ‚¨è‡ªå·±çš„ PD æ§åˆ¶å™¨ï¼ˆå³å¤„ç† CC å¼•è„šçš„èŠ¯ç‰‡ï¼‰ä¸€èµ·ä½¿ç”¨ã€‚æ‚¨ä¼šå‘ç°ï¼Œè®¸å¤šå¤šè·¯å¤ç”¨å™¨ä¹ŸåŒ…å« CC é€»è¾‘ï¼ŒåŸºæœ¬ä¸Šå¯ä»¥ä¸º 5V å’Œæ”¯æŒ USB 3.0 çš„ USB-C æä¾›å®Œæ•´çš„è§£å†³æ–¹æ¡ˆã€‚å¦‚æœæ‚¨æ­£åœ¨æ„å»ºä¸»æœºçš„ç”µè·¯ï¼Œå¯èƒ½åªéœ€è¦æ·»åŠ  VBUS å¤„ç†ï¼Œè€Œå¦‚æœæ‚¨æ­£åœ¨æ„å»ºå¸¦æœ‰ USB-C æ’åº§çš„è®¾å¤‡ï¼Œåˆ™ä¸éœ€è¦å…¶ä»–ä»»ä½•ä¸œè¥¿ï¼ ç¬”è®°æœ¬ç”µè„‘ä¸Šçš„è®¸å¤šå»‰ä»· USB-C ç«¯å£éƒ½é‡‡ç”¨äº†è¿™ç§å¤šè·¯å¤ç”¨å™¨â€”â€”å®ƒä»¬åªæä¾› USB 2.0ï¼Œä¸æä¾›å…¶ä»–ä»»ä½•åŠŸèƒ½ï¼Œè€Œä¸”è¿™ç§å¤šè·¯å¤ç”¨å™¨éå¸¸å®¹æ˜“å®ç°ï¼Œå› æ­¤è®¸å¤šå»‰ä»·ç¬”è®°æœ¬ç”µè„‘åˆ¶é€ å•†éƒ½é‡‡ç”¨äº†è¿™ç§å¤šè·¯å¤ç”¨å™¨ã€‚æ­¤å¤–ï¼Œå¦‚æœä½ æœ‰ä¸€ä¸ª USB 3.0 ç«¯å£ï¼Œä½ ç”šè‡³å¯ä»¥çœç•¥å¤šè·¯å¤ç”¨å™¨ã€‚æˆ‘ä»¬åœ¨å°å¼æœºä¸»æ¿ä¸Šè§è¿‡è¿™ç§åšæ³•ï¼Œæœ‰è¶£çš„æ˜¯ï¼ŒMNT Pocket Reform çš„ä¸¤ä¸ª USB-C ç«¯å£ä¹Ÿæ˜¯è¿™æ ·æ¥çº¿çš„ï¼Pocket Reform ä¸»æ¿çš„æ¿è½½ USB 3.0 é›†çº¿å™¨æœ‰å››ä¸ªç©ºé—²ç«¯å£ï¼Œä½†åªæœ‰ä¸¤ä¸ª USB-C ç«¯å£å¯ä»¥ä½¿ç”¨ USB 3.0ã€‚å¦‚æœæœ‰äººæƒ³ä½¿ç”¨è¿™ä¸¤ä¸ªé¢å¤–çš„ USB 3.0 ç«¯å£ï¼Œåªéœ€è®¾è®¡ä¸€ä¸ªæ— æºé€‚é…å™¨å³å¯ï¼ Pocket Reform ä¸Šçš„è¿™ä¸¤ä¸ª USB-C ç«¯å£ä¸­æœ‰ä¸€ä¸ªå¾ˆç‰¹åˆ«ï¼Œå®ƒä¸åƒç¬¬ä¸€ä¸ªç«¯å£é‚£æ ·åªå°† 5 V ç”µå‹è½¨è¿æ¥åˆ° VBUSã€‚ç›¸åï¼Œå®ƒæœ‰ä¸€ä¸ªç”µæºå¼€å…³ IC ä¸ VBUS è¿æ¥ï¼Œè¿˜æœ‰ä¸€ä¸ª FUSB302B ä¸ CC å¼•è„šè¿æ¥ã€‚è¿™å°±æ˜¯ Pocket Reform çš„å……ç”µå™¨ç«¯å£ï¼Œäº‹å®ä¸Šï¼Œè¿™ä¹Ÿæ˜¯å®ç°ç”µæºä¼ è¾“çš„æ–¹æ³•ä¹‹ä¸€ã€‚ è·å–ç”µå‹å’Œåƒç´  æˆ‘ä»¬è®¨è®ºè¿‡çš„æ‰€æœ‰é€‰é¡¹éƒ½å·²æ”¯æŒé«˜è¾¾ 15W çš„åŠŸç‡ï¼Œç‰¹åˆ«æ˜¯ 5Vã€3A çš„ç”µå‹ã€‚æ‚¨åªéœ€è¦æ‡‚ PD åè®®ï¼Œæˆ–è€…è®©èŠ¯ç‰‡ä¸ºæ‚¨åå•†ã€‚ æ­£å¦‚ä½ å¯èƒ½çŒœåˆ°çš„é‚£æ ·ï¼Œè¿™äº›å‹å¥½çš„èŠ¯ç‰‡å°±æ˜¯ PD è§¦å‘å™¨é›†æˆç”µè·¯ã€‚ä½ å°†å®ƒä»¬è¿æ¥åˆ° CC å¼•è„šï¼Œå®ƒä»¬å°±ä¼šä»£è¡¨ä½ åå•†ç”µæºé…ç½®æ–‡ä»¶ã€‚å®ƒä»¬æœ‰å‡ ä¸ªè¾“å…¥ç«¯è®©ä½ è®¾ç½®æ‰€éœ€çš„ç”µå‹ï¼Œå¦‚æœç”µæºä¾›åº”å™¨æ— æ³•æä¾›ä½ æ‰€éœ€çš„ç”µå‹ï¼Œè¿˜å¯ä»¥é€‰æ‹©ä¸€ä¸ªåœºæ•ˆåº”ç®¡é©±åŠ¨å™¨è¾“å‡ºç«¯æ¥æ–­å¼€ VBUSï¼Œç¡®ä¿ä½ ä¸ä¼šåœ¨éœ€è¦ 20V ç”µå‹çš„ç”µæºè½¨ä¸Šè·å¾—é»˜è®¤çš„ 5V ç”µå‹ã€‚ å…³äºè§¦å‘å™¨èŠ¯ç‰‡ï¼Œæˆ‘ä»¬å¯ä»¥è°ˆå¾ˆå¤šï¼Œå¾ˆå¤šäººéƒ½èŠè¿‡äº†ï¼Œæˆ‘è‚¯å®šä¹Ÿæ˜¯ã€‚äº‹å®ä¸Šï¼Œå½“äººä»¬éœ€è¦ä» USB-C ç«¯å£è·å¾—é«˜ç”µå‹æ—¶ï¼Œç»å¤§å¤šæ•°äººéƒ½ä¼šé€‰æ‹©è§¦å‘èŠ¯ç‰‡ã€‚å®ƒä»¬éå¸¸é€‚åˆå¤§å¤šæ•°ä½¿ç”¨æƒ…å†µï¼Œè€Œä¸”å¾ˆæœ‰å¯èƒ½ï¼Œä½ ä¼šæƒ³è¦ä½¿ç”¨å®ƒã€‚ä½†æ˜¯ï¼Œè¯·æ³¨æ„ï¼Œå®ƒä»¬çš„è¡Œä¸ºå¹¶ä¸çµæ´»ï¼šå®ƒä»¬ä¸ä¼šè®©ä½ åˆ¶é€ ä¸€ä¸ªåŒåŠŸèƒ½ç«¯å£ï¼Œä¹Ÿä¸ä¼šè®©ä½ åŒºåˆ† 30W USB-C PSU å’Œ 100W PSUï¼Œè€Œè¿™åœ¨ä½ é©±åŠ¨ç”µé˜»è´Ÿè½½æ—¶æ˜¯æœ‰å¸®åŠ©çš„ã€‚æ­¤å¤–ï¼Œç”±äºæ²¡æœ‰æ–¹å‘è¾“å‡ºï¼Œå®ƒä»¬ä¹Ÿä¸èƒ½ä¸ USB 3.0 æˆ– DisplayPort ç»“åˆä½¿ç”¨ï¼Œä¹Ÿä¸èƒ½å‘é€è‡ªå®šä¹‰ä¿¡æ¯ã€‚ ä¸€ä¸ª PD æ§åˆ¶å™¨èƒ½è®©æ‚¨åšæ›´å¤šäº‹æƒ…ï¼æ— è®ºæ‚¨ä½¿ç”¨çš„æ˜¯ FUSB302B è¿™æ ·çš„å¤–ç½® PD æ§åˆ¶å™¨ï¼Œè¿˜æ˜¯å†…ç½®åœ¨ MCU ä¸­çš„ PD æ§åˆ¶å™¨ï¼Œå®ƒéƒ½èƒ½è®©æ‚¨åšå‡ºè‡ªå·±çš„ PD é€šä¿¡å†³å®šã€‚å®ƒæä¾›äº†æ‚¨å¯èƒ½éœ€è¦çš„æ‰€æœ‰ç”µé˜»å™¨ï¼Œè€Œä¸”æ— è®ºæ‚¨éœ€è¦å®Œæˆä»€ä¹ˆä»»åŠ¡ï¼Œéƒ½æœ‰å¯èƒ½æ‰¾åˆ°ç¤ºä¾‹ä»£ç ã€‚æˆ‘ä»¬å·²ç»å®Œæˆäº†ç”¨äºç”µæºå’Œ DisplayPort sink æ“ä½œçš„è‡ªå®šä¹‰ PD ä¿¡æ¯æ„å»ºã€‚åˆ°æ—¶å€™ï¼Œæˆ‘ä»¬ç”šè‡³ä¼šç”¨ FUSB302B æ„å»ºè‡ªå·±çš„ USB-C PSUï¼Œæ•¬è¯·æœŸå¾…ï¼è¯´åˆ° MCUï¼Œæœ‰ä¸€äº›è‘—åçš„ STM32 å’Œ Cypress çš„å¾®æ§åˆ¶å™¨å¸¦æœ‰ PD å¤–è®¾ï¼Œæœ€è¿‘ï¼ŒCH32X035 ä¹ŸåŠ å…¥äº†è¿™ä¸€è¡Œåˆ—ã€‚ æ‚¨è‡ªå·±çš„ PD æ§åˆ¶å™¨è¿˜èƒ½è®©æ‚¨å‘é€ DisplayPort ä¿¡æ¯â€”â€”ä»ä»»ä½•å…¼å®¹ç«¯å£æå– DisplayPort è¾“å‡ºï¼Œæˆ–è€…è‡ªå·±æä¾› DisplayPortã€‚ä½¿ç”¨ USB-C æ’å¤´å°±ä¸éœ€è¦å¤šè·¯å¤ç”¨å™¨ï¼Œæˆ–è€…ä½¿ç”¨æ’åº§å¹¶æ·»åŠ ä¸€ä¸ªå…¼å®¹ DisplayPort çš„å¤šè·¯å¤ç”¨å™¨ï¼Œè¿™æ ·å°±èƒ½åŒæ—¶æå–åŒé€šé“ DisplayPort å’Œ USB 3.0ï¼Œæˆ–å››é€šé“ DisplayPortï¼Œéšä½ æ‰€éœ€ã€‚æˆ–è€…ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ DisplayPort æ’åº§ï¼Œçœå»å¤šè·¯å¤ç”¨å™¨ï¼Œè®©ç«¯å£åªåœ¨ä¸€ä¸ªæ–¹å‘ä¸Šå·¥ä½œâ€”â€”ä¸­å›½çš„ eDP åˆ†çº¿å™¨é”€å”®å•†å¯ä»¥è¯å®è¿™ä¸€ç‚¹ï¼ åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç» USB-C PSU çš„å†…éƒ¨å·¥ä½œåŸç†ï¼Œç„¶åå°† 20V PSU è½¬æ¢ä¸ºæ”¯æŒ 20V çš„ USB-C ç”µæºï¼›æˆ‘ä»¬åªéœ€è¦ FUSB302ã€å‡ ä¸ª FET å’Œä¸€ä¸ªå¤‡ç”¨ 5V ç¨³å‹å™¨ã€‚è¿™ä¸éœ€è¦æˆ‘ä»¬åšå¤ªå¤šï¼Œä½ å°±èƒ½å°†æ—§ç”µæºè½¬æ¢ä¸º USB-C ç¬”è®°æœ¬ç”µè„‘ç”µæºï¼Œè¿˜èƒ½äº†è§£ USB-C PSU çš„å·¥ä½œåŸç†ï¼","categories":[{"name":"Translation","slug":"Translation","permalink":"https://blog.inoki.cc/categories/Translation/"},{"name":"Chinese","slug":"Translation/Chinese","permalink":"https://blog.inoki.cc/categories/Translation/Chinese/"},{"name":"USB","slug":"USB","permalink":"https://blog.inoki.cc/categories/USB/"},{"name":"ç¡¬ä»¶","slug":"ç¡¬ä»¶","permalink":"https://blog.inoki.cc/categories/ç¡¬ä»¶/"}],"tags":[{"name":"ç¿»è¯‘","slug":"ç¿»è¯‘","permalink":"https://blog.inoki.cc/tags/ç¿»è¯‘/"},{"name":"ä¸­æ–‡","slug":"ä¸­æ–‡","permalink":"https://blog.inoki.cc/tags/ä¸­æ–‡/"},{"name":"ç¡¬ä»¶","slug":"ç¡¬ä»¶","permalink":"https://blog.inoki.cc/tags/ç¡¬ä»¶/"},{"name":"USB","slug":"USB","permalink":"https://blog.inoki.cc/tags/USB/"}]},{"title":"ã€è¯‘ã€‘å…³äº USB-C çš„ä¸€åˆ‡ï¼šé«˜é€Ÿæ¥å£","slug":"All-about-USB-C-high-speed-interfaces","date":"2023-09-14T23:22:00.000Z","updated":"2025-03-08T09:40:48.547Z","comments":true,"path":"2023/09/14/All-about-USB-C-high-speed-interfaces/","link":"","permalink":"https://blog.inoki.cc/2023/09/14/All-about-USB-C-high-speed-interfaces/","excerpt":"","text":"åŸæ–‡é“¾æ¥ï¼šhttps://hackaday.com/2023/01/17/all-about-usb-c-high-speed-interfaces/ USB-C çš„æƒŠäººä¹‹å¤„åœ¨äºå®ƒçš„é«˜é€Ÿæ€§èƒ½ã€‚å…¶å¼•è„šæä¾›äº†å››ä¸ªé«˜é€Ÿå·®åˆ†ä¿¡å·çº¿å¯¹å’Œå‡ ä¸ªä½é€Ÿä¿¡å·çº¿å¯¹ï¼Œè®©æ‚¨å¯ä»¥é€šè¿‡ä¸€ä¸ªæ¯”ç¡¬å¸è¿˜å°çš„è¿æ¥å™¨ä¼ è¾“å¤§é‡æ•°æ®ã€‚ä½†å¹¶éæ‰€æœ‰è®¾å¤‡éƒ½èƒ½åˆ©ç”¨è¿™ä¸€åŠŸèƒ½ï¼Œè€Œä¸”ä¹Ÿä¸éœ€è¦è¿™æ ·åšâ€”â€”USB-C çš„è®¾è®¡ç›®çš„æ˜¯è®©ä¸–ç•Œä¸Šæ‰€æœ‰ä¾¿æºè®¾å¤‡éƒ½èƒ½ä½¿ç”¨ã€‚ç„¶è€Œï¼Œå½“ä½ çš„è®¾å¤‡éœ€è¦é€šè¿‡ USB-C ä¼ è¾“é«˜é€Ÿæ•°æ®æ—¶ï¼ŒUSB-C èƒ½ä¸ºä½ å¸¦æ¥çš„ç›Šå¤„ä»¥åŠå®ƒèƒ½å‘æŒ¥çš„ä½œç”¨å°±ä¼šè®©ä½ å¤§åƒä¸€æƒŠã€‚ ä» USB-C æ¥å£è·å¾—é«˜é€Ÿæ¥å£çš„èƒ½åŠ›è¢«ç§°ä¸º&quot;æ›¿ä»£æ¨¡å¼&quot;ï¼Œç®€ç§°&quot;altmode&quot;ã€‚ç›®å‰ï¼Œä½ èƒ½é‡åˆ°çš„ä¸‰ç§æ›¿ä»£æ¨¡å¼æ˜¯ USB3ã€DisplayPort å’Œ Thunderboltï¼Œè¿˜æœ‰ä¸€äº›å·²ç»æ·¡å‡ºäººä»¬è§†çº¿ï¼Œå¦‚ HDMI å’Œ VirtualLinkï¼Œè¿˜æœ‰ä¸€äº›æ­£åœ¨å´›èµ·ï¼Œå¦‚ USB4ã€‚å¤§å¤šæ•° altmode éƒ½éœ€è¦æ•°å­— USB-C é€šä¿¡ï¼Œé€šè¿‡ PD é€šé“ä½¿ç”¨ç‰¹å®šç±»å‹çš„ä¿¡æ¯ã€‚å°½ç®¡å¦‚æ­¤ï¼Œå¹¶éæ‰€æœ‰æ¨¡å¼éƒ½éœ€è¦ altmodeï¼ŒUSB3 å°±æ˜¯æœ€ç®€å•çš„ä¸€ç§ã€‚ä¸‹é¢æˆ‘ä»¬å°±æ¥äº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯ altmodeã€‚ USB-C ä¸­çš„ C ä»£è¡¨&quot;èƒ½å¤Ÿ&quot; å¦‚æœä½ çœ‹è¿‡å¼•è„šå›¾ï¼Œå°±åº”è¯¥çŸ¥é“é«˜é€Ÿå¼•è„šã€‚ä»Šå¤©ï¼Œæˆ‘æƒ³å‘å¤§å®¶ä»‹ç»ä¸€ä¸‹å¦‚ä»Šè¿™äº›å¼•è„šå¯ä»¥æä¾›å“ªäº›æ¥å£ã€‚è¿™å¹¶ä¸æ˜¯ä¸€ä¸ªå®Œæ•´æˆ–å¹¿æ³›çš„åˆ—è¡¨ï¼Œä¾‹å¦‚ï¼Œæˆ‘ä¸ä¼šè°ˆè®º USB4 ç­‰æ¥å£ï¼Œéƒ¨åˆ†åŸå› æ˜¯æˆ‘å¯¹å…¶äº†è§£ä¸å¤Ÿï¼Œä¹Ÿæ²¡æœ‰ä½¿ç”¨ç»éªŒï¼›å¦å¤–ï¼Œå¯ä»¥è‚¯å®šçš„æ˜¯ï¼Œæœªæ¥æˆ‘ä»¬å°†è·å¾—æ›´å¤šé…å¤‡ USB-C çš„é«˜é€Ÿè®¾å¤‡ã€‚æ­¤å¤–ï¼ŒUSB-C å…·æœ‰è¶³å¤Ÿçš„çµæ´»æ€§ï¼Œé»‘å®¢å¯ä»¥é€šè¿‡å®ƒä»¥ç¬¦åˆ USB-C æ ‡å‡†çš„æ–¹å¼æš´éœ²ä»¥å¤ªç½‘æˆ– SATAâ€”â€”å¦‚æœè¿™æ­£æ˜¯ä½ æ‰€å¯»æ‰¾çš„ï¼Œä¹Ÿè®¸è¿™ç¯‡æ¦‚è¿°èƒ½å¸®ä½ å¼„æ˜ç™½ã€‚ USB3 USB3 éå¸¸éå¸¸ç®€å•ï¼Œåªæœ‰ä¸€å¯¹ TX å’Œä¸€å¯¹ RXï¼Œè™½ç„¶ä¼ è¾“é€Ÿåº¦è¿œè¿œé«˜äº USB2ï¼Œä½†å¯¹äºé»‘å®¢æ¥è¯´è¿˜æ˜¯å¯ä»¥åº”ä»˜çš„ã€‚å¦‚æœä½¿ç”¨å…·æœ‰ USB3 ä¿¡å·é˜»æŠ—æ§åˆ¶åŠŸèƒ½çš„å¤šå±‚å°åˆ·ç”µè·¯æ¿ï¼Œå¹¶è°¨æ…å¤„ç†ä¸åŒçš„å·®åˆ†ä¿¡å·çº¿å¯¹ï¼ŒUSB3 è¿æ¥ä¸€èˆ¬éƒ½èƒ½æ­£å¸¸å·¥ä½œã€‚ å¯¹äº USB3 å’Œ USB-Cï¼Œå˜åŒ–ä¸å¤§â€”â€”æ‚¨å°†æœ‰ä¸€ä¸ªç”¨äºå¤„ç†æ¥å£æ–¹å‘çš„å¤šè·¯å¤ç”¨å™¨ï¼Œä½†ä»…æ­¤è€Œå·²ã€‚USB3 å¤šè·¯å¤ç”¨å™¨éå¸¸ä¸°å¯Œï¼Œå› æ­¤åœ¨ç”µè·¯æ¿ä¸Šæ·»åŠ æ”¯æŒ USB3 çš„ USB-C å‡ ä¹ä¸ä¼šæœ‰é—®é¢˜ã€‚æ­¤å¤–ï¼Œè¿˜æœ‰åŒé“¾è·¯ USB3ï¼Œå³å¹¶è¡Œä½¿ç”¨ä¸¤ä¸ª USB3 é“¾è·¯æ¥æé«˜ååé‡ï¼Œä½†é»‘å®¢ä¸€èˆ¬æ—¢ä¸ä¼šé‡åˆ°ä¹Ÿä¸éœ€è¦è¿™ä¸ªï¼Œè€Œè¿™ä¸€é¢†åŸŸå¾€å¾€ç”± Thunderbolt æä¾›æ›´å¥½çš„æœåŠ¡ã€‚æƒ³å°† USB3 è®¾å¤‡è½¬æ¢ä¸º USB-Cï¼Ÿä½ åªéœ€è¦ä¸€ä¸ªå¤šè·¯å¤ç”¨å™¨ã€‚å¦‚æœæ‚¨æƒ³åœ¨ç”µè·¯æ¿ä¸Šä¸ºé«˜é€Ÿè®¾å¤‡å®‰è£… MicroUSB 3.0 æ¥å£çš„è¯ï¼Œæˆ‘å©‰æ‹’ï¼Œè¯·æ‚¨æ”¹ç”¨ USB-C æ’åº§å’Œ VL160ã€‚ å¦‚æœæ‚¨è®¾è®¡çš„æ˜¯é…å¤‡æ’å¤´çš„ USB3 è®¾å¤‡ï¼Œæ‚¨ç”šè‡³ä¸éœ€è¦å¤„ç†æ¥å£æ–¹å‘çš„å¤šè·¯å¤ç”¨å™¨â€”â€”äº‹å®ä¸Šï¼Œæ‚¨ä¸éœ€è¦ä»»ä½•æ¥å£æ–¹å‘æ£€æµ‹ã€‚å¯¹äºç›´æ¥æ’å…¥ USB-C ç«¯å£çš„ USB3 é—ªå­˜ç›˜ï¼Œæˆ– USB-C å…¬å£åˆ° USB-A 3.0 æ¯å£çš„é€‚é…å™¨ï¼Œä¸€ä¸ªä¸å—ç›‘æ§çš„ 5.1kÎ© ç”µé˜»å™¨å°±è¶³å¤Ÿäº†ã€‚åœ¨æ’åº§æ–¹é¢ï¼Œå¦‚æœæœ‰å¤‡ç”¨çš„ USB3 è¿æ¥å¯ä»¥ç‰ºç‰²ï¼Œå°±å¯ä»¥é¿å…ä½¿ç”¨å¤šè·¯å¤ç”¨å™¨ï¼Œå½“ç„¶è¿™å¹¶ä¸æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„äº¤æ˜“ã€‚æˆ‘å¯¹åŒé“¾è·¯ USB3 çš„äº†è§£è¿˜ä¸è¶³ä»¥åˆ¤æ–­è¿™ç§è¿æ¥æ˜¯å¦å…·æœ‰ USB3 åŒé“¾è·¯åŠŸèƒ½ï¼Œä½†æˆ‘è®¤ä¸ºç­”æ¡ˆæ˜¯å¦çš„å¯èƒ½æ€§å¤§äºæ˜¯ï¼ DisplayPort DisplayPort (DP) æ˜¯è¿æ¥é«˜åˆ†è¾¨ç‡æ˜¾ç¤ºå™¨çš„ç»ä½³æ¥å£â€”â€”å®ƒåœ¨å°å¼æœºé¢†åŸŸå·²è¶…è¶Š HDMIï¼Œåœ¨åµŒå…¥å¼æ˜¾ç¤ºå™¨é¢†åŸŸä»¥å…¶ eDP å½¢å¼å æ®ä¸»å¯¼åœ°ä½ï¼Œé€šè¿‡å•æ ¹ç”µç¼†æä¾›é«˜åˆ†è¾¨ç‡ï¼Œé€šå¸¸æ¯” HDMI æ›´å¥½ã€‚é€šè¿‡ä½¿ç”¨ä¸€ç§åä¸º DP++ çš„æ ‡å‡†ï¼Œå®ƒå¯ä»¥é€šè¿‡å»‰ä»·çš„é€‚é…å™¨è½¬æ¢æˆ DVI æˆ– HDMIï¼Œè€Œä¸”ä¸åƒ HDMI é‚£æ ·å—ç‰ˆæƒé™åˆ¶ã€‚VESA è”ç›Ÿä¸ USB é›†å›¢åˆä½œå®ç°å¯¹ DisplayPort çš„æ”¯æŒæ˜¯åˆæƒ…åˆç†çš„ï¼Œå°¤å…¶æ˜¯è€ƒè™‘åˆ° SoC ä¸­çš„ DisplayPort ä¼ è¾“å™¨å·²ç»è¶Šæ¥è¶Šæµè¡Œã€‚ å¦‚æœä½ ä½¿ç”¨çš„æ˜¯å¸¦æœ‰ HDMI æˆ– VGA è¾“å‡ºçš„åº•åº§ï¼Œé‚£ä¹ˆå®ƒåœ¨å¼•æ“ç›–ä¸‹ä½¿ç”¨çš„å°±æ˜¯ DisplayPort altmodeã€‚è¶Šæ¥è¶Šå¤šçš„æ˜¾ç¤ºå™¨éƒ½å¸¦æœ‰ DisplayPort over USB-C è¾“å…¥ï¼Œç”±äºæœ‰äº†åä¸º MST çš„åŠŸèƒ½ï¼Œä½ å¯ä»¥ä¸²è”æ˜¾ç¤ºå™¨ï¼Œå®ç°å•çº¿å¤šæ˜¾ç¤ºå™¨é…ç½®â€”â€”é™¤éä½ ä½¿ç”¨çš„æ˜¯ Macbookï¼Œå› ä¸ºè‹¹æœæ‹’ç»åœ¨ MacOS ä¸­æ”¯æŒ MSTã€‚ æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªæœ‰è¶£çš„äº‹å®â€”â€”DP æ¨¡å¼æ˜¯å”¯ä¸€ä½¿ç”¨ SBU å¼•è„šçš„æ¨¡å¼ä¹‹ä¸€ï¼ŒSBU å¼•è„šè¢«é‡æ–°ç”¨äº DisplayPort AUX å¯¹ã€‚USB-C å¼•è„šçš„æ•´ä½“åŒ®ä¹ä¹Ÿæ„å‘³ç€å¿…é¡»çœç•¥ DP é…ç½®å¼•è„šï¼Œé™¤äº† DP++ HDMI/DVI å…¼å®¹æ¨¡å¼ã€‚å› æ­¤ï¼Œæ‰€æœ‰çš„ USB-C DP è‡³ HDMI é€‚é…å™¨å®é™…ä¸Šéƒ½æ˜¯å˜ç›¸çš„ DP-HDMI è½¬æ¢å™¨ï¼Œè€Œ DP++ åˆ™ä¸åŒï¼Œå®ƒå…è®¸æ‚¨ä½¿ç”¨ç”µå¹³è½¬æ¢å™¨æ¥æ”¯æŒ HDMIã€‚ å¦‚æœä½ æƒ³ä½¿ç”¨ DisplayPortï¼Œä½ å¯èƒ½éœ€è¦ä¸€ä¸ªæ”¯æŒ DP çš„å¤šè·¯å¤ç”¨å™¨ï¼Œä½†æœ€é‡è¦çš„æ˜¯ï¼Œä½ éœ€è¦èƒ½å¤Ÿå‘é€è‡ªå®šä¹‰çš„ PD ä¿¡æ¯ã€‚é¦–å…ˆï¼Œæ•´ä¸ª&quot;æä¾›/è¯·æ±‚ DP Altmode&quot;éƒ¨åˆ†éƒ½æ˜¯é€šè¿‡ PD ä¿¡æ¯å®Œæˆçš„ï¼Œå› æ­¤å…‰é ç”µé˜»æ˜¯ä¸å¤Ÿçš„ã€‚å¦å¤–ï¼ŒDisplayPort ä¸­çš„ä¸€ä¸ªé‡è¦ä¿¡å· HPD æ²¡æœ‰ç©ºé—²çš„å¼•è„šï¼Œå› æ­¤çƒ­æ’æ‹”äº‹ä»¶å’Œä¸­æ–­éƒ½æ˜¯é€šè¿‡ PD é€šé“ä½œä¸ºä¿¡æ¯å‘é€çš„ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œå¦‚æœä½ éœ€è¦ä» USB-C ç«¯å£ç”¨ DP altmode è¾“å‡º DP æˆ– HDMIï¼Œæœ‰ä¸€äº›èŠ¯ç‰‡ï¼ˆå¦‚ CYPD3120ï¼‰å¯ä»¥è®©ä½ ç¼–å†™å›ºä»¶æ¥å®ç°è¿™ä¸€åŠŸèƒ½ã€‚ ä½¿ DP æ¨¡å¼è„±é¢–è€Œå‡ºçš„ä¸€ä¸ªé‡è¦å› ç´ æ˜¯ï¼ŒUSB-C ç«¯å£æœ‰å››æ¡é«˜é€Ÿé€šé“ï¼Œè¿™ç§æ¨¡å¼å…è®¸åœ¨ USB-C ç«¯å£çš„ä¸€ä¾§è¿æ¥ USB3ï¼Œåœ¨å¦ä¸€ä¾§è¿æ¥åŒé€šé“ DisplayPortã€‚è¿™å°±æ˜¯æ‰€æœ‰&quot;USB3 ç«¯å£ã€å¤–è®¾å’Œ HDMI è¾“å‡º&quot;åº•åº§çš„å·¥ä½œåŸç†ã€‚å¦‚æœåŒé€šé“åˆ†è¾¨ç‡å¯¹ä½ æœ‰é™åˆ¶ï¼Œä½ ä¹Ÿå¯ä»¥ä¹°ä¸€ä¸ªå››é€šé“é€‚é…å™¨â€”â€”å› ä¸ºæ²¡æœ‰ USB3ï¼Œæ‰€ä»¥æ²¡æœ‰æ•°æ®ä¼ è¾“ï¼Œä½†ä½ å¯ä»¥é€šè¿‡ä¸¤ä¸ªé¢å¤–çš„ DisplayPort é€šé“è·å¾—æ›´é«˜çš„åˆ†è¾¨ç‡æˆ–å¸§ç‡ã€‚ æˆ‘çš„çœ‹æ³•æ˜¯ï¼ŒDisplayPort altmode æ˜¯ USB-C æœ€æ£’çš„åœ°æ–¹ä¹‹ä¸€ï¼Œè™½ç„¶æœ€ä¾¿å®œï¼ˆæˆ–è®¾è®¡æœ€ç³Ÿç³•ï¼‰çš„ç¬”è®°æœ¬ç”µè„‘å’Œæ‰‹æœºéƒ½ä¸æ”¯æŒå®ƒï¼Œä½†æ‹¥æœ‰ä¸€æ¬¾æ”¯æŒå®ƒçš„è®¾å¤‡ä¹Ÿæ˜¯ä¸€ä»¶ä¹äº‹ã€‚å½“ç„¶ï¼Œæœ‰æ—¶å¤§å…¬å¸ä¹Ÿä¼šç›´æ¥å‰¥å¤ºè¿™ç§ä¹è¶£ï¼Œæ¯”å¦‚è°·æ­Œã€‚ è¯‘è€…æ³¨ï¼šæ›´å¤šçš„ DisplayPort altmode ä¿¡æ¯å¯ä»¥åœ¨è¿™ç¯‡æ–‡ç« å’Œè¿™ç¯‡æ–‡ç« ä¸­æ‰¾åˆ°ã€‚ ç„¶åï¼Œè®©æˆ‘ä»¬æ¥è°ˆè°ˆå…¶ä¸­æœ€å¤æ‚çš„ altmodeã€‚ THUNDERBOLT å…·ä½“åˆ° USB-Cï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ Thunderbolt 3ï¼Œä¸ä¹…è¿˜å¯ä»¥ä½¿ç”¨ Thunderbolt 4ï¼Œä½†ç°åœ¨è¿™åªæ˜¯æƒ³è±¡ä¸­çš„ã€‚Thunderbolt 3 æœ€åˆæ˜¯ä¸€ç§ä¸“æœ‰è§„èŒƒï¼Œæœ€ç»ˆç”±è‹±ç‰¹å°”å¼€æºã€‚æ˜¾ç„¶ï¼Œä»–ä»¬å¼€æºå¾—è¿˜ä¸å¤Ÿï¼Œæˆ–è€…è¿˜æœ‰å…¶ä»–çš„æ³¨æ„äº‹é¡¹ï¼Œå› ä¸ºç›®å‰å¸‚åœºä¸Šçš„ Thunderbolt 3 è®¾å¤‡ä»ç„¶å®Œå…¨ä½¿ç”¨è‹±ç‰¹å°”èŠ¯ç‰‡åˆ¶é€ ï¼Œè€Œæˆ‘çš„çŒœæµ‹æ˜¯ï¼Œç¼ºä¹ç«äº‰æ˜¯å¯¼è‡´ä»·æ ¼ç‰¢ç‰¢å æ®ä¸‰ä½æ•°é¢†åŸŸçš„åŸå› ã€‚ä¸ºä»€ä¹ˆé¦–å…ˆè¦é€‰æ‹© Thunderbolt è®¾å¤‡ï¼Ÿé™¤äº†æ›´é«˜çš„é€Ÿåº¦ï¼Œè¿˜æœ‰ä¸€ä¸ªæ€æ‰‹é”ã€‚ æ‚¨å¯ä»¥é€šè¿‡ Thunderbolt è·å¾— PCIe ç›´é€šï¼Œé“¾æ¥å®½åº¦å¯è¾¾ 4xï¼è¿™ä¸€ç›´æ˜¯å¸Œæœ›è·å¾— eGPU æ”¯æŒæˆ–ä½¿ç”¨ NVMe é©±åŠ¨å™¨è¿›è¡Œå¿«é€Ÿå¤–éƒ¨å­˜å‚¨çš„ç”¨æˆ·çš„çƒ­é—¨è¯é¢˜ï¼Œä¸€äº›é»‘å®¢è¿˜å°†å…¶ç”¨äº PCIe è¿æ¥çš„ FPGAã€‚å¦‚æœä½ æœ‰ä¸¤å°æ”¯æŒ Thunderbolt çš„ç”µè„‘ï¼ˆæ¯”å¦‚ä¸¤å°ç¬”è®°æœ¬ç”µè„‘ï¼‰ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡æ”¯æŒ Thunderbolt çš„ç”µç¼†å°†å®ƒä»¬è¿æ¥èµ·æ¥â€”â€”è¿™å°†åœ¨ä¸¤å°ç”µè„‘ä¹‹é—´åˆ›å»ºä¸€ä¸ªé«˜é€Ÿç½‘ç»œæ¥å£ï¼Œè€Œæ— éœ€é¢å¤–çš„ç»„ä»¶ã€‚å½“ç„¶ï¼ŒThunderbolt è¿˜èƒ½åœ¨è‡ªèº«å†…éƒ¨è½»æ¾å®ç° DisplayPort å’Œ USB3 ä¼ è¾“ã€‚Thunderbolt æŠ€æœ¯åŠŸèƒ½å¼ºå¤§ï¼Œé€‚åˆé«˜çº§ç”¨æˆ·ä½¿ç”¨ã€‚ å°½ç®¡å¦‚æ­¤ï¼Œæ‰€æœ‰è¿™äº›ç‚«é…·åŠŸèƒ½éƒ½æ˜¯ä»¥ä¸“æœ‰å’Œå¤æ‚çš„æŠ€æœ¯å †æ ˆä¸ºä»£ä»·çš„ã€‚Thunderbolt å¹¶ä¸æ˜¯ä¸€ä¸ªé»‘å®¢å°±èƒ½è½»æ˜“å¼€å‘å‡ºæ¥çš„â€”â€”ä¸è¿‡ï¼Œæ€»æœ‰ä¸€å¤©ä¼šæœ‰äººå°è¯•çš„ã€‚è€Œä¸”ï¼Œå°½ç®¡ Thunderbolt åº•åº§æ‹¥æœ‰ä¸°å¯Œçš„åŠŸèƒ½ï¼Œä½†è½¯ä»¶æ–¹é¢çš„é—®é¢˜å´æ—¶æœ‰å‘ç”Ÿï¼Œå°¤å…¶æ˜¯åœ¨å°è¯•è®©ç¬”è®°æœ¬ç”µè„‘çš„ç¡çœ æ¨¡å¼æ­£å¸¸å·¥ä½œè€Œä¸ä¼šè®© eGPU å´©æºƒå†…æ ¸çš„æ—¶å€™ã€‚å¦‚æœè¿™ä¸€ç‚¹ç°åœ¨è¿˜ä¸æ˜æ˜¾çš„è¯ï¼Œæˆ‘æ­£ç„¦æ€¥åœ°ç­‰å¾…è‹±ç‰¹å°”å°†å…¶æ•´åˆèµ·æ¥ã€‚ å¤šè·¯å¤ç”¨å™¨ï¼Ÿä»€ä¹ˆæ˜¯å¤šè·¯å¤ç”¨å™¨ï¼Ÿ æˆ‘ä¸€ç›´åœ¨è¯´&quot;å¤šè·¯å¤ç”¨å™¨&quot;ã€‚é‚£æ˜¯ä»€ä¹ˆï¼Ÿç®€è€Œè¨€ä¹‹ï¼Œå°±æ˜¯æ ¹æ® USB-C æ—‹è½¬æƒ…å†µå¸®åŠ©å¤„ç†é«˜é€Ÿä¿¡å·äº¤æ¢çš„éƒ¨åˆ†ã€‚ é«˜é€Ÿé€šé“æ˜¯ USB-C ä¸­å—ç«¯å£æ—‹è½¬å½±å“æœ€å¤§çš„éƒ¨åˆ†ã€‚å¦‚æœæ‚¨çš„ USB-C ç«¯å£ä½¿ç”¨é«˜é€Ÿé€šé“ï¼Œåˆ™éœ€è¦ä¸€ä¸ªå¤šè·¯å¤ç”¨å™¨ï¼ˆmuxï¼‰é›†æˆç”µè·¯æ¥ç®¡ç†ä¸¤ç§å¯èƒ½çš„ USB-C æ¥å£æ–¹å‘â€”â€”å°†ä¸¤ç«¯ç«¯å£çš„æ–¹å‘å’Œç”µç¼†ä¸æ‰€è¿æ¥è®¾å¤‡å†…éƒ¨çš„å®é™…é«˜é€Ÿæ¥æ”¶å™¨å’Œå‘å°„å™¨ç›¸åŒ¹é…ã€‚æœ‰æ—¶ï¼Œå¦‚æœé«˜é€ŸèŠ¯ç‰‡æ˜¯é’ˆå¯¹ USB-C å¼€å‘çš„ï¼Œé‚£ä¹ˆè¿™äº›å¤šè·¯å¤ç”¨å™¨å°±æ˜¯é«˜é€ŸèŠ¯ç‰‡çš„å†…éƒ¨éƒ¨åˆ†ï¼Œä½†å¾ˆå¤šæ—¶å€™ï¼Œå®ƒä»¬æ˜¯ç‹¬ç«‹çš„èŠ¯ç‰‡ã€‚æƒ³è¦ä¸ºå°šæœªæ”¯æŒ USB-C çš„è®¾å¤‡æ·»åŠ é«˜é€Ÿ USB-C æ”¯æŒï¼Ÿå¤šè·¯å¤ç”¨å™¨å°†æ˜¯å®ç°é«˜é€Ÿé€šä¿¡çš„æ ¸å¿ƒå…ƒä»¶ã€‚ å¦‚æœæ‚¨çš„è®¾å¤‡æœ‰ä¸€ä¸ªå¸¦é«˜é€Ÿé€šé“çš„ USB-C æ’åº§ï¼Œå®ƒå°±éœ€è¦ä¸€ä¸ªå¤šè·¯å¤ç”¨å™¨ï¼Œè€Œé…å¤‡ç¼†çº¿å’Œæ’å¤´çš„è®¾å¤‡åˆ™ä¸éœ€è¦ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœä½¿ç”¨çº¿ç¼†è¿æ¥ä¸¤å°å¸¦æœ‰ USB-C æ’å£çš„é«˜é€Ÿè®¾å¤‡ï¼Œåˆ™ä¸¤å°è®¾å¤‡éƒ½éœ€è¦å¤šè·¯å¤ç”¨å™¨â€”â€”ç®¡ç†çº¿ç¼†æ—‹è½¬æ˜¯æ¯å°è®¾å¤‡çš„è´£ä»»ã€‚åœ¨ä¸¤è¾¹ï¼Œå¤šè·¯å¤ç”¨å™¨ï¼ˆæˆ–è¿æ¥æœ‰å¤šè·¯å¤ç”¨å™¨çš„ PD æ§åˆ¶å™¨ï¼‰å°†ç›‘æ§ CC å¼•è„šçš„æ–¹å‘ï¼Œå¹¶é‡‡å–ç›¸åº”æªæ–½ã€‚è¿™ç§å¤šè·¯å¤ç”¨å™¨ä¹Ÿæœ‰å¾ˆå¤šï¼Œç”¨é€”å„ä¸ç›¸åŒâ€”â€”è¿™å–å†³äºä½ æƒ³ä»ç«¯å£ä¸­å¾—åˆ°ä»€ä¹ˆã€‚ ä½ ä¼šåœ¨åªåœ¨ Type-C ç«¯å£ä¸Šå®ç° USB 3.0 çš„å»‰ä»·ç¬”è®°æœ¬ç”µè„‘ä¸­çœ‹åˆ° USB3 ä¸“ç”¨çš„å¤šè·¯å¤ç”¨å™¨ï¼Œå¦‚æœå®ƒæ”¯æŒ DisplayPortï¼Œä½ å°±ä¼šçœ‹åˆ°æœ‰é¢å¤–è¾“å…¥çš„å¤šè·¯å¤ç”¨å™¨æ¥æ··åˆè¿™äº›ä¿¡å·ã€‚åœ¨é…å¤‡ Thunderbolt é«˜ç«¯ç«¯å£çš„ç¬”è®°æœ¬ç”µè„‘ä¸­ï¼Œå¤šè·¯å¤ç”¨å™¨å°†å†…ç½®åœ¨ Thunderbolt èŠ¯ç‰‡ä¸­ã€‚å¯¹äºæ— æ³•ä½¿ç”¨ Thunderbolt æˆ–ä¸éœ€è¦ Thunderbolt çš„ä½¿ç”¨ USB-C å¼€å‘çš„é»‘å®¢æ¥è¯´ï¼ŒTI å’Œ VLI æä¾›äº†è®¸å¤šé€‚ç”¨äºå„ç§ç”¨é€”çš„ä¼˜ç§€å¤šè·¯å¤ç”¨å™¨ã€‚ä¾‹å¦‚ï¼Œæˆ‘æœ€è¿‘ä¸€ç›´åœ¨ä½¿ç”¨ DisplayPort over USB-Cï¼Œè€Œ VL170ï¼ˆä¼¼ä¹æ˜¯ TI HD3SS460 çš„ 1:1 å…‹éš†ç‰ˆï¼‰çœ‹èµ·æ¥æ˜¯ä¸€æ¬¾éå¸¸é€‚åˆ DisplayPort + USB3 ç»„åˆç”¨é€”çš„èŠ¯ç‰‡ã€‚ HD3SS460 ç­‰æ”¯æŒ DisplayPort çš„ USB-C å¤šè·¯å¤ç”¨å™¨æœ¬èº«ä¸èƒ½è¿›è¡Œ CC å¼•è„šç®¡ç†å’Œæ—‹è½¬æ£€æµ‹ï¼Œä½†è¿™æ˜¯ä¸€ä¸ªåˆç†çš„é™åˆ¶ - æ‚¨éœ€è¦é’ˆå¯¹ DisplayPort è¿›è¡Œç›¸å½“ç‰¹å®šçš„åº”ç”¨ PD é€šä¿¡ï¼Œè€Œè¿™å¾ˆå¿«å°±ä¼šè¶…å‡ºå¤šè·¯å¤ç”¨å™¨çš„åŠŸèƒ½èŒƒå›´ã€‚USB3 ä¸éœ€è¦ PD é€šä¿¡ï¼Œæ‚¨æ˜¯å¦æ»¡æ„ï¼ŸVL161 æ˜¯ä¸€æ¬¾ç”¨äº USB3 å¤šè·¯å¤ç”¨çš„ç®€å•èŠ¯ç‰‡ï¼Œå®ƒæœ‰ä¸€ä¸ªææ€§è¾“å…¥ï¼Œéœ€è¦æ‚¨è‡ªå·±è¿›è¡Œæ–¹å‘æ£€æµ‹ã€‚ å¦‚æœæ‚¨ä¹Ÿä¸æƒ³è¿›è¡Œæ–¹å‘æ£€æµ‹ï¼Œé‚£ä¹ˆæ¨¡æ‹Ÿã€çº¯ 5V PD æ˜¯å¦è¶³ä»¥æ»¡è¶³æ‚¨çš„ USB3 éœ€æ±‚ï¼Ÿè¯·ä½¿ç”¨ VL160 è¿™æ ·çš„äº§å“â€”â€”å®ƒå¯ä»¥è¿›è¡Œç»ˆç«¯è®¾å¤‡å’Œæºè®¾å¤‡æ¨¡æ‹Ÿ PDï¼ŒåŒæ—¶å¤„ç†ç”µæºå’Œé«˜é€Ÿé€šé“æ—‹è½¬ã€‚è¿™æ‰æ˜¯çœŸæ­£çš„&quot;æˆ‘å¸Œæœ›åœ¨ USB-C ä¸Šä½¿ç”¨ USB3ï¼Œæˆ‘å¸Œæœ›ä¸€åˆ‡éƒ½èƒ½ä¸ºæˆ‘ç®¡ç†&quot;çš„ ICï¼›ä¾‹å¦‚ï¼Œæœ€è¿‘çš„å¼€æº HDMI é‡‡é›†å¡çš„ USB-C ç«¯å£å°±ä½¿ç”¨äº† VL160ã€‚ä¸è¿‡ï¼Œä¸ºäº†å…¬å¹³èµ·è§ï¼Œæˆ‘æ²¡æœ‰å¿…è¦æŠŠ VL160 å•åˆ—å‡ºæ¥â€”â€”è¿™æ ·çš„é›†æˆç”µè·¯æœ‰å‡ åç§ï¼›&quot;USB-C çš„ USB3 å¤ç”¨å™¨æ— æ‰€ä¸èƒ½&quot;å¯èƒ½æ˜¯ç›®å‰æœ€æµè¡Œçš„ä¸€ç§ USB-C ç›¸å…³è§‚ç‚¹ã€‚ å·²è®¡åˆ’ï¼Œä½†å·²æ”¾å¼ƒçš„ altmode æœ‰å‡ ç§è¢«æ”¾å¼ƒçš„ USB-C æ¨¡å¼ã€‚ç¬¬ä¸€ç§æˆ‘ä¸ä¼šä¸ºå®ƒæ‚²ä¼¤â€”â€”å®ƒæ˜¯ HDMI æ¨¡å¼ï¼›å®ƒåªæ˜¯å°† HDMI æ¥å£å¼•è„šæ”¾åˆ° USB-C æ¥å£å¼•è„šä¸Šã€‚å®ƒå¯ä»¥é€šè¿‡ USB-C è¿æ¥ HDMIï¼Œè€Œä¸”ä¼¼ä¹æ›¾åœ¨æ™ºèƒ½æ‰‹æœºä¸ŠçŸ­æš‚ä½¿ç”¨è¿‡ã€‚ç„¶è€Œï¼ŒHDMI-DP è½¬æ¢é€šå¸¸æˆæœ¬é«˜æ˜‚ï¼Œè€Œ HDMI éœ€è¦å››ä¸ªå·®åˆ†çº¿å¯¹ï¼Œå› æ­¤æ— æ³•ä¸ USB 3.0 ç»“åˆä½¿ç”¨ï¼Œå†åŠ ä¸Š HDMI è®¸å¯åŒ…è¢±ï¼ŒHDMI æ›¿ä»£æ¨¡å¼ä¸å¾—ä¸ä¸æ˜“äºè½¬æ¢ä¸º HDMI çš„ DisplayPort æ›¿ä»£æ¨¡å¼ç«äº‰ã€‚æˆ‘çœŸè¯šåœ°è®¤ä¸ºå®ƒåº”è¯¥ç»§ç»­å­˜åœ¨ï¼Œå› ä¸ºæˆ‘ä¸ç›¸ä¿¡å¢åŠ æ›´å¤šçš„ HDMI å°±èƒ½æ”¹å–„æˆ‘ä»¬çš„ä¸–ç•Œã€‚ ä¸è¿‡ï¼Œå¦ä¸€ç§æ¨¡å¼å…¶å®å¾ˆæœ‰è¶£ï¼Œå®ƒå« VirtualLinkã€‚ä¸€äº›å¤§å‹ç§‘æŠ€å…¬å¸ä¸€ç›´åœ¨ç ”ç©¶ USB-C åœ¨ VR æ–¹é¢çš„åŠŸèƒ½ï¼Œæ¯•ç«Ÿï¼Œå½“ä½ çš„ VR å¤´æ˜¾åªéœ€è¦ä¸€æ ¹çº¿ç¼†å°±èƒ½å®Œæˆæ‰€æœ‰æ“ä½œæ—¶ï¼Œé‚£çœŸæ˜¯å¤ªæ£’äº†ã€‚ç„¶è€Œï¼ŒVR çœ¼é•œéœ€è¦ä¸€ä¸ªé«˜åˆ†è¾¨ç‡ã€é«˜å¸§é€Ÿç‡çš„åŒæ˜¾ç¤ºè§†é¢‘æ¥å£ï¼Œä»¥åŠä¸€ä¸ªç”¨äºè¾…åŠ©æ‘„åƒå¤´å’Œä¼ æ„Ÿå™¨çš„é«˜é€Ÿæ•°æ®è¿æ¥ï¼Œè€Œé€šå¸¸çš„&quot;åŒé€šé“ DisplayPort+USB3&quot;ç»„åˆåœ¨å½“æ—¶æ— æ³•æä¾›è¿™æ ·çš„åŠŸèƒ½ã€‚é‚£è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ VirtualLink é›†å›¢è¡¨ç¤ºï¼Œè¿™å¾ˆç®€å•ï¼Œåªè¦å»æ‰ USB-C è¿æ¥å™¨ä¸Šçš„ä¸¤ä¸ªé‡å¤çš„ USB2 å¯¹ï¼Œç”¨å››ä¸ªå¼•è„šè¿æ¥ USB3 å³å¯ã€‚è¿˜è®°å¾—æˆ‘åŠå¹´å‰åœ¨ä¸€ç¯‡çŸ­æ–‡ä¸­æåˆ°çš„ USB2 è‡³ USB3 è½¬æ¢å™¨èŠ¯ç‰‡å—ï¼Ÿæ˜¯çš„ï¼Œå®ƒæœ€åˆçš„ç”¨é€”æ˜¯ VirtualLinkã€‚å½“ç„¶ï¼Œè¿™ç§å®‰æ’éœ€è¦æ›´æ˜‚è´µçš„å®šåˆ¶çº¿ç¼†ï¼Œå¹¶é¢å¤–å¢åŠ ä¸¤ä¸ªå±è”½çº¿å¯¹ï¼Œè€Œä¸”è¿˜è¦æ±‚ PC æä¾›é«˜è¾¾ 27W çš„åŠŸç‡ï¼Œå› æ­¤éœ€è¦ 9V çš„è¾“å‡ºç”µå‹â€”â€”è¿™åœ¨éå¢™æ’å……ç”µå™¨æˆ–ç”µæºç®±çš„ USB-C ç«¯å£ä¸Šéå¸¸ç½•è§ã€‚USB2 ä¸ USB3 çš„åç¦»è®©ä¸€äº›äººæ„Ÿåˆ°ä¸æ»¡ï¼›ä¸è¿‡ï¼Œå¯¹äº VR è€Œè¨€ï¼ŒVirtualLink çœ‹èµ·æ¥éå¸¸æœ‰ç”¨ã€‚ ä¸€äº› GPU åœ¨å‡ºå‚æ—¶æ”¯æŒ VirtualLinkï¼Œä½†æœ€ç»ˆè¿˜æ˜¯ä¸å¤Ÿï¼Œè€Œä»¥ç¼ºå°‘ USB-C ç«¯å£è€Œé—»åçš„ç¬”è®°æœ¬ç”µè„‘ä¹Ÿä¸å±‘ä¸€é¡¾ã€‚è¿™å¯¼è‡´è¿™ä¸€å®‰æ’çš„å…³é”®å‚ä¸è€… Valve æ”¾å¼ƒäº†åœ¨ Valve Index ä¸­æ·»åŠ  VirtualLink é›†æˆï¼Œä»æ­¤å¼€å§‹èµ°ä¸‹å¡è·¯ã€‚é—æ†¾çš„æ˜¯ï¼ŒVirtualLink ä»æœªçœŸæ­£èµ·é£ã€‚æœ¬æ¥ï¼ŒVirtualLink ä¼šæ˜¯ä¸€ç§æœ‰è¶£çš„è¾…åŠ©æ¨¡å¼â€”â€”å¯¹äº VR ç”¨æˆ·æ¥è¯´ï¼Œå•æ ¹çº¿ç¼†ä¼šéå¸¸æ£’ï¼Œè€Œä¸” USB-C å¯¹ç”µå‹çš„è¦æ±‚ä¹Ÿä¼šæé«˜ï¼Œè¿™ä¹Ÿä¸ºæˆ‘ä»¬æä¾›äº†å¯ä½¿ç”¨ PD çš„é«˜äº 5V çš„ç«¯å£â€”â€”è€Œç°åœ¨çš„ç¬”è®°æœ¬ç”µè„‘å’Œä¸ªäººç”µè„‘å‡ ä¹éƒ½ä¸æä¾›è¿™ç§ç«¯å£ã€‚æ˜¯çš„ï¼Œæé†’ä¸€ä¸‹â€”â€”å¦‚æœä½ çš„å°å¼æœºæˆ–ç¬”è®°æœ¬ç”µè„‘ä¸Šæœ‰ä¸€ä¸ª USB-C ç«¯å£ï¼Œå®ƒå½“ç„¶ä¼šç»™ä½ æä¾› 5 V ç”µå‹ï¼Œä½†ä½ ä¸ä¼šå¾—åˆ°æ›´é«˜çš„è¾“å‡ºç”µå‹ã€‚ ä¸è¿‡ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å¥½çš„ä¸€é¢ã€‚å¦‚æœæ‚¨çš„ GPU ç¢°å·§é…å¤‡äº† USB-C ç«¯å£ï¼Œé‚£ä¹ˆå®ƒå°†åŒæ—¶æ”¯æŒ USB3 å’Œ DisplayPortï¼ ç»Ÿä¸€å¸¦æ¥å…¼å®¹æ€§ USB-C çš„æœ€å¤§ä¼˜åŠ¿åœ¨äºï¼šå¦‚æœå‚å•†æˆ–é»‘å®¢æ„¿æ„ï¼Œå®Œå…¨å¯ä»¥å®šä¹‰è‡ªå·±çš„æ··åˆæ¨¡å¼ï¼Œè™½ç„¶é€‚é…å™¨æ˜¯åŠä¸“æœ‰çš„ï¼Œä½†å…¶æ ¸å¿ƒä»æ˜¯ USB-C ç«¯å£ï¼Œå¯ç”¨äºå……ç”µå’Œæ•°æ®ä¼ è¾“ã€‚æƒ³è¦ä»¥å¤ªç½‘æ¨¡å¼æˆ–åŒç«¯å£ SATAï¼Ÿå°±è¿™ä¹ˆåŠã€‚è¿‡å»ï¼Œæˆ‘ä»¬ä¸å¾—ä¸ä¸ºè®¾å¤‡å¯»æ‰¾éå¸¸æ™¦æ¶©éš¾æ‡‚çš„è¿æ¥å™¨ï¼Œæ¯ä¸€ä¸ªåŸºåº§å’Œå……ç”µè¿æ¥å™¨éƒ½ä¸ä¸€æ ·ï¼Œå¦‚æœè¶³å¤Ÿç½•è§ï¼Œç”šè‡³æœ‰å¯èƒ½æ‰¾åˆ°çš„è¯ï¼Œæ¯ä¸ªè¿æ¥å™¨çš„ä»·æ ¼å¯èƒ½é«˜è¾¾ 10 ç¾å…ƒï¼Œè¿™æ ·çš„æ—¥å­å·²ç»ä¸€å»ä¸å¤è¿”äº†ã€‚ å¹¶ä¸æ˜¯æ¯ä¸ª USB-C ç«¯å£éƒ½å¿…é¡»å®ç°æ‰€æœ‰è¿™äº›åŠŸèƒ½ï¼Œè®¸å¤š USB-C ç«¯å£å¹¶ä¸å…·å¤‡è¿™äº›åŠŸèƒ½ã€‚ä½†æ˜¯ï¼Œå¾ˆå¤š USB-C ç«¯å£éƒ½èƒ½å®ç°è¿™äº›åŠŸèƒ½ï¼Œè€Œä¸”éšç€æ—¶é—´çš„æ¨ç§»ï¼Œæˆ‘ä»¬èƒ½ä»ä¸€ä¸ªæ™®é€šçš„ USB-C ç«¯å£ä¸­è·å¾—è¶Šæ¥è¶Šå¤šçš„åŠŸèƒ½ã€‚ä»é•¿è¿œæ¥çœ‹ï¼Œè¿™ç§ç»Ÿä¸€å’Œæ ‡å‡†åŒ–å°†å¸¦æ¥å›æŠ¥ï¼Œè™½ç„¶å¶å°”ä¼šå‡ºç°åå·®ï¼Œä½†åˆ¶é€ å•†å°†å­¦ä¼šæ›´å·§å¦™åœ°å¤„ç†è¿™äº›åå·®ã€‚","categories":[{"name":"Translation","slug":"Translation","permalink":"https://blog.inoki.cc/categories/Translation/"},{"name":"Chinese","slug":"Translation/Chinese","permalink":"https://blog.inoki.cc/categories/Translation/Chinese/"},{"name":"USB","slug":"USB","permalink":"https://blog.inoki.cc/categories/USB/"},{"name":"ç¡¬ä»¶","slug":"ç¡¬ä»¶","permalink":"https://blog.inoki.cc/categories/ç¡¬ä»¶/"}],"tags":[{"name":"ç¿»è¯‘","slug":"ç¿»è¯‘","permalink":"https://blog.inoki.cc/tags/ç¿»è¯‘/"},{"name":"ä¸­æ–‡","slug":"ä¸­æ–‡","permalink":"https://blog.inoki.cc/tags/ä¸­æ–‡/"},{"name":"ç¡¬ä»¶","slug":"ç¡¬ä»¶","permalink":"https://blog.inoki.cc/tags/ç¡¬ä»¶/"},{"name":"USB","slug":"USB","permalink":"https://blog.inoki.cc/tags/USB/"}]},{"title":"ã€è¯‘ã€‘å…³äº USB-C çš„ä¸€åˆ‡ï¼šç”µé˜»å’Œç”µå­æ ‡è®°ï¼ˆE-markerï¼‰","slug":"All-about-USB-C-resistors-and-emarkers","date":"2023-09-13T23:22:00.000Z","updated":"2025-03-08T09:40:48.547Z","comments":true,"path":"2023/09/13/All-about-USB-C-resistors-and-emarkers/","link":"","permalink":"https://blog.inoki.cc/2023/09/13/All-about-USB-C-resistors-and-emarkers/","excerpt":"","text":"åŸæ–‡é“¾æ¥ï¼šhttps://hackaday.com/2023/01/04/all-about-usb-c-resistors-and-emarkers/ å¦‚æœæ‚¨ä¸€ç›´å…³æ³¨æˆ‘ä»¬çš„ USB-C ç³»åˆ—æ–‡ç« ï¼Œå°±ä¼šçŸ¥é“ USB-C ç”µç¼†ä¸­çš„ CC çº¿ç”¨äºé€šä¿¡å’Œæ—‹è½¬æ£€æµ‹ã€‚ä¸è¿‡ä¸ä¸ºäººçŸ¥çš„æ˜¯ï¼ŒUSB-C æœ‰ä¸¤ç§é€šä¿¡åè®®ï¼Œä¸€ç§æ˜¯æ¨¡æ‹Ÿåè®®ï¼Œå¦ä¸€ç§æ˜¯æ•°å­—åè®®ã€‚ä»Šå¤©ï¼Œè®©æˆ‘ä»¬æ¥äº†è§£ä¸€ä¸‹ USB-C ä¸­ä½¿ç”¨çš„æ¨¡æ‹Ÿä¿¡å·â€”â€”åœ¨ä¸€å®šç¨‹åº¦ä¸Šï¼Œäº†è§£ä¸€ä¸‹ä¼ è¯´ä¸­çš„ 5.1kÎ© ç”µé˜»åŠå…¶å·¥ä½œåŸç†ã€‚æˆ‘ä»¬è¿˜å°†äº†è§£ USB-C ä¸­çš„æ ‡è®°ç¬¦å·å’Œç¥ç§˜çš„ VCONNï¼ USB-C ç”µæºåœ¨ä¸º VBUS æä¾› 5V ç”µå‹ä¹‹å‰ï¼Œéœ€è¦åœ¨ CC çº¿è·¯ä¸Šæ£€æµ‹åˆ°ä¸€å®šå€¼çš„ä¸‹æ‹‰ï¼Œè€Œä»»ä½•æ›´é«˜çš„ç”µå‹éƒ½å¿…é¡»é€šè¿‡æ•°å­—åå•†ç¡®å®šã€‚æ— è®ºä½œä¸ºç¬”è®°æœ¬ç”µè„‘çš„ç«¯å£è¿˜æ˜¯å……ç”µå™¨ï¼ŒPSU éƒ½èƒ½æ£€æµ‹åˆ°ä¸‹æ‹‰å€¼ï¼ˆç§°ä¸º Rdï¼‰ï¼Œå› ä¸ºå®ƒåœ¨ CC çº¿è·¯ä¸Šä¿æŒäº†ä¸Šæ‹‰ï¼ˆç§°ä¸º Rpï¼‰â€”â€”ç„¶åå®ƒä¼šæ£€æŸ¥ CC ä¸Šæ˜¯å¦äº§æˆäº†åˆ†å‹ï¼Œä»¥åŠæ‰€äº§ç”Ÿçš„ç”µå‹æ˜¯å¦åœ¨å¯æ¥å—çš„èŒƒå›´å†…ã€‚ å¦‚æœæ‚¨æ’å…¥çš„è®¾å¤‡æ— æ³•é€šè¿‡çº¿ç¼†ä¸­çš„ CC çº¿å®ç°ä¸‹æ‹‰ï¼Œé‚£ä¹ˆæ‚¨çš„è®¾å¤‡å°†æ°¸è¿œæ— æ³•ä» USB-C ç«¯å£è·å¾—ç”µæºï¼Œåªèƒ½ä½¿ç”¨ USB-A è½¬ USB-C çº¿ç¼†ã€‚å³ä½¿æ˜¯èƒ½ä¸ USB-C æ•°å­—éƒ¨åˆ†é€šä¿¡çš„æ™ºèƒ½è®¾å¤‡ä¹Ÿä¼šæœ‰ä¸‹æ‹‰åŠŸèƒ½ï¼Œåªæ˜¯è¿™äº›ä¸‹æ‹‰åŠŸèƒ½æ˜¯æ‰€ä½¿ç”¨çš„ USB-C é€šä¿¡ IC çš„å†…éƒ¨åŠŸèƒ½ã€‚å› æ­¤ï¼Œæƒ³è¦å……ç”µçš„ USB-C ç«¯å£éœ€è¦æœ‰ä¸‹æ‹‰åŠŸèƒ½ã€‚ è¿™éƒ¨åˆ†ç°åœ¨å·²ç»ä¼—æ‰€å‘¨çŸ¥ï¼Œä½†æˆ‘ä»¬åœ¨å»‰ä»·è®¾å¤‡ä¸Šçœ‹åˆ°è¿‡å¾ˆå¤šç”µé˜»ä¸è¶³çš„æ•…éšœï¼Œä¿—è¯è¯´çš„å°±æ˜¯éœ€è¦&quot;æ·»åŠ  5.1kÎ© ç”µé˜»&quot;ã€‚ä½ å¯èƒ½ä¼šè§‰å¾—è¿™éƒ¨åˆ†çš„åŸç†å¾ˆç®€å•ï¼Œä¹Ÿå¯èƒ½ä¼šå¤§åƒä¸€æƒŠã€‚ ä¸Šæ‹‰ã€ä¸‹æ‹‰å’Œç”±æ­¤äº§ç”Ÿçš„åˆ†å‹ USB-C ç«¯å£æœ‰ä¸¤ç§ç”µæºè§’è‰²â€”â€”ç”µæºç«¯å’Œæ¶ˆè€—ç«¯ã€‚åœ¨ 5V ç”µå‹ä¸‹ä½¿ç”¨ USB-C æ—¶ï¼ŒUSB-C çš„æ¨¡æ‹Ÿä¾§å¯è®©è®¾è®¡äººå‘˜æ·»åŠ ä¸€ç§ç®€å•çš„æ–¹æ³•æ¥åå•†ç”µæºè¦æ±‚ï¼Œè€Œæ— éœ€ä½¿ç”¨ç‰¹å®šæˆ–æ˜‚è´µçš„é›†æˆç”µè·¯â€”â€”å¯ä»¥ä½¿ç”¨ä¸Šæ‹‰æ¥æ§åˆ¶ç”µæºï¼Œå¹¶ä½¿ç”¨ä¸‹æ‹‰æ¥æ§åˆ¶ç»ˆç«¯ã€‚ä¸Šæ‹‰å’Œä¸‹æ‹‰çš„ç»„åˆå½¢æˆä¸€ä¸ªåˆ†å‹å™¨ï¼Œåˆ†å‡ºçš„ç”µå‹æœ¬èº«ä»£è¡¨å……ç”µå™¨çš„ç”µæµèƒ½åŠ›ã€‚ åœ¨æ¨¡æ‹Ÿä¿¡å·æ¨¡å¼ä¸‹ï¼Œä¿¡å·æºå¯ä»¥æ ¹æ®å¯ç”¨çš„åŠŸç‡é¢„ç®—è°ƒæ•´ä¸Šæ‹‰ï¼Œè¿™ä¸€ç‚¹éå¸¸æœ‰ç”¨ã€‚æƒ³è±¡ä¸€ä¸‹ï¼šä¸€å°ç¬”è®°æœ¬ç”µè„‘æˆ–å……ç”µå™¨ä¸Šæœ‰å¤šä¸ª USB-C ç«¯å£ã€‚éšç€æ¯ä¸ªç«¯å£çš„è´Ÿè½½å¢åŠ ï¼Œå¯æä¾›ç»™å…¶ä»–ç«¯å£çš„ç”µæµå°±ä¼šå‡å°‘ï¼Œè¿™åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå–å†³äºè®¾å¤‡çš„å†…éƒ¨æ„é€ ã€‚ä»¥ Framework ç¬”è®°æœ¬ç”µè„‘ä¸ºä¾‹ï¼Œå®ƒé…å¤‡äº†å››ä¸ª USB-C ç«¯å£ã€‚æ¯ä¸ªç«¯å£å¯ä»¥åœ¨ 5V/3A çš„ç”µå‹ä¸‹æä¾› 15W çš„åŠŸç‡ï¼Œä½†å¦‚æœæ‚¨æƒ³åŒæ—¶ä¸ºå››ä¸ªçº¯ USB-C ç«¯å£çš„è®¾å¤‡ä¾›ç”µï¼Œé‚£ä¹ˆå®ƒåªèƒ½ä¸ºç¬¬ä¸‰å’Œç¬¬å››ä¸ªç«¯å£æä¾› 1.5A çš„ç”µæµï¼Œä»å·¥ç¨‹å­¦çš„è§’åº¦æ¥çœ‹ï¼Œè¿™æ˜¯ä¸€ä¸ªç›¸å½“åˆç†çš„é™åˆ¶ã€‚ è¿™æ„å‘³ç€ï¼Œåƒæœ€å¤§ç”µæµä¸º 1.5A å’Œ 3A çš„é«˜è€—èƒ½è®¾å¤‡ï¼Œéœ€è¦ç›‘æ§ CC çº¿è·¯ä¸Šçš„ç”µå‹ï¼Œä»¥ç¡®å®šå®ƒä»¬æ˜¯å¦ä¼šè¶…å‡ºåŠŸç‡é¢„ç®—ï¼Œæ–¹æ³•æ˜¯è°ƒæ•´å…¶åŠŸç‡éœ€æ±‚ï¼Œæˆ–è€…åœ¨è¶…å‡ºæ–°è®¾å®šçš„ç”µæµé™åˆ¶æ—¶å…³é—­ã€‚ è¿™å¯¹ç”¨æˆ·æ¥è¯´æ„å‘³ç€ä»€ä¹ˆï¼Ÿå¦‚æœä½ çš„è®¾å¤‡è¶³å¤Ÿä½åŠŸè€—ï¼Œé‚£å°±æ²¡ä»€ä¹ˆã€‚æ‚¨çš„è®¾å¤‡åº”ç›‘æ§ CC çº¿è·¯ä¸Šçš„ç”µå‹ï¼Œå¹¶ç›¸åº”åœ°è¿›è¡Œè°ƒæ•´ã€‚æœ‰äº›é¢å‘æ¶ˆè´¹è€…çš„è®¾å¤‡ä¸ä¼šè¿™æ ·åšï¼Œä½†è¿™ç§æƒ…å†µå¾ˆå°‘è§ã€‚ è€Œä½œä¸ºé»‘å®¢ï¼Ÿå¦‚æœä½ åˆ¶ä½œçš„è®¾å¤‡ä» USB-C ç«¯å£æ¥å–ç”µï¼Œå¹¶å¸Œæœ›åœ¨ 5V ç”µå‹ä¸‹è·å¾— 3A ç”µæµï¼Œé‚£ä¹ˆè¯·è®°ä½ï¼Œå¹¶éæ‰€æœ‰çš„ USB-C ç«¯å£éƒ½èƒ½æä¾›è¿™æ ·çš„ç”µæµã€‚ä¸è¿‡ï¼Œæ‚¨å¯ä»¥é€šè¿‡æµ‹é‡ CC çº¿è·¯ä¸Šçš„ç”µå‹æ¥æ£€æŸ¥ 3A çš„å¯ç”¨æ€§ã€‚æˆ–è€…ä¹Ÿå¯ä»¥ä¸ç”¨ï¼Œæˆ‘ä¸æ˜¯ä½ å¦ˆï¼ˆä¸ä¸ºä½ è´Ÿè´£ï¼‰ï¼Œå¾ˆå¤šé»‘å®¢è®¾å¤‡éƒ½æ˜¯åœ¨é›¶æ£€æµ‹çš„æƒ…å†µä¸‹èŒå£®æˆé•¿çš„ã€‚ é‚£ä¹ˆï¼ŒCC çº¿è·¯ä¸Šä¼šæœ‰ä»€ä¹ˆç”µå‹å‘¢ï¼Ÿæ‚¨å¯ä»¥ä½¿ç”¨å¾®æ§åˆ¶å™¨çš„åŸºæœ¬ ADC æˆ–æ¯”è¾ƒå™¨è¯»å–è¿™ç§ç”µå‹ã€‚ å¦‚æ‚¨æ‰€è§ï¼Œæ‰€æœ‰ç”µå‹éƒ½åœ¨ 3.3V ä»¥ä¸‹ï¼Œå› æ­¤å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯å…¨é€Ÿå¾®æ§åˆ¶å™¨ ADCï¼Œå°±ä¸éœ€è¦åˆ†å‹å™¨ã€‚å¯¹äº†ï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯ USB-C æ’åº§ï¼Œå½“ç„¶è¦è®°å¾—åˆ†åˆ«ç›‘æ§ä¸¤ä¸ª CC å¼•è„šã€‚ çœŸçš„éœ€è¦å— æˆ‘ä»¬çœŸçš„éœ€è¦ç›‘æ§ CC ç”µå‹å—ï¼Ÿå¦‚æœè¶…è¿‡äº†ç”µæºç«¯å£æ‰€èƒ½æä¾›çš„ç”µæµéœ€æ±‚ï¼Œå®ƒå°±ä¼šåœæ­¢å‘è®¾å¤‡ä¾›ç”µâ€”â€”è¿™æ˜¯ä¸€ä¸ªç›¸å½“å®‰å…¨çš„ç»“æœã€‚å¦ä¸€æ–¹é¢ï¼ŒUSB-C çš„ç†å¿µæ˜¯è¦æœ‰å¤šå±‚ä¿éšœæªæ–½ï¼Œå¦‚æœæ‚¨ä½¿ç”¨ç®€å•çš„ 5.1kÎ© ç”µé˜»å™¨æ–¹æ³•æ¥åˆ¶é€  15W çš„è®¾å¤‡ï¼Œæ‚¨ä¸å¦¨è®©å®ƒæˆä¸ºä¸€ä¸ªèƒ½æ£€æµ‹åˆ°ä¾›ç”µä¸è¶³çš„è®¾å¤‡ã€‚è€Œä¸”ï¼Œè¿™ä¹Ÿå¾ˆå®¹æ˜“åšåˆ°ï¼ å¦åˆ™ï¼Œä½ å°±å¯ä»¥æœŸå¾…ä½ çš„è®¾å¤‡ä¸ä¸€ä¸ªå§‹ç»ˆèƒ½åœ¨ 5V ç”µå‹ä¸‹æä¾› 3A ç”µæµçš„å……ç”µå™¨é…å¯¹ï¼Œè€Œç»å¤§å¤šæ•°å……ç”µå™¨éƒ½èƒ½åšåˆ°è¿™ä¸€ç‚¹ã€‚ç„¶è€Œï¼Œå¦‚æœæ‚¨å°†è®¾å¤‡è¿æ¥åˆ°ç¬”è®°æœ¬ç”µè„‘ç«¯å£ï¼Œæ— è®ºæ˜¯ USB-C è¿˜æ˜¯ä½¿ç”¨ USB-C é€‚é…å™¨çš„ USB-Aï¼Œæ‚¨éƒ½ä¸èƒ½å®Œå…¨æŒ‡æœ› 3A ç”µæµå§‹ç»ˆå­˜åœ¨ï¼Œæ€»éœ€è¦æ£€æŸ¥ä¸€ä¸‹ã€‚ ä½† 5.1kÎ© å¹¶ä¸æ˜¯æ‚¨ä¼šé‡åˆ°çš„å”¯ä¸€ä¸‹æ‹‰æƒ…å†µã€‚è¿˜æœ‰ä¸€ç§ä¸åŒçš„é™å‹æ–¹å¼ï¼Œæˆ‘ä»¬é»‘å®¢ä»¥å‰ä¹Ÿé‡åˆ°è¿‡ï¼Œé‚£å°±æ˜¯ Raâ€”â€”å½“æˆ‘ä»¬è°ˆåˆ°å¸¦æœ‰ç”µå­æ ‡è®°ç”µç¼†æ—¶ä¼šå‡ºç°çš„ä¸€ä¸ªä¸œè¥¿ã€‚ VCONNï¼šæ­£ç¡®è¯†åˆ«ç”µå­æ ‡è®°ï¼ˆEmarker/E-markerï¼‰èŠ¯ç‰‡ ç”µå­æ ‡è®°èŠ¯ç‰‡åŸºæœ¬ä¸Šå°±æ˜¯ä¸€ä¸ªèƒ½ä¸ USB PD åè®®é€šä¿¡çš„å­˜å‚¨èŠ¯ç‰‡ã€‚å®ƒä»¬ç”¨äºæ¯”æ™®é€šç”µç¼†ç•¥å¾®é«˜çº§çš„ç”µç¼†ä¸­ï¼Œå³å…·æœ‰ USB3 å’Œ Thunderbolt ç­‰é«˜é€ŸåŠŸèƒ½çš„ç”µç¼†ä»¥åŠ 5A ç”µç¼†ã€‚å®ƒä»¬æ¥å…¥ç”µç¼†ä¸Šçš„ CC çº¿è·¯ï¼Œå¯ç”±ç”µæºæˆ–ç»ˆç«¯æŸ¥è¯¢ï¼Œä½†é€šå¸¸ç”±æºæŸ¥è¯¢ã€‚ å¦‚æœ USB-C çº¿ç¼†å†…æœ‰ä¸€ä¸ªç”µå­æ ‡è®°èŠ¯ç‰‡ï¼Œå®ƒä¹Ÿéœ€è¦ç”µï¼Œè€Œ USB-C æœ‰ä¸€ç§ä¸ºå…¶ä¾›ç”µçš„æ–¹æ³•â€”â€”è¿™å°±æ˜¯ VCONNã€‚å¦‚ä½ æ‰€çŸ¥ï¼Œåªæœ‰ä¸€ä¸ª CC å¼•è„šç”¨äºé€šä¿¡ã€‚è€Œæœªè¿æ¥åˆ° CC çº¿è·¯çš„å¦ä¸€ä¸ª CC å¼•è„šç”¨äºä¸ºç”µå­æ ‡è®°èŠ¯ç‰‡ä¾›ç”µï¼›å¦ä¸€ä¸ª CC å¼•è„šå°±ä¼šå˜ä¸º VCONNã€‚ åœ¨ USB-C æ’å¤´ä¸­ï¼Œæ‚¨å¯ä»¥çŸ¥é“å“ªä¸ª CC å¼•è„šä¸ CC çº¿ç›¸è¿ï¼Œå› æ­¤å¯ä»¥äº‹å…ˆçŸ¥é“å“ªä¸ªå¼•è„šå°†å……å½“ VCONNã€‚ä½†æ˜¯ï¼Œæ‚¨å¯ä»¥ä»¥ä¸¤ç§ä¸åŒçš„æ–¹å‘æ’å…¥æ’å¤´ï¼Œè¿™æ„å‘³ç€æ’åº§å¿…é¡»èƒ½å¤Ÿå°†ä¸¤ä¸ª CC é’ˆè„šä¸­çš„ä»»ä½•ä¸€ä¸ªé’ˆè„šè§†ä¸º CC é€šä¿¡çº¿æˆ– VCONN é’ˆè„šã€‚è¿™å°±ä½¿ç”µç¼†ä¿æŒäº†ç›¸å¯¹ç®€å•å’Œå»‰ä»·çš„ç‰¹æ€§ï¼Œè®©è®¾å¤‡æœ¬èº«æ¥å¤„ç†å¤æ‚çš„é—®é¢˜ã€‚ ä½œä¸ºé»‘å®¢ï¼Œä½ å¾ˆå¯èƒ½ä¸éœ€è¦æ‹…å¿ƒ VCONNã€‚æˆ‘ä»¬ä¸­çš„å¤§å¤šæ•°äººéƒ½ä¼šä½¿ç”¨ USB2 æˆ– USB3ï¼Œç”µæµä¸è¶…è¿‡ 3Aï¼Œè€Œç”µå­æ ‡è®°èŠ¯ç‰‡æ£€æŸ¥å¹¶ä¸æ˜¯é‚£ä¹ˆå¿…è¦ã€‚é™¤æ­¤ä»¥å¤–ï¼Œè¿˜æœ‰ä¸€äº›é›†æˆç”µè·¯å¯ä»¥ä¸ºæ‚¨è§£å†³ USB-C çš„å„ç§é—®é¢˜ï¼Œå…¶ä¸­å°±åŒ…æ‹¬æä¾› VCONNã€‚ å®é™…ä¸Š VCONN çš„ç”µå‹è¦æ±‚ç›¸å½“å®½æ¾ï¼Œä¸æ‚¨éœ€è¦ä¸º VBUS æä¾›çš„ 5V ç”µå‹ç›¸æ¯”ï¼Œå…è®¸çš„ç”µå‹èŒƒå›´ä¸º 3V è‡³ 5.5Vï¼›åœ¨æ™ºèƒ½æ‰‹æœºçš„å®ç°ä¸­ï¼Œé€šå¸¸æ˜¯ç›´æ¥é‡‡ç”¨é”‚ç¦»å­å•èŠ¯ç”µæ± ç”µå‹ï¼Œè¿™æ„å‘³ç€æ‚¨å¯ä»¥é¿å…ä¸¤æ¬¡è½¬æ¢ï¼Œå¹¶èƒ½èŠ‚çœå¤§é‡ç”µèƒ½ã€‚æ¯•ç«Ÿï¼ŒVCONN ç”µæºå¹¶ä¸åªæ˜¯ä¸ºç”µå­æ ‡è®°èŠ¯ç‰‡ä¾›ç”µï¼Œå®ƒè¿˜å¯ä»¥ä¸ºå°å‹é…ä»¶å’Œè€³æœºé€‚é…å™¨ä¾›ç”µï¼ŒåŠŸç‡é¢„ç®—æœ€é«˜å¯è¾¾ 1Wã€‚æ¥è‡ª USB-C hacker çš„è¿™ä¸€æœ‰è¶£æ¼”ç¤ºè®²è¿°äº†å¦‚ä½•åˆ¶ä½œ VCONN ä¾›ç”µè®¾å¤‡çš„åŸå‹ï¼Œè¿™äº›è®¾å¤‡æ¶µç›–äº† USB-C è§„èŒƒå…è®¸ VCONN ä¾›ç”µè®¾å¤‡åšçš„æ‰€æœ‰äº‹æƒ…ã€‚ å°½ç®¡å¦‚æ­¤ï¼Œç”µå­æ ‡è®°èŠ¯ç‰‡æ˜¯æœ€å¸¸è§çš„ VCONN æ ‡å¿—ï¼Œè€Œä¸”éå¸¸ç®€å•ã€‚æœ‰æ—¶ä¸€æ ¹ç”µç¼†åŒ…å«ä¸¤ä¸ªç”µå­æ ‡è®°èŠ¯ç‰‡ï¼Œæœ‰æ—¶åªåŒ…å«ä¸€ä¸ªï¼Œè¿™æ˜¯ç”Ÿäº§å·¥è‰ºçš„é€‰æ‹©ã€‚å¦‚æœæ˜¯å•ç”µå­æ ‡è®°ç”µç¼†ï¼Œç”µç¼†çš„ä¸€ç«¯å°†åŒ…å«ç”µå­æ ‡è®°èŠ¯ç‰‡ï¼Œå¦å¤–è¿˜æœ‰ä¸€æ¡&quot;å°†æ ‡è®°ç”µæºå¼•å…¥å¦ä¸€ç«¯&quot;çš„ VCONN çº¿ä»é…å¤‡æ ‡è®°çš„æ’å¤´ç©¿è¿‡ç”µç¼†ï¼Œè¿æ¥åˆ°å¦ä¸€ç”µç¼†æ’å¤´ä¸Šçš„ VCONN é’ˆè„šã€‚å› æ­¤ï¼Œå¦‚æœä½ çœ‹åˆ°æœ‰å“ªé‡Œæåˆ°äº† VCONN çº¿ï¼Œé‚£å°±æ˜¯è¿™ä¸ªæ„æ€â€”â€”è¿æ¥åˆ°ç”µç¼†ä¸€ç«¯æœªä½¿ç”¨çš„ CC å¼•è„šçš„äºŒæç®¡éš”ç¦»çº¿ï¼Œåªéœ€ä¸ºå¦ä¸€ç«¯çš„ç”µå­æ ‡è®°èŠ¯ç‰‡ä¾›ç”µã€‚ åˆ°ç›®å‰ä¸ºæ­¢çš„ä¸€åˆ‡éƒ½å¾ˆæœ‰è¶£ï¼Œä½†é‚£ä¸ª Ra ä¸‹æ‹‰ç”µé˜»åˆæ˜¯æ€ä¹ˆå›äº‹å‘¢ï¼Ÿ æ ‘è“æ´¾ 4 çš„é—®é¢˜ å¦‚æœæ’åº§èƒ½å¤Ÿæä¾› VCONNï¼Œå®ƒå°±ä¼šåœ¨å½“å‰æœªç”¨äºé€šä¿¡çš„ CC å¼•è„šä¸Šå¯»æ‰¾è¯¥ç”µé˜»ï¼Œå¹¶åœ¨æ„Ÿåº”åˆ°ç”µé˜»æ—¶å°† VCONN è¾“å…¥è¯¥å¼•è„šã€‚å› æ­¤ï¼Œç”µç¼†æ’å¤´å†…çš„ç¬¬äºŒä¸ª CC å¼•è„šï¼ˆç”µç¼†çš„ä¸¤ä¸ªæ’å¤´ï¼‰ä¸Šéƒ½æœ‰è¿™ä¸ªç”µé˜»ã€‚ å¦‚æœå°†è®¾å¤‡æ’åº§ä¸­çš„ä¸¤ä¸ª CC å¼•è„šçŸ­æ¥åœ¨ä¸€èµ·ï¼Œç„¶åæ’å…¥ä¸€æ ¹é«˜å®¹é‡ç”µå­æ ‡è®°èŠ¯ç‰‡ç”µç¼†ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µï¼Ÿ5.1kÎ© ç”µé˜»å™¨ä¼šä¸ 1kÎ© ç”µé˜»å™¨å¹¶è”ï¼Œä»è€Œè·å¾— 840Î© çš„æ€»å‹é™ã€‚ç”µæºåœ¨ CC çº¿è·¯ä¸Šçœ‹åˆ°çš„å°±æ˜¯è¿™ä¸ªå‹é™ï¼Œå®ƒè¶…å‡ºäº† 5.1kÎ© çš„é¢„æœŸã€‚å…·ä½“æ¥è¯´ï¼Œåˆ†å‹å™¨å°†ç”µå‹æ‹‰å¾—è¿‡ä½ï¼Œå› æ­¤ç”µæºæ— æ³•ä¸º VBUS æä¾› 5V ç”µå‹ã€‚ æ ‘è“æ´¾ 4 åœ¨åˆç‰ˆä¸­æ—¶å°±æ˜¯è¿™æ ·åšçš„ï¼Œå› æ­¤ï¼Œä½ æ— æ³•é€šè¿‡ Type-C å……ç”µå™¨ä½¿ç”¨æœ‰ç”µå­æ ‡è®°èŠ¯ç‰‡çš„çº¿ç¼†ä¸ºæ ‘è“æ´¾ 4 ä¾›ç”µâ€”â€”ä½ éœ€è¦ä¸€æ¡æ— ç”µå­æ ‡è®°èŠ¯ç‰‡çš„çº¿ç¼†ï¼Œæˆ–è€…ä¸€æ¡ USB-A è½¬ USB-C çº¿ç¼†ï¼Œå†é…ä¸Š USB-A ç”µæºã€‚å½“ç„¶ï¼Œæ ‘è“æ´¾çš„å®˜æ–¹ç”µæºçº¿ä¸Šä¹Ÿæ²¡æœ‰æ ‡è®°ã€‚å®ƒä¹Ÿä¸ä¸€å®šè¦æœ‰ç”µå­æ ‡è®°èŠ¯ç‰‡ï¼Œæ¯•ç«Ÿç”µå­æ ‡è®°èŠ¯ç‰‡æ˜¯ç”¨æ¥è¯¢é—®æœªçŸ¥ç”µç¼†çš„ï¼Œè€Œå®ƒä»¬è‡ªå·±çš„ç”µç¼†é¡¾åæ€ä¹‰å°±æ˜¯å·²çŸ¥ç”µç¼†ã€‚ æˆ‘æ²¡çœ‹åˆ°çš„é—®é¢˜æ˜¯ï¼šä»–ä»¬ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšï¼Ÿ å¦‚æœæŸ¥çœ‹åŸç†å›¾ï¼Œå°±ä¼šå‘ç°è¿æ¥ CC å¼•è„šçš„ PD_SENSE ç½‘è¿æ¥åˆ° PMIC ä¸Šçš„ä¸€ä¸ªæ¨¡æ‹Ÿè¾“å…¥å¼•è„šã€‚æ‚¨ç°åœ¨å¯èƒ½å·²ç»çŒœåˆ°äº†â€”â€”ä»–ä»¬ç¡®å®å®ç°äº†äº†æ ‡å‡†ä¸­çš„&quot;ç”µå‹ç›‘æ§&quot;éƒ¨åˆ†ï¼Œä½†æ²¡æœ‰æ­£ç¡®æ‰§è¡Œ&quot;æ ‡è®°&quot;éƒ¨åˆ†ã€‚å®ƒä»¬ç©¶ç«Ÿèƒ½è¿›è¡Œæ€æ ·çš„ç”µå‹ç›‘æ§ï¼Œç¡®å®å€¼å¾—æ€€ç–‘ï¼Œä½†è‡³å°‘å…·å¤‡äº†è¿™ç§èƒ½åŠ›ã€‚ åœ¨å³å°†æ¨å‡ºçš„æ ‘è“æ´¾ç‰ˆæœ¬ä¸­è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œå¦‚æœä½ æœ‰æ—§ç‰ˆæœ¬ï¼Œå¯ä»¥è‡ªå·±æ‰“è¡¥ä¸ã€‚è™½ç„¶æˆ‘ä»¬è¿˜ä¸çŸ¥é“ä»–ä»¬æ˜¯å¦‚ä½•æ‰“è¡¥ä¸çš„ï¼Œä½†æˆ‘ä»¬æœ€ç»ˆä¸€å®šä¼šçŸ¥é“çš„ã€‚ è¿™å°±æ˜¯ä½ åº”è¯¥çŸ¥é“çš„æœ‰å…³ç”µé˜»ã€ç”µå­æ ‡è®°å’Œéš¾ä»¥æ‰æ‘¸çš„ VCONN çš„å…¨éƒ¨å†…å®¹ã€‚","categories":[{"name":"Translation","slug":"Translation","permalink":"https://blog.inoki.cc/categories/Translation/"},{"name":"Chinese","slug":"Translation/Chinese","permalink":"https://blog.inoki.cc/categories/Translation/Chinese/"},{"name":"USB","slug":"USB","permalink":"https://blog.inoki.cc/categories/USB/"},{"name":"ç¡¬ä»¶","slug":"ç¡¬ä»¶","permalink":"https://blog.inoki.cc/categories/ç¡¬ä»¶/"}],"tags":[{"name":"ç¿»è¯‘","slug":"ç¿»è¯‘","permalink":"https://blog.inoki.cc/tags/ç¿»è¯‘/"},{"name":"ä¸­æ–‡","slug":"ä¸­æ–‡","permalink":"https://blog.inoki.cc/tags/ä¸­æ–‡/"},{"name":"ç¡¬ä»¶","slug":"ç¡¬ä»¶","permalink":"https://blog.inoki.cc/tags/ç¡¬ä»¶/"},{"name":"USB","slug":"USB","permalink":"https://blog.inoki.cc/tags/USB/"}]},{"title":"ã€è¯‘ã€‘å…³äº USB-C çš„ä¸€åˆ‡ï¼šä»‹ç»","slug":"All-about-USB-C-Introduction","date":"2023-09-06T23:22:00.000Z","updated":"2025-03-08T09:40:48.547Z","comments":true,"path":"2023/09/06/All-about-USB-C-Introduction/","link":"","permalink":"https://blog.inoki.cc/2023/09/06/All-about-USB-C-Introduction/","excerpt":"","text":"åŸæ–‡é“¾æ¥ï¼šhttps://hackaday.com/2022/12/06/usb-c-introduction-for-hackers/ ç°åœ¨ï¼Œä»ç¬¬ä¸€ä¸ª USB-C è®¾å¤‡å¼€å§‹ï¼ŒUSB-C ç«¯å£è‡³å°‘å·²ç»è¢«ä½¿ç”¨äº”å¹´äº†ã€‚è¿™æ˜¯ä¸€ä¸ªè®¸å¤šåˆ¶é€ å•†å’Œé»‘å®¢éƒ½æ”¯æŒçš„æ ‡å‡†ã€‚èµ·åˆï¼Œæˆ‘ä»¬å¯¹å®é™…ä½¿ç”¨ä¸­ä¼šé‡åˆ°çš„é—®é¢˜æ„Ÿåˆ°å›°æƒ‘ï¼Œåˆ¶é€ å•†é€ æˆçš„å˜åŒ–ä¹Ÿè®©ä¸€äº›äººæœ›è€Œå´æ­¥ã€‚ä¸è¿‡ï¼ŒUSB-C å°†ç»§ç»­å­˜åœ¨ï¼Œæˆ‘æƒ³å‘ä½ å±•ç¤º USB-C åœ¨å®é™…åº”ç”¨ä¸­çš„æƒ…å†µï¼Œä½œä¸ºä¸€ä¸ªå¼ºå¤§çš„ç”¨æˆ·ï¼Œä½ èƒ½ä»ä¸­å¾—åˆ°ä»€ä¹ˆï¼Œä½œä¸ºä¸€ä¸ªä¸šä½™çˆ±å¥½è€…ï¼Œä½ åˆèƒ½ä»ä¸­å¾—åˆ°ä»€ä¹ˆã€‚ ç°ä»£è®¾å¤‡æœ‰ä¸€ç³»åˆ—å…±åŒçš„éœ€æ±‚ï¼šå®ƒä»¬éœ€è¦ç”µæºè¾“å…¥æˆ–ç”µæºè¾“å‡ºï¼Œæœ‰æ—¶ä¸¤è€…éƒ½éœ€è¦ï¼Œå®ƒé€šå¸¸ä½¿ç”¨ USB 2.0 çš„è¿æ¥ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜ç»å¸¸éœ€è¦ä¸€äº›æ›´é«˜é€Ÿçš„è¿æ¥ï¼Œå¦‚æ˜¾ç¤ºè¾“å‡º/è¾“å…¥ï¼Œæˆ–è€…è¯´ USB 3ã€‚ä¸Šè¿°æ‰€æœ‰åŠŸèƒ½éƒ½æ˜¯å¯é€‰çš„ï¼Œè¿™æ—¢æ˜¯å¥½äº‹ä¹Ÿæ˜¯åäº‹ï¼Œä½†ä½ å¾ˆå¿«å°±èƒ½å­¦ä¼šæ ¹æ®è®¾å¤‡çš„å¤–è§‚æ¥åŒºåˆ†å®ƒçš„é¢„æœŸåŠŸèƒ½ï¼Œæˆ‘æƒ³å‘Šè¯‰ä½ åœ¨æœ‰ç–‘é—®æ—¶å¦‚ä½•è¿›è¡Œæ£€æŸ¥ã€‚ é€šä¿¡èƒ½åŠ›ã€é…ç½®å’Œæ³¨æ„äº‹é¡¹ æˆ‘ä»¬éƒ½çŸ¥é“ï¼ŒUSB-C å¯ä»¥æ—‹è½¬â€”â€”å®ƒå¯ä»¥è®©ä½ ä»¥ä»»ä½•æ–¹å¼æ’å…¥çº¿ç¼†â€”â€”è¿™æ˜¯å¯¹ USB-B çš„é‡å¤§æ”¹è¿›ã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚è¦å®ç°è¿™ä¸€ç‚¹ï¼Œéœ€è¦ä¸€ä¸ª CCï¼ˆConfiguration Channelï¼Œé…ç½®é€šé“ï¼‰è¿æ¥ï¼Œæ¯æ¡ USB-C çº¿ç¼†ä¸­éƒ½æœ‰ä¸€æ¡å•çº¿è¿æ¥åˆ° Type-C æ¥å£ä¸­çš„ä¸¤ä¸ªé…ç½®é€šé“ CC é’ˆè„šä¹‹ä¸€ï¼Œè¿™å¯¹ USB-C çš„å·¥ä½œè‡³å…³é‡è¦ã€‚å¯¹äºç®€å•çš„ USB-C ä½¿ç”¨æƒ…å†µï¼Œä¾‹å¦‚â€œä»ç«¯å£è·å¾— USB 2.0 å’Œ 5V ç”µå‹â€ï¼Œåªéœ€éµå¾ªä¸€ä¸ªç®€å•çš„æ–¹æ³•â€”â€”åœ¨æ¯ä¸ªé…ç½®é€šé“ CC å¼•è„šä¸Šè¿æ¥ä¸€ä¸ª 5.1kÎ© çš„ä¸‹æ‹‰ç”µé˜»ï¼Œæ‚¨å°±èƒ½æ‹¥æœ‰ä¸€ä¸ªèƒ½ä¸æ‰€æœ‰å…¼å®¹è®¾å¤‡é…åˆä½¿ç”¨çš„ USB-C ç«¯å£ã€‚ å½“ç„¶ï¼ŒUSB-C æ”¯æŒ 5V å’Œ USB 2.0 ä»¥å¤–çš„ç”µå‹ã€‚ä½ å¯ä»¥ä» USB-C ç«¯å£è·å¾—å„ç§ç”µå‹ï¼Œè¿™å¯¹ç¬”è®°æœ¬ç”µè„‘ç­‰è®¾å¤‡çš„å……ç”µéå¸¸æ–¹ä¾¿ã€‚ä½ å¯ä»¥è¿æ¥ USB 3ã€DisplayPort å’Œ Thunderboltã€‚å¤§å¤šæ•°ç¬”è®°æœ¬ç”µè„‘ä¼šè®©ä½ è¿æ¥ä¸€ä¸ªå°½å¯èƒ½åˆ©ç”¨ USB-C çš„æ‰©å±•åï¼Œé€šè¿‡åŒä¸€æ ¹çº¿ç¼†ä¸ºä½ æä¾›é«˜åˆ†è¾¨ç‡æ˜¾ç¤ºå±ã€å¤§é‡ USB ç«¯å£å’Œå……ç”µåŠŸèƒ½ã€‚é‚£ä¹ˆï¼Œå®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„å‘¢ï¼Ÿ å¯¹äºç”µå‹å¤§äº 5V çš„æƒ…å†µï¼ˆUSB-PDï¼‰æˆ– USB 2 å’Œ 3 ä»¥å¤–çš„é«˜é€Ÿè¿æ¥ï¼ˆalt-modesï¼Œå³å¤‡ç”¨æ¨¡å¼ï¼‰ï¼Œå¿…é¡»é€šè¿‡åŒä¸€é…ç½®é€šé“ CC è¿æ¥æ¥è°ƒç”¨ã€‚å•çº¿ç”¨äºåŒå‘é€šä¿¡ï¼Œè¿™ä½¿å¾—é…ç½®é€šé“ CC çº¿æˆä¸ºåŠåŒå·¥é€šé“ï¼›å®ƒæ˜¯ä¸€ç§å›ºå®šé€Ÿç‡ 300 kbps çš„ä»¥å¤ªç½‘åè®®ã€‚æœ‰å¾ˆå¤šé›†æˆç”µè·¯å¯ä»¥é€šè¿‡è¯¥åè®®å®ç°ä¸€ç³»åˆ—å®šä¹‰çš„åŠŸèƒ½ï¼Œè¿˜æœ‰å¾ˆå¤šé›†æˆç”µè·¯å’Œå¾®æ§åˆ¶å™¨å¤–è®¾å¯ä»¥å¸®åŠ©æ‚¨é€šè¿‡è¯¥åè®®å®ç°ä»»ä½•æ‚¨æƒ³è¦çš„åŠŸèƒ½ã€‚ åŠŸèƒ½å¼ºå¤§â€¦ USB-C ç«¯å£æœ‰å››ä¸ªé«˜é€Ÿå·®åˆ†å¯¹å¼•è„šï¼Œå…±å…«ä¸ªå¼•è„šã€‚è®¸å¤šç®€å•çš„ USB-C è®¾å¤‡éƒ½å°†å®ƒä»¬æ–­å¼€ï¼Œä½†è¿™äº›ç«¯å£çš„åŠŸç‡å¾ˆå¤§ã€‚é¦–å…ˆï¼Œå½“ä½ åœ¨ç¬”è®°æœ¬ç”µè„‘ä¸Šçœ‹åˆ°è¿™æ ·çš„ç«¯å£æ—¶ï¼Œé€šå¸¸å¯ä»¥ä½¿ç”¨ USB 3.1 æˆ– 3.2ã€‚ä¸€ä¸ª USB3 ç«¯å£é€šå¸¸å ç”¨å››ä¸ªå·®åˆ†çº¿å¯¹ä¸­çš„ä¸¤ä¸ªï¼Œä½†æœ‰äº›è®¾å¤‡æ”¯æŒ 2x2 USB3 é“¾è·¯ï¼Œä½¿çº¿å¯¹æ•°é‡å’Œä¼ è¾“é€Ÿåº¦ç¿»å€ã€‚è¶Šæ¥è¶Šå¤šçš„ USB-C ç«¯å£ä¹Ÿèƒ½æ”¯æŒ DisplayPort - é€šè¿‡ä¸¤ä¸ªæˆ–å››ä¸ªé€šé“ï¼Œå¯ä»¥é©±åŠ¨ä¸€äº›åˆ†è¾¨ç‡ç›¸å½“é«˜çš„æ˜¾ç¤ºå™¨ã€‚ è¿˜æœ‰ Thunderbolt è¿™ç§åŠä¸“æœ‰æŠ€æœ¯ï¼Œä¹Ÿä½¿ç”¨ USB-C æ¥å£ä¸Šçš„é«˜é€Ÿçº¿å¯¹ã€‚å®ƒå¯ä»¥å°† USB3ã€DisplayPort ç”šè‡³ PCIe ä¼ è¾“åˆ°è‡ªå·±å†…éƒ¨ï¼Œä½†è¿™ä¸‰è€…ç¼ºä¸€ä¸å¯ã€‚æœ‰äº† Thunderboltï¼Œä½ å°±å¯ä»¥æ‹¥æœ‰ä¸€ä¸ªæ‰©å±•åã€æ‹¥æœ‰æ›´å¤š DisplayPort é€‰é¡¹ã€æ›´å¥½æ›´å¿«çš„ç«¯å£ï¼Œç”šè‡³å¤–ç½®æ˜¾å¡ GPUï¼å¯ä»¥çŒœåˆ°ï¼Œè¿™æ˜¯æ‰€æœ‰è¿™äº›äº§å“ä¸­æœ€ç¨€æœ‰ã€æœ€æ˜‚è´µçš„é€‰æ‹©ã€‚ æœ‰äº†è¿™äº›é«˜é€Ÿå’Œå¤§åŠŸç‡çš„åŠŸèƒ½ï¼Œå°†æ‰€æœ‰ä¸œè¥¿ç»Ÿä¸€åˆ°ä¸€ä¸ªè¿æ¥å™¨ä¸­å°±æœ‰äº†å¼ºå¤§çš„ä¼˜åŠ¿ã€‚æ‚¨çš„ USB-C ç¬”è®°æœ¬å……ç”µå™¨è¿˜å¯ä»¥åœ¨éœ€è¦æ—¶ä¸ºæ‚¨çš„æ‰‹æœºå……ç”µï¼Œè€Œä¸”å¾—ç›Šäºç§¯æçš„æ ‡å‡†åŒ–ï¼Œå……ç”µè¿‡ç¨‹ä¸­ä¸å†æ¶‰åŠå¤ªå¤šä¸“æœ‰çš„ä¸œè¥¿ã€‚ å¦‚æœä½ æœ‰ä¸€ä¸ª USB-C çš„ä»»å¤©å ‚ Switch åº•åº§ï¼Œç†è®ºä¸Šå®ƒä¹Ÿå¯ä»¥å……å½“ç¬”è®°æœ¬ç”µè„‘çš„åº•åº§ï¼Œå‰ææ˜¯ä½ èƒ½è®©å®ƒä»¬ç‰©ç†ä¸Šè¿æ¥èµ·æ¥ï¼Œè€Œä¸”ç¬”è®°æœ¬ç”µè„‘åº•åº§ä¹Ÿèƒ½ä¸ Steam Deck ä¸€èµ·ä½¿ç”¨ã€‚æ€»çš„æ¥è¯´ï¼Œæ‰©å±•åè¶Šæ¥è¶Šåˆç†â€”â€”ä½ åªéœ€ç”¨ä¸€æ ¹çº¿ç¼†å°±èƒ½è¿æ¥æ‰€æœ‰è®¾å¤‡ï¼Œå®ƒè¿˜èƒ½ä¸å¤§å¤šæ•° USB-C è®¾å¤‡é…åˆä½¿ç”¨ï¼Œä»…æ­¤è€Œå·²ã€‚ æ¯ä¸€å¹´ï¼ŒUSB-C æ— æ³•å®ç°çš„åŠŸèƒ½è¶Šæ¥è¶Šå°‘ã€‚å»å¹´ï¼Œä»–ä»¬å‘å¸ƒäº† EPRï¼ˆExtended Power Range æ‰©å±•åŠŸç‡èŒƒå›´ï¼‰ï¼Œå°† USB-C ç«¯å£çš„åŠŸç‡æå‡åˆ° 240Wã€48V@5Aï¼Œè€Œ SPRï¼ˆStandard Power Rangeï¼Œæ ‡å‡†åŠŸç‡èŒƒå›´ï¼‰åˆ™å°† USB-C ç«¯å£çš„åŠŸç‡é™åˆ¶åœ¨ 100Wã€20V@5Aã€‚è¿™åŸºæœ¬ä¸Šæ¶ˆé™¤äº†ç¬”è®°æœ¬ç”µè„‘å¯¹æ¡¶çŠ¶æ’å¤´é€‚é…å™¨çš„éœ€æ±‚ï¼Œè€Œ 100W çš„ USB-C æ›¾ç»æ˜¯ä¸€ä¸ªéšœç¢ï¼Œæˆ‘ä»¬ä¸å†éœ€è¦æ‰€æœ‰å¸¦æœ‰å„ç§æ¡¶çŠ¶æ’å­”é€‚é…å™¨çš„â€œé€šç”¨â€ç”µæºã€‚è¿˜æœ‰å³å°†æ¨å‡ºçš„ USB4 æ ‡å‡†ï¼Œå®ƒä¸ Thunderbolt ç›¸ä¼¼ï¼Œä½†åˆä¸å®Œå…¨ç›¸åŒï¼Œä½†æ›´å¥½ï¼Œä½†åˆæ›´ç³Ÿï¼ˆï¼Ÿï¼‰æ— è®ºå¦‚ä½•ï¼Œæˆ‘ä»¬éƒ½ä¼šçœ‹åˆ°æ›´å¤šçš„ç”µè„‘æ”¯æŒ USB4ï¼Œå¸Œæœ›æœ‰ä¸€å¤©æ¯å°ç¬”è®°æœ¬ç”µè„‘éƒ½èƒ½é…å¤‡é«˜é€Ÿæ¥å£ï¼Œå³ä½¿æ˜¯æœ€ä¾¿å®œçš„ç¬”è®°æœ¬ç”µè„‘ä¹Ÿä¸ä¾‹å¤–ã€‚ æ€»çš„æ¥è¯´ï¼ŒUSB-C çš„æœªæ¥æ˜¯å…‰æ˜çš„ï¼Œå®ƒåœ¨å¾ˆå¤šæ–¹é¢çš„è®¾è®¡éƒ½å¾ˆåˆç†â€”â€”æ±²å–äº†å‡ åå¹´æ¥æˆ‘ä»¬åœ¨ç«¯å£ã€ç”µç¼†å’Œæ ‡å‡†æ–¹é¢æ‰€çŠ¯çš„é”™è¯¯ï¼Œå¹¶ä¸ºå³å°†åˆ°æ¥çš„æ–°å¢åŠŸèƒ½ç•™å‡ºäº†è¶³å¤Ÿçš„ç©ºé—´ã€‚ å½“ç„¶ï¼ŒUSB-C ä¹Ÿåˆ›é€ äº†ä¸€ä¸ªå¯ä»¥çŠ¯é”™è¯¯çš„å…¨æ–°é¢†åŸŸã€‚ â€¦ä»¤äººéš¾å¿˜çš„è®°å½• USB-C çš„ææ€–æ•…äº‹éšå¤„å¯è§â€”â€”åŸºæœ¬ä¸Šæ¯ä¸ªä½¿ç”¨è¿‡ USB-C çš„äººéƒ½èƒ½å‘Šè¯‰ä½ ï¼ŒUSB-C æ›¾ç»è®©ä»–ä»¬å¤±æœ›è¿‡ä¸€æ¬¡ï¼Œæˆ–è®¸æ˜¯å¤šæ¬¡ã€‚ä½†æˆ‘åšä¿¡ USB-C çš„ä¼˜ç‚¹å¤šäºç¼ºç‚¹ï¼Œæˆ‘ä»¬å¿…é¡»è®°ä½å®ƒæ›¾ç»è®©æˆ‘ä»¬å¤±æœ›çš„åœ°æ–¹ï¼Œä»¥åŠå®ƒç°åœ¨ä»ç„¶è®©æˆ‘ä»¬å¤±æœ›çš„åœ°æ–¹ï¼Œè¿™æ ·æˆ‘ä»¬æ‰èƒ½ä»ä¸­å¸å–æ•™è®­ï¼Œæ‰¾å‡ºé¿å…å¤±è´¥çš„æ–¹æ³•ã€‚ å¹¶é USB-C æ ‡å‡†çš„æ‰€æœ‰éƒ¨åˆ†éƒ½æ˜¯ç»è¿‡æ·±æ€ç†Ÿè™‘çš„ã€‚æˆ‘é¦–å…ˆæƒ³åˆ°çš„æ˜¯ç”µç¼†å’Œç«¯å£ã€‚å½“ä½ çœ‹åˆ°ä¸€ä¸ª USB-C ç«¯å£æ—¶ï¼Œå¾ˆéš¾ä¸€çœ¼å°±çŸ¥é“å®ƒæ”¯æŒä»€ä¹ˆï¼Œçº¿ç¼†ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ç›®å‰çš„æƒ…å†µéå¸¸ç³Ÿç³•â€”â€”å¯¹äºè¿˜æ²¡æœ‰æ‰¾åˆ°åˆé€‚è§£é‡Šçš„äººæ¥è¯´ï¼Œä½¿ç”¨ USB-C æœ‰æ—¶éœ€è¦å¤§é‡çš„çŒœæµ‹ã€‚å¦‚ä½•åŒºåˆ†çº¿ç¼†æ˜¯æœ‰æŒ‡å—çš„ï¼Œæˆ‘ä¹Ÿä¼šé¡ºä¾¿ä»‹ç»ä¸€äº›æŠ€å·§ã€‚ä¸è¿‡ï¼Œä»–ä»¬åº”è¯¥ä»ä¸€å¼€å§‹å°±å¼•å…¥ä¸€ä¸ªå¼•äººæ³¨ç›®çš„è§†è§‰æ ‡è®°æ–¹æ¡ˆã€‚ USB-C æ ‡å‡†çš„å®ç°æœ‰äº›å¤æ‚ï¼Œæ¶‰åŠä¼—å¤šçŠ¶æ€æœºå’Œç‰¹æ®Šæ€§ã€‚USB-C è§„èŒƒä»¥å†—é•¿çš„ PDF æ–‡æ¡£è€Œé—»åï¼šè¿æ¥å™¨å’Œç”µç¼†æ–‡æ¡£é•¿è¾¾ 350 é¡µï¼ŒUSB-PD æ–‡æ¡£é•¿è¾¾ 600 å¤šé¡µã€‚å¤šå¹´æ¥ï¼Œè®¸å¤šåˆ¶é€ å•†çœŸè¯šåœ°å°è¯•è¿‡ï¼Œä½†ä»ç„¶åˆ¶é€ å‡ºäº†å…·æœ‰æ˜æ˜¾æ€ªå¼‚è¾¹ç¼˜çš„è®¾å¤‡ã€‚ç¬”è®°æœ¬ç”µè„‘åªèƒ½ä¸ç‰¹å®šçš„å……ç”µå™¨é…åˆä½¿ç”¨ï¼Œåä¹‹äº¦ç„¶ï¼›åº•åº§åªèƒ½ä¸ç‰¹å®šçš„ç¬”è®°æœ¬ç”µè„‘é…åˆä½¿ç”¨ï¼Œæˆ–åªèƒ½ä¸ç‰¹å®šçš„å……ç”µå™¨é…åˆä½¿ç”¨ï¼›ç”µç¼†åªèƒ½åœ¨ä¸€ä¸ªæ–¹å‘ä¸Šä½¿ç”¨ï¼Œæˆ–æ ¹æ®ç”µç¼†çš„æ–¹å‘ä¸åŒï¼Œè®¾å¤‡çš„å·¥ä½œæ–¹å¼ä¹Ÿä¸åŒâ€”â€”è¿™å…¶ä¸­ä¸ä¹ç„æœºã€‚ é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰æ— æ•°ç§æ»¥ç”¨ USB-C çš„æ–¹æ³•ï¼ŒæŸäº›åˆ¶é€ å•†ä¹Ÿåœ¨åŠªåŠ›å°è¯•ï¼åˆ«äººæ»¥ç”¨ USB-C æ ‡å‡†å¹¶ä¸æ˜¯ USB-C æ ‡å‡†çš„é”™ï¼Œå› ä¸ºåœ¨å®šä¹‰ä¸€ä¸ªå¤æ‚çš„æ ‡å‡†æ—¶ï¼Œåªèƒ½å®æ–½æœ‰é™çš„ä¿æŠ¤æªæ–½ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬ä»ç„¶æœ‰å…¨æ–°çš„é—®é¢˜éœ€è¦æ³¨æ„ã€‚æœ‰äº› USB-C ç½ªè¿‡éš¾ä»¥åŸè°…ï¼Œå€¼å¾—åˆ†å¼€å¤„ç†ï¼Œæœ‰äº›åˆ™ä¸é‚£ä¹ˆæ˜æ˜¾â€”â€”æˆ‘ä»¬å°†ä¸€ä¸€è®¨è®ºå…¶ä¸­çš„è®¸å¤šé—®é¢˜ã€‚ æ— æ•°ç§å…¥ä¾µæ–¹å¼ è¯·åŠ¡å¿…ç‰¢è®°è¿™ä¸€ç‚¹â€”â€”éšç€æ—¶é—´çš„æ¨ç§»ï¼ŒUSB-C åªä¼šå˜å¾—è¶Šæ¥è¶Šä¸€è‡´ï¼›å¦‚æœæœ‰å¿…è¦çš„è¯ï¼Œè¿˜å¯ä»¥é€šè¿‡å¼ºåˆ¶æ‰‹æ®µæ¥å®ç°ã€‚åŒæ ·ï¼Œå®ƒä¹Ÿåªä¼šå˜å¾—æ›´å®¹æ˜“è¢«é»‘ã€‚å› ä¸ºéšç€æ—¶é—´çš„æ¨ç§»ï¼Œæˆ‘ä»¬å°†æ”¶é›†åˆ°è¶Šæ¥è¶Šå¤šçš„æ„ä»¶â€”â€”ç¡¬ä»¶å’ŒçŸ¥è¯†ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬å®¶ä¸­çš„ USB-C ç”Ÿæ€ç³»ç»Ÿä¹Ÿåœ¨ä¸æ—¥ä¿±å¢ã€‚å¦‚æœä½ ä»Šå¤©æ­£åœ¨è®¾è®¡æŸæ ·ä¸œè¥¿ï¼Œé‚£ä¹ˆä½ åº”è¯¥åœ¨ä½ çš„ä½¿ç”¨æ¡ˆä¾‹ä¸­å¼ºçƒˆè€ƒè™‘ USB-Cã€‚ åœ¨æ­¤ï¼Œè®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹æ·»åŠ ä¸€ä¸ª USB-C ç«¯å£éœ€è¦å“ªäº›æ¡ä»¶ï¼Œä»¥ç¡®ä¿æ‚¨çš„è®¾å¤‡èƒ½è·å¾— 5V ç”µå‹ï¼ˆæœ€é«˜å¯è¾¾ 3Aï¼‰å’Œ USB 2.0 æ•°æ®ï¼Œå¹¶åŒæ—¶æ”¯æŒä¸¤è€…çš„å®Œå…¨æ—‹è½¬ã€‚ å°±æ˜¯è¿™æ ·ã€‚ä¸ MicroUSB ç›¸æ¯”ï¼Œåªå¤šäº†ä¸¤ä¸ªç”µé˜»ï¼Œè€Œä¸”å¼•è„šæ›´å®¹æ˜“ç„Šæ¥ã€‚è¯·æŒ‰ç…§åŸç†å›¾ä¸Šçš„æŒ‡ç¤ºè¿æ¥ç”µé˜»ï¼›ä¸è¦åƒ Raspberry Pi 4 é‚£æ ·è¿æ¥é…ç½®é€šé“ CC å¼•è„šï¼Œä¹Ÿä¸è¦çœç•¥ç”µé˜»ã€‚å¦‚æœçœç•¥ç”µé˜»ï¼Œä¸Šæ¸¸ Type-C ç«¯å£å°†æ— æ³•ä¸ºè®¾å¤‡æä¾› 5V ç”µå‹â€”â€”å¾ˆå¤šå»‰ä»·è®¾å¤‡éƒ½çœç•¥äº†ç”µé˜»ã€‚æ²¡æœ‰ 5.1kÎ© ç”µé˜»å™¨ï¼Œé‚£ä¹ˆå°±æ— æ³•ä¸ºè®¾å¤‡ä¾›ç”µâ€”â€”é™¤éä½¿ç”¨ USB-A è½¬ USB-C ç”µç¼†ä¸ºè®¾å¤‡ä¾›ç”µã€‚å¦‚æœçœç•¥å…¶ä¸­ä¸€ä¸ªç”µé˜»å™¨ï¼Œé‚£ä¹ˆç«¯å£åªæœ‰ä¸€ä¸ªæ—‹è½¬èƒ½æ­£å¸¸å·¥ä½œâ€”â€”æœ‰äº›å»‰ä»·è®¾å¤‡åªæœ‰ä¸€ä¸ªç”µé˜»å™¨ã€‚ æ¯ä¸ªå¸Œæœ›åœ¨ä»»ä½•ä½ç½®æ¥æ”¶ 5V ç”µå‹çš„ USB-C è®¾å¤‡éƒ½æœ‰è¿™äº›ç”µé˜»å™¨ï¼Œæœ‰çš„æ˜¯æ¿è½½çš„ï¼Œæœ‰çš„æ˜¯ USB-C é€šä¿¡é›†æˆç”µè·¯å†…éƒ¨çš„ã€‚å¯¹äºç®€å•çš„â€œ5V å’Œ USB 2.0â€ç”¨é€”ï¼Œæ‚¨åªéœ€ä½¿ç”¨ 1% çš„ 5.1kÎ© ç”µé˜»å™¨å³å¯ã€‚ä¸è¿‡ï¼Œåœ¨ç´§è¦å…³å¤´ï¼Œæ‚¨ä¹Ÿå¯ä»¥å¹¶è”ä¸¤ä¸ª 10K ç”µé˜»å™¨ï¼Œè¿™å®é™…ä¸Šæ˜¯å¯è¡Œçš„ã€‚å°±æˆ‘ä¸ªäººè€Œè¨€ï¼Œæˆ‘åˆšè®¢è´­äº†ä¸€å· 5.1kÎ© ç”µé˜»å™¨ï¼Œå®ƒä»¬å¸®äº†æˆ‘å¤§å¿™ã€‚å¦‚æœæ‚¨çš„ç«¯å£è®¾è®¡è€…å¿˜è®°æ·»åŠ è¿™äº›ç”µé˜»ï¼Œæ‚¨è¿˜å¯ä»¥è®¢è´­ä¸€äº› FPC å«ç‰‡ï¼Œå¸®åŠ©å°†è¿™äº›ç”µé˜»ç„Šæ¥åˆ°å¸¸ç”¨çš„è¿æ¥å™¨ä¸Šï¼ æ‚¨æœ‰å¾ˆå¤š USB-C è¿æ¥å™¨å¯ä¾›é€‰æ‹©ï¼Œå…¶ä¸­ 16 å¼•è„šçš„è¿æ¥å™¨æœ€å—æ¬¢è¿â€”â€”æ‚¨å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹è´­ä¹°åˆ°å¤§é‡å¼•è„šå…¼å®¹çš„è¿æ¥å™¨ï¼Œè€Œä¸”æ‰‹å·¥ç„Šæ¥ä¹Ÿç›¸å½“å®¹æ˜“ï¼Œå°¤å…¶æ˜¯å¦‚æœæ‚¨æœ‰ç„ŠèŠ¯å¯ä»¥ç”¨æ¥ä¿®æ­£é”™è¯¯çš„è¯ã€‚è¯·ç¡®ä¿ä¸è¦ä½¿ç”¨ä¸å¸¦ CC å¼•è„šçš„è¿æ¥å™¨ï¼Œå› ä¸ºæ— æ³•è¿æ¥ä¸‹æ‹‰ç”µé˜»å™¨ï¼Œè¿™æ ·çš„è¿æ¥å™¨æ— æ³•ä¸çœŸæ­£çš„ Type-C ç«¯å£é…åˆä½¿ç”¨ï¼Œè€Œä¸”åªèƒ½ä¸ USB-A è½¬ USB-C è¿æ¥çº¿é…åˆä½¿ç”¨ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„é™åˆ¶ã€‚ å½“ç„¶ï¼ŒUSB-C çš„åŠŸèƒ½è¿œä¸æ­¢æˆ‘å‰é¢æåˆ°çš„ 5V@3A å’Œ USB 2.0ï¼Œæˆ‘ä¼šå‘ä½ å±•ç¤ºå¦‚ä½•è·å¾—æ‰€æœ‰å…¶ä»–å¯èƒ½æ€§ã€‚ä¸è¿‡ï¼Œè¯·åŠ¡å¿…è®°ä½æ‰€ç¤ºå…¬å¼ï¼Œå› ä¸ºè¿™æ˜¯æ‚¨æœ€å¸¸ç”¨çš„å…¬å¼ï¼Œè€Œä¸”å®ƒè¿˜æœ‰åŠ©äºæ‚¨ç†è§£å…¶ä»–å…¬å¼ã€‚åŒæ—¶ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ SBU å¼•è„šæ¥æš´éœ²ä¸€äº›è°ƒè¯•è¿æ¥ï¼ˆå¦‚ UARTï¼‰ï¼Œå› ä¸ºé™¤äº† DisplayPort ä¹‹å¤–ï¼Œæ²¡æœ‰å…¶ä»–è®¾å¤‡ä½¿ç”¨ SBUã€‚ä¸è¿‡ï¼Œè¦æ‰¾åˆ°èƒ½ä»¥æ‰‹å·¥ç„Šæ¥å½¢å¼æš´éœ² SBU çš„æ’å¤´æ–­è·¯å™¨å¯èƒ½æ¯”è¾ƒå›°éš¾ã€‚è€Œä¸”ï¼Œå¦‚æœä½ è¿›å…¥äº† USB-C ç«¯å£é»‘å®¢è”ç›Ÿï¼Œä½ ä¹Ÿå¯ä»¥ä»¥ç¬¦åˆæ ‡å‡†çš„æ–¹å¼å®ç°è°ƒè¯•ï¼ ä½ ä¸å¿…æ€»æ˜¯éµå®ˆ å¯¹äºé»‘å®¢æ¥è¯´ï¼Œéµå®ˆ USB-C æ ‡å‡†æ˜¯ä¸€æŠŠåŒåˆƒå‰‘ã€‚å¦‚æœä¸ç¬¦åˆæ ‡å‡†ï¼Œä½ å¯èƒ½ä¼šæ¯æ‰ä¸€å°ç¬”è®°æœ¬ç”µè„‘ï¼Œä¹Ÿå¯èƒ½ä¼šè®©ä½ å—ç›ŠåŒªæµ…ï¼Œè€Œä¸ä¼šå¸¦æ¥å±é™©æˆ–å¼Šç«¯ã€‚æœ‰äº›æƒ…å†µä¹‹æ‰€ä»¥è¢«â€œå–ç¼”â€ï¼Œå¹¶ä¸æ˜¯å› ä¸ºå®ƒä»¬çœŸçš„æœ‰å±é™©ï¼Œè€Œæ˜¯å› ä¸ºå®ƒä»¬è¢«è®¤ä¸ºä¼šè®©æ™®é€šç”¨æˆ·æ„Ÿåˆ°å›°æƒ‘ï¼Œæˆ–è€…ä¸ä¼šå¸¦æ¥é¡¶çº§çš„åŠŸèƒ½ã€‚ åœ¨æ¥ä¸‹æ¥çš„æ–‡ç« ä¸­ï¼Œæˆ‘å°†è®¨è®ºé‚£äº›ç³Ÿç³•é€é¡¶ã€æ ¹æœ¬ä¸åº”è¯¥å‡ºç°çš„ä¸œè¥¿ã€‚æˆ‘è¿˜ä¼šå‘Šè¯‰ä½ å¦‚ä½•æ¸©å’Œåœ°ï¼ˆæˆ–ä¸¥å‰åœ°ï¼‰è¿åæ ‡å‡†ï¼Œå¦‚æœè¿™æ ·åšå¯¹ä½ æœ‰å¥½å¤„ï¼Œæˆ–è€…è¿™æ ·åšæ˜¯å®Œå…¨åˆç†çš„ï¼Œä»¥åŠåœ¨å“ªäº›æƒ…å†µä¸‹ä½ å¯èƒ½ä¼šè¿åæ ‡å‡†ï¼Œä½†ä½ çœŸçš„çœŸçš„ä¸åº”è¯¥è¿™æ ·åšã€‚è¿™é‡Œæœ‰ä¸€ä¸ªæŒ‡å¯¼åŸåˆ™â€”â€”å½“ä½ å¬è¯´ä½ æƒ³ä½¿ç”¨çš„ä¸œè¥¿è¿åäº† USB-C æ ‡å‡†æ—¶ï¼Œåœ¨ä½ çš„å…·ä½“åº”ç”¨ä¸­ä¼šäº§ç”Ÿä»€ä¹ˆåæœå°±éå¸¸é‡è¦äº†ã€‚","categories":[{"name":"Translation","slug":"Translation","permalink":"https://blog.inoki.cc/categories/Translation/"},{"name":"Chinese","slug":"Translation/Chinese","permalink":"https://blog.inoki.cc/categories/Translation/Chinese/"},{"name":"USB","slug":"USB","permalink":"https://blog.inoki.cc/categories/USB/"},{"name":"ç¡¬ä»¶","slug":"ç¡¬ä»¶","permalink":"https://blog.inoki.cc/categories/ç¡¬ä»¶/"}],"tags":[{"name":"ç¿»è¯‘","slug":"ç¿»è¯‘","permalink":"https://blog.inoki.cc/tags/ç¿»è¯‘/"},{"name":"ä¸­æ–‡","slug":"ä¸­æ–‡","permalink":"https://blog.inoki.cc/tags/ä¸­æ–‡/"},{"name":"ç¡¬ä»¶","slug":"ç¡¬ä»¶","permalink":"https://blog.inoki.cc/tags/ç¡¬ä»¶/"},{"name":"USB","slug":"USB","permalink":"https://blog.inoki.cc/tags/USB/"}]},{"title":"ã€è¯‘ã€‘ARM çš„å†å²â€”â€”ç¬¬ä¸‰éƒ¨åˆ†ï¼šå…œå…œè½¬è½¬","slug":"History-of-ARM-3","date":"2023-08-22T12:34:00.000Z","updated":"2025-03-08T09:40:48.566Z","comments":true,"path":"2023/08/22/History-of-ARM-3/","link":"","permalink":"https://blog.inoki.cc/2023/08/22/History-of-ARM-3/","excerpt":"","text":"åŸåšå®¢å…±åˆ†ä¸ºä¸‰ç¯‡ï¼ŒåŸæ–‡é“¾æ¥å¦‚ä¸‹ï¼š https://arstechnica.com/gadgets/2022/09/a-history-of-arm-part-1-building-the-first-chip/ https://arstechnica.com/gadgets/2022/11/a-history-of-arm-part-2-everything-starts-to-come-together/ https://arstechnica.com/gadgets/2023/01/a-history-of-arm-part-3-coming-full-circle/ åœ¨æˆ‘ä»¬çš„ç³»åˆ—å‹è½´æ–‡ç« ä¸­ï¼ŒARM å®ç°äº†å°†è®¡ç®—èƒ½åŠ›å¸¦ç»™å¤§ä¼—çš„ç›®æ ‡ã€‚ å°±åƒ ARM çš„è®¸å¤šæ•…äº‹ä¸€æ ·ï¼Œå®ƒå§‹äºè‹¹æœå…¬å¸ã€‚ å²è’‚å¤«-ä¹”å¸ƒæ–¯å‡¯æ—‹è€Œå½’ï¼Œå›åˆ°äº†ä»–å…±åŒåˆ›ç«‹çš„å…¬å¸ã€‚1998 å¹´ï¼Œè‹¹æœå…¬å¸å‘å¸ƒäº†è‰²å½©æ–‘æ–“çš„æ©¡çš®æ³¥ iMacï¼Œä¸å¾®è½¯è¾¾æˆäº†ä¸€é¡¹åè®®ï¼Œå¹¶å‡ºå”®äº† ARM è‚¡ç¥¨ï¼Œä½¿å…¬å¸ä»æ¿’ä¸´ç ´äº§çš„å›°å¢ƒä¸­é‡æ–°ç«™ç¨³äº†è„šè·Ÿã€‚ä½†è‹¹æœå…¬å¸çš„ &quot;iCEO &quot;ä»åœ¨å¯»æ‰¾ä¸‹ä¸€ä»¶å¤§äº‹ã€‚ ä¹”å¸ƒæ–¯ä¸º iMac é…å¤‡äº†åä¸º FireWire çš„æ–°å‹è¿æ¥å™¨ï¼Œå¯ä»¥å¿«é€Ÿä¼ è¾“è§†é¢‘å’Œå£°éŸ³ã€‚å½“æ—¶ï¼Œä¸€ç§åä¸º MP3 çš„æ–‡ä»¶æ ¼å¼æ­£åœ¨æµè¡Œï¼Œç”µè„‘ç”¨æˆ·å¯ä»¥åœ¨ç”µè„‘ä¸Šå…±äº«éŸ³ä¹ï¼Œä¸€äº›å…¬å¸å·²ç»å¼€å§‹ç”Ÿäº§ä¾¿æºå¼ MP3 æ’­æ”¾å™¨ã€‚ä½†è¿™äº›è®¾å¤‡çš„å­˜å‚¨ç©ºé—´å¾ˆå°ï¼ŒUSB 1.0 ä¼ è¾“é€Ÿåº¦å¾ˆæ…¢ï¼Œè½¯ä»¶ä¹Ÿå¾ˆç³Ÿç³•ã€‚ä¹”å¸ƒæ–¯ç—´è¿·äºåˆ¶é€ æ’­æ”¾å™¨çš„æƒ³æ³•ï¼Œå‡ ä¹æŠŠæ‰€æœ‰æ—¶é—´éƒ½æŠ•å…¥åˆ°è¿™ä¸ªé¡¹ç›®ä¸­ã€‚ è‹¹æœå…¬å¸ä¸ä¸€å®¶åä¸º PortalPlayer çš„å…¬å¸åˆä½œï¼Œåè€…ä¸€ç›´åœ¨å¼€å‘è‡ªå·±çš„æ’­æ”¾å™¨ã€‚ç¡¬ä»¶é‡‡ç”¨å®šåˆ¶çš„ ARM èŠ¯ç‰‡ PP5502ã€‚è¿™æ˜¯ä¸€ä¸ªèŠ¯ç‰‡ä¸Šçš„ç³»ç»Ÿï¼Œå…·æœ‰åŒ ARM7 å†…æ ¸ï¼Œè¿è¡Œé¢‘ç‡ä¸º 90 MHzï¼Œæ¿è½½å†…å­˜ä¸º 32MBã€‚ä¸»æ¿ä¸Šå”¯ä¸€çš„å…¶ä»–å¤§å‹èŠ¯ç‰‡æ˜¯ç«çº¿æ§åˆ¶å™¨ã€‚ARM è®¸å¯çš„çµæ´»æ€§ä½¿å¾—è®¾è®¡å¸¦æœ‰ç”¨äº MP3 è§£ç ç­‰åŠŸèƒ½çš„å®šåˆ¶ç”µè·¯çš„ CPU å˜å¾—éå¸¸å®¹æ˜“ã€‚ æœ‰å¤šå®¹æ˜“ï¼Ÿæˆ‘çš„ä¸€ä½ç†Ÿäººçº¦ç¿°-å¸Œå§†æ–¯åšå£«ï¼ˆDr. John Simsï¼‰å‘æˆ‘è®²è¿°äº†å¤§çº¦åœ¨åŒä¸€æ—¶æœŸå¦ä¸€å®¶ MP3 æ’­æ”¾å™¨å…¬å¸çš„æ•…äº‹ã€‚ä¸€ä½å·¥ç¨‹å¸ˆä»…ç”¨äº†å…­ä¸ªæœˆçš„æ—¶é—´å°±åœ¨æ ‡å‡† ARM è®¾è®¡ä¸­æ·»åŠ äº†æ•°å­—ä¿¡å·å¤„ç†å™¨ (DSP)ã€‚å¦ä¸€å®¶ç«äº‰å¯¹æ‰‹å…¬å¸ä»é›¶å¼€å§‹åˆ¶é€ èŠ¯ç‰‡ï¼Œè€Œä¸æ˜¯ä¸ ARM åˆä½œï¼Œè¯¥å…¬å¸æœ‰ 60 åå·¥ç¨‹å¸ˆï¼Œé¡¹ç›®è€—æ—¶æ˜¯ ARM çš„ä¸‰å€ã€‚ iPod äº 2001 å¹´é¢ä¸–ï¼Œåœ¨æ¨å‡ºä¸ Windows å…¼å®¹çš„ç‰ˆæœ¬åï¼Œè¿™æ¬¾å°å·§çš„éŸ³ä¹æ’­æ”¾å™¨æˆä¸ºè¡Œä¸šæ ‡å‡†ã€‚åœ¨è¯¥è®¾å¤‡çš„å·…å³°æ—¶æœŸï¼ŒiPod æ¯å¹´çš„é”€é‡è¶…è¿‡ 5000 ä¸‡å°ã€‚å½“äººä»¬ä¸ºå®ƒçš„ç•Œé¢ã€æ˜“ç”¨æ€§å’Œæ ‡å¿—æ€§çš„ç™½è‰²è€³æœºç€è¿·æ—¶ï¼Œå¤§å¤šæ•°äººå¹¶æ²¡æœ‰æ„è¯†åˆ° iPod å®é™…ä¸Šæ˜¯ä¸€å°å¾®å‹ç”µè„‘ã€‚å®ƒæœ‰ä¸­å¤®å¤„ç†å™¨ã€å†…å­˜ã€å¾®å‹ç¡¬ç›˜å’Œæ“ä½œç³»ç»Ÿï¼Œå…¶è§¦æ‘¸è½®å’ŒæŒ‰é’®å°±åƒä¸€ä¸ªå°é¼ æ ‡å’Œé”®ç›˜ã€‚å®ƒç”šè‡³è¿˜æœ‰ä¸€ä¸ªä½å›¾æ˜¾ç¤ºå±ï¼Œå¯ä»¥ç©ç®€å•çš„æ¸¸æˆã€‚ è¯´åˆ°æ¸¸æˆï¼ŒARM åœ¨ 2001 å¹´çš„ç¬¬äºŒä¸ªå¤§èµ¢å®¶æ˜¯ä»»å¤©å ‚çš„ Game Boy Advanceã€‚ä½œä¸ºåŸå§‹ Game Boy çš„åç»§æœºï¼Œå®ƒé…å¤‡äº† 16.8 MHz ARM7 å†…æ ¸å’ŒåµŒå…¥å¼å†…å­˜ã€‚å®ƒè¿˜é…å¤‡äº†å¤æ™® LR35902ï¼Œå¯ä¸æ—§ç³»ç»Ÿå…¼å®¹ã€‚å°±è¿ä¾¿æºå¼æ¸¸æˆæœºä¹Ÿå¼€å§‹ä» CISC èŠ¯ç‰‡å‘ RISC èŠ¯ç‰‡è¿‡æ¸¡ã€‚ äººäººéƒ½èƒ½ä½¿ç”¨çš„æŒä¸Šç”µè„‘ iPod åªæ˜¯ç§»åŠ¨ä¸–ç•Œåˆ’æ—¶ä»£å˜é©çš„å¼€å§‹ã€‚è‹¹æœå…¬å¸æ›¾ä¸æ‘©æ‰˜ç½—æ‹‰å…¬å¸åˆä½œï¼Œåœ¨ ROKR ç¿»ç›–æ‰‹æœºä¸­æ¤å…¥ iPodï¼Œä½†è¿™ä¸€å¥‡ç‰¹çš„åˆä½œæœ€ç»ˆä»¥å¤±è´¥å‘Šç»ˆã€‚ è¯¥é¡¹ç›®å§‹äº 2004 å¹´ã€‚ä¹”å¸ƒæ–¯å¹¶ä¸ç¡®å®šæ­£ç¡®çš„æ–¹æ³•æ˜¯å°† iPod å‡çº§ä¸ºæ‰‹æœºï¼Œè¿˜æ˜¯å°† Macintosh çš„ OS X æ“ä½œç³»ç»Ÿå‰¥ç¦»å‡ºæ¥ï¼Œè®©å®ƒåœ¨ç§»åŠ¨è®¾å¤‡ä¸Šè¿è¡Œã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¹”å¸ƒæ–¯è®©ç«äº‰å¯¹æ‰‹çš„å›¢é˜ŸåŒæ—¶ç ”ç©¶è¿™ä¸¤ç§æ–¹æ³•ã€‚æ‰˜å°¼-æ³•å¾·å°”çš„ iPod å›¢é˜Ÿç»éªŒä¸°å¯Œï¼Œä½†ä»–ä»¬é¢å¯¹çš„æ˜¯æ‘©å°”å®šå¾‹çš„é”™è¯¯æ–¹å‘ã€‚ ä¸ 1985 å¹´çš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬ç›¸æ¯”ï¼ŒARM èŠ¯ç‰‡å·²ç»æœ‰äº†é•¿è¶³çš„è¿›æ­¥ã€‚è¯¥èŠ¯ç‰‡æ‹¥æœ‰ 27000 ä¸ªæ™¶ä½“ç®¡ï¼Œé‡‡ç”¨ 3 å¾®ç±³å·¥è‰ºç”Ÿäº§ã€‚è¿™æ„å‘³ç€æ™¶ä½“ç®¡å’Œå¯¼çº¿çš„å®½åº¦å¤§çº¦ä¸º 0.000003 ç±³ï¼Œå³ 0.003 æ¯«ç±³ã€‚è¿™çœ‹èµ·æ¥ä¼¼ä¹å¾ˆå°ï¼Œä½†ç¡…èŠ¯ç‰‡åˆ¶é€ æŠ€æœ¯çš„è¿›æ­¥æ„å‘³ç€ï¼Œåˆ° 2006 å¹´ï¼ŒèŠ¯ç‰‡ä»£å·¥å‚å¼€å§‹ä½¿ç”¨ 90 çº³ç±³å·¥è‰ºã€‚è¿™ä½¿å¾—ç›¸åŒå°ºå¯¸çš„èŠ¯ç‰‡ä¸Šå¯ä»¥å®‰è£…æ›´å¤šçš„æ™¶ä½“ç®¡ï¼ŒåŒ…æ‹¬å¤§é‡çš„é«˜é€Ÿç¼“å†²å­˜å‚¨å™¨ã€‚è¿™ä¹Ÿæ„å‘³ç€èŠ¯ç‰‡å¯ä»¥ä»¥æ›´é«˜çš„æ—¶é’Ÿé€Ÿåº¦è¿è¡Œã€‚ ç›¸æ¯”ä¹‹ä¸‹ï¼Œè½¯ä»¶çš„æ”¹è¿›è¦æ…¢å¾—å¤šã€‚è½¯ä»¶çš„ç¼–å†™å’Œæµ‹è¯•éƒ½éœ€è¦æ—¶é—´ï¼Œè€Œä¸”æ¯æ¨å‡ºä¸€é¡¹æ–°åŠŸèƒ½ï¼Œéƒ½ä¸å¯é¿å…åœ°ä¼šå‡ºç°å¤§é‡é”™è¯¯ã€‚å› æ­¤ï¼Œç­‰å¾…æ‘©å°”å®šå¾‹æ¨å‡ºå¯è¿è¡Œç°æœ‰ OS X è½¯ä»¶çš„ç§»åŠ¨èŠ¯ç‰‡ï¼Œå®é™…ä¸Šæ¯”åœ¨ iPod çš„ç®€æ˜“æ“ä½œç³»ç»Ÿä¸­æ·»åŠ æ‰€æœ‰å¿…è¦åŠŸèƒ½æ›´å¿«ã€‚ä¹”å¸ƒæ–¯å†³å®šé‡‡ç”¨ç²¾ç®€çš„ OS X æ–¹æ³•ã€‚ä½†è°æ¥ç”Ÿäº§èŠ¯ç‰‡ä»ç„¶æ˜¯ä¸ªé—®é¢˜ã€‚ ä¹”å¸ƒæ–¯é—®è‹±ç‰¹å°”å…¬å¸é¦–å¸­æ‰§è¡Œå®˜ä¿ç½—-å¥¥ç‰¹é‡Œå°¼ï¼ˆPaul Otelliniï¼‰æ˜¯å¦æ„¿æ„ç«æ ‡ä¸ºè‹¹æœå³å°†æ¨å‡ºçš„æ‰‹æœºç”Ÿäº§èŠ¯ç‰‡ã€‚å½“æ—¶ï¼Œè¿™å®¶åˆ¶é€ ä¸šå·¨å¤´æ­£ä¾é ä¸ºåŸºäº Windows çš„è®¡ç®—æœºæä¾›åŠ¨åŠ›çš„å°å¼æœº x86 CPU çš„é”€å”®ä¸šç»©ä¸€è·¯é«˜æ­ŒçŒ›è¿›ã€‚ä¸è¿‡ï¼Œè‹±ç‰¹å°”è¿˜æ‹¥æœ‰ä¸€é¡¹åŸºäº ARM çš„ä¸šåŠ¡ï¼Œå³ 1998 å¹´ä»æ•°å­—è®¾å¤‡å…¬å¸ï¼ˆDECï¼‰æ”¶è´­çš„ XScaleã€‚å› æ­¤ï¼Œè‹±ç‰¹å°”æœ¬å¯ä»¥è½»æ¾æ»¡è¶³è‹¹æœçš„è¦æ±‚ã€‚ ä½†å¥¥ç‰¹é‡Œå°¼æ‹’ç»äº†è¿™ä¸€æè®®ã€‚ä»–è®¡ç®—äº†ä¸€ä¸‹ï¼Œè‹¹æœæ„¿æ„ä¸ºæ¯ä¸ª CPU æ”¯ä»˜çš„æœ€é«˜é‡‘é¢ä½äºè‹±ç‰¹å°”ç”Ÿäº§ CPU çš„æˆæœ¬ï¼Œè€Œä¸”ä»–ä¹Ÿä¸ç¡®å®šè‹¹æœæ‰‹æœºçš„é”€é‡æ˜¯å¦ä¼šå¾ˆé«˜ã€‚å¦å¤–ï¼Œä»–å¯¹æ”¯æŒ XScale æ„Ÿåˆ°ç´§å¼ ï¼Œå°¤å…¶æ˜¯è‹±ç‰¹å°”æ­£åœ¨å¼€å‘å³å°†æ¨å‡ºçš„ä½åŠŸè€— x86 ç‰ˆæœ¬ Atomã€‚2006 å¹´ï¼Œä»–åŠ å€æ”¯æŒ x86ï¼Œå¹¶å‡ºå”®äº† XScale éƒ¨é—¨ã€‚ è¿™å…¶ä¸­æœ‰æŸç§è®½åˆºæ„å‘³ã€‚DEC å½“åˆå‡ºå”® ARM ä¸šåŠ¡æ˜¯å› ä¸ºéœ€è¦é’±ã€‚ä¹‹æ‰€ä»¥éœ€è¦é’±ï¼Œæ˜¯å› ä¸ºè‹±ç‰¹å°”æ­£åœ¨æ‘§æ¯ DEC çš„å¾®å‹è®¡ç®—æœºå’Œå·¥ä½œç«™å¸‚åœºã€‚åŸºäº x86 çš„ä¸ªäººç”µè„‘ä»·æ ¼æ›´ä½ï¼Œäº§é‡æ›´é«˜ï¼Œéšç€æ—¶é—´çš„æ¨ç§»ï¼Œè¿™äº›å¤§å‹è®¡ç®—æœºçš„ç«äº‰åŠ›è¶Šæ¥è¶Šå¼±ã€‚ç°åœ¨ï¼Œè‹±ç‰¹å°”æ”¾å¼ƒäº†åŒæ ·çš„ç§»åŠ¨èŠ¯ç‰‡éƒ¨é—¨ï¼Œè½¬è€Œä¸“æ³¨äºå°å¼æœºã€‚ åœ¨è‹±ç‰¹å°”æ‹’ç»äº†è¿™ç¬”äº¤æ˜“åï¼Œè‹¹æœè½¬å‘äº†ä¸‰æ˜Ÿã€‚è¿™å®¶éŸ©å›½ä¼ä¸šé›†å›¢åŒæ„ä¸ºè‹¹æœå³å°†æ¨å‡ºçš„æ‰‹æœºç”Ÿäº§åŠŸèƒ½å¼ºå¤§çš„æ–°å‹ ARM èŠ¯ç‰‡ã€‚è¿™å°±æ˜¯ S5L8900ï¼Œä¸€æ¬¾é…å¤‡ ARM11 å†…æ ¸çš„ SoCï¼Œè¿è¡Œé¢‘ç‡ä¸º 412 MHzï¼ˆè¶…é¢‘ï¼ï¼‰ï¼Œ128MB å†…å­˜ï¼Œæœ€é«˜ 16GB å­˜å‚¨å®¹é‡ï¼Œé›†æˆ PowerVR MBX Lite 3D å›¾å½¢å¤„ç†å™¨ã€‚è¿™æ˜¯ä¸€æ¬¾éå‡¡çš„èŠ¯ç‰‡ï¼Œè®©äººæƒ³èµ· 1991 å¹´çš„ ARM 250 â€œèŠ¯ç‰‡ä¸Šçš„é˜¿åŸºç±³å¾·â€ï¼Œä½†å…¶å¼ºå¤§çš„åŠŸèƒ½è¶³ä»¥æˆä¸ºä¸–çºªä¹‹äº¤çš„å°å¼æœºçš„æ ¸å¿ƒã€‚ ä½†å®ƒä¸æ˜¯å°å¼æœºã€‚å®ƒæ˜¯ä¸€éƒ¨æ‰‹æœºï¼Œè€Œä¸”æ˜¯ä¸€éƒ¨é©å‘½æ€§çš„æ‰‹æœºã€‚2007 å¹´ 1 æœˆ 9 æ—¥ï¼Œä¹”å¸ƒæ–¯åœ¨ Macworld å¤§ä¼šä¸Šå‘å¸ƒäº† iPhoneã€‚ä»Šå¤©é‡æ¸©è¿™ä¸€å‘å¸ƒï¼Œæ„Ÿè§‰å°±åƒæ˜¯å†å²çš„è½¬æŠ˜ç‚¹ã€‚å¥‡æ€ªçš„æ˜¯ï¼Œä¹”å¸ƒæ–¯èŠ±äº†å¾ˆå¤šæ—¶é—´å¼ºè°ƒ iPhone å®é™…ä¸Šæ˜¯ä¸‰ç§è®¾å¤‡ï¼šæ‰‹æœºã€iPod å’Œäº’è”ç½‘é€šè®¯å™¨ã€‚ ç°åœ¨æ²¡æœ‰äººä¼šè¿™æ ·å½¢å®¹ iPhone äº†ã€‚ å®ƒå°±æ˜¯ä¸€å°å¯ä»¥æ”¾è¿›å£è¢‹çš„ç”µè„‘ã€‚å¤§å‹è®¡ç®—æœºæœ‰æˆ¿é—´é‚£ä¹ˆå¤§ï¼Œå¾®å‹è®¡ç®—æœºæœ‰å†°ç®±é‚£ä¹ˆå¤§ï¼Œè€Œå¾®å‹è®¡ç®—æœºåˆ™æœ‰çƒ¤é¢åŒ…æœºé‚£ä¹ˆå¤§ã€‚è¿™äº›æ–°è®¾å¤‡å¾ˆå®¹æ˜“è¢«ç§°ä¸ºçº³ç±³è®¡ç®—æœºã€‚æˆ‘ä»¬å´ç§°ä¹‹ä¸ºæ™ºèƒ½æ‰‹æœºï¼Œå°½ç®¡å¾ˆå¤šäººå·²ç»å¾ˆå°‘ä½¿ç”¨æ‰‹æœºçš„éƒ¨åˆ†ã€‚ æ¶ˆæ¯å‘å¸ƒåï¼Œè°·æ­Œçš„å®‰å“å­å…¬å¸è¿…é€Ÿæ”¹å˜äº†äº§å“è®¡åˆ’ï¼Œä»ç”Ÿäº§é»‘è“æ‰‹æœºçš„å…‹éš†ç‰ˆè½¬å‘ç”Ÿäº§æ›´æ¥è¿‘ iPhone çš„äº§å“ã€‚2008 å¹´å‘å¸ƒçš„ T-Mobile G1 ä¹Ÿé‡‡ç”¨äº† ARM æŠ€æœ¯ã€‚å®ƒå¼•å‘äº†å¤§é‡ Android è®¾å¤‡çš„æ¶Œç°ï¼Œæ‰€æœ‰è¿™äº›è®¾å¤‡éƒ½é‡‡ç”¨äº†ç›¸åŒçš„å¤–å½¢è®¾è®¡ï¼Œå³ä¸€ä¸ªè–„è–„çš„é»‘è‰²é•¿æ–¹å½¢ï¼Œé…å¤‡ä¸€ä¸ªå¤§å°ºå¯¸è§¦æ‘¸å±ã€‚é™¤äº† iPhone å’Œå®‰å“ï¼Œå…¶ä»–æ‰€æœ‰æ™ºèƒ½æ‰‹æœºå¹³å°éƒ½è¢«æ·˜æ±°å‡ºå±€ï¼Œè€Œéæ™ºèƒ½æ‰‹æœºçš„æ‰‹æœºä¹Ÿå¾ˆå¿«ç»è¿¹ã€‚ èŠ¯ç‰‡çš„å¾ªç¯ 2008 å¹´ï¼Œè‹¹æœå…¬å¸ä»¥ 2.78 äº¿ç¾å…ƒæ”¶è´­äº† P.A. Semi å…¬å¸ã€‚è¯¥å…¬å¸æ‹¥æœ‰ 150 åå·¥ç¨‹å¸ˆï¼Œè®¾è®¡é«˜èƒ½æ•ˆçš„ PowerPC CPUã€‚å¾ˆå¤šäººä¸æ˜ç™½è‹¹æœå…¬å¸ä¸ºä»€ä¹ˆè¦æ”¶è´­ä¸€å®¶ PowerPC å…¬å¸ï¼Œå°¤å…¶æ˜¯è‹¹æœå…¬å¸åœ¨ 2005 å¹´å·²ç»å°† Macintosh ä» PowerPC å¤„ç†å™¨è¿‡æ¸¡åˆ°è‹±ç‰¹å°” x86 å¤„ç†å™¨ã€‚ ä½†æ˜¯ï¼ŒPA Semi å…¬å¸çš„å·¥ç¨‹å¸ˆä»¬äº†è§£çš„ä¸ä»…ä»…æ˜¯ PowerPCã€‚ä»–ä»¬åŒ…æ‹¬ DEC Alpha å’Œ StrongARM å¤„ç†å™¨çš„é¦–å¸­è®¾è®¡å¸ˆï¼Œä»¥åŠæ›¾å‚ä¸è‹±ç‰¹å°” Itaniumã€AMD Opteron å’Œ Sun UltraSPARC å¼€å‘çš„äººå‘˜ã€‚è‹¹æœå…¬å¸è´­ä¹°çš„æ˜¯ä¸€äº›ä¸–ç•Œé¡¶çº§çš„å¤„ç†å™¨è®¾è®¡ä¸“å®¶ã€‚ è¿™ä¸ªè®¾è®¡å›¢é˜Ÿç§˜å¯†å·¥ä½œäº†ä¸¤å¹´ï¼Œç›´åˆ° 2010 å¹´è‹¹æœæ¨å‡º iPadã€‚iPadæ²¡æœ‰ä½¿ç”¨ä¸‰æ˜Ÿçš„è®¾è®¡ï¼Œè€Œæ˜¯é‡‡ç”¨äº†ä¸€ç§åä¸º &quot;A4 &quot;çš„å¤„ç†å™¨ï¼Œè¿™æ˜¯è‹¹æœå…¬å¸å†…éƒ¨è®¾è®¡çš„ç¬¬ä¸€æ¬¾ç³»ç»ŸèŠ¯ç‰‡ï¼ˆä¸‰æ˜Ÿä»åœ¨ç”Ÿäº§è¯¥èŠ¯ç‰‡ï¼‰ã€‚å®ƒçš„è¿è¡Œé€Ÿåº¦ä¸º 1 GHzï¼Œå¹¶ä»¥è¾ƒæ–°çš„ ARM Cortex A8 æ¶æ„ä¸ºèµ·ç‚¹ã€‚ä¸ä¸ºç¬¬ä¸€ä»£ iPhone æä¾›åŠ¨åŠ›çš„è€å¼ ARM11 å†…æ ¸ç›¸æ¯”ï¼ŒCortex è®¾è®¡æœ‰äº†å¤§å¹…å‡çº§ã€‚ ä¸æœ€åˆçš„ ARM CPU ç›¸æ¯”ï¼Œå®ƒä»¬æœ‰äº†é•¿è¶³çš„è¿›æ­¥ï¼ A4 èŠ¯ç‰‡çš„äº®ç›¸å¹¶æ²¡æœ‰åœ¨ CPU è®¾è®¡é¢†åŸŸå¼•èµ·ä»»ä½•è½©ç„¶å¤§æ³¢ã€‚äººä»¬è®¤ä¸ºå®ƒåªæ˜¯å¯¹ç°æœ‰ç§»åŠ¨èŠ¯ç‰‡çš„æ™®é€šæ”¹è¿›ã€‚ä¾‹å¦‚ï¼Œè‹±ç‰¹å°”æ­£å¿™äºæ¨å¹¿å…¶é«˜ç«¯ x86 æ¡Œé¢èŠ¯ç‰‡ï¼Œå¹¶è¯•å›¾é€šè¿‡åŸºäº x86 çš„ä½åŠŸè€— Atom èŠ¯ç‰‡é‡æ–°è¿›å…¥ç§»åŠ¨èŠ¯ç‰‡å¸‚åœºã€‚å…¶ä»–èŠ¯ç‰‡è®¾è®¡å…¬å¸ï¼Œå¦‚é«˜é€šå…¬å¸ï¼Œåˆ™åœ¨è‡ªå·±åŸºäº ARM çš„ SoC è®¾è®¡ä¸Šå–å¾—äº†å·¨å¤§æˆåŠŸï¼Œå¹¶å°†å…¶åº”ç”¨äºè®¸å¤šä¸åŒçš„å®‰å“äº§å“ä¸­ã€‚ ä½†æœ‰è¶£çš„äº‹æƒ…å‘ç”Ÿäº†ã€‚2011 å¹´ï¼ŒA4 èŠ¯ç‰‡è¢« A5 èŠ¯ç‰‡å–ä»£ï¼ŒCPU æ€§èƒ½ç¿»äº†ä¸€ç•ªï¼Œè§†é¢‘èŠ¯ç‰‡é€Ÿåº¦ä¹Ÿå¤§å¹…æå‡ã€‚ç¬¬äºŒå¹´çš„ A6 ä¹Ÿåšäº†åŒæ ·çš„äº‹æƒ…ã€‚éšåï¼ŒA7 äº 2013 å¹´å‘å¸ƒã€‚è¿™æ˜¯ä¸€æ¬¾å®Œå…¨ 64 ä½çš„ CPUï¼Œç”šè‡³è¶…è¶Šäº† ARM è‡ªèº«ä» 32 ä½çš„è¿‡æ¸¡ã€‚å®ƒæ‹¥æœ‰ 64 ä½æŒ‡ä»¤é›†ï¼Œä»¥åŠå…¨æ–°çš„å®šåˆ¶èŠ¯ç‰‡ï¼Œå¯ç”¨ä½œ iPhone æ‘„åƒå¤´çš„å›¾åƒå¤„ç†å™¨ã€‚ åœ¨æ™ºèƒ½æ‰‹æœºä¸­å®‰è£… 64 ä½ CPU ä¼¼ä¹æœ‰äº›å¯ç¬‘ã€‚æ‰‹æœºçœŸçš„éœ€è¦è¶…è¿‡ 4GB çš„å†…å­˜å—ï¼Ÿä½†éšç€æ—¶é—´çš„æ¨ç§»ï¼Œè¿™äº›è®ºç‚¹å¼€å§‹å˜å¾—è¶Šæ¥è¶Šä¸åˆç†ã€‚ä» A7 åˆ° A8ï¼Œå†åˆ° A12ï¼Œè¿™äº›ç§»åŠ¨èŠ¯ç‰‡çš„æ€§èƒ½å›¾è°±å‘ç”Ÿäº†ä¸€äº›æœ‰è¶£çš„å˜åŒ–ã€‚ 2018 å¹´å‘å¸ƒçš„ iPad Pro æ‰è®©äººä»¬æŒ å¤´ä¸è§£ã€‚å¯¹å…¶ A12 Bionic CPU çš„åŸºå‡†æµ‹è¯•è¡¨æ˜ï¼Œåœ¨æŸäº›åŸºå‡†æµ‹è¯•ä¸­ï¼Œå®ƒçš„é€Ÿåº¦ï¼ˆè‡³å°‘æ¯ä¸ª CPU å†…æ ¸ï¼‰æ¯”åŒç±»è‹±ç‰¹å°”èŠ¯ç‰‡æ›´å¿«ã€‚è¿™å®Œå…¨è¯´ä¸é€šã€‚ç§»åŠ¨èŠ¯ç‰‡æ€ä¹ˆå¯èƒ½æ¯”å°å¼æœºèŠ¯ç‰‡æ›´å¿«ï¼Ÿ ç­”æ¡ˆæ˜¯å¤šç§ä¸åŒå› ç´ çš„ç»¼åˆä½œç”¨ã€‚æ­£å¦‚æˆ‘ä»¬å·²ç»çœ‹åˆ°çš„ï¼ŒARM åŸå§‹è®¾è®¡çš„ç®€æ´å’Œä¼˜é›…ä½¿è¿™äº›èŠ¯ç‰‡ä»ä¸€å¼€å§‹å°±åœ¨æ€§èƒ½â€“å°¤å…¶æ˜¯æ¯ç“¦ç‰¹æ€§èƒ½â€“æ–¹é¢å å°½ä¼˜åŠ¿ã€‚è¿™ç§ä¼˜é›…éƒ¨åˆ†å½’åŠŸäºç²¾ç®€æŒ‡ä»¤é›†è®¡ç®—æœºï¼ˆRISCï¼‰æ¶æ„ï¼Œä¸è‹±ç‰¹å°”å¤æ‚ï¼ˆCISCï¼‰çš„ x86 èŠ¯ç‰‡ç›¸æ¯”ï¼Œè¯¥æ¶æ„çš„ CPU æŒ‡ä»¤æ›´ç®€å•ã€æ•°é‡æ›´å°‘ã€‚ ä½†è¿™äº›å¹´æ¥ï¼Œè‹±ç‰¹å°”å¹¶æ²¡æœ‰åœæ»ä¸å‰ã€‚ä» 1995 å¹´çš„å¥”è…¾ Pro å¼€å§‹ï¼Œè‹±ç‰¹å°”å¢åŠ äº†ä¸€å¥—ç±»ä¼¼ RISC çš„éšè—å¾®æ“ä½œã€‚ç¨‹åºå‘˜æ¯æ¬¡å‘ CPU å‘é€æ™®é€š x86 æŒ‡ä»¤æ—¶ï¼Œéƒ½ä¼šåœ¨å†…éƒ¨å°†å…¶è½¬æ¢ä¸ºè¿™äº›å¾®æ“ä½œã€‚è¿™æ„å‘³ç€è‹±ç‰¹å°”èŠ¯ç‰‡çš„è¿è¡Œé€Ÿåº¦å‡ ä¹ä¸æœ€å¼ºå¤§çš„ RISC èŠ¯ç‰‡ç›¸å½“ã€‚åˆ° 2010 å¹´ï¼ŒCPU å·¨å¤´è‹±ç‰¹å°”æ¯å¹´çš„ CPU é”€é‡æ¥è¿‘ 3 äº¿ä¸ªã€‚å®ƒå·²ç»å‡»è´¥äº† SPARCã€PowerPC å’Œ MIPS ç­‰å…¶ä»– RISC CPUã€‚åˆ° 2013 å¹´ï¼Œç”šè‡³è¿æ¸¸æˆæœºä¹Ÿä» PowerPC èŠ¯ç‰‡è½¬å‘äº† x86 èŠ¯ç‰‡ï¼Œå› ä¸ºæ¸¸æˆæœºä¸å¿…æ‹…å¿ƒå„ä»£äº§å“ä¹‹é—´çš„é—ç•™ä»£ç å…¼å®¹æ€§é—®é¢˜ã€‚ ç„¶è€Œï¼Œå…¨çƒæ™ºèƒ½æ‰‹æœºå¸‚åœºçš„è§„æ¨¡å´å®Œå…¨ä¸åŒã€‚ä¸–ç•Œä¸Šå¤§éƒ¨åˆ†äººä»ç„¶éš¾ä»¥è´Ÿæ‹… 2000 ç¾å…ƒçš„ä¸ªäººç”µè„‘ï¼Œä½† 200 ç¾å…ƒçš„æ™ºèƒ½æ‰‹æœºå´æ›´å®¹æ˜“ä¹°åˆ°ã€‚å› æ­¤ï¼Œæ™ºèƒ½æ‰‹æœºé”€é‡å‡ºç°çˆ†ç‚¸å¼å¢é•¿ï¼Œ2010 å¹´è¶…è¿‡ä¸ªäººç”µè„‘é”€é‡ï¼Œä»æ­¤ä¸€å‘ä¸å¯æ”¶æ‹¾ã€‚åˆ° 2018 å¹´ï¼Œæ™ºèƒ½æ‰‹æœºçš„å¹´é”€é‡æ¥è¿‘ 15 äº¿éƒ¨ã€‚åœ¨è‹±ç‰¹å°”æ”¾å¼ƒåœ¨æ™ºèƒ½æ‰‹æœºä¸­ä½¿ç”¨ Atoms èŠ¯ç‰‡ä¹‹åï¼Œæ¯éƒ¨æ™ºèƒ½æ‰‹æœºéƒ½é‡‡ç”¨äº† ARM èŠ¯ç‰‡ã€‚ ç°åœ¨ï¼Œè§„æ¨¡ç»æµæœ‰åˆ©äºä¸‰æ˜Ÿå’Œå°æ¹¾åŠå¯¼ä½“åˆ¶é€ å…¬å¸ï¼ˆå°ç§¯ç”µï¼‰ç­‰ç§»åŠ¨èŠ¯ç‰‡åˆ¶é€ å…¬å¸ã€‚è‹¹æœå…¬å¸å‘å°ç§¯ç”µæŠ•èµ„æ•°åäº¿ç¾å…ƒï¼Œå¹¶å°†å…¶æ‰€æœ‰èŠ¯ç‰‡ç”Ÿäº§è½¬ç§»åˆ°å°ç§¯ç”µã€‚ä»åˆ¶é€ çš„è§’åº¦æ¥çœ‹ï¼Œè‹±ç‰¹å°”æ— æ³•è·Ÿä¸Šã€‚2020 å¹´ï¼Œè‹±ç‰¹å°”æ‰¿è®¤ä¸å¾—ä¸æ¨è¿Ÿä» 10 çº³ç±³å·¥è‰ºå‘ 7 çº³ç±³å·¥è‰ºçš„è½¬ç§»ã€‚ä¸æ­¤åŒæ—¶ï¼Œå°ç§¯ç”µè·ƒå‡è‡³ 5 çº³ç±³åˆ¶é€ å·¥è‰ºã€‚è™½ç„¶åœ¨è¿™ç§è§„æ¨¡ä¸‹ï¼Œå·¥è‰ºæ•°å­—å¼€å§‹å¤±å»æ„ä¹‰ï¼Œä½†æœ‰ä¸€ç‚¹æ˜¯æ˜ç¡®çš„ï¼šæ™ºèƒ½æ‰‹æœºèŠ¯ç‰‡å·²ç»å‡†å¤‡å¥½åœ¨æ€§èƒ½ä¸Šé¢†å…ˆã€‚ 2020 å¹´ 11 æœˆï¼Œä»–ä»¬åšåˆ°äº†ã€‚å°±åœ¨é‚£æ—¶ï¼Œè‹¹æœå…¬å¸å‘å¸ƒäº† Macintosh ç”µè„‘ç³»åˆ—çš„ M1 èŠ¯ç‰‡ã€‚è¿™äº›èŠ¯ç‰‡éœ‡æƒŠäº†è®¡ç®—ä¸–ç•Œâ€“å®ƒä»¬æ¯”æœ€å¿«çš„è‹±ç‰¹å°” x86 CPU æ€§èƒ½æ›´å¼ºï¼Œä½†åŠŸè€—å´åªæœ‰å®ƒä»¬çš„ä¸€å°éƒ¨åˆ†ã€‚ARM ä¸€ç›´æ˜¯æ¯ç“¦æ€§èƒ½çš„èµ¢å®¶ï¼Œä½†è¿™äº›èŠ¯ç‰‡å´å®Œå…¨ä¸åŒã€‚ æˆ‘ä¹°äº†ä¸€å°åŸºäº M1 çš„ MacBook Proï¼Œæ„Ÿè§‰å®ƒæ˜¯ç¬¬ä¸€å°åå‰¯å…¶å®çš„ç¬”è®°æœ¬ç”µè„‘ã€‚å½“æˆ‘å¸¦ç€å®ƒä¸Šç­æ—¶ï¼Œæˆ‘ç”šè‡³æ‡’å¾—å¸¦å……ç”µå™¨ã€‚æ— è®ºæˆ‘è¿è¡Œä»€ä¹ˆç¨‹åºï¼Œé£æ‰‡éƒ½ä¸ä¼šäº®ï¼Œç”µæ± ä¹Ÿä¸ä¼šè€—å°½ã€‚è¿™ç§çº§åˆ«çš„èŠ¯ç‰‡ä¸å¯é¿å…åœ°ä¹Ÿå°†ç”¨äº Windows ç¬”è®°æœ¬ç”µè„‘ã€‚åˆ°é‚£æ—¶ï¼Œè‹±ç‰¹å°”çš„éº»çƒ¦å¯å°±å¤§äº†ã€‚ ç»è¿‡ 35 å¹´çš„å‘å±•ï¼ŒARM å·²ç»èµ°è¿‡äº†ä¸€ä¸ªå®Œæ•´çš„å†ç¨‹ã€‚ARM èµ·æºäº 1985 å¹´çš„å°å¼ç”µè„‘èŠ¯ç‰‡ï¼Œç‰¹åˆ«æ˜¯ Acorn Archimedesã€‚ä½†ç”±äºé˜¿åŸºç±³å¾·æœªèƒ½å é¢†å¸‚åœºï¼ŒARM èŠ¯ç‰‡åœ¨ 1990 å¹´è¢«åˆ†æ‹†æˆè‡ªå·±çš„å…¬å¸ã€‚ç»è¿‡ç¼“æ…¢çš„èµ·æ­¥ï¼ŒARM æˆä¸ºäº†åµŒå…¥å¼ CPU å¸‚åœºçš„æ ‡å‡†ï¼Œå¹¶è¿›å…¥äº† iPodã€Game Boy Advance ç­‰æµè¡Œçš„ç§»åŠ¨è®¾å¤‡ä»¥åŠ iPhone å’Œ Android ç­‰æ™ºèƒ½æ‰‹æœºã€‚ç°åœ¨ï¼Œå®ƒç»ˆäºåˆå›åˆ°äº†ä¸ªäººç”µè„‘ä¸­ã€‚ ä½†æ˜¯ï¼ŒARM çš„çµæ´»æ€§æ„å‘³ç€è¿™äº›ç”µè„‘å¹¶ä¸ä¸€å®šéœ€è¦åƒè‹¹æœå…¬å¸é”€å”®çš„ç”µè„‘é‚£æ ·æ˜‚è´µã€‚2009 å¹´ï¼ŒRaspberry Pi åŸºé‡‘ä¼šåœ¨ ARM èŠ¯ç‰‡çš„åŸäº§åœ°è‹±å›½æ³¨å†Œæˆç«‹ã€‚å®ƒçš„ä½¿å‘½æ˜¯ç»§ç»­åœ¨æ•™è‚²é¢†åŸŸæ¨å¹¿è®¡ç®—æœºç§‘å­¦ï¼Œå°±åƒæ©¡æœå…¬å¸çš„ BBC è®¡ç®—æœºåœ¨ 20 ä¸–çºª 80 å¹´ä»£æ‰€åšçš„é‚£æ ·ã€‚é‰´äºè¿™ä¸€å†å²æ¸Šæºï¼ŒåŸºé‡‘ä¼šåªèƒ½é€‰æ‹©ä¸€ç§å¤„ç†å™¨ã€‚ ç¬¬ä¸€å° Raspberry Pi äº 2012 å¹´å‘å¸ƒã€‚è¿™æ˜¯ä¸€æ¬¾å•æ¿è®¡ç®—æœºï¼Œåªæœ‰ä¿¡ç”¨å¡å¤§å°ã€‚Pi é…å¤‡äº† ARM11 å¤„ç†å™¨ã€å†…ç½®å†…å­˜å’Œè®¡ç®—æœºæ‰€éœ€çš„æ‰€æœ‰æ¥å£ï¼š ç”¨äºè¿æ¥é¼ æ ‡å’Œé”®ç›˜çš„ USB æ¥å£ã€è€³æœºæ’å­”ã€ç”¨äºè¿æ¥æ˜¾ç¤ºå™¨çš„ HDMI æ¥å£å’Œä»¥å¤ªç½‘æ¥å£ã€‚å®ƒè¿˜é…å¤‡äº†ä¸€ä¸ª â€œé€šç”¨è¾“å…¥è¾“å‡ºâ€ æˆ– GPIO è¿æ¥å™¨ï¼Œè®©å·¥åŒ ä»¬å¯ä»¥è½»æ¾è¿æ¥å’Œæ§åˆ¶ç¯ã€ä¼ æ„Ÿå™¨å’Œç”µæœºã€‚å®ƒçš„å”®ä»·ä¸º 35 ç¾å…ƒã€‚åæ¥çš„å‹å·åŠŸèƒ½è¶Šæ¥è¶Šå¼ºå¤§ï¼Œä½†ä»·æ ¼å¹¶ä¸æ˜‚è´µã€‚ARM æœ€åˆçš„ä½¿å‘½â€“å°†è®¡ç®—èƒ½åŠ›å¸¦ç»™å¤§ä¼—â€“å·²ç»å®ç°ã€‚ è¿™ä¸€åˆ‡æ„å‘³ç€ä»€ä¹ˆ 2006 å¹´ï¼ŒARM é¦–å¸­æ‰§è¡Œå®˜ç½—å®¾-è¨å…‹æ–¯æ¯”é€€ä¼‘äº†ã€‚ä»–æ—©æœ‰é¢„è°‹ã€‚å½“æ—¶å…¬å¸çš„çŠ¶å†µéå¸¸å¥½ï¼Œä»–ä¹Ÿå¾ˆå¥½åœ°å®Œæˆäº†é¦–å¸­æ‰§è¡Œå®˜çš„äº¤æ¥å·¥ä½œï¼Œä»¥è‡³äºæ¶ˆæ¯ä¼ å‡ºæ—¶ï¼ŒARM çš„è‚¡ä»·è¿çœ¼ç›éƒ½æ²¡çœ¨ä¸€ä¸‹ã€‚ æˆ‘å†™è®¡ç®—æœºå†å²çš„æ–‡ç« å·²ç»å¾ˆå¤šå¹´äº†ï¼Œæˆ‘æ³¨æ„åˆ°çš„ä¸€ç‚¹æ˜¯ï¼Œå“è¶Šçš„æŠ€æœ¯å¾ˆå°‘èƒ½åœ¨å¸‚åœºä¸Šè·èƒœã€‚åŒæ ·æ˜¯åœ¨ 1985 å¹´å‘å¸ƒçš„ Amiga ç”µè„‘ï¼Œé¢†å…ˆæ—¶ä»£ 10 å¹´ä¹‹ä¹…ï¼Œä½†å…¶æ¯å…¬å¸å€’é—­ï¼Œè¯¥å¹³å°ä»æ­¤ä¸€è¹¶ä¸æŒ¯ã€‚ ARM çš„æƒ…å†µåˆ™æˆªç„¶ä¸åŒã€‚è™½ç„¶å®ƒèµ°ä¸Šäº†ä¸€æ¡æ„æƒ³ä¸åˆ°çš„é“è·¯ï¼Œä½†å…¬å¸åˆ›å§‹äººå´å–å¾—äº†è¶…ä¹æƒ³è±¡çš„æˆåŠŸã€‚å¯¹äºä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ç§æƒ…å†µï¼Œæˆ‘æœ‰ä¸€ä¸ªç†è®ºã€‚åœ¨æˆ‘çœ‹æ¥ï¼Œä¸¤å®¶å…¬å¸éƒ½æ‹¥æœ‰æ°å‡ºçš„å·¥ç¨‹å¸ˆå’Œå“è¶Šçš„æŠ€æœ¯ï¼Œä½†ç®¡ç†é£æ ¼å´å¤§ç›¸å¾„åº­ã€‚ä¸è¿‡ï¼Œä¸ºäº†éªŒè¯æˆ‘çš„æƒ³æ³•ï¼Œæˆ‘å¿…é¡»æ‰¾åˆ°ä¸€ä¸ªäº²å†è€…ï¼Œä»–å¯¹ ARM çš„ä¸€åˆ‡éƒ½äº†å¦‚æŒ‡æŒã€‚æˆ‘éœ€è¦å’Œè¨å…‹æ–¯æ¯”è°ˆè°ˆã€‚ è¨å…‹æ–¯æ¯”å¾ˆé«˜å…´ä¸æˆ‘äº¤è°ˆï¼Œè€Œä¸”éå¸¸æ…·æ…¨ã€‚ä»–è®²è¿°äº†è‡ªå·±å¦‚ä½•æ¥åˆ° ARM çš„æ•…äº‹ï¼Œä»¥åŠä½œä¸ºä¸€åå·¥ç¨‹å¸ˆï¼Œä»–æ˜¯å¦‚ä½•ä¸ 12 ååˆ›å§‹å·¥ç¨‹å¸ˆä¸€æ‹å³åˆçš„ã€‚ä»–å¼€ç©ç¬‘è¯´ï¼Œä¸ºäº†èŠ‚çœå¼€æ”¯ï¼Œä»–æŒ‘é€‰äº†ä¸€äº›ç‰¹æ®Šçš„å·¥ç¨‹å¸ˆæ¥æ‹…ä»»å…³é”®èŒä½ï¼Œæ¯”å¦‚å¸‚åœºæ€»ç›‘å’Œé”€å”®æ€»ç›‘ã€‚ä½†äº‹å®ä¸Šï¼Œä»–è§‰å¾—æ•™å¥½çš„å·¥ç¨‹å¸ˆå¦‚ä½•é”€å”®æ›´å®¹æ˜“ï¼Œè€Œä¸æ˜¯ç›¸åã€‚ä»–è¿˜åšæŒç»™æ¯ä½åˆ›å§‹äººè‚¡ç¥¨æœŸæƒï¼Œè®©ä»–ä»¬éƒ½èƒ½åˆ†äº«å…¬å¸çš„æˆåŠŸã€‚ ä¸è¿‡ï¼Œè¨å…‹æ–¯æ¯”ç®¡ç†æ–¹æ³•çš„å…³é”®å¾ˆç®€å•ï¼Œä½†åœ¨å•†ç•Œå´å¹¶ä¸å¸¸è§ï¼š ARM çš„å‘å±•æ˜¯å› ä¸ºå®ƒå¸®åŠ©ä»–äººå‘å±•ã€‚å®ƒæ›´å¤šåœ°æŠŠå‘˜å·¥å½“äººçœ‹ï¼Œè€Œä¸æ˜¯äººåŠ›èµ„æºï¼Œç»™ä»–ä»¬å­¦ä¹ çš„æœºä¼šï¼Œè®©ä»–ä»¬ä¸å…¬å¸ä¸€èµ·å–å¾—æˆåŠŸã€‚&quot;ä»–å‘Šè¯‰æˆ‘ï¼šâ€œæˆ‘æ·±ä¿¡ï¼Œåœ¨ä»»ä½•å›¢é˜Ÿä¸­ï¼Œä»»ä½•æˆå‘˜éƒ½æ¯”å…¶ä»–äººæ›´æ“…é•¿æŸäº›äº‹æƒ…ï¼Œå› æ­¤ï¼Œè¦æƒ³è®©å›¢é˜Ÿå‘æŒ¥å‡ºæœ€ä½³æ°´å¹³ï¼Œå°±å¿…é¡»è®©æ¯ä¸ªäººéƒ½å‘æŒ¥å‡ºæœ€ä½³è½´å¿ƒçš„ä½œç”¨ã€‚é…åˆé»˜å¥‘çš„å›¢é˜Ÿå·¥ä½œå¾—æ›´å¥½â€ã€‚ä»–å¼ºè°ƒäº†å¯¹å‘˜å·¥è¯šå®ã€ä¸è¿‡åº¦æ‰¿è¯ºå…¬å¸æ‰€èƒ½æä¾›çš„ä¸€åˆ‡çš„é‡è¦æ€§ã€‚ ARM ç”šè‡³å°†ç«äº‰å¯¹æ‰‹è§†ä¸ºæ½œåœ¨çš„åˆä½œä¼™ä¼´â€“å½“å®ƒå¸®åŠ©åˆä½œä¼™ä¼´å–å¾—æˆåŠŸæ—¶ï¼ŒARM ä¹Ÿä¼šä»ä¸­å—ç›Šã€‚&quot;ä»–è¯´ï¼šâ€œå› ä¸ºå¾·å·ä»ªå™¨å…¬å¸æ²¡æœ‰ç†æƒ³çš„å¤„ç†å™¨æ¥æ»¡è¶³è¯ºåŸºäºšçš„éœ€æ±‚ï¼Œâ€&quot;ä»–ä»¬å¯¹åˆä½œå¾ˆæ„Ÿå…´è¶£ã€‚è¿™ç§åˆä½œä½¿ ARM èŠ¯ç‰‡æˆä¸ºæ‰‹æœºå¸‚åœºçš„æ ‡å‡†ã€‚ è®©æˆ‘ä»¬æŠŠè¿™ç§ç†å¿µä¸ Amiga çš„æ¯å…¬å¸ Commodore åšä¸ªå¯¹æ¯”ã€‚å…¬å¸åˆ›å§‹äººæ°å…‹-ç‰¹æ‹‰ç±³å°”ï¼ˆJack Tramielï¼‰ç›¸ä¿¡ â€œå•†ä¸šå°±æ˜¯æˆ˜äº‰â€ï¼Œä»–åŸ¹å…»äº†ä¸€ç§ç®¡ç†é£æ ¼ï¼Œå³ Commodore è¦èµ¢ï¼Œå…¶ä»–äººå°±å¿…é¡»è¾“ã€‚åæ¥ï¼Œä»–è¢«ä¸€ä¸ªå†·é…·æ— æƒ…çš„é‡‘èå®¶èµ¶ä¸‹äº†å°ï¼Œç”±ç®¡ç†é¡¾é—®æ¢…èµ«è¿ª-é˜¿é‡Œæ¥æ›¿ä»–æ‹…ä»»é¦–å¸­æ‰§è¡Œå®˜ã€‚é˜¿é‡Œå¯¹å·¥ç¨‹å­¦ä¸€æ— æ‰€çŸ¥ï¼Œä¹Ÿä¸æƒ³å­¦ä¹ ã€‚ä»–åªæƒ³æ•›è´¢ã€‚ å‡†å°†å¾ˆå¿«å°±ç ´äº§äº†ï¼Œé˜¿é‡Œä»æ­¤é”€å£°åŒ¿è¿¹ï¼Œå«æ¨è€Œç»ˆã€‚å¦ä¸€æ–¹é¢ï¼ŒARM å…¬å¸ç»§ç»­å‘å±•å£®å¤§å¹¶å–å¾—æˆåŠŸã€‚2002 å¹´ï¼Œè¨å…‹æ–¯æ¯”è¢«ä¼Šä¸½èç™½å¥³ç‹å†Œå°ä¸ºçˆµå£«ï¼Œé€€ä¼‘åä»–çš„å…¬å¸å‘å±•å¾—éå¸¸å¥½ï¼Œä»–ä½œä¸ºä¸€åå€¼å¾—ä¿¡èµ–çš„é¡¾é—®ï¼Œç»§ç»­ä¸ºå…¬ä¼—æä¾›ä¿¡æ¯å’Œæ•™è‚²ï¼Œå¹¶æˆä¸ºå·¥ç¨‹æŠ€æœ¯å­¦ä¼š (IET) çš„ä¸»å¸­ï¼Œå—åˆ°åŒ…æ‹¬å­™è¾ˆåœ¨å†…çš„æ‰€æœ‰äººçš„çˆ±æˆ´ã€‚ å› æ­¤ï¼Œå¦‚æœä½ æ˜¯ä¸€ä½æœ‰æŠ±è´Ÿçš„ç§‘æŠ€ CEOï¼Œæƒ³çŸ¥é“è‡ªå·±åº”è¯¥èµ°å“ªæ¡è·¯ï¼Œç­”æ¡ˆåº”è¯¥æ˜¯æ˜¾è€Œæ˜“è§çš„ã€‚ ä½†è¿™ä¸€è¯¾ä¸ä»…é€‚ç”¨äºé¦–å¸­æ‰§è¡Œå®˜ã€‚å®ƒé€‚ç”¨äºæ¯ä¸€ä¸ªäººã€‚æˆ‘ä»¬ç”Ÿæ´»åœ¨ä¸€ä¸ªå²æ— å‰ä¾‹çš„æ—¶ä»£ï¼Œæ­£æ˜¯è¿™é¡¹æŠ€æœ¯è®©æˆ‘ä»¬èƒ½å¤Ÿä¸åœ°çƒä¸Šçš„æ¯ä¸€ä¸ªäººè¿›è¡Œæ²Ÿé€šï¼Œè€Œç°åœ¨å´æœ‰å¯èƒ½å°†æˆ‘ä»¬åˆ†è£‚æˆäº‰åµç”šè‡³äº¤æˆ˜çš„æ´¾åˆ«ã€‚ç„¶è€Œï¼Œäº‹å®å¹¶éå¦‚æ­¤ã€‚è©¹å§†æ–¯-éŸ¦ä¼¯å¤ªç©ºæœ›è¿œé•œï¼ˆJames Webb Space Telescopeï¼‰ç­‰æœ€è¿‘å–å¾—çš„æˆå°±æ˜¯é€šè¿‡å…¨ä¸–ç•Œå·¥ç¨‹å¸ˆå’Œç§‘å­¦å®¶çš„åˆä½œå®ç°çš„ã€‚ ç½—å®¾-è¨å…‹æ–¯æ¯”çˆµå£«è§£é‡Šè¯´ï¼š â€œç°å®æƒ…å†µæ˜¯ï¼Œçºµè§‚æˆ‘ä»¬çš„æ˜Ÿçƒï¼Œæ¯ä¸ªå›½å®¶éƒ½æ‹¥æœ‰æŸäº›é¢†åŸŸçš„ç²¾è‹±ã€‚åªæœ‰é€šè¿‡åˆä½œï¼Œæˆ‘ä»¬æ‰èƒ½å–å¾—æœ€å¥½çš„ç»“æœã€‚è¿™æ˜¯æœªæ¥çš„å”¯ä¸€å‡ºè·¯â€ã€‚ æˆ‘å®Œå…¨åŒæ„ã€‚","categories":[{"name":"Hardware","slug":"Hardware","permalink":"https://blog.inoki.cc/categories/Hardware/"}],"tags":[{"name":"ç¿»è¯‘","slug":"ç¿»è¯‘","permalink":"https://blog.inoki.cc/tags/ç¿»è¯‘/"},{"name":"ä¸­æ–‡","slug":"ä¸­æ–‡","permalink":"https://blog.inoki.cc/tags/ä¸­æ–‡/"},{"name":"Hardware","slug":"Hardware","permalink":"https://blog.inoki.cc/tags/Hardware/"},{"name":"ARM","slug":"ARM","permalink":"https://blog.inoki.cc/tags/ARM/"}]},{"title":"ã€è¯‘ã€‘ARM çš„å†å²â€”â€”ç¬¬äºŒéƒ¨åˆ†ï¼šä¸€åˆ‡å¼€å§‹èšåœ¨ä¸€èµ·","slug":"History-of-ARM-2","date":"2023-08-22T00:34:00.000Z","updated":"2025-03-08T09:40:48.566Z","comments":true,"path":"2023/08/22/History-of-ARM-2/","link":"","permalink":"https://blog.inoki.cc/2023/08/22/History-of-ARM-2/","excerpt":"","text":"åŸåšå®¢å…±åˆ†ä¸ºä¸‰ç¯‡ï¼ŒåŸæ–‡é“¾æ¥å¦‚ä¸‹ï¼š https://arstechnica.com/gadgets/2022/09/a-history-of-arm-part-1-building-the-first-chip/ https://arstechnica.com/gadgets/2022/11/a-history-of-arm-part-2-everything-starts-to-come-together/ https://arstechnica.com/gadgets/2023/01/a-history-of-arm-part-3-coming-full-circle/ ä»æœ€åˆçš„åäºŒä¸ªäººå’Œä¸€ä¸ªæ¢¦æƒ³ï¼Œåˆ°ç°åœ¨çš„åäº¿ç¾å…ƒå…¬å¸ã€‚ ä»ä¸€å¼€å§‹ï¼Œå°±å¾ˆéš¾æœ‰äººå…³å¿ƒè¿™é¡¹ç¥å¥‡çš„æŠ€æœ¯ã€‚ç¬¬ä¸€æ‰¹ ARM èŠ¯ç‰‡å‡ºè´§å‡ ä¸ªæœˆåï¼ŒAcorn Computers çš„ Steve Furber æ‰“ç”µè¯ç»™ä¸€ä½æŠ€æœ¯è®°è€…ï¼Œè¯•å›¾è®©ä»–æŠ¥é“æ­¤äº‹ã€‚è®°è€…å›ç­”è¯´ï¼šâ€œæˆ‘ä¸ç›¸ä¿¡ä½ ã€‚å¦‚æœä½ ä¸€ç›´åœ¨åšè¿™ä»¶äº‹ï¼Œæˆ‘æ—©å°±çŸ¥é“äº†â€ã€‚ç„¶åä»–å°±æŒ‚æ–­äº†ç”µè¯ã€‚ åœ¨ Acorn è‹¦è‹¦æŒ£æ‰çš„æ—¶å€™ï¼ŒFurber è¯•å›¾æƒ³è±¡å¦‚ä½•å°† ARM èŠ¯ç‰‡åˆ†æ‹†æˆä¸€å®¶ç‹¬ç«‹çš„å…¬å¸ã€‚ä½†ä»–æƒ³ä¸å‡ºå¦‚ä½•è®©å•†ä¸šæ¨¡å¼è¿è½¬èµ·æ¥ã€‚&quot;ä»–åœ¨æ¥å—é‡‡è®¿æ—¶è¯´ï¼š&quot;ä½ å¿…é¡»å–å‡ºæ•°ç™¾ä¸‡é¢—èŠ¯ç‰‡ï¼Œæ‰èƒ½å¼€å§‹æ”¯ä»˜ç‰ˆç¨ã€‚&quot;æˆ‘ä»¬æ— æ³•æƒ³è±¡è¦å–å‡ºæ•°ç™¾ä¸‡ä¸ªè¿™æ ·çš„ä¸œè¥¿ã€‚ å‰æ™¯ä¸€ç‰‡æš—æ·¡â€”â€”ç›´åˆ°å¦ä¸€å®¶ç”µè„‘å…¬å¸çš„ä»£è¡¨èµ°è¿›é—¨æ¥ã€‚è¿™å®¶å°å…¬å¸å«è‹¹æœã€‚ ä¸€å®¶æ–°å…¬å¸ è‹¹æœå…¬å¸æœ€åˆæ˜¯å¦‚ä½•å¬è¯´ ARM çš„ï¼Ÿè‹¹æœå…¬å¸å…ˆè¿›æŠ€æœ¯éƒ¨çš„ä¸¤ä½å·¥ç¨‹å¸ˆ Paul Gavarini å’Œ Tom Pittard åˆ¶ä½œäº†ä¸€å°åä¸º MÃ¶bius çš„åŸå‹è®¡ç®—æœºã€‚å®ƒä½¿ç”¨ ARM2 èŠ¯ç‰‡ï¼ŒåŒæ—¶è¿è¡Œ Apple II å’Œ Macintosh è½¯ä»¶ï¼Œæ¨¡æ‹Ÿ 6502 å’Œ 68000 CPU çš„é€Ÿåº¦æ¯”æœ¬åœ°ç‰ˆæœ¬æ›´å¿«ã€‚è‹¹æœå…¬å¸çš„é«˜å±‚ç®¡ç†è€…å¯¹è¿™å°æœºå™¨æ„Ÿåˆ°å›°æƒ‘ï¼Œå¹¶å¾ˆå¿«å°†å…¶å°æ€ï¼Œä½† Gavarini å’Œ Pittard ä»åœ¨å†…éƒ¨æ¼”ç¤ºä¼šä¸Šå¤§è‚†å®£æ‰¬ ARMï¼Œå¹¶å±•ç¤ºäº†è¿è¡Œ LISP æ—¶ä»¤äººå°è±¡æ·±åˆ»çš„åŸºå‡†æµ‹è¯•ç»“æœã€‚ LISP æ˜¯ä¸€ç§é‡é‡çº§è¯­è¨€ï¼Œè‹¹æœå…¬å¸åœ¨å†…éƒ¨ä½¿ç”¨å®ƒæ¥æµ‹è¯•æ–°çš„å›¾å½¢ç•Œé¢ã€‚ä½†å¯¹äºåµŒå…¥å¼åº”ç”¨è€Œè¨€ï¼ŒLISP è¢«è®¤ä¸ºè¿‡äºç¬¨é‡ã€‚å½“è‹¹æœå…¬å¸çš„èµ„æ·±äººå£«æ‹‰é‡Œ-ç‰¹æ–¯å‹’ï¼ˆLarry Teslerï¼‰çœ‹åˆ°è¿™äº›åŸºå‡†æµ‹è¯•ç»“æœæ—¶ï¼Œä»–çš„è„‘å­é‡Œçµå…‰ä¸€é—ªã€‚ å½“æ—¶ï¼Œç‰¹æ–¯å‹’åˆšåˆšæ¥æ‰‹è‹¹æœç‰›é¡¿é¡¹ç›®ï¼Œä»–éœ€è¦æ›¿æ¢æ‰é€Ÿåº¦æ…¢ã€æ¼æ´å¤šçš„ CPUâ€“AT&amp;T Hobbitã€‚ARM èŠ¯ç‰‡çœ‹èµ·æ¥æ˜¯ä¸ªèµ¢å®¶ã€‚å®ƒä¸ä»…é€Ÿåº¦æƒŠäººï¼Œè€Œä¸”åŠŸè€—æä½ï¼Œæ˜¯æ‰‹æŒç‰›é¡¿è®¾å¤‡çš„ç†æƒ³ä¹‹é€‰ã€‚ ç‰¹æ–¯å‹’å®‰æ’äº†ä¸€æ¬¡ä¸ ARM å›¢é˜Ÿçš„ä¼šé¢ï¼Œä»–å¾ˆå–œæ¬¢ä»–ä»¬çš„è·¯çº¿å›¾ã€‚ä½†æœ‰ä¸€ä¸ªé—®é¢˜ã€‚è‹¹æœæ˜¯ä¸€å®¶è®¡ç®—æœºå…¬å¸ï¼Œè€Œ Acorn æ˜¯å…¶ç›´æ¥ç«äº‰å¯¹æ‰‹ã€‚ è¿™å°±ä¸ºä¸€ä¸ªè‡´å‘½çš„å†³å®šåŸ‹ä¸‹äº†ä¼ç¬”ã€‚ARM çš„å‘˜å·¥å¸Œæœ›æ‘†è„± Acorn æ—¥æ¸è¡°è½çš„å‘½è¿ã€‚Acorn çš„å¤§è‚¡ä¸œå¥¥åˆ©ç»´è’‚å…¬å¸ï¼ˆOlivettiï¼‰åˆ™å¯¹ç”Ÿäº§ IBM PC å…‹éš†æœºæ›´æ„Ÿå…´è¶£ã€‚åˆ¶é€  ARM èŠ¯ç‰‡çš„ç¡…ä»£å·¥å‚ VLSI Technology å¸Œæœ›è·å¾—æ›´å¤šçš„å®¢æˆ·ã€‚è€Œè‹¹æœå…¬å¸åˆ™å¸Œæœ›è·å¾—èŠ¯ç‰‡æˆæƒã€‚åˆ†æ‹† ARM ç¬¦åˆæ‰€æœ‰äººçš„åˆ©ç›Šã€‚ 1990 å¹´ 11 æœˆï¼Œä¸‰æ–¹è¾¾æˆåè®®ã€‚è‹¹æœå…¬å¸æŠ•èµ„ 300 ä¸‡ç¾å…ƒç°é‡‘ï¼Œè·å¾— 30% çš„è‚¡ä»½ã€‚VLSI æŠ•èµ„ 50 ä¸‡ç¾å…ƒï¼Œå¤–åŠ å…¶çŸ¥è¯†å’Œå·¥å…·ã€‚Acorn è½¬è®©å…¶æ‰€æœ‰ ARM çŸ¥è¯†äº§æƒå’Œ 12 åå‘˜å·¥ï¼Œä»·å€¼ 300 ä¸‡ç¾å…ƒã€‚åº”è‹¹æœå…¬å¸çš„è¦æ±‚ï¼Œæ–°å…¬å¸æ›´åä¸º Advanced RISC Machinesã€‚ARM å…¬å¸ä»æ­¤è‡ªç«‹é—¨æˆ·ã€‚ æ–°çš„é¢†å¯¼è€… åœ¨æŠ•å…¥èµ„é‡‘ä¹‹å‰ï¼Œè‹¹æœå¸Œæœ›ä¸º ARM æŒ‘é€‰ä¸€ä½é¦–å¸­æ‰§è¡Œå®˜ã€‚è‹¹æœè˜è¯·äº†æ›¾ç»æ‰¾åˆ°çº¦ç¿°-æ–¯å¡åˆ©ï¼ˆJohn Sculleyï¼‰çš„é‚£å®¶çŒå¤´å…¬å¸ï¼Œä½†è¿™æ¬¡çš„ç»“æœè¦å¥½å¾—å¤šã€‚ä»–ä»¬è˜ç”¨çš„æ˜¯ç½—å®¾-è¨å…‹æ–¯æ¯”ï¼ˆRobin Saxbyï¼‰ã€‚ è¨å…‹æ–¯æ¯” 1947 å¹´å‡ºç”Ÿäºè‹±å›½åˆ‡æ–¯ç‰¹è²å°”å¾·ã€‚ä»–ä»å°å°±å¯¹ç”µæ°”çº¿è·¯ç€è¿·ï¼Œåå‡ å²æ—¶å°±å¼€å§‹äº†è‡ªå·±çš„ç¬¬ä¸€ç¬”ç”Ÿæ„ï¼Œä¿®ç†æ”¶éŸ³æœºå’Œç”µè§†æœºã€‚ä»–è¿›å…¥åˆ©ç‰©æµ¦çš„å¤§å­¦å­¦ä¹ ç”µå­å·¥ç¨‹ã€‚1968 å¹´æ¯•ä¸šåï¼Œä»–çš„ç¬¬ä¸€ä»½å·¥ä½œæ˜¯å¸®åŠ©è®¾è®¡è‹±å›½ç¬¬ä¸€å°æ™¶ä½“ç®¡ç”µè§†æœºã€‚ 1973 å¹´ï¼Œä»–åŠ å…¥æ‘©æ‰˜ç½—æ‹‰å…¬å¸ï¼Œå¹¶å¾ˆå¿«æ™‹å‡ä¸ºé”€å”®å·¥ç¨‹å¸ˆã€‚è¿™æ„å‘³ç€ä»–çš„å·¥ä½œå°±æ˜¯å¥”æ³¢äºå…¬å¸å®¢æˆ·ä¹‹é—´ï¼Œå¸®åŠ©ä»–ä»¬ä½¿ç”¨æ‘©æ‰˜ç½—æ‹‰äº§å“è¿›è¡Œè®¾è®¡ã€‚å½“ä»–è°ƒåˆ°ä¸­å¤®å¤„ç†å™¨éƒ¨é—¨æ—¶ï¼Œä»–ä»¥ä¸ºä»–çš„å®¢æˆ·éƒ½ä¼šæ˜¯ä¸»æµè®¡ç®—æœºå…¬å¸ã€‚ä½†å‡ºä¹ä»–æ„æ–™çš„æ˜¯ï¼Œå¤§å¤šæ•°å¸Œæœ›ä½¿ç”¨æ‘©æ‰˜ç½—æ‹‰ CPU çš„äººéƒ½åœ¨è€ƒè™‘åˆ©åŸºåµŒå…¥å¼åº”ç”¨ã€‚æœ‰ä¸€æ¬¡ï¼Œä»–å†™äº†ä¸€ä»½ææ¡ˆï¼Œå»ºè®®æ‘©æ‰˜ç½—æ‹‰åˆ†æ‹† CPU è®¾è®¡å›¢é˜Ÿå¹¶æä¾›è®¾è®¡æœåŠ¡ï¼Œä½†ç®¡ç†å±‚ä¸å–œæ¬¢è¿™ä¸ªæƒ³æ³•ã€‚ ç¦»å¼€æ‘©æ‰˜ç½—æ‹‰åï¼Œè¨å…‹æ–¯æ¯”åŠ å…¥äº†ä¸€å®¶åä¸º ES2 çš„åˆåˆ›å…¬å¸ï¼Œè¯¥å…¬å¸æ­£è¯•å›¾å¼€å‘ä¸€ç§æ–°çš„ç¡…èŠ¯ç‰‡åˆ¶é€ æŠ€æœ¯ã€‚ES2 æ›¾ä¸º ARM åˆ¶é€ è¿‡ä¸€äº›æµ‹è¯•èŠ¯ç‰‡ï¼Œå› æ­¤è¨å…‹æ–¯æ¯”å¯¹è¿™å®¶å…¬å¸æ—©æœ‰äº†è§£ã€‚ä½†å½“ä»–è¢«é‚€è¯·åŠ å…¥ ARM æ‹…ä»»é¦–ä»»é¦–å¸­æ‰§è¡Œå®˜æ—¶ï¼Œä»–æ€€ç–‘è‡ªå·±æ˜¯å¦æ˜¯æœ€åˆé€‚çš„äººé€‰ã€‚ ä¸ºäº†ç¡®ä¿ä¸‡æ— ä¸€å¤±ï¼Œä»–åœ¨ä¸€å®¶é…’å§ä¸ ARM çš„å‘˜å·¥ä¸¾è¡Œäº†ä¸€æ¬¡åˆé¤ä¼šã€‚å½“æ—¶ï¼Œå…¬å¸ç¼ºä¹é¢†å¯¼åŠ›ã€‚å²è’‚å¤«-ç¦ä¼¯ï¼ˆSteve Furberï¼‰ç¦»å¼€å…¬å¸å»å¯»æ‰¾å…¶ä»–æœºä¼šï¼Œç´¢è²-å¨å°”é€Šï¼ˆSophie Wilsonï¼‰åšå‡ºäº†ä¸€ä¸ª â€œè‰°éš¾çš„å†³å®šâ€ï¼Œç•™åœ¨äº†æ©¡æœå…¬å¸ï¼Œå°½ç®¡å¥¹ä»ç„¶å¯ä»¥æä¾›å’¨è¯¢ã€‚å‰©ä¸‹çš„ 12 å ARM å‘˜å·¥åƒåˆé¥­æ—¶è¿Ÿåˆ°äº†ï¼Œè¨å…‹æ–¯æ¯”å·®ç‚¹ç¦»å¼€ã€‚ä½†æ˜¯ï¼Œå½“ä»–ä»¬åˆ°è¾¾ç›®çš„åœ°æ—¶ï¼Œä¼šè®®å–å¾—äº†åœ†æ»¡æˆåŠŸã€‚æ‰€æœ‰ 12 ä½å·¥ç¨‹å¸ˆä¸€è‡´è®¤ä¸ºï¼Œç½—å®¾-è¨å…‹æ–¯æ¯”æ˜¯æ­£ç¡®çš„é€‰æ‹©ã€‚ å³ä¾¿å¦‚æ­¤ï¼Œä»–è¿˜æ˜¯éœ€è¦ä¸€ç‚¹æ¨åŠ¨åŠ›ã€‚ä»–é—®è‡ªå·± 11 å²çš„å¥³å„¿ï¼Œæ˜¯å¦åº”è¯¥å†’é™©æ¥å—è¿™ä»½æ–°å·¥ä½œã€‚å¥¹è¯´ï¼šâ€œçˆ¸çˆ¸ï¼Œæˆ‘æœ‰ä¸ªéª°å­ï¼Œå¦‚æœä½ æ·å‡ºå…­ç‚¹ï¼Œä½ å°±ä¼šæˆä¸ºç™¾ä¸‡å¯Œç¿ã€‚â€ ä»–æ·äº†å‡ºå»ï¼Œç»“æœæ˜¯å…­ã€‚1991 å¹´åˆï¼Œä»–æˆä¸º ARM å…¬å¸çš„ç¬¬ä¸€ä»»é¦–å¸­æ‰§è¡Œå®˜ã€‚ è‰°éš¾æ¢ç´¢æ—¶æœŸ å…¬å¸é¦–å…ˆéœ€è¦çš„æ˜¯ä¸€ä¸ªå•†ä¸šæ¨¡å¼ã€‚è¨å…‹æ–¯æ¯”é‡æ‹¾æ‘©æ‰˜ç½—æ‹‰çš„æ—§æ–¹æ¡ˆï¼Œå¹¶æ ¹æ® ARM çš„éœ€æ±‚å¯¹å…¶è¿›è¡Œäº†ä¿®æ”¹ã€‚é™¤äº†æ¯å”®å‡ºä¸€å—èŠ¯ç‰‡æ”¶å–ä¸€å®šæ¯”ä¾‹çš„ç‰¹è®¸æƒä½¿ç”¨è´¹å¤–ï¼Œå…¬å¸è¿˜å°†ä»¥é¢„ä»˜è´¹çš„å½¢å¼è·å¾—æŠ€æœ¯è®¸å¯ã€‚ç†è®ºä¸Šï¼Œè¿™æ ·çš„ç»„åˆè¶³ä»¥ç»´æŒå…¬å¸çš„æ­£å¸¸è¿è½¬ã€‚è¨å…‹æ–¯æ¯”ä»ä¸€å¼€å§‹å°±é›„å¿ƒå‹ƒå‹ƒï¼š ä»–å¸Œæœ› ARM æˆä¸º â€œå…¨çƒ RISC æ ‡å‡†â€ã€‚ æå‡ºç›®æ ‡æ˜¯ä¸€å›äº‹ï¼Œä½†å®ç°ç›®æ ‡å´æ˜¯å¦ä¸€å›äº‹ã€‚è®¡ç®—æœºé¢†åŸŸçš„å…¶ä»–å…¬å¸ä¹Ÿçº·çº·åŠ å…¥ RISC çš„è¡Œåˆ—ã€‚IBM äº 1986 å¹´å‘å¸ƒäº† 6150 RTï¼Œéšåæ˜¯ MIPS å’Œæƒ æ™®çš„ PA-RISC ä»¥åŠ SUN çš„ SPARCã€‚æ‘©æ‰˜ç½—æ‹‰å…¬å¸äº 1988 å¹´æ¨å‡ºäº† 88000ï¼Œè‹±ç‰¹å°”å…¬å¸äº 1989 å¹´å‘å¸ƒäº† i860 å’Œ i960ï¼ŒDEC å…¬å¸ä¹Ÿåœ¨å¼€å‘ Alpha èŠ¯ç‰‡ã€‚åªä¸å…¶ä¸­ä¸€å®¶å·¨å¤´ç«äº‰æ˜¯å¾ˆå›°éš¾çš„ã€‚å‡»è´¥æ‰€æœ‰è¿™äº›å…¬å¸ä¼¼ä¹æ˜¯ä¸å¯èƒ½çš„ã€‚ ä½†è¿™äº›å…¬å¸å¤§å¤šä½¿ç”¨ RISC åˆ¶é€ é«˜ç«¯å°å¼å·¥ä½œç«™ã€‚è¨å…‹æ–¯æ¯”è®°å¾—ï¼Œåœ¨æ‘©æ‰˜ç½—æ‹‰å·¥ä½œæœŸé—´ï¼ŒåµŒå…¥å¼åº”ç”¨æ˜¯ä¸€ä¸ªè¢«å¿½è§†çš„å¸‚åœºã€‚ä¹Ÿè®¸å…¨çƒ RISC æ ‡å‡†ç°åœ¨è¿˜é¥ä¸å¯åŠï¼Œä½†å…¨çƒåµŒå…¥å¼ RISC æ ‡å‡†æ˜¯å¯ä»¥å®ç°çš„ã€‚ä¸ç«äº‰å¯¹æ‰‹ç›¸æ¯”ï¼ŒARM èŠ¯ç‰‡çš„æ™¶ä½“ç®¡æ•°é‡æ›´å°‘ï¼Œè€—ç”µé‡æ›´ä½ã€‚è¿™ä½¿å¾—å®ƒä»¬çš„åˆ¶é€ æˆæœ¬æ›´ä½ï¼Œé€‚ç”¨äºæ›´å¹¿æ³›çš„åº”ç”¨ã€‚ ä¸€äº›é¦–æ‰¹è®¸å¯è¯ç”¨äºä¼ çœŸè°ƒåˆ¶è§£è°ƒå™¨å’Œå…¶ä»–å°å‹åº”ç”¨ã€‚åˆ›ä¸šåˆæœŸï¼Œèµ„é‡‘ååˆ†ç´§å¼ ã€‚Acorn åŸæœ¬å‘åˆ›å§‹å·¥ç¨‹å¸ˆä»¬æ‰¿è¯ºï¼Œä»–ä»¬å°†åœ¨ç¬¬äºŒå¹´è·å¾—åŠ è–ªï¼Œä½†åˆ°äº† 1991 å¹´ï¼ŒARM çš„èµ„é‡‘å·²ç»å‘Šç½„ã€‚è¨å…‹æ–¯æ¯”è¯´ï¼Œå¦‚æœå…¬å¸èƒ½å¾—åˆ°ä¸€ä»½æ–°çš„å¤§åˆåŒï¼Œä»–å°±ä¼šå…‘ç°è¿™ä¸ªæ‰¿è¯ºã€‚ä»–ä¸è‹±å›½å›½é˜²æ‰¿åŒ…å•†æ™®è±è¥¿å…¬å¸ç­¾è®¢äº†åè®®ï¼Œå¹¶ç»™å·¥ç¨‹å¸ˆä»¬è¿½æº¯åŠ è–ªã€‚ å…¬å¸çš„ç¬¬ä¸€ä¸ªæ–°äº§å“æ˜¯ ARM6 å†…æ ¸ï¼Œå®ƒæ˜¯ ARM3 çš„åç»§äº§å“ï¼Œé‡‡ç”¨ 0.8 å¾®ç±³å·¥è‰ºåˆ¶é€ ï¼Œè¿è¡Œé¢‘ç‡ä¸º 20 MHzã€‚æ ¹æ®é™ä½æŒ‡ä»¤é›†å¤æ‚åº¦çš„ç†å¿µï¼Œå®ƒåªæœ‰ä¸¤æ¡æ–°æŒ‡ä»¤ã€‚å†…æ ¸æœ¬èº«åªæœ‰ 35,000 ä¸ªæ™¶ä½“ç®¡ï¼Œæ¯”æœ€åˆ ARM çš„ 27,000 ä¸ªæ™¶ä½“ç®¡å¤šä¸äº†å¤šå°‘ã€‚ï¼ˆç›¸æ¯”ä¹‹ä¸‹ï¼Œè‹±ç‰¹å°”çš„ 386 æœ‰ 275,000 ä¸ªæ™¶ä½“ç®¡ï¼ï¼‰å¯¹äºç‰›é¡¿ï¼ŒARM å°†è¯¥å†…æ ¸ä¸å†…å­˜ç®¡ç†å•å…ƒå’Œ 4 KB çš„ä¸€çº§é«˜é€Ÿç¼“å­˜æ‰“åŒ…åœ¨ä¸€èµ·ã€‚è¿™å°±æ˜¯ ARM610ã€‚ ä¸æ­¤åŒæ—¶ï¼Œè¯¥å…¬å¸è¿˜æ¨å‡ºäº† ARM250ã€‚å®ƒé‡‡ç”¨äº†è¾ƒæ—©çš„ ARM3 å†…æ ¸ï¼Œä½†ä¹ŸåŒ…å«äº†é˜¿åŸºç±³å¾·è®¡ç®—æœºä¸­çš„æ‰€æœ‰æ”¯æŒèŠ¯ç‰‡ï¼šå†…å­˜æ§åˆ¶å™¨ã€I/O èŠ¯ç‰‡å’Œè§†é¢‘èŠ¯ç‰‡ã€‚è¿™æ˜¯ä¸€æ¬¾çœŸæ­£çš„ â€œç‰‡ä¸Šç³»ç»Ÿâ€ï¼Œæˆ–ç§° SoCã€‚åœ¨å½“æ—¶ï¼Œé™¤äº†ä½¿é˜¿åŸºç±³å¾·è®¡ç®—æœºçš„åˆ¶é€ æˆæœ¬æ›´ä½ä¸€äº›å¤–ï¼Œå®ƒå¹¶æ²¡æœ‰å¤ªå¤§çš„å¸‚åœºã€‚ä½†å®ƒä¸ºæœªæ¥çš„å‘å±•åŸ‹ä¸‹äº†ä¼ç¬”ã€‚ 1993 å¹´ï¼Œè‹¹æœå…¬å¸ç»ˆäºå‘å¸ƒäº†æ‹–å»¶å·²ä¹…çš„ç‰›é¡¿ã€‚ç¬¬ä¸€å¹´ï¼Œå®ƒå–å‡ºäº† 6 ä¸‡å°ã€‚å¯¹äºè‹¹æœè¿™æ ·çš„å¤§å…¬å¸æ¥è¯´ï¼Œè¿™è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªå·¨å¤§çš„å¤±è´¥ã€‚ä½†å¯¹ ARM æ¥è¯´ï¼Œæ¯å—èŠ¯ç‰‡ 20 ç¾å…ƒçš„ç‰¹è®¸æƒä½¿ç”¨è´¹æ˜¯ä¸€ç¬”æ„å¤–ä¹‹è´¢ã€‚è¨å…‹æ–¯æ¯”å°†è¿™ç¬”ç°é‡‘æŠ•èµ„å› ARM å…¬å¸ï¼Œä½¿å…¬å¸è§„æ¨¡æ‰©å¤§äº†ä¸€å€ï¼Œå‘˜å·¥äººæ•°ä» 30 äººå¢åŠ åˆ° 60 äººã€‚è¿™æ˜¯ä¸€åœºèµŒåšã€‚è¦æƒ³æˆåŠŸï¼ŒARM éœ€è¦èµ¢å¾—ä¸€äº›é‡è¦çš„æˆæƒã€‚ è¯´æœå¤§å…¬å¸ ä½œä¸ºä¸€å®¶å°å…¬å¸ï¼Œæœ‰æ—¶å¾ˆéš¾ä¸å¤§å…¬å¸æ‰“äº¤é“ã€‚åœ¨ä¸å‰é›‡ä¸»æ‘©æ‰˜ç½—æ‹‰å…¬å¸çš„ä¸€æ¬¡ä¼šè°ˆä¸­ï¼Œè¨å…‹æ–¯æ¯”å›å¿†è¯´ï¼Œé«˜ç®¡æœ€åè¯´ï¼š&quot;å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿä¸ä¼šå‘ä½ ä»¬æ”¯ä»˜ä»»ä½•è®¸å¯è´¹æˆ–ç‰ˆç¨ã€‚è¯¥å…¬å¸å¸Œæœ› ARM ä¹æ„ä»¥ &quot;æ›å…‰ &quot;çš„æ–¹å¼è·å¾—æŠ¥é…¬ï¼Œå› ä¸ºæ‘©æ‰˜ç½—æ‹‰æœ¬å¯ä»¥è‡ªå·±å®Œæˆè¿™é¡¹å·¥ä½œã€‚è¨å…‹æ–¯æ¯”é—®è¿™ä½é«˜ç®¡æœ‰å¤šå°‘å·¥ç¨‹å¸ˆåœ¨åšè¿™ä¸ªé¡¹ç›®ã€‚ç­”æ¡ˆæ˜¯å¤§çº¦ 200 äººã€‚&quot;è¨å…‹æ–¯æ¯”é—®ï¼šâ€œä½ çŸ¥é“å—ï¼Œä½ ä»˜ç»™æˆ‘ä»¬çš„è®¸å¯è´¹æ˜¯ä½ ä»˜ç»™å·¥ç¨‹å¸ˆçš„å››åˆ†ä¹‹ä¸€ã€‚â€ ä»–è¿˜æ˜¯æ‹’ç»ç»™ ARM é’±ï¼Œè¨å…‹æ–¯æ¯”ä¹Ÿå°±æ”¾å¼ƒäº†è¿™ç¬”äº¤æ˜“ã€‚ å¾·å·ä»ªå™¨å…¬å¸ï¼ˆTexas Instrumentsï¼‰æ˜¯å¦ä¸€å®¶è®¤ä¸ºå‡­å€Ÿè‡ªå·±çš„å†…éƒ¨èµ„æºå¯ä»¥æ¯” ARM åšå¾—æ›´å¥½çš„å…¬å¸ã€‚å½“å¾·å·ä»ªå™¨å…¬å¸ CPU éƒ¨é—¨çš„è´Ÿè´£äººå‘ä»–çš„è€æ¿ç”³è¯· ARM çš„è®¸å¯è¯æ—¶ï¼Œä»–å›å‡»é“ï¼š&quot;ä½ æ˜¯åœ¨å‘Šè¯‰æˆ‘ï¼Œæˆ‘ä»¬å¯ä»¥åšå¾—æ›´å¥½ï¼š &quot;ä½ æ˜¯åœ¨å‘Šè¯‰æˆ‘ï¼Œåœ¨è®¾è®¡åµŒå…¥åŸºå¸¦èŠ¯ç‰‡çš„å¾®å¤„ç†å™¨å†…æ ¸æ–¹é¢ï¼Œæˆ‘ä»¬ç”šè‡³æ— æ³•ä¸å…¶ä»–å…¬å¸ç«äº‰ï¼Ÿåæ¥ï¼Œåœ¨ä¸€æ¬¡è®¨è®ºæ½œåœ¨åˆä½œå…³ç³»çš„ä¼šè®®ä¸Šï¼Œå¾·å·ä»ªå™¨çš„äººåœ¨æ²¡æœ‰ç­¾ç½²ä¿å¯†åè®®çš„æƒ…å†µä¸‹å°±æ¥äº†ã€‚è¨å…‹æ–¯æ¯”åšæŒè¦ä»–ä»¬ç«‹å³ç¦»å¼€ï¼Œç­‰ç­¾äº†å­—å†å›æ¥ã€‚ARM å…¬å¸è§„æ¨¡è™½å°ï¼Œä½†è¨å…‹æ–¯æ¯”ä¸ä¼šè®©å…¬å¸è¢«äººæ‘†å¸ƒã€‚ å¾·å·ä»ªå™¨çŠ¹è±«å†ä¸‰ï¼Œæœ€ç»ˆå†³å®šå°† ARM ä»‹ç»ç»™å…¶æœ€å¤§çš„å®¢æˆ·ä¹‹ä¸€ï¼š è¯ºåŸºäºšã€‚è¿™æ˜¯ä¸€æ¬¡æµ‹è¯•ã€‚å¦‚æœ ARM èƒ½è¯´æœè¯ºåŸºäºšä½¿ç”¨å…¶è®¾è®¡ï¼Œé‚£ä¹ˆ TI å°±èƒ½åˆ¶é€ å‡ºè¶³å¤Ÿå¥½çš„äº§å“ã€‚ 1993 å¹´ï¼Œè¯ºåŸºäºšå·²ç»æˆä¸ºç§»åŠ¨ç”µè¯é¢†åŸŸä¸€é¢—å†‰å†‰å‡èµ·çš„æ–°æ˜Ÿï¼Œä¸Šä¸€å¹´çš„æ‰‹æœºé”€é‡å°±è¾¾åˆ°äº† 300 ä¸‡éƒ¨ã€‚è¯ºåŸºäºšä¸ºå…¶æ–°æœºå‹åˆ¶å®šäº†å®ä¼Ÿçš„è®¡åˆ’ï¼Œä½†è¯¥å…¬å¸å¯¹ä½¿ç”¨ 16 ä½æ—¥ç«‹ H8 CPUï¼ˆä¼ ç»Ÿçš„ CISC èŠ¯ç‰‡ï¼‰æ„Ÿåˆ°éå¸¸æ»¡æ„ã€‚32 ä½ RISC èŠ¯ç‰‡åœ¨é€Ÿåº¦å’Œæ•ˆç‡ä¸Šéƒ½æœ‰å¾ˆå¤§çš„é£è·ƒï¼Œä½†ä»£ä»·æ˜¯åŒç­‰ä»£ç éœ€è¦æ›´å¤šçš„æŒ‡ä»¤ï¼Œè€Œä¸”æ¯æ¡æŒ‡ä»¤éœ€è¦ä¸¤å€çš„å†…å­˜ã€‚åœ¨å°å¼æœºä¸Šï¼Œè¿™ç§é¢å¤–çš„å†…å­˜éœ€æ±‚å¹¶ä¸æ˜¯ä»€ä¹ˆå¤§é—®é¢˜ï¼Œä½†æ‰‹æœºçš„å†…å­˜å’Œå­˜å‚¨ç©ºé—´å´å¾ˆå°ã€‚ åœ¨ä¸è¯ºåŸºäºšä¼šé¢åå›å®¶çš„é£æœºä¸Šï¼ŒARM å·¥ç¨‹å¸ˆä»¬å†³å®šï¼Œå¦‚æœè¯ºåŸºäºšæƒ³è¦ 16 ä½ï¼Œé‚£ä¹ˆ 16 ä½å°±æ˜¯è¯ºåŸºäºšè¦å¾—åˆ°çš„ã€‚ä»–ä»¬åˆ›å»ºäº†ä¸€å¥—å…¨æ–°çš„ç®€åŒ– 16 ä½æŒ‡ä»¤ï¼Œå¹¶è®¾è®¡äº†å°†å…¶æ˜ å°„åˆ°ç°æœ‰ 32 ä½æŒ‡ä»¤é›†çš„ç”µè·¯ã€‚è¿™æ ·ï¼Œä½ å°±å¯ä»¥æ‹¥æœ‰å ç”¨å†…å­˜æ›´å°‘çš„è¾ƒå°ç¨‹åºä»£ç ï¼Œä½†è¿è¡Œé€Ÿåº¦å‡ ä¹æ˜¯å®Œå…¨ 16 ä½èŠ¯ç‰‡çš„ä¸¤å€ã€‚å·¥ç¨‹å¸ˆä»¬å¼€ç©ç¬‘åœ°ç§°è¿™äº›æ‰©å±•ä¸º â€œæ‹‡æŒ‡â€ï¼Œå› ä¸ºæ‹‡æŒ‡æ˜¯æ‰‹è‡‚æœ«ç«¯çš„ä¸œè¥¿ã€‚è¿™ä¸ªåå­—å°±è¿™æ ·æ²¿ç”¨äº†ä¸‹æ¥ã€‚ å½“è¯ºåŸºäºšçš„å·¥ç¨‹å¸ˆä»¬çœ‹åˆ° Thumb æ¶æ„çš„è®¡åˆ’ä»¥åŠä¸ä¹‹é…å¥—çš„æ›´å…ˆè¿›çš„ ARM7 å†…æ ¸æ—¶ï¼Œä»–ä»¬éå¸¸å…´å¥‹ã€‚TI æ„è¯†åˆ°ï¼Œè¿™å®¶è‹±å›½å°å…¬å¸å·²ç»é€šè¿‡äº†è€ƒéªŒï¼Œå¹¶æœ€ç»ˆäº 1994 å¹´è·å¾—äº† ARM è®¸å¯è¯ã€‚ç°åœ¨ï¼ŒTI å¯ä»¥ä¸ºæ–°ä¸€ä»£è¯ºåŸºäºšæ‰‹æœºåˆ¶é€ å…ˆè¿›çš„èŠ¯ç‰‡ã€‚ å…¶ä¸­ç¬¬ä¸€æ¬¾æ‰‹æœºè¯ºåŸºäºš 8110 æ˜¯ç¬¬ä¸€æ¬¾é‡‡ç”¨ ARM å†…æ ¸çš„ GSM æ‰‹æœºã€‚å‡ å¹´åï¼Œå®ƒå› å‡ºç°åœ¨ç”µå½±ã€Šé»‘å®¢å¸å›½ã€‹ä¸­è€Œå£°åé¹Šèµ·ã€‚ å‹‡å¾€ç›´å‰ ä¸ TI è¾¾æˆäº¤æ˜“åï¼ŒARM å°±å†ä¹Ÿæ²¡æœ‰å›å¤´ã€‚ç°åœ¨ï¼Œè¯¥å…¬å¸åœ¨ç”µå­è¡Œä¸šæ‹¥æœ‰äº†çœŸæ­£çš„ä¿¡èª‰ã€‚å®ƒä¸å¤æ™®ã€ä¸‰æ˜Ÿå’Œ NEC ç­¾è®¢äº†åè®®ã€‚åˆ° 1995 å¹´ï¼Œå…¬å¸çš„æˆæƒå®¢æˆ·å·²è¾¾ 10 å®¶ã€‚ ARM7 ä¸€ç‚®æ‰“å“ã€‚è¯¥ CPU é‡‡ç”¨ 0.35 å¾®ç±³å·¥è‰ºåˆ¶é€ ï¼Œè¿è¡Œé€Ÿåº¦é«˜è¾¾ 66 Mhzã€‚Thumb æ‰©å±•å¯¹äºç§»åŠ¨åº”ç”¨æˆ–ä»£ç å¯†åº¦éå¸¸é‡è¦çš„ä»»ä½•åœ°æ–¹éƒ½å¾ˆæœ‰ç”¨ï¼Œä½†è¯¥èŠ¯ç‰‡ä¹Ÿå¯ä»¥å…¨é€Ÿè¿è¡Œ 32 ä½ä»£ç ã€‚1996 å¹´ï¼Œåˆæœ‰å››å®¶å…¬å¸è´­ä¹°äº† ARM è®¸å¯è¯ï¼š Okiã€Alcatelã€Yamaha å’Œ Rohmã€‚ç”šè‡³è¿æ‘©æ‰˜ç½—æ‹‰å…¬å¸ä¹Ÿåœ¨ç¬¬äºŒå¹´ç­¾è®¢äº†åè®®ã€‚ ä¸ºä»€ä¹ˆè¿™ä¹ˆå¤šå…¬å¸ï¼ŒåŒ…æ‹¬å·²ç»ç”Ÿäº§è‡ªå·±èŠ¯ç‰‡çš„å¤§å‹ç”µå­å…¬å¸ï¼Œéƒ½æƒ³ä¸ ARM ç­¾è®¢åè®®å‘¢ï¼Ÿéƒ¨åˆ†åŸå› æ˜¯æˆæœ¬ä¼˜åŠ¿â€“ARM è®¸å¯è¯çš„ä»·æ ¼å¹¶ä¸æ˜‚è´µï¼Œè€Œä¸”è‚¯å®šæ¯”æ”¯ä»˜æ•°ç™¾åå·¥ç¨‹å¸ˆæ•°å¹´æ—¶é—´ä»å¤´å¼€å§‹è®¾è®¡æ–°èŠ¯ç‰‡è¦ä¾¿å®œã€‚å¦ä¸€éƒ¨åˆ†åŸå› æ˜¯ç´¢è²-å¨å°”é€Šå’Œå²è’‚å¤«-ç¦ä¼¯åˆ›é€ çš„æŠ€æœ¯é—äº§ã€‚ARM èŠ¯ç‰‡é€Ÿåº¦å¿«ã€æ˜“äºåˆ¶é€ ã€è€—ç”µé‡ä½ã€‚ ä½†æ˜¯ï¼ŒARM çš„å¦ä¸€å¼ ç‹ç‰Œæ˜¯ï¼šå®ƒä¸ä»…ä»…æ˜¯ä¸€å®¶èŠ¯ç‰‡åˆ¶é€ å…¬å¸ã€‚å½“ ARM ä¸å…¶ä»–å…¬å¸åˆä½œæ—¶ï¼Œå®ƒæˆä¸ºåˆä½œä¼™ä¼´ï¼Œå¸®åŠ©è®¾è®¡å¯æ ¹æ®å…¶ä»–å…¬å¸ç‰¹å®šéœ€æ±‚å®šåˆ¶çš„è§£å†³æ–¹æ¡ˆã€‚ä¸ºè¯ºåŸºäºšå‘æ˜æ‹‡æŒ‡æ‰©å±•åªæ˜¯å…¶ä¸­ä¸€ä¸ªä¾‹å­ã€‚ARM è¿˜ä¸æ•°å­—è®¾å¤‡å…¬å¸åˆä½œå¼€å‘äº† StrongARMï¼Œè¿™æ˜¯ä¸€ç§é€Ÿåº¦æ›´å¿«çš„èŠ¯ç‰‡ï¼Œè¿è¡Œé€Ÿåº¦é«˜è¾¾ 233 MHzã€‚è¿™äº›åŠŸèƒ½å¼ºå¤§çš„èŠ¯ç‰‡æœ€ç»ˆè¢«åº”ç”¨äºè‹¹æœ MessagePad 2000ï¼ˆæ”¹è¿›ç‰ˆç‰›é¡¿ï¼‰ã€Eidos Optima è§†é¢‘ç¼–è¾‘å·¥ä½œç«™å’Œ Acorn Computers æœ€æ–°çš„ RISC PCï¼ˆé˜¿åŸºç±³å¾·ç³»åˆ—çš„æ–°åç§°ï¼‰ã€‚ å¯¹äºç½—å®¾-è¨å…‹æ–¯æ¯”æ¥è¯´ï¼Œä¸ç«äº‰å¯¹æ‰‹çš„èŠ¯ç‰‡å…¬å¸åˆä½œå§‹ç»ˆæ˜¯æˆ˜ç•¥çš„ä¸€éƒ¨åˆ†ã€‚ä»–å¸¸è¯´ï¼šâ€œåŒ–æ•Œä¸ºå‹â€ã€‚â€œå¦‚æœä»–ä»¬èƒ½é€šè¿‡ä¸ä½ åˆä½œä¸ºè‡ªå·±èµšæ›´å¤šçš„é’±ï¼Œä¸ºä»€ä¹ˆè¿˜è¦ä¸ä½ å¯¹æŠ—å‘¢ï¼Ÿâ€ è¿™ç§æ„Ÿè§‰å……æ–¥ç€æ•´ä¸ªå…¬å¸ã€‚åœ¨æ¥å— Ars é‡‡è®¿æ—¶ï¼ŒARM å…¬å¸çš„ä¸€ä½å‘è¨€äººè§£é‡Šäº†è¿™ä¸€ç‚¹ï¼š â€œARMçš„å•†ä¸šæ¨¡å¼æ˜¯ä¸€ç§ä»¥æˆåŠŸä¸ºåŸºç¡€çš„å•†ä¸šæ¨¡å¼ï¼Œå…¶ç†å¿µæ˜¯ï¼šåˆä½œä¼™ä¼´æˆåŠŸï¼ŒARMæ‰ä¼šæˆåŠŸã€‚â€ åœ¨ç»å†äº†ç¼“æ…¢çš„èµ·æ­¥ä¹‹åï¼Œè¯¥å…¬å¸ç°åœ¨æ­£åœ¨è¯æ˜è¿™ä¸ä»…ä»…æ˜¯ä¸€ä¸ªå´‡é«˜çš„ç†æƒ³ã€‚å®ƒæ­£åœ¨å‘æŒ¥ä½œç”¨ã€‚ ä½†æ˜¯ï¼ŒARM å…¬å¸ä»ç„¶å¿…é¡»å…·æœ‰æˆ˜ç•¥çœ¼å…‰ã€‚å½“ LSI åŠå¯¼ä½“å…¬å¸å‘å…¬å¸ç”³è¯·è®¸å¯è¯æ—¶ï¼Œè¨å…‹æ–¯æ¯”æ‹’ç»äº†ï¼Œå°½ç®¡é¦–å¸­æ‰§è¡Œå®˜ç»™äº†ä»–ä¸€å¤§ç¬”é’±ã€‚ä»–è¿™æ ·åšæ˜¯å› ä¸º LSI å°†ä¸ ARM çš„åˆ¶é€ åˆä½œä¼™ä¼´ VLSI ç›´æ¥ç«äº‰ã€‚ç›¸åï¼Œä»–è¦æ±‚ LSI çš„é¦–å¸­æ‰§è¡Œå®˜å…ˆç»™ä»–ä»¬å¸¦æ¥ä¸€äº›æ–°ä¸šåŠ¡ï¼Œç„¶åä»–å†é‡æ–°è€ƒè™‘ã€‚ç»“æœï¼Œä»–å¾—åˆ°äº†ç¡¬ç›˜å…¬å¸è¥¿éƒ¨æ•°æ®ï¼ˆWestern Digitalï¼‰çš„æŠ¥ä»·ã€‚æ¯ä¸€ç¬”äº¤æ˜“éƒ½æœ‰æœ›æ‰©å¤§å¸‚åœºï¼Œå¹¶å¸®åŠ© ARM æˆä¸ºæ ‡å‡†ã€‚ ä¸Šå¸‚ åˆ° 1998 å¹´ï¼ŒARM å…¬å¸çš„è§„æ¨¡å·²ç»è¶…è¿‡äº†åŸæ¥çš„è°·ä»“ã€‚å…¬å¸æ‹¥æœ‰ 274 åå‘˜å·¥ï¼Œä¸Šä¸€å¹´çš„æ”¶å…¥ä¸º 4,400 ä¸‡ç¾å…ƒï¼Œåˆ©æ¶¦è¶…è¿‡ 800 ä¸‡ç¾å…ƒï¼ŒARM å¤„ç†å™¨çš„å‡ºè´§é‡æ¥è¿‘ 1,000 ä¸‡å°ã€‚ARM è¿˜ä¸æ˜¯å…¨çƒ RISC æ ‡å‡†â€“ä¸»è¦ç”±äºç´¢å°¼ PlayStation çš„å‡ºç°ï¼ŒMIPS å·²ç»æ‘˜å¾—æ¡‚å† â€“ä½†å®ƒå·²ç»è¶…è¶Šè‹±ç‰¹å°”çš„ i960 å’Œæ‘©æ‰˜ç½—æ‹‰çš„ PowerPCï¼Œä½å±…ç¬¬ä¸‰ã€‚å®ƒä¹Ÿæ˜¯æ‰€æœ‰ RISC èŠ¯ç‰‡ä¾›åº”å•†ä¸­å¢é•¿æœ€å¿«çš„ã€‚ æ‰€æœ‰è¿™äº›ç§¯æçš„å¢é•¿ä½¿å…¬å¸è¿æ¥äº†ä¸Šå¸‚çš„å¥½æ—¶æœºã€‚1998 å¹´ 4 æœˆ 17 æ—¥ï¼Œå…¬å¸åœ¨ä¼¦æ•¦è¯åˆ¸äº¤æ˜“æ‰€å’Œçº³æ–¯è¾¾å…‹æˆåŠŸè¿›è¡Œäº†é¦–æ¬¡å…¬å¼€å‹Ÿè‚¡ï¼ˆIPOï¼‰ã€‚è‚¡ç¥¨çš„åˆå§‹ä»·æ ¼ä¸º 5.75 è‹±é•‘ï¼Œç•¥ä½äº 10 ç¾å…ƒã€‚åŒå¹´æ™šäº›æ—¶å€™ï¼Œå½“ ARM å…¬å¸æŠ¥å‘Šå·²å”®å‡º 5100 ä¸‡ä¸ªå¤„ç†å™¨æ—¶ï¼Œè‚¡ä»·ä¸€é£å†²å¤©ã€‚ARM å…¬å¸ä» 12 ä¸ªäººå’Œä¸€ä¸ªæ¢¦æƒ³èµ·æ­¥ï¼Œå¦‚ä»Šå·²æˆä¸ºä¸€å®¶å¸‚å€¼åäº¿ç¾å…ƒçš„å…¬å¸ã€‚ ARM å…¬å¸çš„ä¸¤ä½åˆ›å§‹æŠ•èµ„è€…å´é€‰æ‹©äº†ç›¸åçš„æ–¹å‘ã€‚è‹¹æœå…¬å¸åœ¨ 1997 å¹´äºæŸè¶…è¿‡ 10 äº¿ç¾å…ƒï¼Œå…¶è¿è¥ç°é‡‘ä¹Ÿè¶Šæ¥è¶Šå°‘ï¼Œæƒ…å†µååˆ†å±é™©ã€‚ä» ARM é¦–æ¬¡å…¬å¼€å‹Ÿè‚¡çš„ç¬¬äºŒå¤©å¼€å§‹ï¼Œè‹¹æœå…¬å¸æŠ›å”®äº†å¤§éƒ¨åˆ†è‚¡ä»½ï¼ŒæŒè‚¡æ¯”ä¾‹ä» 42.3% é™è‡³ 6% ä»¥ä¸‹ã€‚è¿™æ¬¡å¥—ç°å¸®åŠ©å²è’‚å¤«-ä¹”å¸ƒæ–¯åœ¨å…³é”®æ—¶åˆ»ç¨³å®šäº†å…¬å¸ã€‚ Acorn ä¹Ÿåœ¨è‹¦è‹¦æŒ£æ‰ã€‚åœ¨é”€å”®æŒç»­ä¸‹æ»‘åï¼Œå…¬å¸æ”¾å¼ƒäº† RISC PC çš„å¼€å‘ï¼Œå¹¶å–æ¶ˆäº†æœ€åä¸€æ¬¾&quot;Phoebe&quot;æœºå‹ï¼Œåªç•™ä¸‹å…¶ç‹¬ç‰¹çš„é»„è‰²å¤–å£³ã€‚å…¬å¸çš„èµ„æœ¬ä»·å€¼ä¸€åº¦ä½äºå…¶æŒæœ‰çš„ 24% ARM è‚¡ä»½ã€‚Acorn å‡ºå”®äº†è‚¡ç¥¨ï¼Œå¹¶ç”¨è¿™ç¬”é’±è¿›è¡Œäº†å†èèµ„å’Œå…¬å¸é‡ç»„ã€‚ 1999 å¹´ï¼Œå…¬å¸æ›´åä¸º â€œElement 14â€ï¼Œå¹¶å°†é‡ç‚¹è½¬å‘å¼€å‘ç”µä¿¡äº§å“ã€‚ åœ¨ ARM æˆåŠŸçš„æ¨åŠ¨ä¸‹ï¼ŒVLSI æŠ€æœ¯å…¬å¸ç»§ç»­å‘å±•å£®å¤§ã€‚1999 å¹´ 6 æœˆï¼Œè¯¥å…¬å¸è¢«é£åˆ©æµ¦ç”µå­å…¬å¸ä»¥ 10 äº¿ç¾å…ƒçš„ä»·æ ¼æ”¶è´­ã€‚ ä¸æ–­å˜åŒ–çš„ä¸–ç•Œ ARM æœ€åˆåªæ˜¯ä¸€ä¸ªç–¯ç‹‚çš„æ¢¦æƒ³ã€‚æ—©åœ¨ 1985 å¹´ï¼ŒSophie Wilson å’Œ Steve Furber ç ”ç©¶äº†è®¸å¤šç°æœ‰çš„ CPUï¼Œå‘ç°å®ƒä»¬éƒ½ä¸å°½å¦‚äººæ„ã€‚ä»¤äººéš¾ä»¥ç½®ä¿¡çš„æ˜¯ï¼Œä»–ä»¬å¸¦é¢†ä¸€ä¸ª 10 äººå›¢é˜Ÿï¼Œä»é›¶å¼€å§‹å¼€å‘å‡ºäº†å…ˆè¿›çš„ 32 ä½ RISC CPUï¼Œä»æƒ³æ³•åˆ°å·¥ä½œç¡…ç‰‡åªç”¨äº† 18 ä¸ªæœˆã€‚ æœ€åˆï¼Œä»–ä»¬çš„æƒ³æ³•æ˜¯åˆ©ç”¨è¿™äº›ä»¤äººæƒŠå¹çš„ä¸­å¤®å¤„ç†å™¨ï¼Œåˆ¶é€ å‡ºä¼˜ç§€çš„ä¸ªäººç”µè„‘ï¼Œä»è€Œå é¢†ä¸–ç•Œã€‚ä½†æ˜¯ï¼Œä¸–ç•Œå·²ç»å‘ç”Ÿäº†å˜åŒ–ï¼Œå†ä¹Ÿå®¹ä¸ä¸‹æ–°çš„ã€ä¸å…¼å®¹çš„è®¡ç®—æœºå¹³å°äº†ã€‚ç›¸åï¼Œç”±äºè‹¹æœå…¬å¸ã€VLSI å’Œç½—å®¾-è¨å…‹æ–¯æ¯”çš„è¿œè§å“è¯†ï¼ŒARM èŠ¯ç‰‡å‘ç°è‡ªå·±å¯ä»¥è‡ªç”±åœ°å»ä»»ä½•æœ€éœ€è¦å®ƒçš„åœ°æ–¹ã€‚åœ¨æ¥ä¸‹æ¥çš„åå¹´é‡Œï¼Œä»ä¼ çœŸè°ƒåˆ¶è§£è°ƒå™¨åˆ°ç¡¬ç›˜é©±åŠ¨å™¨å†åˆ°ç§»åŠ¨ç”µè¯ï¼Œå„ç§å°å‹è®¾å¤‡éƒ½éœ€è¦å®ƒã€‚ ä½†éšç€æ–°åƒå¹´çš„åˆ°æ¥ï¼Œè¿™äº›å°å‹è®¾å¤‡çš„åŠŸèƒ½è¶Šæ¥è¶Šå¼ºå¤§ã€‚è™½ç„¶ç‰›é¡¿ï¼ˆNewtonï¼‰å¤±è´¥äº†ï¼Œä½†é€šç”¨ä¸ªäººæ•°å­—åŠ©ç†å¸‚åœºæ­£åœ¨è“¬å‹ƒå‘å±•ï¼Œç§»åŠ¨ç”µè¯æœ¬èº«ä¹Ÿå¼€å§‹å…·å¤‡ç±»ä¼¼ PDA çš„åŠŸèƒ½ã€‚è¿™ä¸º ARM å¸¦æ¥äº†æœ€å¤§çš„æœºé‡å’ŒæŒ‘æˆ˜ã€‚","categories":[{"name":"Hardware","slug":"Hardware","permalink":"https://blog.inoki.cc/categories/Hardware/"}],"tags":[{"name":"ç¿»è¯‘","slug":"ç¿»è¯‘","permalink":"https://blog.inoki.cc/tags/ç¿»è¯‘/"},{"name":"ä¸­æ–‡","slug":"ä¸­æ–‡","permalink":"https://blog.inoki.cc/tags/ä¸­æ–‡/"},{"name":"Hardware","slug":"Hardware","permalink":"https://blog.inoki.cc/tags/Hardware/"},{"name":"ARM","slug":"ARM","permalink":"https://blog.inoki.cc/tags/ARM/"}]},{"title":"ã€è¯‘ã€‘ARM çš„å†å²â€”â€”ç¬¬ä¸€éƒ¨åˆ†ï¼šæ‰“é€ ç¬¬ä¸€å—èŠ¯ç‰‡","slug":"History-of-ARM-1","date":"2023-08-20T20:34:00.000Z","updated":"2025-03-08T09:40:48.566Z","comments":true,"path":"2023/08/20/History-of-ARM-1/","link":"","permalink":"https://blog.inoki.cc/2023/08/20/History-of-ARM-1/","excerpt":"","text":"åŸåšå®¢å…±åˆ†ä¸ºä¸‰ç¯‡ï¼ŒåŸæ–‡é“¾æ¥å¦‚ä¸‹ï¼š https://arstechnica.com/gadgets/2022/09/a-history-of-arm-part-1-building-the-first-chip/ https://arstechnica.com/gadgets/2022/11/a-history-of-arm-part-2-everything-starts-to-come-together/ https://arstechnica.com/gadgets/2023/01/a-history-of-arm-part-3-coming-full-circle/ 1983 å¹´ï¼ŒAcorn Computer å…¬å¸éœ€è¦ä¸€ä¸ª CPUã€‚äºæ˜¯ï¼Œ10 ä¸ªäººåˆ¶é€ äº†ä¸€ä¸ªã€‚ 1983 å¹´ï¼ŒAcorn Computers æ­£å¤„äºä¸–ç•Œä¹‹å·…ã€‚ä¸å¹¸çš„æ˜¯ï¼Œéº»çƒ¦å°±åœ¨ä¸è¿œå¤„ã€‚ è¿™å®¶è‹±å›½å°å…¬å¸å› ä¸ºèµ¢å¾—äº†è‹±å›½å¹¿æ’­å…¬å¸ä¸ºå…¨å›½ç”µè§†èŠ‚ç›®ç”Ÿäº§ç”µè„‘çš„åˆåŒè€Œå£°åé¹Šèµ·ã€‚å½“æ—¶ï¼ŒBBC Micro çš„é”€é‡æ€¥å‰§ä¸Šå‡ï¼Œæœ‰æœ›çªç ´ 120 ä¸‡å°ã€‚ ä½†æ˜¯ï¼Œä¸ªäººç”µè„‘çš„ä¸–ç•Œæ­£åœ¨å‘ç”Ÿå˜åŒ–ã€‚å®¶é•¿ä»¬ä¸ºäº†è¾…å¯¼å­©å­åšä½œä¸šè€Œè´­ä¹°çš„å»‰ä»· 8 ä½å¾®å‹æœºå¸‚åœºé€æ¸é¥±å’Œã€‚è€Œæ¥è‡ªå¤§æ´‹å½¼å²¸çš„æ–°æœºå™¨ï¼Œå¦‚ IBM PC å’Œå³å°†é—®ä¸–çš„è‹¹æœ Macintoshï¼Œåˆ™æ‰¿è¯ºæä¾›æ›´å¼ºå¤§ã€æ›´æ˜“ç”¨çš„åŠŸèƒ½ã€‚Acorn éœ€è¦ä¸€ç§ç«äº‰æ–¹å¼ï¼Œä½†å®ƒæ²¡æœ‰å¤ªå¤šèµ„é‡‘ç”¨äºç ”å‘ã€‚ åˆ›æ„çš„ç§å­ BBC Micro çš„è®¾è®¡è€…ä¹‹ä¸€ç´¢è²-å¨å°”é€Šï¼ˆSophie Wilsonï¼‰æ—©å°±é¢„æ–™åˆ°äº†è¿™ä¸ªé—®é¢˜ã€‚å¥¹å¢åŠ äº†ä¸€ä¸ªåä¸º â€œTubeâ€ çš„æ’æ§½ï¼Œå¯ä»¥è¿æ¥åŠŸèƒ½æ›´å¼ºå¤§çš„ä¸­å¤®å¤„ç†å™¨ã€‚æ’æ§½å¼ä¸­å¤®å¤„ç†å™¨å¯ä»¥æ¥ç®¡è®¡ç®—æœºï¼Œè®©åŸæ¥çš„ 6502 èŠ¯ç‰‡è…¾å‡ºæ—¶é—´æ‰§è¡Œå…¶ä»–ä»»åŠ¡ã€‚ å¨å°”é€Šåæ¥åœ¨æ¥å—è®¡ç®—æœºå†å²åšç‰©é¦†é‡‡è®¿æ—¶è§£é‡Šè¯´ï¼š&quot;æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ‰€æœ‰è¿™äº›å¤„ç†å™¨èƒ½åšä»€ä¹ˆï¼Œä¸èƒ½åšä»€ä¹ˆã€‚å› æ­¤ï¼Œå®ƒä»¬æ²¡æœ‰åšåˆ°çš„ç¬¬ä¸€ä»¶äº‹å°±æ˜¯æ²¡æœ‰å……åˆ†åˆ©ç”¨å†…å­˜ç³»ç»Ÿã€‚å…¶æ¬¡ï¼Œå®ƒä»¬çš„é€Ÿåº¦ä¸å¿«ï¼Œä¸å¥½ç”¨ã€‚æˆ‘ä»¬ä¹ æƒ¯äºç”¨æœºå™¨ç å¯¹ 6502 è¿›è¡Œç¼–ç¨‹ï¼Œæˆ‘ä»¬æ›´å¸Œæœ›æˆ‘ä»¬èƒ½è¾¾åˆ°è¿™æ ·çš„èƒ½åŠ›æ°´å¹³ï¼Œå³å¦‚æœä½ ç”¨æ›´é«˜çº§åˆ«çš„è¯­è¨€ç¼–å†™ï¼Œä½ ä¹Ÿèƒ½è¾¾åˆ°åŒæ ·çš„ç»“æœã€‚ ä½†å¦ä¸€ç§é€‰æ‹©æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿè®©å°å°çš„ Acorn å…¬å¸ä»å¤´å¼€å§‹åˆ¶é€ è‡ªå·±çš„ CPU æ˜¯å¦å¯è¡Œï¼Ÿä¸ºäº†å¼„æ¸…è¿™ä¸ªé—®é¢˜ï¼Œå¨å°”é€Šå’Œç¦ä¼¯å‰å¾€å›½å®¶åŠå¯¼ä½“ä½äºä»¥è‰²åˆ—çš„å·¥å‚ã€‚ä»–ä»¬çœ‹åˆ°äº†æ•°ç™¾åå·¥ç¨‹å¸ˆå’Œå¤§é‡æ˜‚è´µçš„è®¾å¤‡ã€‚è¿™è¯å®äº†ä»–ä»¬çš„çŒœæµ‹ï¼Œå³ä»–ä»¬å¯èƒ½æ— æ³•å®Œæˆè¿™æ ·çš„ä»»åŠ¡ã€‚ éšåï¼Œä»–ä»¬å‚è§‚äº†ä½äºäºšåˆ©æ¡‘é‚£å·æ¢…è¨çš„è¥¿éƒ¨è®¾è®¡ä¸­å¿ƒã€‚è¿™å®¶å…¬å¸æ­£åœ¨åˆ¶é€ æ·±å—äººä»¬å–œçˆ±çš„ 6502ï¼Œå¹¶åœ¨è®¾è®¡ 16 ä½çš„åç»­äº§å“ 65C618ã€‚å¨å°”é€Šå’Œç¦ä¼¯å‘ç°ï¼Œè¿™é‡Œåªæœ‰ä¸€é—´ â€œéƒŠåŒºçš„å¹³æˆ¿â€ï¼Œå‡ åå·¥ç¨‹å¸ˆå’Œå‡ åå­¦ç”Ÿæ­£åœ¨ç”¨è€å¼çš„è‹¹æœ II ç”µè„‘å’Œç²˜èƒ¶å¸¦åˆ¶ä½œå›¾è¡¨ã€‚ ä½†å¥¹åº”è¯¥é€‰æ‹©ä»€ä¹ˆæ ·çš„å¤„ç†å™¨å‘¢ï¼Ÿå¨å°”é€Šå’Œè”åˆè®¾è®¡å¸ˆå²è’‚å¤«-ç¦ä¼¯è€ƒè™‘äº†å„ç§ 16 ä½çš„é€‰æ‹©ï¼Œå¦‚è‹±ç‰¹å°”çš„ 80286ã€å›½å®¶åŠå¯¼ä½“çš„ 32016 å’Œæ‘©æ‰˜ç½—æ‹‰çš„ 68000ã€‚ä½†æ²¡æœ‰ä¸€ä¸ªæ˜¯å®Œå…¨ä»¤äººæ»¡æ„çš„ã€‚ çªç„¶é—´ï¼Œè‡ªåˆ¶ CPU ä¼¼ä¹æˆä¸ºå¯èƒ½ã€‚å¨å°”é€Šå’Œç¦ä¼¯çš„å°å›¢é˜Ÿä»¥å‰ä¹Ÿåˆ¶ä½œè¿‡å®šåˆ¶èŠ¯ç‰‡ï¼Œå¦‚ BBC Micro çš„å›¾å½¢å’Œè¾“å…¥/è¾“å‡ºèŠ¯ç‰‡ã€‚ä½†ä¸ä¸­å¤®å¤„ç†å™¨ç›¸æ¯”ï¼Œè¿™äº›è®¾è®¡æ›´ç®€å•ï¼Œå…ƒä»¶æ›´å°‘ã€‚ å°½ç®¡å›°éš¾é‡é‡ï¼ŒAcorn çš„ä¸Šå±‚ç®¡ç†è€…è¿˜æ˜¯æ”¯æŒä»–ä»¬çš„åŠªåŠ›ã€‚äº‹å®ä¸Šï¼Œä»–ä»¬ä¸ä»…ä»…æ˜¯æ”¯æŒã€‚Acorn è”åˆåˆ›å§‹äººèµ«å°”æ›¼-è±ªç‘Ÿï¼ˆHermann Hauserï¼‰æ‹¥æœ‰ç‰©ç†å­¦åšå£«å­¦ä½ï¼Œä»–ç»™å›¢é˜Ÿæä¾›äº† IBM ç ”ç©¶è®ºæ–‡çš„å‰¯æœ¬ï¼Œå…¶ä¸­æè¿°äº†ä¸€ç§æ–°å‹ã€åŠŸèƒ½æ›´å¼ºå¤§çš„ CPUã€‚å®ƒè¢«ç§°ä¸º RISCï¼Œæ„æ€æ˜¯ â€œç²¾ç®€æŒ‡ä»¤é›†è®¡ç®—â€ã€‚ é‡‡ç”¨ RISC è¿™ç©¶ç«Ÿæ„å‘³ç€ä»€ä¹ˆï¼Ÿè¦å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å…ˆæ¥ä¸Šä¸€å ‚è¶…çº§ç®€åŒ–çš„ CPU å·¥ä½œåŸç†é€Ÿæˆè¯¾ã€‚é¦–å…ˆæ˜¯æ™¶ä½“ç®¡ï¼Œä¸€ç§ç”±ç¡…ä¸ä¸åŒåŒ–å­¦ç‰©è´¨æ··åˆè€Œæˆçš„ä¸‰æ˜æ²»çŠ¶å¾®å°å™¨ä»¶ã€‚æ™¶ä½“ç®¡æœ‰ä¸‰ä¸ªæ¥å¤´ã€‚å½“æ …æè¾“å…¥ç«¯æœ‰ç”µå‹æ—¶ï¼Œç”µæµå¯ä»¥ä»æºæè¾“å…¥ç«¯è‡ªç”±æµå‘æ¼æè¾“å‡ºç«¯ã€‚å½“æ …æä¸Šæ²¡æœ‰ç”µå‹æ—¶ï¼Œç”µæµå°±ä¼šåœæ­¢æµåŠ¨ã€‚å› æ­¤ï¼Œæ™¶ä½“ç®¡æ˜¯ä¸€ç§å¯æ§å¼€å…³ã€‚ æ‚¨å¯ä»¥å°†æ™¶ä½“ç®¡ç»„åˆèµ·æ¥å½¢æˆé€»è¾‘é—¨ã€‚ä¾‹å¦‚ï¼Œä¸¤ä¸ªä¸²è”çš„å¼€å…³ç»„æˆä¸€ä¸ª &quot;AND &quot;é—¨ï¼Œä¸¤ä¸ªå¹¶è”çš„å¼€å…³ç»„æˆä¸€ä¸ª &quot;OR &quot;é—¨ã€‚è¿™äº›é—¨å¯ä»¥è®©è®¡ç®—æœºé€šè¿‡æ¯”è¾ƒæ•°å­—åšå‡ºé€‰æ‹©ã€‚ ä½†å¦‚ä½•è¡¨ç¤ºæ•°å­—å‘¢ï¼Ÿè®¡ç®—æœºä½¿ç”¨äºŒè¿›åˆ¶æˆ– Base 2ï¼Œå°†ä¸€ä¸ªå°çš„æ­£ç”µå‹ç­‰åŒäºæ•°å­— 1ï¼Œæ— ç”µå‹ç­‰åŒäº 0ã€‚ç”±äºäºŒè¿›åˆ¶è¿ç®—éå¸¸ç®€å•ï¼Œå› æ­¤å¾ˆå®¹æ˜“åˆ¶é€ å‡ºäºŒè¿›åˆ¶åŠ æ³•å™¨ï¼Œå¯ä»¥å°† 0 æˆ– 1 åŠ åˆ° 0 æˆ– 1ï¼Œå¹¶å­˜å‚¨æ€»å’Œå’Œä¸€ä¸ªå¯é€‰çš„è¿›ä½ã€‚å¤§äº 1 çš„æ•°å­—å¯ä»¥é€šè¿‡æ·»åŠ æ›´å¤šåŒæ—¶å·¥ä½œçš„åŠ æ³•å™¨æ¥è¡¨ç¤ºã€‚å¯åŒæ—¶è®¿é—®çš„äºŒè¿›åˆ¶ä½æ•°æ˜¯è¡¡é‡èŠ¯ç‰‡ &quot;æ¯”ç‰¹åº¦ &quot;çš„ä¸€ä¸ªæ ‡å‡†ã€‚åƒ 6502 è¿™æ ·çš„ 8 ä½ CPU ä»¥ 8 ä½ä¸ºå•ä½å¤„ç†æ•°å­—ã€‚ ç®—æœ¯å’Œé€»è¾‘æ˜¯ CPU çš„ä¸»è¦åŠŸèƒ½ã€‚ä½†äººç±»éœ€è¦ä¸€ç§æ–¹æ³•æ¥å‘Šè¯‰å®ƒè¯¥åšä»€ä¹ˆã€‚å› æ­¤ï¼Œæ¯ä¸ªä¸­å¤®å¤„ç†å™¨éƒ½æœ‰ä¸€ä¸ªæŒ‡ä»¤é›†ï¼Œå®ƒåˆ—å‡ºäº†ä¸­å¤®å¤„ç†å™¨å¯ä»¥å°†æ•°æ®ç§»å…¥å’Œç§»å‡ºå†…å­˜ã€è¿›è¡Œæ•°å­¦è®¡ç®—ã€æ¯”è¾ƒæ•°å­—ä»¥åŠè·³è½¬åˆ°ç¨‹åºä¸åŒéƒ¨åˆ†çš„æ‰€æœ‰æ–¹æ³•ã€‚ RISC çš„ç†å¿µæ˜¯å¤§å¹…å‡å°‘æŒ‡ä»¤æ•°é‡ï¼Œä»è€Œç®€åŒ– CPU çš„å†…éƒ¨è®¾è®¡ã€‚å¦‚ä½•å¤§å¹…å‡å°‘ï¼Ÿè‹±ç‰¹å°” 80286 æ˜¯ä¸€æ¬¾ 16 ä½èŠ¯ç‰‡ï¼Œæ€»å…±æœ‰ 357 æ¡ç‹¬ç‰¹çš„æŒ‡ä»¤ã€‚è€Œç´¢è²-å¨å°”é€Šåˆ›å»ºçš„æ–° RISC æŒ‡ä»¤é›†åªæœ‰ 45 æ¡ã€‚ ä¸ºäº†å®ç°è¿™ç§ç®€åŒ–ï¼Œå¨å°”é€Šä½¿ç”¨äº† â€œåŠ è½½å’Œå­˜å‚¨â€ æ¶æ„ã€‚ä¼ ç»Ÿï¼ˆå¤æ‚ï¼‰CPU æœ‰ä¸åŒçš„æŒ‡ä»¤ï¼Œç”¨äºå°†ä¸¤ä¸ªå†…éƒ¨ â€œå¯„å­˜å™¨â€ï¼ˆèŠ¯ç‰‡å†…éƒ¨çš„å°å—å­˜å‚¨å™¨ï¼‰ä¸­çš„æ•°å­—ç›¸åŠ ï¼Œæˆ–å°†å¤–éƒ¨å­˜å‚¨å™¨ä¸­ä¸¤ä¸ªåœ°å€ä¸­çš„æ•°å­—ç›¸åŠ ï¼Œæˆ–å°†æ¯ç§æŒ‡ä»¤çš„ç»„åˆç›¸åŠ ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼ŒRISC èŠ¯ç‰‡æŒ‡ä»¤åªèƒ½åœ¨å¯„å­˜å™¨ä¸Šè¿è¡Œã€‚ç„¶åï¼Œå•ç‹¬çš„æŒ‡ä»¤ä¼šå°†ç­”æ¡ˆä»å¯„å­˜å™¨ç§»è‡³å¤–éƒ¨å­˜å‚¨å™¨ã€‚ è¿™æ„å‘³ç€ RISC CPU çš„ç¨‹åºé€šå¸¸éœ€è¦æ›´å¤šçš„æŒ‡ä»¤æ‰èƒ½äº§ç”Ÿç›¸åŒçš„ç»“æœã€‚é‚£ä¹ˆï¼Œå®ƒä»¬å¦‚ä½•æ‰èƒ½æ›´å¿«ï¼Ÿç­”æ¡ˆä¹‹ä¸€æ˜¯ï¼Œæ›´ç®€å•çš„è®¾è®¡å¯ä»¥ä»¥æ›´é«˜çš„æ—¶é’Ÿé€Ÿåº¦è¿è¡Œã€‚ä½†å¦ä¸€ä¸ªåŸå› æ˜¯ï¼ŒèŠ¯ç‰‡æ‰§è¡Œæ›´å¤æ‚çš„æŒ‡ä»¤éœ€è¦æ›´é•¿çš„æ—¶é—´ã€‚å¦‚æœä¿æŒç®€å•ï¼Œå°±å¯ä»¥åœ¨ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸå†…æ‰§è¡Œæ¯ä¸€æ¡æŒ‡ä»¤ã€‚è¿™æ ·å°±æ›´å®¹æ˜“ä½¿ç”¨æµæ°´çº¿æŠ€æœ¯ã€‚ é€šå¸¸ï¼ŒCPU å¿…é¡»åˆ†é˜¶æ®µå¤„ç†æŒ‡ä»¤ã€‚å®ƒéœ€è¦ä»å†…å­˜ä¸­è·å–æŒ‡ä»¤ï¼Œè§£ç æŒ‡ä»¤ï¼Œç„¶åæ‰§è¡ŒæŒ‡ä»¤ã€‚Acorn æ­£åœ¨è®¾è®¡çš„ RISC CPU å°†é‡‡ç”¨ä¸‰çº§æµæ°´çº¿ã€‚å½“èŠ¯ç‰‡çš„ä¸€éƒ¨åˆ†æ‰§è¡Œå½“å‰æŒ‡ä»¤æ—¶ï¼Œå¦ä¸€éƒ¨åˆ†æ­£åœ¨è·å–ä¸‹ä¸€æ¡æŒ‡ä»¤ï¼Œå¦‚æ­¤å¾ªç¯ã€‚ RISC è®¾è®¡çš„ä¸€ä¸ªç¼ºç‚¹æ˜¯ï¼Œç”±äºç¨‹åºéœ€è¦æ›´å¤šçš„æŒ‡ä»¤ï¼Œå› æ­¤éœ€è¦å ç”¨æ›´å¤šçš„å†…å­˜ç©ºé—´ã€‚åœ¨ 20 ä¸–çºª 70 å¹´ä»£æœ«è®¾è®¡ç¬¬ä¸€ä»£ CPU æ—¶ï¼Œ1 å…†å­—èŠ‚çš„å†…å­˜å¤§çº¦éœ€è¦ 5,000 ç¾å…ƒã€‚å› æ­¤ï¼Œä»»ä½•èƒ½å‡å°‘ç¨‹åºå†…å­˜å¤§å°çš„æ–¹æ³•ï¼ˆæ‹¥æœ‰å¤æ‚çš„æŒ‡ä»¤é›†å°†æœ‰åŠ©äºå®ç°è¿™ä¸€ç›®æ ‡ï¼‰éƒ½æ˜¯éå¸¸æœ‰ä»·å€¼çš„ã€‚è¿™å°±æ˜¯è‹±ç‰¹å°” 8080ã€8088 å’Œ 80286 ç­‰èŠ¯ç‰‡æ‹¥æœ‰å¦‚æ­¤å¤šæŒ‡ä»¤çš„åŸå› ã€‚ ä½†å†…å­˜ä»·æ ¼å´åœ¨è¿…é€Ÿä¸‹é™ã€‚å› æ­¤ï¼ŒRISC CPU æ‰€éœ€çš„é¢å¤–å†…å­˜åœ¨æœªæ¥å°†ä¸å†æ˜¯é—®é¢˜ã€‚ ä¸ºäº†è¿›ä¸€æ­¥ä¿è¯æ–°çš„ Acorn CPU çš„æœªæ¥å‘å±•ï¼Œå›¢é˜Ÿå†³å®šè·³è¿‡ 16 ä½ï¼Œç›´æ¥é‡‡ç”¨ 32 ä½è®¾è®¡ã€‚è¿™å®é™…ä¸Šç®€åŒ–äº†èŠ¯ç‰‡çš„å†…éƒ¨ç»“æ„ï¼Œå› ä¸ºä½ ä¸å¿…ç»å¸¸æ‹†åˆ†å¤§æ•°å­—ï¼Œè€Œä¸”å¯ä»¥ç›´æ¥è®¿é—®æ‰€æœ‰å†…å­˜åœ°å€ã€‚(äº‹å®ä¸Šï¼Œç¬¬ä¸€æ¬¾èŠ¯ç‰‡åªæš´éœ²äº† 32 ä¸ªåœ°å€çº¿ä¸­çš„ 26 ä¸ªå¼•è„šï¼Œå› ä¸º 2 çš„ 26 æ¬¡æ–¹ï¼Œå³ 64MB åœ¨å½“æ—¶æ˜¯ä¸€ä¸ªéå¸¸å¤§çš„å†…å­˜å®¹é‡ï¼‰ã€‚ ç°åœ¨ï¼Œå›¢é˜Ÿéœ€è¦çš„åªæ˜¯ä¸ºæ–° CPU å–ä¸€ä¸ªåå­—ã€‚å›¢é˜Ÿè€ƒè™‘äº†å„ç§æ–¹æ¡ˆï¼Œæœ€ç»ˆå°†å…¶å‘½åä¸º Acorn RISC Machineï¼Œæˆ– ARMã€‚ æˆä¸º ARM ç¬¬ä¸€æ¬¾ ARM èŠ¯ç‰‡çš„å¼€å‘å†æ—¶ 18 ä¸ªæœˆã€‚ä¸ºäº†èŠ‚çœå¼€æ”¯ï¼Œå›¢é˜ŸèŠ±äº†å¤§é‡æ—¶é—´å¯¹è®¾è®¡è¿›è¡Œæµ‹è¯•ï¼Œç„¶åæ‰å°†å…¶æŠ•å…¥åˆ°ç¡…ç‰‡ä¸­ã€‚Furber åœ¨ BBC Micro ä¸Šç”¨è§£é‡Šå‹ BASIC ä¸º ARM CPU å†™äº†ä¸€ä¸ªæ¨¡æ‹Ÿå™¨ã€‚å½“ç„¶ï¼Œè¿™ä¸ªè¿‡ç¨‹æ…¢å¾—ä»¤äººéš¾ä»¥ç½®ä¿¡ï¼Œä½†å®ƒæœ‰åŠ©äºè¯æ˜æ¦‚å¿µï¼Œå¹¶éªŒè¯å¨å°”é€Šçš„æŒ‡ä»¤é›†æ˜¯å¦èƒ½æŒ‰è®¾è®¡è¿è¡Œã€‚ å¨å°”é€Šè®¤ä¸ºï¼Œå¼€å‘è¿‡ç¨‹è™½ç„¶é›„å¿ƒå‹ƒå‹ƒï¼Œä½†å´ç®€å•æ˜äº†ã€‚ &quot;å¥¹è¯´ï¼š&quot;æˆ‘ä»¬ä»¥ä¸ºè‡ªå·±ç–¯äº†ã€‚&quot;æˆ‘ä»¬è®¤ä¸ºæˆ‘ä»¬åšä¸åˆ°ã€‚ä½†æˆ‘ä»¬ä¸æ–­å‘ç°ï¼Œå®é™…ä¸Šå¹¶æ²¡æœ‰ä»€ä¹ˆåœ°æ–¹å¯ä»¥è®©æˆ‘ä»¬åœä¸‹è„šæ­¥ã€‚è¿™åªæ˜¯ä¸€ä¸ªå·¥ä½œé—®é¢˜ã€‚ Furber ä¸»è¦è´Ÿè´£èŠ¯ç‰‡æœ¬èº«çš„å¸ƒå±€å’Œè®¾è®¡ï¼Œè€Œ Wilson åˆ™ä¸“æ³¨äºæŒ‡ä»¤é›†ã€‚ä½†å®é™…ä¸Šï¼Œè¿™ä¸¤é¡¹å·¥ä½œæ˜¯ç´§å¯†äº¤ç»‡åœ¨ä¸€èµ·çš„ã€‚ä¸ºæ¯æ¡æŒ‡ä»¤é€‰æ‹©ä»£ç å¹¶ä¸æ˜¯éšå¿ƒæ‰€æ¬²çš„ã€‚é€‰æ‹©æ¯ä¸ªæ•°å­—çš„ç›®çš„æ˜¯ï¼Œå½“å®ƒè¢«è½¬æ¢æˆäºŒè¿›åˆ¶æ•°å­—æ—¶ï¼ŒæŒ‡ä»¤æ€»çº¿ä¸Šçš„é€‚å½“å¯¼çº¿å°±ä¼šæ¿€æ´»æ­£ç¡®çš„è§£ç å’Œè·¯ç”±ç”µè·¯ã€‚ æµ‹è¯•è¿‡ç¨‹é€æ¸æˆç†Ÿï¼Œå¨å°”é€Šé¢†å¯¼çš„å›¢é˜Ÿç¼–å†™äº†æ›´å…ˆè¿›çš„ä»¿çœŸå™¨ã€‚&quot;å¥¹è§£é‡Šè¯´ï¼š&quot;æœ‰äº†çº¯æŒ‡ä»¤æ¨¡æ‹Ÿå™¨ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨ 6502 ç§’å¤„ç†å™¨ä¸Šä»¥æ¯ç§’æ•°åä¸‡æ¡ ARM æŒ‡ä»¤çš„é€Ÿåº¦è¿è¡Œã€‚&quot;æˆ‘ä»¬è¿˜å¯ä»¥ç¼–å†™å¤§é‡çš„è½¯ä»¶ï¼Œå°† BBC BASIC ç§»æ¤åˆ° ARM å’Œå…¶ä»–ä¸€åˆ‡ï¼ŒåŒ…æ‹¬ç¬¬äºŒå¤„ç†å™¨å’Œæ“ä½œç³»ç»Ÿã€‚è¿™è®©æˆ‘ä»¬è¶Šæ¥è¶Šæœ‰ä¿¡å¿ƒã€‚å°½ç®¡æˆ‘ä»¬æ˜¯åœ¨è§£é‡Š ARM æœºå™¨ä»£ç ï¼Œä½†å…¶ä¸­ä¸€äº›ä¸œè¥¿æ¯”æˆ‘ä»¬è§è¿‡çš„ä»»ä½•å…¶ä»–ä¸œè¥¿éƒ½è¦å¥½ç”¨ã€‚ARM æœºå™¨ä»£ç æœ¬èº«çš„æ€§èƒ½éå¸¸é«˜ï¼Œè§£é‡Š ARM æœºå™¨ä»£ç çš„ç»“æœå¾€å¾€æ¯”åŒä¸€å¹³å°ä¸Šçš„ç¼–è¯‘ä»£ç æ›´å¥½ã€‚ è¿™äº›æƒŠäººçš„ç»“æœä¿ƒä½¿è¿™ä¸ªå°å›¢é˜Ÿå®Œæˆäº†å·¥ä½œã€‚ç¬¬ä¸€ä¸ª ARM CPU çš„è®¾è®¡è¢«é€åˆ°ç¾å›½åŠå¯¼ä½“åˆ¶é€ å…¬å¸ VLSI Technology Inc. 1985 å¹´ 4 æœˆ 26 æ—¥ï¼Œç¬¬ä¸€ç‰ˆèŠ¯ç‰‡å›åˆ°æ©¡æœå…¬å¸ã€‚å¨å°”é€Šå°†å®ƒæ’å…¥ BBC Micro çš„ Tube æ’æ§½ï¼ŒåŠ è½½äº†ç§»æ¤åˆ° ARM ç‰ˆæœ¬çš„ BBC BASICï¼Œå¹¶ç”¨ç‰¹æ®Šçš„ PRINT å‘½ä»¤è¿›è¡Œäº†æµ‹è¯•ã€‚èŠ¯ç‰‡å›ç­”è¯´ï¼š&quot;ä¸–ç•Œä½ å¥½ï¼Œæˆ‘æ˜¯ ARMã€‚&quot;äºæ˜¯ï¼Œå›¢é˜Ÿå¼€äº†ä¸€ç“¶é¦™æ§Ÿã€‚ è®©æˆ‘ä»¬å›è¿‡å¤´æ¥æ€è€ƒä¸€ä¸‹ï¼Œè¿™æ˜¯ä¸€é¡¹å¤šä¹ˆäº†ä¸èµ·çš„æˆå°±ã€‚æ•´ä¸ª ARM è®¾è®¡å›¢é˜ŸåŒ…æ‹¬ç´¢è²-å¨å°”é€Šï¼ˆSophie Wilsonï¼‰ã€å²è’‚å¤«-ç¦ä¼¯ï¼ˆSteve Furberï¼‰ã€å¦å¤–å‡ ä½èŠ¯ç‰‡è®¾è®¡å¸ˆï¼Œä»¥åŠä¸€ä¸ªç¼–å†™æµ‹è¯•å’ŒéªŒè¯è½¯ä»¶çš„å››äººå›¢é˜Ÿã€‚è¿™ä¸ªåŸºäºå…ˆè¿› RISC è®¾è®¡çš„æ–°å‹ 32 ä½ CPU æ˜¯ç”±ä¸åˆ° 10 ä¸ªäººå®Œæˆçš„ï¼Œè€Œä¸”ç¬¬ä¸€æ¬¡å°±èƒ½æ­£ç¡®è¿è¡Œã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œç¾å›½å›½å®¶åŠå¯¼ä½“å…¬å¸çš„ 32016 å·²ç»è¿›è¡Œäº†ç¬¬ 10 æ¬¡ä¿®è®¢ï¼Œä½†ä»åœ¨ä¸æ–­å‘ç°é”™è¯¯ã€‚ Acorn å›¢é˜Ÿæ˜¯å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹çš„å‘¢ï¼Ÿä»–ä»¬å°† ARM è®¾è®¡å¾—å°½å¯èƒ½ç®€å•ã€‚V1 èŠ¯ç‰‡åªæœ‰ 27,000 ä¸ªæ™¶ä½“ç®¡ï¼ˆ80286 æœ‰ 134,000 ä¸ªæ™¶ä½“ç®¡ï¼ï¼‰ï¼Œé‡‡ç”¨ 3 å¾®ç±³å·¥è‰ºåˆ¶é€ ï¼Œä¹Ÿå°±æ˜¯ 3,000 çº³ç±³ï¼Œé¢—ç²’åº¦æ¯”ç°åœ¨çš„ CPU å°ä¸€åƒå€ã€‚ åœ¨è¿™ç§è¯¦ç»†ç¨‹åº¦ä¸Šï¼Œä½ å‡ ä¹å¯ä»¥çœ‹æ¸…å•ä¸ªæ™¶ä½“ç®¡ã€‚ä»¥å¯„å­˜å™¨æ–‡ä»¶ä¸ºä¾‹ï¼Œå°†å…¶ä¸éšæœºå­˜å–å­˜å‚¨å™¨å·¥ä½œåŸç†çš„äº¤äº’å¼æ¡†å›¾è¿›è¡Œæ¯”è¾ƒã€‚æ‚¨å¯ä»¥çœ‹åˆ°æŒ‡ä»¤æ€»çº¿å°†æ•°æ®ä»è¾“å…¥å¼•è„šä¼ é€åˆ°è§£ç å™¨å’Œå¯„å­˜å™¨æ§ä»¶ã€‚ è™½ç„¶ç¬¬ä¸€ä¸ª ARM CPU ç»™äººç•™ä¸‹äº†æ·±åˆ»å°è±¡ï¼Œä½†æŒ‡å‡ºå®ƒæ‰€ç¼ºå°‘çš„ä¸œè¥¿ä¹Ÿå¾ˆé‡è¦ã€‚å®ƒæ²¡æœ‰æ¿è½½é«˜é€Ÿç¼“å†²å­˜å‚¨å™¨ã€‚å®ƒæ²¡æœ‰ä¹˜æ³•æˆ–é™¤æ³•ç”µè·¯ã€‚æ­¤å¤–ï¼Œå®ƒè¿˜ç¼ºå°‘æµ®ç‚¹è¿ç®—å•å…ƒï¼Œå› æ­¤å¯¹éæ•´æ•°çš„è¿ç®—é€Ÿåº¦è¾ƒæ…¢ã€‚ä¸è¿‡ï¼Œä½¿ç”¨ä¸€ä¸ªç®€å•çš„æ¡¶å½¢ç§»ä½å™¨æœ‰åŠ©äºæµ®ç‚¹æ•°çš„è¿ç®—ã€‚èŠ¯ç‰‡çš„è¿è¡Œé¢‘ç‡ä»…ä¸º 6 MHzã€‚ é‚£ä¹ˆï¼Œè¿™ä¸ªå°å·§ç²ç‘çš„ ARM V1 æ€§èƒ½å¦‚ä½•å‘¢ï¼Ÿåœ¨åŸºå‡†æµ‹è¯•ä¸­ï¼Œå®ƒæ¯”ç›¸åŒæ—¶é’Ÿé€Ÿåº¦çš„è‹±ç‰¹å°” 80286 èŠ¯ç‰‡å¿« 10 å€å·¦å³ï¼Œç›¸å½“äºè¿è¡Œé¢‘ç‡ä¸º 17 MHz çš„ 32 ä½æ‘©æ‰˜ç½—æ‹‰ 68020 èŠ¯ç‰‡ã€‚ ARM èŠ¯ç‰‡è¿˜è¢«è®¾è®¡æˆä»¥éå¸¸ä½çš„åŠŸè€—è¿è¡Œã€‚å¨å°”é€Šè§£é‡Šè¯´ï¼Œè¿™å®Œå…¨æ˜¯ä¸€é¡¹èŠ‚çº¦æˆæœ¬çš„æªæ–½â€“ç ”ç©¶å°ç»„å¸Œæœ›ä½¿ç”¨å¡‘æ–™å¤–å£³ä»£æ›¿é™¶ç“·å¤–å£³ï¼Œå› æ­¤ä»–ä»¬è®¾å®šäº† 1 ç“¦çš„æœ€å¤§åŠŸè€—ç›®æ ‡ã€‚ ä½†æ˜¯ï¼Œä»–ä»¬ç”¨äºä¼°ç®—åŠŸç‡çš„å·¥å…·éå¸¸åŸå§‹ã€‚ä¸ºäº†ç¡®ä¿ä¸è¶…æ ‡ï¼Œä¸èåŒ–å¡‘æ–™ï¼Œä»–ä»¬å¯¹æ¯ä¸ªè®¾è®¡ç»†èŠ‚éƒ½éå¸¸ä¿å®ˆã€‚ç”±äºè®¾è®¡ç®€å•ã€æ—¶é’Ÿé¢‘ç‡ä½ï¼Œå®é™…åŠŸè€—æœ€ç»ˆåªæœ‰ 0.1 ç“¦ã€‚ äº‹å®ä¸Šï¼Œå›¢é˜Ÿæœ€å…ˆå°† ARM æ’å…¥çš„ä¸€å—æµ‹è¯•æ¿çš„è¿æ¥æ–­å¼€äº†ï¼Œæ ¹æœ¬æ²¡æœ‰è¿æ¥åˆ°ä»»ä½•ç”µæºã€‚å½“ä»–ä»¬å‘ç°æ•…éšœæ—¶éå¸¸æƒŠè®¶ï¼Œå› ä¸º CPU ä¸€ç›´éƒ½åœ¨å·¥ä½œã€‚å®ƒåªæ˜¯åœ¨æ”¯æŒèŠ¯ç‰‡æ¼ç”µçš„æƒ…å†µä¸‹æ‰“å¼€çš„ã€‚ å¨å°”é€Šè®¤ä¸ºï¼ŒARM èŠ¯ç‰‡çš„ä½åŠŸè€—æ˜¯ä¸€ä¸ª â€œå®Œå…¨çš„æ„å¤–â€ï¼Œä½†è¿™åœ¨ä»¥åä¼šå˜å¾—éå¸¸é‡è¦ã€‚ ä½¿ç”¨ ARM çš„æ–°è®¡ç®—æœº Acorn å…¬å¸æ‹¥æœ‰äº†è¿™é¡¹é¢†å…ˆç«äº‰å¯¹æ‰‹å¤šå¹´çš„æƒŠäººæŠ€æœ¯ã€‚è´¢åŠ¡ä¸Šçš„æˆåŠŸè‚¯å®šå¾ˆå¿«å°±ä¼šåˆ°æ¥ï¼Œå¯¹å—ï¼Ÿå¦‚æœä½ å…³æ³¨è®¡ç®—æœºå‘å±•å²ï¼Œä¹Ÿè®¸å°±èƒ½çŒœåˆ°ç­”æ¡ˆã€‚ åˆ° 1985 å¹´ï¼ŒBBC Micro çš„é”€å”®å¼€å§‹æ¯ç«­ï¼Œä¸€è¾¹æ˜¯å»‰ä»·çš„ Sinclair Spectrumï¼Œå¦ä¸€è¾¹æ˜¯ IBM PC å…‹éš†æœºã€‚Acorn å°†å…¬å¸çš„æ§è‚¡æƒå–ç»™äº† Olivettiï¼Œå› ä¸ºä¹‹å‰æ›¾ä¸ Olivetti åˆä½œä¸º BBC Micro ç”Ÿäº§æ‰“å°æœºã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœæŠŠè®¡ç®—æœºå…¬å¸å–ç»™æ‰“å­—æœºå…¬å¸ï¼Œé‚£å¯ä¸æ˜¯ä»€ä¹ˆå¥½å…†å¤´ã€‚ Acorn å‘ç ”ç©¶äººå‘˜å’Œä¸šä½™çˆ±å¥½è€…å‡ºå”®å¸¦æœ‰ ARM èŠ¯ç‰‡çš„å¼€å‘æ¿ï¼Œä½†è¿™ä»…é™äºç°æœ‰çš„ BBC Micro ç”¨æˆ·å¸‚åœºã€‚è¯¥å…¬å¸éœ€è¦çš„æ˜¯ä¸€å°å…¨æ–°çš„è®¡ç®—æœºï¼Œä»¥çœŸæ­£å±•ç¤ºè¿™ç§æ–°å‹ CPU çš„å¼ºå¤§åŠŸèƒ½ã€‚ åœ¨æ­¤ä¹‹å‰ï¼Œå…¬å¸éœ€è¦å¯¹æœ€åˆçš„ ARM ç¨ä½œå‡çº§ã€‚ARM V2 äº 1986 å¹´é—®ä¸–ï¼Œå®ƒå¢åŠ äº†å¯¹åå¤„ç†å™¨ï¼ˆå¦‚æµ®ç‚¹åå¤„ç†å™¨ï¼Œè¿™æ˜¯å½“æ—¶è®¡ç®—æœºä¸Šæµè¡Œçš„é™„åŠ åŠŸèƒ½ï¼‰å’Œå†…ç½®ç¡¬ä»¶ä¹˜æ³•ç”µè·¯çš„æ”¯æŒã€‚å®ƒé‡‡ç”¨ 2 å¾®ç±³å·¥è‰ºåˆ¶é€ ï¼Œè¿™æ„å‘³ç€ Acorn å¯ä»¥å°†æ—¶é’Ÿé¢‘ç‡æé«˜åˆ° 8 MHzï¼Œè€Œæ— éœ€æ¶ˆè€—æ›´å¤šç”µåŠ›ã€‚ ä½†æ˜¯ï¼Œä»…æœ‰ CPU è¿˜ä¸è¶³ä»¥æ„æˆä¸€å°å®Œæ•´çš„è®¡ç®—æœºã€‚äºæ˜¯ï¼Œå›¢é˜Ÿåˆå¼€å‘äº†å›¾å½¢æ§åˆ¶å™¨èŠ¯ç‰‡ã€è¾“å…¥/è¾“å‡ºæ§åˆ¶å™¨å’Œå†…å­˜æ§åˆ¶å™¨ã€‚åˆ° 1987 å¹´ï¼ŒåŒ…æ‹¬ ARM V2 åœ¨å†…çš„æ‰€æœ‰å››ç§èŠ¯ç‰‡éƒ½å·²å‡†å¤‡å°±ç»ªï¼ŒåŒæ—¶è¿˜åˆ¶ä½œäº†ä¸€å°åŸå‹è®¡ç®—æœºæ¥å®‰è£…è¿™äº›èŠ¯ç‰‡ã€‚ä¸ºäº†åæ˜ å…¶å…ˆè¿›çš„æ€ç»´èƒ½åŠ›ï¼Œå…¬å¸å°†å…¶å‘½åä¸º Acorn Archimedesã€‚ è€ƒè™‘åˆ°å½“æ—¶æ˜¯ 1987 å¹´ï¼Œäººä»¬å¯¹ä¸ªäººç”µè„‘çš„è¦æ±‚å·²ä¸ä»…ä»…æ˜¯æç¤ºè¾“å…¥ BASIC æŒ‡ä»¤ã€‚ç”¨æˆ·éœ€è¦åƒ Amigaã€Atari ST å’Œ Macintosh é‚£æ ·æ¼‚äº®çš„å›¾å½¢ç”¨æˆ·ç•Œé¢ã€‚ Acorn åœ¨æ–½ä¹ PARC æ‰€åœ¨çš„åŠ åˆ©ç¦å°¼äºšå·å¸•æ´›é˜¿å°”æ‰˜æˆç«‹äº†ä¸€ä¸ªè¿œç¨‹è½¯ä»¶å¼€å‘å›¢é˜Ÿï¼Œä¸ºé˜¿åŸºç±³å¾·è®¾è®¡ä¸‹ä¸€ä»£æ“ä½œç³»ç»Ÿã€‚å®ƒè¢«ç§°ä¸º ARXï¼Œå¹¶æ‰¿è¯ºæä¾›æŠ¢å å¼å¤šä»»åŠ¡å¤„ç†å’Œå¤šç”¨æˆ·æ”¯æŒã€‚ARX é€Ÿåº¦å¾ˆæ…¢ï¼Œä½†æ›´å¤§çš„é—®é¢˜æ˜¯å®ƒè¿Ÿåˆ°äº†ã€‚éå¸¸æ™šã€‚ å½“æ—¶ï¼ŒAcorn é˜¿åŸºç±³å¾·æ­£å‡†å¤‡å‘è´§ï¼Œè€Œå…¬å¸è¿˜æ²¡æœ‰æ“ä½œç³»ç»Ÿã€‚è¿™æ˜¯ä¸€ä¸ªå±æœºå››ä¼çš„å±€é¢ã€‚äºæ˜¯ï¼Œæ©¡æœå…¬å¸çš„ç®¡ç†å±‚å»æ‰¾ä¿ç½—-è´¹æ´›æ–¯ï¼ˆPaul Fellowsï¼‰è°ˆè¯ï¼Œä»–æ˜¯ Acorn è½¯ä»¶å›¢é˜Ÿçš„è´Ÿè´£äººï¼Œæ›¾ä¸º BBC Micro ç¼–å†™äº†å¤§é‡è¯­è¨€ã€‚ä»–ä»¬é—®ä»–ï¼šâ€œä½ å’Œä½ çš„å›¢é˜Ÿèƒ½åœ¨äº”ä¸ªæœˆå†…ä¸ºé˜¿åŸºç±³å¾·å†™å‡ºä¸€ä¸ªæ“ä½œç³»ç»Ÿå—ï¼Ÿâ€ è´¹æ´›æ–¯è¯´ï¼šâ€œæˆ‘å°±æ˜¯é‚£ä¸ªå‚»å­ï¼Œæˆ‘è¯´å¯ä»¥ï¼Œæˆ‘ä»¬èƒ½åšåˆ°ã€‚â€ äº”ä¸ªæœˆçš„æ—¶é—´å¯¹äºä»é›¶å¼€å§‹åˆ¶ä½œæ“ä½œç³»ç»Ÿæ¥è¯´å¹¶ä¸ç®—é•¿ã€‚è¿™ä¸ªé€Ÿæˆæ“ä½œç³»ç»Ÿè¢«ç§°ä¸º â€œäºšç‘Ÿè®¡åˆ’â€ï¼Œå¯èƒ½æ˜¯ä»¥è‹±å›½è‘—åè®¡ç®—æœºç§‘å­¦å®¶äºšç‘Ÿ-è¯ºæ›¼ï¼ˆArthur Normanï¼‰çš„åå­—å‘½åçš„ï¼Œä¹Ÿå¯èƒ½æ˜¯ &quot;ARm by THURSdayï¼&quot;çš„ç¼©å†™ã€‚å®ƒæœ€åˆæ˜¯ BBC BASIC çš„æ‰©å±•ã€‚ç†æŸ¥å¾·-æ›¼æ¯”ï¼ˆRichard Manbyï¼‰ç”¨ BASIC ç¼–å†™äº†ä¸€ä¸ªåä¸º â€œäºšç‘Ÿæ¡Œé¢â€ï¼ˆArthur Desktopï¼‰çš„ç¨‹åºï¼Œä»…ä»…æ˜¯ä¸ºäº†æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨å›¢é˜Ÿå¼€å‘çš„çª—å£ç®¡ç†å™¨ã€‚ä½†ä»–ä»¬å·²ç»æ²¡æœ‰æ—¶é—´äº†ï¼Œæ‰€ä»¥æ¼”ç¤ºç¨‹åºè¢«åˆ»å½•åˆ°äº†ç¬¬ä¸€æ‰¹è®¡ç®—æœºçš„åªè¯»å­˜å‚¨å™¨ï¼ˆROMï¼‰ä¸­ã€‚ é¦–æ‰¹ Archimedes æœºå‹äº 1987 å¹´ 6 æœˆå‘è´§ï¼Œå…¶ä¸­ä¸€äº›æœºå‹ä»å¸¦æœ‰ BBC å•†æ ‡ã€‚è¿™äº›è®¡ç®—æœºçš„è¿ç®—é€Ÿåº¦ç»å¯¹å¾ˆå¿«ï¼Œè€Œä¸”æ€§ä»·æ¯”å¾ˆé«˜â€“å…¥é—¨ä»·æ ¼ä¸º 800 è‹±é•‘ï¼Œåœ¨å½“æ—¶çº¦åˆ 1300 ç¾å…ƒã€‚è¿™ä¸ 1987 å¹´å”®ä»· 5500 ç¾å…ƒã€è®¡ç®—èƒ½åŠ›ç±»ä¼¼çš„ Macintosh II ç›¸æ¯”æ¯«ä¸é€Šè‰²ã€‚ ä½† Macintosh æ‹¥æœ‰ PageMakerã€Microsoft Word å’Œ Excel ä»¥åŠå¤§é‡å…¶ä»–å®ç”¨è½¯ä»¶ã€‚Archimedes æ˜¯ä¸€ä¸ªå…¨æ–°çš„è®¡ç®—æœºå¹³å°ï¼Œåœ¨å‘å¸ƒä¹‹åˆï¼Œå¯ç”¨çš„è½¯ä»¶å¹¶ä¸å¤šã€‚è®¡ç®—æœºä¸–ç•Œè¿…é€Ÿå‘IBM PCå…¼å®¹æœºå’ŒMacintoshesï¼ˆè¿˜æœ‰å‡ å¹´çš„Amigasï¼‰é æ‹¢ï¼Œå…¶ä»–äººéƒ½å‘ç°è‡ªå·±è¢«æŒ¤å‡ºäº†å¸‚åœºã€‚Archimedes ç”µè„‘åœ¨è‹±å›½åª’ä½“ä¸Šè·å¾—äº†è‰¯å¥½çš„è¯„ä»·ï¼Œå¹¶èµ¢å¾—äº†ä¸€æ‰¹ç‹‚çƒ­çš„ç²‰ä¸ï¼Œä½†åœ¨æœ€åˆçš„å‡ å¹´é‡Œï¼ŒArchimedes ç”µè„‘çš„é”€é‡è¿˜ä¸åˆ°10ä¸‡å°ã€‚ ç§å­æˆé•¿ Acorn è¿…é€Ÿä¿®å¤äº†äºšç‘Ÿä¸­çš„é”™è¯¯ï¼Œå¹¶å¼€å‘å‡ºå…·æœ‰æ›´å¤šç°ä»£åŠŸèƒ½çš„æ›¿ä»£æ“ä½œç³»ç»Ÿ RISC OSã€‚RISC OS äº 1989 å¹´æ¨å‡ºï¼Œéšåä¸ä¹…ï¼ŒARM CPU çš„æ–°ç‰ˆæœ¬ V3 ä¹Ÿéšä¹‹æ¨å‡ºã€‚ V3 èŠ¯ç‰‡é‡‡ç”¨ 1.5 å¾®ç±³å·¥è‰ºåˆ¶é€ ï¼Œå°† ARM2 å†…æ ¸çš„å°ºå¯¸ç¼©å°åˆ°çº¦å››åˆ†ä¹‹ä¸€çš„å¯ç”¨èŠ¯ç‰‡ç©ºé—´ã€‚è¿™å°±ä¸ºåŒ…å« 4 åƒå­—èŠ‚çš„å¿«é€Ÿä¸€çº§é«˜é€Ÿç¼“å†²å­˜å‚¨å™¨ç•™å‡ºäº†ç©ºé—´ã€‚æ—¶é’Ÿé€Ÿåº¦ä¹Ÿæé«˜åˆ° 25 MHzã€‚ è™½ç„¶è¿™äº›æ”¹è¿›ç»™äººç•™ä¸‹äº†æ·±åˆ»å°è±¡ï¼Œä½†ç´¢è²-å¨å°”é€Šç­‰å·¥ç¨‹å¸ˆç›¸ä¿¡ï¼ŒARM èŠ¯ç‰‡è¿˜èƒ½æ›´è¿›ä¸€æ­¥ã€‚ä½†æ˜¯ï¼Œåœ¨ Acorn èµ„æºè¿…é€Ÿå‡å°‘çš„æƒ…å†µä¸‹ï¼Œèƒ½åšçš„äº‹æƒ…æ˜¯æœ‰é™çš„ã€‚ä¸ºäº†å®ç°è¿™äº›æ¢¦æƒ³ï¼ŒARM å›¢é˜Ÿéœ€è¦å¯»æ‰¾å¤–éƒ¨æŠ•èµ„è€…ã€‚ è¿™æ—¶ï¼Œå¦ä¸€å®¶ä»¥ä¸€ç§æµè¡Œæ°´æœå‘½åçš„è®¡ç®—æœºå…¬å¸çš„ä»£è¡¨èµ°äº†è¿›æ¥ã€‚ã€‚ã€‚","categories":[{"name":"Hardware","slug":"Hardware","permalink":"https://blog.inoki.cc/categories/Hardware/"}],"tags":[{"name":"ç¿»è¯‘","slug":"ç¿»è¯‘","permalink":"https://blog.inoki.cc/tags/ç¿»è¯‘/"},{"name":"ä¸­æ–‡","slug":"ä¸­æ–‡","permalink":"https://blog.inoki.cc/tags/ä¸­æ–‡/"},{"name":"Hardware","slug":"Hardware","permalink":"https://blog.inoki.cc/tags/Hardware/"},{"name":"ARM","slug":"ARM","permalink":"https://blog.inoki.cc/tags/ARM/"}]},{"title":"ã€è¯‘ã€‘æ¢ç´¢é«˜é€šçš„å®‰å…¨æ‰§è¡Œç¯å¢ƒ","slug":"exploring-qualcomms-secure-execution-env","date":"2023-04-30T13:20:00.000Z","updated":"2025-03-08T09:40:48.609Z","comments":true,"path":"2023/04/30/exploring-qualcomms-secure-execution-env/","link":"","permalink":"https://blog.inoki.cc/2023/04/30/exploring-qualcomms-secure-execution-env/","excerpt":"","text":"åœ¨æœ¬åšå®¢ä¸­ï¼Œæˆ‘ä»¬å°†å†æ¬¡æ·±å…¥æ¢è®¨ TrustZone çš„ä¸–ç•Œï¼Œå¹¶æ¢ç´¢ä¸€ç³»åˆ—æ–°çš„æ¼æ´å’Œç›¸åº”çš„åˆ©ç”¨ç¨‹åºï¼Œè¿™äº›æ¼æ´å’Œåˆ©ç”¨ç¨‹åºå°†ä½¿æˆ‘ä»¬èƒ½å¤Ÿä»é›¶æƒé™æå‡ç‰¹æƒï¼Œä»¥åœ¨ TrustZone å†…æ ¸ä¸­æ‰§è¡Œä»£ç ã€‚ å¯¹äºé‚£äº›é˜…è¯»è¿‡ä¹‹å‰ç³»åˆ—çš„äººæ¥è¯´ï¼Œè¿™å¯èƒ½å¬èµ·æ¥å¾ˆç†Ÿæ‚‰ - ä½†æ˜¯è®©æˆ‘å‘æ‚¨ä¿è¯;è¿™ä¸ªç³»åˆ—å°†ä¼šæ›´åŠ ä»¤äººå…´å¥‹ï¼ é¦–å…ˆï¼Œè¿™ä¸ªæ¼æ´é“¾å…·æœ‰é€šç”¨æ€§ï¼Œé€‚ç”¨äºæ‰€æœ‰ Android ç‰ˆæœ¬å’Œæ‰‹æœºï¼ˆè€Œä¸”ä¸éœ€è¦ä»»ä½•æƒé™ï¼‰ï¼Œå¹¶ä¸”ä¸€ä¸ªå½±å“å¹¿æ³›çš„ TrustZone æ¼æ´ã€‚å…¶æ¬¡ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢è®¨ä¸€ä¸ªå°šæœªè¢«æ¢ç´¢çš„æ“ä½œç³»ç»Ÿ - QSEE - é«˜é€šçš„å®‰å…¨æ‰§è¡Œç¯å¢ƒã€‚æœ€åï¼Œæˆ‘ä»¬å°†çœ‹åˆ°ä¸€äº›æœ‰è¶£çš„ TrustZone æœ‰æ•ˆè½½è·ï¼Œä¾‹å¦‚ç›´æ¥ä» TrustZone çš„åŠ å¯†æ–‡ä»¶ç³»ç»Ÿä¸­æå–çœŸå®æŒ‡çº¹ã€‚ å¦‚æœæ‚¨æƒ³è·Ÿéšç¬¦å·å’Œåæ±‡ç¼–äºŒè¿›åˆ¶æ–‡ä»¶è¿›è¡Œå­¦ä¹ ï¼Œæˆ‘å°†åœ¨æ•´ä¸ªç³»åˆ—ä¸­ä½¿ç”¨æˆ‘çš„Nexus 6ï¼Œå…¶æŒ‡çº¹å¦‚ä¸‹ï¼š google/shamu/shamu:5.1.1/LMY48M/2167285:user/release-keys æ‚¨å¯ä»¥åœ¨æ­¤å¤„æ‰¾åˆ°ç¡®åˆ‡çš„å‡ºå‚é•œåƒã€‚ å™¢ï¼ŒQSEE èƒ½å¦è¯´å¾—ä¸Šå®‰å…¨ï¼Ÿ åœ¨è¿™ç¯‡åšå®¢æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†æ¢ç´¢é«˜é€šçš„å®‰å…¨æ‰§è¡Œç¯å¢ƒ QSEEã€‚ æ­£å¦‚æˆ‘ä»¬ä¹‹å‰è®¨è®ºçš„é‚£æ ·ï¼Œè®¾å¤‡ä¸ŠåŒ…å« TrustZone çš„ä¸»è¦åŸå› ä¹‹ä¸€æ˜¯æä¾›â€œå¯ä¿¡æ‰§è¡Œç¯å¢ƒâ€(TEE)â€”â€”ä¸€ä¸ªç†è®ºä¸Šå¯ä»¥å…è®¸è®¡ç®—è€Œä¸ä¼šè¢«å¸¸è§„æ“ä½œç³»ç»Ÿå¹²æ‰°çš„ç¯å¢ƒï¼Œå› æ­¤æ˜¯â€œå¯ä¿¡çš„â€ã€‚ è¿™æ˜¯é€šè¿‡åˆ›å»ºä¸€ä¸ªä»…åœ¨ç”± TrustZone æä¾›çš„â€œå®‰å…¨ä¸–ç•Œâ€ä¸­è¿è¡Œçš„å°å‹æ“ä½œç³»ç»Ÿæ¥å®ç°çš„ã€‚è¿™ä¸ªæ“ä½œç³»ç»Ÿç›´æ¥æä¾›ä¸€äº›ç³»ç»Ÿè°ƒç”¨å½¢å¼çš„å°‘é‡æœåŠ¡ï¼Œè¿™äº›è°ƒç”¨è¢« TrustZone å†…æ ¸(TZBSP)æœ¬èº«å¤„ç†ã€‚ç„¶è€Œï¼Œä¸ºäº†å…è®¸å¯æ‰©å±•çš„æ¨¡å‹ï¼Œå…¶ä¸­å¯ä»¥æ·»åŠ â€œå¯ä¿¡â€çš„åŠŸèƒ½ï¼ŒTrustZone å†…æ ¸è¿˜å¯ä»¥å®‰å…¨åœ°åŠ è½½å’Œæ‰§è¡Œç§°ä¸ºâ€œTrustletâ€çš„å°ç¨‹åºï¼Œè¿™äº›ç¨‹åºæ—¨åœ¨ä¸ºä¸å®‰å…¨çš„(â€œæ­£å¸¸ä¸–ç•Œâ€)æ“ä½œç³»ç»Ÿ(åœ¨æˆ‘ä»¬çš„æƒ…å†µä¸‹æ˜¯ Android)æä¾›å®‰å…¨æœåŠ¡ã€‚ è¿™äº› Trustlet åœ¨è®¾å¤‡ä¸Šé€šå¸¸ä¼šè¢«å¹¿æ³›ä½¿ç”¨ï¼š keymasterï¼šå®ç°äº†ç”± Android å¯†é’¥åº“å®ˆæŠ¤ç¨‹åºæä¾›çš„å¯†é’¥ç®¡ç† APIã€‚å®ƒå¯ä»¥å®‰å…¨åœ°ç”Ÿæˆå’Œå­˜å‚¨åŠ å¯†å¯†é’¥ï¼Œå¹¶å…è®¸ç”¨æˆ·ä½¿ç”¨è¿™äº›å¯†é’¥å¯¹æ•°æ®è¿›è¡Œæ“ä½œã€‚ widevineï¼šå®ç°äº† Widevine DRMï¼Œå…è®¸åœ¨è®¾å¤‡ä¸Šå®‰å…¨æ’­æ”¾åª’ä½“ã€‚ å®é™…ä¸Šï¼Œæ ¹æ® OEM å’Œè®¾å¤‡çš„ä¸åŒï¼Œå¯èƒ½ä¼šæœ‰æ›´å¤šä¸ DRM ç›¸å…³çš„ Trustletï¼Œä½†è¿™ä¸¤ä¸ª Trustlet è¢«å¹¿æ³›ä½¿ç”¨ã€‚ æˆ‘ä»¬ä»å“ªé‡Œå¼€å§‹ï¼Ÿ è‡ªç„¶è€Œç„¶çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©ä¸€ä¸ª Trustlet æ¥å¼€å§‹ï¼Œå°è¯•ç†è§£å…¶å·¥ä½œåŸç†ã€‚ç”±äº widevine æ¨¡å—æ˜¯æœ€æ™®éçš„ä¹‹ä¸€ï¼Œæˆ‘ä»¬å°†é‡ç‚¹å…³æ³¨å®ƒã€‚ ç®€è¦æœç´¢è®¾å¤‡å›ºä»¶ä¸­çš„ widevine Trustletï¼Œå¯ä»¥å‘ç°ä»¥ä¸‹å†…å®¹ï¼š æ˜¾ç„¶ï¼ŒTrustlet è¢«åˆ†æˆäº†å‡ ä¸ªä¸åŒçš„æ–‡ä»¶â€¦æ‰“å¼€è¿™äº›æ–‡ä»¶ä¼šçœ‹åˆ°ä¸€å †æ··ä¹±çš„ä¸œè¥¿â€”â€”æœ‰äº›æ–‡ä»¶åŒ…å«çœ‹èµ·æ¥åƒæ˜¯ä»£ç çš„å†…å®¹ï¼Œè€Œå…¶ä»–æ–‡ä»¶åŒ…å« ELF å¤´å’Œå…ƒæ•°æ®ã€‚æ— è®ºå¦‚ä½•ï¼Œåœ¨æˆ‘ä»¬å¼€å§‹åæ±‡ç¼– Trustlet ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ä»è¿™ç§æ ¼å¼ä¸­ç†å‡ºä¸€äº›æ„ä¹‰ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æ‰“å¼€æ¯ä¸ªæ–‡ä»¶å¹¶çŒœæµ‹æ¯ä¸ª Blob çš„å«ä¹‰ï¼Œæˆ–è€…é€šè¿‡è·Ÿè¸ªè´Ÿè´£åŠ è½½ Trustlet çš„ä»£ç è·¯å¾„æ¥å®ç°ã€‚è®©æˆ‘ä»¬è¯•è¯•ä¸¤ç§æ–¹æ³•ã€‚ åŠ è½½ Trustlet ä¸ºäº†ä»&quot;æ­£å¸¸ä¸–ç•Œ&quot;ä¸­åŠ è½½ Trustletï¼Œåº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨ libQSEECom.so å…±äº«å¯¹è±¡ï¼Œè¯¥å¯¹è±¡å¯¼å‡ºå‡½æ•° QSEECom_start_app: å¾ˆä¸å¹¸ï¼Œè¿™ä¸ªåº“çš„æºä»£ç ä¸å¯ç”¨ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åå‘å·¥ç¨‹å®ç°å‡½æ•°ä»¥æ‰¾å‡ºå®ƒçš„ä½œç”¨ã€‚è¿™æ ·åšä¼šå‘ç°å®ƒæ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š æ‰“å¼€ /dev/qseecom è®¾å¤‡å¹¶è°ƒç”¨ä¸€äº› ioctl å‘½ä»¤è¿›è¡Œé…ç½®ã€‚ æ‰“å¼€ä¸ä¿¡ä»»åº”ç”¨ç¨‹åºç›¸å…³çš„ .mdt æ–‡ä»¶å¹¶ä»ä¸­è¯»å–å‰ 0x34 å­—èŠ‚ã€‚ ä½¿ç”¨ .mdt çš„ 0x34 å­—èŠ‚è®¡ç®— .bXX æ–‡ä»¶çš„æ•°é‡ã€‚ åˆ†é…ä¸€ä¸ªç‰©ç†è¿ç»­çš„ç¼“å†²åŒºï¼ˆä½¿ç”¨&quot;ion&quot;ï¼‰å¹¶å°† .mdt å’Œ .bXX æ–‡ä»¶å¤åˆ¶åˆ°å…¶ä¸­ã€‚ æœ€åï¼Œä½¿ç”¨åˆ†é…çš„ç¼“å†²åŒºè°ƒç”¨ ioctl æ¥åŠ è½½ä¿¡ä»»åº”ç”¨ç¨‹åºæœ¬èº«ã€‚ æ‰€ä»¥ï¼Œä»ç„¶æ²¡æœ‰æ‰¾åˆ°é•œåƒåŠ è½½çš„ç¡®åˆ‡æ–¹æ³•ï¼Œä½†æˆ‘ä»¬æ­£åœ¨æ¥è¿‘ç›®æ ‡ã€‚ é¦–å…ˆï¼Œæ•°å­— 0x34 å¯èƒ½çœ‹èµ·æ¥å¾ˆç†Ÿæ‚‰â€”â€”è¿™æ˜¯ ELF å¤´çš„å¤§å°ï¼ˆ32 ä½ï¼‰ã€‚æ‰“å¼€ MDT æ–‡ä»¶åå‘ç°ï¼Œå‰ 0x34 å­—èŠ‚ç¡®å®æ˜¯æœ‰æ•ˆçš„ ELF å¤´ï¼š æ­¤å¤–ï¼Œæˆ‘ä»¬åˆšåˆšæŸ¥çœ‹çš„ QSEECOM_start_app å‡½æ•°ä½¿ç”¨åç§»é‡ 0x2C å¤„çš„ WORD æ¥è®¡ç®— .bXX æ–‡ä»¶çš„æ•°é‡ã€‚æ­£å¦‚æ‚¨åœ¨ä¸Šé¢çœ‹åˆ°çš„é‚£æ ·ï¼Œè¿™å¯¹åº”äº ELF æ ‡å¤´ä¸­çš„ e_phnum å­—æ®µã€‚ ç”±äº e_phnum å­—æ®µé€šå¸¸ç”¨äºæŒ‡å®šç¨‹åºå¤´çš„æ•°é‡ï¼Œè¿™è¡¨æ˜æ¯ä¸ª .bXX æ–‡ä»¶å¯èƒ½åŒ…å«è¦åŠ è½½çš„ç¨‹åºçš„å•ä¸ªæ®µã€‚å®é™…ä¸Šï¼Œæ‰“å¼€æ¯ä¸ªæ–‡ä»¶éƒ½ä¼šæ˜¾ç¤ºå‡ºå†…å®¹ï¼Œçœ‹èµ·æ¥å¯èƒ½æ˜¯æ­£åœ¨åŠ è½½çš„ç¨‹åºçš„æ®µâ€¦â€¦ä½†æ˜¯ä¸ºäº†ç¡®ä¿ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°ç¨‹åºå¤´æœ¬èº«ï¼ˆå¹¶æŸ¥çœ‹å®ƒä»¬æ˜¯å¦ä¸ .bXX æ–‡ä»¶åŒ¹é…ï¼‰ã€‚ è¿›ä¸€æ­¥æŸ¥çœ‹ï¼Œ.mdt æ–‡ä»¶ä¸­çš„ä¸‹å‡ ä¸ªå—å®é™…ä¸Šæ˜¯ç¨‹åºå¤´æœ¬èº«ï¼Œæ¯ä¸ªå¤´æ–‡ä»¶å¯¹åº”ä¸€ä¸ªå­˜åœ¨çš„ .bXX æ–‡ä»¶ã€‚ è€Œä¸”ï¼Œç¡®è®¤äº†æˆ‘ä»¬ä¹‹å‰çš„æ€€ç–‘ï¼Œå®ƒä»¬çš„å¤§å°æ°å¥½ä¸ .bXX æ–‡ä»¶çš„å¤§å°åŒ¹é…ã€‚å¤ªå¥½äº†ï¼ è¯·æ³¨æ„ï¼Œä¸Šé¢çš„å‰ä¸¤ä¸ªç¨‹åºå¤´çœ‹èµ·æ¥æœ‰ç‚¹å¥‡æ€ª - å®ƒä»¬éƒ½æ˜¯ç©ºç±»å‹çš„å¤´ï¼Œæ„å‘³ç€å®ƒä»¬æ˜¯â€œä¿ç•™â€çš„ï¼Œä¸åº”åŠ è½½åˆ°ç»“æœ ELF æ˜ åƒä¸­ã€‚å¥‡æ€ªçš„æ˜¯ï¼Œæ‰“å¼€ç›¸åº”çš„ .bXX æ–‡ä»¶ä¼šå‘ç°ï¼Œç¬¬ä¸€ä¸ªå—åŒ…å«ä¸ .mdt ä¸­ç›¸åŒçš„ ELF å¤´å’Œç¨‹åºå¤´ï¼Œç¬¬äºŒä¸ªå—åŒ…å«å…¶ä½™çš„ .mdt æ–‡ä»¶ã€‚ æ— è®ºå¦‚ä½•ï¼Œè¿™æ˜¯ä¸€ä¸ªç®€çŸ­çš„ç¤ºæ„å›¾ï¼Œæ€»ç»“äº†æˆ‘ä»¬ç›®å‰æ‰€çŸ¥é“çš„å†…å®¹ï¼š æ­¤å¤–ï¼Œè¯·æ³¨æ„ç”±äº ELF å¤´æ–‡ä»¶å’Œç¨‹åºå¤´æ–‡ä»¶éƒ½åœ¨ .mdt ä¸­ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ readelf å¿«é€Ÿè½¬å‚¨æœ‰å…³ä¿¡ä»»æ‰§è¡Œç¯å¢ƒçš„ç¨‹åºå¤´ä¿¡æ¯ã€‚ åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œæˆ‘ä»¬å·²ç»æ‹¥æœ‰äº†ä» .mdt å’Œ .bXX æ–‡ä»¶åˆ›å»ºå®Œæ•´æœ‰æ•ˆçš„ ELF æ–‡ä»¶æ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ï¼›æˆ‘ä»¬æ‹¥æœ‰ ELF å¤´å’Œç¨‹åºå¤´ï¼Œä»¥åŠæ¯ä¸ªæ®µæœ¬èº«ã€‚æˆ‘ä»¬åªéœ€è¦ç¼–å†™ä¸€ä¸ªå°è„šæœ¬ï¼Œä½¿ç”¨è¿™äº›æ•°æ®åˆ›å»ºä¸€ä¸ª ELF æ–‡ä»¶ã€‚ æˆ‘ç¼–å†™äº†ä¸€ä¸ªå°çš„ Python è„šæœ¬ï¼Œæ­£æ˜¯è¿™æ ·åšçš„ã€‚æ‚¨å¯ä»¥åœ¨æ­¤å¤„æ‰¾åˆ°å®ƒï¼š ä¿¡ä»» Trustlets çš„æ€è€ƒ å¯¹ Trustlet çš„ä¿¡ä»»è¿‡ç¨‹ï¼Œæˆ‘ä»¬ç°åœ¨å·²ç»æœ‰äº†åŸºæœ¬çš„äº†è§£ï¼Œä½†æˆ‘ä»¬ä»ç„¶ä¸çŸ¥é“å®ƒä»¬æ˜¯å¦‚ä½•è¿›è¡ŒéªŒè¯çš„ã€‚ç„¶è€Œï¼Œç”±äºæˆ‘ä»¬çŸ¥é“ .bXX æ–‡ä»¶ä»…åŒ…å«è¦åŠ è½½çš„æ®µï¼Œè¿™æ„å‘³ç€è¿™äº›æ•°æ®å¿…é¡»é©»ç•™åœ¨ .mdt æ–‡ä»¶ä¸­ã€‚ å› æ­¤ï¼Œç°åœ¨æ˜¯çŒœæµ‹çš„æ—¶é—´â€”â€”å¦‚æœæˆ‘ä»¬è¦æ„å»ºä¸€ä¸ªå¯ä¿¡çš„åŠ è½½ç¨‹åºï¼Œæˆ‘ä»¬å°†å¦‚ä½•åšï¼Ÿ ä¸€ä¸ªéå¸¸å¸¸è§çš„èŒƒå¼æ˜¯ä½¿ç”¨å“ˆå¸Œå’Œç­¾åï¼ˆä¾èµ–äº CRHF å’Œæ•°å­—ç­¾åï¼‰ã€‚åŸºæœ¬ä¸Šâ€”â€”æˆ‘ä»¬è®¡ç®—è¦è¿›è¡Œèº«ä»½éªŒè¯çš„æ•°æ®çš„å“ˆå¸Œå€¼ï¼Œå¹¶ä½¿ç”¨å¯¹äºåŠ è½½å™¨å·²çŸ¥å…¶å¯¹åº”çš„å…¬å…±å¯†é’¥çš„ç§æœ‰å¯†é’¥è¿›è¡Œç­¾åã€‚ å¦‚æœæƒ…å†µæ˜¯è¿™æ ·çš„ï¼Œæˆ‘ä»¬åº”è¯¥åœ¨ .mdt ä¸­æ‰¾åˆ°ä»¥ä¸‹ä¸¤ä¸ªå†…å®¹ï¼š è¯ä¹¦é“¾ ç­¾åæ•°æ®å— è®©æˆ‘ä»¬ä»æŸ¥æ‰¾è¯ä¹¦é“¾å¼€å§‹ã€‚è¯ä¹¦æœ‰å¤ªå¤šçš„æ ¼å¼ï¼Œä½†ç”±äº .mdt æ–‡ä»¶ä»…åŒ…å«äºŒè¿›åˆ¶æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥å‡è®¾å®ƒå¯èƒ½æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶æ ¼å¼ï¼Œå…¶ä¸­æœ€å¸¸è§çš„æ˜¯ DER æ ¼å¼ã€‚ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ç§å¿«é€Ÿçš„ hack æ–¹æ³•æ¥æŸ¥æ‰¾ DER ç¼–ç çš„è¯ä¹¦â€”â€”å®ƒä»¬å‡ ä¹æ€»æ˜¯ä»¥ ASN.1 SEQUENCE å—å¼€å¤´ï¼Œç¼–ç ä¸ºï¼š0x30 0x82ã€‚æ‰€ä»¥è®©æˆ‘ä»¬åœ¨ .mdt ä¸­æœç´¢è¿™ä¸¤ä¸ªå­—èŠ‚ï¼Œå¹¶å°†æ¯ä¸ªæ‰¾åˆ°çš„å—ä¿å­˜åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ openssl æ£€æŸ¥è¿™äº›å—æ˜¯å¦ä¸ºæ ¼å¼è‰¯å¥½çš„è¯ä¹¦ï¼š æ˜¯çš„ï¼Œæˆ‘ä»¬çŒœå¯¹äº†â€“é‚£äº›æ˜¯è¯ä¹¦ã€‚ äº‹å®ä¸Šï¼Œè¯¥ä¿¡ä»»å°ç¨‹åºåŒ…å«ä¸‰ä¸ªè¯ä¹¦ï¼Œä¸€ä¸ªæ¥ä¸€ä¸ªã€‚ä¸ºäº†ç¨³å¦¥èµ·è§ï¼Œæˆ‘ä»¬å¯èƒ½è¿˜æƒ³æ£€æŸ¥ä¸€ä¸‹è¿™ä¸‰ä¸ªè¯ä¹¦å®é™…ä¸Šæ˜¯ä¸€ä¸ªè¯ä¹¦é“¾ï¼Œå½¢æˆäº†ä¸€ä¸ªæœ‰æ•ˆçš„ä¿¡ä»»é“¾ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æŠŠè¯ä¹¦è½¬å‚¨åˆ°ä¸€ä¸ªå•ä¸€çš„&quot;è¯ä¹¦é“¾&quot;æ–‡ä»¶ä¸­ï¼Œå¹¶ä½¿ç”¨ openssl æ¥éªŒè¯ä½¿ç”¨è¿™ä¸ªè¯ä¹¦é“¾çš„æ¯ä¸ªè¯ä¹¦æ¥åšåˆ°è¿™ä¸€ç‚¹ï¼š è‡³äºè¿™ä¸ªé“¾çš„ä¿¡ä»»æ ¹â€“çœ‹ä¸€ä¸‹é“¾ä¸­çš„æ ¹è¯ä¹¦å°±ä¼šå‘ç°ï¼Œè¿™ä¸ªæ ¹è¯ä¹¦ä¸é«˜é€šå…¬å¸å®‰å…¨å¯åŠ¨è¿‡ç¨‹ä¸­ç”¨äºéªŒè¯å¯åŠ¨é“¾çš„æ‰€æœ‰å…¶ä»–éƒ¨åˆ†çš„æ ¹è¯ä¹¦ç›¸åŒã€‚å¯¹è¿™ä¸€æœºåˆ¶è¿›è¡Œäº†ä¸€äº›ç ”ç©¶ï¼Œç»“æœè¡¨æ˜ï¼ŒéªŒè¯æ˜¯é€šè¿‡æ¯”è¾ƒæ ¹è¯ä¹¦çš„ SHA256 å’Œä¸€ä¸ªåä¸º OEM_PK_HASH çš„ç‰¹æ®Šå€¼è¿›è¡Œçš„ï¼Œè¯¥å€¼åœ¨ç”Ÿäº§è¿‡ç¨‹ä¸­è¢«&quot;èåˆ&quot;åˆ°è®¾å¤‡çš„ QFuse ä¸­ã€‚ç”±äºè¿™ä¸ªå€¼åœ¨è®¾å¤‡ç”Ÿäº§åç†è®ºä¸Šä¸åº”è¯¥è¢«ä¿®æ”¹ï¼Œè¿™æ„å‘³ç€ä¼ªé€ è¿™æ ·çš„æ ¹è¯ä¹¦åŸºæœ¬ä¸Šéœ€è¦å¯¹ SHA256 è¿›è¡Œç¬¬äºŒæ¬¡é¢„é•œåƒæ”»å‡»ã€‚ ç°åœ¨ï¼Œè®©æˆ‘ä»¬å›åˆ° .mdtâ€“æˆ‘ä»¬å·²ç»æ‰¾åˆ°äº†è¯ä¹¦é“¾ï¼Œæ‰€ä»¥ç°åœ¨æ˜¯æ—¶å€™å¯»æ‰¾ç­¾åäº†ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œç§é’¥æ˜¯ç”¨æ¥äº§ç”Ÿç­¾åçš„ï¼Œè€Œå…¬é’¥å¯ä»¥ç”¨æ¥æ¢å¤ç­¾åæ•°æ®ã€‚ç”±äºæˆ‘ä»¬æœ‰è¯ä¹¦é“¾ä¸­æœ€é¡¶ç«¯çš„è¯ä¹¦çš„å…¬é’¥ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥æŸ¥çœ‹æ–‡ä»¶ï¼Œå¹¶é€‚æ—¶åœ°å°è¯•&quot;æ¢å¤&quot;æ¯ä¸ª blobã€‚ ä½†æˆ‘ä»¬æ€ä¹ˆçŸ¥é“æˆ‘ä»¬æ˜¯å¦æˆåŠŸäº†å‘¢ï¼Ÿ å›æƒ³ä¸€ä¸‹ï¼ŒRSA æ˜¯ä¸€ä¸ªé™·é˜±é—¨æ’åˆ—æ—â€“æ¯ä¸€ä¸ªå…·æœ‰ä¸å…¬å…±æ¨¡æ•° N ç›¸åŒä½æ•°çš„ blob éƒ½è¢«æ˜ å°„åˆ°å¦ä¸€ä¸ªç›¸åŒå¤§å°çš„ blobã€‚ ç„¶è€Œï¼Œè™½ç„¶åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼ŒRSA çš„å…¬å…±æ¨¡æ•°æ˜¯ 2048 ä½ï¼Œä½†å¤§å¤šæ•°å“ˆå¸Œå€¼éƒ½æ¯”è¿™çŸ­å¾—å¤šï¼ˆSHA1 ä¸º 160 ä½ï¼ŒSHA256 ä¸º 256 ä½ï¼‰ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœæˆ‘ä»¬è¯•å›¾ç”¨æˆ‘ä»¬çš„å…¬é’¥&quot;è§£å¯†&quot;ä¸€ä¸ª blobï¼Œè€Œå®ƒæ°å¥½ä»¥å¤§é‡çš„&quot;æ¾å¼›&quot;ç©ºé—´ç»“æŸï¼ˆä¾‹å¦‚ï¼Œ0 å­—èŠ‚ï¼‰ï¼Œæœ‰ä¸€ä¸ªéå¸¸å¥½çš„æœºä¼šï¼Œè¿™æ˜¯æˆ‘ä»¬æ­£åœ¨å¯»æ‰¾çš„ç­¾åï¼ˆå¯¹äºä¸€ä¸ªå®Œå…¨éšæœºçš„æ’åˆ—ç»„åˆï¼Œè¿ç»­ n ä¸ªé›¶ä½çš„æœºä¼šæ˜¯ 2^-n - å³ä½¿æ˜¯ä¸€ä¸ªä¸­ç­‰çš„ nï¼Œä¹Ÿéå¸¸å°ï¼‰ã€‚ ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘å†™äº†ä¸€ä¸ªå°ç¨‹åºï¼Œä»é“¾ä¸­æœ€é¡¶ç«¯çš„è¯ä¹¦ä¸­åŠ è½½å…¬é’¥ï¼Œå¹¶å°è¯•&quot;æ¢å¤&quot; .mdt ä¸­çš„æ¯ä¸ª blobï¼ˆä½¿ç”¨å¸¦æœ‰ PKCS #1 v1.5 å¡«å……çš„ rsa_public_decryptï¼‰ã€‚å¦‚æœ â€œæ¢å¤çš„â€ blob ä»¥ä¸€å † 0 å­—èŠ‚ç»“å°¾ï¼Œç¨‹åºå°±ä¼šè¾“å‡ºå®ƒã€‚æ‰€ä»¥â€¦åœ¨æˆ‘ä»¬çš„ .mdt ä¸Šè¿è¡Œå®ƒï¼š æˆ‘ä»¬å·²ç»æ‰¾åˆ°äº†ä¸€ä¸ªç­¾å! å¤ªå¥½äº†ã€‚ æ›´é‡è¦çš„æ˜¯ï¼Œè¿™ä¸ªç­¾åæœ‰ 256 æ¯”ç‰¹é•¿ï¼Œè¿™æ„å‘³ç€å®ƒå¯èƒ½æ˜¯ä¸€ä¸ª SHA256 å“ˆå¸Œå€¼â€¦ å¦‚æœ .mdt é‡Œæœ‰ä¸€ä¸ª SHA256ï¼Œä¹Ÿè®¸è¿˜æœ‰æ›´å¤šï¼Ÿ å†ä¸€æ¬¡çš„å¹¸è¿! æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ¯ä¸ª .bXX æ–‡ä»¶çš„ SHA256 å“ˆå¸Œå€¼ä¹Ÿè¿ç»­å­˜å‚¨åœ¨ .mdt ä¸­ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥åšä¸€ä¸ªæœ‰æ ¹æ®çš„çŒœæµ‹ï¼Œè¿™å°†æ˜¯è¢«ç­¾åçš„æ•°æ®ï¼ˆæˆ–è‡³å°‘æ˜¯éƒ¨åˆ†æ•°æ®ï¼‰ï¼Œä»¥äº§ç”Ÿæˆ‘ä»¬ä¹‹å‰å‘ç°çš„ç­¾åã€‚ æ³¨æ„ï¼Œ.b01 æ–‡ä»¶çš„å“ˆå¸Œå€¼ä¸è§äº†â€“è¿™æ˜¯ä¸ºä»€ä¹ˆï¼Ÿè®°ä½ï¼Œ.b01 æ–‡ä»¶åŒ…å«äº† .mdt ä¸­é™¤ ELF å¤´å’Œç¨‹åºå¤´ä»¥å¤–çš„æ‰€æœ‰æ•°æ®ã€‚ç”±äºè¿™äº›æ•°æ®ä¹ŸåŒ…å«ä¸Šé¢çš„ç­¾åï¼Œè€Œç­¾åï¼ˆå¯èƒ½ï¼‰æ˜¯é€šè¿‡å—æ–‡ä»¶çš„å“ˆå¸Œå€¼äº§ç”Ÿçš„ï¼Œè¿™å°†å¯¼è‡´å¾ªç¯ä¾èµ–ï¼ˆå› ä¸ºæ”¹å˜å—æ–‡ä»¶å°†æ”¹å˜å“ˆå¸Œå€¼ï¼Œè¿™å°†æ”¹å˜ç­¾åï¼Œè¿™å°†å†æ¬¡æ”¹å˜å—æ–‡ä»¶ï¼Œç­‰ç­‰ï¼‰ã€‚å› æ­¤ï¼Œè¿™ä¸ªåŒºå—çš„å“ˆå¸Œå€¼ä¸å­˜åœ¨æ˜¯æœ‰é“ç†çš„ã€‚ ç°åœ¨æˆ‘ä»¬å®é™…ä¸Šå·²ç»è§£ç äº† .mdt æ–‡ä»¶ä¸­çš„æ‰€æœ‰æ•°æ®ï¼Œé™¤äº†ä¸€ä¸ªä½äºç¨‹åºå¤´ä¹‹åçš„å°ç»“æ„ã€‚ç„¶è€Œï¼Œåœ¨çœ‹äº†ä¸€ä¼šå„¿ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ƒåªæ˜¯åŒ…å«äº†æˆ‘ä»¬å·²ç»è§£ç çš„ .mdt ä¸­å„ä¸ªéƒ¨åˆ†çš„æŒ‡é’ˆå’Œé•¿åº¦ï¼š æ‰€ä»¥æœ€åï¼Œæˆ‘ä»¬å·²ç»è§£ç äº† .mdt ä¸­çš„æ‰€æœ‰ä¿¡æ¯â€¦ æ‘©æ‰˜ç½—æ‹‰çš„é«˜ä¿éšœå¯åŠ¨ å°½ç®¡æˆ‘ä»¬åœ¨ä¸Šé¢çœ‹åˆ°çš„ .mdt æ–‡ä»¶æ ¼å¼å¯¹æ‰€æœ‰çš„ OEM æ¥è¯´éƒ½æ˜¯é€šç”¨çš„ï¼Œä½†æ‘©æ‰˜ç½—æ‹‰å†³å®šå¢åŠ ä¸€ä¸ªå°æ’æ›²ã€‚ ä»–ä»¬æ²¡æœ‰åƒæˆ‘ä»¬ä¹‹å‰çœ‹åˆ°çš„é‚£æ ·æä¾›ä¸€ä¸ª RSA ç­¾åï¼Œè€Œæ˜¯å®é™…ä¸Šå°†ç­¾å blob ç•™ç©ºï¼ˆäº‹å®ä¸Šï¼Œæˆ‘ä¹‹å‰ç»™ä½ çœ‹çš„ç­¾åæ˜¯æ¥è‡ª Nexus 5ï¼‰ã€‚äº‹å®ä¸Šï¼Œæ‘©æ‰˜ç½—æ‹‰çš„ç­¾åçœ‹èµ·æ¥åƒè¿™æ ·ï¼š é‚£ä¹ˆï¼Œå›¾åƒæ˜¯å¦‚ä½•è¢«éªŒè¯çš„å‘¢ï¼Ÿ è¿™æ˜¯é€šè¿‡ä½¿ç”¨æ‘©æ‰˜ç½—æ‹‰ç§°ä¹‹ä¸º HABï¼ˆâ€œé«˜ä¿éšœå¯åŠ¨â€ï¼‰çš„æœºåˆ¶æ¥å®Œæˆçš„ã€‚è¿™ä¸ªæœºåˆ¶å…è®¸ä»–ä»¬é€šè¿‡åœ¨æ–‡ä»¶æœ«å°¾é™„åŠ ä¸€ä¸ªè¯ä¹¦é“¾å’Œæ•´ä¸ª .mdt çš„ç­¾åæ¥éªŒè¯ .mdt æ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨ HAB ä½¿ç”¨çš„ä¸“æœ‰æ ¼å¼è¿›è¡Œç¼–ç ï¼š å…³äºè¿™ä¸€æœºåˆ¶çš„æ›´å¤šä¿¡æ¯ï¼Œä½ å¯ä»¥æŸ¥çœ‹ Tal Aloni çš„è¿™é¡¹ç ”ç©¶ã€‚ç®€è€Œè¨€ä¹‹ï¼Œ.mdt ä½¿ç”¨è¯ä¹¦é“¾ä¸­æœ€é¡¶ç«¯çš„å¯†é’¥è¿›è¡Œæ•£åˆ—å’Œç­¾åï¼Œè€Œè¯ä¹¦é“¾ä¸­çš„æ ¹è¯ä¹¦åˆ™ä½¿ç”¨ &quot;è¶…çº§æ ¹å¯†é’¥ &quot;è¿›è¡ŒéªŒè¯ï¼Œè¯¥å¯†é’¥æ˜¯åœ¨å¼•å¯¼ç¨‹åºçš„æŸä¸ªé˜¶æ®µç¡¬ç¼–ç çš„ã€‚ Trustlet çš„ç”Ÿå‘½å‘¨æœŸ åœ¨æˆ‘ä»¬ä¸Šé¢çœ‹åˆ°çš„éªŒè¯è¿‡ç¨‹ä¹‹åï¼ŒTrustZone å†…æ ¸å°† Trustlet çš„ç‰‡æ®µåŠ è½½åˆ°&quot;æ­£å¸¸ä¸–ç•Œ&quot;æ— æ³•è®¿é—®çš„å®‰å…¨å†…å­˜åŒºåŸŸï¼ˆsecapp-regionï¼‰ï¼Œå¹¶ç»™å®ƒåˆ†é…äº†ä¸€ä¸ª IDã€‚ ç„¶åï¼Œå†…æ ¸åˆ‡æ¢åˆ°&quot;å®‰å…¨ä¸–ç•Œ&quot;çš„ç”¨æˆ·æ¨¡å¼ï¼Œæ‰§è¡Œ Trustlet çš„å…¥å£å‡½æ•°ï¼š æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼ŒTrustlet å‘ TrustZone å†…æ ¸æ³¨å†Œäº†è‡ªå·±ï¼ŒåŒæ—¶è¿˜æœ‰ä¸€ä¸ª&quot;å¤„ç†å‡½æ•°&quot;ã€‚åœ¨æ³¨å†Œå®Œ Trustlet åï¼Œæ§åˆ¶æƒè¢«è¿”å›åˆ° TrustZone å†…æ ¸ï¼ŒåŠ è½½è¿‡ç¨‹ç»“æŸäº†ã€‚ ç°åœ¨ï¼Œä¸€æ—¦ Trustlet è¢«åŠ è½½ï¼Œ&quot;æ­£å¸¸ä¸–ç•Œ&quot;å¯ä»¥é€šè¿‡å‘å‡ºä¸€ä¸ªç‰¹æ®Šçš„ SCM è°ƒç”¨ï¼ˆç§°ä¸º QSEOS_CLIENT_SEND_DATA_COMMANDï¼‰å‘ Trustlet å‘é€å‘½ä»¤ï¼Œå…¶ä¸­åŒ…å«åŠ è½½ Trustlet çš„ ID ä»¥åŠè¯·æ±‚å’Œå“åº”ç¼“å†²åŒºã€‚ä¸‹é¢æ˜¯å®ƒçš„æ ·å­ï¼š TrustZone å†…æ ¸ï¼ˆTZBSPï¼‰æ”¶åˆ° SCM è°ƒç”¨ï¼Œå°†å…¶æ˜ å°„åˆ° QSEOSï¼Œç„¶åæ‰¾åˆ°å…·æœ‰ç»™å®š ID çš„åº”ç”¨ç¨‹åºï¼Œå¹¶è°ƒç”¨å…ˆå‰æ³¨å†Œçš„å¤„ç†å‡½æ•°ï¼ˆæ¥è‡ª&quot;å®‰å…¨ä¸–ç•Œ&quot;ç”¨æˆ·æ¨¡å¼ï¼‰ï¼Œä»¥ä¾¿ä¸ºè¯·æ±‚æœåŠ¡ã€‚ ä¸‹ä¸€æ­¥æ˜¯ä»€ä¹ˆï¼Ÿ ç°åœ¨æˆ‘ä»¬å¯¹ä»€ä¹ˆæ˜¯ Trustlet ä»¥åŠå®ƒä»¬æ˜¯å¦‚ä½•åŠ è½½æœ‰äº†ä¸€äº›äº†è§£ï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­è¿›è¡Œæ”»å‡»äº†ï¼åœ¨ä¸‹ä¸€ç¯‡åšæ–‡ä¸­ï¼Œæˆ‘ä»¬å°†å‘ç°ä¸€ä¸ªéå¸¸æµè¡Œçš„ Trustlet ä¸­çš„æ¼æ´ï¼Œå¹¶åˆ©ç”¨å®ƒåœ¨ QSEE ä¸­æ‰§è¡Œä»£ç ã€‚","categories":[{"name":"Linux","slug":"Linux","permalink":"https://blog.inoki.cc/categories/Linux/"},{"name":"Android","slug":"Linux/Android","permalink":"https://blog.inoki.cc/categories/Linux/Android/"}],"tags":[{"name":"ä¸­æ–‡","slug":"ä¸­æ–‡","permalink":"https://blog.inoki.cc/tags/ä¸­æ–‡/"},{"name":"Linux","slug":"Linux","permalink":"https://blog.inoki.cc/tags/Linux/"},{"name":"Android","slug":"Android","permalink":"https://blog.inoki.cc/tags/Android/"},{"name":"ABL","slug":"ABL","permalink":"https://blog.inoki.cc/tags/ABL/"},{"name":"Bootloader","slug":"Bootloader","permalink":"https://blog.inoki.cc/tags/Bootloader/"}]},{"title":"ã€è¯‘ã€‘å®Œæ•´çš„ MSM8974 TrustZone å®ç°åˆ©ç”¨","slug":"full-trustzone-exploit-for-msm8974","date":"2023-04-30T11:20:00.000Z","updated":"2025-03-08T09:40:48.609Z","comments":true,"path":"2023/04/30/full-trustzone-exploit-for-msm8974/","link":"","permalink":"https://blog.inoki.cc/2023/04/30/full-trustzone-exploit-for-msm8974/","excerpt":"","text":"åœ¨è¿™ç¯‡åšå®¢æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†æ¶µç›–åˆ©ç”¨å…ˆå‰æ–‡ç« ä¸­æè¿°çš„ TrustZone æ¼æ´çš„å®Œæ•´è¿‡ç¨‹ã€‚å¦‚æœä½ è¿˜æ²¡æœ‰é˜…è¯»å®ƒï¼Œè¯·å…ˆé˜…è¯»ï¼ è´Ÿè´£ä»»çš„æŠ«éœ² é¦–å…ˆï¼Œæˆ‘è¦æŒ‡å‡ºæˆ‘å·²ç»å‘é«˜é€šè´Ÿè´£ä»»åœ°æŠ«éœ²äº†è¿™ä¸ªæ¼æ´ï¼Œå¹¶ä¸”é—®é¢˜å·²ç»å¾—åˆ°è§£å†³ï¼ˆè§ä¸‹æ–‡çš„æ—¶é—´è½´ï¼‰ã€‚ æˆ‘è¿˜æƒ³åˆ©ç”¨è¿™ä¸ªæœºä¼šæŒ‡å‡ºï¼Œé«˜é€šåœ¨å›åº”æŠ«éœ²æ–¹é¢åšå¾—éå¸¸å‡ºè‰²ï¼Œéå¸¸ç§¯æåœ°è§£å†³é—®é¢˜ã€‚ ä»–ä»¬è¿˜é€äº†æˆ‘ä¸€å°å…¨æ–°çš„ï¼ˆå½“æ—¶ï¼‰Moto X 2014ï¼Œå®ƒå°†æˆä¸ºä»¥åè®¸å¤šå¸–å­çš„ä¸»é¢˜ï¼ˆæ·±å…¥æ¢è®¨ TrustZone çš„æ¶æ„å’Œè®¾å¤‡ä¸Šçš„å…¶ä»–å®‰å…¨ç»„ä»¶ï¼‰ã€‚ é›¶å·æ‚£è€… åœ¨å¼€å‘æ­¤æ¼æ´åˆ©ç”¨ç¨‹åºæ—¶ï¼Œæˆ‘åªæœ‰æˆ‘çš„å¯é ï¼ˆä¸ªäººï¼‰Nexus 5 è®¾å¤‡å¯ä¾›ä½¿ç”¨ã€‚è¿™æ„å‘³ç€ä¸‹é¢æ‰€æœ‰çš„å†…å­˜åœ°å€å’Œå…¶ä»–å…·ä½“ä¿¡æ¯éƒ½æ˜¯ä»è¯¥è®¾å¤‡ä¸­å–å¾—çš„ã€‚ å¦‚æœæœ‰äººæƒ³é‡æ–°åˆ›å»ºä¸‹é¢æ‰€æè¿°çš„ç²¾ç¡®ç ”ç©¶ï¼Œæˆ–è€…ç”±äºä»»ä½•å…¶ä»–åŸå› ï¼Œæˆ‘çš„è®¾å¤‡åœ¨å½“æ—¶çš„ç¡®åˆ‡ç‰ˆæœ¬æ˜¯ï¼š google/hammerhead/hammerhead:4.4.4/KTU84P/1227136:user/release-keys æœ‰äº†è¿™ä¸ªï¼Œæˆ‘ä»¬å°±å¼€å§‹å§ï¼ æ¼æ´åŸè¯­ å¦‚æœä½ è¯»è¿‡ä¸Šä¸€ç¯‡æ–‡ç« ï¼Œä½ å·²ç»çŸ¥é“è¿™ä¸ªæ¼æ´å…è®¸æ”»å‡»è€…åœ¨ TrustZone å†…æ ¸çš„è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­çš„ä»»ä½•åœ°å€å†™å…¥ DWORD 0ã€‚ åŸºäºä¸ªäººç»éªŒï¼Œé›¶å†™åŸè¯­å¹¶ä¸æ˜¯å¾ˆæœ‰è¶£ã€‚å®ƒä»¬é€šå¸¸ç›¸å½“æœ‰é™ï¼Œä¸ä¸€å®šå¯¼è‡´å¯åˆ©ç”¨çš„æƒ…å†µã€‚ä¸ºäº†ä½¿ç”¨è¿™ç§å¼±åŸè¯­åˆ›å»ºä¸€ä¸ªå¥å£®çš„æ¼æ´åˆ©ç”¨ç¨‹åºï¼Œé¦–è¦è¡ŒåŠ¨æ˜¯å°è¯•åˆ©ç”¨è¿™ä¸ªå¼±åŸè¯­æ¥å»ºç«‹ä¸€ä¸ªæ›´å¼ºçš„åŸè¯­ã€‚ åˆ›å»ºä»»æ„å†™åŸè¯­ ç”±äº TrustZone å†…æ ¸åŠ è½½åœ¨å·²çŸ¥çš„ç‰©ç†åœ°å€ä¸Šï¼Œè¿™æ„å‘³ç€æ‰€æœ‰åœ°å€å·²ç»äº‹å…ˆçŸ¥é“ï¼Œä¸éœ€è¦åœ¨æ‰§è¡Œæ—¶å‘ç°ã€‚ ç„¶è€Œï¼ŒTrustZone å†…æ ¸çš„å†…éƒ¨æ•°æ®ç»“æ„å’ŒçŠ¶æ€å¾ˆå¤§ç¨‹åº¦ä¸Šæ˜¯æœªçŸ¥çš„ï¼Œå¹¶ä¸”ç”±äºè®¸å¤šä¸åŒçš„è¿›ç¨‹ä¸ TrustZone å†…æ ¸äº¤äº’ï¼ˆä»å¤–éƒ¨ä¸­æ–­åˆ°â€œå®‰å…¨ä¸–ç•Œâ€åº”ç”¨ç¨‹åºç­‰ï¼‰ï¼Œå®ƒä»¬å¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–ã€‚ æ­¤å¤–ï¼ŒTrustZone ä»£ç æ®µè¢«æ˜ å°„ä¸ºåªè¯»è®¿é—®æƒé™ï¼Œå¹¶ä¸”åœ¨å®‰å…¨å¯åŠ¨è¿‡ç¨‹ä¸­è¿›è¡ŒéªŒè¯ã€‚è¿™æ„å‘³ç€ä¸€æ—¦ TrustZone çš„ä»£ç åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œç†è®ºä¸Šä¸åº”è¯¥å†å‘ç”Ÿä»»ä½•æ”¹å˜ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•åˆ©ç”¨é›¶å†™åŸè¯­æ¥å®ç°å®Œæ•´ä»£ç æ‰§è¡Œå‘¢ï¼Ÿ æˆ‘ä»¬å¯ä»¥å°è¯•ç¼–è¾‘ TrustZone å†…æ ¸ä¸­çš„ä»»ä½•å¯ä¿®æ”¹æ•°æ®ï¼ˆä¾‹å¦‚å †ã€æ ˆæˆ–å…¨å±€å˜é‡ï¼‰ï¼Œè¿™å¯èƒ½ä¼šä¸ºæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ›´å¥½çš„åŸè¯­çš„å«è„šçŸ³ã€‚ æ­£å¦‚æˆ‘ä»¬åœ¨ä¸Šä¸€ç¯‡åšå®¢æ–‡ç« ä¸­æåˆ°çš„é‚£æ ·ï¼Œé€šå¸¸åœ¨è°ƒç”¨ SCM å‘½ä»¤æ—¶ï¼Œä»»ä½•æŒ‡å‘å†…å­˜çš„å‚æ•°éƒ½ä¼šè¢« TrustZone å†…æ ¸éªŒè¯ã€‚éªŒè¯æ˜¯ä¸ºäº†ç¡®ä¿ç‰©ç†åœ°å€åœ¨â€œå…è®¸â€çš„èŒƒå›´å†…ï¼Œè€Œä¸æ˜¯ä¾‹å¦‚åœ¨ TrustZone å†…æ ¸ä½¿ç”¨çš„å†…å­˜èŒƒå›´å†…ã€‚ è¿™äº›éªŒè¯å¬èµ·æ¥åƒæ˜¯æˆ‘ä»¬è¦ç ”ç©¶çš„ä¸»è¦å€™é€‰é¡¹ï¼Œå› ä¸ºå¦‚æœæˆ‘ä»¬èƒ½å¤Ÿç¦ç”¨å®ƒä»¬çš„æ“ä½œï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨å…¶ä»– SCM è°ƒç”¨æ¥åˆ›å»ºä¸åŒç±»å‹çš„åŸè¯­ã€‚ TrustZone å†…å­˜éªŒè¯ è®©æˆ‘ä»¬å¼€å§‹ç»™å†…å­˜éªŒè¯å‡½æ•°èµ·ä¸€ä¸ªåç§° - ä»ç°åœ¨å¼€å§‹ï¼Œæˆ‘ä»¬å°†ç§°ä¹‹ä¸º tzbsp_validate_memoryã€‚ ä»¥ä¸‹æ˜¯è¯¥å‡½æ•°çš„åç¼–è¯‘ä»£ç ï¼š è¿™ä¸ªå‡½æ•°å®é™…ä¸Šè°ƒç”¨äº†ä¸¤ä¸ªå†…éƒ¨å‡½æ•°æ¥æ‰§è¡ŒéªŒè¯ï¼Œæˆ‘ä»¬åˆ†åˆ«ç§°å®ƒä»¬ä¸º is_disallowed_range å’Œ is_allowed_rangeã€‚ is_disallowed_range æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œè¯¥å‡½æ•°å®é™…ä¸Šä½¿ç”¨ç»™å®šåœ°å€çš„å‰12ä½ï¼Œå…·ä½“å¦‚ä¸‹ï¼š é«˜ 7 ä½ç”¨ä½œç´¢å¼•ï¼Œç´¢å¼•ä¸€ä¸ªåŒ…å« 128 ä¸ª 32 ä½å®½å€¼çš„è¡¨ã€‚ ä½ 5 ä½ç”¨ä½œåœ¨å…ˆå‰ç´¢å¼•çš„ä½ç½®ä¸Šå­˜åœ¨çš„ 32 ä½æ¡ç›®ä¸­è¦æ£€æŸ¥çš„ä½ç´¢å¼•ã€‚ æ¢å¥è¯è¯´ï¼Œå¯¹äºè¦è¿›è¡ŒéªŒè¯çš„å†…å­˜åŒºåŸŸäº¤å‰çš„æ¯ä¸ª 1MB å—ï¼Œå­˜åœ¨ä¸Šè¿°è¡¨æ ¼ä¸­ç”¨äºè¡¨ç¤ºè¯¥æ•°æ®åŒºåŸŸæ˜¯å¦â€œä¸å…è®¸â€çš„ä½ã€‚å¦‚æœç»™å®šåŒºåŸŸä¸­çš„ä»»ä½•å—éƒ½è¢«ç¦æ­¢ï¼Œåˆ™è¯¥å‡½æ•°è¿”å›è¡¨ç¤ºæ­¤ç±»æƒ…å†µçš„å€¼ã€‚å¦åˆ™ï¼Œè¯¥å‡½æ•°å°†ç»™å®šçš„å†…å­˜åŒºåŸŸè§†ä¸ºæœ‰æ•ˆã€‚ is_allowed_range è™½ç„¶ç¨å¾®æœ‰äº›é•¿ï¼Œä½†è¿™ä¸ªå‡½æ•°ä¹Ÿå¾ˆç®€å•ã€‚å®ƒåŸºæœ¬ä¸Šåªæ˜¯éå†ä¸€ä¸ªé™æ€æ•°ç»„ï¼Œå…¶ä¸­åŒ…å«ä»¥ä¸‹ç»“æ„çš„æ¡ç›®ï¼š è¯¥å‡½æ•°éå†åœ¨ç»™å®šå†…å­˜åœ°å€å¤„çš„è¡¨ä¸­çš„æ¯ä¸ªæ¡ç›®ï¼Œå½“å½“å‰æ¡ç›®çš„ end_marker å­—æ®µä¸º 0xFFFFFFFF æ—¶åœæ­¢éå†ã€‚ æ¯ä¸ªæ¡ç›®æŒ‡å®šçš„èŒƒå›´éƒ½ä¼šè¿›è¡ŒéªŒè¯ï¼Œä»¥ç¡®ä¿å†…å­˜èŒƒå›´æ˜¯å…è®¸çš„ã€‚ä½†æ˜¯ï¼Œæ­£å¦‚ä¸Šé¢çš„åç¼–è¯‘æ‰€ç¤ºï¼Œè®¾ç½® flags å­—æ®µç¬¬äºŒä½çš„æ¡ç›®å°†è¢«è·³è¿‡ï¼ æ”»å‡»éªŒè¯å‡½æ•° ç°åœ¨æˆ‘ä»¬ç†è§£äº†éªŒè¯å‡½æ•°çš„æ“ä½œæ–¹å¼ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ä½¿ç”¨é›¶å†™å…¥åŸè¯­æ¥ç¦ç”¨å®ƒä»¬çš„æ“ä½œã€‚ é¦–å…ˆï¼Œå¦‚ä¸Šæ‰€è¿°ï¼Œis_disallowed_range å‡½æ•°ä½¿ç”¨ä¸€ä¸ª 32 ä½æ¡ç›®çš„è¡¨ï¼Œå…¶ä¸­æ¯ä¸ªä½å¯¹åº” 1MB å†…å­˜å—ã€‚è®¾ç½®ä¸º1çš„ä½è¡¨ç¤ºç¦æ­¢å—ï¼Œè€Œé›¶ä½è¡¨ç¤ºå…è®¸å—ã€‚ è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨é›¶å†™å…¥åŸè¯­å°†è¡¨ä¸­çš„æ‰€æœ‰æ¡ç›®è®¾ç½®ä¸ºé›¶æ¥è½»æ¾åœ°ä½¿è¯¥å‡½æ•°æ— æ•ˆã€‚è¿™æ ·åšå°†ä½¿æ‰€æœ‰å†…å­˜å—è¢«æ ‡è®°ä¸ºå…è®¸ã€‚ è½¬åˆ°ä¸‹ä¸€ä¸ªå‡½æ•° is_allowed_rangeã€‚è¿™æœ‰ç‚¹æ£˜æ‰‹-å¦‚ä¸Šæ‰€è¿°ï¼Œåœ¨æ ‡å¿—å­—æ®µä¸­è®¾ç½®ç¬¬äºŒä½çš„å—ä¼šæ ¹æ®ç»™å®šåœ°å€è¿›è¡ŒéªŒè¯ã€‚ä½†æ˜¯ï¼Œå¯¹äºåœ¨å…¶ä¸­æœªè®¾ç½®æ­¤ä½çš„å—ï¼Œä¸æ‰§è¡ŒéªŒè¯ï¼Œå¹¶è·³è¿‡è¯¥å—ã€‚ ç”±äºè®¾å¤‡ä¸­çš„å—è¡¨åªä¸é©»ç•™åœ¨ TrustZone å†…æ ¸å†…å­˜èŒƒå›´å†…çš„å†…å­˜èŒƒå›´æœ‰å…³ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€è¦å°†æ­¤å­—æ®µè®¾ç½®ä¸ºé›¶å³å¯ã€‚è¿™æ ·åšå°†å¯¼è‡´éªŒè¯å‡½æ•°è·³è¿‡å®ƒï¼Œå› æ­¤éªŒè¯å‡½æ•°å°†æ¥å— TrustZone å†…æ ¸å†…å­˜ä¸­çš„å†…å­˜åœ°å€ä¸ºæœ‰æ•ˆã€‚ å›åˆ°ç¼–å†™åŸè¯­ ç°åœ¨æˆ‘ä»¬å·²ç»æ‘†è„±äº†è¾¹ç•Œæ£€æŸ¥å‡½æ•°ï¼Œå¯ä»¥è‡ªç”±åœ°æä¾›ä»»ä½•å†…å­˜åœ°å€ä½œä¸º SCM è°ƒç”¨çš„å‚æ•°ï¼Œè€Œä¸ä¼šæœ‰ä»»ä½•éšœç¢ã€‚ ä½†æ˜¯ï¼Œæˆ‘ä»¬æ˜¯å¦æ›´æ¥è¿‘åˆ›å»ºç¼–å†™åŸè¯­ï¼Ÿç†æƒ³æƒ…å†µä¸‹ï¼Œå¦‚æœæœ‰ä¸€ä¸ª SCM è°ƒç”¨ï¼Œæˆ‘ä»¬å¯ä»¥æ§åˆ¶å†™å…¥åˆ°å—æ§ä½ç½®çš„ä¸€å—æ•°æ®å—ï¼Œé‚£å°±è¶³å¤Ÿäº†ã€‚ ä¸å¹¸çš„æ˜¯ï¼Œåœ¨æŸ¥çœ‹æ‰€æœ‰ SCM è°ƒç”¨ä¹‹åï¼Œä¼¼ä¹æ²¡æœ‰ç¬¦åˆæ­¤æè¿°çš„å€™é€‰è€…ã€‚ å°½ç®¡å¦‚æ­¤ï¼Œä¸éœ€è¦æ‹…å¿ƒï¼æ— æ³•é€šè¿‡å•ä¸ª SCM è°ƒç”¨å®ç°çš„æ“ä½œï¼Œå¯èƒ½é€šè¿‡ä¸²è”å‡ ä¸ªè°ƒç”¨æ¥å®ç°ã€‚ä»é€»è¾‘ä¸Šè®²ï¼Œæˆ‘ä»¬å¯ä»¥å°†åˆ›å»ºä»»æ„å†™å…¥åŸè¯­æ‹†åˆ†ä¸ºä»¥ä¸‹æ­¥éª¤ï¼š åœ¨å—æ§ä½ç½®åˆ›å»ºä¸€ä¸ªæœªå—æ§çš„æ•°æ®å— æ§åˆ¶åˆ›å»ºçš„æ•°æ®å—ï¼Œä½¿å…¶å®é™…åŒ…å«æ‰€éœ€å†…å®¹ å°†åˆ›å»ºçš„æ•°æ®å—å¤åˆ¶åˆ°ç›®æ ‡ä½ç½® åˆ›å»º è™½ç„¶æ²¡æœ‰SCMè°ƒç”¨ä¼¼ä¹æ˜¯åˆ›å»ºå—æ§æ•°æ®å—çš„å¥½é€‰æ‹©ï¼Œä½†æœ‰ä¸€ä¸ªè°ƒç”¨å¯ä»¥ç”¨äºåœ¨å—æ§ä½ç½®åˆ›å»ºæœªå—æ§çš„æ•°æ®å— tzbsp_prng_getdata_syscallã€‚ å¦‚å…¶åç§°æ‰€ç¤ºï¼Œå¯ä»¥ä½¿ç”¨æ­¤å‡½æ•°åœ¨ç»™å®šä½ç½®ç”Ÿæˆéšæœºå­—èŠ‚ç¼“å†²åŒºã€‚é€šå¸¸ï¼ŒAndroid ä½¿ç”¨å®ƒä»¥åˆ©ç”¨ Snapdragon SoC ä¸­å­˜åœ¨çš„ç¡¬ä»¶ PRNGã€‚ åœ¨ä»»ä½•æƒ…å†µä¸‹ï¼ŒSCM è°ƒç”¨æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼›è¾“å‡ºåœ°å€å’Œè¾“å‡ºé•¿åº¦ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚ ä¸€æ–¹é¢ï¼Œè¿™å¾ˆå¥½ - å¦‚æœæˆ‘ä»¬ï¼ˆåœ¨æŸç§ç¨‹åº¦ä¸Šï¼‰ä¿¡ä»»ç¡¬ä»¶éšæœºæ•°ç”Ÿæˆå™¨ï¼ˆRNGï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥ç›¸å½“ç¡®ä¿¡ä½¿ç”¨æ­¤è°ƒç”¨ç”Ÿæˆçš„æ¯ä¸ªå­—èŠ‚éƒ½å¯èƒ½æ˜¯è¾“å‡ºèŒƒå›´å†…çš„ä»»ä½•å­—èŠ‚å€¼ã€‚å¦ä¸€æ–¹é¢ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯¹æ‰€ç”Ÿæˆçš„æ•°æ®å®Œå…¨æ²¡æœ‰æ§åˆ¶æƒã€‚ æ§åˆ¶ å³ä½¿åœ¨ä½¿ç”¨ PRNG æ—¶å¯èƒ½ä¼šç”Ÿæˆä»»ä½•è¾“å‡ºï¼Œä¹Ÿè®¸æœ‰ä¸€ç§æ–¹æ³•å¯ä»¥éªŒè¯æ‰€ç”Ÿæˆçš„æ•°æ®æ˜¯å¦å®é™…ä¸Šæ˜¯æˆ‘ä»¬è¦å†™å…¥çš„æ•°æ®ã€‚ ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œè®©æˆ‘ä»¬æƒ³è±¡ä»¥ä¸‹æ¸¸æˆ - å‡è®¾æ‚¨æœ‰ä¸€ä¸ªæœ‰å››ä¸ªæ§½çš„è€è™æœºï¼Œæ¯ä¸ªæ§½æœ‰ 256 ç§å¯èƒ½çš„å€¼ã€‚æ¯æ¬¡æ‹‰åŠ¨æ‰‹æŸ„æ—¶ï¼Œæ‰€æœ‰æ§½éƒ½åŒæ—¶æ—‹è½¬ï¼Œå¹¶å‘ˆç°å‡ºéšæœºè¾“å‡ºã€‚æ‚¨éœ€è¦æ‹‰å¤šå°‘æ¬¡æ‰‹æŸ„æ‰èƒ½ä½¿ç»“æœå®Œå…¨åŒ¹é…ä¹‹å‰é€‰æ‹©çš„å€¼ï¼Ÿå—¯ï¼Œæœ‰ 4294967296ï¼ˆ2^32ï¼‰ç§å¯èƒ½çš„å€¼ï¼Œå› æ­¤æ¯æ¬¡æ‹‰æ‰‹æŸ„æ—¶ï¼Œç»“æœä¸æ‰€éœ€ç»“æœåŒ¹é…çš„å‡ ç‡çº¦ä¸º 10^(-10)ã€‚å¬èµ·æ¥ä½ è¦åœ¨è¿™é‡Œå‘†ä¸Šä¸€æ®µæ—¶é—´äº†â€¦ ä½†æ˜¯ï¼Œå¦‚æœä½ èƒ½å¤Ÿä½œå¼Šå‘¢ï¼Ÿä¾‹å¦‚ï¼Œå¦‚æœæ¯ä¸ªæ’æ§½éƒ½æœ‰ä¸€ä¸ªä¸åŒçš„æ‰‹æŸ„ï¼Ÿè¿™æ ·ä½ å°±åªèƒ½æ¯æ¬¡æ›´æ”¹ä¸€ä¸ªæ’æ§½çš„å€¼ã€‚è¿™æ„å‘³ç€ç°åœ¨æ¯æ¬¡æ‹‰åŠ¨æ‰‹æŸ„ï¼Œæœ‰ 1/256 çš„æœºä¼šï¼Œç»“æœå°†ä¸è¯¥æ’æ§½çš„æœŸæœ›å€¼åŒ¹é…ã€‚ å¬èµ·æ¥æ¸¸æˆç°åœ¨å˜å¾—æ›´å®¹æ˜“äº†ï¼Œå¯¹å§ï¼Ÿä½†æ˜¯å˜å¾—æœ‰å¤šå®¹æ˜“ï¼Ÿåœ¨æ¦‚ç‡è®ºä¸­ï¼Œè¿™ç§å•ä¸ªâ€œæ¸¸æˆâ€çš„åˆ†å¸ƒè¢«ç§°ä¸ºä¼¯åŠªåˆ©åˆ†å¸ƒï¼Œå®é™…ä¸Šåªæ˜¯ä¸€ç§è¯´æ³•ï¼Œå³æ¯æ¬¡è¯•éªŒéƒ½æœ‰ä¸€ç»„æˆåŠŸçš„æ¦‚ç‡ï¼Œè¡¨ç¤ºä¸º pï¼Œæ‰€æœ‰å…¶ä»–ç»“æœéƒ½è¢«æ ‡è®°ä¸ºå¤±è´¥ï¼Œå¹¶ä¸”æœ‰ 1-p çš„æ¦‚ç‡å‘ç”Ÿã€‚ å‡è®¾æˆ‘ä»¬å¸Œæœ›æœ‰ 90ï¼… çš„æˆåŠŸç‡ï¼Œç»“æœè¡¨æ˜åœ¨åŸå§‹ç‰ˆæœ¬çš„æ¸¸æˆä¸­ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œå¤§çº¦ 10^8 æ¬¡å°è¯•ï¼ˆï¼ï¼‰ï¼Œä½†å¦‚æœæˆ‘ä»¬ä½œå¼Šï¼Œæˆ‘ä»¬æ¯ä¸ªæ’æ§½åªéœ€è¦å¤§çº¦ 590 æ¬¡å°è¯•ï¼Œè¿™æ˜¯å‡ ä¸ªæ•°é‡çº§çš„å·®å¼‚ã€‚ é‚£ä¹ˆä½ æ˜¯å¦å·²ç»å¼„æ¸…æ¥šäº†è¿™ä¸æˆ‘ä»¬çš„å†™å…¥åŸè¯­æœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿä»¥ä¸‹æ˜¯è§£é‡Šï¼š é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸€ä¸ª SCM è°ƒç”¨ï¼Œå®ƒå¯ä»¥å°†å†…å­˜ä¸­å¯å†™çš„ä½ç½®çš„å€¼è¿”å›ç»™è°ƒç”¨è€…ã€‚ æœ‰å¾ˆå¤šè¿™æ ·çš„å‡½æ•°ã€‚å…¶ä¸­ä¸€ä¸ªå€™é€‰é¡¹æ˜¯ tzbsp_fver_get_version è°ƒç”¨ã€‚è¯¥å‡½æ•°å¯ç”¨äºâ€œæ™®é€šä¸–ç•Œâ€ï¼Œä»¥æ£€ç´¢ä¸åŒ TrustZone ç»„ä»¶çš„å†…éƒ¨ç‰ˆæœ¬å·ã€‚å®ƒé€šè¿‡æ¥æ”¶è¡¨ç¤ºè¦æ£€ç´¢ç‰ˆæœ¬å·çš„ç»„ä»¶çš„æ•´æ•°å’Œè¦å†™å…¥ç‰ˆæœ¬ä»£ç çš„åœ°å€æ¥å®ç°ã€‚ç„¶åï¼Œè¯¥å‡½æ•°åªæ˜¯åœ¨ä¸€ä¸ªé™æ€çš„åŒ…å«ç»„ä»¶ ID å’Œç‰ˆæœ¬ä»£ç çš„å¯¹çš„æ•°ç»„ä¸­éå†ã€‚å½“æ‰¾åˆ°å…·æœ‰ç»™å®š ID çš„ç»„ä»¶æ—¶ï¼Œç‰ˆæœ¬ä»£ç å°†å†™å…¥è¾“å‡ºåœ°å€ã€‚ ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ tzbsp_prng_getdata_syscall å‡½æ•°ï¼Œå¼€å§‹é€å­—èŠ‚æ“ä½œä»»ä½•ç‰ˆæœ¬ä»£ç çš„å€¼ã€‚ä¸ºäº†çŸ¥é“åœ¨æ¯æ¬¡è¿­ä»£ä¸­ç”Ÿæˆçš„å­—èŠ‚çš„å€¼ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°è°ƒç”¨ä¸Šè¿° SCMï¼ŒåŒæ—¶ä¼ é€’ä¸è¦ä¿®æ”¹å…¶ç‰ˆæœ¬ä»£ç çš„ç»„ä»¶åŒ¹é…çš„ç»„ä»¶ IDï¼Œä»¥åŠæä¾›ä¸€ä¸ªè¿”å›åœ°å€ï¼Œè¯¥åœ°å€æŒ‡å‘å¯è¯»å–çš„ï¼ˆå³ä¸åœ¨ TrustZone ä¸­çš„ï¼‰å†…å­˜ä½ç½®ã€‚ æˆ‘ä»¬å¯ä»¥é‡å¤è¿™å‰ä¸¤ä¸ªæ­¥éª¤ï¼Œç›´åˆ°æ»¡æ„ä¸ºæ­¢ï¼Œç„¶åå†ç”Ÿæˆä¸‹ä¸€ä¸ªå­—èŠ‚ã€‚è¿™æ„å‘³ç€ç»è¿‡å‡ æ¬¡è¿­ä»£åï¼Œæˆ‘ä»¬å¯ä»¥ç¡®å®šç‰¹å®šç‰ˆæœ¬ä»£ç çš„å€¼ä¸æˆ‘ä»¬æƒ³è¦çš„ DWORD ç›¸åŒ¹é…ã€‚ å¤åˆ¶ æœ€åï¼Œæˆ‘ä»¬æƒ³è¦å°†ç”Ÿæˆçš„å€¼å†™å…¥ä¸€ä¸ªå¯æ§åˆ¶çš„ä½ç½®ã€‚å¹¸è¿çš„æ˜¯ï¼Œè¿™ä¸€æ­¥éå¸¸ç®€å•ã€‚æˆ‘ä»¬åªéœ€è¦ç®€å•åœ°è°ƒç”¨ tzbsp_fver_get_version SCM è°ƒç”¨ï¼Œä½†ç°åœ¨æˆ‘ä»¬å¯ä»¥å°†ç›®æ ‡åœ°å€ä½œä¸ºè¿”å›åœ°å€å‚æ•°æä¾›ã€‚è¿™å°†å¯¼è‡´å‡½æ•°å°†æˆ‘ä»¬ç”Ÿæˆçš„ DWORD å†™å…¥å¯æ§åˆ¶çš„ä½ç½®ï¼Œä»è€Œå®Œæˆæˆ‘ä»¬çš„å†™å…¥å·¥å…·ã€‚ å–˜å£æ°”â€¦ç°åœ¨æ€ä¹ˆåŠï¼Ÿ ä»è¿™é‡Œå¼€å§‹ï¼Œäº‹æƒ…å˜å¾—å®¹æ˜“äº†ã€‚é¦–å…ˆï¼Œå°½ç®¡æˆ‘ä»¬æœ‰ä¸€ä¸ªå†™å…¥åŸè¯­ï¼Œä½†ä»ç„¶å¾ˆéº»çƒ¦ä½¿ç”¨ã€‚ä¹Ÿè®¸ï¼Œå¦‚æœæˆ‘ä»¬èƒ½å¤Ÿä½¿ç”¨ä¹‹å‰çš„ä¸€ä¸ªæ›´ç®€å•çš„å·¥å…·æ¥åˆ›å»ºä¸€ä¸ªæ›´ç®€å•çš„å·¥å…·ï¼Œé‚£å°±ä¼šæ›´å®¹æ˜“äº›ã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ›å»ºæˆ‘ä»¬è‡ªå·±çš„ SCM è°ƒç”¨æ¥å®ç°è¿™ä¸€ç‚¹ï¼Œè¿™åªæ˜¯ä¸€ä¸ªå†™å…¥-ä½•å¤„å·¥å…·ã€‚è¿™å¬èµ·æ¥å¾ˆæ£˜æ‰‹ï¼Œä½†å®é™…ä¸Šå¾ˆç®€å•ã€‚ åœ¨å…ˆå‰çš„åšå®¢æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬æåˆ°æ‰€æœ‰ SCM è°ƒç”¨éƒ½é€šè¿‡ä¸€ä¸ªåŒ…å«æŒ‡å‘æ¯ä¸ª SCM è°ƒç”¨çš„æŒ‡é’ˆï¼ˆä»¥åŠå®ƒä»¬æä¾›çš„å‚æ•°æ•°é‡ï¼Œåç§°ç­‰ï¼‰çš„å¤§å‹æ•°ç»„é—´æ¥è°ƒç”¨ã€‚ è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å…ˆå‰åˆ›å»ºçš„å†™å…¥å·¥å…·ï¼Œå°†ä¸€äº›æˆ‘ä»¬è®¤ä¸ºâ€œä¸é‡è¦â€çš„ SCM è°ƒç”¨çš„åœ°å€æ›´æ”¹ä¸ºå·²å­˜åœ¨å†™å…¥å·¥å…·çš„åœ°å€ã€‚å¿«é€ŸæŸ¥çœ‹ TrustZone å†…æ ¸çš„ä»£ç ä¼šå‘ç°æœ‰è®¸å¤šè¿™æ ·çš„å·¥å…·ã€‚ä»¥ä¸‹æ˜¯å…¶ä¸­ä¸€ä¸ªä¾‹å­ï¼š æœ€åï¼Œèƒ½å¤Ÿè¯»å– TrustZone å†…æ ¸è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­çš„ä»»ä½•å†…å­˜ä½ç½®ä¹Ÿå¾ˆæœ‰ç”¨ã€‚è¿™å¯ä»¥é€šè¿‡ä½¿ç”¨ä¸Šé¢æè¿°çš„æ–¹æ³•ä¸­çš„å¦ä¸€ä¸ªâ€œä¸é‡è¦â€çš„ SCM è°ƒç”¨æ¥åˆ›å»ºè¯»å– gadgetã€‚å®é™…ä¸Šï¼Œè¿™ä¸ª gadget è¦æ¯”å†™å…¥ gadget æ›´åŠ éš¾ä»¥æ‰¾åˆ°ã€‚ä½†æ˜¯ï¼Œåœ¨ TrustZone å†…æ ¸ä¸­å‘ç°äº†è¿™æ ·ä¸€ä¸ª gadget: è¿™ä¸ª gadget è¿”å› R0 ä¸­å‚¨å­˜çš„åœ°å€ã€åŠ ä¸Š R1 ä¸­çš„åç§»å€¼ä¸­è¯»å–çš„å€¼ï¼Œå¤ªæ£’äº†ï¼ ç¼–å†™æ–°ä»£ç  åœ¨è¿™ä¸ªé˜¶æ®µï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥å®Œå…¨è¯»å†™ TrustZone å†…æ ¸å†…å­˜ã€‚ä½†æˆ‘ä»¬è¿˜æ²¡æœ‰åœ¨ TrustZone å†…æ ¸ä¸­æ‰§è¡Œä»»æ„ä»£ç çš„èƒ½åŠ›ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å†…æ ¸ä¸­æ‰¾åˆ°ä¸åŒçš„ gadgetï¼Œå¹¶å°†å®ƒä»¬ä¸²è”èµ·æ¥åˆ›å»ºæ‰€éœ€çš„æ•ˆæœã€‚ä½†è¿™æ ·åšæ‰‹åŠ¨æ“ä½œéå¸¸ç¹çï¼ˆæˆ‘ä»¬éœ€è¦æ‰¾åˆ°ç›¸å½“å¤šçš„ gadgetï¼‰ï¼Œè€Œä¸”è‡ªåŠ¨åŒ–éš¾åº¦å¾ˆå¤§ã€‚ æœ‰å‡ ç§å¯èƒ½çš„æ–¹æ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ ä¸€ç§å¯èƒ½çš„æ–¹æ³•æ˜¯åœ¨â€œæ­£å¸¸ä¸–ç•Œâ€ä¸­ç¼–å†™ä¸€æ®µä»£ç ï¼Œç„¶åä»â€œå®‰å…¨ä¸–ç•Œâ€è·³è½¬åˆ°å®ƒã€‚è¿™å¬èµ·æ¥æ˜¯ä¸€ä¸ªå®¹æ˜“çš„æ–¹æ³•ï¼Œä½†å®é™…ä¸Šæ¯”è¯´èµ·æ¥è¦å›°éš¾å¾—å¤šã€‚ æ­£å¦‚åœ¨ç¬¬ä¸€ç¯‡åšå®¢ä¸­æåˆ°çš„é‚£æ ·ï¼Œå½“å¤„ç†å™¨åœ¨å®‰å…¨æ¨¡å¼ä¸‹è¿è¡Œæ—¶ï¼Œä¹Ÿå°±æ˜¯ SCRï¼ˆå®‰å…¨é…ç½®å¯„å­˜å™¨ï¼‰ä¸­çš„ NSï¼ˆéå®‰å…¨ï¼‰ä½å…³é—­æ—¶ï¼Œå®ƒåªèƒ½æ‰§è¡Œæ ‡è®°ä¸ºâ€œå®‰å…¨â€çš„é¡µé¢ã€‚åœ¨ MMU ä½¿ç”¨çš„ç¿»è¯‘è¡¨ä¸­ï¼ˆä¹Ÿå°±æ˜¯ NS ä½å…³é—­ï¼‰ã€‚ è¿™æ„å‘³ç€ï¼Œä¸ºäº†åœ¨&quot;æ­£å¸¸ä¸–ç•Œ&quot;ä¸­æ‰§è¡Œæˆ‘ä»¬ç¼–å†™çš„ä»£ç å—ï¼Œæˆ‘ä»¬é¦–å…ˆå¿…é¡»ä¿®æ”¹ TrustZone å†…æ ¸çš„è½¬æ¢è¡¨ï¼Œä»¥å°†æˆ‘ä»¬ç¼–å†™ä»£ç çš„åœ°å€æ˜ å°„ä¸º secureã€‚ è™½ç„¶è¿™æ˜¯å¯èƒ½çš„ï¼Œä½†æœ‰ç‚¹ç¹çã€‚ å¦ä¸€ç§æ–¹æ³•å¯èƒ½æ˜¯åœ¨ TrustZone å†…æ ¸çš„ä»£ç æ®µä¸­ç¼–å†™æ–°ä»£ç æˆ–è¦†ç›–ç°æœ‰ä»£ç ã€‚è¿™ä¹Ÿæœ‰ä¼˜ç‚¹ï¼Œå¯ä»¥è®©æˆ‘ä»¬ä¿®æ”¹å†…æ ¸ä¸­çš„ç°æœ‰è¡Œä¸ºï¼Œè¿™åœ¨åé¢ä¹Ÿå¯èƒ½å¾ˆæœ‰ç”¨ã€‚ ä½†æ˜¯ï¼Œä¹ä¸€çœ‹ï¼Œè¿™ä¼¼ä¹ä¸æ¯”ä¹‹å‰çš„æ–¹æ³•æ›´å®¹æ˜“å®ç°ã€‚æ¯•ç«Ÿï¼ŒTrustZone å†…æ ¸çš„ä»£ç æ®µè¢«æ˜ å°„ä¸ºåªè¯»ï¼Œè‚¯å®šä¸å¯å†™ã€‚ ä½†æ˜¯ï¼Œè¿™åªæ˜¯ä¸€ä¸ªå°é—®é¢˜ï¼äº‹å®ä¸Šï¼Œè¿™å®é™…ä¸Šå¯ä»¥é€šè¿‡ä½¿ç”¨ ARM MMU çš„ä¸€ä¸ªæ–¹ä¾¿çš„åŠŸèƒ½ domains æ¥è§£å†³ï¼Œè€Œæ— éœ€ä¿®æ”¹è½¬æ¢è¡¨ã€‚ åœ¨ ARM è½¬æ¢è¡¨ä¸­ï¼Œæ¯ä¸ªæ¡ç›®éƒ½æœ‰ä¸€ä¸ªå­—æ®µï¼Œç”¨äºåˆ—å‡ºå…¶æƒé™ï¼Œä»¥åŠä¸€ä¸ªæŒ‡ç¤ºè½¬æ¢æ‰€å± domain çš„å­—æ®µã€‚æœ‰16ä¸ªåŸŸï¼Œæ¯ä¸ªè½¬æ¢å±äºå…¶ä¸­çš„ä¸€ä¸ªã€‚ åœ¨ ARM MMU ä¸­ï¼Œæœ‰ä¸€ä¸ªç§°ä¸º DACRï¼ˆDomain Access Control Registerï¼‰çš„å¯„å­˜å™¨ã€‚è¯¥ 32 ä½å¯„å­˜å™¨å…·æœ‰ 16 å¯¹ä½ï¼Œæ¯å¯¹ä½ç”¨äºä¸€ä¸ªåŸŸï¼Œç”¨äºæŒ‡å®šç»™å®šåŸŸçš„è½¬æ¢æ˜¯å¦åº”è¯¥ä¸ºè¯»å–è®¿é—®ï¼Œå†™å…¥è®¿é—®ï¼Œä¸¤è€…éƒ½æ˜¯æˆ–è€…éƒ½ä¸æ˜¯ç”Ÿæˆæ•…éšœã€‚ æ¯å½“å¤„ç†å™¨å°è¯•è®¿é—®ç»™å®šçš„å†…å­˜åœ°å€æ—¶ï¼ŒMMU é¦–å…ˆæ£€æŸ¥ä½¿ç”¨ç»™å®šè½¬æ¢çš„è®¿é—®æƒé™æ˜¯å¦å¯ä»¥è®¿é—®è¯¥åœ°å€ã€‚å¦‚æœè®¿é—®æ˜¯å…è®¸çš„ï¼Œåˆ™ä¸ä¼šç”Ÿæˆæ•…éšœã€‚ å¦åˆ™ï¼ŒMMU æ£€æŸ¥ DACR ä¸­å¯¹åº”äºç»™å®šåŸŸçš„ä½æ˜¯å¦è®¾ç½®ã€‚å¦‚æœè®¾ç½®äº†ï¼Œåˆ™æŠ‘åˆ¶æ•…éšœå¹¶å…è®¸è®¿é—®ã€‚ è¿™æ„å‘³ç€ç®€å•åœ°å°† DACR çš„å€¼è®¾ç½®ä¸º 0xFFFFFFFF å°†ä½¿ MMU å¯ç”¨å¯¹ä»»ä½•æ˜ å°„çš„å†…å­˜åœ°å€çš„è¯»å†™è®¿é—®ï¼Œè€Œä¸ä¼šç”Ÿæˆæ•…éšœï¼ˆæ›´é‡è¦çš„æ˜¯ï¼Œæ— éœ€ä¿®æ”¹è½¬æ¢è¡¨ï¼‰ã€‚ ä½†æ˜¯å¦‚ä½•è®¾ç½® DACR å‘¢ï¼Ÿæ˜¾ç„¶ï¼Œåœ¨ TrustZone å†…æ ¸çš„åˆå§‹åŒ–æœŸé—´ï¼Œå®ƒä¹Ÿå°†æ˜¾å¼å°† DACR çš„å€¼è®¾ç½®ä¸ºé¢„å®šå€¼ï¼ˆ0x55555555ï¼‰ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š ç„¶è€Œï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°è·³è½¬åˆ°åˆå§‹åŒ–å‡½æ•°ä¸­çš„ä¸‹ä¸€ä¸ªæ“ä½œç ï¼ŒåŒæ—¶åœ¨ R0 ä¸­æä¾›æˆ‘ä»¬è‡ªå·±çš„å€¼ï¼Œä»è€Œå¯¼è‡´ DACR è¢«è®¾ç½®ä¸ºæˆ‘ä»¬æ§åˆ¶çš„å€¼ã€‚ ç°åœ¨ DACR å·²ç»è®¾ç½®å¥½äº†ï¼Œè·¯å¾„å°±éƒ½æ¸…æ™°äº† - æˆ‘ä»¬å¯ä»¥ç®€å•åœ°å†™å…¥æˆ–è¦†ç›– TrustZone å†…æ ¸ä¸­çš„ä»£ç ã€‚ ä¸ºäº†ä½¿äº‹æƒ…å˜å¾—æ›´å®¹æ˜“ï¼ˆå¹¶ä¸”æ›´å°‘å—å¹²æ‰°ï¼‰ï¼Œæœ€å¥½å°†ä»£ç å†™å…¥ TrustZone å†…æ ¸ä¸­æœªä½¿ç”¨çš„ä½ç½®ã€‚å…¶ä¸­ä¹‹ä¸€æ˜¯â€œä»£ç æ´â€ã€‚ ä»£ç æ´åªæ˜¯æœªä½¿ç”¨çš„åŒºåŸŸï¼ˆé€šå¸¸åœ¨åˆ†é…çš„å†…å­˜åŒºåŸŸçš„æœ«å°¾ï¼‰ï¼Œä½†ä»ç„¶æ˜¯æ˜ å°„å’Œæœ‰æ•ˆçš„ã€‚å®ƒä»¬é€šå¸¸æ˜¯ç”±äºå†…å­˜æ˜ å°„å…·æœ‰ç²’åº¦è€Œå¼•èµ·çš„ï¼Œå› æ­¤åœ¨æ˜ å°„æ®µæœ«å°¾é€šå¸¸å­˜åœ¨å†…éƒ¨ç¢ç‰‡ã€‚ åœ¨ TrustZone å†…æ ¸ä¸­æœ‰å‡ ä¸ªè¿™æ ·çš„ä»£ç æ´ï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿåœ¨å…¶ä¸­ç¼–å†™å°æ®µä»£ç å¹¶æ‰§è¡Œå®ƒä»¬ï¼Œå‡ ä¹æ²¡æœ‰ä»»ä½•éº»çƒ¦ã€‚ å°†æ‰€æœ‰æ­¥éª¤æ•´åˆèµ·æ¥ è¿™ä¸ªæ¼æ´æœ‰ç‚¹å¤æ‚ã€‚ä»¥ä¸‹æ˜¯æˆ‘ä»¬å¿…é¡»å®Œæˆçš„æ‰€æœ‰é˜¶æ®µçš„æ€»ç»“ï¼š ä½¿ç”¨é›¶å†™å…¥åŸè¯­ç¦ç”¨å†…å­˜éªŒè¯åŠŸèƒ½ ä½¿ç”¨ TrustZone PRNG åœ¨å—æ§ä½ç½®åˆ¶ä½œæƒ³è¦çš„ DWORD é€šè¿‡è¯»å–ç›¸åº”çš„ç‰ˆæœ¬ä»£ç éªŒè¯åˆ¶ä½œçš„ DWORD å°†åˆ¶ä½œçš„ç‰ˆæœ¬ä»£ç å†™å…¥ç°æœ‰ SCM è°ƒç”¨å‡½æ•°æŒ‡é’ˆçš„ä½ç½®ï¼ˆè¿™æ ·å¯ä»¥åˆ›å»ºå¿«é€Ÿå†™å…¥å·¥å…·ï¼‰ ä½¿ç”¨å¿«é€Ÿå†™å…¥å·¥å…·åˆ›å»ºè¯»å–å·¥å…· ä½¿ç”¨å¿«é€Ÿå†™å…¥å·¥å…·å°†å‡½æ•°æŒ‡é’ˆå†™å…¥ä¸€ä¸ªå·¥å…·ï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿä¿®æ”¹ DACR ä¿®æ”¹ DACR ä»¥å®Œå…¨å¯ç”¨ï¼ˆ0xFFFFFFFFï¼‰ åœ¨ TrustZone å†…æ ¸ä¸­çš„ä»£ç æ´ä¸­ç¼–å†™ä»£ç  æ‰§è¡Œï¼ ğŸ˜ƒ ä»£ç  è¯¥æ¼æ´çš„åˆ©ç”¨ç¨‹åºå·²ç»è¢«å¼€å‘å‡ºæ¥äº†ï¼ŒåŒ…æ‹¬äº† Nexus 5ï¼ˆå…ˆå‰å·²ç»ç»™å‡ºäº†æŒ‡çº¹ï¼‰æ‰€éœ€çš„æ‰€æœ‰ç¬¦å·ã€‚ é¦–å…ˆï¼Œä¸ºäº†ä½¿æ¼æ´åˆ©ç”¨ç¨‹åºèƒ½å¤Ÿå‘ TrustZone å†…æ ¸å‘é€æ‰€éœ€çš„åˆ¶ä½œ SCM è°ƒç”¨ï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ªä¿®è¡¥ç‰ˆæœ¬çš„ msm-hammerhead å†…æ ¸ï¼Œå…¶ä¸­æ·»åŠ äº†æ­¤ç±»åŠŸèƒ½å¹¶å°†å…¶å…¬å¼€ç»™ç”¨æˆ·ç©ºé—´çš„ Androidã€‚ æˆ‘é€‰æ‹©é€šè¿‡å‘ç°æœ‰é©±åŠ¨ç¨‹åº QSEECOMï¼ˆåœ¨ç¬¬ä¸€ç¯‡åšå®¢æ–‡ç« ä¸­æåˆ°ï¼‰æ·»åŠ ä¸€äº›æ–°çš„ IOCTL æ¥å®ç°è¿™ä¸€ç‚¹ï¼Œè¯¥é©±åŠ¨ç¨‹åºæ˜¯ç”¨äºä¸ TrustZone å†…æ ¸è¿›è¡Œäº¤äº’çš„ Qualcomm é©±åŠ¨ç¨‹åºã€‚è¿™äº› IOCTL ä½¿è°ƒç”¨è€…èƒ½å¤Ÿå‘ TrustZone å†…æ ¸å‘é€â€œåŸå§‹â€çš„ SCM è°ƒç”¨ï¼ˆæ™®é€šæˆ–åŸå­ï¼‰ï¼ŒåŒ…å«ä»»æ„æ•°æ®ã€‚ æ‚¨å¯ä»¥åœ¨æ­¤å¤„æ‰¾åˆ°æ‰€éœ€çš„å†…æ ¸ä¿®æ”¹ã€‚ å¯¹äºä½¿ç”¨ Nexus 5 è®¾å¤‡çš„ç”¨æˆ·ï¼Œæˆ‘ä¸ªäººå»ºè®®éµå¾ª Marcin Jabrzyk çš„ä¼˜ç§€æ•™ç¨‹ - è¿™é‡Œï¼ˆå®ƒæ˜¯ä¸€ä¸ªå®Œæ•´çš„æ•™ç¨‹ï¼Œæè¿°äº†å¦‚ä½•ç¼–è¯‘å’Œå¯åŠ¨è‡ªå®šä¹‰å†…æ ¸è€Œä¸å°†å…¶åˆ·åˆ°è®¾å¤‡ä¸Šï¼‰ã€‚ åœ¨ä½¿ç”¨ä¿®æ”¹åçš„å†…æ ¸å¯åŠ¨è®¾å¤‡åï¼Œæ‚¨å°†éœ€è¦ä¸€ä¸ªç”¨æˆ·ç©ºé—´åº”ç”¨ç¨‹åºï¼Œå®ƒå¯ä»¥ä½¿ç”¨æ–°æ·»åŠ çš„ IOCTL å‘å†…æ ¸å‘é€ SCMã€‚ æˆ‘ç¼–å†™äº†è¿™æ ·çš„åº”ç”¨ç¨‹åºï¼Œæ‚¨å¯ä»¥åœ¨æ­¤å¤„è·å–ã€‚ æœ€åï¼Œæ¼æ´åˆ©ç”¨ç¨‹åºæœ¬èº«æ˜¯ç”¨ Python ç¼–å†™çš„ã€‚å®ƒä½¿ç”¨ç”¨æˆ·ç©ºé—´åº”ç”¨ç¨‹åºé€šè¿‡è‡ªå®šä¹‰å†…æ ¸ç›´æ¥å‘ TrustZone å†…æ ¸å‘é€ SCM è°ƒç”¨ï¼Œå¹¶å…è®¸åœ¨å†…æ ¸ä¸­æ‰§è¡Œä»»ä½•ä»»æ„ä»£ç ã€‚ æ‚¨å¯ä»¥åœ¨æ­¤å¤„æ‰¾åˆ°å®Œæ•´çš„æ¼æ´åˆ©ç”¨ç¨‹åºä»£ç ã€‚ ä½¿ç”¨æ¼æ´åˆ©ç”¨ç¨‹åº ä½¿ç”¨æ¼æ´åˆ©ç”¨ç¨‹åºéå¸¸ç®€å•ã€‚è¿™æ˜¯æ‚¨éœ€è¦æ‰§è¡Œçš„æ“ä½œï¼š ä½¿ç”¨ä¿®æ”¹åçš„å†…æ ¸å¯åŠ¨è®¾å¤‡ï¼ˆè¯·å‚è§ Marcin çš„æ•™ç¨‹ï¼‰ ç¼–è¯‘ FuzzZone äºŒè¿›åˆ¶æ–‡ä»¶å¹¶å°†å…¶æ”¾ç½®åœ¨ /data/local/tmp/ ä¸‹ åœ¨ shellcode.S æ–‡ä»¶ä¸­ç¼–å†™ä»»ä½• ARM ä»£ç  æ‰§è¡Œ build_shellcode.sh è„šæœ¬ä»¥åˆ›å»º shellcode äºŒè¿›åˆ¶æ–‡ä»¶ æ‰§è¡Œ exploit.py ä»¥åœ¨ TrustZone å†…æ ¸ä¸­è¿è¡Œæ‚¨çš„ä»£ç  å½±å“çš„è®¾å¤‡ åœ¨æŠ«éœ²æ¼æ´æ—¶ï¼Œè¿™ä¸ªæ¼æ´å½±å“æ‰€æœ‰ä½¿ç”¨MSM8974 SoCçš„è®¾å¤‡ã€‚æˆ‘åˆ›å»ºäº†ä¸€ä¸ªè„šæœ¬æ¥é™æ€æ£€æŸ¥è®¸å¤šè¿™æ ·çš„è®¾å¤‡çš„ROMï¼Œå‘ç°ä»¥ä¸‹è®¾å¤‡æ˜¯æœ‰æ¼æ´çš„ï¼š æ³¨æ„ï¼šæ­¤æ¼æ´å·²ç»è¢«é«˜é€šä¿®å¤ï¼Œå› æ­¤ä¸åº”è¯¥å½±å“å½“å‰æ›´æ–°çš„è®¾å¤‡ã€‚åŒæ—¶è¯·æ³¨æ„ï¼Œä»¥ä¸‹åˆ—è¡¨å¹¶ä¸æ˜¯è¯¦å°½æ— é—çš„ï¼Œä»…ä»…æ˜¯æˆ‘åœ¨å½“æ—¶é™æ€åˆ†æçš„ç»“æœã€‚ Samsung Galaxy S5 Samsung Galaxy S5 Samsung Galaxy Note III Samsung Galaxy S4 Samsung Galaxy Tab Pro 10.1 Samsung Galaxy Note Pro 12.2 HTC One LG G3 LG G2 LG G Flex Sony Xperia Z3 Compact Sony Xperia Z2 Sony Xperia Z Ultra Samsung Galaxy S5 Active Samsung Galaxy S5 TD-LTE Samsung Galaxy S5 Sport HTC One (E8) Oneplus One Acer Liquid S2 Asus PadFone Infinity Gionee ELIFE E7 Sony Xperia Z1 Compact Sony Xperia Z1s ZTE Nubia Z5s Sharp Aquos Xx 302SH Sharp Aquos Xx mini 303SH LG G Pro 2 Samsung Galaxy J Samsung Galaxy Note 10.1 2014 Edition (LTE variant) Samsung Galaxy Note 3 (LTE variant) Pantech Vega Secret UP Pantech Vega Secret Note Pantech Vega LTE-A LG Optimus Vu 3 Lenovo Vibe Z LTE Samsung Galaxy Tab Pro 8.4 Samsung Galaxy Round ZTE Grand S II LTE Samsung Galaxy Tab S 8.4 LTE Samsung Galaxy Tab S 10.5 LTE Samsung Galaxy Tab Pro 10.1 LTE Oppo Find 7 Qing Zhuang Ban Vivo Xshoot Elite IUNI U3 Hisense X1 Hisense X9T Pantech Vega Iron 2 (A910) Vivo Xplay 3S ZTE Nubia Z5S LTE Sony Xperia Z2 Tablet (LTE variant) Oppo Find 7a International Edition Sharp Aquos Xx304SH Sony Xperia ZL2 SOL25 Sony Xperia Z2a Coolpad 8971 Sharp Aquos Zeta SH-04F Asus PadFone S Lenovo K920 TD-LTE (China Mobile version) Gionee ELIFE E7L Oppo Find 7 ZTE Nubia X6 TD-LTE 128 GB Vivo Xshot Ultimate LG Isai FL ZTE Nubia Z7 ZTE Nubia Z7 Max Xiaomi Mi 4 InFocus M810 æ—¶é—´çº¿ 2014å¹´9æœˆ19æ—¥ - æŠ«éœ²æ¼æ´ 2014å¹´9æœˆ19æ—¥ - QC åˆæ­¥å›åº” 2014å¹´9æœˆ22æ—¥ - QC ç¡®è®¤é—®é¢˜å­˜åœ¨ 2014å¹´10æœˆ1æ—¥ - QC å‘å®¢æˆ·å‘å¸ƒé€šçŸ¥ 2014å¹´10æœˆ16æ—¥ - QC å‘è¿è¥å•†å‘å¸ƒé€šçŸ¥ï¼Œè¯·æ±‚ç¦ä»¤ 14 å¤© 2014å¹´10æœˆ30æ—¥ - ç¦ä»¤åˆ°æœŸ æˆ‘æƒ³æŒ‡å‡ºçš„æ˜¯ï¼Œåœ¨å‘é«˜é€šæŠ¥å‘Šæ­¤é—®é¢˜åï¼Œæˆ‘è¢«å‘ŠçŸ¥ä»–ä»¬åœ¨æˆ‘ä¹‹å‰å°±å·²ç»å†…éƒ¨è¯†åˆ«äº†æ­¤é—®é¢˜ã€‚ç„¶è€Œï¼Œè¿™ç§é—®é¢˜éœ€è¦ç›¸å½“é•¿çš„æ—¶é—´æ¥æ¨åŠ¨ä¿®å¤ï¼Œå› æ­¤åœ¨æˆ‘çš„ç ”ç©¶æ—¶ï¼Œä¿®å¤ç¨‹åºå°šæœªéƒ¨ç½²ï¼ˆè‡³å°‘ï¼Œæ®æˆ‘æ‰€çŸ¥ï¼‰ã€‚ æœ€åçš„è¯ æˆ‘å¾ˆæƒ³å¬å¬æ‚¨çš„åé¦ˆï¼Œè¯·åœ¨ä¸‹é¢ç•™è¨€ï¼å¦‚æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·éšæ—¶è¯¢é—®ã€‚","categories":[{"name":"Linux","slug":"Linux","permalink":"https://blog.inoki.cc/categories/Linux/"},{"name":"Android","slug":"Linux/Android","permalink":"https://blog.inoki.cc/categories/Linux/Android/"}],"tags":[{"name":"ä¸­æ–‡","slug":"ä¸­æ–‡","permalink":"https://blog.inoki.cc/tags/ä¸­æ–‡/"},{"name":"Linux","slug":"Linux","permalink":"https://blog.inoki.cc/tags/Linux/"},{"name":"Android","slug":"Android","permalink":"https://blog.inoki.cc/tags/Android/"},{"name":"ABL","slug":"ABL","permalink":"https://blog.inoki.cc/tags/ABL/"},{"name":"Bootloader","slug":"Bootloader","permalink":"https://blog.inoki.cc/tags/Bootloader/"}]},{"title":"ã€è¯‘ã€‘æ¢ç´¢é«˜é€šçš„ TrustZone å®ç°","slug":"exploring-qualcomms-trustzone","date":"2023-04-29T12:20:00.000Z","updated":"2025-03-08T09:40:48.609Z","comments":true,"path":"2023/04/29/exploring-qualcomms-trustzone/","link":"","permalink":"https://blog.inoki.cc/2023/04/29/exploring-qualcomms-trustzone/","excerpt":"","text":"åœ¨æœ¬åšå®¢ä¸­ï¼Œæˆ‘ä»¬å°†æ¢ç´¢é«˜é€šåœ¨ Snapdragon SoC ä¸Šå®ç°çš„ TrustZoneã€‚å¦‚æœæ‚¨è¿˜æ²¡æœ‰é˜…è¯»ä¹‹å‰çš„åšå®¢æ–‡ç« ï¼Œæˆ‘åœ¨å…¶ä¸­è¯¦ç»†ä»‹ç»äº† TrustZoneã€‚ ä»å“ªé‡Œå¼€å§‹ï¼Ÿ é¦–å…ˆï¼Œç”±äºé«˜é€šçš„ TrustZone å®ç°æ˜¯é—­æºçš„ï¼Œæ®æˆ‘æ‰€çŸ¥ï¼Œæ²¡æœ‰å…¬å¼€çš„æ–‡æ¡£è¯¦ç»†è¯´æ˜å…¶æ¶æ„æˆ–è®¾è®¡ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦å¯¹åŒ…å« TrustZone ä»£ç çš„äºŒè¿›åˆ¶æ–‡ä»¶è¿›è¡Œé€†å‘å·¥ç¨‹å’Œåˆ†æã€‚ è·å–TrustZoneæ˜ åƒ æˆ‘ä»¬å¯ä»¥å°è¯•ä»ä¸¤ä¸ªä¸åŒçš„ä½ç½®æå–æ˜ åƒï¼›è¦ä¹ˆä»è®¾å¤‡æœ¬èº«ï¼Œè¦ä¹ˆä»è®¾å¤‡çš„å·¥å‚æ˜ åƒã€‚ æˆ‘çš„ä¸ªäºº Nexus 5 è®¾å¤‡å·²ç»è·å–äº† root æƒé™ï¼Œå› æ­¤ä»è®¾å¤‡ä¸­æå–æ˜ åƒåº”è¯¥éå¸¸ç®€å•ã€‚ç”±äºæ˜ åƒå­˜å‚¨åœ¨ eMMC èŠ¯ç‰‡ä¸Šï¼Œè€Œ eMMC èŠ¯ç‰‡çš„å—å’Œåˆ†åŒºåœ¨â€œ/dev/block/platform/msm_sdcc.1â€ä¸‹å¯ç”¨ï¼Œæˆ‘å¯ä»¥é€šè¿‡ä½¿ç”¨â€œddâ€å°†ç›¸å…³åˆ†åŒºå¤åˆ¶åˆ°æˆ‘çš„æ¡Œé¢ã€‚ æ­¤å¤–ï¼Œè¿™äº›åˆ†åŒºåœ¨â€œ/dev/block/platform/msm_sdcc.1/by-nameâ€ä¸‹æœ‰æœ‰æ„ä¹‰çš„å‘½åé“¾æ¥ã€‚ è¿™é‡Œæœ‰ä¸¤ä¸ªåˆ†åŒºï¼Œä¸€ä¸ªåä¸ºâ€œtzâ€ï¼ˆä»£è¡¨TrustZoneï¼‰ï¼Œä¸€ä¸ªåä¸ºâ€œtzbâ€ï¼Œç”¨ä½œâ€œtzâ€æ˜ åƒçš„å¤‡ä»½æ˜ åƒï¼Œä¸å…¶å®Œå…¨ç›¸åŒã€‚ ä½†æ˜¯ï¼Œé€šè¿‡è¿™ç§æ–¹å¼æå–æ˜ åƒåï¼Œä»ç„¶ä¸æ»¡æ„ï¼ŒåŸå› æœ‰ä¸¤ä¸ªï¼š è™½ç„¶ TrustZone æ˜ åƒå­˜å‚¨åœ¨ eMMC èŠ¯ç‰‡ä¸Šï¼Œä½†å®ƒå¯èƒ½å¾ˆå®¹æ˜“å¯¹â€œæ™®é€šä¸–ç•Œâ€ï¼ˆé€šè¿‡è¦æ±‚ç³»ç»Ÿæ€»çº¿ä¸Šçš„ AxPROT ä½è¢«è®¾ç½®ï¼‰å˜å¾—ä¸å¯è®¿é—®ï¼Œæˆ–å…¶ä¸­çš„å‡ ä¸ªéƒ¨åˆ†å¯èƒ½ä¼šä¸¢å¤±ã€‚ æ‹‰å–æ•´ä¸ªåˆ†åŒºçš„æ•°æ®å¹¶ä¸é€éœ²æœ‰å…³æ˜ åƒå®é™…ï¼ˆé€»è¾‘ï¼‰è¾¹ç•Œçš„ä¿¡æ¯ï¼Œå› æ­¤éœ€è¦é¢å¤–çš„å·¥ä½œæ‰èƒ½ç¡®å®šæ˜ åƒå®é™…ä¸Šçš„ç»“æŸä½ç½®ã€‚ï¼ˆå®é™…ä¸Šï¼Œâ€œtzâ€æ˜ åƒæ˜¯ä¸€ä¸ª ELF äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå…¶å¤§å°åŒ…å«åœ¨ ELF å¤´ä¸­ï¼Œä½†è¿™åªæ˜¯ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼‰ã€‚ å› æ­¤ï¼Œæå–äº†ä¸€ä¸ªè®¾å¤‡æ˜ åƒåï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å‡ºå‚æ˜ åƒã€‚ Nexus 5 çš„å‡ºå‚æ˜ åƒéƒ½å¯ä»¥ä»è°·æ­Œä¸Šä¸‹è½½ã€‚å‡ºå‚æ˜ åƒåŒ…å«ä¸€ä¸ª ZIP æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«æ‰€æœ‰é»˜è®¤æ˜ åƒï¼Œæ­¤å¤–è¿˜åŒ…å«å¼•å¯¼åŠ è½½ç¨‹åºæ˜ åƒã€‚ ä¸‹è½½å‡ºå‚æ˜ åƒå¹¶æœç´¢ä¸ TrustZone ç›¸å…³çš„å­—ç¬¦ä¸²åï¼Œå¾ˆå¿«å°±å¯ä»¥å‘ç°å¼•å¯¼åŠ è½½ç¨‹åºæ˜ åƒåŒ…å«äº†æ‰€éœ€çš„ä»£ç ã€‚ ä½†æ˜¯ï¼Œåœ¨è¿™é‡Œä»ç„¶æœ‰ä¸€ä¸ªå°é—®é¢˜è¦è§£å†³ - å¼•å¯¼åŠ è½½ç¨‹åºæ˜ åƒä»¥ä¸€ç§æœªçŸ¥çš„æ ¼å¼å­˜å‚¨ï¼ˆå°½ç®¡ä¹Ÿè®¸å¯ä»¥é€šè¿‡ä¸€äº› Google æŠ€å·§æ‰¾åˆ°éœ€è¦çš„ç­”æ¡ˆï¼‰ã€‚æ— è®ºå¦‚ä½•ï¼Œä½¿ç”¨åå…­è¿›åˆ¶ç¼–è¾‘å™¨æ‰“å¼€è¯¥æ–‡ä»¶å¹¶çŒœæµ‹å…¶ç»“æ„åå‘ç°ï¼Œè¯¥æ ¼å¼å®é™…ä¸Šç›¸å½“ç®€å•ï¼š å¼•å¯¼åŠ è½½ç¨‹åºæ–‡ä»¶çš„ç»“æ„å¦‚ä¸‹ï¼š é­”æ•°ï¼ˆâ€œBOOTLDR!â€ï¼‰- 8ä¸ªå­—èŠ‚ã€‚ é•œåƒçš„æ•°é‡ - 4ä¸ªå­—èŠ‚ã€‚ é•œåƒæ•°æ®å¼€å¤´ç›¸å¯¹äºæ–‡ä»¶å¼€å¤´çš„åç§»é‡ - 4ä¸ªå­—èŠ‚ã€‚ åŒ…å«åœ¨é•œåƒä¸­çš„æ•°æ®çš„æ€»å¤§å° - 4ä¸ªå­—èŠ‚ã€‚ ä¸€ä¸ªæ•°ç»„ï¼Œå…¶é¡¹æ•°ä¸ä¸Šé¢çš„â€œé•œåƒæ•°é‡â€å­—æ®µç›¸åŒ¹é…ã€‚æ•°ç»„ä¸­çš„æ¯ä¸ªæ¡ç›®éƒ½æœ‰ä¸¤ä¸ªå­—æ®µï¼šé•œåƒåç§° - 64ä¸ªå­—èŠ‚ï¼ˆå¡«å……ä¸ºé›¶ï¼‰ï¼›é•œåƒé•¿åº¦ - 4ä¸ªå­—èŠ‚ã€‚ å¦‚æ‚¨åœ¨ä¸Šé¢çš„å›¾ç‰‡ä¸­æ‰€çœ‹åˆ°çš„ï¼Œå¼•å¯¼åŠ è½½ç¨‹åºæ˜ åƒåŒ…å«ä¸€ä¸ªåä¸ºâ€œtzâ€çš„æ˜ åƒï¼Œè¿™æ˜¯æˆ‘ä»¬è¦æ‰¾çš„æ˜ åƒã€‚ä¸ºäº†è§£åŒ…æ­¤æ–‡ä»¶ï¼Œæˆ‘ç¼–å†™äº†ä¸€ä¸ªå°å‹ Python è„šæœ¬ï¼ˆåœ¨æ­¤å¤„æä¾›ï¼‰ï¼Œè¯¥è„šæœ¬æ¥æ”¶å¼•å¯¼åŠ è½½ç¨‹åºæ˜ åƒå¹¶è§£åŒ…å…¶ä¸­åŒ…å«çš„æ‰€æœ‰æ–‡ä»¶ã€‚ æå–æ˜ åƒåï¼Œå°†å…¶ä¸å…ˆå‰ä»è®¾å¤‡ä¸­æå–çš„æ˜ åƒè¿›è¡Œæ¯”è¾ƒï¼Œæˆ‘éªŒè¯å®ƒä»¬ç¡®å®æ˜¯ç›¸åŒçš„ã€‚å› æ­¤ï¼Œæˆ‘æƒ³è¿™æ„å‘³ç€æˆ‘ä»¬ç°åœ¨å¯ä»¥ç»§ç»­æ£€æŸ¥ TrustZone æ˜ åƒäº†ã€‚ ä¿®å¤ TrustZone æ˜ åƒ é¦–å…ˆï¼Œæ£€æŸ¥æ–‡ä»¶ä¼šå‘ç°å®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ª ELF æ–‡ä»¶ï¼Œè¿™æ˜¯éå¸¸å¥½çš„æ¶ˆæ¯ï¼è¿™æ„å‘³ç€å†…å­˜æ®µåŠå…¶æ˜ å°„çš„åœ°å€åº”è¯¥å¯¹æˆ‘ä»¬å¯ç”¨ã€‚ åœ¨ä½¿ç”¨ IDA Pro æ‰“å¼€æ–‡ä»¶å¹¶è®©è‡ªåŠ¨åˆ†æè¿è¡Œä¸€æ®µæ—¶é—´åï¼Œæˆ‘æƒ³å¼€å§‹åæ±‡ç¼–æ–‡ä»¶ã€‚ç„¶è€Œï¼Œä»¤äººæƒŠè®¶çš„æ˜¯ï¼Œä¼¼ä¹æœ‰å¾ˆå¤šè·³è½¬åˆ°æœªæ˜ å°„åœ°å€ï¼ˆæˆ–è€…è¯´æŒ‡å‘ä¸åŒ…å«åœ¨â€œtzâ€äºŒè¿›åˆ¶æ–‡ä»¶ä¸­çš„åœ°å€ï¼‰çš„åˆ†æ”¯ã€‚ ä»”ç»†è§‚å¯Ÿåï¼Œä¼¼ä¹æ‰€æœ‰æŒ‡å‘æ— æ•ˆåœ°å€çš„ç»å¯¹åˆ†æ”¯éƒ½ä½äºæ–‡ä»¶çš„ç¬¬ä¸€ä¸ªä»£ç æ®µä¸­ï¼Œå¹¶ä¸”å®ƒä»¬æŒ‡å‘æœªæ˜ å°„çš„é«˜åœ°å€ã€‚æ­¤å¤–ï¼Œæ²¡æœ‰ç»å¯¹åˆ†æ”¯æŒ‡å‘è¯¥ç¬¬ä¸€ä¸ªä»£ç æ®µçš„åœ°å€ã€‚ è¿™ä¼¼ä¹æœ‰äº›å¯ç–‘â€¦é‚£ä¹ˆæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ ELF æ–‡ä»¶çš„ç»“æ„å¦‚ä½•ï¼Ÿæ‰§è¡Œ readelf å‘½ä»¤ä¼šæ˜¾ç¤ºä»¥ä¸‹å†…å®¹ï¼š æœ‰ä¸€ä¸ªç©ºæ®µæ˜ å°„åˆ°ä¸€ä¸ªæ›´é«˜çš„åœ°å€ï¼Œå®é™…ä¸Šä¸æ— æ•ˆç»å¯¹åˆ†æ”¯æŒ‡å‘çš„åœ°å€èŒƒå›´ç›¸å¯¹åº”ï¼é«˜é€šçš„å®¶ä¼™ä»¬å¾ˆèªæ˜ã€‚ æ— è®ºå¦‚ä½•ï¼Œæˆ‘åšå‡ºäº†ä¸€ä¸ªç›¸å½“å®‰å…¨çš„çŒœæµ‹ï¼Œå³ç¬¬ä¸€ä¸ªä»£ç æ®µå®é™…ä¸Šæ˜ å°„åˆ°é”™è¯¯çš„åœ°å€ï¼Œåº”è¯¥å®é™…ä¸Šæ˜ å°„åˆ°æ›´é«˜çš„åœ°å€-0xFE840000ã€‚å› æ­¤ï¼Œè‡ªç„¶åœ°ï¼Œæˆ‘æƒ³ä½¿ç”¨ IDA çš„é‡æ–°å®šä½åŠŸèƒ½é‡æ–°å®šä½æ®µï¼Œä½†æ˜¯æƒŠå¥‡åœ°å‘ç°ï¼è¿™ä¼šå¯¼è‡´ IDA å´©æºƒï¼š æˆ‘å…¶å®ä¸ç¡®å®šè¿™æ˜¯é«˜é€šæœ‰æ„ä¸ºä¹‹çš„åè°ƒè¯•ç‰¹æ€§ï¼Œè¿˜æ˜¯ NULL æ®µåªæ˜¯ä»–ä»¬å†…éƒ¨æ„å»ºè¿‡ç¨‹çš„ç»“æœï¼Œä½†æ˜¯è¿™å¯ä»¥é€šè¿‡æ‰‹åŠ¨ä¿®å¤ ELF æ–‡ä»¶æ¥è½»æ¾è§„é¿ã€‚åªéœ€è¦å°† NULL æ®µç§»åŠ¨åˆ°æœªä½¿ç”¨çš„åœ°å€ï¼ˆå› ä¸º IDA ä¼šå¿½ç•¥å®ƒï¼‰ï¼Œå¹¶å°†ç¬¬ä¸€ä¸ªä»£ç æ®µä»é”™è¯¯çš„åœ°å€ï¼ˆ0xFC86000ï¼‰ç§»åŠ¨åˆ°æ­£ç¡®çš„åœ°å€ï¼ˆ0xFE840000ï¼‰ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š ç°åœ¨ï¼Œåœ¨ IDA ä¸­åŠ è½½é•œåƒåï¼Œæ‰€æœ‰çš„ç»å¯¹åˆ†æ”¯éƒ½æœ‰æ•ˆï¼è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ç»§ç»­åˆ†æé•œåƒï¼ åˆ†æ TrustZone é•œåƒ é¦–å…ˆï¼Œåº”è¯¥æ³¨æ„çš„æ˜¯ï¼ŒTrustZone é•œåƒæ˜¯ä¸€ä¸ªç›¸å½“å¤§çš„ï¼ˆ285.5 KBï¼‰äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæœ‰ç›¸å½“å°‘çš„å­—ç¬¦ä¸²ï¼Œè€Œä¸”æ²¡æœ‰å…¬å¼€çš„æ–‡æ¡£ã€‚æ­¤å¤–ï¼ŒTrustZone ç³»ç»Ÿæ˜¯ç”±ä¸€ä¸ªå®Œæ•´çš„å†…æ ¸ç»„æˆçš„ï¼Œå…·æœ‰æ‰§è¡Œåº”ç”¨ç¨‹åºç­‰åŠŸèƒ½ï¼Œè¿˜æœ‰æ›´å¤šã€‚æ‰€ä»¥â€¦ä¸æ¸…æ¥šæˆ‘ä»¬åº”è¯¥ä»å“ªé‡Œå¼€å§‹ï¼Œå› ä¸ºé€†è½¬æ•´ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶å¯èƒ½ä¼šèŠ±è´¹å¤ªå¤šæ—¶é—´ã€‚ ç”±äºæˆ‘ä»¬æƒ³ä»åº”ç”¨å¤„ç†å™¨æ”»å‡» TrustZone å†…æ ¸ï¼Œæœ€å¤§çš„æ”»å‡»é¢å¯èƒ½æ˜¯å®‰å…¨ç›‘æ§è°ƒç”¨ï¼Œå®ƒä½¿ &quot;æ­£å¸¸ä¸–ç•Œ &quot;èƒ½å¤Ÿä¸ &quot;å®‰å…¨ä¸–ç•Œ &quot;äº’åŠ¨ã€‚ å½“ç„¶ï¼Œåº”è¯¥æ³¨æ„çš„æ˜¯ï¼Œè¿˜æœ‰å…¶ä»–çš„è½½ä½“å¯ä»¥è®©æˆ‘ä»¬ä¸ TrustZone è¿›è¡Œäº¤äº’ï¼Œæ¯”å¦‚å…±äº«å†…å­˜ï¼Œç”šè‡³æ˜¯ä¸­æ–­å¤„ç†ï¼Œä½†æ˜¯ç”±äºè¿™äº›æ‰€æ„æˆçš„æ”»å‡»é¢è¦å°å¾—å¤šï¼Œæ‰€ä»¥ä»åˆ†æ SMC è°ƒç”¨å¼€å§‹å¯èƒ½æ›´å¥½ã€‚ é‚£ä¹ˆï¼Œæˆ‘ä»¬å¦‚ä½•æ‰¾åˆ° TrustZone å†…æ ¸å¤„ç† SMC è°ƒç”¨çš„åœ°æ–¹å‘¢ï¼Ÿé¦–å…ˆï¼Œè®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹ï¼Œå½“æ‰§è¡Œ SMC è°ƒç”¨æ—¶ï¼Œä¸å¤„ç† SVC è°ƒç”¨ï¼ˆå³&quot;æ­£å¸¸ä¸–ç•Œ&quot;ä¸­çš„å¸¸è§„ç³»ç»Ÿè°ƒç”¨ï¼‰ç±»ä¼¼ï¼Œ&quot;å®‰å…¨ä¸–ç•Œ&quot;å¿…é¡»æ³¨å†Œå‘é‡çš„åœ°å€ï¼Œå½“é‡åˆ°è¿™ç§æŒ‡ä»¤æ—¶ï¼Œå¤„ç†å™¨å°†è·³è½¬åˆ°è¯¥å‘é‡ã€‚ &quot;å®‰å…¨ä¸–ç•Œ&quot;çš„ç­‰ä»·ç‰©æ˜¯ MVBARï¼ˆç›‘æ§å‘é‡åŸºå€å¯„å­˜å™¨ï¼‰ï¼Œå®ƒæä¾›äº†åŒ…å«å¤„ç†å™¨åœ¨&quot;å®‰å…¨ä¸–ç•Œ&quot;å¤„ç†ä¸åŒäº‹ä»¶çš„å¤„ç†åŠŸèƒ½çš„å‘é‡åœ°å€ã€‚ è®¿é—® MVBAR æ˜¯é€šè¿‡ MRC/MCR æ“ä½œç å®Œæˆçš„ï¼Œå…¶æ“ä½œæ•°å¦‚ä¸‹ï¼š å› æ­¤ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ç®€å•åœ°åœ¨ TrustZone é•œåƒä¸­æœç´¢å…·æœ‰ä»¥ä¸‹æ“ä½œæ•°çš„ MCR æ“ä½œç ï¼Œæˆ‘ä»¬åº”è¯¥èƒ½å¤Ÿæ‰¾åˆ°&quot;ç›‘æ§å‘é‡&quot;ã€‚äº‹å®ä¸Šï¼Œåœ¨ IDA ä¸­æœç´¢è¯¥æ“ä½œç ä¼šå¾—åˆ°ä»¥ä¸‹åŒ¹é…ç»“æœï¼š æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œ&quot;start&quot;ç¬¦å·ï¼ˆé¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œå®ƒæ˜¯å”¯ä¸€å¯¼å‡ºçš„ç¬¦å·ï¼‰çš„åœ°å€è¢«åŠ è½½åˆ° MVBAR ä¸­ã€‚æ ¹æ® ARM çš„æ–‡æ¡£ï¼Œ&quot;ç›‘æ§å‘é‡&quot;æœ‰ä»¥ä¸‹ç»“æ„ï¼š è¿™æ„å‘³ç€ï¼Œå¦‚æœæˆ‘ä»¬çœ‹ä¸€ä¸‹å‰é¢æåˆ°çš„&quot;start&quot;ç¬¦å·ï¼Œæˆ‘ä»¬å¯ä»¥ç»™è¯¥è¡¨ä¸­çš„åœ°å€åˆ†é…ä»¥ä¸‹åç§°ï¼š ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥åˆ†æä¸€ä¸‹ SMC_VECTOR_HANDLER å‡½æ•°ã€‚å®é™…ä¸Šï¼Œè¿™ä¸ªå‡½æ•°è´Ÿè´£ç›¸å½“å¤šçš„ä»»åŠ¡ï¼›é¦–å…ˆï¼Œå®ƒå°†æ‰€æœ‰çš„çŠ¶æ€å¯„å­˜å™¨å’Œè¿”å›åœ°å€ä¿å­˜åœ¨ä¸€ä¸ªé¢„å®šä¹‰çš„åœ°å€ä¸­ï¼ˆåœ¨&quot;å®‰å…¨ä¸–ç•Œ&quot;ä¸­ï¼‰ï¼Œç„¶åï¼Œå®ƒå°†å †æ ˆåˆ‡æ¢åˆ°ä¸€ä¸ªé¢„å…ˆåˆ†é…çš„åŒºåŸŸï¼ˆä¹Ÿåœ¨&quot;å®‰å…¨ä¸–ç•Œ&quot;ä¸­ï¼‰ã€‚æœ€åï¼Œåœ¨è¿›è¡Œäº†å¿…è¦çš„å‡†å¤‡å·¥ä½œåï¼Œå®ƒç»§ç»­åˆ†æç”¨æˆ·è¦æ±‚çš„æ“ä½œå¹¶æ ¹æ®å®ƒè¿›è¡Œæ“ä½œã€‚ ç”±äºå‘å¸ƒ SMC çš„ä»£ç å­˜åœ¨äº Linux å†…æ ¸çš„é«˜é€šå…¬å¸ MSM åˆ†æ”¯ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹&quot;æ­£å¸¸ä¸–ç•Œ&quot;å¯ä»¥å‘&quot;å®‰å…¨ä¸–ç•Œ&quot;å‘å¸ƒçš„å‘½ä»¤æ ¼å¼ã€‚ SMC å’Œ SCM ä»¤äººå›°æƒ‘çš„æ˜¯ï¼Œé«˜é€šå…¬å¸é€‰æ‹©å°†&quot;æ­£å¸¸ä¸–ç•Œ&quot;é€šè¿‡ SMC æ“ä½œç ä¸&quot;å®‰å…¨ä¸–ç•Œ&quot;äº’åŠ¨çš„æ¸ é“å‘½åä¸º SCMï¼ˆå®‰å…¨é€šé“ç®¡ç†å™¨ï¼‰ã€‚ æ€»ä¹‹ï¼Œæ­£å¦‚æˆ‘åœ¨ä¹‹å‰çš„åšæ–‡ä¸­æåˆ°çš„ï¼Œ&quot;qseecom&quot;é©±åŠ¨ç¨‹åºç”¨äºä½¿ç”¨ SCM ä¸&quot;å®‰å…¨ä¸–ç•Œ&quot;è¿›è¡Œé€šä¿¡ã€‚ é«˜é€šå…¬å¸åœ¨ç›¸å…³æºæ–‡ä»¶ä¸­æä¾›çš„æ–‡æ¡£ç›¸å½“å¹¿æ³›ï¼Œè¶³ä»¥è®©æˆ‘ä»¬å¾ˆå¥½åœ°æŒæ¡ SCM å‘½ä»¤çš„æ ¼å¼ã€‚ ç®€è€Œè¨€ä¹‹ï¼ŒSCM å‘½ä»¤å¯åˆ†ä¸ºä¸¤ç±»ä¹‹ä¸€ï¼š å¸¸è§„ SCM è°ƒç”¨ å½“æœ‰ä¿¡æ¯éœ€è¦ä»&quot;æ­£å¸¸ä¸–ç•Œ&quot;ä¼ é€’åˆ°&quot;å®‰å…¨ä¸–ç•Œ&quot;æ—¶ï¼Œå°±ä¼šä½¿ç”¨è¿™äº›è°ƒç”¨ï¼Œè¿™äº›ä¿¡æ¯éœ€è¦ä¸º SCM è°ƒç”¨æœåŠ¡ã€‚å†…æ ¸å¡«å……äº†ä»¥ä¸‹ç»“æ„ï¼š è€Œ TrustZone å†…æ ¸åœ¨ä¸º SCM è°ƒç”¨æä¾›æœåŠ¡åï¼Œå°†å“åº”å†™å›&quot;scm_response&quot;ç»“æ„ä¸­ï¼š ä¸ºäº†åˆ†é…å’Œå¡«å……è¿™äº›ç»“æ„ï¼Œå†…æ ¸å¯ä»¥è°ƒç”¨åŒ…è£…å‡½æ•° â€œscm_callâ€ï¼Œå®ƒæ¥æ”¶æŒ‡å‘å†…æ ¸ç©ºé—´ç¼“å†²åŒºçš„æŒ‡é’ˆï¼Œè¿™äº›ç¼“å†²åŒºåŒ…å«è¦å‘é€çš„æ•°æ®ï¼Œæ•°æ®åº”è¯¥è¢«è¿”å›çš„ä½ç½®ï¼Œä»¥åŠæœ€é‡è¦çš„ï¼ŒæœåŠ¡æ ‡è¯†ç¬¦å’Œå‘½ä»¤æ ‡è¯†ç¬¦ã€‚ æ¯ä¸ª SCM è°ƒç”¨éƒ½æœ‰ä¸€ä¸ª&quot;ç±»åˆ«&quot;ï¼Œè¿™æ„å‘³ç€å“ªä¸ª TrustZone å†…æ ¸å­ç³»ç»Ÿè´Ÿè´£å¤„ç†è¯¥è°ƒç”¨ã€‚è¿™æ˜¯ç”±æœåŠ¡æ ‡è¯†ç¬¦è¡¨ç¤ºçš„ã€‚å‘½ä»¤æ ‡è¯†ç¬¦æ˜¯ä¸€ä¸ªä»£ç ï¼Œå®ƒæŒ‡å®šäº†åœ¨ä¸€ä¸ªç»™å®šçš„æœåŠ¡ä¸­ï¼Œå“ªä¸ªå‘½ä»¤è¢«è¯·æ±‚ã€‚ åœ¨&quot;scm_call&quot;å‡½æ•°åˆ†é…å’Œå¡«å……&quot;scm_command&quot;å’Œ&quot;scm_response&quot;ç¼“å†²åŒºä¹‹åï¼Œå®ƒè°ƒç”¨ä¸€ä¸ªå†…éƒ¨çš„&quot;__scm_call&quot;å‡½æ•°ï¼Œå®ƒåˆ·æ–°æ‰€æœ‰çš„ç¼“å†²åŒºï¼ˆå†…éƒ¨å’Œå¤–éƒ¨ç¼“å†²åŒºï¼‰ï¼Œå¹¶è°ƒç”¨&quot;smc&quot;å‡½æ•°ã€‚ è¿™æœ€åä¸€ä¸ªå‡½æ•°å®é™…ä¸Šæ˜¯æ‰§è¡Œ SMC æ“ä½œç ï¼Œå°†æ§åˆ¶æƒè½¬ç§»åˆ° TrustZone å†…æ ¸ï¼Œåƒè¿™æ ·ï¼š æ³¨æ„ï¼ŒR0 è¢«è®¾ç½®ä¸º 1ï¼ŒR1 è¢«è®¾ç½®ä¸ºæŒ‡å‘æœ¬åœ°å†…æ ¸å †æ ˆåœ°å€ï¼Œå®ƒè¢«ç”¨ä½œè¯¥è°ƒç”¨çš„&quot;ä¸Šä¸‹æ–‡ ID&quot;ï¼ŒR2 è¢«è®¾ç½®ä¸ºæŒ‡å‘åˆ†é…çš„&quot;scm_command&quot;ç»“æ„çš„ç‰©ç†åœ°å€ã€‚ è¿™ä¸ªè®¾ç½®åœ¨ R0 ä¸­çš„&quot;é­”æ³•&quot;å€¼è¡¨æ˜è¿™æ˜¯ä¸€ä¸ªå¸¸è§„çš„ SCM è°ƒç”¨ï¼Œä½¿ç”¨&quot;scm_command&quot;ç»“æ„ã€‚ç„¶è€Œï¼Œå¯¹äºæŸäº›éœ€è¦è¾ƒå°‘æ•°æ®çš„å‘½ä»¤ï¼Œæ— ç¼˜æ— æ•…åœ°åˆ†é…æ‰€æœ‰è¿™äº›æ•°æ®ç»“æ„æ˜¯ç›¸å½“æµªè´¹çš„ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¼•å…¥äº†å¦ä¸€ç§å½¢å¼çš„ SCM è°ƒç”¨ã€‚ åŸå­ SCM è°ƒç”¨ å¯¹äºå‚æ•°æ•°é‡ç›¸å½“å°‘çš„è°ƒç”¨ï¼ˆæœ€å¤šå››ä¸ªå‚æ•°ï¼‰ï¼Œå­˜åœ¨å¦ä¸€ç§è¯·æ±‚ SCM è°ƒç”¨çš„æ–¹å¼ã€‚ æœ‰å››ä¸ªåŒ…è£…å‡½æ•°ï¼Œâ€œscm_call_atomic_[1-4]â€ï¼Œå®ƒä»¬ä¸è¯·æ±‚çš„å‚æ•°æ•°é‡ç›¸å¯¹åº”ã€‚è¿™äº›å‡½æ•°å¯ä»¥è¢«è°ƒç”¨ï¼Œä»¥ä¾¿ç›´æ¥å‘å‡ºä¸€ä¸ª SMCï¼Œç”¨ç»™å®šçš„æœåŠ¡å’Œå‘½ä»¤ IDï¼Œä»¥åŠç»™å®šçš„å‚æ•°è¿›è¡Œ SCM è°ƒç”¨ã€‚ ä¸‹é¢æ˜¯&quot;scm_call_atomic1&quot;å‡½æ•°çš„ä»£ç ï¼š å…¶ä¸­ SCM_ATOMIC è¢«å®šä¹‰ä¸ºï¼š æ³¨æ„ï¼ŒæœåŠ¡ ID å’Œå‘½ä»¤ ID éƒ½è¢«ç¼–ç åˆ° R0 ä¸­ï¼ŒåŒæ—¶è¿˜æœ‰è°ƒç”¨ä¸­çš„å‚æ•°æ•°ï¼ˆåœ¨æœ¬ä¾‹ä¸­æ˜¯ 1ï¼‰ã€‚è¿™å–ä»£äº†ä»¥å‰ç”¨äºå¸¸è§„ SCM è°ƒç”¨çš„&quot;ç¥å¥‡&quot;çš„ 1 å€¼ã€‚ R0 ä¸­çš„è¿™ä¸ªä¸åŒçš„å€¼å‘ TrustZone å†…æ ¸è¡¨æ˜ï¼Œä¸‹é¢çš„ SCM è°ƒç”¨æ˜¯ä¸€ä¸ªåŸå­è°ƒç”¨ï¼Œè¿™æ„å‘³ç€å‚æ•°å°†ä½¿ç”¨ R2-R5 ä¼ é€’ï¼ˆè€Œä¸æ˜¯ä½¿ç”¨ R2 æŒ‡å‘çš„ç»“æ„ï¼‰ã€‚ åˆ†æ SCM è°ƒç”¨ ç°åœ¨æˆ‘ä»¬å·²ç»äº†è§£äº† SCM è°ƒç”¨çš„å·¥ä½œåŸç†ï¼Œå¹¶ä¸”æ‰¾åˆ°äº† TrustZone å†…æ ¸ä¸­ç”¨äºå¤„ç†è¿™äº› SCM è°ƒç”¨çš„å¤„ç†å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹åæ±‡ç¼– SCM è°ƒç”¨ï¼Œè¯•å›¾åœ¨å…¶ä¸­æ‰¾åˆ°ä¸€ä¸ªæ¼æ´ã€‚ æˆ‘å°†è·³è¿‡å¯¹ SCM å¤„ç†å‡½æ•°çš„å¤§éƒ¨åˆ†åˆ†æï¼Œå› ä¸ºå®ƒçš„å¤§éƒ¨åˆ†æ˜¯å¯¹ç”¨æˆ·è¾“å…¥çš„æ¨¡æ¿å¤„ç†ï¼Œç­‰ç­‰ã€‚ç„¶è€Œï¼Œåœ¨å°†å †æ ˆåˆ‡æ¢åˆ° TrustZone åŒºåŸŸå¹¶ä¿å­˜æ‰§è¡Œè°ƒç”¨çš„åŸå§‹å¯„å­˜å™¨åï¼Œå¤„ç†å‡½æ•°ç»§ç»­å¤„ç†æœåŠ¡ ID å’Œå‘½ä»¤ IDï¼Œä»¥ç¡®å®šåº”è¯¥è°ƒç”¨å“ªä¸ªå†…éƒ¨å¤„ç†å‡½æ•°ã€‚ ä¸ºäº†æ–¹ä¾¿æœåŠ¡å’Œå‘½ä»¤ ID ä¸ç›¸å…³å¤„ç†å‡½æ•°ä¹‹é—´çš„æ˜ å°„ï¼Œä¸€ä¸ªé™æ€åˆ—è¡¨è¢«ç¼–è¯‘åˆ° TrustZone é•œåƒçš„æ•°æ®æ®µï¼Œå¹¶è¢« SCM å¤„ç†å‡½æ•°å¼•ç”¨ã€‚ä¸‹é¢æ˜¯è¯¥åˆ—è¡¨çš„ä¸€ä¸ªç®€çŸ­ç‰‡æ®µï¼š æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œè¯¥åˆ—è¡¨æœ‰ä»¥ä¸‹ç»“æ„ï¼š æŒ‡å‘åŒ…å« SCM å‡½æ•°åç§°çš„å­—ç¬¦ä¸²çš„æŒ‡é’ˆ è°ƒç”¨çš„&quot;ç±»å‹&quot; æŒ‡å‘å¤„ç†å‡½æ•°çš„æŒ‡é’ˆ å‚æ•°çš„æ•°é‡ æ¯ä¸ªå‚æ•°çš„å¤§å°ï¼ˆæ¯ä¸ªå‚æ•°æœ‰ä¸€ä¸ª DWORDï¼‰ã€‚ æœåŠ¡ ID å’Œå‘½ä»¤ IDï¼Œä¸²è”æˆä¸€ä¸ª DWORD - ä¾‹å¦‚ï¼Œä¸Šé¢çš„&quot;tz_blow_sw_fuse&quot;å‡½æ•°ï¼Œå…¶ç±»å‹ä¸º 0x2002ï¼Œè¿™æ„å‘³ç€å®ƒå±äºæœåŠ¡ ID 0x20ï¼Œå…¶å‘½ä»¤ ID ä¸º 0x02ã€‚ ç°åœ¨å‰©ä¸‹çš„å°±æ˜¯å¼€å§‹æ‹†è§£è¿™äº›å‡½æ•°ï¼Œå¹¶å¸Œæœ›èƒ½æ‰¾åˆ°ä¸€ä¸ªå¯åˆ©ç”¨çš„é”™è¯¯ã€‚ æ¼æ´! å› æ­¤ï¼Œåœ¨ä»”ç»†ç ”ç©¶äº†ä¸Šè¿°æ‰€æœ‰çš„ SMC è°ƒç”¨ï¼ˆå…¨éƒ¨ 69 ä¸ªï¼‰åï¼Œæˆ‘ç»ˆäºæ‰¾åˆ°äº†ä»¥ä¸‹å‡½æ•°ï¼š é€šå¸¸æƒ…å†µä¸‹ï¼Œå½“ä½¿ç”¨å¸¸è§„çš„ SCM è°ƒç”¨æœºåˆ¶è°ƒç”¨ SCM å‘½ä»¤æ—¶ï¼ŒR0 å°†åŒ…å«&quot;ç»“æœåœ°å€&quot;ï¼Œå®ƒæŒ‡å‘ç”±å†…æ ¸åˆ†é…çš„&quot;scm_response&quot;ç¼“å†²åŒºï¼Œä½†å®ƒä¹Ÿè¢« TrustZone å†…æ ¸éªŒè¯ï¼Œä»¥ç¡®ä¿å®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ª &quot;å…è®¸&quot;èŒƒå›´å†…çš„ç‰©ç†åœ°å€ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªå¯¹åº”äº Linux å†…æ ¸å†…å­˜çš„ç‰©ç†åœ°å€ï¼Œè€Œä¸æ˜¯ï¼Œä¾‹å¦‚ï¼ŒTrustZone äºŒè¿›åˆ¶ä¸­çš„å†…å­˜ä½ç½®ã€‚ è¿™ä¸ªæ£€æŸ¥æ˜¯é€šè¿‡ä¸€ä¸ªå†…éƒ¨å‡½æ•°è¿›è¡Œçš„ï¼Œæˆ‘å°†åœ¨ä¸‹ä¸€ç¯‡åšæ–‡ä¸­è¯¦ç»†ä»‹ç»ï¼ˆè¯·ç»§ç»­å…³æ³¨ï¼ï¼‰ã€‚ ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªåŸå­çš„ SCM è°ƒç”¨æ¥æ‰§è¡Œä¸€ä¸ªå‡½æ•°ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½¿ç”¨çš„&quot;ç»“æœåœ°å€&quot;æ˜¯åŸå­è°ƒç”¨æ‰€ä¼ é€’çš„ç¬¬ä¸€ä¸ªå‚æ•°ã€‚ ç°åœ¨â€“ä½ èƒ½çœ‹åˆ°ä¸Šé¢è¿™ä¸ªå‡½æ•°ä¸­çš„é”™è¯¯å—ï¼Ÿ ç›¸å¯¹äºå…¶ä»– SCM å¤„ç†å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æœªèƒ½éªŒè¯ R0 ä¸­çš„å€¼ï¼Œå³&quot;ç»“æœåœ°å€&quot;ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬ä¼ å…¥ R1ä¸ºéé›¶å€¼ï¼ˆä¸ºäº†ä¼ é€’ç¬¬ä¸€ä¸ªåˆ†æ”¯ï¼‰ ç¬¬å››ä¸ªå‚æ•°ï¼ˆåœ¨ä¸Šé¢ var_1C å¤„ä¼ å…¥ï¼‰ä¸ºéé›¶å€¼ R0 ä¸ºä»»ä½•ç‰©ç†åœ°å€ï¼ŒåŒ…æ‹¬ TrustZone åœ°å€ç©ºé—´èŒƒå›´å†…çš„ä¸€ä¸ªåœ°å€ è¯¥å‡½æ•°å°†åˆ°è¾¾ä¸Šè¿°å‡½æ•°ä¸­æœ€å·¦è¾¹çš„åˆ†æ”¯ï¼Œå¹¶åœ¨ R0 åŒ…å«çš„åœ°å€å¤„å†™å…¥ä¸€ä¸ªDWORD 0ã€‚ è´Ÿè´£ä»»çš„æŠ«éœ² æˆ‘æƒ³æŒ‡å‡ºçš„æ˜¯ï¼Œæˆ‘å·²ç»åœ¨ 11 ä¸ªæœˆå‰å‘é«˜é€šå…¬å¸è´Ÿè´£ä»»åœ°æŠ«éœ²äº†è¿™ä¸ªæ¼æ´ï¼Œè€Œä¸”è¿™ä¸ªé—®é¢˜å·²ç»è¢«ä»–ä»¬ä¿®å¤äº†ï¼ˆé€Ÿåº¦å¿«å¾—æƒŠäººï¼ï¼‰ã€‚æˆ‘å°†åœ¨ä¸‹ä¸€ç¯‡åšæ–‡ä¸­åˆ†äº«è¯¦ç»†çš„æ—¶é—´è¡¨å’Œè§£é‡Šï¼Œä½†æˆ‘æƒ³æŒ‡å‡ºçš„æ˜¯ï¼Œé«˜é€šå…¬å¸çš„äººååº”éå¸¸è¿…é€Ÿï¼Œä¸ä»–ä»¬åˆä½œéå¸¸æ„‰å¿«ã€‚ ä¸‹ä¸€æ­¥æ˜¯ä»€ä¹ˆï¼Ÿ åœ¨ä¸‹ä¸€ç¯‡åšæ–‡ä¸­ï¼Œæˆ‘å°†åˆ†äº«ä¸€ä¸ªé’ˆå¯¹ä¸Šè¿°æ¼æ´çš„è¯¦ç»†ï¼ˆè€Œä¸”ç›¸å½“å¤æ‚ï¼ï¼‰çš„åˆ©ç”¨æ–¹æ³•ï¼Œå®ƒå¯ä»¥åœ¨ TrustZone å†…æ ¸å†…æ‰§è¡Œå…¨éƒ¨ä»£ç ã€‚æˆ‘è¿˜ä¼šå…¬å¸ƒå®Œæ•´çš„æ¼æ´ä»£ç ï¼Œæ•¬è¯·å…³æ³¨ å¦å¤–ï¼Œç”±äºè¿™åªæ˜¯æˆ‘çš„ç¬¬äºŒç¯‡åšæ–‡ï¼Œæˆ‘çœŸçš„å¸Œæœ›å¾—åˆ°ä¸€äº›ï¼ˆä»»ä½•ï¼‰æ„è§ï¼Œç‰¹åˆ«æ˜¯ï¼š æˆ‘åº”è¯¥å¤šå†™ï¼ˆæˆ–å°‘å†™ï¼‰äº›ä»€ä¹ˆï¼Ÿ åšå®¢è®¾è®¡é—®é¢˜ ç ”ç©¶æ€è·¯ ğŸ˜ƒ","categories":[{"name":"Linux","slug":"Linux","permalink":"https://blog.inoki.cc/categories/Linux/"},{"name":"Android","slug":"Linux/Android","permalink":"https://blog.inoki.cc/categories/Linux/Android/"}],"tags":[{"name":"ä¸­æ–‡","slug":"ä¸­æ–‡","permalink":"https://blog.inoki.cc/tags/ä¸­æ–‡/"},{"name":"Linux","slug":"Linux","permalink":"https://blog.inoki.cc/tags/Linux/"},{"name":"Android","slug":"Android","permalink":"https://blog.inoki.cc/tags/Android/"},{"name":"ABL","slug":"ABL","permalink":"https://blog.inoki.cc/tags/ABL/"},{"name":"Bootloader","slug":"Bootloader","permalink":"https://blog.inoki.cc/tags/Bootloader/"}]},{"title":"ã€è¯‘ã€‘åœ¨ä»»ä½•ä¸Šä¸‹æ–‡ä¸­è¿›è¡Œ TrustZone å†…æ ¸ä¸­çš„ä»»æ„ä»£ç æ‰§è¡Œ","slug":"getting-arbitrary-code-execution-in","date":"2023-04-29T11:20:00.000Z","updated":"2025-03-08T09:40:48.609Z","comments":true,"path":"2023/04/29/getting-arbitrary-code-execution-in/","link":"","permalink":"https://blog.inoki.cc/2023/04/29/getting-arbitrary-code-execution-in/","excerpt":"","text":"åœ¨æœ¬ç¯‡åšå®¢ä¸­ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯ä½¿ç”¨ TrustZone å†…æ ¸ä»£ç æ‰§è¡Œæ¼æ´è¶…è¶Š Androidã€‚ è¿™å°†æ˜¯ä¸€ç³»åˆ—åšå®¢æ–‡ç« ï¼Œè¯¦ç»†ä»‹ç»æˆ‘å‘ç°çš„ä¸€ç³»åˆ—æ¼æ´ï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿä»ä»»ä½•ç”¨æˆ·æå‡ç‰¹æƒï¼Œç›´åˆ°æœ€é«˜ç‰¹æƒâ€”â€”åœ¨ TrustZone ä¸­æ‰§è¡Œæˆ‘ä»¬çš„ä»£ç ã€‚ ç”±äºæˆ‘åªæœ‰ä¸€å°ä¸ªäºº Android è®¾å¤‡ï¼Œä¸€å°ç”± Snapdragon 800 SoC é©±åŠ¨çš„ Nexus 5ï¼Œå› æ­¤æˆ‘å°†é‡ç‚¹å…³æ³¨æˆ‘çš„è®¾å¤‡ä¸Šå­˜åœ¨çš„ TrustZone å¹³å°â€”â€” Qualcomm çš„ TrustZone å®ç°ã€‚ åº”è¯¥æ³¨æ„åˆ°ï¼ŒQualcomm çš„ TrustZone å¹³å°å­˜åœ¨äºç”± Qualcomm SoC é©±åŠ¨çš„æ‰€æœ‰è®¾å¤‡ä¸Šï¼Œä½†æ˜¯ä»–ä»¬ä¹Ÿå…è®¸ OEM å¯¹è¯¥å¹³å°è¿›è¡Œä¿®æ”¹å’Œæ·»åŠ ï¼Œæˆ‘å°†åœ¨ä»¥åçš„åšå®¢æ–‡ç« ä¸­è¯¦ç»†ä»‹ç»ã€‚ æ­¤å¤–ï¼Œæˆ‘ç›¸ä¿¡å®¢è§‚åœ°è¯´ï¼ŒQualcomm çš„ TrustZone å®ç°æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ç›®æ ‡ï¼Œå› ä¸º Snapdragon SoC éå¸¸æ™®éï¼Œå¯ä»¥åœ¨éå¸¸å¹¿æ³›çš„è®¾å¤‡ä¸­æ‰¾åˆ°ï¼ˆè¿™å¹¶ä¸å¥‡æ€ªï¼Œè€ƒè™‘åˆ° Qualcomm åœ¨æ™ºèƒ½æ‰‹æœºèŠ¯ç‰‡ç»„å¸‚åœºä¸Šæœ‰éå¸¸å¤§çš„å¸‚åœºä»½é¢ï¼‰ã€‚ Android å’Œå®‰å…¨æ€§ å¤šå¹´æ¥ï¼ŒAndroid å·²ç»å¢åŠ äº†è®¸å¤šå®‰å…¨æœºåˆ¶ï¼Œå¹¶æ”¹è¿›äº†ç°æœ‰æœºåˆ¶ã€‚ å°½ç®¡åŸºç¡€å®‰å…¨ä½“ç³»ç»“æ„æ²¡æœ‰æ”¹å˜ï¼Œä½†åœ¨ç°ä»£è®¾å¤‡ä¸Šï¼Œç°æœ‰çš„é˜²å¾¡æªæ–½å·²ç»å˜å¾—éå¸¸å¼ºå¤§ï¼Œä»¥è‡³äºè·å¾—é«˜ç‰¹æƒå¯èƒ½æˆä¸ºä¸€é¡¹ç›¸å½“å›°éš¾çš„ä»»åŠ¡ï¼Œå¾€å¾€éœ€è¦å¤šä¸ªæ¼æ´ã€‚ å¦‚æœæ‚¨è¿˜æ²¡æœ‰é˜…è¯»è¿‡ Google çš„â€œAndroid å®‰å…¨æ¦‚è¿°â€ï¼Œæˆ‘å»ºè®®æ‚¨é˜…è¯»ä¸€ä¸‹ï¼Œå…¶ä¸­è§£é‡Šäº†å®‰å…¨æ¶æ„å¹¶åˆ—å‡ºäº†ç›®å‰ä½¿ç”¨çš„å¤§å¤šæ•°å®‰å…¨æœºåˆ¶ã€‚ ï¼ˆå¯¹äºæœ¬ç³»åˆ—åšå®¢æ–‡ç« ï¼Œæˆ‘å°†å‡å®šæ‚¨è‡³å°‘å¯¹ Android çš„å®‰å…¨æ¶æ„æœ‰ä¸€å®šçš„äº†è§£ï¼‰ã€‚ ä»€ä¹ˆæ˜¯ TrustZoneï¼Ÿ TrustZone æ˜¯ä¸€ç§ç³»ç»ŸèŒƒå›´çš„å®‰å…¨æ€§è§£å†³æ–¹æ¡ˆï¼Œé€‚ç”¨äºæ‰‹æŒè®¾å¤‡ã€å¹³æ¿ç”µè„‘ã€å¯ç©¿æˆ´è®¾å¤‡å’Œä¼ä¸šç³»ç»Ÿç­‰å¤šç§è®¡ç®—å¹³å°ã€‚è¯¥æŠ€æœ¯çš„åº”ç”¨èŒƒå›´éå¸¸å¹¿æ³›ï¼ŒåŒ…æ‹¬æ”¯ä»˜ä¿æŠ¤æŠ€æœ¯ã€æ•°å­—ç‰ˆæƒç®¡ç†ã€BYOD ä»¥åŠè®¸å¤šå®‰å…¨ä¼ä¸šè§£å†³æ–¹æ¡ˆã€‚ ç®€è€Œè¨€ä¹‹ï¼ŒTrustZone æ˜¯ä¸€ä¸ªæ—¨åœ¨å®ç°ç›®æ ‡è®¾å¤‡ä¸Šçš„â€œå®‰å…¨æ‰§è¡Œâ€çš„ç³»ç»Ÿã€‚ ä¸ºäº†æ‰§è¡Œå®‰å…¨çš„ TrustZone ä»£ç ï¼Œéœ€è¦æŒ‡å®šä¸€ä¸ªç‰¹å®šçš„å¤„ç†å™¨ã€‚è¯¥å¤„ç†å™¨å¯ä»¥æ‰§è¡Œéå®‰å…¨ä»£ç ï¼ˆåœ¨â€œNormal Worldâ€ä¸­ï¼‰å’Œå®‰å…¨ä»£ç ï¼ˆåœ¨â€œSecure Worldâ€ä¸­ï¼‰ã€‚å…¶ä»–æ‰€æœ‰å¤„ç†å™¨ä»…èƒ½è¿è¡Œåœ¨â€œNormal Worldâ€ã€‚ åœ¨ Android è®¾å¤‡ä¸Šï¼ŒTrustZone ç”¨äºå„ç§ä¸åŒçš„ç›®çš„ï¼Œä¾‹å¦‚ï¼š éªŒè¯å†…æ ¸å®Œæ•´æ€§ï¼ˆTIMAï¼‰ ä½¿ç”¨ç¡¬ä»¶å‡­è¯å­˜å‚¨ï¼ˆè¢«â€œkeystoreâ€ã€â€œdm-verityâ€ä½¿ç”¨ï¼‰ ç§»åŠ¨æ”¯ä»˜çš„å®‰å…¨å…ƒç´ ä»¿çœŸ å®ç°å’Œç®¡ç†å®‰å…¨å¯åŠ¨ DRMï¼ˆä¾‹å¦‚ PlayReadyï¼‰ è®¿é—®å¹³å°ç¡¬ä»¶åŠŸèƒ½ï¼ˆä¾‹å¦‚ç¡¬ä»¶ç†µï¼‰ ä¸ºäº†ä¿æŠ¤æ•´ä¸ªç³»ç»Ÿè€Œä¸ä»…ä»…æ˜¯åº”ç”¨ç¨‹åºå¤„ç†å™¨ï¼Œå½“è¿›å…¥â€œSecure Worldâ€æ—¶ï¼Œåœ¨ç³»ç»Ÿæ€»çº¿ä¸Šè®¾ç½®ç‰¹å®šä½ï¼Œè¿”å›â€œNormal Worldâ€æ—¶å–æ¶ˆè®¾ç½®è¿™äº›ä½ã€‚å¤–å›´è®¾å¤‡å¯ä»¥è®¿é—®è¿™äº›ä½çš„çŠ¶æ€ï¼Œä»è€Œå¯ä»¥æ¨æ–­å‡ºæˆ‘ä»¬å½“å‰æ˜¯å¦æ­£åœ¨å®‰å…¨ä¸–ç•Œä¸­è¿è¡Œã€‚ TrustZone çš„å®‰å…¨æ¨¡å‹æ˜¯å¦‚ä½•å·¥ä½œçš„ ARM è¿˜æä¾›äº†ä¸€ä¸ªç®€çŸ­çš„ TrustZone å®‰å…¨æ¨¡å‹æŠ€æœ¯æ¦‚è¿°ï¼Œå€¼å¾—ä¸€è¯»ã€‚ è¦å®ç°å®‰å…¨æ‰§è¡Œï¼Œéœ€è¦å®šä¹‰ TrustZone ä¸é TrustZone ä»£ç ä¹‹é—´çš„è¾¹ç•Œã€‚è¿™å¯ä»¥é€šè¿‡å®šä¹‰ä¸¤ä¸ªâ€œä¸–ç•Œâ€ -â€œSecure Worldâ€ï¼ˆTrustZoneï¼‰å’Œâ€œNormal Worldâ€ï¼ˆåœ¨æˆ‘ä»¬çš„æƒ…å†µä¸‹ä¸º Androidï¼‰æ¥å®ç°ã€‚ å¦‚æ‚¨æ‰€çŸ¥ï¼Œåœ¨â€œNormal Worldâ€ä¸­ï¼Œè¿è¡Œåœ¨â€œUser-modeâ€å’Œè¿è¡Œåœ¨â€œSupervisor-modeâ€ï¼ˆKernel-modeï¼‰ä¸­çš„ä»£ç ä¹‹é—´å­˜åœ¨ä¸€ä¸ªå®‰å…¨è¾¹ç•Œã€‚ ä¸åŒæ¨¡å¼ä¹‹é—´çš„åŒºåˆ«ç”±å½“å‰ç¨‹åºçŠ¶æ€å¯„å­˜å™¨ï¼ˆCPSRï¼‰ç®¡ç†ï¼š åœ¨ TrustZone ä¸­ï¼Œä¸€ä¸ªç‰¹å®šçš„å¤„ç†å™¨æ‰§è¡Œå®‰å…¨ä»£ç ï¼Œå¹¶ä¸”ç³»ç»Ÿæ€»çº¿ä¸Šç‰¹å®šä½çš„çŠ¶æ€å†³å®šæˆ‘ä»¬å½“å‰æ˜¯å¦æ­£åœ¨å®‰å…¨ä¸–ç•Œä¸­è¿è¡Œã€‚ ä»¥ä¸Šå›¾åƒä¸­æ ‡è®°ä¸º&quot;M&quot;çš„äº”ä¸ªæ¨¡å¼ä½ï¼ˆmode bitsï¼‰æ§åˆ¶å½“å‰çš„æ‰§è¡Œæ¨¡å¼ã€‚åœ¨ Linux å†…æ ¸çš„æƒ…å†µä¸‹ï¼Œç”¨æˆ·æ¨¡å¼ï¼ˆUser Modeï¼Œb10000ï¼‰ç”¨äºæ™®é€šç”¨æˆ·ä»£ç ï¼Œè€Œ Supervisor è€…æ¨¡å¼ï¼ˆSupervisor Modeï¼Œb10011ï¼‰ç”¨äºå†…æ ¸ä»£ç ã€‚ ç„¶è€Œï¼Œè¿™é‡Œç¼ºå°‘äº†ä¸€äº›ä¸œè¥¿ - æ²¡æœ‰ä¸€ä¸ªä½æ¥æŒ‡ç¤ºå½“å‰æ´»åŠ¨çš„â€œä¸–ç•Œâ€ã€‚è¿™æ˜¯å› ä¸ºæœ‰ä¸€ä¸ªå•ç‹¬çš„å¯„å­˜å™¨ç”¨äºè¿™ä¸ªç›®çš„ - å®‰å…¨é…ç½®å¯„å­˜å™¨ï¼ˆSecure Configuration Registerï¼ŒSCRï¼‰ï¼š è¿™ä¸ªå¯„å­˜å™¨æ˜¯ä¸€ä¸ªåå¤„ç†å™¨å¯„å­˜å™¨ï¼Œä½äº CP15 c1ï¼Œè¿™æ„å‘³ç€å¯ä»¥ä½¿ç”¨ MRC / MCR æ“ä½œç æ¥è®¿é—®å®ƒã€‚ ä¸ CPSR å¯„å­˜å™¨ä¸€æ ·ï¼Œâ€œNormal Worldâ€ä¸èƒ½ç›´æ¥ä¿®æ”¹ SCR å¯„å­˜å™¨ã€‚ç„¶è€Œï¼Œå®ƒå¯ä»¥æ‰§è¡Œ SMC æ“ä½œç ï¼Œè¿™ç›¸å½“äºæ™®é€š Supervisor æ¨¡å¼è°ƒç”¨çš„ SWIã€‚SMC æ˜¯ Supervisor Mode Call çš„ç¼©å†™ï¼Œæ˜¯å¯ç”¨äºç›´æ¥å‘ TrustZone å†…æ ¸å‘å‡ºè¯·æ±‚çš„æ“ä½œç ã€‚ æ­¤å¤–ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒSMC æ“ä½œç åªèƒ½ä» Supervisor ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ï¼Œè¿™æ„å‘³ç€å¸¸è§„ç”¨æˆ·ä»£ç æ— æ³•ä½¿ç”¨ SMC æ“ä½œç ã€‚ ä¸ºäº†å®é™…è°ƒç”¨ TrustZone ç›¸å…³åŠŸèƒ½ï¼ŒSupervisor çš„ä»£ç ï¼Œå³æˆ‘ä»¬çš„ Linux å†…æ ¸ï¼Œå¿…é¡»æ³¨å†ŒæŸç§æœåŠ¡ï¼Œä»¥ä¾¿åœ¨éœ€è¦æ—¶è°ƒç”¨ç›¸å…³çš„ SMC è°ƒç”¨ã€‚ åœ¨ Qualcomm çš„æƒ…å†µä¸‹ï¼Œè¿™æ˜¯é€šè¿‡ä¸€ä¸ªåä¸º qseecom çš„è®¾å¤‡é©±åŠ¨ç¨‹åºæ¥å®ç°ï¼Œè¯¥ç¼©å†™ä»£è¡¨ Qualcomm å®‰å…¨æ‰§è¡Œç¯å¢ƒé€šä¿¡ã€‚ç¨åçš„åšå®¢æ–‡ç« ä¸­æˆ‘ä»¬ä¼šæ›´è¯¦ç»†åœ°è°ˆè®ºè¿™ä¸ªé©±åŠ¨ç¨‹åºï¼Œæ•¬è¯·å…³æ³¨ã€‚ ç»¼åˆèµ·æ¥ å› æ­¤ï¼Œè¦ä»æ²¡æœ‰æƒé™çš„ç”¨æˆ·æ¨¡å¼ Android åº”ç”¨ç¨‹åºä¸­è·å¾— TrustZone ä»£ç æ‰§è¡Œï¼Œæˆ‘ä»¬éœ€è¦ä»¥ä¸‹ç‰¹æƒå‡çº§æ¼æ´ï¼š ä»æ²¡æœ‰æƒé™çš„ Android åº”ç”¨ç¨‹åºå‡çº§åˆ°æ‹¥æœ‰ç‰¹æƒçš„ Android ç”¨æˆ·ã€‚ ä»ç‰¹æƒçš„ Android ç”¨æˆ·å‡çº§åˆ° Linux å†…æ ¸ä¸­çš„ä»£ç æ‰§è¡Œã€‚ ä» Linux å†…æ ¸å‡çº§åˆ° TrustZone å†…æ ¸ä¸­çš„ä»£ç æ‰§è¡Œã€‚ å› æ­¤ï¼Œå¦‚æœæ‚¨å¯¹æ­¤æ„Ÿå…´è¶£ï¼Œè¯·ç»§ç»­é˜…è¯»ï¼ åœ¨ä¸‹ä¸€ç¯‡åšå®¢æ–‡ç« ä¸­ï¼Œæˆ‘å°†ä»‹ç»æ›´å¤šå…³äº Qualcomm çš„ TrustZone å®ç°çš„ç»†èŠ‚ï¼Œä»¥åŠæˆ‘åœ¨å…¶å†…æ ¸ä¸­å‘ç°å’Œåˆ©ç”¨çš„æ¼æ´ã€‚","categories":[{"name":"Linux","slug":"Linux","permalink":"https://blog.inoki.cc/categories/Linux/"},{"name":"Android","slug":"Linux/Android","permalink":"https://blog.inoki.cc/categories/Linux/Android/"}],"tags":[{"name":"ä¸­æ–‡","slug":"ä¸­æ–‡","permalink":"https://blog.inoki.cc/tags/ä¸­æ–‡/"},{"name":"Linux","slug":"Linux","permalink":"https://blog.inoki.cc/tags/Linux/"},{"name":"Android","slug":"Android","permalink":"https://blog.inoki.cc/tags/Android/"},{"name":"ABL","slug":"ABL","permalink":"https://blog.inoki.cc/tags/ABL/"},{"name":"Bootloader","slug":"Bootloader","permalink":"https://blog.inoki.cc/tags/Bootloader/"}]},{"title":"ã€è¯‘ã€‘è§£é”æ‘©æ‰˜ç½—æ‹‰çš„å¼•å¯¼ç¨‹åº","slug":"unlocking-motorola-bootloader","date":"2023-04-25T11:20:00.000Z","updated":"2025-03-08T09:40:48.611Z","comments":true,"path":"2023/04/25/unlocking-motorola-bootloader/","link":"","permalink":"https://blog.inoki.cc/2023/04/25/unlocking-motorola-bootloader/","excerpt":"","text":"åœ¨æœ¬ç¯‡åšå®¢ä¸­ï¼Œæˆ‘ä»¬å°†æ¢è®¨æœ€è¿‘é«˜é€šéªé¾™è®¾å¤‡ä¸Šçš„æ‘©æ‰˜ç½—æ‹‰å¼•å¯¼ç¨‹åºã€‚æˆ‘ä»¬çš„ç›®æ ‡æ˜¯ä½¿ç”¨ä¸Šä¸€ç¯‡åšå®¢ä¸­çš„ TrustZone å†…æ ¸ä»£ç æ‰§è¡Œæ¼æ´ï¼Œè§£é” Moto Xï¼ˆç¬¬äºŒä»£ï¼‰çš„å¼•å¯¼ç¨‹åºã€‚è¯·æ³¨æ„ï¼Œè™½ç„¶æˆ‘ä»¬å°†å±•ç¤ºç‰¹å®šè®¾å¤‡çš„å®Œæ•´è§£é”è¿‡ç¨‹ï¼Œä½†å®ƒåº”è¯¥è¶³å¤Ÿé€šç”¨ï¼Œè‡³å°‘é€‚ç”¨äºå¤§å¤šæ•°ç°ä»£æ‘©æ‰˜ç½—æ‹‰è®¾å¤‡ã€‚ ä¸ºä»€ä¹ˆæ˜¯æ‘©æ‰˜ç½—æ‹‰ï¼Ÿ åœ¨å‘é«˜é€šæŠ¥å‘Šä¸Šä¸€ä¸ª TrustZone å†…æ ¸ç‰¹æƒå‡çº§åï¼Œä»–ä»¬é€äº†æˆ‘ä¸€éƒ¨å…¨æ–°çš„ Moto Xã€‚ç„¶è€Œâ€¦æœ‰ä¸€ä¸ªå°é—®é¢˜-ä»–ä»¬ä¸å°å¿ƒæŠŠä¸€ä¸ªé”å®šçš„è®¾å¤‡é€ç»™äº†æˆ‘ã€‚è¿™æ˜¯ä¸€ä¸ªå®Œå…¨è¯šå®çš„é”™è¯¯ï¼Œä»–ä»¬ç¡®å®å¤šæ¬¡æä¾›è§£é”è®¾å¤‡çš„æœåŠ¡-ä½†è¿™æœ‰ä»€ä¹ˆä¹è¶£å‘¢ï¼Ÿå› æ­¤ï¼Œè®©æˆ‘ä»¬æ·±å…¥æ‘©æ‰˜ç½—æ‹‰çš„å¼•å¯¼ç¨‹åºï¼Œçœ‹çœ‹è§£é”å®ƒéœ€è¦ä»€ä¹ˆã€‚ é“ºå« åœ¨æˆ‘ä»¬å¼€å§‹ç ”ç©¶ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆç®€å•ä»‹ç»å¼•å¯¼è¿‡ç¨‹ï¼Œä»è®¾å¤‡é€šç”µå¼€å§‹ã€‚ é¦–å…ˆï¼Œæ‰§è¡Œ PBLï¼ˆä¸»å¼•å¯¼ç¨‹åºï¼‰ï¼Œä¹Ÿç§°ä¸ºâ€œBootROMâ€ã€‚ç”±äº PBL å­˜å‚¨åœ¨å†…éƒ¨ ROM ä¸­ï¼Œå› æ­¤æ— æ³•ä¿®æ”¹æˆ–åˆ†é…ï¼Œå› æ­¤å®ƒæ˜¯è®¾å¤‡çš„å›ºæœ‰éƒ¨åˆ†ã€‚å› æ­¤ï¼Œå®ƒåªèƒ½å®ç°è®©è®¾å¤‡å¼•å¯¼ï¼Œå¹¶éªŒè¯å’ŒåŠ è½½å¼•å¯¼é“¾çš„ä¸‹ä¸€éƒ¨åˆ†çš„æœ€å°è¦æ±‚ã€‚ ç„¶åï¼ŒåŠ è½½ä¸¤ä¸ªæ¬¡è¦å¼•å¯¼ç¨‹åºï¼ŒSBL1ï¼ˆæ¬¡çº§å¼•å¯¼ç¨‹åºï¼‰ï¼Œç„¶åæ˜¯ SBL2ã€‚å®ƒä»¬çš„ä¸»è¦èŒè´£æ˜¯å¯åŠ¨ SoC ä¸Šçš„å„ç§å¤„ç†å™¨å¹¶é…ç½®å®ƒä»¬ï¼Œä½¿å…¶å‡†å¤‡å¥½æ“ä½œã€‚ å¼•å¯¼é“¾çš„ä¸‹ä¸€æ­¥æ˜¯åŠ è½½ç¬¬ä¸‰ä¸ªä¹Ÿæ˜¯æœ€åä¸€ä¸ªæ¬¡çº§å¼•å¯¼ç¨‹åºï¼ŒSBL3ã€‚è¿™ä¸ªå¼•å¯¼ç¨‹åºé™¤äº†å…¶ä»–ä»»åŠ¡å¤–ï¼Œè¿˜éªŒè¯å¹¶åŠ è½½ Android Bootloader-â€œabootâ€ã€‚ ç°åœ¨è¿™å°±æ˜¯æˆ‘ä»¬ä¸è§£é”ç›¸å…³çš„éƒ¨åˆ†äº†ï¼›Android Bootloader æ˜¯è´Ÿè´£åŠ è½½ Android æ“ä½œç³»ç»Ÿå¹¶è§¦å‘å…¶æ‰§è¡Œçš„è½¯ä»¶éƒ¨ä»¶ã€‚ è¿™ä¹Ÿæ˜¯ OEM çš„å¼•å¯¼é“¾éƒ¨åˆ†ï¼Œä¸»è¦æ˜¯å› ä¸ºåœ¨å¼•å¯¼é“¾çš„ç¬¬ä¸€éƒ¨åˆ†ç”± Qualcomm ç¼–å†™å¹¶å¤„ç† SoC ç‰¹å®šå†…å®¹çš„åŒæ—¶ï¼ŒAndroid bootloader å¯ç”¨äºé…ç½®åŠ è½½ Android OS çš„æ–¹å¼ã€‚ ç”± aboot æ§åˆ¶çš„åŠŸèƒ½ä¹‹ä¸€æ˜¯â€œå¼•å¯¼åŠ è½½ç¨‹åºé”å®šâ€-æ¢å¥è¯è¯´ï¼Œaboot æ˜¯å¼•å¯¼é“¾ä¸­ç¬¬ä¸€ä¸ªå¯ä»¥é€‰æ‹©æ‰“ç ´ä¿¡ä»»é“¾ï¼ˆæ¯ä¸ªå¼•å¯¼ç¨‹åºé˜¶æ®µéƒ½éªŒè¯ä¸‹ä¸€ä¸ªï¼‰å¹¶åŠ è½½æœªç­¾åæ“ä½œç³»ç»Ÿçš„éƒ¨ä»¶ã€‚ å¯¹äºå¯è§£é”å¼•å¯¼ç¨‹åºçš„è®¾å¤‡ï¼Œè§£é”è¿‡ç¨‹é€šå¸¸é€šè¿‡å°†è®¾å¤‡é‡æ–°å¯åŠ¨åˆ°ç‰¹æ®Šçš„ï¼ˆâ€œå¼•å¯¼ç¨‹åºâ€ï¼‰æ¨¡å¼ï¼Œå¹¶å‘å‡ºç›¸å…³çš„å¿«é€Ÿå¼•å¯¼å‘½ä»¤æ¥æ‰§è¡Œã€‚ç„¶è€Œï¼Œæ­£å¦‚æˆ‘ä»¬å°†åœ¨åé¢çœ‹åˆ°çš„ï¼Œæ­¤æ¥å£ä¹Ÿç”± aboot å¤„ç†ã€‚è¿™æ„å‘³ç€ aboot ä¸ä»…åœ¨å¸¸è§„å¼•å¯¼è¿‡ç¨‹ä¸­æŸ¥è¯¢é”å®šçŠ¶æ€ï¼Œè€Œä¸”è¿˜æ‹¥æœ‰è´Ÿè´£å®é™…è§£é”è¿‡ç¨‹çš„ä»£ç ã€‚ ä½ å¯èƒ½çŸ¥é“ï¼Œä¸åŒçš„ OEM åœ¨è¿™ä¸ªé—®é¢˜ä¸Šæœ‰ä¸åŒçš„ç«‹åœºã€‚ç®€å•æ¥è¯´ï¼Œâ€œNexusâ€è®¾å¤‡å§‹ç»ˆå¸¦æœ‰â€œå¯è§£é”â€çš„å¼•å¯¼åŠ è½½ç¨‹åºã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œä¸‰æ˜Ÿä¸å…è®¸å¤§å¤šæ•°è®¾å¤‡çš„å¼•å¯¼åŠ è½½ç¨‹åºè§£é”ã€‚å…¶ä»– OEMï¼ŒåŒ…æ‹¬æ‘©æ‰˜ç½—æ‹‰ï¼Œä¼šé”å®šä»–ä»¬çš„è®¾å¤‡ï¼Œä½†æŸäº›è¢«è§†ä¸ºâ€œåˆæ ¼â€çš„è®¾å¤‡å¯ä»¥ä½¿ç”¨ OEM æä¾›çš„â€œé­”æ³•â€ï¼ˆç­¾åï¼‰ä»¤ç‰Œè¿›è¡Œè§£é”ï¼ˆå°½ç®¡è¿™ä¹Ÿä¼šä½¿å¤§å¤šæ•°è®¾å¤‡çš„ä¿ä¿®å¤±æ•ˆï¼‰ã€‚ æ‰€ä»¥â€¦è¿™ä¸€åˆ‡éƒ½éå¸¸å¤æ‚ï¼Œä½†ä¹Ÿä¸é‡è¦ã€‚å› ä¸ºæˆ‘ä»¬å°†æ‰‹åŠ¨å®Œæˆæ•´ä¸ªè¿‡ç¨‹â€”â€”å¦‚æœ aboot å¯ä»¥æ§åˆ¶è®¾å¤‡çš„é”å®šçŠ¶æ€ï¼Œé‚£ä¹ˆè¿™æ„å‘³ç€æˆ‘ä»¬åº”è¯¥ä¹Ÿèƒ½å¤Ÿåœ¨æå‡äº†è¶³å¤Ÿçš„ç‰¹æƒçº§åˆ«åå®Œæˆè§£é”è¿‡ç¨‹ã€‚ ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»å¯¹æ¶‰åŠçš„ç»„ä»¶å’Œç›®æ ‡æœ‰äº†ä¸€ä¸ªæ€»ä½“äº†è§£ï¼Œä¸‹ä¸€æ­¥æ˜¯åˆ†æå®é™…çš„ aboot ä»£ç ã€‚ èµ·ç‚¹ ç”±äºæ‰€æœ‰å¼•å¯¼é“¾å„é˜¶æ®µçš„äºŒè¿›åˆ¶æ–‡ä»¶éƒ½åŒ…å«åœ¨å‡ºå‚å›ºä»¶æ˜ åƒä¸­ï¼Œå› æ­¤è¿™è‡ªç„¶æ˜¯ä¸€ä¸ªå¥½çš„èµ·ç‚¹ã€‚æœ‰å‡ ä¸ªä¸‹è½½é“¾æ¥å¯ç”¨ - è¿™é‡Œæ˜¯ä¸€äº›ã€‚å¦‚æœæ‚¨æƒ³è·Ÿéšæˆ‘è¿›è¡Œæ“ä½œï¼Œæˆ‘å°†å¼•ç”¨ç‰ˆæœ¬â€œATT_XT1097_4.4.4_KXE21.187-38â€ä¸­çš„ç¬¦å·ã€‚ ä¸‹è½½å›ºä»¶æ˜ åƒåï¼Œæˆ‘ä»¬é¢ä¸´ç€ç¬¬ä¸€ä¸ªæŒ‘æˆ˜ - æ‰€æœ‰æ˜ åƒéƒ½ä½¿ç”¨ä¸“æœ‰æ ¼å¼æ‰“åŒ…åœ¨åä¸ºâ€œmotoboot.imgâ€çš„æ–‡ä»¶ä¸­ã€‚ä½†æ˜¯ï¼Œåœ¨åå…­è¿›åˆ¶ç¼–è¾‘å™¨ä¸­æ‰“å¼€æ–‡ä»¶ä¼šæ˜¾ç¤ºå®ƒå…·æœ‰ä¸€ä¸ªæˆ‘ä»¬å¯ä»¥æ¨æ–­å‡ºçš„ç›¸å½“ç®€å•çš„æ ¼å¼ï¼š æ­£å¦‚ä¸Šé¢æ‰€è¿°ï¼Œæ‰€éœ€çš„ aboot æ˜ åƒå­˜å‚¨åœ¨è¯¥æ–‡ä»¶ä¸­ï¼Œè¯¥æ–‡ä»¶è¿˜åŒ…æ‹¬ TrustZone æ˜ åƒå’Œå„ç§å¯åŠ¨é“¾é˜¶æ®µã€‚å¥½çš„ã€‚ ç»è¿‡ä¸Šé¢çš„ç»“æ„åˆ†æï¼Œæˆ‘ç¼–å†™äº†ä¸€ä¸ª Python è„šæœ¬ï¼Œå¯ä»¥ç”¨äºä»ç»™å®šçš„ Motorola å¼•å¯¼åŠ è½½ç¨‹åºæ˜ åƒä¸­è§£å‹ç¼©æ‰€æœ‰æ˜ åƒï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°å®ƒã€‚ æ— å…³ç´§è¦çš„äº‹æƒ… æˆ‘ä»¬å°†ä»æ£€æŸ¥ aboot æ˜ åƒå¼€å§‹ã€‚ä»¤äººæ²®ä¸§çš„æ˜¯ï¼Œå®ƒçš„å¤§å°ä¸º 1MBï¼Œæ‰€ä»¥å®Œå…¨æ£€æŸ¥å®ƒæ˜¯æµªè´¹æ—¶é—´ã€‚ç„¶è€Œï¼Œæ­£å¦‚æˆ‘ä»¬ä¸Šé¢æ‰€æåˆ°çš„ï¼Œå½“å°†è®¾å¤‡å¼•å¯¼åˆ°ç‰¹æ®Šçš„â€œå¼•å¯¼åŠ è½½ç¨‹åºâ€æ¨¡å¼æ—¶ï¼Œå®é™…ä¸ç”¨æˆ·äº¤äº’çš„æ˜¯ aboot æœ¬èº«ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ä»æœç´¢å¼€å§‹æ‰§è¡Œè§£é”è¿‡ç¨‹åæ˜¾ç¤ºçš„å­—ç¬¦ä¸²-å¹¶ä»é‚£é‡Œç»§ç»­ã€‚ çŸ­æš‚åœ°æœç´¢â€œunlockâ€¦â€å­—ç¬¦ä¸²ï¼ˆåœ¨å¯åŠ¨è§£é”è¿‡ç¨‹åæ‰“å°ï¼‰ï¼Œå°†æˆ‘ä»¬ç›´æ¥å¸¦åˆ°å¤„ç†è§£é”é€»è¾‘çš„å‡½æ•°ï¼ˆ@0xFF4B874ï¼‰ï¼š æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œæ‰“å°å®Œå­—ç¬¦ä¸²åˆ°æ§åˆ¶å°ä¹‹åï¼Œè¿ç»­è°ƒç”¨äº†ä¸‰ä¸ªå‡½æ•°ï¼Œå¦‚æœå®ƒä»¬éƒ½æˆåŠŸï¼Œåˆ™è®¤ä¸ºè®¾å¤‡å·²ç»è§£é”ã€‚ ä»”ç»†ç ”ç©¶åä¸¤ä¸ªå‡½æ•°çš„ä½œç”¨ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°å®ƒä»¬çš„ç›®çš„æ˜¯æ“¦é™¤ç”¨æˆ·æ•°æ®åˆ†åŒºï¼ˆåœ¨è§£é”å¼•å¯¼ç¨‹åºåæ€»æ˜¯ä¼šæ‰§è¡Œï¼Œä»¥ä¿æŠ¤è®¾å¤‡æ‰€æœ‰è€…çš„éšç§ï¼‰ã€‚ä¸ç®¡æ€æ ·ï¼Œè¿™æ„å‘³ç€å®ƒä»¬ä¸è§£é”è¿‡ç¨‹æœ¬èº«æ— å…³ï¼Œåªæ˜¯é™„å¸¦æ•ˆæœã€‚ è¿™è®©æˆ‘ä»¬å‰©ä¸‹ä¸€ä¸ªå•ç‹¬çš„å‡½æ•°ï¼Œè°ƒç”¨å®ƒåº”è¯¥å¯ä»¥è§£é”å¼•å¯¼ç¨‹åºã€‚ é‚£ä¹ˆè¿™æ˜¯å¦æ„å‘³ç€æˆ‘ä»¬å·²ç»å®Œæˆäº†ï¼Ÿæˆ‘ä»¬å¯ä»¥ç›´æ¥è°ƒç”¨è¿™ä¸ªå‡½æ•°æ¥è§£é”è®¾å¤‡å—ï¼Ÿ å®é™…ä¸Šï¼Œè¿˜æ²¡æœ‰ã€‚å°½ç®¡ TrustZone æ¼æ´å…è®¸æˆ‘ä»¬åœ¨ TrustZone å†…æ ¸ä¸­å®ç°ä»£ç æ‰§è¡Œï¼Œä½†è¿™åªæ˜¯åœ¨æ“ä½œç³»ç»ŸåŠ è½½åå®Œæˆçš„ï¼Œæ­¤æ—¶ç›´æ¥æ‰§è¡Œå¼•å¯¼ç¨‹åºä»£ç å¯èƒ½ä¼šå¼•èµ·å„ç§å‰¯ä½œç”¨ï¼ˆä¾‹å¦‚ï¼Œä»£ç å¯èƒ½å‡å®šæ²¡æœ‰æ“ä½œç³»ç»Ÿ/ MMU å¯èƒ½è¢«ç¦ç”¨ç­‰ï¼‰ã€‚è€Œä¸”å³ä½¿çœŸçš„å¾ˆç®€å•ï¼Œä¹Ÿå¯èƒ½é€šè¿‡å®Œå…¨ç†è§£é”å®šæœºåˆ¶æœ¬èº«æ¥å­¦ä¹ ä¸€äº›æœ‰è¶£çš„ä¸œè¥¿ã€‚ æ— è®ºå¦‚ä½•ï¼Œå¦‚æœæˆ‘ä»¬å¯ä»¥ç†è§£ä»£ç èƒŒåçš„é€»è¾‘ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°æ¨¡æ‹Ÿå®ƒï¼Œä»æˆ‘ä»¬çš„ TrustZone æ¼æ´ä¸­æ‰§è¡Œå…¶æœ‰æ„ä¹‰çš„éƒ¨åˆ†ã€‚åˆ†æè§£é”å‡½æ•°æ­ç¤ºäº†ä¸€ä¸ªä»¤äººæƒŠè®¶çš„ç®€å•çš„é«˜çº§é€»è¾‘ï¼š å¾ˆé—æ†¾ï¼Œè¿™ä¸¤ä¸ªå‡½æ•°ä¼šåœ¨ IDA ä¸­é€ æˆä¸¥é‡åæœï¼ˆå®ƒç”šè‡³æ— æ³•ä¸ºå®ƒä»¬æ˜¾ç¤ºä¸€ä¸ªæœ‰æ„ä¹‰çš„è°ƒç”¨å›¾ï¼‰ã€‚ æ‰‹åŠ¨åˆ†æè¿™äº›å‡½æ•°å‘ç°å®ƒä»¬å®é™…ä¸Šéå¸¸ç›¸ä¼¼ã€‚å®ƒä»¬éƒ½æ²¡æœ‰å¤ªå¤šçš„é€»è¾‘ï¼Œè€Œæ˜¯å‡†å¤‡å‚æ•°å¹¶è°ƒç”¨ä»¥ä¸‹å‡½æ•°ï¼š è¿™æœ‰ç‚¹ä»¤äººæƒŠè®¶ - è¿™ä¸ªå‡½æ•°å¹¶æ²¡æœ‰å¤„ç†é€»è¾‘æœ¬èº«ï¼Œè€Œæ˜¯é€šè¿‡ SMCï¼ˆSupervisor Mode Callï¼‰æ¥è°ƒç”¨ä¸€ä¸ª TrustZone ç³»ç»Ÿè°ƒç”¨ï¼Œä»è€Œåœ¨ aboot æœ¬èº«ä¸­è°ƒç”¨å®ƒï¼ï¼ˆæ­£å¦‚æˆ‘ä»¬åœ¨å…ˆå‰çš„åšå®¢æ–‡ç« ä¸­è®¨è®ºçš„é‚£æ ·ï¼‰ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿™ä¸¤ä¸ªå‡½æ•°éƒ½ä½¿ç”¨è¯·æ±‚ä»£ç  0x3F801 å‘å‡º SMCã€‚ä»¥ä¸‹æ˜¯æ¯ä¸ªå‡½æ•°çš„ç›¸å…³ä¼ªä»£ç ï¼š å¾ˆå¥½ï¼Œæˆ‘ä»¬ç°åœ¨å·²ç»ä» aboot ä¸­è·å–äº†æ‰€æœ‰éœ€è¦çš„ä¿¡æ¯ï¼Œç°åœ¨è®©æˆ‘ä»¬åˆ‡æ¢åˆ° TrustZone å†…æ ¸ï¼Œæ‰¾å‡ºè¿™ä¸ª SMC è°ƒç”¨çš„ä½œç”¨ã€‚ è¯·è¿› TrustZone ç°åœ¨æˆ‘ä»¬å·²ç»ç¡®è®¤äº†ä½¿ç”¨å‘½ä»¤ä»£ç  0x3F801 å‘å‡º SMC è°ƒç”¨ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°è¿™ä¸ªå‘½ä»¤åœ¨ TrustZone å†…æ ¸ä¸­çš„ä½ç½®ã€‚ æµè§ˆTrustZoneå†…æ ¸ç³»ç»Ÿè°ƒç”¨æ—¶ï¼Œæˆ‘ä»¬æ‰¾åˆ°äº†ä»¥ä¸‹å…¥å£ï¼š è¿™æ˜¯ä¸€ä¸ªéå¸¸åºå¤§çš„å‡½æ•°ï¼Œæ ¹æ®æä¾›çš„ç¬¬ä¸€ä¸ªå‚æ•°æ‰§è¡Œå„ç§ä¸åŒçš„ä»»åŠ¡ï¼Œæˆ‘ä»¬ä»ç°åœ¨å¼€å§‹å°†å…¶ç§°ä¸ºâ€œå‘½ä»¤ä»£ç â€ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿˜ä¼ é€’äº†ä¸€ä¸ªé™„åŠ æ ‡å¿—åˆ°è¿™ä¸ªç³»ç»Ÿè°ƒç”¨ä¸­ï¼Œç”¨äºæŒ‡ç¤ºå®ƒæ˜¯å¦ä»â€œå®‰å…¨â€ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ã€‚è¿™æ„å‘³ç€å¦‚æœæˆ‘ä»¬å°è¯•ä» Android OS æœ¬èº«è°ƒç”¨å®ƒï¼Œå°†ä¼ é€’ä¸€ä¸ªæ ‡è®°æ¥æ ‡è®°æˆ‘ä»¬çš„è°ƒç”¨æ˜¯ä¸å®‰å…¨çš„ï¼Œå¹¶ä¸”å°†é˜»æ­¢æˆ‘ä»¬è‡ªå·±æ‰§è¡Œè¿™äº›æ“ä½œã€‚å½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æˆ‘ä»¬çš„ TrustZone æ¼æ´ç»•è¿‡æ­¤é™åˆ¶ï¼Œä½†æˆ‘ä»¬ç¨åå†è¯¦ç»†è¯´æ˜ï¼ å¦‚ä¸Šæ‰€è¿°ï¼Œä½¿ç”¨å‘½ä»¤ä»£ç ï¼ƒ1å’Œï¼ƒ2è§¦å‘äº†è¿™ä¸¤æ¬¡ SMC è°ƒç”¨ï¼ˆæˆ‘å·²ç»æ³¨é‡Šäº†ä¸‹é¢çš„å‡½æ•°ä»¥æé«˜å¯è¯»æ€§ï¼‰ï¼š ç®€å•æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¸¤ä¸ªå‘½ä»¤éƒ½ç”¨äºè¯»å–å’Œå†™å…¥ï¼ˆåˆ†åˆ«ï¼‰æ¥è‡ªç§°ä¸ºâ€œQFuseâ€çš„å†…å®¹ã€‚ QFuses å°±åƒç°å®ä¸­çš„ä¿é™©ä¸ä¸€æ ·ï¼ŒQFuse æ˜¯ä¸€ç§ç¡¬ä»¶ç»„ä»¶ï¼Œç”¨äºå®ç°â€œä¸€æ¬¡å¯å†™â€çš„å†…å­˜ã€‚æ¯ä¸ªä¿é™©ä¸è¡¨ç¤ºä¸€ä¸ªä½ï¼›æœªå—æŸçš„ä¿é™©ä¸è¡¨ç¤ºä½é›¶ï¼Œâ€œçƒ§æ–­â€çš„ä¿é™©ä¸è¡¨ç¤ºä½ä¸€ã€‚ä½†æ˜¯ï¼Œæ­£å¦‚å…¶åç§°æ‰€ç¤ºï¼Œæ­¤æ“ä½œæ˜¯ä¸å¯é€†çš„ - ä¸€æ—¦ä¿é™©ä¸è¢«â€œçƒ§æ–­â€ï¼Œå®ƒå°±æ— æ³•â€œæœªçƒ§æ–­â€ã€‚ æ¯ä¸ª SoC éƒ½æœ‰è‡ªå·±çš„ QFuse å¸ƒç½®ï¼Œæ¯ä¸ªéƒ½å…·æœ‰è‡ªå·±ç‹¬ç‰¹çš„ç›®çš„ã€‚æŸäº›ä¿é™©ä¸åœ¨è®¾å¤‡å‡ºè´§æ—¶å·²ç»çƒ§æ–­ï¼Œä½†å…¶ä»–ä¿é™©ä¸å¯èƒ½ä¼šæ ¹æ®ç”¨æˆ·çš„æ“ä½œè€Œè¢«çƒ§æ–­ï¼Œä»¥æ›´æ”¹ç‰¹å®šè®¾å¤‡åŠŸèƒ½çš„æ–¹å¼ã€‚ ä¸å¹¸çš„æ˜¯ï¼Œå…³äºæ¯ä¸ªä¿é™©ä¸çš„ä½œç”¨çš„ä¿¡æ¯ä¸æ˜¯å…¬å¼€çš„ï¼Œå› æ­¤æˆ‘ä»¬åªèƒ½åå‘åˆ†æå„ç§è½¯ä»¶ç»„ä»¶ï¼Œä»¥å°è¯•æ¨æ–­å®ƒä»¬çš„ä½œç”¨ã€‚ åœ¨æˆ‘ä»¬çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è°ƒç”¨ç‰¹å®šçš„å‡½æ•°æ¥å†³å®šè¦è¯»å–å’Œå†™å…¥çš„ä¿é™©ä¸ï¼š æ—¢ç„¶æˆ‘ä»¬ä½¿ç”¨ç¬¬äºŒä¸ªç³»ç»Ÿè°ƒç”¨å‚æ•°ï¼ˆåœ¨æˆ‘ä»¬çš„æƒ…å†µä¸‹ä¸ºâ€œ4â€ï¼‰æ¥è°ƒç”¨æ­¤å‡½æ•°ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å°†æ“ä½œåœ°å€ä¸º 0xFC4B86E8 çš„ QFuseã€‚ æŠŠæ‰€æœ‰çš„ä¸œè¥¿æ”¾åœ¨ä¸€èµ· ç°åœ¨æˆ‘ä»¬äº†è§£äº† aboot å’Œ TrustZone é€»è¾‘ï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒä»¬ç»“åˆèµ·æ¥å¾—åˆ°å®Œæ•´çš„æµç¨‹ï¼š é¦–å…ˆï¼Œaboot è°ƒç”¨ SMC 0x3F801ï¼Œå¹¶ä½¿ç”¨å‘½ä»¤ç ï¼ƒ1ï¼Œè¿™ä¼šå¯¼è‡´ TrustZone å†…æ ¸è¯»å–å¹¶è¿”å›åœ°å€ 0xFC4B86E8 å¤„çš„ QFuseã€‚ ç„¶åï¼Œä»…å½“ QFuse ä¸­çš„ç¬¬ä¸€ä¸ªä½è¢«ç¦ç”¨æ—¶ï¼Œaboot å†æ¬¡è°ƒç”¨ SMC 0x3F801ï¼Œè¿™æ¬¡ä½¿ç”¨å‘½ä»¤ç ï¼ƒ2ï¼Œè¿™ä¼šå¯¼è‡´ TrustZone å†…æ ¸å°†å€¼ 1 å†™å…¥ä¸Šè¿° QFuse çš„ LSBã€‚ ç»“æœè¯æ˜ï¼Œä¸€åˆ‡éƒ½å¾ˆç®€å• - æˆ‘ä»¬åªéœ€è¦è®¾ç½®å•ä¸ª QFuse ä¸­çš„ä¸€ä¸ªä½ï¼Œå¼•å¯¼åŠ è½½ç¨‹åºå°±ä¼šè¢«è§†ä¸ºè§£é”ã€‚ ä½†æ˜¯å¦‚ä½•ç¼–å†™ QFusesï¼Ÿ DIY QFuses å¹¸è¿çš„æ˜¯ï¼ŒTrustZone å†…æ ¸æš´éœ²äº†ä¸€å¯¹ç³»ç»Ÿè°ƒç”¨ï¼Œå…è®¸æˆ‘ä»¬è¯»å–å’Œå†™å…¥å—é™åˆ¶çš„ä¸€ç»„ QFuse - åˆ†åˆ«ä¸º tzbsp_qfprom_read_row å’Œ tzbsp_qfprom_write_rowã€‚å¦‚æœæˆ‘ä»¬å¯ä»¥åˆ©ç”¨æˆ‘ä»¬çš„ TrustZone æ¼æ´è§£é™¤è¿™äº›é™åˆ¶ï¼Œæˆ‘ä»¬åº”è¯¥èƒ½å¤Ÿä½¿ç”¨æ­¤ API æ¥åˆ›é€ æƒ³è¦çš„ QFuseã€‚ è®©æˆ‘ä»¬çœ‹çœ‹ tzbsp_qfprom_write_row ç³»ç»Ÿè°ƒç”¨ä¸­çš„è¿™äº›é™åˆ¶ï¼š å› æ­¤ï¼Œé¦–å…ˆå¿…é¡»å°†åœ°å€ 0xFE823D5C å¤„çš„ DWORD è®¾ç½®ä¸º 0ï¼Œæ‰èƒ½ç»§ç»­æ‰§è¡Œå‡½æ•°çš„é€»è¾‘ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæ­¤æ ‡å¿—å®é™…ä¸Šè®¾ç½®ä¸º 1ï¼Œä»è€Œé˜²æ­¢ä½¿ç”¨ QFuse è°ƒç”¨ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ TrustZone æ¼æ´è½»æ¾åœ°è¦†ç›–è¯¥æ ‡å¿—ã€‚ ç„¶åï¼Œè¿˜æœ‰ä¸€ä¸ªé™„åŠ å‡½æ•°è¢«è°ƒç”¨ï¼Œç”¨äºç¡®ä¿è¢«å†™å…¥çš„ä¿é™©ä¸èŒƒå›´æ˜¯â€œå…è®¸â€çš„ï¼š æ­£å¦‚æˆ‘ä»¬æ‰€çœ‹åˆ°çš„ï¼Œè¿™ä¸ªå‡½æ•°éå†äº†ä¸€ä¸ªé™æ€åˆ—è¡¨ï¼Œå…¶ä¸­æ¯ä¸ªå…ƒç´ éƒ½è¡¨ç¤ºå…è®¸çš„ QFuse çš„èµ·å§‹åœ°å€å’Œç»“æŸåœ°å€ã€‚è¿™æ„å‘³ç€ä¸ºäº†é€šè¿‡è¿™ä¸ªæ£€æŸ¥ï¼Œæˆ‘ä»¬å¯ä»¥è¦†ç›–è¿™ä¸ªé™æ€åˆ—è¡¨ï¼Œå°†æ‰€æœ‰ QFuse åŒ…æ‹¬è¿›å»ï¼ˆå°†èµ·å§‹åœ°å€è®¾ç½®ä¸ºé›¶ï¼Œå°†ç»“æŸåœ°å€è®¾ç½®ä¸ºæœ€å¤§çš„ QFuse ç›¸å¯¹åœ°å€ - 0xFFFFï¼‰ã€‚ å°è¯•ä¸€ä¸‹ æ—¢ç„¶æˆ‘ä»¬å·²ç»å¼„æ¸…æ¥šäº†ä¸€åˆ‡ï¼Œç°åœ¨æ˜¯æ—¶å€™è‡ªå·±è¯•è¯•äº†ï¼æˆ‘å†™äº†ä¸€äº›ä»£ç ï¼Œå®ç°äº†ä»¥ä¸‹åŠŸèƒ½ï¼š åœ¨ TrustZone ä¸­å®ç°ä»£ç æ‰§è¡Œ ç¦ç”¨ QFuse ä¿æŠ¤ åœ¨ QFuse 0xFC4B86E8 ä¸­å†™å…¥ LSB QFuse åœ¨è¿™é‡ŒæŸ¥çœ‹ä»£ç ï¼šhttps://github.com/laginimaineb/Alohamora æœ€åæƒ³æ³• åœ¨æœ¬åšå®¢æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†ç”±å•ä¸ª QFuse æ§åˆ¶çš„æµç¨‹ã€‚ä½†æ˜¯ï¼Œæ‚¨å¯èƒ½å¯ä»¥çŒœåˆ°ï¼Œè¿˜æœ‰è®¸å¤šä¸åŒçš„æœ‰è¶£ QFuse æ­£åœ¨ç­‰å¾…è¢«å‘ç°ã€‚ ä¸€æ–¹é¢ï¼Œçƒ§æ–­ä¿é™©ä¸ç¡®å®å¾ˆâ€œå±é™©â€ - ä¸€æ—¦å‡ºç°å°é”™è¯¯ï¼Œå°±ä¼šæ°¸ä¹…ç –åŒ–è®¾å¤‡ã€‚å¦ä¸€æ–¹é¢ï¼Œä¸€äº›ä¿é™©ä¸å¯èƒ½ä¼šä¿ƒè¿›ä¸€ç»„ç‰¹æ®ŠåŠŸèƒ½ï¼Œæˆ‘ä»¬å¸Œæœ›å¯ç”¨è¿™äº›åŠŸèƒ½ã€‚ ä¸€ä¸ªè¿™æ ·çš„ä¾‹å­æ˜¯â€œå·¥ç¨‹â€ä¿é™©ä¸ï¼›æ­¤ä¿é™©ä¸åœ¨æ•´ä¸ª aboot æ˜ åƒä¸­éƒ½æœ‰æåˆ°ï¼Œå¯ä»¥ç”¨äºå¯ç”¨ä»¤äººæƒŠå¹çš„åŠŸèƒ½ï¼Œä¾‹å¦‚è·³è¿‡å®‰å…¨å¯åŠ¨ã€åŠ è½½æœªç­¾åçš„å¤–å›´æ˜ åƒã€æ‹¥æœ‰æœªç­¾åçš„ GPT ç­‰ç­‰ã€‚ ç„¶è€Œï¼Œæ­¤ä¿é™©ä¸åœ¨æ‰€æœ‰æ¶ˆè´¹è®¾å¤‡ä¸Šéƒ½å·²ç»çƒ§æ–­ï¼Œæ ‡è®°è®¾å¤‡ä¸ºâ€œéå·¥ç¨‹å¸ˆâ€è®¾å¤‡ï¼Œå¹¶ç¦ç”¨è¿™äº›åŠŸèƒ½ã€‚ä½†æ˜¯è°çŸ¥é“ï¼Œä¹Ÿè®¸è¿˜æœ‰å…¶ä»–åŒæ ·é‡è¦çš„ä¿é™©ä¸å°šæœªè¢«å‘ç°â€¦","categories":[{"name":"Linux","slug":"Linux","permalink":"https://blog.inoki.cc/categories/Linux/"},{"name":"Android","slug":"Linux/Android","permalink":"https://blog.inoki.cc/categories/Linux/Android/"},{"name":"Bootloader","slug":"Linux/Android/Bootloader","permalink":"https://blog.inoki.cc/categories/Linux/Android/Bootloader/"}],"tags":[{"name":"ä¸­æ–‡","slug":"ä¸­æ–‡","permalink":"https://blog.inoki.cc/tags/ä¸­æ–‡/"},{"name":"Linux","slug":"Linux","permalink":"https://blog.inoki.cc/tags/Linux/"},{"name":"Android","slug":"Android","permalink":"https://blog.inoki.cc/tags/Android/"},{"name":"ABL","slug":"ABL","permalink":"https://blog.inoki.cc/tags/ABL/"},{"name":"Bootloader","slug":"Bootloader","permalink":"https://blog.inoki.cc/tags/Bootloader/"}]},{"title":"Android Bootloader and Linux Internal based on Nokia 8(NB1) â€”â€” Device Tree","slug":"android-bootloader-linux-nokia-nb1-dt","date":"2022-05-09T20:48:00.000Z","updated":"2025-03-08T09:40:48.608Z","comments":true,"path":"2022/05/09/android-bootloader-linux-nokia-nb1-dt/","link":"","permalink":"https://blog.inoki.cc/2022/05/09/android-bootloader-linux-nokia-nb1-dt/","excerpt":"","text":"Context: I am working on porting Plasma Mobile and EDK II to my Nokia 8 (codename: NB1) device. There are many things to do and to learn. In this post, I want to write down what I have learnt from the ABL Bootloader and the Linux kernel, about how the Device Tree(DT, which describes the periphicals in an embedded device) is processed by the ABL and the kernel. Introduction The Nokia 8 device(and its successor Nokia 8 Sirocco) uses the MSM8998 SoC platform(or say Qualcomm 835) as a base. In fact, its company HMD just owns the Nokia trademark for mobile phone manufacture. The main design and development is by FIH Mobile, which is a subsidiary of Foxconn. So, we will say some modules named by the FIH in this post. The model that I own is marked as â€œQualcomm Technologies, Inc. MSM8998 v2.1 MTP, FIH NB1 PVT1 SSâ€ in the DT. However, there are many DTs that are appended to the kernel, where it also has the ones for A1N(Nokia 8 Sirocco) and the evaluation version of these devices. These result in more than 80 different DTs, even including the different versions of MSM8998. So, I wonder how the DT is actually choosed, by the Linux kernel, or by the Bootloader. And in which stage, during the early stage, the XBL or the ABL? At very first, I thought that the DTs are appended to the kernel, so that the Bootloader(s) will not get involved very deeply. The best DT might be found and choosed by the kernel. However, I found that it is the ABL which is in charge of choosing, fixing and patching the DT after studying. Although the device is kind of outdated, this page talking about â€œUsing Mutiple DTsâ€ from Android documentation might be still helpful for someone. DT loading in ABL Bootloader In my previous posts such as Android bootloader analysis â€“ ABL(1), I analyse the Bootloader in a coarse-grained manner. As mentioned in Android bootloader analysis â€“ Aboot, ABL is actually an EFI application that loaded by the XBL. The application is a module named after LinuxLoader, which is in charge of loading Linux kernel and the related entities in an ABoot(Android Boot) image. DT in LinuxLoader EFI application As mentioned in Android bootloader analysis â€“ ABL(1), the EFI application entry is declared in QcomModulePkg/Application/ LinuxLoader/LinuxLoader.inf, as LinuxLoaderEntry. The application can either boot into Android fastboot mode, or boot into Linux kernel(normal boot or recovery). Normally, the ABL loads the image in the boot partition, in which the ANDROIDBOOT format image is used. The image usually contains a kernel and a ramdisk for basic initialization. Depending on the devices, the DTs can be appended to the kernel or stored in a standalone partition: My Nokia 8 uses the first solution. And there are many DTs. So, before booting, the Bootloader needs to purge them. If the image is validated, BootLinux (&amp;Info) is called to actually try to process the image so as to boot it. In that function, DTBImgCheckAndAppendDT is called to choose the best DT and append it to the kernel. To do this, DeviceTreeAppended in QcomModulePkg/Library/BootLib/LocateDeviceTree.c is called. It checks all the possible DTs from the begin address of the appended DT, to the kernel end. For each DT, the DeviceTreeCompatible is called to find the best DT. The standard matching process contains the retrievals of qcom,msm-id, qcom,board-id and qcom,pmic-id properties in the DT. There is a special structure to describe such information from the hardware: 12345678910111213typedef struct DtInfo &#123; UINT32 DtPlatformId; UINT32 DtSocRev; UINT32 DtFoundryId; UINT32 DtVariantId; UINT32 DtVariantMajor; UINT32 DtVariantMinor; UINT32 DtPlatformSubtype; UINT32 DtPmicModel[MAX_PMIC_IDX]; UINT32 DtPmicRev[MAX_PMIC_IDX]; UINT64 DtMatchVal; VOID *Dtb;&#125; DtInfo; The matching process is as follows: 12345678910111213141516171819202122232425if (CurDtbInfo-&gt;DtMatchVal &amp; BIT (ExactMatch)) &#123; if (BestDtbInfo-&gt;DtMatchVal &lt; CurDtbInfo-&gt;DtMatchVal) &#123; gBS-&gt;CopyMem (BestDtbInfo, CurDtbInfo, sizeof (struct DtInfo)); FindBestMatch = TRUE; &#125; else if (BestDtbInfo-&gt;DtMatchVal == CurDtbInfo-&gt;DtMatchVal) &#123; FindBestMatch = TRUE; if (BestDtbInfo-&gt;DtSocRev &lt; CurDtbInfo-&gt;DtSocRev) &#123; gBS-&gt;CopyMem (BestDtbInfo, CurDtbInfo, sizeof (struct DtInfo)); &#125; else if (BestDtbInfo-&gt;DtVariantMajor &lt; CurDtbInfo-&gt;DtVariantMajor) &#123; gBS-&gt;CopyMem (BestDtbInfo, CurDtbInfo, sizeof (struct DtInfo)); &#125; else if (BestDtbInfo-&gt;DtVariantMinor &lt; CurDtbInfo-&gt;DtVariantMinor) &#123; gBS-&gt;CopyMem (BestDtbInfo, CurDtbInfo, sizeof (struct DtInfo)); &#125; else if (BestDtbInfo-&gt;DtPmicRev[0] &lt; CurDtbInfo-&gt;DtPmicRev[0]) &#123; gBS-&gt;CopyMem (BestDtbInfo, CurDtbInfo, sizeof (struct DtInfo)); &#125; else if (BestDtbInfo-&gt;DtPmicRev[1] &lt; CurDtbInfo-&gt;DtPmicRev[1]) &#123; gBS-&gt;CopyMem (BestDtbInfo, CurDtbInfo, sizeof (struct DtInfo)); &#125; else if (BestDtbInfo-&gt;DtPmicRev[2] &lt; CurDtbInfo-&gt;DtPmicRev[2]) &#123; gBS-&gt;CopyMem (BestDtbInfo, CurDtbInfo, sizeof (struct DtInfo)); &#125; else if (BestDtbInfo-&gt;DtPmicRev[3] &lt; CurDtbInfo-&gt;DtPmicRev[3]) &#123; gBS-&gt;CopyMem (BestDtbInfo, CurDtbInfo, sizeof (struct DtInfo)); &#125; else &#123; FindBestMatch = FALSE; &#125; &#125;&#125; However, for different models of Nokia 8, they do share the same msm information because they are using the same platform and the same board, which are: 12compatible = &quot;qcom,msm8998-mtp&quot;, &quot;qcom,msm8998&quot;, &quot;qcom,mtp&quot;;qcom,board-id = &lt;8 0&gt;, &lt;1 0&gt;; I found, by mysterious way, that my phone uses a special fih,hw-id field to find the correct DT. I will discuss this later. Finally, a pointer named tags is returned and be passed as the actual DT to the kernel. FIH modules As aforementioned, there is a special fih,hw-id field in addition to qcom,board-id and compatible fields to match the DT in the ABL Bootloader. Such id is stored in a special memory area, which is also declared as reseved memory in the DT: 12345fih_mem: fih_region@a0000000 &#123; /* for FIH feature */ compatible = &quot;removed-dma-pool&quot;; no-map; reg = &lt;0 0xa0000000 0 0xb00000&gt;;&#125;; We can see that the memory region starts at 0xa0000000 and has a size of 0xb00000. The detailed information is not accessible here because the XBL seems not to be open-sourced. However, when I unpacked the XBL from the factory image, I saw there are FIHDxe EFI driver and FIHHWIDApp to load the hardware id into the EFI environment. So that, the LinuxLoader EFI application can eventually read the information and match the DT. I cannot provide more details because the reverse-engineering is performed. But the address to store the hardware id is 0x000160f1 in the EFI environment under my 5150 image. It is written by the FIHHWIDApp using the methods provided by the FIHDxe. Anyway, the DT choosed by my device is with: 1234model = &quot;Qualcomm Technologies, Inc. MSM8998 v2.1 MTP, FIH NB1 PVT1 SS&quot;;compatible = &quot;qcom,msm8998-mtp&quot;, &quot;qcom,msm8998&quot;, &quot;qcom,mtp&quot;;qcom,board-id = &lt;8 0&gt;, &lt;1 0&gt;;fih,hw-id = &lt;1 7 4&gt;; in which I guess that it is a Product version 1, with Single Slot. This DT is finally the only DT passed to the Linux kernel. DT processing in Linux kernel In ARM64, when kernel is loaded and executed, the address pointing to DT is passed in X5 register. The first executable code is from arch/arm64/kernel/head.S, where we can see the device hardware initialization and the Flatten DT(FDT) pointer is saved from X5 register to __fdt_pointer: 1str_l x21, __fdt_pointer, x5 // Save FDT pointer It is a physical address in arch/arm64/kernel/setup.c: 1phys_addr_t __fdt_pointer __initdata; where __initdata indicates that it should be stored in a special section for data used during initialization. The head.S does not do many things and then just passes the control(without return) to start_kernel function. This function is usually generic for all platforms, which performs Linux initialization step-by-step. The DT-related function calls are as follows: 123setup_arch(&amp;command_line);rest_init(); where setup_arch is definitly platform-related and architecture-related. And after all initializations are finished, the rest part (non-essential) of the kernel needs to be initialized. DT in architecture-related setup Each platform/architecture has its own setup function. The one for ARM64 is arch/arm64/kernel/setup.c. It first print the CPU information(the information is visualized in dmesg) and establish the mappings of virtual addresses: 123pr_info(\"Boot CPU: AArch64 Processor [%08x]\\n\", read_cpuid_id());early_fixmap_init();early_ioremap_init(); Then the boot-related functions are: 12345678910111213setup_machine_fdt(__fdt_pointer);// ...efi_init();// .../* Parse the ACPI tables for possible boot-time configuration */acpi_boot_table_init();// ...if (acpi_disabled) &#123; unflatten_device_tree(); psci_dt_init();&#125; else &#123; psci_acpi_init();&#125; Note that both the DT and the EFI-ACPI boot modes are supported. In our case, we only consider the DT mode. So, the topic remains on setup_machine_fdt, and the unflatten_device_tree, psci_dt_init when acpi_disabled is true. ARM64 Machine FDT setuping The setup_machine_fdt accepts a DT pointer. Note that now the DT has been chosen by the ABL, so we are safe to load and verify the only DT. 123456789101112131415161718192021static void __init setup_machine_fdt(phys_addr_t dt_phys)&#123; void *dt_virt = fixmap_remap_fdt(dt_phys); if (!dt_virt || !early_init_dt_scan(dt_virt)) &#123; pr_crit(\"\\n\" \"Error: invalid device tree blob at physical address %pa (virtual address 0x%p)\\n\" \"The dtb must be 8-byte aligned and must not exceed 2 MB in size\\n\" \"\\nPlease check your bootloader.\", &amp;dt_phys, dt_virt); while (true) cpu_relax(); &#125; machine_name = of_flat_dt_get_machine_name(); if (machine_name) &#123; dump_stack_set_arch_desc(\"%s (DT)\", machine_name); pr_info(\"Machine: %s\\n\", machine_name); &#125;&#125; It first get the virtual address of FDT from the physical address using the memory mapping. Then, perform a basic scan to validate the DT(early_init_dt_scan in drivers/of/fdt.c). At the end, the machine name is gotten and printed, which can also be seen in dmesg. FDT processing Then, the FDT is parsed in unflatten_device_tree() to construct a tree of device_nodes, which can be used to probe the peripherals. The first use is to discover the Power State Coordination Interface(PSCI) in psci_dt_init(). The interface should be compatible with one of the following values: 123&#123; .compatible = &quot;arm,psci&quot;, .data = psci_0_1_init&#125;,&#123; .compatible = &quot;arm,psci-0.2&quot;, .data = psci_0_2_init&#125;,&#123; .compatible = &quot;arm,psci-1.0&quot;, .data = psci_0_2_init&#125; Kernel can use the similar way to discover other devices. DT processing in sysfs In an ARM Linux with sysfs, we can usually see the devicetree node and the fdt node under /sysfs/firmware directory. These nodes are actually the visualization of the corresponding kernel objects. The Linux kernel just adds them into the kernel object sets. Such function is implemented in rest_init. The kernel runs a kernel thread to start the non-critical initilization part of the kernel: 1kernel_thread(kernel_init, NULL, CLONE_FS); The kernel_init executes kernel_init_freeable and then run the init command. The command can be passed from the kernel commanline in ramdisk_execute_command or execute_command. Otherwise, the kernel will try /sbin/init, /etc/init, /bin/init and /bin/sh. If this still fails, the kernel is in panic. In kernel_init_freeable, the kernel still calls many function. The do_basic_setup and then driver_init are associated to the DT processing in sysfs. The driver_init calls several functions to initialize the different parts as follows: 12345678910111213141516/* These are the core pieces */devtmpfs_init();devices_init();buses_init();classes_init();firmware_init();hypervisor_init();/* These are also core pieces, but must come after the * core core pieces. */platform_bus_init();cpu_dev_init();memory_dev_init();container_dev_init();of_core_init(); In firmware_init, the firmware_kobj is created to host the firmware-related kernel objects: 1234567int __init firmware_init(void)&#123; firmware_kobj = kobject_create_and_add(\"firmware\", NULL); if (!firmware_kobj) return -ENOMEM; return 0;&#125; At the end, of_core_init creates /sys/firmware/devicetree and the nodes under the tree: 1234567891011121314151617181920void __init of_core_init(void)&#123; struct device_node *np; /* Create the kset, and register existing nodes */ mutex_lock(&amp;of_mutex); of_kset = kset_create_and_add(\"devicetree\", NULL, firmware_kobj); if (!of_kset) &#123; mutex_unlock(&amp;of_mutex); pr_err(\"devicetree: failed to register existing nodes\\n\"); return; &#125; for_each_of_allnodes(np) __of_attach_node_sysfs(np); mutex_unlock(&amp;of_mutex); /* Symlink in /proc as required by userspace ABI */ if (of_root) proc_symlink(\"device-tree\", NULL, \"/sys/firmware/devicetree/base\");&#125; In addtion, late_initcall(of_fdt_raw_init) in driver/of/fdt.c can create the /sys/firmware/fdt to host the FDT binary contents: 12345678910111213141516static int __init of_fdt_raw_init(void)&#123; static struct bin_attribute of_fdt_raw_attr = __BIN_ATTR(fdt, S_IRUSR, of_fdt_raw_read, NULL, 0); if (!initial_boot_params) return 0; if (of_fdt_crc32 != crc32_be(~0, initial_boot_params, fdt_totalsize(initial_boot_params))) &#123; pr_warn(\"fdt: not creating '/sys/firmware/fdt': CRC check failed\\n\"); return 0; &#125; of_fdt_raw_attr.size = fdt_totalsize(initial_boot_params); return sysfs_create_bin_file(firmware_kobj, &amp;of_fdt_raw_attr);&#125; If we search the firmware_kobj, there are also many other firmware types that can be initialized, such as: EFI kobject_create_and_add(&quot;efi&quot;, firmware_kobj); under drivers/firmware/efi/efi.c ACPI kobject_create_and_add(&quot;efi&quot;, firmware_kobj); under drivers/acpi/bus.c DMI kobject_create_and_add(&quot;dmi&quot;, firmware_kobj); under drivers/firmware/dmi_scan.c which are common for EFI system. For those who are intrested in EFI and ACPI, there are some function calls during kernel init: 123456789acpi_early_init();/* ... */acpi_subsystem_init();sfi_init_late();if (efi_enabled(EFI_RUNTIME_SERVICES)) &#123; efi_late_init(); efi_free_boot_services();&#125; FIH modules Some nodes in the DT are really device-wise and their drivers are not mainlined. The customized kernel provides a driver module to bring up the devices and read the related information. As mentioned before, there is also a similar close-sourced module in XBL. Here we can see the related information. The hardware id can be read by the following structure, from the reserved memory region at 0xA0A80000 12345678910111213141516struct st_hwid_table &#123; /* mpp */ unsigned int r1; /* pin: PROJECT-ID */ char r2; /* pin: HW_REV-ID */ char r3; /* pin: RF_BAND-ID */ /* info */ char prj; /* project */ char rev; /* hw_rev */ char rf; /* rf_band */ /* device tree */ char dtm; /* Major number */ char dtn; /* minor Number */ /* driver */ char btn; /* button */ char uart;&#125;; Such information is read and explosed to a file under procfs(/proc directory), which can be directly read by the userspace program: 12345678910111213141516171819202122232425262728293031323334353637static int __init fih_info_init(void)&#123; if (proc_create(\"devmodel\", 0, NULL, &amp;project_file_ops) == NULL) &#123; pr_err(\"fail to create proc/devmodel\\n\"); &#125; if (proc_create(\"baseband\", 0, NULL, &amp;hw_rev_file_ops) == NULL) &#123; pr_err(\"fail to create proc/baseband\\n\"); &#125; if (proc_create(\"bandinfo\", 0, NULL, &amp;rf_band_file_ops) == NULL) &#123; pr_err(\"fail to create proc/bandinfo\\n\"); &#125; if (proc_create(\"hwmodel\", 0, NULL, &amp;hwmodel_file_ops) == NULL) &#123; pr_err(\"fail to create proc/hwmodel\\n\"); &#125; if (proc_create(\"hwcfg\", 0, NULL, &amp;hwcfg_file_ops) == NULL) &#123; pr_err(\"fail to create proc/hwcfg\\n\"); &#125; if (proc_create(\"SIMSlot\", 0, NULL, &amp;simslot_file_ops) == NULL) &#123; pr_err(\"fail to create proc/SIMSlot\\n\"); &#125; if (proc_create(\"MODULE\", 0, NULL, &amp;module_file_ops) == NULL) &#123; pr_err(\"fail to create proc/MODULE\\n\"); &#125; if (proc_create(\"fqc_xml\", 0, NULL, &amp;fqc_xml_file_ops) == NULL) &#123; pr_err(\"fail to create proc/fqc_xml\\n\"); &#125; return (0);&#125; There are also information of cpu, dram, battery, gpio, touch, etc. Here we can see the related information. 12345678910111213141516171819202122232425262728293031323334353637383940414243444546/************************************************************** * START | SIZE | TARGET * -------------------------------------------------------- 0MB * 0xA000_0000 | 0x0020_0000 | modem rf_nv (2MB) * 0xA020_0000 | 0x0020_0000 | modem cust_nv (2MB) * 0xA040_0000 | 0x0040_0000 | modem default_nv (2MB) * 0xA080_0000 | 0x0010_0000 | modem log (1MB) * -------------------------------------------------------- 7MB * 0xA090_0000 | 0x0004_0000 | last_alog_main (256KB) * 0xA094_0000 | 0x0004_0000 | last_alog_events (256KB) * 0xA098_0000 | 0x0004_0000 | last_alog_radio (256KB) * 0xA09C_0000 | 0x0004_0000 | last_alog_system (256KB) * 0xA0A0_0000 | 0x0004_0000 | last_kmsg (256KB) * 0xA0A4_0000 | 0x0002_0000 | last_blog (128KB) * 0xA0A6_0000 | 0x0002_0000 | blog (128KB) * -------------------------------------------------------- 8.5MB * 0xA0A8_0000 | 0x0000_0040 | hwid:hwcfg (64B) * 0xA0A8_0040 | 0x0000_0040 | secboot:devinfo (64B) * 0xA0A8_0080 | 0x0000_0100 | secboot:unlock (256B) * 0xA0A8_0180 | 0x0000_0080 | sutinfo (128B) * 0xA0A8_0200 | 0x0000_0010 | no use 1 (16B) * 0xA0A8_0210 | 0x0000_0010 | bset (16B) * 0xA0A8_0220 | 0x0000_0010 | bat-id adc (16B) * 0xA0A8_0230 | 0x0000_0010 | no use 2 (16B) * 0xA0A8_0240 | 0x0000_0020 | apr (32B) * 0xA0A8_0260 | 0x0000_0180 | no use 3 (384B) * 0xA0A8_03E0 | 0x0000_0020 | mem (32B) * 0xA0A8_0400 | 0x0000_0C00 | no use 4 (3KB) * 0xA0A8_1000 | 0x0000_1000 | e2p (4KB) * 0xA0A8_2000 | 0x0000_1000 | cda (4KB) * 0xA0A8_3000 | 0x0000_1000 | note (4KB) * 0xA0A8_4000 | 0x0000_1000 | hwcfg (4KB) * 0xA0A8_5000 | 0x0000_3000 | no use 5 (12KB) * 0xA0A8_8000 | 0x0004_0000 | fver (256KB) * 0xA0AC_8000 | 0x0000_4000 | sensordata (16KB) * 0xA0AC_C000 | 0x0000_4000 | LCM data (16KB) * 0xA0AD_0000 | 0x0000_1000 | DDR CDT (4KB) * 0xA0AD_1000 | 0x0000_1000 | sensor TOF (4KB) * 0xA0AD_2000 | 0x0000_8000 | sensor SSC (32KB) * 0xA0AD_A000 | 0x0000_6400 | sensordata 2 (25KB) * 0xA0AE_0400 | 0x0001_FC00 | no use 6 (127KB) * -------------------------------------------------------- 9MB * 0xA0B0_0000 | 0x0020_0000 | pstore (2MB) * -------------------------------------------------------- 11MB * 0xA0D0_0000 | 0x00B0_0000 | All FIH mem (11MB) */ Conclusion In this post, I analyzed the how the ABL Bootloader and the Linux kernel deal with the DT. It is interesting to know some details about the exact processing on the Nokia 8(NB1) platform anyway.","categories":[{"name":"Linux","slug":"Linux","permalink":"https://blog.inoki.cc/categories/Linux/"},{"name":"Android","slug":"Linux/Android","permalink":"https://blog.inoki.cc/categories/Linux/Android/"},{"name":"Bootloader","slug":"Linux/Android/Bootloader","permalink":"https://blog.inoki.cc/categories/Linux/Android/Bootloader/"}],"tags":[{"name":"Linux","slug":"Linux","permalink":"https://blog.inoki.cc/tags/Linux/"},{"name":"Android","slug":"Android","permalink":"https://blog.inoki.cc/tags/Android/"},{"name":"ABL","slug":"ABL","permalink":"https://blog.inoki.cc/tags/ABL/"},{"name":"Bootloader","slug":"Bootloader","permalink":"https://blog.inoki.cc/tags/Bootloader/"}]},{"title":"My journey on Raspberry Pi JTAG debugging","slug":"My-journey-on-raspberrypi-jtag-debugging","date":"2022-02-22T06:57:50.000Z","updated":"2025-03-08T09:40:48.586Z","comments":true,"path":"2022/02/22/My-journey-on-raspberrypi-jtag-debugging/","link":"","permalink":"https://blog.inoki.cc/2022/02/22/My-journey-on-raspberrypi-jtag-debugging/","excerpt":"","text":"As an OS developer/hacker, I am recently hacking Raspberry Pi, including a project aiming at running XNU(macOS kernel) on Raspberry Pi 3 and the port of Embox to Raspberry Pi 2. I often feel disappointed, because it is hard to get some useful information from the commercially available off-the-shelf (COTS) boards when debugging a kernel. Specially, it means the Raspberry Pi here. Although the Raspberry Pi Linux, aka. Raspbian, is open-sourced at GitHub, the bootloader on the chip (or somebody would like to call it BIOS) is still close-sourced. But it can be configured by a config.txt file. According to pinout Raspberry Pi JTAG, the GPIOs on the board can be configured through the config.txt to use some ALT functionalities, e.g., JTAG under ALT4 or ALT5. JTAG, or Joint Test Action Group, provides a standard interface (pin definition, etc.) to debug a program on a chip. I have some experiences back to 2019, using it to debug a real-time OS on an ARM development board. And it is widely used by many board/chip manufacturers, including RISC-V, ARM, etc. If it can work, that should be a perfect option for debugging using JTAG with OpenOCD. Hardware The Pin definitions for JTAG are as follows: ALT5 on GPIOs 4, 5, 6, 12 and 13 ALT4 on GPIOs 22, 23, 24, 25, 26 and 27 In general, the Pins used are TMS, TDI, TDO, TCK, RTCK, TRST (not presented in ALT5). The Pin layout is not standard at all. So, I need to manually connect the Pins one by one to a standard JTAG debugger. By searching the information, I found several standard JTAG interfaces (not all JTAG interfaces): They do have TMS, TDI, TDO, TCK pins, which are common in JTAG. The TRST is the reset pin, so we can connect them to the pin marked as â€œResetâ€. However, only ARM 10 pin and 20 pin contains a RTCK pin, I need to use a hardware debugger with one of the interfaces (I later realize that RTCK is a must). ST-Link v2 I firstly bought a ST-Link v2 debugger, which has a SWD interface and an ARM 20 pin interface. It should work well. However, I finally found that my hardware might by buggy. I tried to connect the ST-Link debugger from the official software, but both ~the software and~(I found that with the official software, it is necessary to connect the debugger for the first time to be able to connect) the OpenOCD 0.11.0 returns a wired status code during the initialization of JTAG stack through USB. The debug-level log information of OpenOCD is as follows: 1234Debug: 222 311 stlink_usb.c:1125 stlink_usb_error_check(): unknown/unexpected STLINK status code 0x4Error: 223 311 stlink_usb.c:3740 stlink_open(): init mode failed (unable to connect to the target)Debug: 224 311 stlink_usb.c:1654 stlink_usb_exit_mode(): MODE: 0x01Debug: 225 312 command.c:555 run_command(): Command &apos;init&apos; failed with error code -4 To know what happened, I tries to connect the Raspberry Pi from a JTAG debugger delivered with my first FPGA. Before that, I just validated that the debugger works well with the FPGA (in OpenOCD, using cpld/xilinx-xc6s.cfg target, which only uses TMS, TDI, TDO, TCK pins). With this debugger, OpenOCD can connect to the device: it does not report the USB bug anymore. However, it stops at complaining that RTCK signal cannot be responded. So, it is the ST-Link work which does not work in my case. The hardware debugging is painful. PS: The BCM2835 with ARM11 (Raspberry Pi 1, zero) does not seem to work with ST-Link High Level Abstraction(HLA), according to Ticket 280 of OpenOCD. But it might be possible with Direct DAP, which exists in ST-Link v2 later firmware and ST-Link 3. FTDI FT232H As I mentioned, this debugger is for my FPGA, which works fine out-of-box. The FT232H is a multi-function chip, can be configured as UART, FIFO, JTAG, I2C, SPI, etc. There seems to be an ARM 10 Pin interface. So, I connect it according to the layout of ARM 10 Pin. I did not connect RTCK, so the OpenOCD returns an error. However, there is no datasheet for my hardware delivered with the FPGA. I think it may be caused by the not really connected RTCK pin, or by the complex configuration of the multi-purpose chip. I just give up using this one, and try to follow the guide from an engineer at OpenSUSE, using a J-Link hardware. J-Link Realizing the the RTCK is important, I connected all the Pins to J-Link. I use several jump wires to connect the irregular JTAG Pins on Raspberry Pi to the J-Link standard ARM 20 Pin tag. The connection is as follows: Configurations After setting up the hardwares, the configuration on Raspberry Pi is simple, just change the GPIO ALT to ALT4 and add: 1enable_jtag_gpio=1 to enable the JTAG debugging. Software The software is which I mentioned before, OpenOCD. It uses a tcl grammar to describe the debug target, the debug protocol (JTAG, SWIG, etc.) and other configurations. There are some pre-edited configuration files. They are located at /usr/share/openocd/scripts if you install OpenOCD from the software source. The basic usage to start a daemon is: 1openocd -f &lt;debug-interface-conf&gt; -f &lt;debug-target-conf&gt; -c &lt;overwriten-or-appended-conf&gt; ... Then we can connect to the daemon by telnet, or attach gdb to the established debug target(s). Debug interface The interface in OpenOCD describes how to connect to a hardware debugger. For J-Link, the default configuration is interface/j-link.cfg. The one for FT232H JTAG debugging is interface/ftdi/um232h.cfg, and interface/st-link.cfg for the ST-Link. Debug protocol The debug protocol is called transport in OpenOCD. Some possible values are: 12345transport select jtagtransport select swimtransport select hla_jagtransport select dapdirect_jtagtransport select dapdirect_swd Raspberry Pi as a target The OpenOCD project already contains Raspberry Pi platforms in its 0.11.0 version, such as: 1234target/bcm2835.cfg # Raspberry 1, zerotarget/bcm2836.cfg # Raspberry 2target/bcm2837.cfg # Raspberry 2 rev 1.2, 3, zero 2target/bcm2711.cfg # Raspberry 4 Error: unknown status In a previous version of OpenOCD, e.g. the version in Ubuntu 20.04 LTS, the ARM core status for Hypervisor mode is not recognizable by the software. So when attaching gdb, there will be an error stating that the unknown status of the CPU, and will fail the gdb. I then use the 0.11.0 version under Arch Linux, which works perfectly. Conclusion This post takes my painful experiences on debugging Raspberry Pi with JTAG. Fortunately, it finally works.","categories":[{"name":"Embedded System","slug":"Embedded-System","permalink":"https://blog.inoki.cc/categories/Embedded-System/"},{"name":"Raspberry Pi","slug":"Embedded-System/Raspberry-Pi","permalink":"https://blog.inoki.cc/categories/Embedded-System/Raspberry-Pi/"}],"tags":[{"name":"Embedded System","slug":"Embedded-System","permalink":"https://blog.inoki.cc/tags/Embedded-System/"},{"name":"Bare Metal","slug":"Bare-Metal","permalink":"https://blog.inoki.cc/tags/Bare-Metal/"},{"name":"Raspberry Pi","slug":"Raspberry-Pi","permalink":"https://blog.inoki.cc/tags/Raspberry-Pi/"},{"name":"Debug","slug":"Debug","permalink":"https://blog.inoki.cc/tags/Debug/"},{"name":"JTAG","slug":"JTAG","permalink":"https://blog.inoki.cc/tags/JTAG/"}]},{"title":"å­‘ç„¶ä¸€èº«çš„ 2021","slug":"My-2021","date":"2022-02-08T16:54:40.000Z","updated":"2025-03-08T09:40:48.586Z","comments":true,"path":"2022/02/08/My-2021/","link":"","permalink":"https://blog.inoki.cc/2022/02/08/My-2021/","excerpt":"","text":"åˆè¿‡å»äº†ä¸€æ•´å¹´ï¼Œ2020 å¹´åˆå¼€å§‹çš„ç–«æƒ…å´ä»æœªç»“æŸã€‚ä»Šå¹´çš„å¾ˆå¤šäº‹æƒ…ä»ç„¶æ˜¯å’Œç–«æƒ…æ¯æ¯ç›¸å…³ï¼Œç”šè‡³éƒ½æ˜¯ç–«æƒ…æ¨åŠ¨çš„ã€‚è¿™ä¸€å¹´ï¼Œæˆ‘ç»å¤§å¤šæ•°æ—¶é—´éƒ½æ˜¯ç‹¬è‡ªä¸€äººçš„ï¼Œäºæ˜¯ä»Šå¹´æ›´åŠ å†…å‘å‹ã€å¹¶ä¸”è¿›è¡Œäº†å¾ˆå¤šæ€è€ƒä¸åæ€ï¼Œä½†è®©ä¸Šå¸æ¯æ¯å‘ç¬‘çš„æˆ‘å½“ç„¶è¿˜æ˜¯ä¼šæœ‰å¾ˆå¤šæƒ³ä¸æ˜ç™½çš„äº‹ï¼Œå”¯ä¸€èƒ½ç¡®å®šçš„å°±æ˜¯æˆ‘æ›´åŠ è¿½æ±‚çš„æ˜¯è‡ªå·±å†…å¿ƒå’Œç²¾ç¥çš„å¯Œè¶³ï¼Œè€Œè¿™ä¸€å¯Œè¶³å¤§éƒ¨åˆ†éƒ½æ˜¯åªæœ‰é æˆ‘è‡ªå·±æ‰èƒ½ç»™æˆ‘çš„ã€‚ ç–«æƒ… å¹´åˆçš„æ—¶å€™ï¼Œæˆ‘é€å®¶å±åˆ°äº†æœºåœºï¼Œè®©å®¶å±å…ˆåœ¨å›½å†…å·¥ä½œã€é¡ºä¾¿èº²å¼€ç–«æƒ…ï¼Œç­‰åˆ°ç–«æƒ…è¿‡å»äº†æˆ‘ä»¬å†ä¸€èµ·å‡ºæ¥ï¼Œäºæ˜¯æˆ‘è¿™è¾¹å°±å¼€å§‹äº†ç‹¬è‡ªä¸€äººçš„è‡ªé—­ç”Ÿæ´»ã€‚è€Œå®¶å±é‚£è¾¹åœ¨å›å›½çš„æ—¶å€™ï¼Œå›½å†…ç–«æƒ…æ—©å·²å¾—åˆ°äº†æ§åˆ¶ï¼Œç»è¿‡åƒå¾—å¾ˆå¥½çš„ä¸¤å‘¨éš”ç¦»ï¼Œå¼€å§‹æ‰¾å·¥ä½œæŠ•ç®€å†ï¼Œæ²¡å‡ å¤©å°±æ‰¾åˆ°äº†å·¥ä½œï¼Œç»è¿‡ä¸€æ®µæ—¶é—´çš„è¯•ç”¨å°±åœ¨å…­æœˆä»½è½¬æ­£äº†ï¼Œè™½ç„¶å·¥èµ„ä¸é«˜ã€ä½†æ˜¯å®Œå…¨ä¸åŠ ç­ã€æ´»ä¸ç´¯å¹¶ä¸”æ²¡æœ‰è€ƒç®—æ³•ã€‚ è€Œä¸æ­¤åŒæ—¶æˆ‘åœ¨å¤–é¢å¬ç€å„ç§å˜ç§æ”»å…¥åŒ—ç¾å¤§é™†çš„æ¶ˆæ¯ï¼Œç‘Ÿç‘Ÿå‘æŠ–ä¸æ•¢å‡ºé—¨ï¼Œç”šè‡³è¿è®¿é—®äº¤æµçš„è¿™ä¸ªåŸå¸‚éƒ½æ²¡æ€ä¹ˆé€›ã€‚åæ¥æƒ³äº†ä¸€ä¸‹ï¼Œåº”è¯¥æ˜¯å½“æ—¶æ­¦æ±‰å‡ºç°åŒ»ç–—èµ„æºæŒ¤å…‘çš„æƒ…å†µè®©è¿™ä¸ªç—…æ¯’æ˜¾å¾—å¾ˆä¸¥é‡ï¼Œå†åŠ ä¸Šå±‚å±‚æ¸²æŸ“ä»€ä¹ˆåé—ç—‡ï¼Œè®©å¾ˆå¤šäººè§‰å¾—è¿™ä¸ªç—…æ¯’éå¸¸ä¸¥é‡ã€‚å®é™…ä¸Šå°±æˆ‘çš„è§‚å¯Ÿï¼Œæ¬§ç¾å¾ˆå¤šäººæ ¹æœ¬ä¸ careï¼Œå¾—äº†å°±å½“å°æµæ„Ÿå’Œæ„Ÿå†’äº†ã€‚ä½†æ¯å¤©ç›¯ç€æ–°å¢çš„æ•°å­—è¿˜æ˜¯èƒ†æˆ˜å¿ƒæƒŠã€‚ å®é™…ä¸Šï¼Œé«˜ä¸­çš„æ—¶å€™å¦ˆå¦ˆå¾—è¿‡ä¸€æ¬¡å¾ˆä¸¥é‡çš„è‚ºç‚ï¼Œå‘çƒ§åˆ°æ˜è¿·è¯´èƒ¡è¯ï¼Œä¼¤åˆ°å¤§è„‘å¯¼è‡´å¥¹æœ‰æ®µæ—¶é—´è°éƒ½è®¤ä¸å‡ºæ¥ã€ç²¾åŠ›é›†ä¸­ä¸äº†ï¼Œç»è¿‡äº†å‡ ä¸ªæœˆæ‰å®Œå…¨å›å¤ã€‚ä½†å…¶å®èµ·å› åªæ˜¯å› ä¸ºä¸€ä¸ªå°æ„Ÿå†’æ‹–ç€æ²¡æœ‰å»åŒ»é™¢ï¼Œåé¢å‘å±•åˆ°è‚ºç‚é™„å¸¦å‘çƒ§ã€‚æˆ‘å½“æ—¶åœ¨ä½æ ¡ï¼Œå› ä¸ºå¦ˆå¦ˆç”Ÿç—…å›å»æ²¡æœ‰äººæœ‰ç²¾åŠ›å†ç®¡æˆ‘ï¼Œæ‰€ä»¥ç¬¬ä¸€å‘¨æ²¡æœ‰å›å»ï¼Œç­‰ç¬¬äºŒå‘¨å›å»çš„æ—¶å€™å¦ˆå¦ˆå·²ç»åœ¨åŒ»é™¢é†’è¿‡æ¥äº†ï¼Œä½†æ˜¯å½“æ—¶å·²ç»å¤§è„‘å—æŸä»€ä¹ˆéƒ½ä¸çŸ¥é“äº†ã€‚è€Œæˆ‘çˆ¸åˆ™ä¸€ç›´è§‰å¾—å°±æ˜¯ä¸€ä¸ªå°æ„Ÿå†’ï¼Œæ¯å¤©ä¹Ÿå°±å–‚å¦ˆå¦ˆåƒä¸€ä¸‹æ„Ÿå†’è¯å’ŒæŸ´èƒ¡ï¼ˆä¸­è¯ï¼‰æ³¨å°„æ¶²ã€‚æˆ‘å°æ—¶å€™åªè¦ä¸€å‘çƒ§å°±ä¼šè¢«å–‚æŸ´èƒ¡æ³¨å°„æ¶²ï¼šç”¨å‹ºå­æ•²å¼€ã€æŠŠç»ç’ƒèŒ¬å¼„å‡ºæ¥ï¼Œä¸€å£å–ä¸‹å»ã€‚å…ˆä¸è®ºæŸ´èƒ¡æ˜¯å¦çœŸçš„æœ‰ç”¨ï¼Œå°±è®ºæ³¨å°„æ¶²å¯èƒ½å°±æ˜¯å› ä¸ºæœ‰äº›æˆåˆ†ä¼šè¢«æ¶ˆåŒ–ç³»ç»Ÿåˆ†è§£æ‰åšæˆæ³¨å°„æ¶²ï¼Œå–æŸ´èƒ¡æ³¨å°„æ¶²ä¹Ÿæ˜¯å¾ˆå¥‡æ€ªçš„äº‹æƒ…äº†ã€‚ã€‚ã€‚ä½†ä»–ä»¬é‚£ä»£äººç¼ºä¹ä¸€äº›æˆ‘ä»¬ç°åœ¨è§‰å¾—æ˜¯å¸¸è¯†çš„äº‹ï¼Œå†åŠ ä¸Šå°åœ°æ–¹é‚£ä¸ªå¹´ä»£åŒ»ç–—èµ„æºåŒ®ä¹ã€å¿ƒç–¼é’±ï¼Œéšä¾¿ä¸€ä¸ªæŠ¤å£«çš„â€å°è¯€çªâ€œå°±è¢«æˆ‘çˆ¶æ¯å¥‰ä¸ºåœ­è‡¬ï¼Œç›´åˆ°è¿™æ¬¡å‡ºäº†äº‹ã€‚ã€‚ã€‚ æœ€ååˆ°äº†ç¬¬äºŒå‘¨çš„å‘¨å››ï¼Œäººå·²ç»æ˜è¿·äº†æ‰å«ä¸Šæˆ‘å¤–å©†ã€æŠŠå¦ˆå¦ˆé€åˆ°åŒ»é™¢ï¼ŒåŒ»ç”Ÿè¯´å¦‚æœå†æ™šæ¥ä¸¤å¤©å°±ä¸å¥½æ•‘äº†ã€‚ä½†åªè¦åŒ»ç–—èµ„æºè¶³å¤Ÿã€åŠæ—©å°±åŒ»ï¼Œå…¶å®ä¸€ä¸ªå°æ„Ÿå†’ï¼ˆæˆ–è€…è¯´è‚ºç‚ï¼‰ä¸è‡³äºæ­¤çš„ã€‚ åˆ°äº†ç°åœ¨ï¼Œæˆ‘ä¹Ÿè§‰å¾—æ–°å† å¯¹å¤§éƒ¨åˆ†äººæ¥è¯´å¯èƒ½å°±æ˜¯ä¸€ä¸ªå°æ„Ÿå†’äº†ï¼Œè€Œå›½å†…æ”¿åºœå› ä¸ºå†¬å¥¥ä¼šå’Œé¢å­é—®é¢˜ä¸€ç›´åœ¨å®è¡ŒåŠ¨æ€æ¸…é›¶æ”¿ç­–ã€å„ä¸ªåœ°æ–¹åˆå±‚å±‚åŠ ç æ˜¯ååº”è¿‡æ¿€äº†ã€‚ ä½†æ ¹æ®â€œä¸€å¤´ç‰›â€åŸç†ï¼Œæˆ‘çˆ¶æ¯å¹´çºªéƒ½ä¸å°äº†ã€è€Œä¸”èº«å­éƒ½æŒºå¼±çš„ï¼Œå¤„ç†ç”Ÿç—…çš„æ–¹å¼åˆä¸å¥½ï¼Œæ‰€ä»¥æˆ‘çš„ç¡®ä¸æƒ³æ–°å† è¿™ç§ç—…æ¯’åœ¨å®¶é‚£è¾¹è‡ªç”±ä¼ æ’­ã€å†µä¸”å°åœ°æ–¹åŒ»ç–—èµ„æºä¸å……è¶³ã€‚æˆ‘çˆ¶æ¯ä¹Ÿå±äºä¸ç»å¸¸å»å…¶ä»–åœ°æ–¹æ—…æ¸¸çš„ï¼ˆå› ä¸ºå®¶é‡Œå®åœ¨æ²¡æœ‰ä»€ä¹ˆé’±ï¼‰ï¼Œé™¤äº†æœ¬åœ°æœ‰ç—…ä¾‹çš„æƒ…å†µä¼šå°åŸï¼Œå¯¹ä»–ä»¬ç”Ÿæ´»åŸºæœ¬æ²¡æœ‰å½±å“ã€‚è¿˜æ˜¯ç­‰çœ‹åˆ°æ–°å˜ç§çš„è¯„ä¼°å†è¯´å§ï¼å¸Œæœ› 2022 å¹´å›½å†…æ”¿ç­–å°±å¯ä»¥æ”¾æ¾ï¼Œè®©æˆ‘å›å»çœ‹çœ‹çˆ¶æ¯å’Œå®¶å±ã€‚ å­¦æœ¯ 2021-2022 å¹´å·²ç»æ˜¯è¯»åšçš„å€’æ•°ç¬¬äºŒå¹´äº†ï¼Œåº”è¯¥æ˜¯å¼€å§‹å¤§é‡å‡ºæˆæœçš„ä¸€å¹´ï¼Œçš„ç¡®æˆ‘ä¹Ÿåœ¨å¹´åˆã€å¹´ä¸­ã€å¹´æœ«åˆ†åˆ«æŠ•äº†ä¸€ç¯‡æ–‡ç« ï¼Œå¹´åˆçš„é‚£ç¯‡æ²¡ä¸­ï¼Œå¹´ä¸­çš„å¹¸è¿åœ°ä¸­äº†ï¼Œè€Œå¹´æœ«çš„è‡³ä»Šè¿˜åœ¨ review ä¸­ï¼Œé¢„è®¡ä¸‰æœˆä»½æœ‰ç»“æœã€‚å¹´ä¸­çš„é‚£ç¯‡æ˜¯ä¸€ä¸ªè¿˜ä¸é”™çš„ä¼šè®®ï¼Œéœ€è¦åšä¸€ä¸ªè§†é¢‘ presentation ä»‹ç»æˆ‘çš„æ–‡ç« ï¼Œå› ä¸ºè¿˜æ˜¯æ”¶åˆ°ç–«æƒ…å½±å“ï¼Œå…¨éƒ¨éƒ½æ˜¯ virtual hostingã€‚ æ€»ä¹‹å­¦æœ¯æ–¹é¢åˆ°ç°åœ¨ä¸ºæ­¢ï¼Œå·²ç»è¶…è¿‡æ¯•ä¸šçš„è¦æ±‚äº†ï¼Œæ‰€ä»¥æ•´ä½“ä¹Ÿæ²¡ä»€ä¹ˆå‹åŠ›ï¼šæ¯å¤©å…«ä¹ç‚¹ä¸Šç­æ¨è¿›ä¸€ä¸‹é¡¹ç›®ã€ä¸‹åˆå…­ç‚¹å·¦å³å°±å›å®¶äº†ï¼Œç„¶ååˆ°å®¶ä¹‹åå®ç°è‡ªå·±çš„ ideaã€‚ç›®å‰æ¥è¯´ï¼Œå› ä¸ºå®¶é‡Œå’Œè‡ªå·±çœŸçš„ç¼ºé’±ï¼Œä¹Ÿä¸æ‰“ç®—åœ¨å­¦æœ¯è·¯ä¸Šç»§ç»­äº†ï¼Œå»å·¥ä¸šç•Œæ‰¾ä¸ªæ´»ã€æ”’å‡ºæ¥ä¸€äº›è¶³å¤Ÿè¿‡ä¸Šæƒ³è¦çš„ç”Ÿæ´»çš„é’±ã€‚åæ­£å­¦æœ¯æ–¹å‘ä¹Ÿä½“éªŒè¿‡äº†ï¼Œä¹Ÿçœ‹åˆ°äº†è¿™æ¡è·¯çš„ä¼˜ä¸åŠ£ï¼Œå†ç»“åˆç°åœ¨è‡ªèº«çš„ä¼˜åŠ¿ï¼Œå°±åˆæ­¥åšå‡ºäº†ä¸Šè¿°é€‰æ‹©ã€‚ æœ€ååœ¨å¹´æœ«çš„æ—¶å€™ï¼Œå’ŒæŸå¤§ V äº’åŠ¨è®¨è®ºäº†ä¸€ä¸‹æœŸåˆŠæ–‡ç« çš„æ”¶è´¹é—®é¢˜ï¼Œæˆ‘ä»¿ä½›çœ‹åˆ°äº†æœ¬ç§‘åˆšå¼€å§‹çš„æ—¶å€™å®Œå…¨ä¸æ‡‚å­¦æœ¯ç§‘ç ”çš„è‡ªå·±ã€‚ ç½‘ç»œ å‰é¢æåˆ°çš„å­¦æœ¯è§‚ç‚¹äº‹æƒ…å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼šé‚£ä½å¤§ V è§‰å¾—æ‰€æœ‰çš„æœ€ä¼˜ç§€çš„è®ºæ–‡å’Œèµ„æºéƒ½æ˜¯å…è´¹çš„ï¼Œé‚£äº›æ²¡åŠæ³•è‡ªå·±æ‰¾åˆ°å’Œå­¦ä¹ çš„éƒ½æ˜¯æ™ºå•†æœ‰é—®é¢˜ï¼ˆä¼˜è¶Šæ„Ÿ+1ï¼‰ï¼Œé‚£äº›æ²¡æ³•å…è´¹è®¿é—®çš„è®ºæ–‡éƒ½æ˜¯ç»ä¸ä½å®¡é˜…ã€æ‰€ä»¥æ‰è—ç€æ–ç€ï¼ˆä¼˜è¶Šæ„Ÿ+1ï¼‰ï¼Œè¿™ç§è®ºæ–‡éƒ½æ˜¯åœ¨çŸ¥ç½‘ä¸Šæ²¡æœ‰ä»»ä½•ä»·å€¼çš„ï¼ˆä¼˜è¶Šæ„Ÿ+1ï¼‰ï¼Œä»–æ˜¯ scihub çš„ç”¨æˆ·ï¼ˆä¼˜è¶Šæ„Ÿ+1ï¼‰ã€‚è€Œæˆ‘è¿›è¡Œäº†è½¬æ¨ï¼Œå¹¶è¯´è¿˜æ˜¯æœ‰å¾ˆå¤šé¢†åŸŸçš„è®ºæ–‡æ˜¯æ²¡åŠæ³•å…è´¹è·å–çš„ã€è¿˜æ˜¯å­˜åœ¨æœ‰é—¨æ§›çš„ã€æ”¶è´¹çš„åˆŠç‰©ï¼Œè¿™äº›åˆŠç‰©é‡Œä¹Ÿæœ‰å¤§é‡ä¼˜ç§€çš„è®ºæ–‡ï¼Œå‡ºç‰ˆå•†å¤ªå‘äº†ã€‚ è™½ç„¶æœ¬è´¨ä¸Šæˆ‘ä»¬å¯¹æœŸåˆŠæ”¶è´¹çš„é—®é¢˜éƒ½æ˜¯æ·±æ¶ç—›ç»çš„ï¼Œä½†å¯æƒœçš„æ˜¯ï¼Œè¿™ä½å¤§ V ä¸Šæ¥å°±ä½¿ç”¨â€œè¿™é€¼â€å¯¹æˆ‘è¿›è¡Œäº†è¾±éª‚ï¼Œå¹¶ä¸”æ ‘èµ·äº†ä»–ä¸ºä»»ä½•åå¯¹ä»–è§‚ç‚¹çš„äººå‡†å¤‡çš„é¶å­ã€å¼€å§‹å–·ä»–æƒ³è±¡ä¸­çš„è§‚ç‚¹ã€‚æˆ‘å½“æ—¶åªæƒ³ç¬‘ï¼Œå› ä¸ºä»–æ”»å‡»çš„è§‚ç‚¹ã€æˆ‘ä¹Ÿä¸çŸ¥é“æ˜¯è°çš„ã€‚ã€‚ã€‚è€Œè‡³äºä»–è¯„è®ºä¸‹è¯´æˆ‘æ˜¯æ°´è´§çš„ç”¨æˆ·ä»¬ï¼Œè¿˜å¥½æ²¡ fo æˆ‘ï¼Œè¦ä¸ç„¶æˆ‘éœ€è¦å¤§åæ€æˆ‘å‘æ¨çš„æ°´å¹³äº† lolã€‚å½“ç„¶æˆ‘å…¶å®ä¹Ÿéª‚å›å»äº†ä½†æ²¡æœ‰è„å­—ï¼Œè¿™ç‚¹åƒé‡Œå†°å°åº”è¯¥è¯»æ‡‚äº† XDã€‚ è¿™æ¬¡äº‰è®ºå¯¼è‡´äº†æˆ‘ list é‡Œä¸€ç³»åˆ—çš„å­¦æœ¯äººè¢«è¿™ä½å¤§ V æ‹‰é»‘äº†ï¼Œæˆ‘æœ¬æ¥ä¹Ÿè›®æ¬£èµä»–çš„ä¸€äº›è§‚ç‚¹ï¼Œåæ¥åœ¨æŠ½ç©ºæœç´¢äº†ä¸€ä¸‹ä»–çš„å­¦æœ¯æˆæœï¼ˆä½†æ²¡æœåˆ°ï¼Œå¯èƒ½æˆè¯¾å‹ç¡•å£«å¯¼è‡´å”¯ä¸€çš„å­¦æœ¯æˆæœå°±æ˜¯æ”¾åœ¨çŸ¥ç½‘ä¸Šçš„æœ¬ç§‘æ¯•ä¸šè®ºæ–‡å§ï¼‰ã€å¹¶æ€»ç»“äº†ä¸€ä¸‹ä»–çš„è§‚ç‚¹ä¹‹åï¼Œä¹Ÿå–å…³+é™éŸ³äº†ï¼Œä¹Ÿæœ‰éƒ¨åˆ†åŸå› æ˜¯ä»–æœ€è¿‘çš„å“—ä¼—å–å® å¼æ³¨é”€å§ã€‚ ç»è¿‡è¿™æ¬¡æˆ‘ä¹Ÿæ˜ç™½äº†åœ¨ç½‘ç»œä¸Šå¾ˆå¤šäº‹æƒ…ä¸èƒ½è®¤çœŸï¼šå¤§å®¶éƒ½è§‰å¾—å¯¹æ–¹æ˜¯å‚»é€¼ï¼Œå¹¶ä¸å¯èƒ½è®¨è®ºå‡ºç»“æœï¼Œç”šè‡³æœ‰äº›äººå…¶å®æ ¹æœ¬ä¸æ˜¯åœ¨äº‰è®ºï¼Œè€Œæ˜¯æ ‘ä¸ªé¶å­è‡ªå·±æ‰“ï¼Œåªä¸ºäº†ç»™è‡ªå·±å¹³å‡¡çš„ç”Ÿæ´»æ·»åŠ ä¸€äº›ï¼ˆæˆ‘è§‰å¾—è«åå…¶å¦™çš„ï¼Œä½†å¯èƒ½ ta è¿˜è›®å—ç”¨çš„ï¼‰ä¼˜è¶Šæ„Ÿã€‚è€Œèƒ½æˆä¸ºå¤§ V å¹¶ä¸æ˜¯æœ‰ä»€ä¹ˆè¿‡äººä¹‹å¤„ï¼Œå¯èƒ½åªæ˜¯ä¼šæŒç»­å‘è¡¨ä¸€äº›ç®€å•ã€ç›´æ¥ã€æœ‰äº‰è®®çš„è§‚ç‚¹ï¼Œå½¢æˆåŒæ¸©å±‚ã€‚ äºæ˜¯åæ¥æˆ‘å°±å¼€å§‹åšç›¸å…³çš„å®éªŒï¼Œï¼ˆç»è¿‡æœ¬äººæˆæƒï¼‰è½¬äº†ä¸€äº›ä¸€ä¸ªåˆä¸­åŒå­¦çš„äº‰è®®æ€§è¨€è®ºï¼Œå¼•èµ·äº†å¾ˆå¤§çš„è®¨è®ºï¼Œç”šè‡³æƒŠåŠ¨äº†æŸç½‘ç»œåª’ä½“çš„åˆ›å§‹äººã€‚è€Œåæ¥çš„æŠ–æœºçµé˜´é˜³æ€ªæ°”æ”¶åˆ°éå¸¸å¤šçš„å›å¤ä¹Ÿè¯æ˜äº†è¿™ä¸€ç‚¹ã€‚ä¹‹åè¿˜æ˜¯å°½é‡ä¸è¿™æ ·äº†ï¼Œæ„Ÿè§‰å¹¶æ²¡æœ‰æ„ä¹‰å­˜åœ¨ï¼Œåªæ˜¯ä¼šè®©å¾ˆå¤šæ•°æ®ä¸­å¿ƒçš„å¤„ç†å™¨ã€å†…å­˜ã€ç½‘å¡ç­‰è®¾å¤‡çƒ§æ›´å¤šçš„ç”µï¼Œå¹¶ä¸èƒ½æ¨è¿›ä»»ä½•äººç±»ç¤¾ä¼šçš„å‘å±•ã€‚ä½†äº‹å®è¯æ˜ï¼Œå¾ˆå¤šå¤§ V éƒ½æ˜¯é€šè¿‡æŒç»­è¾“å‡ºè¿™æ ·çš„è¨€è®ºå˜æˆå¹¶ç»´æŒå¤§ V èº«ä»½çš„ï¼Œæ¯”å¦‚â€B ç«™ä½ çˆ·çˆ·åˆå›æ¥äº†çš„â€œæŸ up ä¸»é›·æŸã€‚ä½†æˆ‘è¿˜æ˜¯æ›´è¿½æ±‚æˆ‘å†…å¿ƒçš„å¹³é™ï¼Œåšä¸€äº›æ›´åŠ æœ‰æ„ä¹‰çš„äº‹æƒ…ã€‚æˆ‘è§‰å¾—è¿˜æ˜¯è¦å‘æ›´åŠ ä¼˜ç§€çš„äººçœ‹é½ï¼Œæ‰€ä»¥æˆ‘ä¹Ÿå–å…³äº†ä¸€äº›æ²¡æœ‰è¥å…»çš„å¤§ Vã€‚ å¼€æº æˆ‘åŠ›æ‰€èƒ½åŠçš„æ›´åŠ æœ‰æ„ä¹‰çš„äº‹æƒ…ï¼Œå¯èƒ½å°±æ˜¯å¼€æ”¾æºä»£ç èƒ½å¸®åŠ©åˆ°ä»–äººçš„é¡¹ç›®äº†ã€‚ å¹´åˆå®Œæˆäº†ä¸ºæ ‘è“æ´¾äºŒä»£æ·»åŠ  embox è¿™ä¸ªåµŒå…¥å¼å®æ—¶ OS çš„æ”¯æŒã€å¹¶ä¸”ä¼˜åŒ–äº†å¯¹ç§°å¤šå¤„ç†ï¼ˆSMP/å¤šæ ¸ï¼‰çš„æ”¯æŒï¼›åæ¥å¼€å§‹æŠ„ Berkeley çš„è½¯ä»¶æ¨¡æ‹Ÿ FPUï¼ˆæµ®ç‚¹è¿ç®—å•å…ƒï¼‰å†™äº†ä¸€ä¸ª Rust å®ç°ï¼Œé¡ºä¾¿æ‰‹åŠ¨è½¬è¯‘æˆ ASLï¼ˆACPI çš„å„ç§è¡¨ä½¿ç”¨çš„è¯­è¨€ï¼‰ï¼ŒåŸºäºè¿™ä¸ªè½¯ä»¶ FPU å®ç°åœ¨ ASL é‡Œå†™å‡ºäº†ä¸€ä¸ª Ray Tracing in one Weekend çš„å®ç°ï¼Œåæ¥å‘ç°å› ä¸ºç²¾åº¦æ¸²æŸ“å‡ºæ¥çš„å¾ˆæœ‰é—®é¢˜ï¼Œä½† debug æœ‰äº›éº»çƒ¦å°±å¼ƒå‘äº†ï¼›æ˜¥å¤©çš„æœ«å°¾ï¼Œæˆ‘åŸºäº libpinyin å†™äº†ä¸€ä¸ªåŸºç¡€ç‰ˆçš„ macOS è¾“å…¥æ³•ï¼Œä¾èµ–äº HomeBrew æ„å»ºçš„é™æ€åº“ï¼Œä½†ç›®å‰ç”±äº HomeBrew çš„ prebuilt æœºåˆ¶å˜äº†ï¼Œå¹¶ä¸èƒ½å†æˆåŠŸæ„å»ºã€‚ åˆ°å…­æœˆä»½å†™å®Œè®ºæ–‡å¹¶ä¸”æŠ•å‡ºä¹‹åï¼Œæˆ‘å…ˆå†™äº†ä¸€ä¸ªä½¿ç”¨å‚…é‡Œå¶å˜æ¢æ¥ç»˜åˆ¶ SVG å›¾å½¢è·¯å¾„çš„åº”ç”¨ï¼Œè¿™ä¸ªé¡¹ç›®è®©æˆ‘å¿ƒæ»¡æ„è¶³ï¼šå› ä¸ºæˆ‘å¹¶ä¸æ»¡è¶³äºçº¯åº”ç”¨çš„æŠ€æœ¯ï¼Œæˆ‘æ‰€å–œçˆ±çš„æ˜¯è¿™ç§èƒ½å¤ŸæŠŠæ•°å­¦ç†è®ºå’Œå…·ä½“åº”ç”¨ç´§å¯†è”ç³»èµ·æ¥çš„ç¨‹åºâ€”â€”æ—¢æœ‰åº”ç”¨èƒŒæ™¯ï¼Œåˆæœ‰æ•°å­¦ä¹‹ç¾ã€‚å¯èƒ½è¿™ä¹Ÿæ˜¯æˆ‘é€‰æ‹©è¯»åšçš„ä¸€ä¸ªåŸå› å§ã€‚åæ¥æœ‰ä¸€ä½æ•°å­¦ç³»çš„å­¦ç”Ÿä¸“é—¨å‘é‚®ä»¶æ„Ÿè°¢è¿™ä¸ªé¡¹ç›®ï¼Œä¹Ÿè®©æˆ‘è·å¾—äº†è¢«äººéœ€è¦çš„æ„å¤–ä¹‹å–œã€‚ å…­æœˆåˆæˆ‘ä¹ŸåŒæ—¶å¼€äº†å¦ä¸€ä¸ªé¡¹ç›®ï¼Œæ˜¯ä¸º efivar æ·»åŠ äº†ä¸€å±‚ Qt å°è£…ã€å¹¶ä¸”æ·»åŠ äº† Win32 API æ¥å®ç°äº†å¯¹ Windows çš„æ”¯æŒï¼Œè¿™æ ·æˆ‘å¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªåº“ï¼Œåœ¨å¤§éƒ¨åˆ†æ“ä½œç³»ç»Ÿé‡Œå®ç°å¯¹ UEFI æ ‡å‡†é‡Œçš„å˜é‡çš„æ“ä½œã€‚è€ŒåŸºäºæ­¤ï¼Œæ„å»ºäº†ä¸€ä¸ª Qt åº”ç”¨ç¨‹åºï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹ EFI å˜é‡æ¥æ”¹å˜å¯åŠ¨é¡ºåºã€è®¾ç½®ä¸‹æ¬¡çš„å¯åŠ¨ç›®æ ‡ä¹‹ç±»çš„ã€‚åˆ°äº†å¹´æœ«ï¼Œè¿™ä¸ªé¡¹ç›®ä¹Ÿæ”¶è·äº† 100 ä½™ star äº†ã€‚æˆ‘ä¸ªäººè§‰å¾—å®ƒä»¬å¾ˆæœ‰ç”¨ï¼Œä¹Ÿä¼šé•¿æœŸç»´æŠ¤ä¸‹å»ã€‚ ä¸ƒæœˆçš„æ—¶å€™æ”¾äº†æš‘å‡ï¼Œé—²æ¥æ— äº‹è¯»äº†ä¸€ä¸‹åˆ«äººé€†å‘çš„ Switch Joycon çš„æ–‡æ¡£ï¼Œç„¶åå†™äº†ä¸€ä¸ªå«åš libjoycon çš„ C åº“ï¼Œç”¨æ¥ç¼–ç å’Œè§£ç  Joycon çš„è“ç‰™é€šä¿¡åŒ…ï¼Œåšäº†ä¸€ä¸ªæŠŠ joycon çš„åº§æ ‡æ˜ å°„åˆ° OpenGL ç»˜åˆ¶çš„ä¸€ä¸ªç«‹æ–¹ä½“çš„ä¾‹å­ï¼Œæ„Ÿè§‰éå¸¸å¥½ç©ã€‚ åˆ°äº†å…«æœˆè¿›äº†åŸç©ï¼Œå’Œå½“åˆåœ¨æ³•å›½çš„åŒå­¦ä¸€èµ·æäº†ä¸€ä¸‹ GPU åŠ é€Ÿã€æ·±åº¦å­¦ä¹ ï¼Œå¹¶ä¸”åˆ·äº†ä¸€ä¸‹ç°ä»£ Cpp çš„ç‰¹æ€§ï¼Œä¸ºå¤§å¤šæ•°ç‰¹æ€§éƒ½å†™äº†ç»ƒä¹ ã€‚é¡ºä¾¿å®Œæˆäº†ä¹‹å‰åšæ ‘è“æ´¾æ¶æ„è°ƒç ”çš„æ—¶å€™æƒ³åˆ°çš„ä¸ºå…¶æ„å»º XNUï¼ˆApple çš„å†…æ ¸ï¼‰çš„é¡¹ç›®ï¼ŒæˆåŠŸæ„å»ºå‡ºæ¥äº†ä¸€ä¸ªå†…æ ¸ï¼Œä½†å´è¿˜å› ä¸ºä¸æ˜åŸå› æ— æ³•å¯åŠ¨ï¼Œæˆ‘æœ€è¿‘ä¹Ÿåœ¨æ­å»ºæ ‘è“æ´¾çš„ JTAG è°ƒè¯•ç¯å¢ƒã€‚è€Œåˆ°äº†ä¹æœˆï¼Œå°±åŸºæœ¬åœ¨å‡†å¤‡ä¼šè®®çš„æ¼”è®²å’Œä¸€ä¸ªå°è®²åº§ï¼Œå¹¶ä¸”åœ¨ä¹‹åç»“æŸæˆ‘çš„ç¬¬ä¸€ä¸ªäº¤æ¢ä¹‹æ—…äº†ã€‚åœ¨å‡†å¤‡æ¼”è®²é¢„å½•è§†é¢‘çš„æ—¶å€™ï¼Œå‘ç°éšä¾¿å‰ªå‰ªè§†é¢‘è¿˜æ˜¯è›®å¼€å¿ƒçš„ï¼Œäºæ˜¯å»ºäº†ä¸€ä¸ª Youtube é¢‘é“ Inokiâ€™s Code Forgeå¼€å§‹äº†è§†é¢‘çš„åˆ¶ä½œå’Œä¸Šä¼ ï¼Œä»Šåæœ‰äº›å†…å®¹ä¹Ÿä¼šåœ¨è¿™è¾¹å‘å¸ƒï¼Œæœ‰å…´è¶£çš„å¯ä»¥å…³æ³¨ä¸€ä¸‹:) ä¼šè®®å’Œäº¤æ¢ç»“æŸå›åˆ°è‡ªå·±çš„å°å®…å­ä¹‹åï¼Œå¼€å§‹å‡†å¤‡ä¸‹ä¸€ç¯‡æ–‡ç« å’Œåšç›¸åº”çš„å®éªŒï¼ŒåŒæ—¶å¼€å§‹å­¦ä¹  Taichi è¿™ä¸ªå¹¶è¡Œç¼–ç¨‹è¯­è¨€ï¼Œé¡ºä¾¿æäº†ä¸ª PR å®ç°åœ¨ FreeBSD ä¸Šçš„æ„å»ºã€‚åˆ°äº†åäºŒæœˆæˆ‘åˆé€šè¿‡ swig ä¸º libjoycon é‚£ä¸ª C åº“æ·»åŠ äº† Python çš„ bindingï¼Œå’Œ Taichi ç©äº†ä¸€ä¸‹æ¢¦å¹»è”åŠ¨ï¼Œä½¿ç”¨ Joycon çš„è§’åº¦æ¥æ˜ å°„åˆ†å½¢å›¾çš„å˜åŒ–ã€‚ä¹Ÿæ”¶åˆ°äº†çº¯çˆ·çš„ PRï¼Œä¿®å¤äº†åœ¨ macOS ä¸Šçš„æ„å»ºï¼Œå¸Œæœ›çº¯çˆ·å’Œ manjusaka ä¹Ÿéƒ½ç©å¾—å¼€å¿ƒï¼ ä¹‹ååˆå°è¯•äº†ä¸€ä¸‹åŸºäº EDK2 æ¥æ„å»º EFI Appï¼Œå†™äº†ä¸€ä¸ªæ’­æ”¾ Bad Apple çš„ç»ƒäº†ä¸‹ï¼Œäº†è§£äº†ä¸€ä¸‹ EDK2 è¿˜æœ‰ EFI çš„æ¶æ„å’Œä¸€äº›ç»†èŠ‚ï¼Œä»Šå¹´æ‰“ç®—åšçš„äº‹æƒ…æ­£å¥½ä¹Ÿå’Œ EFI æœ‰å…³ã€‚ ä»Šå¹´å¼€æºçš„ä»£ç ç»å¤§å¤šæ•°éƒ½æ˜¯æ— æ„é—´çªç„¶æƒ³åˆ°çš„ã€ç”¨æ¥ç©çš„ ideaï¼Œä¼¼ä¹æƒ³è±¡åŠ›è¿˜å¯ä»¥ã€ä¹è¶£ä¹Ÿå¾ˆè¶³å‘¢ï¼æ€»ä¹‹ä»Šå¹´æ”¶è·æ»¡æ»¡ï¼Œè€Œè‡³äº 2022 å¹´çš„é¡¹ç›®å’Œç›®å‰æœªå…¬å¼€çš„ï¼Œæˆ‘ä¹Ÿæ”¾åœ¨æ–°çš„ä¸€å¹´çš„æ€»ç»“é‡ŒèŠå§ã€‚ å°¾å£° å¹´åº•æŠ•å®Œæ–‡ç« ï¼Œå»äº†æ»‘é›ªæ•£ä¸€ä¸‹å¿ƒï¼Œè¿™æ¬¡æ»‘äº†å•æ¿ä½†ä¸€å‘¨å¹¶æ²¡æœ‰å¤ªå¤šè¿›å±•ï¼Œå¤©æ°”ä¹Ÿä¸æ˜¯ç‰¹åˆ«å¥½å¯¼è‡´é›ªé“ç»“å†°ï¼Œæ‘”å¾—ç”Ÿç–¼ã€‚ æœ€åï¼Œåœ¨ 12 æœˆ 31 æ—¥é‚£å¤©ï¼Œç´§å¯†ä¸ç–«æƒ…è”ç³»çš„ä¸€å¹´ä»¥åœ¨æ»‘é›ªä¸­å¿ƒæ„ŸæŸ“äº†æ–°å† ç»“æŸã€‚æˆ‘è§‰å¾—å¯ä»¥åˆ°ä»Šå¹´å¹´æœ«å†èŠè¿™æ¬¡æ„ŸæŸ“çš„ç»å†ï¼Œå¸Œæœ›æ–°å† ç–«æƒ…å¤§æµè¡Œèƒ½åœ¨ 2022 ç»“æŸå§ï¼ŒåŒæ—¶ä¹Ÿå¸Œæœ›å¤§å®¶ä¹Ÿéƒ½èƒ½æ‰¾åˆ°è‡ªå·±å†…å¿ƒçš„å®é™ï¼","categories":[{"name":"Dairy","slug":"Dairy","permalink":"https://blog.inoki.cc/categories/Dairy/"}],"tags":[{"name":"ä¸­æ–‡","slug":"ä¸­æ–‡","permalink":"https://blog.inoki.cc/tags/ä¸­æ–‡/"},{"name":"private","slug":"private","permalink":"https://blog.inoki.cc/tags/private/"}]},{"title":"Build and run Hello World on OVMF Qemu","slug":"qemu-ovmf-edk2-build","date":"2021-12-17T13:47:00.000Z","updated":"2025-03-08T09:40:48.611Z","comments":true,"path":"2021/12/17/qemu-ovmf-edk2-build/","link":"","permalink":"https://blog.inoki.cc/2021/12/17/qemu-ovmf-edk2-build/","excerpt":"","text":"This post records how I build and run an EDK2 HelloWorld on Qemu, based on OVMF UEFI shell. Prepare environment Clone edk2: 1git clone --recursive https://github.com/tianocore/edk2.git Enter edk2 build environment: 1. edksetup.sh BaseTools Build base tools: 1make -C &lt;edk2-dir&gt;/BaseTools/Source/C Create and build HelloWorld Build HelloWorld package for x64 architecture and using GCC: 1build -a X64 -p HelloWorldPkg/HelloWorldPkg.dsc -t GCC5 The built HelloWorld.efi is under Build/HelloWorldPkg/DEBUG_GCC5/X64, we can run it under UEFI shell on an x64 PC or an emulator. Build edk2 for OVMF Modify the following contents in Conf/target.txt: 123ACTIVE_PLATFORM = OvmfPkg/OvmfPkgX64.dscTARGET_ARCH = X64TOOL_CHAIN_TAG = GCC5 Then, build it: 1build Boot and run Hello World Make an image to store efi files: 1234dd if=/dev/null of=example.img bs=1M seek=512mount -t ext4 -o loop example.img /mnt/examplecp Build/HelloWorldPkg/DEBUG_GCC5/X64/HelloWorld.efi /mnt/exampleumount /mnt/example Run OVMF as the firmware and mount the images: 1qemu-system-x86_64 -L . --bios ./ovmf.fd -hda ./example.img In the UEFI shell, list disk mappings: 123456map -rMapping table FS0: ... ... BLK1: ... ... The files are under fs0, list them: 12ls fs0:\\... HelloWorld.efi Run our Hello Wolrd: 12fs0:\\HelloWorld.efiHello World! Conclusion In this post, I noted all the steps to build an edk2 HelloWorld. I will write some interesting UEFI applications sooner. Readings Boot Overview Run OVMF Debug using GDB","categories":[{"name":"EDK2","slug":"EDK2","permalink":"https://blog.inoki.cc/categories/EDK2/"}],"tags":[{"name":"Qemu","slug":"Qemu","permalink":"https://blog.inoki.cc/tags/Qemu/"},{"name":"EDK2","slug":"EDK2","permalink":"https://blog.inoki.cc/tags/EDK2/"}]},{"title":"ã€è¯‘ã€‘æˆ‘çš„ C++ 20 åç¨‹çš„äºˆå–äºˆæ±‚","slug":"My_tutorial_and_take_on_C++20_coroutines","date":"2021-12-16T15:34:00.000Z","updated":"2025-03-08T09:40:48.589Z","comments":true,"path":"2021/12/16/My_tutorial_and_take_on_C++20_coroutines/","link":"","permalink":"https://blog.inoki.cc/2021/12/16/My_tutorial_and_take_on_C++20_coroutines/","excerpt":"","text":"åŸæ–‡é“¾æ¥ï¼šhttps://www.scs.stanford.edu/~dm/blog/c+Â±coroutines.html ä»‹ç» åœ¨è¿‡å»çš„ 25 å¹´é‡Œï¼Œæˆ‘åœ¨ C++ ä¸­å†™äº†å¾ˆå¤šäº‹ä»¶é©±åŠ¨çš„ä»£ç ã€‚ä¸€ä¸ªå…¸å‹çš„äº‹ä»¶é©±åŠ¨ä»£ç çš„ä¾‹å­æ˜¯æ³¨å†Œä¸€ä¸ªå›è°ƒï¼Œæ¯æ¬¡å¥—æ¥å­—æœ‰æ•°æ®éœ€è¦è¯»å–æ—¶éƒ½ä¼šè¢«è°ƒç”¨ã€‚ä¸€æ—¦ä½ è¯»å–äº†æ•´ä¸ªæ¶ˆæ¯ï¼Œå¯èƒ½ç»è¿‡å¤šæ¬¡è°ƒç”¨ï¼Œä½ å°±ä¼šè§£ææ¶ˆæ¯ï¼Œå¹¶ä»æ›´é«˜çš„æŠ½è±¡å±‚è°ƒç”¨å¦ä¸€ä¸ªå›è°ƒï¼Œå¦‚æ­¤åå¤ã€‚è¿™ç§ä»£ç å†™èµ·æ¥å¾ˆç—›è‹¦ï¼Œå› ä¸ºä½ å¿…é¡»æŠŠä½ çš„ä»£ç åˆ†æˆä¸€å †ä¸åŒçš„å‡½æ•°ï¼Œå› ä¸ºå®ƒä»¬æ˜¯ä¸åŒçš„å‡½æ•°ï¼Œæ‰€ä»¥ä¸å…±äº«å±€éƒ¨å˜é‡ã€‚ ä½œä¸ºä¸€ä¸ªä¾‹å­ï¼Œè¿™é‡Œæ˜¯ Mail Avenger çš„ smtpd ç±»ä¸Šçš„æ–¹æ³•å­é›†ï¼Œæˆ‘çš„ SMTP æœåŠ¡å™¨æ˜¯ç”¨ C++03 ç¼–å†™çš„ï¼š 1234567void cmd_rcpt (str cmd, str arg);void cmd_rcpt_0 (str cmd, str arg, int, in_addr *, int);void cmd_rcpt_2 (str addr, int err);void cmd_rcpt_3 (str addr, str errmsg);void cmd_rcpt_4 (str addr, str errmsg, int local);void cmd_rcpt_5 (str addr, str errmsg, str err);void cmd_rcpt_6 (str addr, str err); ç¬¬1æ­¥ï¼Œcmd_rcpt ä¼¼ä¹æ˜¯ä¸€ä¸ªåˆç†çš„å‡½æ•°ï¼Œåœ¨å®¢æˆ·ç«¯å‘å‡º SMTP â€œRCPTâ€ å‘½ä»¤æ—¶è°ƒç”¨ã€‚å¤„ç† RCPT å‘½ä»¤å–å†³äºå¯¹å®¢æˆ·çš„æŸäº›ä¿¡æ¯çš„ç¼“å­˜ã€‚å¦‚æœè¿™äº›ä¿¡æ¯æ²¡æœ‰è¢«ç¼“å­˜ï¼Œå®ƒå°±ä¼šå¯åŠ¨ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡æ¥æ¢æµ‹å®¢æˆ·ç«¯å¹¶è¿”å›ã€‚å¼‚æ­¥ä»»åŠ¡å®Œæˆåï¼Œâ€œå›åˆ°â€ ç¬¬ 0 æ­¥ï¼Œcmd_rcpt_0ï¼Œå®ƒåªæ˜¯å†æ¬¡è°ƒç”¨ cmd_rcptï¼Œä½†éœ€è¦ä¸€ä¸ªä¸åŒçš„å‡½æ•°ï¼Œå› ä¸ºå®¢æˆ·ç«¯æ¢æµ‹ä»£ç æœŸæœ›ä¸€ä¸ªå›è°ƒï¼Œå®ƒå¯ä»¥æä¾›é¢å¤–çš„å‚æ•°ã€‚ç„¶åï¼Œå„ç§å…¶ä»–çš„äº‹æƒ…å¯èƒ½éœ€è¦å¼‚æ­¥å‘ç”Ÿï¼Œè€Œæ¯ä¸ªå¯èƒ½çš„å¼‚æ­¥è°ƒç”¨çš„è¿”å›ç‚¹éƒ½éœ€è¦æ˜¯å®ƒè‡ªå·±çš„æ–¹æ³•ï¼Œè¿™ç›¸å½“æ¶å¿ƒã€‚ C++11 é€šè¿‡å¼•å…¥ lambda è¡¨è¾¾å¼ï¼Œä½¿æƒ…å†µå¤§ä¸ºæ”¹å–„ã€‚ç°åœ¨ä½ åªéœ€è¦ç±»ä¸Šçš„ä¸€ä¸ª cmd_rcpt æ–¹æ³•ï¼Œå…¶ä½™çš„å¯ä»¥ä½¿ç”¨åµŒå¥—çš„ lambda è¡¨è¾¾å¼ã€‚æ›´å¥½çš„æ˜¯ï¼Œlambdas å¯ä»¥ä»åŒ…å›´çš„å‡½æ•°ä¸­æ•è·å±€éƒ¨å˜é‡ã€‚å°½ç®¡å¦‚æ­¤ï¼Œä½ ä»ç„¶éœ€è¦æŠŠä½ çš„ä»£ç åˆ†æˆè®¸å¤šå‡½æ•°ã€‚è·³è¿‡å¤šä¸ªæ­¥éª¤æˆ–æ”¯æŒåœ¨è¿è¡Œæ—¶å‘å‡ºå¼‚æ­¥äº‹ä»¶çš„é¡ºåºå¯èƒ½æ”¹å˜çš„æƒ…å†µæ˜¯å¾ˆç¬¨æ‹™çš„ã€‚æœ€åï¼Œå½“ä½ çš„åµŒå¥— lambda è¡¨è¾¾å¼ç¼©è¿›å¾—è¶Šæ¥è¶Šè¿œæ—¶ï¼Œä½ å¸¸å¸¸ä¼šä¸æ–‡æœ¬ç¼–è¾‘å™¨çš„å³ä¾§è¾¹è·ä½œæ–—äº‰ã€‚ çœ‹åˆ° C20 æ”¯æŒåç¨‹ï¼Œæˆ‘æ„Ÿåˆ°éå¸¸å…´å¥‹ï¼Œè¿™åº”è¯¥ä¼šæå¤§åœ°æ”¹å–„ç¼–å†™äº‹ä»¶é©±åŠ¨ä»£ç çš„è¿‡ç¨‹ã€‚ç°åœ¨ç»ˆäºæœ‰äººå‡ºç‰ˆäº†ä¸€æœ¬å…³äº C20 çš„ä¹¦ï¼ˆæˆ–è€…è‡³å°‘æ˜¯ä¸€æœ¬ä¹¦çš„è‰ç¨¿ï¼‰ï¼Œå‡ å¤©å‰æˆ‘è¿«ä¸åŠå¾…åœ°æ‹¿åˆ°äº†ä¸€æœ¬ï¼Œå¹¶é˜…è¯»äº†å®ƒã€‚è™½ç„¶æˆ‘å‘ç°è¿™æœ¬ä¹¦åœ¨æ¦‚å¿µï¼ˆè¯­è¨€ç‰¹æ€§ï¼‰å’Œå…¶ä»– C++20 çš„æ”¹è¿›æ–¹é¢åšå¾—å¾ˆåˆç†ï¼Œä½†æˆ‘æ‚²å“€åœ°å‘ç°å¯¹åç¨‹çš„è§£é‡Šå®Œå…¨æ— æ³•ç†è§£ã€‚æˆ‘åœ¨ç½‘ä¸Šæ‰¾åˆ°çš„å‡ ä¹æ‰€æœ‰å…¶ä»–è§£é‡Šéƒ½æ˜¯å¦‚æ­¤ã€‚å› æ­¤ï¼Œæˆ‘ä¸å¾—ä¸é€šè¿‡è§„èŒƒå’Œ cppreference.org æ¥å¼„æ¸…æ¥šåˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆã€‚ è¿™ç¯‡åšæ–‡ä»£è¡¨äº†æˆ‘è§£é‡Šåç¨‹çš„å°è¯•â€“åŸºæœ¬ä¸Šæ˜¯æˆ‘å¸Œæœ›åœ¨ 48 å°æ—¶ä¹‹å‰ï¼Œå½“æˆ‘åªæƒ³å¼„æ¸…æ¥šè¿™äº›ä¸œè¥¿çš„æ—¶å€™ï¼Œæˆ‘å°±éœ€è¦æœ‰çš„ä¸€ä¸ªæ•™ç¨‹ã€‚ æ•™ç¨‹ ç²—ç•¥åœ°è¯´ï¼Œcoroutines æ˜¯å¯ä»¥äº’ç›¸è°ƒç”¨çš„å‡½æ•°ï¼Œä½†å®ƒä»¬ä¸å…±äº«å †æ ˆï¼Œæ‰€ä»¥å¯ä»¥åœ¨ä»»ä½•æ—¶å€™çµæ´»åœ°æš‚åœæ‰§è¡Œï¼Œè¿›å…¥ä¸€ä¸ªä¸åŒçš„ coroutineã€‚æœ¬ç€çœŸæ­£çš„ C++ ç²¾ç¥ï¼ŒC20 çš„ coroutines è¢«å®ç°ä¸ºä¸€ä¸ªæ¼‚äº®çš„å°å—ï¼ŒåŸ‹è—åœ¨ä¸€å †åƒåœ¾ä¹‹ä¸‹ï¼Œä½ å¿…é¡»æ¶‰è¶³å…¶ä¸­æ‰èƒ½è·å¾—æ¼‚äº®çš„éƒ¨åˆ†ã€‚å¦ç‡åœ°è¯´ï¼Œæˆ‘å¯¹è¿™ç§è®¾è®¡æ„Ÿåˆ°å¤±æœ›ï¼Œå› ä¸ºæœ€è¿‘çš„å…¶ä»–è¯­è¨€å˜åŒ–åšå¾—æ›´æœ‰å“å‘³ï¼Œä½†å¯æƒœå®ƒä»¬ä¸æ˜¯ coroutinesã€‚è¿›ä¸€æ­¥æ··æ·† coroutines çš„äº‹å®æ˜¯ï¼ŒC æ ‡å‡†åº“å®é™…ä¸Šå¹¶æ²¡æœ‰æä¾›ä½ è®¿é—® coroutines æ‰€éœ€çš„è„æ´»ï¼Œæ‰€ä»¥ä½ å®é™…ä¸Šå¿…é¡»å®Œæˆä½ è‡ªå·±çš„è„æ´»ï¼Œç„¶åè¶Šè¿‡å®ƒã€‚æ€»ä¹‹ï¼Œæˆ‘å°½é‡æŠŠä»»ä½•è¿›ä¸€æ­¥çš„ç¼–è¾‘å·¥ä½œç•™åˆ°è¿™ç¯‡åšæ–‡çš„æœ€åã€‚ å¦ä¸€ä¸ªéœ€è¦æ³¨æ„çš„å¤æ‚æƒ…å†µæ˜¯ï¼ŒC++ çš„ç¨‹åºç»å¸¸ä½¿ç”¨æœ¯è¯­ future å’Œ promise æ¥è§£é‡Šï¼Œç”šè‡³æŒ‡å®šã€‚è¿™äº›æœ¯è¯­ä¸ C++ å¤´ä¸­çš„ std::future å’Œ std::promise ç±»å‹æ¯«æ— å…³ç³»ã€‚å…·ä½“æ¥è¯´ï¼Œstd::promise ä¸æ˜¯ coroutine promise å¯¹è±¡çš„ä¸€ä¸ªæœ‰æ•ˆç±»å‹ã€‚åœ¨æˆ‘çš„åšæ–‡ä¸­ï¼Œé™¤äº†è¿™ä¸€æ®µä¹‹å¤–ï¼Œæ²¡æœ‰ä»»ä½•å†…å®¹ä¸ std::future æˆ– std::promise æœ‰å…³ã€‚ è¯´å®Œäº†è¿™äº›ï¼ŒC++20 ç»™æˆ‘ä»¬æä¾›çš„å¥½ä¸œè¥¿æ˜¯ä¸€ä¸ªæ–°çš„æ“ä½œç¬¦ï¼Œå«åš co_awaitã€‚ç²—ç•¥åœ°è¯´ï¼Œè¡¨è¾¾å¼ &quot;co_await a;&quot;åšäº†ä»¥ä¸‹å·¥ä½œã€‚ ç¡®ä¿å½“å‰å‡½æ•°â€“å¿…é¡»æ˜¯ä¸€ä¸ªåç¨‹â€“ä¸­çš„æ‰€æœ‰å±€éƒ¨å˜é‡è¢«ä¿å­˜åˆ°ä¸€ä¸ªå †åˆ†é…çš„å¯¹è±¡ä¸­ã€‚ åˆ›å»ºä¸€ä¸ªå¯è°ƒç”¨çš„å¯¹è±¡ï¼Œå½“å®ƒè¢«è°ƒç”¨æ—¶ï¼Œå°†åœ¨ç´§éš co_await è¡¨è¾¾å¼çš„è¯„ä¼°ä¹‹åæ¢å¤æ‰§è¡Œè¯¥å¾ªç¯ç¨‹åºã€‚ è°ƒç”¨ï¼ˆæˆ–è€…æ›´å‡†ç¡®åœ°è¯´æ˜¯è·³è½¬åˆ°ï¼‰co_await çš„ç›®æ ‡å¯¹è±¡ a çš„ä¸€ä¸ªæ–¹æ³•ï¼Œå°†æ­¥éª¤ 2 ä¸­çš„å¯è°ƒç”¨å¯¹è±¡ä¼ é€’ç»™è¯¥æ–¹æ³•ã€‚ æ³¨æ„ç¬¬ 3 æ­¥ä¸­çš„æ–¹æ³•ï¼Œå½“å®ƒè¿”å›æ—¶ï¼Œå¹¶ä¸æŠŠæ§åˆ¶æƒè¿”å›åˆ° coroutineã€‚åªæœ‰å½“ç¬¬2æ­¥çš„å¯è°ƒç”¨å¯¹è±¡è¢«è°ƒç”¨æ—¶ï¼Œè¯¥å¾ªç¯ç¨‹åºæ‰ä¼šæ¢å¤æ‰§è¡Œã€‚å¦‚æœä½ ä½¿ç”¨äº†ä¸€ç§æ”¯æŒå½“å‰ç»§ç»­çš„è°ƒç”¨çš„è¯­è¨€ï¼Œæˆ–è€…ç©è¿‡ Haskell Cont monadï¼Œé‚£ä¹ˆç¬¬2æ­¥çš„å¯è°ƒç”¨å¯¹è±¡å°±æœ‰ç‚¹åƒä¸€ä¸ª continuationã€‚ ä½¿ç”¨åç¨‹ç¼–è¯‘ä»£ç  ç”±äº C++20 è¿˜æ²¡æœ‰è¢«ç¼–è¯‘å™¨å®Œå…¨æ”¯æŒï¼Œä½ éœ€è¦ç¡®ä¿ä½ çš„ç¼–è¯‘å™¨å®ç°äº† coroutines æ¥ç©å®ƒä»¬ã€‚æˆ‘ä½¿ç”¨çš„æ˜¯ GCC 10.2ï¼Œåªè¦ä½ ç”¨ä¸‹é¢çš„æ ‡å¿—æ¥ç¼–è¯‘ï¼Œå®ƒä¼¼ä¹å°±æ”¯æŒ coroutinesã€‚ 1g++ -fcoroutines -std=c++20 Clang çš„æ”¯æŒå°±æ²¡é‚£ä¹ˆæ·±å…¥äº†ã€‚ä½ éœ€è¦å®‰è£… llvm libc++ï¼Œç„¶åç”¨ä»¥ä¸‹æ–¹å¼ç¼–è¯‘ã€‚ 1clang++ -std=c++20 -stdlib=libc++ -fcoroutines-ts ä¸å¹¸çš„æ˜¯ï¼Œåœ¨ clang ä¸­ï¼Œä½ è¿˜éœ€è¦å°† coroutine å¤´æ–‡ä»¶ä½œä¸º &lt;experimental/coroutine&gt; è€Œä¸æ˜¯ &lt;coroutine&gt;ã€‚æ­¤å¤–ï¼Œä¸€äº›ç±»å‹è¢«å‘½åä¸º std::experimental::xxx è€Œä¸æ˜¯ std::xxxã€‚å› æ­¤ï¼Œåœ¨å†™è¿™ç¯‡æ–‡ç« çš„æ—¶å€™ï¼Œä¸‹é¢çš„ä¾‹å­ä¸èƒ½ç”¨ clang å¼€ç®±ç¼–è¯‘ï¼Œä½†æœ€å¥½èƒ½åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­ç¼–è¯‘ã€‚ å¦‚æœä½ æƒ³ç©ä¸€ç©ï¼Œæœ¬åšæ–‡ä¸­æ‰€æœ‰çš„æ¼”ç¤ºéƒ½å¯ä»¥åœ¨ä¸€ä¸ªæ–‡ä»¶ corodemo.cc ä¸­æ‰¾åˆ°ã€‚ åç¨‹å¤„ç† å¦‚å‰æ‰€è¿°ï¼Œæ–°çš„ co_await æ“ä½œç¬¦ç¡®ä¿å‡½æ•°çš„å½“å‰çŠ¶æ€è¢«æ†ç»‘åœ¨å †çš„æŸä¸ªåœ°æ–¹ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡ï¼Œå…¶è°ƒç”¨ä¼šç»§ç»­æ‰§è¡Œå½“å‰å‡½æ•°ã€‚å¯è°ƒç”¨å¯¹è±¡çš„ç±»å‹æ˜¯ std::coroutine_handle&lt;&gt;ã€‚ Coroutine å¥æŸ„çš„è¡Œä¸ºå¾ˆåƒ C è¯­è¨€çš„æŒ‡é’ˆã€‚å®ƒå¯ä»¥å¾ˆå®¹æ˜“åœ°è¢«å¤åˆ¶ï¼Œä½†å®ƒæ²¡æœ‰ä¸€ä¸ªææ„å™¨æ¥é‡Šæ”¾ä¸è½®è¯¢çŠ¶æ€ç›¸å…³çš„å†…å­˜ã€‚ä¸ºäº†é¿å…æ³„æ¼å†…å­˜ï¼Œä½ é€šå¸¸å¿…é¡»é€šè¿‡è°ƒç”¨ coroutine_handle::destroy æ–¹æ³•æ¥é”€æ¯ coroutine çŠ¶æ€ï¼ˆå°½ç®¡åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œcoroutine å¯ä»¥åœ¨å®Œæˆæ—¶è‡ªæˆ‘é”€æ¯ï¼‰ã€‚å°±åƒCè¯­è¨€çš„æŒ‡é’ˆä¸€æ ·ï¼Œä¸€æ—¦ coroutine å¥æŸ„è¢«é”€æ¯ï¼Œå¼•ç”¨åŒä¸€ coroutine çš„ coroutine å¥æŸ„å°†æŒ‡å‘åƒåœ¾ï¼Œå¹¶åœ¨è°ƒç”¨æ—¶è¡¨ç°å‡ºæœªå®šä¹‰çš„è¡Œä¸ºã€‚ä»å¥½çš„æ–¹é¢çœ‹ï¼Œåç¨‹å¥æŸ„åœ¨åç¨‹çš„æ•´ä¸ªæ‰§è¡Œè¿‡ç¨‹ä¸­éƒ½æ˜¯æœ‰æ•ˆçš„ï¼Œå³ä½¿æ§åˆ¶åœ¨åç¨‹ä¸­å¤šæ¬¡è¿›å‡ºã€‚ ç°åœ¨è®©æˆ‘ä»¬æ›´å…·ä½“åœ°çœ‹çœ‹ co_await åšä»€ä¹ˆã€‚å½“ä½ è¯„ä¼°è¡¨è¾¾å¼ co_await a æ—¶ï¼Œç¼–è¯‘å™¨ä¼šåˆ›å»ºä¸€ä¸ªå¾ªç¯ç¨‹åºå¥æŸ„å¹¶å°†å…¶ä¼ é€’ç»™æ–¹æ³• a.await_suspend(coroutine_handle)ã€‚ ç°åœ¨è®©æˆ‘ä»¬æ¥çœ‹çœ‹ä¸€ä¸ªä½¿ç”¨ co_await çš„å®Œæ•´ç¨‹åºã€‚ç°åœ¨ï¼Œå¿½ç•¥ ReturnObject ç±»å‹â€“å®ƒåªæ˜¯æˆ‘ä»¬ä¸ºè®¿é—® co_await è€Œå¿…é¡»é€šè¿‡çš„åƒåœ¾ä¸­çš„ä¸€éƒ¨åˆ†ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142#include &lt;concepts&gt;#include &lt;coroutine&gt;#include &lt;exception&gt;#include &lt;iostream&gt;struct ReturnObject &#123; struct promise_type &#123; ReturnObject get_return_object() &#123; return &#123;&#125;; &#125; std::suspend_never initial_suspend() &#123; return &#123;&#125;; &#125; std::suspend_never final_suspend() noexcept &#123; return &#123;&#125;; &#125; void unhandled_exception() &#123;&#125; &#125;;&#125;;struct Awaiter &#123; std::coroutine_handle&lt;&gt; *hp_; constexpr bool await_ready() const noexcept &#123; return false; &#125; void await_suspend(std::coroutine_handle&lt;&gt; h) &#123; *hp_ = h; &#125; constexpr void await_resume() const noexcept &#123;&#125;&#125;;ReturnObjectcounter(std::coroutine_handle&lt;&gt; *continuation_out)&#123; Awaiter a&#123;continuation_out&#125;; for (unsigned i = 0;; ++i) &#123; co_await a; std::cout &lt;&lt; \"counter: \" &lt;&lt; i &lt;&lt; std::endl; &#125;&#125;voidmain1()&#123; std::coroutine_handle&lt;&gt; h; counter(&amp;h); for (int i = 0; i &lt; 3; ++i) &#123; std::cout &lt;&lt; \"In main1 function\\n\"; h(); &#125; h.destroy();&#125; Output: In main1 function counter: 0 In main1 function counter: 1 In main1 function counter: 2 è¿™é‡Œçš„ counter æ˜¯ä¸€ä¸ªæ°¸è¿œè®¡æ•°çš„å‡½æ•°ï¼Œé€’å¢å¹¶æ‰“å°ä¸€ä¸ªæ— ç¬¦å·æ•´æ•°ã€‚å°½ç®¡è¿™ä¸ªè®¡ç®—å¾ˆæ„šè ¢ï¼Œä½†è¿™ä¸ªä¾‹å­çš„ç²¾å½©ä¹‹å¤„åœ¨äºï¼Œå³ä½¿æ§åˆ¶æƒåœ¨ counter å’Œè°ƒç”¨å®ƒçš„å‡½æ•° main1 ä¹‹é—´åå¤åˆ‡æ¢ï¼Œå˜é‡ i ä»ç„¶ä¿æŒå…¶å€¼ã€‚ åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªstd::coroutine_handle&lt;&gt;*æ¥è°ƒç”¨counterï¼Œæˆ‘ä»¬æŠŠå®ƒæ’å…¥æˆ‘ä»¬çš„Awaiterç±»å‹ã€‚åœ¨å…¶ await_suspend æ–¹æ³•ä¸­ï¼Œè¯¥ç±»å‹å°† co_await äº§ç”Ÿçš„ coroutine å¥æŸ„å­˜å…¥ main1 çš„ coroutine å¥æŸ„ä¸­ã€‚æ¯æ¬¡ main1 è°ƒç”¨ coroutine å¥æŸ„æ—¶ï¼Œéƒ½ä¼šè§¦å‘ counter ä¸­çš„å¾ªç¯çš„ä¸€æ¬¡è¿­ä»£ï¼Œç„¶ååœ¨ co_await è¯­å¥å¤„å†æ¬¡æš‚åœæ‰§è¡Œã€‚ ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬åœ¨æ¯æ¬¡è°ƒç”¨ await_suspend æ—¶éƒ½ä¼šå­˜å‚¨è¯¥ç¨‹åºçš„å¥æŸ„ï¼Œä½†è¯¥å¥æŸ„åœ¨ä¸åŒçš„è°ƒç”¨ä¸­ä¸ä¼šæ”¹å˜ã€‚(å›é¡¾ä¸€ä¸‹ï¼Œå¥æŸ„å°±åƒä¸€ä¸ªæŒ‡å‘ coroutine çŠ¶æ€çš„æŒ‡é’ˆï¼Œæ‰€ä»¥è™½ç„¶içš„å€¼åœ¨è¿™ä¸ªçŠ¶æ€ä¸‹å¯èƒ½ä¼šæ”¹å˜ï¼Œä½†æŒ‡é’ˆæœ¬èº«ä¿æŒä¸å˜ã€‚) æˆ‘ä»¬ä¹Ÿå¯ä»¥å¾ˆå®¹æ˜“åœ°å†™æˆï¼š 12345678voidAwaiter::await_suspend(std::coroutine_handle&lt;&gt; h)&#123; if (hp_) &#123; *hp_ = h; hp_ = nullptr; &#125;&#125; ä½ ä¼šæ³¨æ„åˆ° Awaiter ä¸Šè¿˜æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼Œå› ä¸ºè¿™äº›æ˜¯è¯­è¨€æ‰€è¦æ±‚çš„ã€‚å¦‚æœå®ƒè¿”å› trueï¼Œé‚£ä¹ˆ co_await å°±ä¸ä¼šä¸­æ­¢è¯¥å‡½æ•°ã€‚å½“ç„¶ï¼Œä½ å¯ä»¥åœ¨ await_suspend ä¸­å®ç°åŒæ ·çš„æ•ˆæœï¼Œé€šè¿‡æ¢å¤ï¼ˆæˆ–ä¸æš‚åœï¼‰å½“å‰çš„ coroutineï¼Œä½†åœ¨è°ƒç”¨ await_suspend ä¹‹å‰ï¼Œç¼–è¯‘å™¨å¿…é¡»å°†æ‰€æœ‰çŠ¶æ€æ†ç»‘åˆ° coroutine å¥æŸ„æ‰€å¼•ç”¨çš„å †å¯¹è±¡ä¸­ï¼Œè¿™å¯èƒ½æ˜¯æ˜‚è´µçš„ã€‚æœ€åï¼Œè¿™é‡Œçš„ await_resume æ–¹æ³•è¿”å› voidï¼Œä½†å¦‚æœå®ƒè¿”å›ä¸€ä¸ªå€¼ï¼Œè¿™ä¸ªå€¼å°†æ˜¯ co_await è¡¨è¾¾å¼çš„å€¼ã€‚ &lt;coroutine&gt; å¤´æä¾›äº†ä¸¤ä¸ªé¢„å®šä¹‰çš„ Awaiterï¼Œstd:: suspend_alwayså’Œstd:: suspend_neverã€‚æ­£å¦‚å®ƒä»¬çš„åå­—æ‰€æš—ç¤ºçš„ï¼Œsuspend_always::await_ready æ€»æ˜¯è¿”å› falseï¼Œè€Œ suspend_never::await_ready æ€»æ˜¯è¿”å› trueã€‚è¿™äº›ç±»ä¸Šçš„å…¶ä»–æ–¹æ³•æ˜¯ç©ºçš„ï¼Œä»€ä¹ˆä¹Ÿä¸åšã€‚ åç¨‹è¿”å›å¯¹è±¡ TBC Promise å¯¹è±¡ TBC co_yield æ“ä½œç¬¦ TBC co_return æ“ä½œç¬¦ TBC å¸¦æ³›å‹çš„ç”Ÿæˆå™¨ç¤ºä¾‹ TBC Editorial TBC","categories":[{"name":"Modern C++","slug":"Modern-C","permalink":"https://blog.inoki.cc/categories/Modern-C/"}],"tags":[{"name":"ç¿»è¯‘","slug":"ç¿»è¯‘","permalink":"https://blog.inoki.cc/tags/ç¿»è¯‘/"},{"name":"ä¸­æ–‡","slug":"ä¸­æ–‡","permalink":"https://blog.inoki.cc/tags/ä¸­æ–‡/"},{"name":"C++","slug":"C","permalink":"https://blog.inoki.cc/tags/C/"}]},{"title":"Linux å†…æ ¸çš„ç”¨æˆ·æ€é©±åŠ¨æ¡†æ¶","slug":"linux-userspace-driver-frameworks","date":"2021-12-14T15:49:00.000Z","updated":"2025-03-08T09:40:48.610Z","comments":true,"path":"2021/12/14/linux-userspace-driver-frameworks/","link":"","permalink":"https://blog.inoki.cc/2021/12/14/linux-userspace-driver-frameworks/","excerpt":"","text":"åœ¨ Linux çš„é©±åŠ¨æ¨¡å‹ä¸­ï¼Œå­˜åœ¨å„ç§é©±åŠ¨å­ç³»ç»Ÿï¼Œå¦‚ PCI å­ç³»ç»Ÿã€ç½‘ç»œå­ç³»ç»Ÿã€‚åœ¨å¼€å‘é©±åŠ¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç›¸åº”çš„å­ç³»ç»Ÿæ¥å®Œæˆï¼Œæ¯”å¦‚æœ‰äººæƒ³å¼€å‘ä¸€ä¸ª PCI ç½‘å¡é©±åŠ¨ï¼Œé‚£å°±å¯ä»¥ç»“åˆä¸Šè¿°çš„ä¸¤ä¸ªå­ç³»ç»Ÿæ¥å®Œæˆã€‚ ä½†æœ‰æ—¶ä¼šæœ‰è®¸å¤šéæ ‡å‡†çš„ç¡¬ä»¶å¹¶ä¸èƒ½ç›´æ¥ä½¿ç”¨è¿™äº›å­ç³»ç»Ÿï¼Œæ¯”å¦‚æ¨¡æ‹Ÿæˆ–æ•°å­— I/Oï¼Œè‡ªå®šä¹‰çš„ FPGA ç¡¬ä»¶ç­‰ã€‚è¿™æ—¶å°±éœ€è¦è¿›è¡Œæ›´åŠ è‰°éš¾çš„å†…æ ¸å¼€å‘ï¼Œå¯¹äºå·¥ä¸šç•Œçš„ç¨‹åºå‘˜æ¥è¯´ï¼Œè¿™ä¸æ˜¯ä¸€ä»¶ç®€å•çš„äº‹ã€‚ ä¼ ç»Ÿçš„é©±åŠ¨å¼€å‘æ¨¡å‹ ä¸€èˆ¬è¿™ç§éæ ‡å‡†çš„ç¡¬ä»¶å¯ä»¥ç”¨å­—ç¬¦è®¾å¤‡å®ç°ï¼Œæ”¾åœ¨ /dev/xyz ä¸­ï¼Œç”¨æˆ·æ€çš„åº”ç”¨ç¨‹åºå¯ä»¥è°ƒç”¨ read å’Œ write æ–¹æ³•æ¥æ§åˆ¶è®¾å¤‡ï¼Œåœ¨æ›´å¤æ‚çš„æƒ…å†µä¸‹ä¹Ÿå¯ä»¥ä½¿ç”¨ ioctl æ¥è®¾ç½®é¢å¤–çš„åŠŸèƒ½ã€‚ åœ¨å®ç°è¿™ä¸ªå­—ç¬¦è®¾å¤‡çš„å†…æ ¸ä¸­çš„éæ ‡å‡†ç¡¬ä»¶çš„é©±åŠ¨æ—¶ï¼Œä¹Ÿè¦ä¼šä½¿ç”¨è®¸å¤šä¸ç¨³å®šçš„å†…æ ¸å†…éƒ¨çš„ APIã€‚å†µä¸”å› ä¸ºæ²¡æœ‰å¯ç”¨çš„å­ç³»ç»Ÿå¯ç”¨ï¼Œé©±åŠ¨ä¼šå˜å¾—å¾ˆå¤§ï¼Œåœ¨ä¹‹åçš„å†…æ ¸ç‰ˆæœ¬ä¹Ÿæ›´åŠ éš¾ä»¥ç»´æŠ¤ã€‚è¿™æ—¶ä½¿ç”¨ç”¨æˆ·æ€çš„ I/O æ¡†æ¶å°±å¯ä»¥æå¤§åœ°ç®€åŒ–é©±åŠ¨å¼€å‘ã€‚ Userspace I/O æ¡†æ¶ Userspace I/Oï¼ˆUIOï¼‰å°±æ˜¯è¿™æ ·ä¸€ä¸ªç”¨æˆ·æ€æ¡†æ¶ï¼Œåœ¨ Linux 2.6.23 ä¸­è¢«å¼•å…¥ã€‚ æ¶æ„ åœ¨ç”¨æˆ·æ€å®ƒå…è®¸ä½¿ç”¨ mmap è¿›è¡Œè®¾å¤‡å†…å­˜åˆ°ç”¨æˆ·æ€å†…å­˜çš„æ˜ å°„ï¼Œä»è€Œå…è®¸åœ¨ç”¨æˆ·æ€ç›´æ¥è¯»å†™è®¾å¤‡å†…å­˜æˆ–å¯„å­˜å™¨ï¼Œå¹¶é€šè¿‡ read è°ƒç”¨æ¥è·å–è®¾å¤‡ä¸­æ–­ï¼ˆé€šå¸¸ä¸­æ–­éƒ½æ˜¯åœ¨å†…æ ¸ä¸­å¤„ç†çš„ï¼Œè€Œ UIO å…è®¸åœ¨ä¸­æ–­å‘ç”Ÿæ—¶é€šè¿‡ read è°ƒç”¨è¿”å›åˆ°ç”¨æˆ·æ€ï¼‰ã€‚ è€Œåœ¨å†…æ ¸ä¸­å¼€å‘è€…éœ€è¦ç½®å…¥ä¸€ä¸ªå°æ¨¡å—ï¼Œç”¨æ¥æ¢æµ‹ï¼ˆprobeï¼‰è®¾å¤‡å’Œæ³¨å†Œ UIOï¼Œæ³¨å†Œåè®¾å¤‡ä¼šå‡ºç°åœ¨ /dev/uioXã€å¹¶åœ¨ sysfs ä¸­å¯¼å‡ºè®¾å¤‡åç§°ã€å±æ€§ç­‰ä¿¡æ¯ã€‚ æ³¨æ„ï¼šè¿™é‡ŒåŒæ ·å¯ä»¥ä½¿ç”¨ select ç³»ç»Ÿè°ƒç”¨ã€æ¥åœ¨æ²¡æœ‰ä¸­æ–­çš„æ—¶å€™é˜²æ­¢ä»»åŠ¡ç©ºè½¬ã€‚ æºç  ç›¸å…³çš„å£°æ˜å’Œç»“æ„ä½“ä½äº include/linux/uio_driver.h ä¸­ï¼Œå…¶ä¸­æœ€é‡è¦çš„ç»“æ„ä¸º uio_infoï¼š 123456789101112131415struct uio_info &#123; struct uio_device *uio_dev; const char *name; const char *version; struct uio_mem mem[MAX_UIO_MAPS]; struct uio_port port[MAX_UIO_PORT_REGIONS]; long irq; unsigned long irq_flags; void *priv; irqreturn_t (*handler)(int irq, struct uio_info *dev_info); int (*mmap)(struct uio_info *info, struct vm_area_struct *vma); int (*open)(struct uio_info *info, struct inode *inode); int (*release)(struct uio_info *info, struct inode *inode); int (*irqcontrol)(struct uio_info *info, s32 irq_on);&#125;; åœ¨æ¨¡å—æ¢æµ‹æ—¶åˆ›å»ºä¸€ä¸ªæ–°çš„ç»“æ„ä½“ï¼Œè®¾ç½® name, version, ä¸­æ–­å·ï¼ˆIRQï¼‰ã€ä¸­æ–­å¤„ç†å›è°ƒï¼ˆhandlerï¼‰ç­‰ã€‚å¹¶ä½¿ç”¨ register_device(struct device *parent, struct uio_info *info) æ³¨å†Œè®¾å¤‡ã€‚è¿™ä¸ªå‡½æ•°ä¼šåˆ›å»ºä¸€ä¸ª uio_dev å¡«å……åˆ°è¿™ä¸ªç»“æ„ä½“å†…ï¼Œå®ƒçš„å£°æ˜å¦‚ä¸‹ï¼š 1234567891011struct uio_device &#123; struct module *owner; struct device *dev; int minor; atomic_t event; struct fasync_struct *async_queue; wait_queue_head_t wait; struct uio_info *info; struct kobject *map_dir; struct kobject *portio_dir;&#125;; å¯¹äºéœ€è¦æ˜ å°„çš„å†…å­˜åŒºåŸŸï¼Œåˆ™éœ€è¦å¡«å…… mem è¿™ä¸ªæˆå‘˜ï¼Œæœ€å¤šå¯ä»¥æ˜ å°„ MAX_UIO_MAPS ä¸ªï¼ˆåœ¨ 4.3 ç‰ˆæœ¬çš„å†…æ ¸ä¸­æ˜¯ 5 ä¸ªã€‚UIO å†…å­˜åŒºåŸŸçš„ç»“æ„ä½“å¦‚ä¸‹ï¼š 12345678struct uio_mem &#123; const char *name; phys_addr_t addr; resource_size_t size; int memtype; void __iomem *internal_addr; struct uio_map *map;&#125;; è€Œä½¿ç”¨è¿™ä¸ªå‡½æ•°å¯ä»¥ç”Ÿæˆä¸€ä¸ª UIO çš„ä¸­æ–­äº‹ä»¶ï¼š 1extern void uio_event_notify(struct uio_info *info); å…¶ä½™çš„ç»“æ„ä½“å’Œå£°æ˜éƒ½å¯ä»¥åœ¨å¤´æ–‡ä»¶ä¸­æ‰¾åˆ°ï¼š 1234struct uio_map;struct uio_port;struct uio_portio;extern void uio_unregister_device(struct uio_info *info); æ›´å¤šç»†èŠ‚å¯ä»¥æŸ¥çœ‹æ–‡æ¡£æˆ–æºç ã€‚ æ€§èƒ½ åœ¨ä½¿ç”¨å†…æ ¸æ€è®¾å¤‡çš„æ—¶å€™ï¼Œä½¿ç”¨ ioctl è¿›è¡Œè®¾å¤‡æ§åˆ¶å¹¶ä¸æ˜¯ç›´æ¥çš„ï¼Œè¿™ä¸ªç³»ç»Ÿè°ƒç”¨ä¼šä½¿ç”¨è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼ˆVFSï¼‰åˆ†å‘ç”¨æˆ·ä¼ æ¥çš„æ§åˆ¶å€¼åˆ°è®¾å¤‡ï¼Œå¦‚æœæœ‰è¿”å›å€¼ï¼Œä¹Ÿä¼šé€å±‚ä¼ å›ã€‚è€Œ UIO ä¸­è¿™æ ·çš„æ“ä½œæ˜¯é€šè¿‡ mmap æ˜ å°„è®¾å¤‡å†…å­˜æ¥å®ç°çš„ï¼Œå› æ­¤è¯»å†™å¯„å­˜å™¨æ¥æ§åˆ¶è®¾å¤‡æ˜¯ç›´æ¥å†™å…¥è®¾å¤‡çš„ï¼Œä»£ç å®ç°å°±æ˜¯è®¿é—®ä¸€ä¸ªæ™®é€šçš„æ•°ç»„ï¼Œè¿™è®© UIO å¯¹åº”çš„ç”¨æˆ·æ€é©±åŠ¨æ›´å¿«ã€ä¸”æ›´æ˜“è¯»ã€‚ è€Œä¸­æ–­æ–¹é¢ï¼Œæ–‡ç« [1]æµ‹è¯•äº† uio_event_notify è¢«è°ƒç”¨åˆ°è¯»å– UIO è®¾å¤‡è¿”å›çš„æ—¶é—´åœ¨ 16 åˆ° 32 æ¯«ç§’å·¦å³ï¼ŒARM11 è®¾å¤‡ä¸Šä½¿ç”¨ 90% çš„ CPU å ç”¨èƒ½å¤Ÿå®Œæˆæ¯ç§’ 1000 æ¬¡çš„ä¸­æ–­ï¼Œè¿™åœ¨å¸¦æœ‰å®æ—¶é™åˆ¶çš„åµŒå…¥å¼è®¾å¤‡ä¸­ä¹Ÿæ˜¯å¯æ¥å—çš„ã€‚ æ€»ç»“ ä½¿ç”¨ UIO æ¡†æ¶å†™å…¥çš„å†…æ ¸éƒ¨åˆ†çš„é©±åŠ¨å¯ä»¥éå¸¸å°å’Œå®¹æ˜“ç»´æŠ¤ï¼Œå› æ­¤æƒ³åœ¨ä¸»çº¿å†…æ ¸ä¸­å®¡é˜…å’ŒåŒ…å«è¿™ä¸ªé©±åŠ¨ä¸æ˜¯å¾ˆéš¾çš„äº‹æƒ…ã€‚è€Œ UIO ä¼šé¿å…ç”¨æˆ·æ€å»æ˜ å°„ä¸å±äºè¿™ä¸ªè®¾å¤‡çš„å†…å­˜ï¼Œå› æ­¤ä¹Ÿæ˜¯ç›¸å½“å®‰å…¨çš„ã€‚ VFIO TBC å‚è€ƒ Userspace I/O drivers in a realtime context, https://www.osadl.org/fileadmin/dam/rtlws/12/Koch.pdf","categories":[{"name":"Linux","slug":"Linux","permalink":"https://blog.inoki.cc/categories/Linux/"},{"name":"Driver","slug":"Linux/Driver","permalink":"https://blog.inoki.cc/categories/Linux/Driver/"}],"tags":[{"name":"ä¸­æ–‡","slug":"ä¸­æ–‡","permalink":"https://blog.inoki.cc/tags/ä¸­æ–‡/"},{"name":"Linux","slug":"Linux","permalink":"https://blog.inoki.cc/tags/Linux/"},{"name":"é©±åŠ¨","slug":"é©±åŠ¨","permalink":"https://blog.inoki.cc/tags/é©±åŠ¨/"}]},{"title":"EFI å¯åŠ¨é¡¹ç®¡ç†å™¨â€”â€”åŒç³»ç»Ÿå¯åŠ¨ç¥å™¨ï¼Œå®‰å…¨è§£å†³ä½ çš„å¤šç³»ç»Ÿå¯åŠ¨éš¾é¢˜","slug":"Inoki-qefi-entry-manager","date":"2021-12-09T20:34:00.000Z","updated":"2025-03-08T09:40:48.568Z","comments":true,"path":"2021/12/09/Inoki-qefi-entry-manager/","link":"","permalink":"https://blog.inoki.cc/2021/12/09/Inoki-qefi-entry-manager/","excerpt":"","text":"ä½ æ˜¯å¦é‡åˆ°è¿‡è¿™æ ·çš„é—®é¢˜ï¼Ÿåœ¨ç”µè„‘ä¸Šå®‰è£…å¤šä¸ªç³»ç»Ÿï¼šåœ¨å®‰è£…å¥½ FreeBSD åï¼Œå‘ç° Windows å¯åŠ¨ä¸è§äº†ï¼›åœ¨å®‰è£…å¥½ Windows åï¼Œå‘ç°å¯åŠ¨ Linux ç”¨çš„ Grub å¯åŠ¨ä¸è§äº†ã€‚è™½ç„¶ç”¨ refind è¿™ç§å¯åŠ¨å™¨å¯ä»¥éƒ¨åˆ†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†æœ‰æ—¶å€™ Windows æ›´æ–°ä¹‹åä¸€çœ‹ï¼Œrefind å¯åŠ¨ä¹Ÿä¸è§äº†ã€‚è¿™æ—¶ï¼Œè¿æ°”å¥½çš„è¯è¿˜å¯ä»¥åœ¨ EFI å›ºä»¶è®¾ç½®ä¸­æ”¹å˜å¯åŠ¨é¡ºåºæ‰¾å›ï¼Œæœ‰äº›ä¸æ”¯æŒçš„ä¸»æ¿å°±åªèƒ½é‡å»ºå¼•å¯¼å•¦ã€‚æ›´ä½•å†µï¼Œå¼€æœºè¿›å…¥ EFI å›ºä»¶è¦æŒ‰çš„æŒ‰é”®å’Œæ—¶æœºä¹Ÿå¾ˆéº»çƒ¦ã€‚ è¿™æ—¶å°±å¯ä»¥ä½¿ç”¨æˆ‘å¼€å‘çš„ä¸€ä¸ªè·¨ Windows å’Œ Linux å¹³å°çš„ç³»ç»Ÿè½¯ä»¶ EFI Entry Manager è§£å†³ã€‚ å®‰è£… è¿™ä¸ªè½¯ä»¶æ˜¯é€šè¿‡ GPL 3.0 å‘å¸ƒçš„å¼€æºè½¯ä»¶ï¼Œå¯ä»¥åœ¨æˆ‘çš„ GitHub ä¸Šæ‰¾åˆ°ï¼šé¡¹ç›®é“¾æ¥ã€‚ åœ¨ Release ä¸­å¯ä»¥æ‰¾åˆ°é¢„å…ˆæ„å»ºå¥½çš„ Linux AppImage å’Œ Windows çš„å¯æ‰§è¡Œç¨‹åºå‹ç¼©åŒ…ï¼Œä¸‹è½½ä¹‹åè§£å‹ç¼©å³å¯ã€‚ Linux ç‰ˆæœ¬ä¼šæœ‰ä¸€ä¸ª AppImage æ‹“å±•åçš„æ–‡ä»¶ï¼Œè€Œ Windows ç‰ˆæœ¬åˆ™éœ€è¦æ”¾å…¥ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­ã€‚ é™¤æ­¤ä¹‹å¤–ï¼ŒWindows ç‰ˆæœ¬è¿˜å¯èƒ½éœ€è¦å®‰è£…ä¸€ä¸ª VC çš„è¿è¡Œæ—¶åº“ï¼Œç‚¹å‡»è¿™ä¸ªé“¾æ¥ï¼Œé€‰æ‹© x64 ç‰ˆæœ¬ä¸‹è½½å¹¶å®‰è£…å³å¯ã€‚ ä½¿ç”¨ åœ¨ Linux ä¸­ï¼Œéœ€è¦ä½¿ç”¨ root ç”¨æˆ·å¯åŠ¨ï¼Œæ¯”å¦‚ sudo ./&lt;executable&gt;ã€‚è€Œåœ¨ Windows ä¸­ï¼Œéœ€è¦å³é”®ä½¿ç”¨ç®¡ç†å‘˜æ¨¡å¼æ‰“å¼€ã€‚ æ‰“å¼€ä¹‹åï¼Œé¦–å±æ˜¾ç¤ºçš„æ˜¯ä½ çš„ç”µè„‘å½“å‰çš„å¯åŠ¨é¡ºåºã€‚ ç”¨æˆ·å¯ä»¥é€‰ä¸­ä¸€ä¸ªå¯åŠ¨é¡¹ï¼Œç‚¹å‡» Move up æˆ– Move down æ¥æ”¹å˜å¯åŠ¨é¡ºåºï¼Œæœ€åç‚¹å‡» Save æ¥ä¿å­˜ã€‚ åœ¨ç¬¬äºŒä¸ªæ ‡ç­¾é¡µä¸­å¯ä»¥è®¾ç½®ä¸‹æ¬¡å•æ¬¡é‡å¯æ—¶ä½¿ç”¨çš„å¯åŠ¨é¡¹ã€‚ ä¿å­˜ä¹‹åå¯ä»¥é€‰æ‹©æ˜¯å¦ç«‹å³é‡å¯ï¼Œæ— è®ºé€‰æ‹©æ˜¯ä¸å¦ï¼Œåœ¨ä¸‹æ¬¡å¯åŠ¨æ—¶éƒ½ä¼šé¦–å…ˆå°è¯•ä½¿ç”¨ç”¨æˆ·ä¿å­˜çš„å¯åŠ¨é¡¹å¯åŠ¨ã€‚ åŸç†è§£æ è¿™ä¸ªé¡¹ç›®æ˜¯åŸºäºæˆ‘çš„å¦ä¸€ä¸ªé¡¹ç›® qefivar çš„ï¼Œå®ƒæ˜¯ä¸€ä¸ªè·¨å¹³å°çš„åº“ï¼Œå¯ä»¥é€šè¿‡ç³»ç»Ÿ API ä¿®æ”¹ EFI å›ºä»¶çš„å˜é‡æ¥æ”¹å˜å¯åŠ¨é¡ºåºç­‰ã€‚ åœ¨åŒä¸ªç¡¬ç›˜å®‰è£…ç¬¬äºŒä¸ªç³»ç»Ÿåï¼Œå¾€å¾€åŸæœ¬ç³»ç»Ÿçš„å¯åŠ¨é¡¹ä¼šè¢«è¦†ç›–ã€‚ä½†å…¶å®åªæ˜¯ ESP åˆ†åŒºçš„ Boot/Boot\\&lt;arch\\&gt;.efi è¿™ä¸ªé»˜è®¤å¯åŠ¨é¡¹è¢«è¦†ç›–äº†ï¼Œå®é™…çš„å¯åŠ¨åŠ è½½å™¨çš„ efi æ–‡ä»¶å…¶å®éƒ½è¿˜åœ¨ï¼Œå¹¶ä¸”åœ¨ EFI firmware é…å¤‡çš„ nvram ä¸­æœ‰å…¥å£ã€‚è¿™æ—¶å®é™…ä¸Šåªéœ€è¦é…ç½®ä¸€ä¸‹å³å¯ã€‚ æ¯”å¦‚æˆ‘å®‰è£…äº† win ä¹‹ååˆè£…äº† FreeBSDï¼Œè¿™æ—¶é»˜è®¤å¯åŠ¨é¡¹å°±è¢« FreeBSD å†™æˆäº†å®ƒçš„ï¼Œæ²¡åŠæ³•åŠ è½½ winã€‚æˆ‘å°±ä½¿ç”¨ EFI Entry Manager æŠŠå¯åŠ¨é¡ºåºæ”¹æˆ win-&gt;FreeBSD-&gt;Ventoy å³å¯ï¼Œç„¶åæ¯æ¬¡æƒ³è¿› FreeBSD åªéœ€è¦åœ¨è¿›å…¥ win ä¹‹åä½¿ç”¨ QEFI Entry Manager è®¾ç½®ä¸‹æ¬¡å•æ¬¡ç”¨ FreeBSD çš„åŠ è½½å™¨å¯åŠ¨ï¼Œç„¶åé‡å¯å³å¯ã€‚ ç»“è®º è¿™ç¯‡æ–‡ç« ä»‹ç»äº†æˆ‘å…­ä¸ªæœˆå‰çš„å·¥ä½œï¼Œå¦‚æœå¸®åˆ°ä½ çš„è¯å¯ä»¥ç»™ä¸ª starï¼Œæˆ–è€…é€šè¿‡å„ç§å¹³å°è¯·æˆ‘å–ä¸€æ¯å’–å•¡å§~","categories":[{"name":"Inoki Home Made","slug":"Inoki-Home-Made","permalink":"https://blog.inoki.cc/categories/Inoki-Home-Made/"},{"name":"Qt","slug":"Inoki-Home-Made/Qt","permalink":"https://blog.inoki.cc/categories/Inoki-Home-Made/Qt/"},{"name":"EFI","slug":"Inoki-Home-Made/Qt/EFI","permalink":"https://blog.inoki.cc/categories/Inoki-Home-Made/Qt/EFI/"}],"tags":[{"name":"ä¸­æ–‡","slug":"ä¸­æ–‡","permalink":"https://blog.inoki.cc/tags/ä¸­æ–‡/"},{"name":"Qt","slug":"Qt","permalink":"https://blog.inoki.cc/tags/Qt/"},{"name":"EFI","slug":"EFI","permalink":"https://blog.inoki.cc/tags/EFI/"}]},{"title":"ã€è¯‘ã€‘Linux å†…æ ¸çš„ VFIO - â€œVirtual Function I/Oâ€","slug":"vfio","date":"2021-12-08T20:34:00.000Z","updated":"2025-03-08T09:40:48.611Z","comments":true,"path":"2021/12/08/vfio/","link":"","permalink":"https://blog.inoki.cc/2021/12/08/vfio/","excerpt":"","text":"åŸæ–‡é“¾æ¥ï¼šVFIO - â€œVirtual Function I/Oâ€ è®¸å¤šç°ä»£ç³»ç»Ÿç°åœ¨æä¾› DMA å’Œä¸­æ–­é‡æ˜ å°„è®¾æ–½ï¼Œä»¥å¸®åŠ©ç¡®ä¿ I/O è®¾å¤‡åœ¨å®ƒä»¬è¢«åˆ†é…çš„è¾¹ç•Œå†…è¡Œäº‹ã€‚è¿™åŒ…æ‹¬å¸¦æœ‰ AMD-Vi å’Œ Intel VT-d çš„ x86 ç¡¬ä»¶ï¼Œå¸¦æœ‰å¯åˆ†åŒºç»ˆç«¯ï¼ˆPEï¼‰çš„ POWER ç³»ç»Ÿå’ŒåµŒå…¥å¼ PowerPC ç³»ç»Ÿï¼Œå¦‚ Freescale PAMUã€‚VFIO é©±åŠ¨æ˜¯ä¸€ä¸ª IOMMU/è®¾å¤‡æ— å…³çš„æ¡†æ¶ï¼Œåœ¨ä¸€ä¸ªå®‰å…¨çš„ã€å— IOMMU ä¿æŠ¤çš„ç¯å¢ƒä¸­ï¼Œå°†è®¾å¤‡è®¿é—®ç›´æ¥æš´éœ²ç»™ç”¨æˆ·ç©ºé—´ã€‚æ¢å¥è¯è¯´ï¼Œè¿™å…è®¸å®‰å…¨çš„[2]ã€éç‰¹æƒçš„ç”¨æˆ·ç©ºé—´é©±åŠ¨ç¨‹åºã€‚ æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦è¿™æ ·åšï¼Ÿå½“é…ç½®ä¸ºæœ€é«˜çš„ I/O æ€§èƒ½æ—¶ï¼Œè™šæ‹Ÿæœºç»å¸¸åˆ©ç”¨ç›´æ¥è®¾å¤‡è®¿é—®ï¼ˆâ€œè®¾å¤‡åˆ†é…â€ï¼‰ã€‚ä»è®¾å¤‡å’Œä¸»æœºçš„è§’åº¦æ¥çœ‹ï¼Œè¿™åªæ˜¯æŠŠè™šæ‹Ÿæœºå˜æˆäº†ä¸€ä¸ªç”¨æˆ·ç©ºé—´é©±åŠ¨ç¨‹åºï¼Œå…¶å¥½å¤„æ˜¯å¤§å¤§é™ä½äº†å»¶è¿Ÿï¼Œæé«˜äº†å¸¦å®½ï¼Œå¹¶ç›´æ¥ä½¿ç”¨è£¸æœºè®¾å¤‡é©±åŠ¨ç¨‹åº[3]ã€‚ ä¸€äº›åº”ç”¨ï¼Œç‰¹åˆ«æ˜¯åœ¨é«˜æ€§èƒ½è®¡ç®—é¢†åŸŸï¼Œä¹Ÿä»ç”¨æˆ·ç©ºé—´çš„ä½å¼€é”€ã€ç›´æ¥è®¾å¤‡è®¿é—®ä¸­å—ç›Šã€‚ä¾‹å¦‚ï¼Œç½‘ç»œé€‚é…å™¨ï¼ˆé€šå¸¸æ˜¯åŸºäºé TCP/IPï¼‰å’Œè®¡ç®—åŠ é€Ÿå™¨ã€‚åœ¨ VFIO ä¹‹å‰ï¼Œè¿™äº›é©±åŠ¨å¿…é¡»ç»è¿‡å®Œæ•´çš„å¼€å‘å‘¨æœŸæ‰èƒ½æˆä¸ºåˆé€‚çš„ä¸Šæ¸¸é©±åŠ¨ï¼Œæˆ–è€…åœ¨ä»£ç æ ‘å¤–è¿›è¡Œç»´æŠ¤ï¼Œæˆ–è€…ä½¿ç”¨ UIO æ¡†æ¶ï¼Œå®ƒæ²¡æœ‰ IOMMU ä¿æŠ¤çš„æ¦‚å¿µï¼Œä¸­æ–­æ”¯æŒæœ‰é™ï¼Œå¹¶ä¸”éœ€è¦ root æƒé™æ¥è®¿é—® PCI é…ç½®ç©ºé—´ç­‰ä¸œè¥¿ã€‚ VFIO é©±åŠ¨æ¡†æ¶æ‰“ç®—å°†è¿™äº›ç»Ÿä¸€èµ·æ¥ï¼Œå–ä»£ KVM çš„ PCI ç‰¹å®šè®¾å¤‡åˆ†é…ä»£ç ï¼Œå¹¶æä¾›ä¸€ä¸ªæ¯” UIO æ›´å®‰å…¨ã€æ›´æœ‰ç‰¹è‰²çš„ç”¨æˆ·ç©ºé—´é©±åŠ¨ç¯å¢ƒã€‚ ç»„ã€è®¾å¤‡å’Œ IOMMU è®¾å¤‡æ˜¯ä»»ä½• I/O é©±åŠ¨çš„ä¸»è¦ç›®æ ‡ã€‚è®¾å¤‡é€šå¸¸åˆ›å»ºä¸€ä¸ªç”± I/O è®¿é—®ã€ä¸­æ–­å’Œ DMA ç»„æˆçš„ç¼–ç¨‹æ¥å£ã€‚åœ¨ä¸æ·±å…¥äº†è§£è¿™äº›ç»†èŠ‚çš„æƒ…å†µä¸‹ï¼ŒDMA æ˜¯è¿„ä»Šä¸ºæ­¢ç»´æŠ¤å®‰å…¨ç¯å¢ƒçš„æœ€å…³é”®çš„æ–¹é¢ï¼Œå› ä¸ºå…è®¸è®¾å¤‡å¯¹ç³»ç»Ÿå†…å­˜è¿›è¡Œè¯»å†™è®¿é—®ä¼šç»™æ•´ä¸ªç³»ç»Ÿçš„å®Œæ•´æ€§å¸¦æ¥æœ€å¤§çš„é£é™©ã€‚ ä¸ºäº†å¸®åŠ©å‡è½»è¿™ç§é£é™©ï¼Œè®¸å¤šç°ä»£çš„ IOMMU ç°åœ¨å°†éš”ç¦»å±æ€§çº³å…¥äº†ä¸€ä¸ªåœ¨è®¸å¤šæƒ…å†µä¸‹åªç”¨äºè½¬æ¢çš„æ¥å£ï¼ˆå³è§£å†³å…·æœ‰æœ‰é™åœ°å€ç©ºé—´çš„è®¾å¤‡çš„å¯»å€é—®é¢˜ï¼‰ã€‚æœ‰äº†è¿™ä¸ªï¼Œè®¾å¤‡ç°åœ¨å¯ä»¥ç›¸äº’éš”ç¦»ï¼Œå¹¶ä¸ä»»æ„çš„å†…å­˜è®¿é—®éš”ç¦»ï¼Œä»è€Œå…è®¸åƒå®‰å…¨åœ°ç›´æ¥å°†è®¾å¤‡åˆ†é…åˆ°è™šæ‹Ÿæœºä¸­ã€‚ ä¸è¿‡ï¼Œè¿™ç§éš”ç¦»å¹¶ä¸æ€»æ˜¯åœ¨å•ä¸ªè®¾å¤‡çš„é¢—ç²’åº¦ä¸Šã€‚å³ä½¿ IOMMU èƒ½å¤Ÿåšåˆ°è¿™ä¸€ç‚¹ï¼Œè®¾å¤‡ã€äº’è¿å’Œ IOMMU çš„æ‹“æ‰‘ç»“æ„çš„å±æ€§ä¹Ÿä¼šå‡å°‘è¿™ç§éš”ç¦»ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªå•ç‹¬çš„è®¾å¤‡å¯èƒ½æ˜¯ä¸€ä¸ªæ›´å¤§çš„å¤šåŠŸèƒ½åŒ…è£…çš„ä¸€éƒ¨åˆ†ã€‚è™½ç„¶ IOMMU å¯èƒ½èƒ½å¤ŸåŒºåˆ†åŒ…è£…å†…éƒ¨çš„è®¾å¤‡ï¼Œä½†åŒ…è£…å¯èƒ½ä¸è¦æ±‚è®¾å¤‡ä¹‹é—´çš„äº‹ä»¶åˆ°è¾¾ IOMMUã€‚è¿™æ–¹é¢çš„ä¾‹å­å¯èƒ½æ˜¯ä»»ä½•ä¸œè¥¿ï¼Œä»ä¸€ä¸ªå¤šåŠŸèƒ½çš„ PCI è®¾å¤‡ï¼Œåœ¨åŠŸèƒ½ä¹‹é—´æœ‰åé—¨ï¼Œåˆ°ä¸€ä¸ªéPCI-ACSï¼ˆè®¿é—®æ§åˆ¶æœåŠ¡ï¼‰èƒ½åŠ›çš„æ¡¥æ¢ï¼Œå…è®¸é‡å®šå‘è€Œä¸åˆ°è¾¾ IOMMUã€‚åœ¨éšè—è®¾å¤‡æ–¹é¢ï¼Œæ‹“æ‰‘ç»“æ„ä¹Ÿå¯ä»¥èµ·åˆ°ä¸€å®šçš„ä½œç”¨ã€‚ä¸€ä¸ª PCI-to-PCI ç½‘æ¡¥æ©ç›–äº†å®ƒåé¢çš„è®¾å¤‡ï¼Œä½¿äº‹ä»¶çœ‹èµ·æ¥åƒæ˜¯æ¥è‡ªç½‘æ¡¥æœ¬èº«ã€‚æ˜¾ç„¶ï¼ŒIOMMU çš„è®¾è®¡ä¹Ÿæ˜¯ä¸€ä¸ªä¸»è¦å› ç´ ã€‚ å› æ­¤ï¼Œè™½ç„¶åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒIOMMU å¯èƒ½æœ‰è®¾å¤‡çº§åˆ«çš„é¢—ç²’åº¦ï¼Œä½†ä»»ä½•ç³»ç»Ÿéƒ½å®¹æ˜“å—åˆ°é¢—ç²’åº¦é™ä½çš„å½±å“ã€‚å› æ­¤ï¼ŒIOMMU API æ”¯æŒ IOMMU ç»„çš„æ¦‚å¿µã€‚ä¸€ä¸ªç»„æ˜¯ä¸€ç»„è®¾å¤‡ï¼Œå¯ä¸ç³»ç»Ÿä¸­æ‰€æœ‰å…¶ä»–è®¾å¤‡éš”ç¦»ã€‚å› æ­¤ï¼Œç»„æ˜¯ VFIO ä½¿ç”¨çš„æ‰€æœ‰æƒå•ä½ã€‚ è™½ç„¶ç»„æ˜¯ä¸ºç¡®ä¿ç”¨æˆ·å®‰å…¨è®¿é—®è€Œå¿…é¡»ä½¿ç”¨çš„æœ€å°ç²’åº¦ï¼Œä½†å®ƒä¸ä¸€å®šæ˜¯é¦–é€‰ç²’åº¦ã€‚åœ¨ä½¿ç”¨é¡µè¡¨çš„ IOMMU ä¸­ï¼Œæœ‰å¯èƒ½åœ¨ä¸åŒçš„ç»„ä¹‹é—´å…±äº«ä¸€ç»„é¡µè¡¨ï¼Œä»è€Œå‡å°‘å¯¹å¹³å°ï¼ˆå‡å°‘ TLB æ¿€åŠ¨ï¼Œå‡å°‘é‡å¤çš„é¡µè¡¨ï¼‰å’Œç”¨æˆ·ï¼ˆåªç¼–ç¨‹ä¸€ç»„ç¿»è¯‘ï¼‰çš„å¼€é”€ã€‚å‡ºäºè¿™ä¸ªåŸå› ï¼ŒVFIOä½¿ç”¨äº†ä¸€ä¸ªå®¹å™¨ç±»ï¼Œå®ƒå¯ä»¥å®¹çº³ä¸€ä¸ªæˆ–å¤šä¸ªç»„ã€‚é€šè¿‡ç®€å•åœ°æ‰“å¼€ /dev/vfio/vfio å­—ç¬¦è®¾å¤‡æ¥åˆ›å»ºä¸€ä¸ªå®¹å™¨ã€‚ å°±å…¶æœ¬èº«è€Œè¨€ï¼Œå®¹å™¨æä¾›çš„åŠŸèƒ½å¾ˆå°‘ï¼Œé™¤äº†å‡ ä¸ªç‰ˆæœ¬å’Œæ‰©å±•æŸ¥è¯¢æ¥å£å¤–ï¼Œå…¶ä»–çš„éƒ½è¢«é”å®šäº†ã€‚ç”¨æˆ·éœ€è¦åœ¨å®¹å™¨ä¸­æ·»åŠ ä¸€ä¸ªç»„ï¼Œä»¥è·å¾—ä¸‹ä¸€çº§çš„åŠŸèƒ½ã€‚è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œç”¨æˆ·é¦–å…ˆéœ€è¦ç¡®å®šä¸æ‰€éœ€è®¾å¤‡ç›¸å…³çš„ç»„ã€‚è¿™å¯ä»¥é€šè¿‡ä¸‹é¢çš„ä¾‹å­ä¸­æè¿°çš„ sysfs é“¾æ¥æ¥å®Œæˆã€‚é€šè¿‡å°†è®¾å¤‡ä»ä¸»æœºé©±åŠ¨ä¸Šè§£é™¤ç»‘å®šå¹¶å°†å…¶ç»‘å®šåˆ° VFIO é©±åŠ¨ä¸Šï¼Œä¸€ä¸ªæ–°çš„ VFIO ç»„å°†ä»¥ /dev/vfio/$GROUP çš„å½¢å¼å‡ºç°ï¼Œå…¶ä¸­ $GROUP æ˜¯è®¾å¤‡æ‰€å±çš„ IOMMU ç»„å·ã€‚å¦‚æœ IOMMU ç»„åŒ…å«å¤šä¸ªè®¾å¤‡ï¼Œåœ¨å…è®¸å¯¹ VFIO ç»„è¿›è¡Œæ“ä½œä¹‹å‰ï¼Œæ¯ä¸ªè®¾å¤‡éƒ½éœ€è¦è¢«ç»‘å®šåˆ°ä¸€ä¸ª VFIO é©±åŠ¨ä¸Šï¼ˆå¦‚æœ VFIO é©±åŠ¨ä¸å¯ç”¨ï¼Œåªå°†è®¾å¤‡ä»ä¸»æœºé©±åŠ¨ä¸Šè§£é™¤ç»‘å®šä¹Ÿæ˜¯è¶³å¤Ÿçš„ï¼›è¿™å°†ä½¿ç»„å¯ç”¨ï¼Œä½†ä¸æ˜¯é‚£ä¸ªç‰¹å®šè®¾å¤‡ï¼‰ã€‚TBD - ç”¨äºç¦ç”¨é©±åŠ¨ç¨‹åºæ¢æµ‹/é”å®šè®¾å¤‡çš„æ¥å£ã€‚ ä¸€æ—¦ç»„å‡†å¤‡å¥½äº†ï¼Œå¯ä»¥é€šè¿‡æ‰“å¼€ VFIO ç»„å­—ç¬¦è®¾å¤‡ï¼ˆ/dev/vfio/$GROUPï¼‰å¹¶ä½¿ç”¨ VFIO_GROUP_SET_CONTAINER çš„ ioctlï¼Œä¼ é€’å…ˆå‰æ‰“å¼€çš„å®¹å™¨æ–‡ä»¶çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå°†å…¶åŠ å…¥åˆ°å®¹å™¨ä¸­ã€‚å¦‚æœéœ€è¦ï¼Œå¹¶ä¸” IOMMU é©±åŠ¨æ”¯æŒåœ¨ç»„ä¹‹é—´å…±äº« IOMMU ä¸Šä¸‹æ–‡ï¼Œå¤šä¸ªç»„å¯ä»¥è¢«è®¾ç½®åˆ°åŒä¸€ä¸ªå®¹å™¨ä¸­ã€‚å¦‚æœä¸€ä¸ªç»„ä¸èƒ½è¢«è®¾ç½®åˆ°æœ‰ç°æœ‰ç»„çš„å®¹å™¨ä¸­ï¼Œå°±éœ€è¦ä½¿ç”¨ä¸€ä¸ªæ–°çš„ç©ºå®¹å™¨æ¥ä»£æ›¿ã€‚ å½“ä¸€ä¸ªç»„ï¼ˆæˆ–å¤šä¸ªç»„ï¼‰è¿æ¥åˆ°ä¸€ä¸ªå®¹å™¨æ—¶ï¼Œå…¶ä½™çš„ ioctls å˜å¾—å¯ç”¨ï¼Œä»è€Œèƒ½å¤Ÿè®¿é—® VFIO IOMMU æ¥å£ã€‚æ­¤å¤–ï¼Œç°åœ¨å¯ä»¥ä½¿ç”¨ VFIO ç»„æ–‡ä»¶æè¿°ç¬¦ä¸Šçš„ ioctl è·å¾—ç»„å†…æ¯ä¸ªè®¾å¤‡çš„æ–‡ä»¶æè¿°ç¬¦ã€‚ VFIO è®¾å¤‡ API åŒ…æ‹¬ç”¨äºæè¿°è®¾å¤‡ã€I/O åŒºåŸŸå’Œå®ƒä»¬åœ¨è®¾å¤‡æè¿°ç¬¦ä¸Šçš„è¯»/å†™/æ˜ å°„åç§»çš„ ioctlsï¼Œä»¥åŠç”¨äºæè¿°å’Œæ³¨å†Œä¸­æ–­é€šçŸ¥çš„æœºåˆ¶ã€‚ VFIOä½¿ç”¨å®ä¾‹ å‡è®¾ç”¨æˆ·æƒ³è®¿é—®PCIè®¾å¤‡0000:06:0d.0ï¼š 12$ readlink /sys/bus/pci/devices/0000:06:0d.0/iommu_group../../../../kernel/iommu_groups/26 å› æ­¤ï¼Œè¿™ä¸ªè®¾å¤‡å±äº IOMMU ç¬¬ 26 ç»„ã€‚è¯¥è®¾å¤‡åœ¨ pci æ€»çº¿ä¸Šï¼Œå› æ­¤ç”¨æˆ·å°†ä½¿ç”¨ vfio-pci æ¥ç®¡ç†è¯¥ç»„ï¼š 1# modprobe vfio-pci å°†è¿™ä¸ªè®¾å¤‡ç»‘å®šåˆ° vfio-pci é©±åŠ¨ä¸Šï¼Œä¸ºè¿™ä¸ªç»„åˆ›å»º VFIO ç»„çš„å­—ç¬¦è®¾å¤‡ï¼š 1234$ lspci -n -s 0000:06:0d.006:0d.0 0401: 1102:0002 (rev 08)# echo 0000:06:0d.0 &gt; /sys/bus/pci/devices/0000:06:0d.0/driver/unbind# echo 1102 0002 &gt; /sys/bus/pci/drivers/vfio-pci/new_id ç°åœ¨æˆ‘ä»¬éœ€è¦çœ‹çœ‹ç»„ä¸­è¿˜æœ‰å“ªäº›è®¾å¤‡ï¼Œä»¥é‡Šæ”¾å®ƒä¾› VFIO ä½¿ç”¨: 12345678$ ls -l /sys/bus/pci/devices/0000:06:0d.0/iommu_group/devicestotal 0lrwxrwxrwx. 1 root root 0 Apr 23 16:13 0000:00:1e.0 -&gt; ../../../../devices/pci0000:00/0000:00:1e.0lrwxrwxrwx. 1 root root 0 Apr 23 16:13 0000:06:0d.0 -&gt; ../../../../devices/pci0000:00/0000:00:1e.0/0000:06:0d.0lrwxrwxrwx. 1 root root 0 Apr 23 16:13 0000:06:0d.1 -&gt; ../../../../devices/pci0000:00/0000:00:1e.0/0000:06:0d.1 è¿™ä¸ªè®¾å¤‡åœ¨ä¸€ä¸ª PCI-to-PCI æ¡¥[4]åé¢ï¼Œå› æ­¤æˆ‘ä»¬è¿˜éœ€è¦æŒ‰ç…§ä¸Šé¢çš„ç¨‹åºå°†è®¾å¤‡ 0000:06:0d.1 æ·»åŠ åˆ°ç»„ä¸­ã€‚è®¾å¤‡ 0000:00:1e.0 æ˜¯ä¸€ä¸ªç›®å‰æ²¡æœ‰ä¸»æœºé©±åŠ¨çš„æ¡¥ï¼Œå› æ­¤ä¸éœ€è¦å°†è¿™ä¸ªè®¾å¤‡ç»‘å®šåˆ° vfio-pci é©±åŠ¨ä¸Šï¼ˆvfio-pci ç›®å‰ä¸æ”¯æŒ PCI æ¡¥ï¼‰ã€‚ æœ€åä¸€æ­¥æ˜¯ï¼Œå¦‚æœéœ€è¦éç‰¹æƒæ“ä½œï¼Œåˆ™ä¸ºç”¨æˆ·æä¾›å¯¹è¯¥ç»„çš„è®¿é—®æƒï¼ˆæ³¨æ„ï¼Œ/dev/vfio/vfio æœ¬èº«ä¸æä¾›ä»»ä½•èƒ½åŠ›ï¼Œå› æ­¤é¢„è®¡ç³»ç»Ÿä¼šå°†å…¶è®¾ç½®ä¸ºæ¨¡å¼ 0666ï¼‰ã€‚ 1# chown user:user /dev/vfio/26 ç”¨æˆ·ç°åœ¨å¯ä»¥å®Œå…¨è®¿é—®è¿™ä¸ªç»„çš„æ‰€æœ‰è®¾å¤‡å’Œ iommuï¼Œå¹¶å¯ä»¥æŒ‰ä»¥ä¸‹æ–¹å¼è®¿é—®å®ƒä»¬ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172int container, group, device, i;struct vfio_group_status group_status = &#123; .argsz = sizeof(group_status) &#125;;struct vfio_iommu_type1_info iommu_info = &#123; .argsz = sizeof(iommu_info) &#125;;struct vfio_iommu_type1_dma_map dma_map = &#123; .argsz = sizeof(dma_map) &#125;;struct vfio_device_info device_info = &#123; .argsz = sizeof(device_info) &#125;;/* Create a new container */container = open(\"/dev/vfio/vfio\", O_RDWR);if (ioctl(container, VFIO_GET_API_VERSION) != VFIO_API_VERSION) /* Unknown API version */if (!ioctl(container, VFIO_CHECK_EXTENSION, VFIO_TYPE1_IOMMU)) /* Doesn't support the IOMMU driver we want. *//* Open the group */group = open(\"/dev/vfio/26\", O_RDWR);/* Test the group is viable and available */ioctl(group, VFIO_GROUP_GET_STATUS, &amp;group_status);if (!(group_status.flags &amp; VFIO_GROUP_FLAGS_VIABLE)) /* Group is not viable (ie, not all devices bound for vfio) *//* Add the group to the container */ioctl(group, VFIO_GROUP_SET_CONTAINER, &amp;container);/* Enable the IOMMU model we want */ioctl(container, VFIO_SET_IOMMU, VFIO_TYPE1_IOMMU);/* Get addition IOMMU info */ioctl(container, VFIO_IOMMU_GET_INFO, &amp;iommu_info);/* Allocate some space and setup a DMA mapping */dma_map.vaddr = mmap(0, 1024 * 1024, PROT_READ | PROT_WRITE, MAP_PRIVATE | MAP_ANONYMOUS, 0, 0);dma_map.size = 1024 * 1024;dma_map.iova = 0; /* 1MB starting at 0x0 from device view */dma_map.flags = VFIO_DMA_MAP_FLAG_READ | VFIO_DMA_MAP_FLAG_WRITE;ioctl(container, VFIO_IOMMU_MAP_DMA, &amp;dma_map);/* Get a file descriptor for the device */device = ioctl(group, VFIO_GROUP_GET_DEVICE_FD, \"0000:06:0d.0\");/* Test and setup the device */ioctl(device, VFIO_DEVICE_GET_INFO, &amp;device_info);for (i = 0; i &lt; device_info.num_regions; i++) &#123; struct vfio_region_info reg = &#123; .argsz = sizeof(reg) &#125;; reg.index = i; ioctl(device, VFIO_DEVICE_GET_REGION_INFO, &amp;reg); /* Setup mappings... read/write offsets, mmaps * For PCI devices, config space is a region */&#125;for (i = 0; i &lt; device_info.num_irqs; i++) &#123; struct vfio_irq_info irq = &#123; .argsz = sizeof(irq) &#125;; irq.index = i; ioctl(device, VFIO_DEVICE_GET_IRQ_INFO, &amp;irq); /* Setup IRQs... eventfds, VFIO_DEVICE_SET_IRQS */&#125;/* Gratuitous device reset and go... */ioctl(device, VFIO_DEVICE_RESET); VFIO User API å®Œæ•´çš„ API å‚è€ƒè¯·æŸ¥çœ‹ include/linux/vfio.hã€‚ VFIO æ€»çº¿é©±åŠ¨ API VFIO æ€»çº¿é©±åŠ¨ï¼Œæ¯”å¦‚ vfio-pciï¼Œåªä½¿ç”¨äº† VFIO æ ¸å¿ƒçš„å‡ ä¸ªæ¥å£ã€‚å½“è®¾å¤‡è¢«ç»‘å®šå’Œè§£ç»‘åˆ°é©±åŠ¨ä¸Šæ—¶ï¼Œé©±åŠ¨åº”è¯¥åˆ†åˆ«è°ƒç”¨ vfio_register_group_dev() å’Œ vfio_unregister_group_dev()ï¼š 123456void vfio_init_group_dev(struct vfio_device *device, struct device *dev, const struct vfio_device_ops *ops);void vfio_uninit_group_dev(struct vfio_device *device);int vfio_register_group_dev(struct vfio_device *device);void vfio_unregister_group_dev(struct vfio_device *device); é©±åŠ¨ç¨‹åºåº”è¯¥å°† vfio_device åµŒå…¥åˆ°å®ƒè‡ªå·±çš„ç»“æ„ä¸­ï¼Œå¹¶åœ¨è¿›è¡Œæ³¨å†Œå‰è°ƒç”¨ vfio_init_group_dev() è¿›è¡Œé¢„é…ç½®ï¼Œåœ¨å®Œæˆå–æ¶ˆæ³¨å†Œåè°ƒç”¨ vfio_uninit_group_dev()ã€‚ vfio_register_group_dev() æŒ‡ç¤ºå†…æ ¸å¼€å§‹è·Ÿè¸ªæŒ‡å®š dev çš„ iommu_groupï¼Œå¹¶å°†è¯¥ dev æ³¨å†Œä¸º VFIO æ€»çº¿é©±åŠ¨ç¨‹åºæ‹¥æœ‰ã€‚ä¸€æ—¦ vfio_register_group_dev() è¿”å›ï¼Œç”¨æˆ·ç©ºé—´å°±æœ‰å¯èƒ½å¼€å§‹è®¿é—®é©±åŠ¨ï¼Œå› æ­¤é©±åŠ¨åº”è¯¥åœ¨è°ƒç”¨å®ƒä¹‹å‰ç¡®ä¿å®ƒå®Œå…¨å‡†å¤‡å¥½ã€‚é©±åŠ¨ç¨‹åºä¸ºå›è°ƒæä¾›äº†ä¸€ä¸ªç±»ä¼¼äºæ–‡ä»¶æ“ä½œç»“æ„çš„ OP ç»“æ„ï¼š 12345678910111213struct vfio_device_ops &#123; int (*open)(struct vfio_device *vdev); void (*release)(struct vfio_device *vdev); ssize_t (*read)(struct vfio_device *vdev, char __user *buf, size_t count, loff_t *ppos); ssize_t (*write)(struct vfio_device *vdev, const char __user *buf, size_t size, loff_t *ppos); long (*ioctl)(struct vfio_device *vdev, unsigned int cmd, unsigned long arg); int (*mmap)(struct vfio_device *vdev, struct vm_area_struct *vma);&#125;; æ¯ä¸ªå‡½æ•°éƒ½è¢«ä¼ é€’ç»™æœ€åˆåœ¨ä¸Šé¢çš„ vfio_register_group_dev() è°ƒç”¨ä¸­æ³¨å†Œçš„ vdevã€‚è¿™å…è®¸æ€»çº¿é©±åŠ¨å™¨ä½¿ç”¨ container_of() è·å¾—å…¶ç§æœ‰æ•°æ®ã€‚å½“ä¸ºä¸€ä¸ªè®¾å¤‡åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶æè¿°ç¬¦æ—¶ï¼ˆé€šè¿‡ VFIO_GROUP_GET_DEVICE_FDï¼‰ï¼Œä¼šå‘å‡º open/release å›è°ƒã€‚ioctl æ¥å£ä¸º VFIO_DEVICE_* ioctlsæä¾›äº†ä¸€ä¸ªç›´æ¥çš„é€šé“ã€‚è¯»/å†™/mmap æ¥å£å®ç°äº†è®¾å¤‡åŒºåŸŸçš„è®¿é—®ï¼Œè¿™äº›è®¿é—®æ˜¯ç”±è®¾å¤‡è‡ªå·±çš„ VFIO_DEVICE_GET_REGION_INFO ioctlå®šä¹‰çš„ã€‚ VFIO æœ€åˆæ˜¯&quot;è™šæ‹ŸåŠŸèƒ½I/O&quot;çš„é¦–å­—æ¯ç¼©å†™ï¼Œç”±æ±¤å§†-é‡Œæ˜‚åœ¨æ‹…ä»»æ€ç§‘å…¬å¸æ—¶å®ç°ã€‚æˆ‘ä»¬åæ¥å·²ç»ä¸å†ä½¿ç”¨è¿™ä¸ªç¼©å†™äº†ï¼Œä½†å®ƒå¾ˆå¥½å¬ã€‚ &quot;å®‰å…¨&quot;ä¹Ÿå–å†³äºè®¾å¤‡çš„ â€œè¡Œä¸ºè‰¯å¥½â€ã€‚å¤šåŠŸèƒ½è®¾å¤‡æœ‰å¯èƒ½åœ¨åŠŸèƒ½ä¹‹é—´æœ‰åé—¨ï¼Œç”šè‡³å•åŠŸèƒ½è®¾å¤‡ä¹Ÿæœ‰å¯èƒ½é€šè¿‡ MMIO å¯„å­˜å™¨å¯¹ PCI é…ç½®ç©ºé—´ç­‰è¿›è¡Œæ›¿ä»£è®¿é—®ã€‚ä¸ºäº†é˜²æ­¢å‰è€…ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ IOMMU é©±åŠ¨ä¸­åŠ å…¥é¢å¤–çš„é¢„é˜²æªæ–½ï¼Œå°†å¤šåŠŸèƒ½ PCI è®¾å¤‡åˆ†ç»„ï¼ˆiommu=group_mfï¼‰ã€‚åè€…æˆ‘ä»¬æ— æ³•é˜²æ­¢ï¼Œä½† IOMMU ä»åº”æä¾›éš”ç¦»ã€‚å¯¹äº PCI æ¥è¯´ï¼ŒSR-IOV è™šæ‹ŸåŠŸèƒ½æ˜¯ &quot;è¡Œä¸ºè‰¯å¥½ &quot;çš„æœ€ä½³æŒ‡æ ‡ï¼Œå› ä¸ºè¿™äº›æ˜¯ä¸ºè™šæ‹ŸåŒ–ä½¿ç”¨æ¨¡å¼è®¾è®¡çš„ã€‚ åƒå¾€å¸¸ä¸€æ ·ï¼Œè™šæ‹Ÿæœºè®¾å¤‡åˆ†é…æœ‰ä¸€äº›æƒè¡¡ï¼Œè¶…å‡ºäº†VFIOçš„èŒƒå›´ã€‚é¢„è®¡æœªæ¥çš„ IOMMU æŠ€æœ¯å°†å‡å°‘ä¸€äº›ï¼Œä½†ä¹Ÿè®¸ä¸æ˜¯å…¨éƒ¨ï¼Œè¿™äº›æŠ˜è¡·ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè®¾å¤‡åœ¨ PCI æ¡¥ä¸‹é¢ï¼Œæ‰€ä»¥æ¥è‡ªè®¾å¤‡çš„ä»»ä½•åŠŸèƒ½çš„äº‹ä»¶å¯¹ iommu æ¥è¯´éƒ½æ˜¯æ— æ³•åŒºåˆ†çš„ã€‚ 123 -[0000:00]-+-1e.0-[06]--+-0d.0 \\-0d.100:1e.0 PCI bridge: Intel Corporation 82801 PCI Bridge (rev 90)","categories":[{"name":"Linux","slug":"Linux","permalink":"https://blog.inoki.cc/categories/Linux/"}],"tags":[{"name":"ç¿»è¯‘","slug":"ç¿»è¯‘","permalink":"https://blog.inoki.cc/tags/ç¿»è¯‘/"},{"name":"ä¸­æ–‡","slug":"ä¸­æ–‡","permalink":"https://blog.inoki.cc/tags/ä¸­æ–‡/"},{"name":"Linux","slug":"Linux","permalink":"https://blog.inoki.cc/tags/Linux/"}]},{"title":"ã€è¯‘ã€‘Linux å†…æ ¸çš„ç”¨æˆ·æ€ I/O","slug":"uio-howto","date":"2021-12-08T19:34:00.000Z","updated":"2025-03-08T09:40:48.611Z","comments":true,"path":"2021/12/08/uio-howto/","link":"","permalink":"https://blog.inoki.cc/2021/12/08/uio-howto/","excerpt":"","text":"åŸæ–‡é“¾æ¥ï¼šThe Userspace I/O HOWTO å…³äº UIO å¦‚æœä½ ä½¿ç”¨ UIO ä½œä¸ºä½ çš„è®¾å¤‡å¡çš„é©±åŠ¨ç¨‹åºï¼Œä½ å¯ä»¥è·å¾—ï¼š åªæœ‰ä¸€ä¸ªå°çš„å†…æ ¸æ¨¡å—éœ€è¦ç¼–å†™å’Œç»´æŠ¤ã€‚ åœ¨ç”¨æˆ·ç©ºé—´å¼€å‘ä½ çš„é©±åŠ¨ç¨‹åºçš„ä¸»è¦éƒ¨åˆ†ï¼Œä½¿ç”¨ä½ ä¹ æƒ¯çš„æ‰€æœ‰å·¥å…·å’Œåº“ã€‚ é©±åŠ¨ç¨‹åºä¸­çš„é”™è¯¯ä¸ä¼šä½¿å†…æ ¸å´©æºƒã€‚ ä½ çš„é©±åŠ¨ç¨‹åºçš„æ›´æ–°å¯ä»¥åœ¨ä¸é‡æ–°ç¼–è¯‘å†…æ ¸çš„æƒ…å†µä¸‹è¿›è¡Œã€‚ UIO æ˜¯å¦‚ä½•å·¥ä½œçš„ æ¯ä¸ª IO è®¾å¤‡éƒ½æ˜¯é€šè¿‡ä¸€ä¸ªè®¾å¤‡æ–‡ä»¶å’Œå‡ ä¸ª sysfs å±æ€§æ–‡ä»¶è®¿é—®çš„ã€‚ç¬¬ä¸€ä¸ªè®¾å¤‡çš„è®¾å¤‡æ–‡ä»¶å°†è¢«ç§°ä¸º /dev/uio0ï¼Œéšåçš„è®¾å¤‡å°†è¢«ç§°ä¸º /dev/uio1ï¼Œ/dev/uio2ï¼Œä»¥æ­¤ç±»æ¨ã€‚ /dev/uioX æ˜¯ç”¨æ¥è®¿é—®è®¾å¤‡å¡çš„åœ°å€ç©ºé—´ã€‚åªéœ€ä½¿ç”¨ mmap() æ¥è®¿é—®ä½ çš„è®¾å¤‡å¡çš„å¯„å­˜å™¨æˆ– RAM ä½ç½®ã€‚ ä¸­æ–­æ˜¯é€šè¿‡ä» /dev/uioX è¯»å–æ¥å¤„ç†çš„ã€‚ä» /dev/uioX è¯»å–çš„é˜»å¡å¼ read() å°†åœ¨ä¸­æ–­å‘ç”Ÿåç«‹å³è¿”å›ã€‚ä½ ä¹Ÿå¯ä»¥åœ¨ /dev/uioX ä¸Šä½¿ç”¨ select() æ¥ç­‰å¾…ä¸€ä¸ªä¸­æ–­ã€‚ä» /dev/uioX ä¸­è¯»å‡ºçš„æ•´æ•°å€¼ä»£è¡¨æ€»çš„ä¸­æ–­æ•°ã€‚ä½ å¯ä»¥ç”¨è¿™ä¸ªæ•°å­—æ¥è®¡ç®—ä½ æ˜¯å¦é”™è¿‡äº†ä¸€äº›ä¸­æ–­ã€‚ å¯¹äºä¸€äº›å†…éƒ¨æœ‰å¤šä¸ªä¸­æ–­æºï¼Œä½†æ²¡æœ‰ç‹¬ç«‹çš„ IRQ å±è”½å’ŒçŠ¶æ€å¯„å­˜å™¨çš„ç¡¬ä»¶ï¼Œå¯èƒ½ä¼šå‡ºç°è¿™æ ·çš„æƒ…å†µï¼šå¦‚æœå†…æ ¸å¤„ç†ç¨‹åºé€šè¿‡å†™å…¥èŠ¯ç‰‡çš„ IRQ å¯„å­˜å™¨æ¥ç¦ç”¨å®ƒä»¬ï¼Œç”¨æˆ·ç©ºé—´æ— æ³•ç¡®å®šä¸­æ–­æºæ˜¯ä»€ä¹ˆã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå†…æ ¸å¿…é¡»å®Œå…¨ç¦ç”¨ IRQï¼Œä»¥ä½¿èŠ¯ç‰‡çš„å¯„å­˜å™¨ä¸è¢«æ”¹å˜ã€‚ç°åœ¨ï¼Œç”¨æˆ·ç©ºé—´éƒ¨åˆ†å¯ä»¥ç¡®å®šä¸­æ–­çš„åŸå› ï¼Œä½†å®ƒä¸èƒ½é‡æ–°å¯ç”¨ä¸­æ–­ã€‚å¦ä¸€ç§æƒ…å†µæ˜¯ï¼Œé‡æ–°å¯ç”¨ä¸­æ–­çš„èŠ¯ç‰‡æ˜¯å¯¹ç»¼åˆçš„ IRQ çŠ¶æ€/ç¡®è®¤å¯„å­˜å™¨çš„è¯»-ä¿®æ”¹-å†™æ“ä½œã€‚å¦‚æœä¸€ä¸ªæ–°çš„ä¸­æ–­åŒæ—¶å‘ç”Ÿï¼Œè¿™å°†æ˜¯å¾ˆè’è°¬çš„ã€‚ ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼ŒUIO è¿˜å®ç°äº†ä¸€ä¸ª write() å‡½æ•°ã€‚å¯¹äºåªæœ‰ä¸€ä¸ªä¸­æ–­æºæˆ–è€…æœ‰ç‹¬ç«‹çš„IRQå±è”½å’ŒçŠ¶æ€å¯„å­˜å™¨çš„ç¡¬ä»¶ï¼Œé€šå¸¸ä¸ä½¿ç”¨ã€å¯ä»¥å¿½ç•¥å®ƒã€‚ç„¶è€Œï¼Œå¦‚æœä½ éœ€è¦å®ƒï¼Œå¯¹ /dev/uioX çš„å†™å…¥å°†è°ƒç”¨é©±åŠ¨å®ç°çš„ irqcontrol() å‡½æ•°ã€‚ä½ å¿…é¡»å†™ä¸€ä¸ª 32 ä½çš„å€¼ï¼Œé€šå¸¸æ˜¯ 0 æˆ– 1ï¼Œä»¥ç¦ç”¨æˆ–å¯ç”¨ä¸­æ–­ã€‚å¦‚æœä¸€ä¸ªé©±åŠ¨ç¨‹åºæ²¡æœ‰å®ç° irqcontrol()ï¼Œwrite() å°†è¿”å› -ENOSYSã€‚ ä¸ºäº†æ­£ç¡®å¤„ç†ä¸­æ–­ï¼Œä½ çš„è‡ªå®šä¹‰å†…æ ¸æ¨¡å—å¯ä»¥æä¾›è‡ªå·±çš„ä¸­æ–­å¤„ç†ç¨‹åºã€‚å®ƒå°†è‡ªåŠ¨è¢«å†…ç½®çš„å¤„ç†ç¨‹åºè°ƒç”¨ã€‚ å¯¹äºé‚£äº›ä¸äº§ç”Ÿä¸­æ–­ä½†éœ€è¦è½®è¯¢çš„å¡ï¼Œå¯ä»¥è®¾ç½®ä¸€ä¸ªå®šæ—¶å™¨ï¼Œåœ¨å¯é…ç½®çš„æ—¶é—´é—´éš”å†…è§¦å‘ä¸­æ–­å¤„ç†ç¨‹åºã€‚è¿™ç§ä¸­æ–­æ¨¡æ‹Ÿæ˜¯é€šè¿‡ä»å®šæ—¶å™¨çš„äº‹ä»¶å¤„ç†ç¨‹åºè°ƒç”¨ uio_event_notify() æ¥å®Œæˆçš„ã€‚ æ¯ä¸ªé©±åŠ¨ç¨‹åºéƒ½æä¾›äº†ç”¨äºè¯»å–æˆ–å†™å…¥å˜é‡çš„å±æ€§ã€‚è¿™äº›å±æ€§å¯ä»¥é€šè¿‡ sysfs æ–‡ä»¶è®¿é—®ã€‚ä¸€ä¸ªè‡ªå®šä¹‰çš„å†…æ ¸é©±åŠ¨æ¨¡å—å¯ä»¥å°†è‡ªå·±çš„å±æ€§æ·»åŠ åˆ° uio é©±åŠ¨æ‰€æ‹¥æœ‰çš„è®¾å¤‡ä¸Šï¼Œä½†ç›®å‰è¿˜æ²¡æœ‰æ·»åŠ åˆ° uio è®¾å¤‡æœ¬èº«ã€‚å¦‚æœå‘ç°æœ‰ç”¨çš„è¯ï¼Œè¿™åœ¨å°†æ¥å¯èƒ½ä¼šå‘ç”Ÿæ”¹å˜ã€‚ UIOæ¡†æ¶æä¾›äº†ä»¥ä¸‹æ ‡å‡†å±æ€§ï¼š name: ä½ çš„è®¾å¤‡çš„åç§°ã€‚å»ºè®®ä½¿ç”¨ä½ çš„å†…æ ¸æ¨¡å—çš„åç§°ã€‚ versionï¼šä¸€ä¸ªç”±ä½ çš„é©±åŠ¨ç¨‹åºå®šä¹‰çš„ç‰ˆæœ¬å­—ç¬¦ä¸²ã€‚è¿™ä½¿å¾—ä½ çš„é©±åŠ¨ç¨‹åºçš„ç”¨æˆ·ç©ºé—´éƒ¨åˆ†èƒ½å¤Ÿå¤„ç†ä¸åŒç‰ˆæœ¬çš„å†…æ ¸æ¨¡å—ã€‚ eventï¼šè‡ªä¸Šæ¬¡è¯»å–è®¾å¤‡èŠ‚ç‚¹ä»¥æ¥ï¼Œé©±åŠ¨ç¨‹åºå¤„ç†çš„ä¸­æ–­æ€»æ•°ã€‚ è¿™äº›å±æ€§å‡ºç°åœ¨ /sys/class/uio/uioX ç›®å½•ä¸‹ã€‚è¯·æ³¨æ„ï¼Œè¿™ä¸ªç›®å½•å¯èƒ½æ˜¯ä¸€ä¸ªç¬¦å·é“¾æ¥ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªçœŸæ­£çš„ç›®å½•ã€‚ä»»ä½•è®¿é—®å®ƒçš„ç”¨æˆ·ç©ºé—´ä»£ç å¿…é¡»èƒ½å¤Ÿå¤„ç†è¿™ä¸ªé—®é¢˜ã€‚ æ¯ä¸ª UIO è®¾å¤‡éƒ½å¯ä»¥ä¸ºå†…å­˜æ˜ å°„æä¾›ä¸€ä¸ªæˆ–å¤šä¸ªå†…å­˜åŒºåŸŸã€‚è¿™æ˜¯å¿…è¦çš„ï¼Œå› ä¸ºä¸€äº›å·¥ä¸š I/O å¡éœ€è¦åœ¨ä¸€ä¸ªé©±åŠ¨ç¨‹åºä¸­è®¿é—®ä¸€ä¸ªä»¥ä¸Šçš„ PCI å†…å­˜åŒºåŸŸã€‚ æ¯ä¸ªæ˜ å°„åœ¨ sysfs ä¸­æœ‰è‡ªå·±çš„ç›®å½•ï¼Œç¬¬ä¸€ä¸ªæ˜ å°„æ˜¾ç¤ºä¸º /sys/class/uio/uioX/maps/map0/ã€‚ åç»­çš„æ˜ å°„åˆ›å»ºç›®å½• map1/ï¼Œmap2/ï¼Œç­‰ç­‰ã€‚è¿™äº›ç›®å½•åªæœ‰åœ¨æ˜ å°„çš„å¤§å°ä¸ä¸º 0 æ—¶æ‰ä¼šå‡ºç°ã€‚ æ¯ä¸ª mapX/ ç›®å½•åŒ…å«å››ä¸ªåªè¯»æ–‡ä»¶ï¼Œæ˜¾ç¤ºå†…å­˜çš„å±æ€§ï¼š name: è¿™ä¸ªæ˜ å°„çš„ä¸€ä¸ªå­—ç¬¦ä¸²æ ‡è¯†ç¬¦ã€‚è¿™æ˜¯å¯é€‰çš„ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²å¯ä»¥æ˜¯ç©ºçš„ã€‚é©±åŠ¨ç¨‹åºå¯ä»¥è®¾ç½®å®ƒï¼Œä½¿ç”¨æˆ·ç©ºé—´æ›´å®¹æ˜“æ‰¾åˆ°æ­£ç¡®çš„æ˜ å°„ã€‚ addr: å¯ä»¥è¢«æ˜ å°„çš„å†…å­˜çš„åœ°å€ã€‚ sizeï¼šaddr æ‰€æŒ‡å‘çš„å†…å­˜çš„å¤§å°ï¼Œä»¥å­—èŠ‚ä¸ºå•ä½ã€‚ offsetï¼šåœ¨ mmap() è¿”å›çš„æŒ‡é’ˆä¸Šå¿…é¡»åŠ ä¸Šçš„åç§»é‡ï¼Œä»¥è·å¾—å®é™…çš„è®¾å¤‡å†…å­˜ã€‚å¦‚æœè®¾å¤‡çš„å†…å­˜ä¸æ˜¯é¡µå¯¹é½çš„ï¼Œè¿™å°±å¾ˆé‡è¦ã€‚è®°ä½ï¼Œç”± mmap() è¿”å›çš„æŒ‡é’ˆæ€»æ˜¯é¡µå¯¹é½çš„ï¼Œæ‰€ä»¥æ€»æ˜¯åŠ ä¸Šè¿™ä¸ªåç§»é‡æ˜¯å¥½çš„é£æ ¼ã€‚ åœ¨ç”¨æˆ·ç©ºé—´ï¼Œä¸åŒçš„æ˜ å°„æ˜¯é€šè¿‡è°ƒæ•´ mmap() è°ƒç”¨çš„åç§»é‡å‚æ•°æ¥åŒºåˆ†çš„ã€‚ä¸ºäº†æ˜ å°„ N çš„å†…å­˜ï¼Œä½ å¿…é¡»ä½¿ç”¨ N å€çš„é¡µé¢å¤§å°ä½œä¸ºä½ çš„åç§»ï¼š 1offset = N * getpagesize(); Sometimes there is hardware with memory-like regions that can not be mapped with the technique described here, but there are still ways to access them from userspace. The most common example are x86 ioports. On x86 systems, userspace can access these ioports using ioperm(), iopl(), inb(), outb(), and similar functions. Since these ioport regions can not be mapped, they will not appear under /sys/class/uio/uioX/maps/ like the normal memory described above. Without information about the port regions a hardware has to offer, it becomes difficult for the userspace part of the driver to find out which ports belong to which UIO device. To address this situation, the new directory /sys/class/uio/uioX/portio/ was added. It only exists if the driver wants to pass information about one or more port regions to userspace. If that is the case, subdirectories named port0, port1, and so on, will appear underneath /sys/class/uio/uioX/portio/. æœ‰æ—¶ï¼Œæœ‰äº›ç¡¬ä»¶çš„ç±»ä¼¼å†…å­˜çš„åŒºåŸŸä¸èƒ½ç”¨è¿™é‡Œæè¿°çš„æŠ€æœ¯è¿›è¡Œæ˜ å°„ï¼Œä½†ä»æœ‰åŠæ³•ä»ç”¨æˆ·ç©ºé—´è®¿é—®å®ƒä»¬ã€‚æœ€å¸¸è§çš„ä¾‹å­æ˜¯ x86 çš„ ioportsã€‚åœ¨X86ç³»ç»Ÿä¸­ï¼Œç”¨æˆ·ç©ºé—´å¯ä»¥ä½¿ç”¨ ioperm()ã€iopl()ã€inb()ã€outb() å’Œç±»ä¼¼çš„å‡½æ•°è®¿é—®è¿™äº› ioportsã€‚ ç”±äºè¿™äº› ioport åŒºåŸŸä¸èƒ½è¢«æ˜ å°„ï¼Œå®ƒä»¬ä¸ä¼šåƒä¸Šé¢æè¿°çš„æ™®é€šå†…å­˜ä¸€æ ·å‡ºç°åœ¨ /sys/class/uio/uioX/maps/ ä¸‹ã€‚å¦‚æœæ²¡æœ‰ç¡¬ä»¶æ‰€æä¾›çš„ç«¯å£åŒºåŸŸçš„ä¿¡æ¯ï¼Œé©±åŠ¨ç¨‹åºçš„ç”¨æˆ·ç©ºé—´éƒ¨åˆ†å°±å¾ˆéš¾æ‰¾å‡ºå“ªäº›ç«¯å£å±äºå“ªä¸ª IO è®¾å¤‡ã€‚ ä¸ºäº†è§£å†³è¿™ç§æƒ…å†µï¼Œå¢åŠ äº†æ–°çš„ç›®å½• /sys/class/uio/uioX/portio/ã€‚å®ƒåªåœ¨é©±åŠ¨æƒ³æŠŠä¸€ä¸ªæˆ–å¤šä¸ªç«¯å£åŒºåŸŸçš„ä¿¡æ¯ä¼ é€’ç»™ç”¨æˆ·ç©ºé—´æ—¶å­˜åœ¨ã€‚å¦‚æœæ˜¯è¿™ç§æƒ…å†µï¼Œåä¸º port0ã€port1 ç­‰çš„å­ç›®å½•å°†å‡ºç°åœ¨ /sys/class/uio/uioX/portio/ ä¸‹é¢ã€‚ æ¯ä¸ª portX/ ç›®å½•åŒ…å«å››ä¸ªåªè¯»æ–‡ä»¶ï¼Œå®ƒä»¬æ˜¾ç¤ºç«¯å£åŒºåŸŸçš„åç§°ã€å¼€å§‹ã€å¤§å°å’Œç±»å‹ï¼š nameï¼šè¿™ä¸ªç«¯å£åŒºåŸŸçš„ä¸€ä¸ªå­—ç¬¦ä¸²æ ‡è¯†ç¬¦ã€‚è¿™ä¸ªå­—ç¬¦ä¸²æ˜¯å¯é€‰çš„ï¼Œå¯ä»¥ä¸ºç©ºã€‚é©±åŠ¨ç¨‹åºå¯ä»¥è®¾ç½®å®ƒï¼Œä½¿ç”¨æˆ·ç©ºé—´æ›´å®¹æ˜“æ‰¾åˆ°æŸä¸ªç«¯å£åŒºåŸŸã€‚ startï¼šè¯¥åŒºåŸŸçš„ç¬¬ä¸€ä¸ªç«¯å£ã€‚ sizeï¼šè¿™ä¸ªåŒºåŸŸä¸­çš„ç«¯å£æ•°é‡ã€‚ porttypeï¼šä¸€ä¸ªæè¿°ç«¯å£ç±»å‹çš„å­—ç¬¦ä¸²ã€‚ ç¼–å†™ä½ è‡ªå·±çš„å†…æ ¸æ¨¡å— è¯·çœ‹ä¸€ä¸‹ uio_cif.c ä½œä¸ºä¸€ä¸ªä¾‹å­ã€‚ä¸‹é¢çš„æ®µè½è§£é‡Šäº†è¿™ä¸ªæ–‡ä»¶çš„ä¸åŒéƒ¨åˆ†ã€‚ struct uio_info è¿™ä¸ªç»“æ„å‘Šè¯‰æ¡†æ¶ä½ çš„é©±åŠ¨ç¨‹åºçš„ç»†èŠ‚ï¼Œæœ‰äº›æˆå‘˜æ˜¯å¿…é¡»çš„ï¼Œæœ‰äº›æ˜¯å¯é€‰çš„ã€‚ const char *name: éœ€è¦ã€‚ä½ çš„é©±åŠ¨ç¨‹åºçš„åç§°ï¼Œå®ƒå°†å‡ºç°åœ¨ sysfs ä¸­ã€‚æˆ‘å»ºè®®ä½¿ç”¨ä½ çš„æ¨¡å—çš„åç§°ã€‚ const char *version: å¿…é¡»ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²ä¼šæ˜¾ç¤ºåœ¨ /sys/class/uio/uioX/versionã€‚ struct uio_mem mem[ MAX_UIO_MAPS ]: å¦‚æœä½ æœ‰å¯ä»¥ç”¨ mmap() æ˜ å°„çš„å†…å­˜ï¼Œåˆ™éœ€è¦ã€‚å¯¹äºæ¯ä¸ªæ˜ å°„ï¼Œä½ éœ€è¦å¡«å……ä¸€ä¸ª uio_mem ç»“æ„ã€‚è¯¦æƒ…è§ä¸‹é¢çš„æè¿°ã€‚ struct uio_port port[ MAX_UIO_PORTS_REGIONS ]: å¦‚æœä½ æƒ³æŠŠ ioports çš„ä¿¡æ¯ä¼ é€’ç»™ç”¨æˆ·ç©ºé—´ï¼Œå°±å¿…é¡»è¿™æ ·åšã€‚å¯¹äºæ¯ä¸ªç«¯å£åŒºåŸŸï¼Œä½ éœ€è¦å¡«å……ä¸€ä¸ª uio_port ç»“æ„ã€‚è¯¦æƒ…è§ä¸‹é¢çš„æè¿°ã€‚ long irq: éœ€è¦ã€‚å¦‚æœä½ çš„ç¡¬ä»¶äº§ç”Ÿäº†ä¸€ä¸ªä¸­æ–­ï¼Œä½ çš„æ¨¡å—çš„ä»»åŠ¡å°±æ˜¯åœ¨åˆå§‹åŒ–è¿‡ç¨‹ä¸­ç¡®å®š irq çš„ç¼–å·ã€‚å¦‚æœä½ æ²¡æœ‰ç¡¬ä»¶äº§ç”Ÿçš„ä¸­æ–­ï¼Œä½†æƒ³ä»¥å…¶ä»–æ–¹å¼è§¦å‘ä¸­æ–­å¤„ç†ç¨‹åºï¼Œè¯·å°† irq è®¾ç½®ä¸º UIO_IRQ_CUSTOMã€‚å¦‚æœä½ æ ¹æœ¬å°±æ²¡æœ‰ä¸­æ–­ï¼Œä½ å¯ä»¥æŠŠ irq è®¾ç½®ä¸º UIO_IRQ_NONEï¼Œå°½ç®¡è¿™å¾ˆå°‘æœ‰æ„ä¹‰ã€‚ unsigned long irq_flags: å¦‚æœä½ å°† irq è®¾ç½®ä¸ºç¡¬ä»¶ä¸­æ–­å·ï¼Œåˆ™éœ€è¦ã€‚è¿™é‡Œç»™å‡ºçš„æ ‡å¿—å°†åœ¨è°ƒç”¨ require_irq() æ—¶ä½¿ç”¨ã€‚ int (*mmap)(struct uio_info *info, struct vm_area_struct *vma): å¯é€‰çš„ã€‚å¦‚æœä½ éœ€è¦ä¸€ä¸ªç‰¹æ®Šçš„mmap()å‡½æ•°ï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œè®¾ç½®å®ƒã€‚å¦‚æœè¿™ä¸ªæŒ‡é’ˆä¸æ˜¯ NULLï¼Œä½ çš„ mmap() å°†è¢«è°ƒç”¨ï¼Œè€Œä¸æ˜¯å†…ç½®çš„é‚£ä¸ªã€‚ int (*open)(struct uio_info *info, struct inode *inode): å¯é€‰çš„ã€‚ä½ å¯èƒ½å¸Œæœ›æœ‰è‡ªå·±çš„open()ï¼Œä¾‹å¦‚ï¼Œåªæœ‰å½“ä½ çš„è®¾å¤‡è¢«å®é™…ä½¿ç”¨æ—¶æ‰å¯ç”¨ä¸­æ–­ã€‚ int (*release)(struct uio_info *info, struct inode *inode): å¯é€‰çš„ã€‚å¦‚æœä½ å®šä¹‰äº†è‡ªå·±çš„open()ï¼Œä½ å¯èƒ½ä¹Ÿéœ€è¦ä¸€ä¸ªè‡ªå®šä¹‰çš„ release() å‡½æ•°ã€‚ int (*irqcontrol)(struct uio_info *info, s32 irq_on): å¯é€‰çš„ã€‚å¦‚æœä½ éœ€è¦é€šè¿‡å†™åˆ° /dev/uioX æ¥å¯ç”¨æˆ–ç¦ç”¨ç”¨æˆ·ç©ºé—´çš„ä¸­æ–­ï¼Œä½ å¯ä»¥å®ç°è¿™ä¸ªå‡½æ•°ã€‚å‚æ•° irq_on ä¸º 0 è¡¨ç¤ºç¦ç”¨ä¸­æ–­ï¼Œ1 è¡¨ç¤ºå¯ç”¨ä¸­æ–­ã€‚ é€šå¸¸ï¼Œä½ çš„è®¾å¤‡ä¼šæœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå†…å­˜åŒºåŸŸå¯ä»¥è¢«æ˜ å°„åˆ°ç”¨æˆ·ç©ºé—´ã€‚å¯¹äºæ¯ä¸ªåŒºåŸŸï¼Œä½ å¿…é¡»åœ¨ mem[] æ•°ç»„ä¸­è®¾ç½®ä¸€ä¸ª struct uio_memã€‚ä¸‹é¢æ˜¯å¯¹ struct uio_mem å­—æ®µçš„æè¿°ã€‚ const char *name: å¯é€‰çš„ã€‚è®¾ç½®å®ƒä»¥å¸®åŠ©è¯†åˆ«å†…å­˜åŒºåŸŸï¼Œå®ƒå°†æ˜¾ç¤ºåœ¨ç›¸åº”çš„ sysfs èŠ‚ç‚¹ä¸­ã€‚ int memtype: å¦‚æœä½¿ç”¨æ˜ å°„ï¼Œåˆ™éœ€è¦ã€‚å¦‚æœä½ çš„å¡ä¸Šæœ‰è¦æ˜ å°„çš„ç‰©ç†å†…å­˜ï¼Œå°†å…¶è®¾ç½®ä¸º UIO_MEM_PHYSã€‚å¦‚æœæ˜¯é€»è¾‘å†…å­˜(ä¾‹å¦‚ç”¨ __get_free_pages() åˆ†é…ï¼Œè€Œä¸æ˜¯ kmalloc())ï¼Œåˆ™ä½¿ç”¨ UIO_MEM_LOGICALã€‚è¿˜æœ‰ UIO_MEM_VIRTUAL ç”¨äºè™šæ‹Ÿå†…å­˜ã€‚ phys_addr_t addr: å¦‚æœä½¿ç”¨æ˜ å°„åˆ™éœ€è¦ã€‚å¡«å…¥ä½ çš„å†…å­˜å—çš„åœ°å€ã€‚è¿™ä¸ªåœ°å€ä¼šå‡ºç°åœ¨ sysfs ä¸­ã€‚ resource_size_t size: å¡«å†™ addr æŒ‡å‘çš„å†…å­˜å—çš„å¤§å°ã€‚å¦‚æœ size ä¸º 0ï¼Œåˆ™è®¤ä¸ºè¯¥æ˜ å°„æœªè¢«ä½¿ç”¨ã€‚æ³¨æ„ä½ å¿…é¡»ä¸ºæ‰€æœ‰æœªä½¿ç”¨çš„æ˜ å°„åˆå§‹åŒ– size ä¸º 0ã€‚ void *internal_addr: å¦‚æœä½ å¿…é¡»ä»ä½ çš„å†…æ ¸æ¨¡å—ä¸­è®¿é—®è¿™ä¸ªå†…å­˜åŒºåŸŸï¼Œä½ å°†å¸Œæœ›é€šè¿‡ä½¿ç”¨ç±»ä¼¼ ioremap() çš„æ–¹æ³•æ¥è¿›è¡Œå†…éƒ¨æ˜ å°„ã€‚è¿™ä¸ªå‡½æ•°è¿”å›çš„åœ°å€ä¸èƒ½è¢«æ˜ å°„åˆ°ç”¨æˆ·ç©ºé—´ï¼Œæ‰€ä»¥ä½ ä¸èƒ½æŠŠå®ƒå­˜å‚¨åœ¨ addr ä¸­ã€‚ä½¿ç”¨ internal_addr æ¥è®°ä½è¿™æ ·ä¸€ä¸ªåœ°å€ã€‚ è¯·ä¸è¦ç¢° uio_mem ç»“æ„çš„ map å…ƒç´ !å®ƒæ˜¯ç”± UIO æ¡†æ¶ç”¨æ¥ä¸ºè¿™ä¸ªæ˜ å°„è®¾ç½® sysfs æ–‡ä»¶çš„ã€‚ä¸è¦ç®¡å®ƒã€‚ æœ‰æ—¶ï¼Œä½ çš„è®¾å¤‡å¯èƒ½æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªç«¯å£åŒºåŸŸä¸èƒ½è¢«æ˜ å°„åˆ°ç”¨æˆ·ç©ºé—´ã€‚ä½†å¦‚æœç”¨æˆ·ç©ºé—´æœ‰å…¶ä»–çš„å¯èƒ½æ€§æ¥è®¿é—®è¿™äº›ç«¯å£ï¼Œé‚£ä¹ˆåœ¨ sysfs ä¸­æä¾›è¿™äº›ç«¯å£çš„ä¿¡æ¯æ˜¯æœ‰æ„ä¹‰çš„ã€‚å¯¹äºæ¯ä¸ªåŒºåŸŸï¼Œä½ å¿…é¡»åœ¨ port[] æ•°ç»„ä¸­è®¾ç½®ä¸€ä¸ª struct uio_portã€‚ä¸‹é¢æ˜¯å¯¹ struct uio_port çš„å­—æ®µçš„æè¿°ã€‚ char *porttypeï¼šéœ€è¦ã€‚å°†å…¶è®¾ç½®ä¸ºé¢„å®šä¹‰çš„å¸¸æ•°ä¹‹ä¸€ã€‚ä½¿ç”¨ UIO_PORT_X86 æ¥è¡¨ç¤º x86 æ¶æ„ä¸­çš„ ioportsã€‚ unsigned long start: å¦‚æœä½¿ç”¨ç«¯å£åŒºåŸŸï¼Œåˆ™éœ€è¦ã€‚å¡«å†™è¿™ä¸ªåŒºåŸŸçš„ç¬¬ä¸€ä¸ªç«¯å£çš„ç¼–å·ã€‚ unsigned long size: å¡«å…¥è¯¥åŒºåŸŸçš„ç«¯å£æ•°ã€‚å¦‚æœ size ä¸º 0ï¼Œè¯¥åŒºåŸŸå°†è¢«è§†ä¸ºæœªä½¿ç”¨ã€‚æ³¨æ„ï¼Œä½ å¿…é¡»ä¸ºæ‰€æœ‰æœªä½¿ç”¨çš„åŒºåŸŸåˆå§‹åŒ– size ä¸º 0ã€‚ è¯·ä¸è¦ç¢° uio_port ç»“æ„çš„ portio å…ƒç´ ! å®ƒæ˜¯ç”± UIO æ¡†æ¶å†…éƒ¨ä½¿ç”¨çš„ï¼Œç”¨äºä¸ºè¿™ä¸ªåŒºåŸŸè®¾ç½® sysfs æ–‡ä»¶ã€‚è¯·ä¸è¦ç®¡å®ƒã€‚ æ·»åŠ ä¸€ä¸ªä¸­æ–­å¤„ç†ç¨‹åº ä½ éœ€è¦åœ¨ä¸­æ–­å¤„ç†ç¨‹åºä¸­åšä»€ä¹ˆå–å†³äºä½ çš„ç¡¬ä»¶å’Œä½ æƒ³å¦‚ä½•å¤„ç†å®ƒã€‚ä½ åº”è¯¥å°½é‡å‡å°‘å†…æ ¸ä¸­æ–­å¤„ç†ç¨‹åºä¸­çš„ä»£ç é‡ã€‚å¦‚æœä½ çš„ç¡¬ä»¶ä¸éœ€è¦åœ¨æ¯æ¬¡ä¸­æ–­åæ‰§è¡Œä»»ä½•æ“ä½œï¼Œé‚£ä¹ˆä½ çš„å¤„ç†ç¨‹åºå¯ä»¥æ˜¯ç©ºçš„ã€‚ å¦ä¸€æ–¹é¢ï¼Œå¦‚æœä½ çš„ç¡¬ä»¶éœ€è¦åœ¨æ¯æ¬¡ä¸­æ–­åæ‰§è¡Œä¸€äº›åŠ¨ä½œï¼Œé‚£ä¹ˆä½ å¿…é¡»åœ¨ä½ çš„å†…æ ¸æ¨¡å—ä¸­å®Œæˆè¿™äº›åŠ¨ä½œã€‚æ³¨æ„ï¼Œä½ ä¸èƒ½ä¾èµ–ä½ çš„é©±åŠ¨ç¨‹åºçš„ç”¨æˆ·ç©ºé—´éƒ¨åˆ†ã€‚ä½ çš„ç”¨æˆ·ç©ºé—´ç¨‹åºå¯ä»¥åœ¨ä»»ä½•æ—¶å€™ç»ˆæ­¢ï¼Œå¯èƒ½ä¼šè®©ä½ çš„ç¡¬ä»¶å¤„äºä»ç„¶éœ€è¦æ­£ç¡®å¤„ç†ä¸­æ–­çš„çŠ¶æ€ã€‚ ä¹Ÿå¯èƒ½æœ‰è¿™æ ·çš„åº”ç”¨ï¼Œä½ æƒ³åœ¨æ¯æ¬¡ä¸­æ–­æ—¶ä»ç¡¬ä»¶ä¸­è¯»å–æ•°æ®ï¼Œå¹¶å°†å…¶ç¼“å†²åœ¨ä½ ä¸ºæ­¤ç›®çš„åˆ†é…çš„ä¸€å—å†…æ ¸å†…å­˜ä¸­ã€‚é€šè¿‡è¿™ç§æŠ€æœ¯ï¼Œä½ å¯ä»¥é¿å…åœ¨ç”¨æˆ·ç©ºé—´ç¨‹åºé”™è¿‡ä¸­æ–­æ—¶çš„æ•°æ®ä¸¢å¤±ã€‚ å…³äºå…±äº«ä¸­æ–­çš„è¯´æ˜ï¼šåªè¦æœ‰å¯èƒ½ï¼Œä½ çš„é©±åŠ¨ç¨‹åºåº”è¯¥æ”¯æŒä¸­æ–­å…±äº«ã€‚åªæœ‰å½“ä½ çš„é©±åŠ¨ç¨‹åºèƒ½å¤Ÿæ£€æµ‹åˆ°ä½ çš„ç¡¬ä»¶æ˜¯å¦è§¦å‘äº†ä¸­æ–­æ—¶ï¼Œå®ƒæ‰æœ‰å¯èƒ½ã€‚è¿™é€šå¸¸æ˜¯é€šè¿‡æŸ¥çœ‹ä¸€ä¸ªä¸­æ–­çŠ¶æ€å¯„å­˜å™¨æ¥å®ç°çš„ã€‚å¦‚æœä½ çš„é©±åŠ¨ç¨‹åºçœ‹åˆ° IRQ ä½ç¡®å®è¢«è®¾ç½®äº†ï¼Œå®ƒå°†æ‰§è¡Œå…¶åŠ¨ä½œï¼Œå¤„ç†ç¨‹åºè¿”å› IRQ_HANDLEDã€‚å¦‚æœé©±åŠ¨ç¨‹åºæ£€æµ‹åˆ°ä¸æ˜¯ä½ çš„ç¡¬ä»¶å¼•èµ·çš„ä¸­æ–­ï¼Œå®ƒå°†ä»€ä¹ˆä¹Ÿä¸åšï¼Œå¹¶è¿”å› IRQ_NONEï¼Œå…è®¸å†…æ ¸è°ƒç”¨ä¸‹ä¸€ä¸ªå¯èƒ½çš„ä¸­æ–­å¤„ç†ç¨‹åºã€‚ å¦‚æœä½ å†³å®šä¸æ”¯æŒå…±äº«ä¸­æ–­ï¼Œä½ çš„å¡å°±ä¸èƒ½åœ¨æ²¡æœ‰ç©ºé—²ä¸­æ–­çš„è®¡ç®—æœºä¸­å·¥ä½œã€‚ç”±äºè¿™ç§æƒ…å†µç»å¸¸å‘ç”Ÿåœ¨ PC å¹³å°ä¸Šï¼Œä½ å¯ä»¥é€šè¿‡æ”¯æŒä¸­æ–­å…±äº«æ¥ä¸ºè‡ªå·±çœå»å¾ˆå¤šéº»çƒ¦ã€‚ ä¸ºå¹³å°è®¾å¤‡ä½¿ç”¨ uio_pdrv åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œå¹³å°è®¾å¤‡çš„ IO é©±åŠ¨å¯ä»¥ç”¨ä¸€ç§é€šç”¨çš„æ–¹å¼æ¥å¤„ç†ã€‚åœ¨ä½ å®šä¹‰ platform_device ç»“æ„çš„åŒä¸€ä¸ªåœ°æ–¹ï¼Œä½ ä¹Ÿå¯ä»¥ç®€å•åœ°å®ç°ä½ çš„ä¸­æ–­å¤„ç†ç¨‹åºå¹¶å¡«å……ä½ çš„ uio_info ç»“æ„ã€‚ç„¶åï¼Œè¿™ä¸ªç»“æ„ uio_info çš„æŒ‡é’ˆè¢«ç”¨ä½œä½ çš„å¹³å°è®¾å¤‡çš„ platform_dataã€‚ ä½ è¿˜éœ€è¦è®¾ç½®ä¸€ä¸ªåŒ…å«å†…å­˜æ˜ å°„åœ°å€å’Œå¤§å°çš„ç»“æ„èµ„æºæ•°ç»„ã€‚è¿™äº›ä¿¡æ¯ä½¿ç”¨ struct platform_device çš„ .resource å’Œ .num_resources å…ƒç´ ä¼ é€’ç»™é©±åŠ¨ã€‚ ä½ ç°åœ¨å¿…é¡»å°† struct platform_device çš„ .name å…ƒç´ è®¾ç½®ä¸º &quot;uio_pdrv &quot;ä»¥ä½¿ç”¨é€šç”¨çš„ IO å¹³å°è®¾å¤‡é©±åŠ¨ç¨‹åºã€‚è¿™ä¸ªé©±åŠ¨ç¨‹åºå°†æ ¹æ®ç»™å®šçš„èµ„æºå¡«å…… mem[] æ•°ç»„ï¼Œå¹¶æ³¨å†Œè¯¥è®¾å¤‡ã€‚ è¿™ç§æ–¹æ³•çš„ä¼˜ç‚¹æ˜¯ï¼Œä½ åªéœ€è¦ç¼–è¾‘ä¸€ä¸ªä½ æ— è®ºå¦‚ä½•éƒ½éœ€è¦ç¼–è¾‘çš„æ–‡ä»¶ã€‚ä½ ä¸éœ€è¦åˆ›å»ºä¸€ä¸ªé¢å¤–çš„é©±åŠ¨ç¨‹åºã€‚ ä¸ºå¹³å°è®¾å¤‡ä½¿ç”¨ uio_pdrv_genirq ç‰¹åˆ«æ˜¯åœ¨åµŒå…¥å¼è®¾å¤‡ä¸­ï¼Œä½ ç»å¸¸ä¼šå‘ç°ä¸€äº›èŠ¯ç‰‡çš„ irq å¼•è„šè¢«ç»‘åœ¨è‡ªå·±çš„ä¸“ç”¨ä¸­æ–­çº¿ä¸Šã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥éå¸¸ç¡®å®šä¸­æ–­ä¸æ˜¯å…±äº«çš„ï¼Œæˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥åˆ©ç”¨ uio_pdrv çš„æ¦‚å¿µï¼Œä½¿ç”¨ä¸€ä¸ªé€šç”¨çš„ä¸­æ–­å¤„ç†å™¨ã€‚è¿™å°±æ˜¯ uio_pdrv_genirq çš„ä½œç”¨ã€‚ è¿™ä¸ªé©±åŠ¨ç¨‹åºçš„è®¾ç½®ä¸ä¸Šé¢æè¿°çš„ uio_pdrv ç›¸åŒï¼Œåªæ˜¯ä½ æ²¡æœ‰å®ç°ä¸€ä¸ªä¸­æ–­å¤„ç†ç¨‹åºã€‚ uio_info ç»“æ„ä¸­çš„ .handler å…ƒç´ å¿…é¡»ä¿æŒä¸ºç©ºã€‚.irq_flags å…ƒç´ å¿…é¡»ä¸åŒ…å« IRQF_SHAREDã€‚ ä½ å°†æŠŠ struct platform_device çš„ .name å…ƒç´ è®¾ç½®ä¸º â€œuio_pdrv_genirqâ€ æ¥ä½¿ç”¨è¿™ä¸ªé©±åŠ¨ç¨‹åºã€‚ uio_pdrv_genirq çš„é€šç”¨ä¸­æ–­å¤„ç†ç¨‹åºå°†ç®€å•åœ°ä½¿ç”¨ disable_irq_nosync() ç¦ç”¨ä¸­æ–­çº¿ã€‚åœ¨å®Œæˆå®ƒçš„å·¥ä½œåï¼Œç”¨æˆ·ç©ºé—´å¯ä»¥é€šè¿‡å‘ IO è®¾å¤‡æ–‡ä»¶å†™å…¥ 0x00000001 æ¥é‡æ–°å¯ç”¨ä¸­æ–­ã€‚é©±åŠ¨ç¨‹åºå·²ç»å®ç°äº†ä¸€ä¸ª irq_control() æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œä½ å¿…é¡»ä¸å®ç°è‡ªå·±çš„ã€‚ ä½¿ç”¨ uio_pdrv_genirq ä¸ä»…å¯ä»¥èŠ‚çœå‡ è¡Œä¸­æ–­å¤„ç†ç¨‹åºçš„ä»£ç ã€‚ä½ ä¹Ÿä¸éœ€è¦çŸ¥é“ä»»ä½•å…³äºèŠ¯ç‰‡å†…éƒ¨å¯„å­˜å™¨çš„ä¿¡æ¯æ¥åˆ›å»ºé©±åŠ¨çš„å†…æ ¸éƒ¨åˆ†ã€‚ä½ åªéœ€è¦çŸ¥é“èŠ¯ç‰‡æ‰€è¿æ¥çš„å¼•è„šçš„IRQå·ç ã€‚ å½“åœ¨ä¸€ä¸ªå¯ç”¨äº†è®¾å¤‡æ ‘çš„ç³»ç»Ÿä¸­ä½¿ç”¨æ—¶ï¼Œéœ€è¦ç”¨ &quot;of_id &quot;æ¨¡å—å‚æ•°æ¥æ¢æµ‹é©±åŠ¨ç¨‹åºåº”è¯¥å¤„ç†çš„èŠ‚ç‚¹çš„&quot;å…¼å®¹&quot;å­—ç¬¦ä¸²ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒèŠ‚ç‚¹çš„åç§°ï¼ˆä¸åŒ…æ‹¬å•å…ƒåœ°å€ï¼‰è¢«æš´éœ²ä¸ºç”¨æˆ·ç©ºé—´ä¸­çš„ IO è®¾å¤‡çš„åç§°ã€‚è¦è®¾ç½®ä¸€ä¸ªè‡ªå®šä¹‰çš„åç§°ï¼Œå¯ä»¥åœ¨ DT èŠ‚ç‚¹ä¸­æŒ‡å®šä¸€ä¸ªåä¸º â€œlinux,uio-nameâ€ çš„å±æ€§ã€‚ ä¸ºå¹³å°è®¾å¤‡ä½¿ç”¨ uio_dmem_genirq é™¤äº†é™æ€åˆ†é…çš„å†…å­˜èŒƒå›´ä¹‹å¤–ï¼Œä»–ä»¬ä¹Ÿå¯èƒ½å¸Œæœ›åœ¨ç”¨æˆ·ç©ºé—´é©±åŠ¨ä¸­ä½¿ç”¨åŠ¨æ€åˆ†é…çš„åŒºåŸŸã€‚ç‰¹åˆ«æ˜¯ï¼Œèƒ½å¤Ÿè®¿é—®é€šè¿‡ dma-mapping API æä¾›çš„å†…å­˜ï¼Œå¯èƒ½ç‰¹åˆ«æœ‰ç”¨ã€‚uio_dmem_genirq é©±åŠ¨æä¾›äº†ä¸€ç§æ–¹æ³•æ¥å®ç°è¿™ä¸€ç›®æ ‡ã€‚ åœ¨ä¸­æ–­é…ç½®å’Œå¤„ç†æ–¹é¢ï¼Œè¯¥é©±åŠ¨çš„ä½¿ç”¨æ–¹å¼ä¸ â€œuio_pdrv_genirqâ€ é©±åŠ¨ç±»ä¼¼ã€‚ å°† struct platform_device çš„ .name å…ƒç´ è®¾ç½®ä¸º &quot;uio_dmem_genirq &quot;æ¥ä½¿ç”¨è¿™ä¸ªé©±åŠ¨ã€‚ å½“ä½¿ç”¨è¿™ä¸ªé©±åŠ¨æ—¶ï¼Œå¡«å†™ struct platform_device çš„ .platform_data å…ƒç´ ï¼Œå®ƒçš„ç±»å‹æ˜¯ struct uio_dmem_genirq_pdataï¼Œå®ƒåŒ…å«ä»¥ä¸‹å…ƒç´ ï¼š struct uio_info uioinfoï¼šä¸ uio_pdrv_genirq å¹³å°æ•°æ®ä½¿ç”¨çš„ç»“æ„ç›¸åŒ unsigned int *dynamic_region_sizes:æŒ‡å‘å°†è¢«æ˜ å°„åˆ°ç”¨æˆ·ç©ºé—´çš„åŠ¨æ€å†…å­˜åŒºåŸŸå¤§å°åˆ—è¡¨çš„æŒ‡é’ˆã€‚ unsigned int num_dynamic_regions:dynamic_region_sizes æ•°ç»„ä¸­çš„å…ƒç´ æ•°é‡ã€‚ åœ¨å¹³å°æ•°æ®ä¸­å®šä¹‰çš„åŠ¨æ€åŒºåŸŸå°†è¢«é™„åŠ åˆ°å¹³å°è®¾å¤‡èµ„æºä¹‹åçš„ â€œmem[]â€ æ•°ç»„ä¸­ï¼Œè¿™æ„å‘³ç€é™æ€å’ŒåŠ¨æ€å†…å­˜åŒºåŸŸçš„æ€»æ•°ä¸èƒ½è¶…è¿‡ MAX_UIO_MAPSã€‚ åŠ¨æ€å†…å­˜åŒºåŸŸå°†åœ¨æ‰“å¼€ UIO è®¾å¤‡æ–‡ä»¶ /dev/uioX æ—¶è¢«åˆ†é…ã€‚ç±»ä¼¼äºé™æ€å†…å­˜èµ„æºï¼ŒåŠ¨æ€åŒºåŸŸçš„å†…å­˜åŒºåŸŸä¿¡æ¯ç„¶åé€šè¿‡ sysfs åœ¨ /sys/class/uio/uioX/maps/mapY/* å¤„å¯è§ã€‚å½“ IO è®¾å¤‡æ–‡ä»¶è¢«å…³é—­æ—¶ï¼ŒåŠ¨æ€å†…å­˜åŒºåŸŸå°†è¢«é‡Šæ”¾ã€‚å½“æ²¡æœ‰è¿›ç¨‹ä¿æŒè®¾å¤‡æ–‡ä»¶å¼€æ”¾æ—¶ï¼Œè¿”å›ç»™ç”¨æˆ·ç©ºé—´çš„åœ°å€æ˜¯ ~0ã€‚ åœ¨ç”¨æˆ·æ€ç¼–å†™ä¸€ä¸ªé©±åŠ¨ ä¸€æ—¦ä½ æœ‰ä¸€ä¸ªé€‚ç”¨äºä½ çš„ç¡¬ä»¶çš„å†…æ ¸æ¨¡å—ï¼Œä½ å°±å¯ä»¥ç¼–å†™ä½ çš„é©±åŠ¨ç¨‹åºçš„ç”¨æˆ·ç©ºé—´éƒ¨åˆ†ã€‚ä½ ä¸éœ€è¦ä»»ä½•ç‰¹æ®Šçš„åº“ï¼Œä½ çš„é©±åŠ¨ç¨‹åºå¯ä»¥ç”¨ä»»ä½•åˆç†çš„è¯­è¨€ç¼–å†™ï¼Œä½ å¯ä»¥ä½¿ç”¨æµ®ç‚¹æ•°å­—ç­‰ç­‰ã€‚ç®€è€Œè¨€ä¹‹ï¼Œä½ å¯ä»¥ä½¿ç”¨æ‰€æœ‰ä½ é€šå¸¸ç”¨äºç¼–å†™ç”¨æˆ·ç©ºé—´åº”ç”¨ç¨‹åºçš„å·¥å…·å’Œåº“ã€‚ è·å–æœ‰å…³ä½ çš„ UIO è®¾å¤‡çš„ä¿¡æ¯ æ‰€æœ‰ IO è®¾å¤‡çš„ä¿¡æ¯éƒ½å¯ä»¥åœ¨ sysfs ä¸­æ‰¾åˆ°ã€‚ä½ åº”è¯¥åœ¨ä½ çš„é©±åŠ¨ç¨‹åºä¸­åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯æ£€æŸ¥åç§°å’Œç‰ˆæœ¬ï¼Œä»¥ç¡®ä¿ä½ ä¸æ­£ç¡®çš„è®¾å¤‡å¯¹è¯ï¼Œå¹¶ä¸”å…¶å†…æ ¸é©±åŠ¨ç¨‹åºå…·æœ‰ä½ æœŸæœ›çš„ç‰ˆæœ¬ã€‚ ä½ è¿˜åº”è¯¥ç¡®ä¿ä½ éœ€è¦çš„å†…å­˜æ˜ å°„å­˜åœ¨ï¼Œå¹¶ä¸”æœ‰ä½ æœŸæœ›çš„å¤§å°ã€‚ æœ‰ä¸€ä¸ªå« lsuio çš„å·¥å…·ï¼Œå¯ä»¥åˆ—å‡º IO è®¾å¤‡å’Œå®ƒä»¬çš„å±æ€§ã€‚å®ƒå¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°ã€‚ http://www.osadl.org/projects/downloads/UIO/user/ ç”¨ lsuio ä½ å¯ä»¥å¿«é€Ÿæ£€æŸ¥ä½ çš„å†…æ ¸æ¨¡å—æ˜¯å¦è¢«åŠ è½½ï¼Œä»¥åŠå®ƒè¾“å‡ºäº†å“ªäº›å±æ€§ã€‚è¯¦æƒ…è¯·çœ‹ manpageã€‚ lsuio çš„æºä»£ç å¯ä»¥ä½œä¸ºä¸€ä¸ªä¾‹å­ï¼Œç”¨æ¥è·å–ä¸€ä¸ª IO è®¾å¤‡çš„ä¿¡æ¯ã€‚uio_helper.c æ–‡ä»¶åŒ…å«äº†å¾ˆå¤šå‡½æ•°ï¼Œä½ å¯ä»¥åœ¨ä½ çš„ç”¨æˆ·ç©ºé—´é©±åŠ¨ä»£ç ä¸­ä½¿ç”¨ã€‚ mmap() è®¾å¤‡å†…å­˜ åœ¨ä½ ç¡®å®šä½ å·²ç»å¾—åˆ°äº†æ­£ç¡®çš„è®¾å¤‡å’Œä½ éœ€è¦çš„å†…å­˜æ˜ å°„ä¹‹åï¼Œä½ è¦åšçš„å°±æ˜¯è°ƒç”¨ mmap() å°†è®¾å¤‡çš„å†…å­˜æ˜ å°„åˆ°ç”¨æˆ·ç©ºé—´ã€‚ mmap() è°ƒç”¨çš„å‚æ•° offset å¯¹äº IO è®¾å¤‡æœ‰ç‰¹æ®Šæ„ä¹‰ã€‚å®ƒè¢«ç”¨æ¥é€‰æ‹©ä½ è¦æ˜ å°„çš„è®¾å¤‡çš„æ˜ å°„ã€‚è¦æ˜ å°„Nä¸ªæ˜ å°„çš„å†…å­˜ï¼Œä½ å¿…é¡»ä½¿ç”¨ N å€çš„é¡µé¢å¤§å°ä½œä¸ºä½ çš„åç§»é‡ã€‚ 1offset = N * getpagesize()ã€‚ N ä» 0 å¼€å§‹ï¼Œæ‰€ä»¥å¦‚æœä½ åªæœ‰ä¸€ä¸ªå†…å­˜èŒƒå›´è¦æ˜ å°„ï¼Œå°±è®¾ç½® offset = 0ã€‚è¿™ç§æŠ€æœ¯çš„ç¼ºç‚¹æ˜¯ï¼Œå†…å­˜æ€»æ˜¯ä»å®ƒçš„èµ·å§‹åœ°å€å¼€å§‹æ˜ å°„ã€‚ ç­‰å¾…ä¸­æ–­ åœ¨ä½ æˆåŠŸåœ°æ˜ å°„äº†ä½ çš„è®¾å¤‡å†…å­˜åï¼Œä½ å¯ä»¥åƒæ™®é€šçš„æ•°ç»„ä¸€æ ·è®¿é—®å®ƒã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œä½ ä¼šè¿›è¡Œä¸€äº›åˆå§‹åŒ–ã€‚ä¹‹åï¼Œä½ çš„ç¡¬ä»¶å¼€å§‹å·¥ä½œï¼Œä¸€æ—¦å®Œæˆï¼Œæœ‰ä¸€äº›æ•°æ®å¯ç”¨ï¼Œæˆ–è€…å› ä¸ºå‘ç”Ÿé”™è¯¯è€Œéœ€è¦ä½ çš„æ³¨æ„ï¼Œå°±ä¼šäº§ç”Ÿä¸€ä¸ªä¸­æ–­ã€‚ /dev/uioX æ˜¯ä¸€ä¸ªåªè¯»æ–‡ä»¶ã€‚read() å°†æ€»æ˜¯é˜»å¡ï¼Œç›´åˆ°ä¸­æ–­å‘ç”Ÿã€‚read() çš„ count å‚æ•°åªæœ‰ä¸€ä¸ªåˆæ³•çš„å€¼ï¼Œé‚£å°±æ˜¯ä¸€ä¸ªæœ‰ç¬¦å·çš„32ä½æ•´æ•°çš„å¤§å°(4)ã€‚ä»»ä½•å…¶ä»–çš„ count å€¼éƒ½ä¼šå¯¼è‡´ read() å¤±è´¥ã€‚è¯»å–çš„æœ‰ç¬¦å·çš„ 32 ä½æ•´æ•°æ˜¯ä½ è®¾å¤‡çš„ä¸­æ–­è®¡æ•°ã€‚å¦‚æœè¿™ä¸ªå€¼æ¯”ä½ ä¸Šæ¬¡è¯»åˆ°çš„å€¼å¤šä¸€ä¸ªï¼Œåˆ™ä¸€åˆ‡æ­£å¸¸ã€‚å¦‚æœå·®å€¼å¤§äº 1ï¼Œä½ å°±é”™è¿‡äº†ä¸­æ–­ã€‚ ä½ ä¹Ÿå¯ä»¥åœ¨ /dev/uioX ä¸Šä½¿ç”¨ select()ã€‚ é€šç”¨çš„ PCI UIO é©±åŠ¨ é€šç”¨é©±åŠ¨ç¨‹åºæ˜¯ä¸€ä¸ªåä¸º uio_pci_generic çš„å†…æ ¸æ¨¡å—ã€‚å®ƒå¯ä»¥ä¸ä»»ä½•ç¬¦åˆ PCI 2.3ï¼ˆ2002 å¹´å·¦å³ï¼‰çš„è®¾å¤‡å’Œä»»ä½•ç¬¦åˆ PCI Express çš„è®¾å¤‡ä¸€èµ·å·¥ä½œã€‚ä½¿ç”¨å®ƒï¼Œä½ åªéœ€è¦ç¼–å†™ç”¨æˆ·ç©ºé—´é©±åŠ¨ç¨‹åºï¼Œè€Œä¸éœ€è¦ç¼–å†™ç‰¹å®šç¡¬ä»¶çš„å†…æ ¸æ¨¡å—ã€‚ è®©é©±åŠ¨è¯†åˆ«è®¾å¤‡ ç”±äºé©±åŠ¨ç¨‹åºæ²¡æœ‰å£°æ˜ä»»ä½•è®¾å¤‡ IDï¼Œå®ƒä¸ä¼šè¢«è‡ªåŠ¨åŠ è½½ï¼Œä¹Ÿä¸ä¼šè‡ªåŠ¨ä¸ä»»ä½•è®¾å¤‡ç»‘å®šï¼Œä½ å¿…é¡»è‡ªå·±åŠ è½½å®ƒå¹¶åˆ†é… ID ç»™é©±åŠ¨ç¨‹åºã€‚æ¯”å¦‚è¯´ï¼š 12modprobe uio_pci_genericecho &quot;8086 10f5&quot; &gt; /sys/bus/pci/drivers/uio_pci_generic/new_id å¦‚æœä½ çš„è®¾å¤‡å·²ç»æœ‰ä¸€ä¸ªç‰¹å®šç¡¬ä»¶çš„å†…æ ¸é©±åŠ¨ï¼Œé€šç”¨é©±åŠ¨ä»ç„¶ä¸ä¼šä¸ä¹‹ç»‘å®šï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœä½ æƒ³ä½¿ç”¨é€šç”¨é©±åŠ¨ï¼ˆä¸ºä»€ä¹ˆè¦è¿™æ ·åšï¼Ÿï¼‰ï¼Œä½ å¿…é¡»æ‰‹åŠ¨è§£é™¤ä¸ç‰¹å®šç¡¬ä»¶é©±åŠ¨çš„ç»‘å®šï¼Œç„¶åç»‘å®šé€šç”¨é©±åŠ¨ï¼Œåƒè¿™æ ·ã€‚ 12echo -n 0000:00:19.0 &gt; /sys/bus/pci/drivers/e1000e/unbindecho -n 0000:00:19.0 &gt; /sys/bus/pci/drivers/uio_pci_generic/bind ä½ å¯ä»¥é€šè¿‡åœ¨ sysfs ä¸­å¯»æ‰¾è®¾å¤‡æ¥éªŒè¯å®ƒæ˜¯å¦å·²ç»è¢«ç»‘å®šåˆ°äº†é©±åŠ¨ç¨‹åºä¸Šï¼Œä¾‹å¦‚: 1ls -l /sys/bus/pci/devices/0000:00:19.0/driver å¦‚æœæˆåŠŸçš„è¯ï¼Œåº”è¯¥å¯ä»¥æ‰“å°å‡ºæ¥ï¼š 1.../0000:00:19.0/driver -&gt; ../../../bus/pci/drivers/uio_pci_generic æ³¨æ„ï¼Œé€šç”¨é©±åŠ¨ç¨‹åºä¸ä¼šç»‘å®šåˆ°æ—§çš„PCI 2.2è®¾å¤‡ã€‚å¦‚æœç»‘å®šè®¾å¤‡å¤±è´¥ï¼Œè¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š 1dmesg å¹¶åœ¨è¾“å‡ºä¸­å¯»æ‰¾å¤±è´¥çš„åŸå› ã€‚ å…³äº uio_pci_generic éœ€è¦çŸ¥é“çš„äº‹æƒ… ä¸­æ–­æ˜¯ä½¿ç”¨ PCI å‘½ä»¤å¯„å­˜å™¨ä¸­çš„ä¸­æ–­ç¦ç”¨ä½å’Œ PCI çŠ¶æ€å¯„å­˜å™¨ä¸­çš„ä¸­æ–­çŠ¶æ€ä½æ¥å¤„ç†çš„ã€‚æ‰€æœ‰ç¬¦åˆPCI 2.3ï¼ˆ2002 å¹´å·¦å³ï¼‰çš„è®¾å¤‡å’Œæ‰€æœ‰ç¬¦åˆ PCI Express çš„è®¾å¤‡éƒ½åº”è¯¥æ”¯æŒè¿™äº›ä½ã€‚ uio_pci_generic ä¼šæ£€æµ‹è¿™ç§æ”¯æŒï¼Œå¹¶ä¸”ä¸ä¼šç»‘å®šä¸æ”¯æŒå‘½ä»¤å¯„å­˜å™¨ä¸­ä¸­æ–­ç¦ç”¨ä½çš„è®¾å¤‡ã€‚ åœ¨æ¯ä¸ªä¸­æ–­ä¸­ï¼Œuio_pci_generic è®¾ç½®ä¸­æ–­ç¦ç”¨ä½ã€‚è¿™å°†é˜»æ­¢è®¾å¤‡äº§ç”Ÿè¿›ä¸€æ­¥çš„ä¸­æ–­ï¼Œç›´åˆ°è¯¥ä½è¢«æ¸…é™¤ã€‚ç”¨æˆ·ç©ºé—´é©±åŠ¨ç¨‹åºåº”è¯¥åœ¨é˜»å¡å’Œç­‰å¾…æ›´å¤šçš„ä¸­æ–­ä¹‹å‰æ¸…é™¤è¿™ä¸ªä½ã€‚ ä½¿ç”¨ uio_pci_generic ç¼–å†™ç”¨æˆ·ç©ºé—´é©±åŠ¨ç¨‹åº ç”¨æˆ·ç©ºé—´é©±åŠ¨ç¨‹åºå¯ä»¥ä½¿ç”¨ PCI çš„ sysfs æ¥å£ï¼Œæˆ–è€…åŒ…è£…å®ƒçš„ libpci åº“ï¼Œæ¥ä¸è®¾å¤‡å¯¹è¯ï¼Œå¹¶é€šè¿‡å‘å‘½ä»¤å¯„å­˜å™¨å†™ä¿¡æ¥é‡æ–°å¯ç”¨ä¸­æ–­ã€‚ ä½¿ç”¨ uio_pci_generic çš„ç¤ºä¾‹ä»£ç  ä¸‹é¢æ˜¯ä¸€äº›ä½¿ç”¨uio_pci_genericçš„ç”¨æˆ·ç©ºé—´é©±åŠ¨ä»£ç ç¤ºä¾‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465#include &lt;stdlib.h&gt;#include &lt;stdio.h&gt;#include &lt;unistd.h&gt;#include &lt;sys/types.h&gt;#include &lt;sys/stat.h&gt;#include &lt;fcntl.h&gt;#include &lt;errno.h&gt;int main()&#123; int uiofd; int configfd; int err; int i; unsigned icount; unsigned char command_high; uiofd = open(\"/dev/uio0\", O_RDONLY); if (uiofd &lt; 0) &#123; perror(\"uio open:\"); return errno; &#125; configfd = open(\"/sys/class/uio/uio0/device/config\", O_RDWR); if (configfd &lt; 0) &#123; perror(\"config open:\"); return errno; &#125; /* Read and cache command value */ err = pread(configfd, &amp;command_high, 1, 5); if (err != 1) &#123; perror(\"command config read:\"); return errno; &#125; command_high &amp;= ~0x4; for(i = 0;; ++i) &#123; /* Print out a message, for debugging. */ if (i == 0) fprintf(stderr, \"Started uio test driver.\\n\"); else fprintf(stderr, \"Interrupts: %d\\n\", icount); /****************************************/ /* Here we got an interrupt from the device. Do something to it. */ /****************************************/ /* Re-enable interrupts. */ err = pwrite(configfd, &amp;command_high, 1, 5); if (err != 1) &#123; perror(\"config write:\"); break; &#125; /* Wait for next interrupt. */ err = read(uiofd, &amp;icount, 4); if (err != 4) &#123; perror(\"uio read:\"); break; &#125; &#125; return errno;&#125; é€šç”¨çš„ Hyper-V UIO é©±åŠ¨ è¿™ä¸ªé€šç”¨é©±åŠ¨ç¨‹åºæ˜¯ä¸€ä¸ªåä¸º uio_hv_generic çš„å†…æ ¸æ¨¡å—ã€‚å®ƒæ”¯æŒ Hyper-V VMBus ä¸Šçš„è®¾å¤‡ï¼Œä¸ PCI æ€»çº¿ä¸Šçš„ uio_pci_generic ç±»ä¼¼ã€‚ è®©é©±åŠ¨è¯†åˆ«è®¾å¤‡ ç”±äºè¯¥é©±åŠ¨æ²¡æœ‰å£°æ˜ä»»ä½•è®¾å¤‡çš„ GUIDï¼Œå®ƒä¸ä¼šè¢«è‡ªåŠ¨åŠ è½½ï¼Œä¹Ÿä¸ä¼šè‡ªåŠ¨ç»‘å®šä»»ä½•è®¾å¤‡ï¼Œä½ å¿…é¡»è‡ªå·±åŠ è½½å®ƒå¹¶åˆ†é… ID ç»™è¯¥é©±åŠ¨ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ç½‘ç»œè®¾å¤‡ç±» GUIDï¼š 12modprobe uio_hv_genericecho &quot;f8615163-df3e-46c5-913f-f2d2f965ed0e&quot; &gt; /sys/bus/vmbus/drivers/uio_hv_generic/new_id å¦‚æœè¯¥è®¾å¤‡å·²ç»æœ‰ä¸€ä¸ªç‰¹å®šç¡¬ä»¶çš„å†…æ ¸é©±åŠ¨ï¼Œé€šç”¨é©±åŠ¨ä»ç„¶ä¸ä¼šä¸ä¹‹ç»‘å®šï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœä½ æƒ³åœ¨ç”¨æˆ·ç©ºé—´åº“ä¸­ä½¿ç”¨é€šç”¨é©±åŠ¨ï¼Œä½ å¿…é¡»æ‰‹åŠ¨è§£é™¤å¯¹ç‰¹å®šç¡¬ä»¶é©±åŠ¨çš„ç»‘å®šï¼Œå¹¶ç»‘å®šé€šç”¨é©±åŠ¨ï¼Œåƒè¿™æ ·ä½¿ç”¨ç‰¹å®šè®¾å¤‡çš„ GUIDï¼š 12echo -n ed963694-e847-4b2a-85af-bc9cfc11d6f3 &gt; /sys/bus/vmbus/drivers/hv_netvsc/unbindecho -n ed963694-e847-4b2a-85af-bc9cfc11d6f3 &gt; /sys/bus/vmbus/drivers/uio_hv_generic/bind ä½ å¯ä»¥é€šè¿‡åœ¨sysfsä¸­å¯»æ‰¾è®¾å¤‡æ¥éªŒè¯å®ƒæ˜¯å¦å·²ç»è¢«ç»‘å®šåˆ°äº†é©±åŠ¨ç¨‹åºä¸Šï¼Œä¾‹å¦‚ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 1ls -l /sys/bus/vmbus/devices/ed963694-e847-4b2a-85af-bc9cfc11d6f3/driver å¦‚æœæˆåŠŸçš„è¯ï¼Œåº”è¯¥æ‰“å°å‡ºæ¥ä»¥ä¸‹å†…å®¹ï¼š 1.../ed963694-e847-4b2a-85af-bc9cfc11d6f3/driver -&gt; ../../../bus/vmbus/drivers/uio_hv_generic å…³äº uio_hv_generic éœ€è¦çŸ¥é“çš„äº‹ åœ¨æ¯ä¸ªä¸­æ–­ä¸­ï¼Œuio_hv_generic è®¾ç½®ä¸­æ–­ç¦ç”¨ä½ã€‚è¿™å°†é˜»æ­¢è®¾å¤‡äº§ç”Ÿè¿›ä¸€æ­¥çš„ä¸­æ–­ï¼Œç›´åˆ°è¯¥ä½è¢«æ¸…é™¤ã€‚ç”¨æˆ·ç©ºé—´é©±åŠ¨ç¨‹åºåº”è¯¥åœ¨é˜»å¡å’Œç­‰å¾…æ›´å¤šçš„ä¸­æ–­ä¹‹å‰æ¸…é™¤è¿™ä¸ªä½ã€‚ å½“ä¸»æœºæ’¤é”€ä¸€ä¸ªè®¾å¤‡æ—¶ï¼Œä¸­æ–­æ–‡ä»¶æè¿°ç¬¦è¢«æ ‡è®°ä¸‹æ¥ï¼Œä»»ä½•å¯¹ä¸­æ–­æ–‡ä»¶æè¿°ç¬¦çš„è¯»å–å°†è¿”å› -EIOã€‚ç±»ä¼¼äºä¸€ä¸ªå…³é—­çš„å¥—æ¥å­—æˆ–æ–­å¼€çš„ä¸²è¡Œè®¾å¤‡ã€‚ vmbus è®¾å¤‡åŒºåŸŸè¢«æ˜ å°„ä¸º uio è®¾å¤‡èµ„æºï¼š é€šé“ç¯å½¢ç¼“å†²åŒºï¼šå®¢æˆ·æœºåˆ°ä¸»æœºå’Œä¸»æœºåˆ°å®¢æˆ·æœº è®¿å®¢åˆ°ä¸»æœºçš„ä¸­æ–­ä¿¡å·é¡µ è®¿å®¢åˆ°ä¸»æœºçš„ç›‘æ§é¡µ ç½‘ç»œæ¥æ”¶ç¼“å†²åŒº ç½‘ç»œå‘é€ç¼“å†²åŒº å¦‚æœä¸€ä¸ªå­é€šé“æ˜¯ç”±å¯¹ä¸»æœºçš„è¯·æ±‚åˆ›å»ºçš„ï¼Œé‚£ä¹ˆ uio_hv_generic è®¾å¤‡é©±åŠ¨å°†ä¸ºæ¯ä¸ªé€šé“ç¯å½¢ç¼“å†²åŒºåˆ›å»ºä¸€ä¸ª sysfs äºŒè¿›åˆ¶æ–‡ä»¶ã€‚æ¯”å¦‚è¯´ 1/sys/bus/vmbus/devices/3811fe4d-0fa0-4b62-981a-74fc1084c757/channels/21/ring","categories":[{"name":"Linux","slug":"Linux","permalink":"https://blog.inoki.cc/categories/Linux/"}],"tags":[{"name":"ç¿»è¯‘","slug":"ç¿»è¯‘","permalink":"https://blog.inoki.cc/tags/ç¿»è¯‘/"},{"name":"ä¸­æ–‡","slug":"ä¸­æ–‡","permalink":"https://blog.inoki.cc/tags/ä¸­æ–‡/"},{"name":"Linux","slug":"Linux","permalink":"https://blog.inoki.cc/tags/Linux/"}]},{"title":"ã€è¯‘ã€‘Linux å†…æ ¸ä¸­ EXPORT_SYMBOL_GPL çš„æ„ä¹‰","slug":"On-the-value-of-export-symbol-gpl","date":"2021-11-19T15:34:00.000Z","updated":"2025-03-08T09:40:48.591Z","comments":true,"path":"2021/11/19/On-the-value-of-export-symbol-gpl/","link":"","permalink":"https://blog.inoki.cc/2021/11/19/On-the-value-of-export-symbol-gpl/","excerpt":"","text":"åŸæ–‡é“¾æ¥ï¼šOn the value of EXPORT_SYMBOL_GPL å½“ä¸€ä¸ªå¯åŠ è½½æ¨¡å—è¢«æ’å…¥æ—¶ï¼Œå®ƒå¯¹å†…æ ¸å‡½æ•°å’Œæ•°æ®ç»“æ„çš„ä»»ä½•å¼•ç”¨å¿…é¡»ä¸å½“å‰è¿è¡Œçš„å†…æ ¸é“¾æ¥ã€‚ç„¶è€Œï¼Œæ¨¡å—åŠ è½½å™¨å¹¶ä¸æä¾›å¯¹æ‰€æœ‰å†…æ ¸ç¬¦å·çš„è®¿é—®ï¼›åªæœ‰é‚£äº›è¢«æ˜ç¡®è¢«å¯¼å‡ºçš„æ‰æ˜¯å¯ç”¨çš„ã€‚å¯¼å‡ºè¿™ä¸ªéœ€æ±‚å‡å°‘äº†æ¨¡å—å¯ä»¥çœ‹åˆ°çš„ APIï¼Œå°½ç®¡æ²¡æœ‰å‡å°‘é‚£ä¹ˆå¤šï¼šåœ¨ 2.6.13 å†…æ ¸ä¸­æœ‰è¶…è¿‡ 6000 ä¸ªç¬¦å·è¢«å¯¼å‡ºã€‚ å¯¼å‡ºæœ‰ä¸¤ç§å½¢å¼ï¼švanillaï¼ˆEXPORT_SYMBOLï¼‰å’Œ GPL-onlyï¼ˆEXPORT_SYMBOL_GPLï¼‰ã€‚å‰è€…å¯ç”¨äºä»»ä½•å†…æ ¸æ¨¡å—ï¼Œè€Œåè€…ä¸èƒ½è¢«ä»»ä½•æ²¡æœ‰ GPL å…¼å®¹è®¸å¯è¯çš„æ¨¡å—ä½¿ç”¨ã€‚å¦‚æœæ¨¡å—å£°æ˜çš„è®¸å¯è¯ä¸åˆæ ¼ï¼Œæ¨¡å—åŠ è½½å™¨å°†é€šè¿‡æ‹’ç»è®¿é—®åªé€‚ç”¨äº GPL çš„ç¬¦å·æ¥æ‰§è¡Œè¿™ä¸€åŒºåˆ«ã€‚ç›®å‰ï¼Œåªæœ‰ä¸åˆ° 10% çš„å†…æ ¸ç¬¦å·æ˜¯ GPL-only çš„ï¼Œä½†æ˜¯ GPL-only ç¬¦å·çš„æ•°é‡æ­£åœ¨å¢é•¿ã€‚åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œæœ‰ä¸€å®šçš„å‹åŠ›ä½¿æ–°çš„å¯¼å‡ºåªé€‚ç”¨äº GPLã€‚ ç»å¸¸æœ‰äººäº‰è®ºè¯´ï¼Œè¿™ä¸¤ç§ç±»å‹çš„å¯¼å‡ºæ²¡æœ‰å®é™…åŒºåˆ«ã€‚é‚£äº›è®¤ä¸ºæ‰€æœ‰çš„å†…æ ¸æ¨¡å—éƒ½è¢«å†…æ ¸è®¸å¯è¯è¦æ±‚ä¸º GPL è®¸å¯è¯çš„äººè®¤ä¸ºæ‰€æœ‰çš„ç¬¦å·åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½æ˜¯éšå«çš„ GPL-onlyã€‚å¦ä¸€ä¸ªé˜µè¥è®¤ä¸ºæ¨¡å—æ¥å£æ˜¯ GPL ä¸èƒ½è·¨è¶Šçš„è¾¹ç•Œï¼Œä»–ä»¬ä¸ç›¸ä¿¡åªé€‚ç”¨äº GPL çš„é™åˆ¶å¯ä»¥è¢«åšæŒã€‚åœ¨ä»»ä½•æƒ…å†µä¸‹ï¼Œåªé€‚ç”¨äº GPL çš„ç¬¦å·å¯ä»¥å¾ˆå®¹æ˜“åœ°é€šè¿‡ä¿®è¡¥å†…æ ¸ã€è™šå‡å£°æ˜ GPL å…¼å®¹çš„è®¸å¯è¯ï¼Œæˆ–è€…é€šè¿‡æ’å…¥ä¸€ä¸ªæä¾›æ›´å¹¿æ³›è®¿é—®æ„Ÿå…´è¶£çš„ç¬¦å·çš„å«ç‰‡æ¨¡å—è€Œè¢«è§„é¿ã€‚ ç„¶è€Œï¼ŒLinus è®¤ä¸ºï¼Œä»…å…è®¸ GPL çš„å¯¼å‡ºæ˜¯é‡è¦çš„ã€‚ æˆ‘å’Œä¸€ä¸¤ä¸ªå¾‹å¸ˆè°ˆè¿‡ï¼Œè¿™(a)ç»å¯¹æœ‰ å·¨å¤§ çš„åŒºåˆ«ï¼Œ(b)ä»–ä»¬å–œæ¬¢è¿™æ ·ã€‚ äº‹å®æ˜¯ï¼Œæ³•å¾‹å¹¶ä¸æ˜¯ä¸€å°ç›²ç›®çš„ã€æ— æ„è¯†çš„è®¡ç®—æœºï¼Œä¸ä¼šç…§å­—é¢æ„æ€å»ç†è§£ä½ æ‰€è¯´çš„ä¸œè¥¿ã€‚æ„å›¾æ˜¯éå¸¸é‡è¦çš„ã€‚è€Œç”¨ xxx_GPL() çš„ç‰ˆæœ¬æ¥è¡¨æ˜å®ƒæ˜¯ä¸€ä¸ªå†…éƒ¨æ¥å£ï¼Œç¡®å®éå¸¸æœ‰æ„ä¹‰ã€‚ å…¶ä¸­ä¸€ä½å¾‹å¸ˆè¯´ï¼Œè¿™æ¯”è¯•å›¾è®©è®¸å¯è¯è§£é‡Šæ‰€æœ‰çš„ç»†èŠ‚è¦å¥½å¾—å¤šâ€”â€”å°†æ„å›¾ç¼–å…¥ä»£ç æœ¬èº«ä¸ä»…æ›´çµæ´»ï¼Œè€Œä¸”æ›´ä¸å®¹æ˜“è¢«è¯¯è§£ã€‚ ä»–è¿˜æŒ‡å‡ºï¼Œè§„é¿çº¯ GPL çš„å¯¼å‡ºéœ€è¦ä¸€ä¸ªæ˜ç¡®çš„è¡ŒåŠ¨ï¼Œä½¿å…¶æ˜ç¡®ç”±æ­¤äº§ç”Ÿçš„ç‰ˆæƒä¾µçŠ¯æ˜¯ä¸€ä¸ªæ•…æ„çš„è¡Œä¸ºã€‚ ä¸ç®¡å®ƒä»¬æ˜¯å¦æœ‰ä»»ä½•æ³•å¾‹æ„ä¹‰ï¼Œåªé€‚ç”¨äº GPL çš„å¯¼å‡ºç¡®å®æˆåŠŸåœ°ä¼ è¾¾äº†å†…æ ¸å¼€å‘ç¤¾åŒºä¸­å¸Œæœ›é™åˆ¶ä½¿ç”¨éè‡ªç”±å†…æ ¸æ¨¡å—çš„å¤§é‡å­é›†çš„æ„æ„¿ã€‚å½»åº•ç¦æ­¢è¿™ç±»æ¨¡å—å¯èƒ½ä¸ä¼šå¾ˆå¿«è¢«æä¸Šæ—¥ç¨‹ï¼Œä½†å®ƒä»¬çš„åŠŸèƒ½ä¹Ÿä¸å¯èƒ½æœ‰å¤ªå¤§å¢é•¿ã€‚","categories":[{"name":"Linux","slug":"Linux","permalink":"https://blog.inoki.cc/categories/Linux/"}],"tags":[{"name":"ç¿»è¯‘","slug":"ç¿»è¯‘","permalink":"https://blog.inoki.cc/tags/ç¿»è¯‘/"},{"name":"ä¸­æ–‡","slug":"ä¸­æ–‡","permalink":"https://blog.inoki.cc/tags/ä¸­æ–‡/"},{"name":"Linux","slug":"Linux","permalink":"https://blog.inoki.cc/tags/Linux/"}]},{"title":"ã€è¯‘ã€‘ä¸‰é˜¶æˆªç‚¹ï¼ˆIP3ï¼‰çš„ç‰©ç†æ„ä¹‰","slug":"Physical-significance-iip3-important-receiver-chain","date":"2021-11-12T15:38:00.000Z","updated":"2025-03-08T09:40:48.591Z","comments":true,"path":"2021/11/12/Physical-significance-iip3-important-receiver-chain/","link":"","permalink":"https://blog.inoki.cc/2021/11/12/Physical-significance-iip3-important-receiver-chain/","excerpt":"","text":"åŸæ–‡é“¾æ¥ï¼šWhat is physical significance of IP3, why it is more important in Receiver Chain ? äº†è§£ä¸‰é˜¶æˆªç‚¹ï¼ˆIP3ï¼‰çš„ç‰©ç†æ„ä¹‰ å½“ä¸€ä¸ªæ”¾å¤§å™¨æˆ–å…¶ä»–ç”µè·¯å˜å¾—éçº¿æ€§æ—¶ï¼Œå®ƒå°†å¼€å§‹äº§ç”Ÿæ”¾å¤§çš„è¾“å…¥çš„è°æ³¢ã€‚äºŒæ¬¡ã€ä¸‰æ¬¡å’Œæ›´é«˜æ¬¡çš„è°æ³¢é€šå¸¸åœ¨æ”¾å¤§å™¨å¸¦å®½ä¹‹å¤–ï¼Œæ‰€ä»¥å®ƒä»¬é€šå¸¸å¾ˆå®¹æ˜“è¿‡æ»¤æ‰ã€‚ç„¶è€Œï¼Œéçº¿æ€§ä¹Ÿä¼šäº§ç”Ÿä¸¤ä¸ªæˆ–å¤šä¸ªä¿¡å·çš„æ··åˆæ•ˆåº”ã€‚ å¦‚æœä¿¡å·çš„é¢‘ç‡å¾ˆæ¥è¿‘ï¼Œäº§ç”Ÿçš„ä¸€äº›ç§°ä¸ºäº’è°ƒäº§ç‰©ï¼ˆIntermodulation productsï¼‰çš„å’Œå·®é¢‘ç‡ä¼šå‡ºç°åœ¨æ”¾å¤§å™¨çš„é¢„æœŸå·¥ä½œå¸¦å®½å†…ã€‚è¿™äº›ä¸èƒ½è¢«è¿‡æ»¤æ‰ï¼Œæ‰€ä»¥å®ƒä»¬æœ€ç»ˆä¼šæˆä¸ºè¢«æ”¾å¤§çš„ä¸»è¦ä¿¡å·ä¸­çš„å¹²æ‰°ä¿¡å·ã€‚ ä¸¾ä¾‹æ¥è¯´ï¼šæ¥æ”¶é“¾ä¸­çš„æœŸæœ›è¾“å…¥ä¿¡å·ï¼ˆF0ï¼‰åœ¨ 1750MHzï¼Œä¸¤ä¸ªä¸æœŸæœ›çš„ä¿¡å·ï¼ŒF1=1760ï¼ŒF2=1770ï¼Œæ‰€ä»¥å½“ä¸¤ä¸ªä¸æœŸæœ›çš„ä¿¡å·æ··åˆæ—¶ï¼Œå®ƒä»¬ä¼šäº§ç”Ÿä¸‰é˜¶äº’è°ƒäº§ç‰©ï¼Œå…¶ä¸­ä¸€ä¸ªåœ¨ï¼ˆ2*F1-F2ï¼‰è½åœ¨ 1750MHzï¼Œè¿™ä¹Ÿæ˜¯æœŸæœ›ä¿¡å·çš„é¢‘ç‡ï¼Œå› æ­¤æœŸæœ›ä¿¡å·çš„ SNR ä¼šé™ä½ã€‚ ä¸‰é˜¶äº’è°ƒäº§ç‰©çš„åŠŸç‡æ°´å¹³å–å†³äºè®¾å¤‡æˆ–æ”¾å¤§å™¨çš„çº¿æ€§åº¦ï¼Œä»¥ä¸‰é˜¶æˆªç‚¹ï¼ˆIP3ï¼‰è¡¨ç¤ºã€‚ ä¸‰é˜¶æˆªç‚¹ï¼ˆIP3ï¼‰å¤„çš„è¾“å‡ºè¶Šé«˜ï¼Œçº¿æ€§åº¦è¶Šå¥½ï¼Œäº’è°ƒæ‰°åŠ¨ï¼ˆIMDï¼‰è¶Šä½ã€‚IP3 å€¼æœ¬è´¨ä¸Šè¡¨æ˜åœ¨ IMD å‘ç”Ÿä¹‹å‰ï¼Œæ”¾å¤§å™¨å¯ä»¥å¤„ç†å¤šå¤§çš„ä¿¡å·ã€‚ä¾‹å¦‚ï¼ŒIP3 å€¼ä¸º 25 dBm æ¯” 18 dBm çš„è¦å¥½ã€‚ ä¸ºä»€ä¹ˆ IP3 åœ¨æ¥æ”¶é“¾ä¸­è¢«æµ‹é‡ åœ¨æ¥æ”¶é“¾ä¸­ï¼Œå¤šä¸ªä¿¡å·é€šè¿‡å¤©çº¿ç«¯å£è¾“å…¥ï¼Œç”±äºå¹²æ‰°ä¿¡å·åœ¨å¤©çº¿ç«¯å£çš„æ··åˆï¼Œäº§ç”Ÿçš„ IMD ä¼šåœ¨æ‰€éœ€çš„é¢‘æ®µæ··åˆï¼Œä»è€Œå½±å“æ‰€éœ€ä¿¡å·çš„ä¿¡å™ªæ¯”ã€‚æˆ‘ä»¬æ— æ³•æ§åˆ¶å¤©çº¿ç«¯å£çš„å¹²æ‰°ä¿¡å·ï¼Œå› ä¸ºåœ¨ç©ºæ°”ä¸­å­˜åœ¨ç€ä¸åŒé¢‘ç‡çš„ä¸åŒç±»å‹çš„ä¿¡å·ã€‚å®ƒä»¬ä¸­çš„å°‘æ•°ä¼šåœ¨æ‰€éœ€çš„é¢‘æ®µä¸Šå¼•èµ· IMDã€‚ å› æ­¤ï¼Œæµ‹é‡æ¥æ”¶å™¨çš„ä¸‰é˜¶è¾“å…¥æˆªç‚¹ï¼ˆIIP3ï¼‰å˜å¾—éå¸¸é‡è¦ï¼Œä»¥ç¡®ä¿å®ƒäº§ç”Ÿå¤šå°‘å½±å“ä¿¡å™ªæ¯”çš„ IMD æ°´å¹³ã€‚ æ¥æ”¶å™¨é“¾çš„ IIP3 å€¼è¶Šé«˜ï¼Œæ€§èƒ½å°±è¶Šå¥½ï¼Œå› ä¸º IMD åŠŸç‡æ°´å¹³æ›´ä½ã€‚å› æ­¤ï¼Œå®ƒè¡¨æ˜ä¸€ä¸ªè®¾å¤‡ï¼ˆå¦‚æ”¾å¤§å™¨ï¼‰æˆ–ç³»ç»Ÿï¼ˆå¦‚æ¥æ”¶å™¨ï¼‰åœ¨å¼ºä¿¡å·ä¸‹çš„è¡¨ç°å¦‚ä½•ã€‚ å‘å°„å™¨é“¾ä¸­çš„ IP3 æ˜¯ä»€ä¹ˆï¼Ÿ åœ¨å‘å°„é“¾ä¸­ï¼Œé€šå¸¸ IP3 è§„æ ¼ä¸å¤ªé‡è¦ï¼Œå› ä¸ºåœ¨å‘å°„é“¾ä¸­äº§ç”Ÿçš„ä¿¡å·é€šå¸¸æ˜¯å•è½½æ³¢ï¼Œä¸ä¼šäº§ç”Ÿ IMDã€‚ä¾‹å¦‚ï¼Œåœ¨å•è½½æ³¢ GSM ä¸­ï¼Œä¼ è¾“çš„æ˜¯ä¸€ä¸ªè½½æ³¢ä¿¡å·ï¼Œä¸ä¼šäº§ç”Ÿ IMDã€‚åœ¨å¤šè½½æ³¢ GSM ä¸­ï¼Œä¼šäº§ç”Ÿ IMDï¼Œå› ä¸ºå‘å°„é“¾ä¸­çš„å¤šä¸ªä¿¡å·æ··åˆåœ¨ä¸€èµ·ï¼Œäº§ç”Ÿäº’è°ƒäº§ç‰©ã€‚åœ¨å¤šè½½æ³¢ç³»ç»Ÿä¸­ï¼Œå‘å°„å™¨é“¾ä¸­çš„è¾“å‡ºæˆªç‚¹è¢«æµ‹é‡ï¼ˆOIP3ï¼‰æˆ–å‘æŒ¥ç€é‡è¦ä½œç”¨ã€‚ åœ¨ LTE ç³»ç»Ÿä¸­ï¼Œåªäº§ç”Ÿä¸€ä¸ªè½½æ³¢ï¼Œæ‰€ä»¥ OIP3 å°±ä¸é‚£ä¹ˆé‡è¦äº†ã€‚åœ¨ LTE Advanced ä¸­ï¼Œç”±äºè½½æ³¢èšåˆï¼Œä¼šäº§ç”Ÿå¤šä¸ªè½½æ³¢ï¼Œæ‰€ä»¥ OIP3 åœ¨è¿™ç§æƒ…å†µä¸‹å¾ˆé‡è¦ã€‚ ä½†æ˜¯ï¼Œå³ä½¿åœ¨å‘å°„æœºé“¾ä¸­äº§ç”Ÿäº†å•è½½æ³¢ï¼Œåœ¨ä»»ä½•æƒ…å†µä¸‹ï¼Œå¹²æ‰°ä¿¡å·éƒ½å¯èƒ½é€šè¿‡å¤©çº¿ç«¯å£ä»¥ç›¸åçš„æ–¹å‘è¿›å…¥å‘å°„æœºé“¾è€Œå¯¼è‡´äº’è°ƒäº§ç‰©ï¼Œæ‰€ä»¥é€šå¸¸åœ¨å‘å°„æœºé“¾ä¸­æµ‹é‡åå‘äº’è°ƒã€‚","categories":[{"name":"Translation","slug":"Translation","permalink":"https://blog.inoki.cc/categories/Translation/"},{"name":"Chinese","slug":"Translation/Chinese","permalink":"https://blog.inoki.cc/categories/Translation/Chinese/"},{"name":"SDR","slug":"SDR","permalink":"https://blog.inoki.cc/categories/SDR/"}],"tags":[{"name":"ç¿»è¯‘","slug":"ç¿»è¯‘","permalink":"https://blog.inoki.cc/tags/ç¿»è¯‘/"},{"name":"ä¸­æ–‡","slug":"ä¸­æ–‡","permalink":"https://blog.inoki.cc/tags/ä¸­æ–‡/"},{"name":"SDR","slug":"SDR","permalink":"https://blog.inoki.cc/tags/SDR/"}]},{"title":"Android å¯åŠ¨åŠ è½½å™¨åˆ†æ â€”â€” ABL(3)","slug":"android-bootloader-analysis-abl-3","date":"2021-10-24T22:48:00.000Z","updated":"2025-03-08T09:40:48.607Z","comments":true,"path":"2021/10/24/android-bootloader-analysis-abl-3/","link":"","permalink":"https://blog.inoki.cc/2021/10/24/android-bootloader-analysis-abl-3/","excerpt":"","text":"æˆ‘çš„å‰ä¸€ç¯‡æ–‡ç« ã€ŠAndroid å¯åŠ¨åŠ è½½å™¨åˆ†æ â€”â€” ABL(1)ã€‹ä¸­åˆ†æäº†å½“ä»£é«˜é€šå¹³å°çš„ ABL çš„æ•´ä½“å¯åŠ¨æµç¨‹ï¼Œã€ŠAndroid å¯åŠ¨åŠ è½½å™¨åˆ†æ â€”â€” ABL(2)ã€‹å¯¹å¦‚ä½•å¯åŠ¨è‡³ fastboot æ¨¡å¼è¿›è¡Œè¯¦ç»†çš„è§£é‡Šã€‚æœ¬æ–‡å°†å¯¹ ABL ä¸­å¯åŠ¨è‡³ Linux å†…æ ¸çš„ä»£ç è¿›è¡Œåˆ†æã€‚ å¯åŠ¨ Linux å†…æ ¸çš„æ¡ä»¶ è‹¥ä¸æ˜¯åœ¨å¯åŠ¨è‡³ fastboot æ¨¡å¼ä¸‹ã€å¹¶ä¸”æ²¡æœ‰åœ¨å¯åŠ¨æ—¶æŒ‰ä¸‹ç»„åˆæŒ‰é”®æ—¶ï¼ŒABL é€šè¿‡ LoadImageAndAuth (&amp;Info) åŠ è½½å¹¶éªŒè¯å†…æ ¸ï¼ˆå¦‚æœæœªè§£é”ï¼‰ï¼Œå¹¶è°ƒç”¨ BootLinux (&amp;Info) æ¥å¯åŠ¨åŠ è½½çš„å†…æ ¸ï¼Œå¦‚æœå¯åŠ¨å¤±è´¥ï¼Œåˆ™ fall-through åˆ° fastboot æ¨¡å¼ã€‚å…¶ä¸­ Info ä¸ºä¸€ä¸ª BootInfo ç±»å‹ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š 12345678910111213141516typedef struct BootInfo &#123; BOOLEAN MultiSlotBoot; BOOLEAN BootIntoRecovery; BOOLEAN BootReasonAlarm; CHAR16 Pname[MAX_GPT_NAME_SIZE]; CHAR16 BootableSlot[MAX_GPT_NAME_SIZE]; ImageData Images[MAX_NUMBER_OF_LOADED_IMAGES]; UINTN NumLoadedImages; QCOM_VERIFIEDBOOT_PROTOCOL *VbIntf; boot_state_t BootState; CHAR8 *VBCmdLine; UINT32 VBCmdLineLen; UINT32 VBCmdLineFilledLen; VOID *VBData; UINT32 HeaderVersion;&#125; BootInfo; å…¶ä¸­ ImageData ç»“æ„ä¸ºåŠ è½½è¿›æ¥çš„å¯åŠ¨é•œåƒï¼Œå®šä¹‰å¦‚ä¸‹ï¼š 12345typedef struct &#123; CHAR8 *Name; VOID *ImageBuffer; UINTN ImageSize;&#125; ImageData; åœ¨åŠ è½½å’ŒéªŒè¯ Linux å†…æ ¸æ—¶ï¼Œé•œåƒä¼šå…ˆè¢«åŠ è½½åˆ°è¿™é‡Œï¼Œä¹‹ååœ¨å¯åŠ¨æ—¶ï¼Œä¹Ÿæ˜¯ä½¿ç”¨è¿™é‡Œçš„é•œåƒä¹‹ä¸€ã€‚ Linux å†…æ ¸çš„éªŒè¯ä¸åŠ è½½ éªŒè¯ä¸åŠ è½½çš„å‡½æ•° LoadImageAndAuth (BootInfo *Info) çš„å®ç°ä½äº QcomModulePkg/Library/avb/VerifiedBoot.c ä¸­ã€‚è¿™é‡Œ avb çš„å…¨ç§°å³ä¸º Android Verified Bootã€‚ è¿™ä¸ªå‡½æ•°é¦–å…ˆå°è¯•ä» recovery åˆ†åŒºåŠ è½½é•œåƒï¼Œæ£€æµ‹æ˜¯å¦åŠ è½½æˆåŠŸã€ä»¥åŠæ˜¯å¦æœ‰ä¸€ä¸ªåˆæ³•çš„å¯åŠ¨é•œåƒç‰ˆæœ¬ï¼ˆè¦æ±‚ç¬¬ä¸‰ç‰ˆä»¥ä¸Šï¼Œä¸º system-as-root æ‰€ç”¨çš„ï¼‰å’Œ kernel å¤§å°ï¼š 123456789101112/* check early if recovery exists and has a kernel size */Status = LoadPartitionImageHeader (Info, (CHAR16 *)L\"recovery\", &amp;RecoveryHdr, &amp;RecoveryHdrSz);if (Status != EFI_SUCCESS) &#123;DEBUG ((EFI_D_VERBOSE, \"Recovery partition doesn't exist; continue normal boot\\n\"));&#125; else if (((boot_img_hdr *)(RecoveryHdr))-&gt;header_version &gt;= BOOT_HEADER_VERSION_THREE &amp;&amp; !((boot_img_hdr *)(RecoveryHdr))-&gt;kernel_size) &#123;DEBUG ((EFI_D_VERBOSE, \"Recovery partition has no kernel\\n\"));SetRecoveryHasNoKernel ();&#125; è‹¥ recovery åˆ†åŒºæ²¡æœ‰ä¸€ä¸ªåˆæ³•çš„ kernelï¼Œåˆ™é€šè¿‡ SetRecoveryHasNoKernel () è®¾ç½® RecoveryHasNoKernel å…¨å±€æ ‡è¯†ä»¥ä¾›ä¹‹åä½¿ç”¨ã€‚ æ¥ä¸‹æ¥æœ‰ä¸¤ç§æƒ…å†µï¼Œåˆ†åˆ«ç”¨æ¥å¤„ç† A/B åˆ†åŒºå­˜åœ¨ä¸åªå­˜åœ¨å•ä¸€åˆ†åŒºçš„æƒ…å†µã€‚ åœ¨å•ä¸€åˆ†åŒºæƒ…å†µä¸‹ï¼Œä¹Ÿå¯èƒ½å­˜åœ¨ system-as-root çš„æƒ…å†µï¼Œå³ recovery æ¨¡å¼å’Œæ­£å¸¸å¯åŠ¨å…±ç”¨å†…æ ¸ã€ä½†æŒ‚è½½ä¸åŒçš„åˆ†åŒºä½œä¸º sysrootã€‚å› æ­¤ï¼Œä»¥ä¸‹ä»£ç è®¾ç½®å¯åŠ¨ç”¨åˆ†åŒºåç§°ä¸º recovery æˆ– bootï¼š 123456789101112131415if (Info-&gt;BootIntoRecovery &amp;&amp; !IsRecoveryHasNoKernel ()) &#123; DEBUG ((EFI_D_INFO, \"Booting Into Recovery Mode\\n\")); StrnCpyS (Info-&gt;Pname, ARRAY_SIZE (Info-&gt;Pname), L\"recovery\", StrLen (L\"recovery\"));&#125; else &#123; if (Info-&gt;BootIntoRecovery &amp;&amp; IsRecoveryHasNoKernel ()) &#123; DEBUG ((EFI_D_INFO, \"Booting into Recovery Mode via Boot\\n\")); &#125; else &#123; DEBUG ((EFI_D_INFO, \"Booting Into Mission Mode\\n\")); &#125; StrnCpyS (Info-&gt;Pname, ARRAY_SIZE (Info-&gt;Pname), L\"boot\", StrLen (L\"boot\"));&#125; è€Œ A/B åˆ†åŒºæƒ…å†µç¨å¾®å¤æ‚ä¸€äº›ã€‚é¦–å…ˆ ABL ä¼šå¯»æ‰¾å¯å¯åŠ¨çš„ slotï¼ˆå³ä¸ºä¸€å¥—åˆ†åŒºï¼‰ï¼Œå°†å…¶å­˜å…¥ CurrentSlot ç»“æ„ä½“ä¸­ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š 123typedef struct &#123; CHAR16 Suffix[MAX_SLOT_SUFFIX_SZ];&#125; Slot; è¿™ä¸ªç»“æ„ä½“å®šä¹‰äº†åˆ†åŒºçš„åç¼€ã€‚å®é™…ä¸Šï¼Œå¤šä¸ª slot çš„å®ç°æ­£æ˜¯é€šè¿‡åˆ†åŒºåç§°åŠ ä¸Šä¸€ä¸ªåç¼€å®ç°çš„ï¼Œæ¯”å¦‚ boot_a å’Œ boot_b ä¸ºä¸¤ä¸ª slot çš„å¯åŠ¨åˆ†åŒºã€‚è¿™ä¸ªåç¼€ç”± FindBootableSlot æ¥è·å–ã€‚æ¥ä¸‹æ¥çš„æµç¨‹å°±å’Œå•ä¸€åˆ†åŒºçš„ç±»ä¼¼ã€‚ è·å–åˆ°è¦ä½¿ç”¨çš„å¯åŠ¨åˆ†åŒºä¹‹åï¼Œå°±è¦å¼€å§‹å¯¹è¯¥åˆ†åŒºçš„é•œåƒçš„éªŒè¯ã€‚é•œåƒçš„éªŒè¯æ˜¯å¹³å°ç›¸å…³çš„ï¼Œé€šè¿‡è°ƒç”¨ GetAVBVersion () å–å¾—ç‰ˆæœ¬ï¼Œç›®å‰å­˜åœ¨ NO_AVBã€AVB_1ã€AVB_2 å’Œ AVB_LEï¼Œåˆ†åˆ«ç”¨å¯¹åº”çš„å‡½æ•°è°ƒç”¨æ¥åŠ è½½é•œåƒå’ŒéªŒè¯ã€‚ ä»¥æ—  AVB éªŒè¯ä¸ºä¾‹ï¼Œå®ƒç›´æ¥ä½¿ç”¨ LoadImageNoAuth åŠ è½½é•œåƒï¼Œåœ¨è¿™ä¸ªå‡½æ•°é‡Œ LoadImageHeader (Info-&gt;Pname, &amp;ImageHdrBuffer, &amp;ImageHdrSize) è¢«è°ƒç”¨æ¥æŠŠé•œåƒåŠ è½½åˆ° buffer ä¸­ã€‚åœ¨æ­¤æœŸé—´ï¼Œç›¸åº”çš„ device tree å’Œå‘½ä»¤è¡Œå‚æ•°ä¹Ÿè¢«åŠ è½½å’Œè®¾ç½®ã€‚ æœ€åå°±åœ¨å±å¹•ä¸Šæ˜¾ç¤ºéªŒè¯çŠ¶æ€ DisplayVerifiedBootScreen (Info) å¹¶è¿”å›é•œåƒéªŒè¯çŠ¶æ€ã€‚ å¯åŠ¨ Linux å†…æ ¸ é¦–å…ˆåŠ è½½å¯åŠ¨é•œåƒï¼š 123456789Status = GetImage (Info, &amp;BootParamlistPtr.ImageBuffer, (UINTN *)&amp;BootParamlistPtr.ImageSize, ((!Info-&gt;MultiSlotBoot || IsDynamicPartitionSupport ()) &amp;&amp; (Recovery &amp;&amp; !IsBuildUseRecoveryAsBoot () &amp;&amp; !IsRecoveryHasNoKernel ()))? \"recovery\" : \"boot\"); æ›´æ–°å¯åŠ¨å†…æ ¸ç”¨çš„å‘½ä»¤è¡Œå‚æ•°ï¼Œè·å–åŠ è½½çš„åŸºå€ã€åŠ è½½å†…å­˜ç›˜ã€‚ ä¹‹åå…³é—­ UEFI å¯åŠ¨æœåŠ¡ä¸ºå¯åŠ¨ Linux å†…æ ¸åšå‡†å¤‡ï¼Œå¹¶åœ¨ PreparePlatformHardware ä¸­å–æ¶ˆä¸€äº›è®¾å¤‡çš„ä¹‹å‰å®Œæˆçš„åˆå§‹åŒ–å’Œé…ç½®ï¼Œæ¯”å¦‚ç¦ç”¨ä¸­æ–­ã€ç¦ç”¨ç¼“å­˜ã€ç¦ç”¨ MMUã€ç¦ç”¨åˆ†æ”¯é¢„æµ‹ç­‰ï¼š 1234567891011121314151617181920ArmDisableBranchPrediction ();ArmDisableInterrupts ();ArmDisableAsynchronousAbort ();WriteBackInvalidateDataCacheRange (KernelLoadAddr, KernelSizeActual);WriteBackInvalidateDataCacheRange (RamdiskLoadAddr, RamdiskSizeActual);WriteBackInvalidateDataCacheRange (DeviceTreeLoadAddr, DeviceTreeSizeActual);WriteBackInvalidateDataCacheRange ((void *)StackCurrent, (UINTN)StackBase - (UINTN)StackCurrent);WriteBackInvalidateDataCacheRange (CallerStackCurrent, CallerStackBase - (UINTN)CallerStackCurrent);ArmCleanDataCache ();ArmInvalidateInstructionCache ();ArmDisableDataCache ();ArmDisableInstructionCache ();ArmDisableMmu ();ArmInvalidateTlb (); æœ€åï¼ŒåŠ è½½å¹¶è°ƒç”¨ Linux å†…æ ¸ï¼š 12LinuxKernel = (LINUX_KERNEL) (UINT64)BootParamlistPtr.KernelLoadAddr;LinuxKernel ((UINT64)BootParamlistPtr.DeviceTreeLoadAddr, 0, 0, 0); å¯¹ 32 ä½å†…æ ¸ï¼Œåˆ™ä¸ºï¼š 12LinuxKernel32 = (LINUX_KERNEL32) (UINT64)BootParamlistPtr.KernelLoadAddr;LinuxKernel32 (0, 0, (UINTN)BootParamlistPtr.DeviceTreeLoadAddr); ä½†åœ¨ 32 ä½å†…æ ¸å¯åŠ¨å‰ï¼Œéœ€è¦åˆ‡æ¢åˆ° 32 bit çš„å¯åŠ¨æ¨¡å¼ï¼š 123Status = SwitchTo32bitModeBooting ( (UINT64)BootParamlistPtr.KernelLoadAddr, (UINT64)BootParamlistPtr.DeviceTreeLoadAddr); å…·ä½“å®ç°ä¸ºå†™å…¥ 0 åˆ° EL1 ç¯å¢ƒä¸‹çš„ X4 å¯„å­˜å™¨ï¼š 12345HlosBootArgs.el1_x2 = DeviceTreeLoadAddr;/* Write 0 into el1_x4 to switch to 32bit mode */HlosBootArgs.el1_x4 = 0;HlosBootArgs.el1_elr = KernelLoadAddr;Status = pQcomScmModeSwitchProtocol-&gt;SwitchTo32bitMode (HlosBootArgs); å¦‚æœå¯åŠ¨å¤±è´¥ï¼Œåˆ™è¿›å…¥ CpuDeadLoop()ã€‚ æ€»ç»“ æœ¬æ–‡åˆ†ææ€»ç»“äº† ABL æ­£å¸¸å¯åŠ¨ Linux æ—¶çš„ä»£ç ä¸æµç¨‹ã€‚","categories":[{"name":"Linux","slug":"Linux","permalink":"https://blog.inoki.cc/categories/Linux/"},{"name":"Android","slug":"Linux/Android","permalink":"https://blog.inoki.cc/categories/Linux/Android/"},{"name":"Bootloader","slug":"Linux/Android/Bootloader","permalink":"https://blog.inoki.cc/categories/Linux/Android/Bootloader/"}],"tags":[{"name":"ä¸­æ–‡","slug":"ä¸­æ–‡","permalink":"https://blog.inoki.cc/tags/ä¸­æ–‡/"},{"name":"Linux","slug":"Linux","permalink":"https://blog.inoki.cc/tags/Linux/"},{"name":"Android","slug":"Android","permalink":"https://blog.inoki.cc/tags/Android/"},{"name":"ABL","slug":"ABL","permalink":"https://blog.inoki.cc/tags/ABL/"},{"name":"Bootloader","slug":"Bootloader","permalink":"https://blog.inoki.cc/tags/Bootloader/"}]},{"title":"Android å¯åŠ¨åŠ è½½å™¨åˆ†æ â€”â€” ABL(2)","slug":"android-bootloader-analysis-abl-2","date":"2021-10-22T13:48:00.000Z","updated":"2025-03-08T09:40:48.607Z","comments":true,"path":"2021/10/22/android-bootloader-analysis-abl-2/","link":"","permalink":"https://blog.inoki.cc/2021/10/22/android-bootloader-analysis-abl-2/","excerpt":"","text":"æˆ‘çš„å‰ä¸€ç¯‡æ–‡ç« ã€ŠAndroid å¯åŠ¨åŠ è½½å™¨åˆ†æ â€”â€” ABL(1)ã€‹ä¸­åˆ†æäº†å½“ä»£é«˜é€šå¹³å°çš„ ABL çš„æ•´ä½“å¯åŠ¨æµç¨‹ï¼Œä½†å¹¶æœªå¯¹å¦‚ä½•å¯åŠ¨è‡³ fastboot æ¨¡å¼å’Œ Linux å†…æ ¸è¿›è¡Œè¯¦ç»†çš„è§£é‡Šã€‚æœ¬æ–‡å°†å¯¹ fastboot æ¨¡å¼çš„ä»£ç è¿›è¡Œåˆ†æã€‚ å¯åŠ¨è‡³ fastboot æ¨¡å¼çš„æ¡ä»¶ åœ¨ ABL ä¸­ï¼Œå½“å¯åŠ¨é•œåƒéªŒè¯å¤±è´¥ã€BootLinux (&amp;Info) å‡½æ•°å¯åŠ¨å¤±è´¥æˆ–è€…æ¥æ”¶åˆ°å¯åŠ¨è‡³ fastboot çš„å‘½ä»¤ï¼ˆæ¯”å¦‚ä½¿ç”¨ adb é‡å¯è‡³ bootloaderã€åœ¨å¯åŠ¨æ—¶æŒ‰ä¸‹äº†ç›¸åº”çš„ç»„åˆæŒ‰é”®ï¼‰æ—¶ï¼Œä»¥ä¸‹ä»£ç ä¼šè¢«æ‰§è¡Œæ¥åˆå§‹åŒ–å¹¶æ‰§è¡Œ fastboot æ¨¡å¼ï¼š 123fastboot: DEBUG ((EFI_D_INFO, \"Launching fastboot\\n\")); Status = FastbootInitialize (); åˆå§‹åŒ– fastboot æ¨¡å¼ åˆå§‹åŒ–å¹¶æ‰§è¡Œ fastboot æ¨¡å¼çš„ä»£ç æ˜¯ FastbootInitialize () è¿™ä¸ªå‡½æ•°ï¼Œå®ƒè¢«å®šä¹‰åœ¨ QcomModulePkg/Library/FastbootLib/FastbootMain.c ä¸­ã€‚å®ƒé¦–å…ˆè°ƒç”¨ FastbootUsbDeviceStart () å¯åŠ¨ USB è®¾å¤‡ï¼Œè¿™æ ·å°±å¯ä»¥æ¥æ”¶è®¡ç®—æœºä¼ æ¥çš„ fastboot å‘½ä»¤ï¼Œç„¶åè°ƒç”¨ DisplayFastbootMenu () æ˜¾ç¤º fastboot çš„èœå•ã€‚ ç„¶åè¿›å…¥ä¸€ä¸ªæ¥æ”¶ USB çš„æ­»å¾ªç¯å¤„ç† USB äº‹ä»¶ï¼Œç›´åˆ° fastboot åœæ­¢ã€‚ä¹‹ååˆ™å…³é—­ fastboot æ¨¡å¼ã€åœæ­¢ç›‘å¬æŒ‰é”®å¹¶åœæ­¢ USB è®¾å¤‡ã€‚ 12345678910/* Close the fastboot app and stop USB device */Status = FastbootCmdsUnInit ();if (Status != EFI_SUCCESS) &#123;DEBUG ((EFI_D_ERROR, \"couldnt uninit fastboot\\n\"));return Status;&#125;ExitMenuKeysDetection ();Status = FastbootUsbDeviceStop (); è¿”å›åå°±ä¼šé€€å‡º fastboot è¿™ä¸ª appï¼Œå†æ¬¡å¯åŠ¨è®¾å¤‡ã€‚ å¯åŠ¨ USB è®¾å¤‡ å¯åŠ¨ä¹‹å‰éœ€è¦é…ç½® USB æ§åˆ¶å™¨ï¼Œfastboot é¦–å…ˆä½¿ç”¨ InitUsbControllerGuid è¿™ä¸ª GUIDã€é€šè¿‡åœ¨å…¨å±€çš„ EFI_BOOT_SERVICES *gBS å®ä¾‹æ¥åˆå§‹åŒ–ä¸€ä¸ª USB æ§åˆ¶å™¨ï¼Œä»£ç å¦‚ä¸‹ï¼š 12Status = gBS-&gt;CreateEventEx (EVT_NOTIFY_SIGNAL, TPL_CALLBACK, DummyNotify, NULL, &amp;InitUsbControllerGuid, &amp;UsbConfigEvt); ç„¶åé€šè¿‡ UsbDeviceProtolGuid å¯»æ‰¾ fastboot è¦ä½¿ç”¨çš„åè®®ï¼Œå­˜å…¥ Fbd çš„ UsbDeviceProtocol å­—æ®µä¸­ï¼š 12Status = gBS-&gt;LocateProtocol (&amp;UsbDeviceProtolGuid, NULL, (VOID **)&amp;Fbd.UsbDeviceProtocol); è¿™ä¸ªå­—æ®µæ˜¯ä¸€ä¸ª EFI_USB_DEVICE_PROTOCOL *UsbDeviceProtocol çš„æŒ‡é’ˆï¼Œå…¶å®šä¹‰åœ¨ QcomModulePkg/Include/Protocol/EFIUsbDevice.h ä¸­ã€‚ åœ¨è¿™ä¹‹åï¼Œfastboot çš„å‘½ä»¤å’Œå˜é‡ä¼šè¢«åˆå§‹åŒ–ï¼Œä¸ºæ¥æ”¶åˆ°çš„å‘½ä»¤å‡†å¤‡ç›¸åº”çš„å›è°ƒå‡½æ•°ã€‚ æ­¤æ—¶ USB è®¾å¤‡è¿˜æœªè¢«å®Œå…¨æ³¨å†Œï¼Œå› æ­¤æ¥ä¸‹æ¥éœ€è¦æ³¨å†Œè®¾å¤‡å¹¶å¯åŠ¨ USB è®¾å¤‡ï¼ŒåŒ…æ‹¬è·å– USB å¯ç”¨çš„æœ€å¤§é€Ÿåº¦ã€USB è®¾å¤‡è§„èŒƒï¼ˆåŒ…æ‹¬ vendor ID å’Œ device ID ç­‰ï¼‰å’Œè®¾å¤‡æè¿°ç¬¦ç­‰ã€‚å…¶å®ç°åœ¨ QcomModulePkg/Library/FastbootLib/UsbDescriptor.c ä¸­ã€‚ æ³¨æ„è¿™æ—¶æœ‰ SS DevDescriptors/Descriptors å’Œ DevDescriptors/Descriptors ä¸¤ç§ï¼Œåˆ†åˆ«æ˜¯ Super Speed USBï¼ˆ3.Xï¼‰å’Œ High Speed USBï¼ˆ2.0ï¼‰ä¸¤å¥—æè¿°ç¬¦ã€‚å„ç§ USB ç›¸å…³çš„æè¿°ç¬¦éƒ½å®šä¹‰åœ¨ MdePkg/Include/IndustryStandard/Usb.h ä¸­ï¼Œè¿™é‡Œæœ€é‡è¦çš„ USB_DEVICE_DESCRIPTOR å®šä¹‰å¦‚ä¸‹ï¼š 1234567891011121314151617181920////// Standard Device Descriptor/// USB 2.0 spec, Section 9.6.1///typedef struct &#123; UINT8 Length; UINT8 DescriptorType; UINT16 BcdUSB; UINT8 DeviceClass; UINT8 DeviceSubClass; UINT8 DeviceProtocol; UINT8 MaxPacketSize0; UINT16 IdVendor; UINT16 IdProduct; UINT16 BcdDevice; UINT8 StrManufacturer; UINT8 StrProduct; UINT8 StrSerialNumber; UINT8 NumConfigurations;&#125; USB_DEVICE_DESCRIPTOR; é…ç½®å¥½è¿™äº› descriptor ä¹‹åï¼Œè°ƒç”¨å‰é¢åˆ›å»ºçš„ USB protocol æ¥å¯åŠ¨ USB è®¾å¤‡ï¼š 12/* Start the usb device */Status = Fbd.UsbDeviceProtocol-&gt;StartEx (&amp;DescSet); æœ€åï¼Œä¸ºå‘é€å’Œæ¥æ”¶ USB transfer æ•°æ®åˆ›å»ºç¼“å†²ã€‚ æ³¨å†Œ fastboot å‘½ä»¤ åœ¨å¯åŠ¨ USB è®¾å¤‡ä¹‹å‰ï¼Œfastboot å†…å¯ç”¨çš„å‘½ä»¤å’Œç›¸å…³çš„å˜é‡ç”± EFI_STATUS FastbootCmdsInit (VOID) æ¥æ³¨å†Œï¼Œè¿™ä¸ªå‡½æ•°åœ¨ QcomModulePkg/Library/FastbootLib/FastbootCmds.c ä¸­ã€‚è¿™ä¸ªå‡½æ•°ä¸º fastboot ç›¸å…³å‘½ä»¤åˆ›å»ºç¼“å†²åŒºå’Œå¤šçº¿ç¨‹ç¯å¢ƒæ¥è°ƒç”¨å›è°ƒï¼Œç„¶åè°ƒç”¨ FastbootCommandSetup æ¥åˆ›å»ºå¯ç”¨çš„å‘½ä»¤ä¸å˜é‡ï¼š 12345678910111213/* By Default enable list is empty */ &#123;\"\", NULL&#125;,/*CAUTION(High): Enabling these commands will allow changing the partitions *like system,userdata,cachec etc... */#ifdef ENABLE_UPDATE_PARTITIONS_CMDS &#123;\"flash:\", CmdFlash&#125;, &#123;\"erase:\", CmdErase&#125;, &#123;\"set_active\", CmdSetActive&#125;, &#123;\"flashing get_unlock_ability\", CmdFlashingGetUnlockAbility&#125;, &#123;\"flashing unlock\", CmdFlashingUnlock&#125;, &#123;\"flashing lock\", CmdFlashingLock&#125;,#endif è¿™äº›åŸºç¡€çš„å‘½ä»¤å¯ä»¥ç”¨æ¥è§£é”ã€è®¾ç½® A/B åˆ†åŒºçš„æ¿€æ´»çŠ¶æ€å’Œåˆ·å†™åˆ†åŒºç­‰ã€‚ 1234567/* *CAUTION(CRITICAL): Enabling these commands will allow changes to bootimage. */#ifdef ENABLE_DEVICE_CRITICAL_LOCK_UNLOCK_CMDS &#123;\"flashing unlock_critical\", CmdFlashingUnLockCritical&#125;, &#123;\"flashing lock_critical\", CmdFlashingLockCritical&#125;,#endif è¿™ä¸¤æ¡å‘½ä»¤æ˜¯ç”¨æ¥æ§åˆ¶å¯åŠ¨é•œåƒåŒºçš„åˆ·å†™ã€‚ 1234567/* *CAUTION(CRITICAL): Enabling this command will allow boot with different *bootimage. */#ifdef ENABLE_BOOT_CMD &#123;\"boot\", CmdBoot&#125;,#endif è¿™é‡Œæ³¨å†Œçš„ fastboot boot &lt;image&gt; å‘½ä»¤å¯ä»¥å¯åŠ¨è‡ªå®šä¹‰é•œåƒã€‚ 12345&#123;\"oem enable-charger-screen\", CmdOemEnableChargerScreen&#125;,&#123;\"oem disable-charger-screen\", CmdOemDisableChargerScreen&#125;,&#123;\"oem off-mode-charge\", CmdOemOffModeCharger&#125;,&#123;\"oem select-display-panel\", CmdOemSelectDisplayPanel&#125;,&#123;\"oem device-info\", CmdOemDevinfo&#125;, ä»¥ä¸Šæ˜¯ OEM æœ‰å…³çš„è®¾ç½®å’Œä¿¡æ¯ã€‚ 12345678910 &#123;\"continue\", CmdContinue&#125;, &#123;\"reboot\", CmdReboot&#125;,#ifdef DYNAMIC_PARTITION_SUPPORT &#123;\"reboot-recovery\", CmdRebootRecovery&#125;, &#123;\"reboot-fastboot\", CmdRebootFastboot&#125;,#ifdef VIRTUAL_AB_OTA &#123;\"snapshot-update\", CmdUpdateSnapshot&#125;,#endif#endif &#123;\"reboot-bootloader\", CmdRebootBootloader&#125;, è¿™æ˜¯é‡å¯å’Œå¯åŠ¨ç›¸å…³çš„å‘½ä»¤ã€‚ 12&#123;\"getvar:\", CmdGetVar&#125;,&#123;\"download:\", CmdDownload&#125;, æœ€åçš„ getvar å‘½ä»¤å¯ä»¥è·å–è®¾å¤‡åœ¨ fastboot æ¨¡å¼ä¸­ç›¸å…³çš„å˜é‡ï¼Œè€Œå˜é‡çš„å‘å¸ƒåˆ™ä½¿ç”¨ FastbootPublishVar (key, value)ã€‚ åœ¨ fastboot æ¨¡å¼ä¸­çš„äº‹ä»¶å¾ªç¯ ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåœ¨ fastboot ä¸­ä¼šæœ‰ä¸‰ä¸ªä¸»è¦çš„äº‹ä»¶å¾ªç¯ï¼š æ¥æ”¶æŒ‰é”®äº‹ä»¶æ›´æ–° fastboot èœå•ï¼ˆåœ¨ VOID DisplayFastbootMenu (VOID) ä¸­ç»˜åˆ¶å¹¶åˆ›å»ºï¼Œåœ¨ QcomModulePkg/Library/BootLib/FastbootMenu.c ä¸­å®šä¹‰ ï¼‰ï¼› é€šè¿‡ USB æ¥æ”¶è®¡ç®—æœºçš„ fastboot å‘æ¥çš„å‘½ä»¤ï¼ˆåœ¨æ³¨å†Œ fastboot æ—¶åˆ›å»ºï¼‰ï¼› ä¸»å¾ªç¯è°ƒç”¨ HandleUsbEvents () ç›‘å¬ USB è®¾å¤‡çš„é€šçŸ¥ï¼ŒåŒ…æ‹¬è®¾å¤‡è¿æ¥ç­‰äº‹ä»¶ã€‚ ç»“è®º æœ¬æ–‡åˆ†ææ€»ç»“äº† ABL åœ¨ fastboot æ¨¡å¼ä¸‹çš„ä»£ç ä¸æµç¨‹ã€‚","categories":[{"name":"Linux","slug":"Linux","permalink":"https://blog.inoki.cc/categories/Linux/"},{"name":"Android","slug":"Linux/Android","permalink":"https://blog.inoki.cc/categories/Linux/Android/"},{"name":"Bootloader","slug":"Linux/Android/Bootloader","permalink":"https://blog.inoki.cc/categories/Linux/Android/Bootloader/"}],"tags":[{"name":"ä¸­æ–‡","slug":"ä¸­æ–‡","permalink":"https://blog.inoki.cc/tags/ä¸­æ–‡/"},{"name":"Linux","slug":"Linux","permalink":"https://blog.inoki.cc/tags/Linux/"},{"name":"Android","slug":"Android","permalink":"https://blog.inoki.cc/tags/Android/"},{"name":"ABL","slug":"ABL","permalink":"https://blog.inoki.cc/tags/ABL/"},{"name":"Bootloader","slug":"Bootloader","permalink":"https://blog.inoki.cc/tags/Bootloader/"}]},{"title":"é€šè¿‡ Linux sysfs ç©è½¬ç¡¬ä»¶","slug":"linux-sysfs-playground","date":"2021-10-20T19:34:00.000Z","updated":"2025-03-08T09:40:48.609Z","comments":true,"path":"2021/10/20/linux-sysfs-playground/","link":"","permalink":"https://blog.inoki.cc/2021/10/20/linux-sysfs-playground/","excerpt":"","text":"å¯¹äºä¸€äº›éåµŒå…¥å¼ã€ç¦»ç¡¬ä»¶æ¯”è¾ƒè¿œçš„ç¨‹åºå‘˜ï¼Œä¸ç¡¬ä»¶æœ‰å…³çš„äº‹æƒ…å¯èƒ½å®Œå…¨æ˜¯ä¸€ä¸ªé»‘åŒ£å­ï¼šæˆ‘åªéœ€è¦æ’ä¸Š USB çº¿ç¼†ã€æ’ä¸Š HDMI çº¿ç¼†ï¼Œå°±å¯ä»¥æŠŠç¡¬ä»¶è¿æ¥åˆ°è®¡ç®—æœºï¼›æˆ‘åªéœ€è¦æŒ‰ä¸€ä¸ªæŒ‰é”®ï¼Œå°±å¯ä»¥è°ƒèŠ‚å±å¹•çš„äº®åº¦ã€‚ä½œä¸ºä¸€ä¸ªç¨‹åºå‘˜æˆ–è€…è®¡ç®—æœºçˆ±å¥½è€…ï¼Œæˆ‘æœ‰æ²¡æœ‰å¯èƒ½è‡ªå·±å†™ä¸€äº›ä»£ç  snippets æ¥å®Œæˆä¸€äº›è‡ªå®šä¹‰çš„äº‹æƒ…å‘¢ï¼Ÿ æœ¬æ–‡å°±å°†ä»‹ç»å¦‚ä½•é€šè¿‡ Linux ç³»ç»Ÿçš„ sysfs æ¨¡å—ã€ç”¨ä¸€äº›ç®€å•çš„ä»£ç /shell æ“ä½œç¡¬ä»¶ã€‚ ç¡¬ä»¶ã€Linux ç³»ç»Ÿä¸ sysfs æ¨¡å— æ“ä½œç³»ç»Ÿæ˜¯è®¡ç®—æœºç¡¬ä»¶å’Œç”¨æˆ·ä¹‹é—´çš„æ¥å£ï¼Œå®ƒå¯ä»¥å¤„ç†è®¡ç®—æœºç¡¬ä»¶èµ„æºå¹¶ä¸ºè®¡ç®—æœºç¨‹åºæä¾›åŸºæœ¬æœåŠ¡ï¼Œé©±åŠ¨ç¡¬ä»¶æ˜¯å®ƒæ‰€æ‹¥æœ‰çš„ä¸€ä¸ªå¾ˆé‡è¦çš„åŠŸèƒ½ã€‚ä¸‹å›¾æ˜¾ç¤ºäº†æ“ä½œç³»ç»Ÿå†…æ ¸æ‰€åœ¨çš„ä½ç½®ï¼šå®ƒä½œä¸ºç¡¬ä»¶å’Œ shellã€åº”ç”¨ç¨‹åºä¹‹é—´çš„ä¸€å±‚ï¼Œæä¾›æ¥å£ã€‚ æ ¹æ® Linux çš„æ‰‹å†Œï¼Œsysfs æ–‡ä»¶ç³»ç»Ÿæ˜¯ä¸€ä¸ªä¼ªæ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒæä¾›äº†ä¸€ä¸ªå†…æ ¸æ•°æ®ç»“æ„çš„æ¥å£ã€‚è¿™ä¸ªæ–‡ä»¶ç³»ç»Ÿçš„æ–‡ä»¶å¹¶ä¸æ˜¯çœŸå®å­˜åœ¨åœ¨ç¡¬ç›˜ä¸Šçš„æ–‡ä»¶ï¼Œå®ƒæä¾›æœ‰å…³è®¾å¤‡ã€å†…æ ¸æ¨¡å—ã€æ–‡ä»¶ç³»ç»Ÿå’Œå…¶ä»–å†…æ ¸ç»„ä»¶çš„ä¿¡æ¯ï¼Œå¯¹è¿™é‡Œçš„æ–‡ä»¶çš„è¯»å†™å°±æ˜¯å¯¹å†…æ ¸ä¸­å¯¹è±¡çš„æ“ä½œã€‚ ç¡¬ä»¶é©±åŠ¨æ˜¯ Linux å†…æ ¸çš„ä¸€éƒ¨åˆ†ï¼Œè¿‡å»æ˜¯è¢«é™æ€ç¼–è¯‘åˆ°å†…æ ¸ä¸­ï¼Œè€Œåœ¨å½“ä»£çš„ Linux ç³»ç»Ÿä¸­å¤§éƒ¨åˆ†é©±åŠ¨ç¨‹åºéƒ½å¯ä»¥è¢«ç¼–è¯‘æˆå†…æ ¸æ¨¡å—ï¼ˆkernel moduleï¼‰ã€åŠ¨æ€åŠ è½½åˆ°å†…æ ¸ä¸­ã€‚å½“è®¾å¤‡æ’å…¥æ—¶ï¼Œå†…æ ¸ä¼šåˆ›å»ºä¸€ä¸ªå†…æ ¸å¯¹è±¡ï¼Œå¹¶ä¸ºå¯¹å¯¹è±¡çš„æ“ä½œè®¾ç½®å¯¹åº”é©±åŠ¨ä¸­çš„å›è°ƒå‡½æ•°ã€‚è¿™ä¸ªå¯¹è±¡ä¹Ÿä¼šè¢«æ˜ å°„åˆ° sysfs ä¸­ã€‚ sysfs çš„ç»“æ„ åœ¨ Linux ä¸­ï¼Œsysfs ä¸€èˆ¬ä¼šè¢«è‡ªåŠ¨æŒ‚è½½åˆ° /sys ç›®å½•ä¸‹ã€‚æˆ‘çš„è®¡ç®—æœºåœ¨è¯¥ç›®å½•ä¸‹æœ‰ä»¥ä¸‹å­ç›®å½•ï¼š 1block bus class dev devices firmware fs hypervisor kernel module power æœ‰å—è®¾å¤‡ã€æŒ‰æ€»çº¿åˆ†ç±»ã€æŒ‰è®¾å¤‡ç±»åˆ«åˆ†ç±»ã€æ–‡ä»¶ç³»ç»Ÿã€å†…æ ¸æ¨¡å—ç­‰ã€‚ æˆ‘ä¸ªäººæ¯”è¾ƒå¸¸ç”¨çš„æ˜¯ classï¼Œåœ¨è¿™ä¸ªç›®å½•ä¸‹ï¼Œè®¾å¤‡æŒ‰ç…§æ‰€å±çš„ç±»åˆ«åˆ†ç±»ï¼š å¯ä»¥çœ‹åˆ°ï¼Œæœ‰ backlight èƒŒå…‰è®¾å¤‡ã€bluetooth è“ç‰™è®¾å¤‡ã€input è¾“å…¥è®¾å¤‡ã€leds ç¯ã€tty ç­‰ã€‚ å®ƒä»¬çš„å­ç›®å½•æ˜¯ä¸€äº›å…·ä½“çš„è®¾å¤‡å¯¹åº”çš„ç›®å½•ï¼ˆå¦‚æœæœ‰ç›¸åº”è®¾å¤‡è¢«å†…æ ¸é©±åŠ¨èµ·æ¥çš„è¯ï¼‰ï¼Œåœ¨è¿™äº›ç›®å½•é‡Œå¾€å¾€æœ‰ä¸€äº›å¯ä»¥è¯»å†™çš„æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶å¯¹åº”ç€è®¾å¤‡åœ¨å†…æ ¸ä¸­çš„çŠ¶æ€ã€‚ å†™ sysfs çš„æ–‡ä»¶å¯¹è±¡è°ƒèŠ‚æ˜¾ç¤ºå™¨äº®åº¦ å¦‚æœä½ æ‹¥æœ‰ä¸€å°å¸¦æœ‰ Intel é›†æˆæ˜¾å¡çš„ç¬”è®°æœ¬ï¼Œä¸”å®‰è£…äº†ä¸€ä¸ªå¸¦ GUI çš„ Linux å‘è¡Œç‰ˆï¼Œé‚£å¤§æ¦‚ç‡ä½¿ç”¨çš„æ˜¯ i915 æˆ–è€… i965 é©±åŠ¨ã€‚åœ¨ /sys/class/backlight/intel_backlight ä¸‹å°±ä¼šæœ‰ä»¥ä¸‹æ–‡ä»¶ï¼š å…¶ä¸­ brightness ä¸ºä¸€ä¸ª root å¯è¯»å¯å†™çš„æ–‡ä»¶ï¼Œé€šè¿‡å®ƒå¯ä»¥è®¾ç½®å±å¹•äº®åº¦ï¼›max_brightness ä¸ºä¸€ä¸ª root å¯è¯»çš„æ–‡ä»¶ï¼Œå®ƒå‚¨å­˜äº†å¯ä»¥è®¾ç½®çš„æœ€å¤§å±å¹•äº®åº¦ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªç®€å•çš„ shell è„šæœ¬è¯»å–æœŸæœ›äº®åº¦ç™¾åˆ†æ¯”ã€å…è®¸çš„æœ€å¤§äº®åº¦ï¼Œå¹¶å°†è®¡ç®—ç»“æœå†™å…¥ brightness æ¥è®¾ç½®å±å¹•äº®åº¦ç™¾åˆ†æ¯”ï¼š 123456789#!/bin/bashecho \"è¯·è¾“å…¥æ‚¨æƒ³è¦çš„äº®åº¦ç™¾åˆ†æ¯”:\"read expected_brightnessecho $expected_brightnessmax_brightness=$(cat /sys/class/backlight/intel_backlight/max_brightness)echo $(expr $expected_brightness \\* $max_brightness \\/ 100) &gt; /sys/class/backlight/intel_backlight/brightness ä¹‹åï¼Œä½¿ç”¨ sudo è¿è¡Œè¿™ä¸ªè„šæœ¬ï¼ˆå†™å…¥ brightness æ–‡ä»¶éœ€è¦ root ç”¨æˆ·èº«ä»½ï¼‰å¹¶è¾“å…¥ä½ æœŸæœ›çš„ç™¾åˆ†æ¯”ï¼ˆæ³¨æ„ï¼šä¸ºäº†ä¿æŒç®€çŸ­ï¼Œè¿™ä¸ªè„šæœ¬æ²¡æœ‰å¯¹è¾“å…¥å€¼è¿›è¡Œä»»ä½•åˆ¤æ–­ï¼Œtake your own riskï¼‰ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š è¿™æ—¶æˆ‘çš„å±å¹•èƒŒå…‰äº®åº¦å°±è¢«è®¾ç½®ä¸ºäº† 15%ã€‚ å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥ç”¨ C è¯­è¨€ã€Python æˆ–è€…ä»»ä½•ä½ å–œæ¬¢çš„è¯­è¨€ï¼Œé€šè¿‡è¯»å†™ sysfs ä¸‹çš„æ–‡ä»¶æ§åˆ¶ä¸€äº›ç¡¬ä»¶ã€‚è¿™éƒ½å–å†³äºä½ çš„æƒ³æ³•å’Œåˆ›æ„äº†ï¼ æ³¨ï¼šå¦‚æœä½ ä½¿ç”¨çš„æ˜¯å…¶ä»–æ˜¾å¡ã€æˆ–è€…å¤–æ¥æ˜¾ç¤ºå™¨ï¼Œèƒ½å¦æœ‰æ•ˆæœå°±å–å†³äºå…·ä½“çš„ç¡¬ä»¶äº†ã€‚ ç»“è®º æœ¬æ–‡ç²—ç•¥ä»‹ç»äº† Linux ç³»ç»Ÿçš„ sysfs æ¨¡å—çš„æ¦‚å¿µå’Œç”¨æ³•ï¼Œå¹¶æä¾›äº†ä¸€ä¸ªç®€å•çš„è„šæœ¬æ¥è®¾ç½®æ˜¾ç¤ºå±çš„èƒŒå…‰ã€‚","categories":[{"name":"Linux","slug":"Linux","permalink":"https://blog.inoki.cc/categories/Linux/"},{"name":"sysfs","slug":"Linux/sysfs","permalink":"https://blog.inoki.cc/categories/Linux/sysfs/"}],"tags":[{"name":"ä¸­æ–‡","slug":"ä¸­æ–‡","permalink":"https://blog.inoki.cc/tags/ä¸­æ–‡/"},{"name":"Linux","slug":"Linux","permalink":"https://blog.inoki.cc/tags/Linux/"},{"name":"Linux Driver","slug":"Linux-Driver","permalink":"https://blog.inoki.cc/tags/Linux-Driver/"},{"name":"sysfs","slug":"sysfs","permalink":"https://blog.inoki.cc/tags/sysfs/"}]},{"title":"Android bootloader analysis -- ABL(1)","slug":"android-bootloader-analysis-abl-1-en","date":"2021-10-18T19:48:00.000Z","updated":"2025-03-08T09:40:48.607Z","comments":true,"path":"2021/10/18/android-bootloader-analysis-abl-1-en/","link":"","permalink":"https://blog.inoki.cc/2021/10/18/android-bootloader-analysis-abl-1-en/","excerpt":"","text":"In my previous article â€œAndroid Bootloader Analysis â€“ Abootâ€, I analyzed the overall boot flow and corresponding code of the previous generation of Aboot for Qualcomm platforms. After 2016, the PBL of the MSM8996 (Snapdragon 820) platform loads the new XBL, followed by a chain load of ABL or Aboot (only for the MSM8996 platform where the XBL is not yet mature), which is a boot loader built on EDK II to replace Aboot, which can choose to stay in It can choose to stay in fastboot, boot to Android using the system kernel and ramdisk in the system directory, or boot to Recovery using the recovery ramdisk, depending on key combinations. This article describes the code organization and general boot process of ABL. Due to space limitation, the code analysis for booting Linux and fastboot will be published in separate articles. Code Organization The Qualcomm ABL source code can be found at Code Aurora Forum. The ABL is built on EDK II and the overall project structure is the standard EDK II source tree. This article uses the uefi.lnx.3.0.r1 branch as written for analysis, committed as c4da6fcb959fa67cb2aa89007beebfab66226268. In the Makefile of the project, the two most important build targets are 12ABL_FV_IMG := $(BUILD_ROOT)/FV/abl.fvABL_FV_ELF := $(BOOTLOADER_OUT)/... /... /unsigned_abl.elf Of these, ABL_FV_IMG is the most important build target, which is the firmware (fv, firmware) built from QcomModulePkg. 12345ABL_FV_IMG: EDK_TOOLS_BIN @. . /edksetup.sh BaseTools &amp;&amp; \\ build -p $(WORKSPACE)/QcomModulePkg/QcomModulePkg.dsc cp $(BUILD_ROOT)/FV/FVMAIN_COMPACT.Fv $(ABL_FV_IMG) Whereas ABL_FV_ELF just calls QcomModulePkg/Tools/image_header.py to convert abl.fv to an ELF file that can be flushed to the abl partition in the deviceâ€™s EMMC or flash memory. In QcomModulePkg, the firmware entry is FV.FVMAIN_COMPACT, which contains FV.FVMAIN, a module that encapsulates the base ARM stack, MMU, and other components provided by EDK II, and contains QcomModulePkg/Application/ LinuxLoader/LinuxLoader.inf, a Linux loader, is used to boot the firmware and load the Android Linux kernel on the ARM platform. This LinuxLoader is a UEFI application and its program entry point is defined as follows. 1ENTRY_POINT = LinuxLoaderEntry It contains some modules from EDK II. 1234567[Packages] ArmPkg/ArmPkg.dec MdePkg/MdePkg.dec EmbeddedPkg/EmbeddedPkg.dec ArmPlatformPkg/ArmPlatformPkg.dec MdeModulePkg/MdeModulePkg.dec QcomModulePkg/QcomModulePkg.dec In the Library of QcomModulePkg, there are FastbootLib, BootLib, zlib, etc. The implementation of Fastboot is in FastbootLib, while BootLib contains the specific implementation for booting the Linux kernel, and zlib because Linux kernels are sometimes compressed. Boot process In the LinuxLoaderEntry entry point function, the program first calls some basic platform code to set up the environment, then gets the boot verification status and device status with DeviceInfoInit (), then uses EnumeratePartitions () and UpdatePartitionEntries () to get and update the partition information. If there is more than one boot slot (in this case, Android devices with A/B partitions, where A and B are generally two slots), find the activated slot and record it. Next, it gets the keystroke status and sets the boot to fastboot flag when SCAN_DOWN is pressed, SCAN_UP for boot to recovery, and SCAN_ESC for reboot to Emergency Download (EDL) mode. The program then gets the reason for the reboot and sets the appropriate flag. When not booting to fastboot, the boot image is loaded and verified, and if it is loaded and verified successfully, BootLinux (&amp;Info) is called to boot the Linux kernel. Otherwise, call FastbootInitialize () to initialize and run fastboot. Summary This article has analyzed the project structure and overall boot process of ABL. In the next article, we will discuss the code flow for booting Linux normally (also including recovery booting).","categories":[{"name":"Linux","slug":"Linux","permalink":"https://blog.inoki.cc/categories/Linux/"},{"name":"Android","slug":"Linux/Android","permalink":"https://blog.inoki.cc/categories/Linux/Android/"},{"name":"Bootloader","slug":"Linux/Android/Bootloader","permalink":"https://blog.inoki.cc/categories/Linux/Android/Bootloader/"}],"tags":[{"name":"Linux","slug":"Linux","permalink":"https://blog.inoki.cc/tags/Linux/"},{"name":"Android","slug":"Android","permalink":"https://blog.inoki.cc/tags/Android/"},{"name":"ABL","slug":"ABL","permalink":"https://blog.inoki.cc/tags/ABL/"},{"name":"Bootloader","slug":"Bootloader","permalink":"https://blog.inoki.cc/tags/Bootloader/"}]},{"title":"Android å¯åŠ¨åŠ è½½å™¨åˆ†æ â€”â€” ABL(1)","slug":"android-bootloader-analysis-abl-1","date":"2021-10-18T19:48:00.000Z","updated":"2025-03-08T09:40:48.607Z","comments":true,"path":"2021/10/18/android-bootloader-analysis-abl-1/","link":"","permalink":"https://blog.inoki.cc/2021/10/18/android-bootloader-analysis-abl-1/","excerpt":"","text":"æˆ‘çš„å‰ä¸€ç¯‡æ–‡ç« ã€ŠAndroid å¯åŠ¨åŠ è½½å™¨åˆ†æ â€”â€” Abootã€‹ä¸­åˆ†æäº†é«˜é€šå¹³å°å‰ä»£çš„ Aboot çš„æ•´ä½“å¯åŠ¨æµç¨‹å’Œç›¸åº”çš„ä»£ç ã€‚ åœ¨ 2016 å¹´ä¹‹åï¼ŒMSM8996ï¼ˆSnapdragon 820ï¼‰å¹³å°çš„ PBL åŠ è½½å…¨æ–°çš„ XBLï¼Œç´§æ¥ç€é“¾å¼åŠ è½½ ABL æˆ– Abootï¼ˆä»…å¯¹äº XBL è¿˜æœªæˆç†Ÿçš„ MSM8996 å¹³å°ï¼‰ï¼Œè¿™ä¸ªç¨‹åºæ˜¯åŸºäº EDK II æ„å»ºçš„ç”¨æ¥æ›¿æ¢ Aboot çš„å¯åŠ¨åŠ è½½å™¨ï¼Œå®ƒå¯ä»¥æ ¹æ®æŒ‰é”®ç»„åˆé€‰æ‹©ç•™åœ¨ fastbootã€ä½¿ç”¨ç³»ç»Ÿ kernel å’Œåœ¨ç³»ç»Ÿç›®å½•çš„ ramdisk å¯åŠ¨åˆ° Android ç³»ç»Ÿã€æˆ–æ˜¯ä½¿ç”¨ recovery çš„ ramdisk å¯åŠ¨åˆ° Recoveryã€‚ æœ¬æ–‡ä»‹ç» ABL çš„ä»£ç ç»„ç»‡å’Œå¤§è‡´å¯åŠ¨æµç¨‹ï¼Œç”±äºç¯‡å¹…é™åˆ¶ï¼Œå¯¹äºå¯åŠ¨ Linux å’Œ fastboot çš„ä»£ç è§£æå°†ä¼šå•ç‹¬å‘å„è‡ªçš„æ–‡ç« ã€‚ ä»£ç ç»„ç»‡ é«˜é€šå¹³å°çš„ ABL æºç å¯ä»¥åœ¨ Code Aurora Forum å¤„æ‰¾åˆ°ã€‚ ABL æ˜¯åŸºäº EDK II æ„å»ºçš„ï¼Œæ•´ä½“çš„é¡¹ç›®ç»“æ„æ˜¯æ ‡å‡†çš„ EDK II æºç æ ‘ã€‚æœ¬æ–‡ä½¿ç”¨æˆæ–‡æ—¶çš„ uefi.lnx.3.0.r1 åˆ†æ”¯æ¥åˆ†æï¼Œæäº¤ä¸º c4da6fcb959fa67cb2aa89007beebfab66226268ã€‚ åœ¨é¡¹ç›®çš„ Makefile ä¸­ï¼Œæœ€é‡è¦çš„ä¸¤ä¸ªæ„å»ºç›®æ ‡æ˜¯ï¼š 12ABL_FV_IMG := $(BUILD_ROOT)/FV/abl.fvABL_FV_ELF := $(BOOTLOADER_OUT)/../../unsigned_abl.elf å…¶ä¸­ï¼ŒABL_FV_IMG æ˜¯æœ€é‡è¦çš„æ„å»ºç›®æ ‡ï¼Œå®ƒæ˜¯ä» QcomModulePkg æ„å»ºçš„ firmwareï¼ˆfvï¼Œå›ºä»¶ï¼‰ï¼š 12345ABL_FV_IMG: EDK_TOOLS_BIN @. ./edksetup.sh BaseTools &amp;&amp; \\ build -p $(WORKSPACE)/QcomModulePkg/QcomModulePkg.dsc cp $(BUILD_ROOT)/FV/FVMAIN_COMPACT.Fv $(ABL_FV_IMG) è€Œ ABL_FV_ELF åˆ™åªæ˜¯è°ƒç”¨ QcomModulePkg/Tools/image_header.py æ¥æŠŠ abl.fv è½¬æ¢ä¸ºä¸€ä¸ª ELF æ–‡ä»¶ï¼Œå¯ä»¥åˆ·å†™åˆ°è®¾å¤‡çš„ EMMC æˆ–é—ªå­˜ä¸­çš„ abl åˆ†åŒºã€‚ åœ¨ QcomModulePkg ä¸­ï¼Œå›ºä»¶çš„å…¥å£æ˜¯ FV.FVMAIN_COMPACTï¼Œå®ƒåŒ…å«äº† FV.FVMAINï¼Œåœ¨è¿™ä¸ªæ¨¡å—é‡Œï¼Œå›Šæ‹¬äº† EDK II æä¾›çš„åŸºç¡€ ARM æ ˆã€MMU ç­‰ç»„ä»¶ï¼Œå¹¶åŒ…å«äº† QcomModulePkg/Application/LinuxLoader/LinuxLoader.inf è¿™ä¸ª Linux çš„åŠ è½½å™¨ï¼Œç”¨æ¥åœ¨ ARM å¹³å°ä¸Šå°†è¿™ä¸ªå›ºä»¶å¯åŠ¨å¹¶åŠ è½½ Android çš„ Linux å†…æ ¸ã€‚ è¿™ä¸ª LinuxLoader æ˜¯ä¸€ä¸ª UEFI åº”ç”¨ç¨‹åºï¼Œå®ƒçš„ç¨‹åºå…¥å£ç‚¹å®šä¹‰å¦‚ä¸‹ï¼š 1ENTRY_POINT = LinuxLoaderEntry å®ƒåŒ…å«äº† EDK II ä¸­çš„ä¸€äº›æ¨¡å—ï¼š 1234567[Packages] ArmPkg/ArmPkg.dec MdePkg/MdePkg.dec EmbeddedPkg/EmbeddedPkg.dec ArmPlatformPkg/ArmPlatformPkg.dec MdeModulePkg/MdeModulePkg.dec QcomModulePkg/QcomModulePkg.dec å…¶ä¸­ï¼Œåœ¨ QcomModulePkg çš„ Library ä¸­ï¼Œæœ‰ FastbootLibã€BootLibã€zlib ç­‰åº“ï¼ŒFastboot çš„å®ç°å°±åœ¨ FastbootLib ä¸­ï¼Œè€Œ BootLib ä¸­åŒ…å«äº†å¯åŠ¨ Linux å†…æ ¸çš„å…·ä½“å®ç°ï¼Œè‡³äº zlib åˆ™æ˜¯å› ä¸º Linux å†…æ ¸æœ‰æ—¶æ˜¯è¢«å‹ç¼©äº†çš„ã€‚ å¯åŠ¨æµç¨‹ åœ¨ LinuxLoaderEntry å…¥å£ç‚¹çš„å‡½æ•°ä¸­ï¼Œç¨‹åºé¦–å…ˆè°ƒç”¨ä¸€äº›åŸºç¡€çš„å¹³å°ä»£ç è®¾ç½®ç¯å¢ƒï¼Œç„¶åé€šè¿‡ DeviceInfoInit () è·å–å¯åŠ¨éªŒè¯çŠ¶æ€å’Œè®¾å¤‡çŠ¶æ€ï¼Œå†ä½¿ç”¨ EnumeratePartitions () å’Œ UpdatePartitionEntries () è·å–å¹¶æ›´æ–°åˆ†åŒºä¿¡æ¯ã€‚ å¦‚æœå­˜åœ¨å¤šä¸ªå¯åŠ¨ slot çš„è¯ï¼ˆè¿™é‡ŒæŒ‡æœ‰ A/B åˆ†åŒºçš„ Android è®¾å¤‡ï¼Œå…¶ä¸­ A å’Œ B ä¸€èˆ¬å³ä¸ºä¸¤ä¸ª slotï¼‰ï¼Œå°±å¯»æ‰¾å·²æ¿€æ´»çš„ slot å¹¶è®°å½•ã€‚ ç´§æ¥ç€è·å–æŒ‰é”®çŠ¶æ€ï¼Œåœ¨ SCAN_DOWN æŒ‰ä¸‹æ—¶è®¾ç½®å¯åŠ¨è‡³ fastboot çš„æ ‡è¯†ï¼ŒSCAN_UP ä¸ºå¯åŠ¨è‡³ recovery çš„è¡¨ç¤ºï¼Œè€Œ SCAN_ESC æŒ‰ä¸‹æ—¶åˆ™é‡å¯è®¾å¤‡è‡³ Emergency Downloadï¼ˆEDLï¼‰æ¨¡å¼ã€‚ç„¶åç¨‹åºè·å–é‡å¯çš„åŸå› å¹¶è®¾ç½®ç›¸åº”æ ‡è¯†ã€‚ åœ¨ä¸å¯åŠ¨è‡³ fastboot æ—¶ï¼ŒåŠ è½½å¹¶éªŒè¯å¯åŠ¨é•œåƒï¼Œè‹¥åŠ è½½å¹¶éªŒè¯æˆåŠŸï¼Œåˆ™è°ƒç”¨ BootLinux (&amp;Info) å¯åŠ¨ Linux å†…æ ¸ã€‚å¦åˆ™è°ƒç”¨ FastbootInitialize () åˆå§‹åŒ–å¹¶è¿è¡Œ fastbootã€‚ æ„å»º æ„å»º EDK II çš„åŸºç¡€å·¥å…·éœ€è¦ä¸»æœºæŒ‡ä»¤é›†çš„ GCC å·¥å…·é›†ï¼Œè€Œ QcomModulePkg éœ€è¦ LLVM å’Œ CLANGï¼Œå› æ­¤éœ€è¦å®‰è£…è¿™ä¸¤ä¸ªå·¥å…·ã€‚ä¹‹åä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç¼–è¯‘ï¼š 1CLANG_PREFIX=aarch64-linux-gnu- PYTHON_COMMAND=python2 make è¿™é‡Œç”±äºæˆ‘çš„ç³»ç»Ÿ python æŒ‡å‘çš„æ˜¯ python3ï¼Œè€Œ EDK II åŸºç¡€å·¥å…·é›†éœ€è¦ python2ï¼Œå› æ­¤æˆ‘æŒ‡å®šäº†ä½¿ç”¨ python2 ä¸ºé»˜è®¤çš„è§£é‡Šå™¨ã€‚ æ€»ç»“ æœ¬æ–‡åˆ†æäº† ABL çš„é¡¹ç›®ç»“æ„å’Œæ•´ä½“å¯åŠ¨æµç¨‹ã€‚ä¸‹ç¯‡æ–‡ç« ä¸­ä¼šè®¨è®ºæ­£å¸¸å¯åŠ¨ Linuxï¼ˆä¹ŸåŒ…å« recovery çš„å¯åŠ¨ï¼‰çš„ä»£ç æµç¨‹ã€‚","categories":[{"name":"Linux","slug":"Linux","permalink":"https://blog.inoki.cc/categories/Linux/"},{"name":"Android","slug":"Linux/Android","permalink":"https://blog.inoki.cc/categories/Linux/Android/"},{"name":"Bootloader","slug":"Linux/Android/Bootloader","permalink":"https://blog.inoki.cc/categories/Linux/Android/Bootloader/"}],"tags":[{"name":"ä¸­æ–‡","slug":"ä¸­æ–‡","permalink":"https://blog.inoki.cc/tags/ä¸­æ–‡/"},{"name":"Linux","slug":"Linux","permalink":"https://blog.inoki.cc/tags/Linux/"},{"name":"Android","slug":"Android","permalink":"https://blog.inoki.cc/tags/Android/"},{"name":"ABL","slug":"ABL","permalink":"https://blog.inoki.cc/tags/ABL/"},{"name":"Bootloader","slug":"Bootloader","permalink":"https://blog.inoki.cc/tags/Bootloader/"}]},{"title":"Android bootloader analysis -- Aboot","slug":"android-bootloader-analysis-aboot-en","date":"2021-10-17T10:48:00.000Z","updated":"2025-03-08T09:40:48.607Z","comments":true,"path":"2021/10/17/android-bootloader-analysis-aboot-en/","link":"","permalink":"https://blog.inoki.cc/2021/10/17/android-bootloader-analysis-aboot-en/","excerpt":"","text":"There are already many articles that explain the boot process of Android on Qualcomm platform. From my translation of [Translation] Qualcomm Android device boot chain of trust, it can be summarized as follows. Aboot: Before MSM8994 (Snapdragon 810), the device first loads Qualcommâ€™s bootrom (PBL) and SBL to initialise some hardware, and immediately hands over to Aboot, an application built on top of the LittleKernel system, which contains fastboot and enables When using the adb reboot bootloader, this is where it boots and stays in in fastboot. XBL/ABL: After the MSM8996 (Snapdragon 820), PBL loads the new XBL, followed by a chain load of ABL, which is a bootloader built on EDK II to replace Aboot (in fact, on the MSM8996 platform, Aboot is still used because XBL and ABL are not mature enough, with XBL It can choose to boot into Android using fastboot, the system kernel and ramdisk in the system directory, or the recovery ramdisk, depending on the keystroke combination. For both boot modes, the source code for Aboot and ABL can be found on Google or at the Code Aurora Forum(CAF): CAF Aboot: https://source.codeaurora.org/quic/la/kernel/lk/ CAF ABL: https://source.codeaurora.org/quic/la/abl/tianocore/edk2/ Note that the Qualcomm maintained projects have been hosted on https://git.codelinaro.org/ since 2022 As you can see, the source tree of Aboot is named lk, short for LittleKernel, which is a small symmetric multiprocessing (SMP) operating system kernel, and Aboot is a device-related application built on top of this operating system. This article will briefly analyze the source code of Aboot as an application (excluding encryption and image verification), and cover some of the device-related code. Code Organization The CAF Aboot commit d37db810993015ea77cc5231a95250b250f4eb07 (the master branch commit at the time of writing) is used here for reference. As an application, the source code of Aboot is in app/aboot/, and the core files are aboot.c and fastboot.c, in addition to some auxiliary code that shows hardware-related information. Depending on the SoC, hardware-related code and definitions are located in platform/ and target/, and most of the device drivers are located in dev/. And arch is the architecture related code and kernel is the actual lk kernel code. Overview During the boot process, lk is loaded, and after the architecture and platform-related initialization, the Aboot application is started. In the aboot.c code, the following code registers Aboot as an application and uses aboot_init as the entry point. 123APP_START(aboot) .init = aboot_init,APP_END In this function, the deviceâ€™s storage device type is detected as EMMC or flash, and two global variables page_size and page_mask are set according to the corresponding page size, which are later used to determine the size of the kernel, ramdisk, and other components loaded from the storage device. The device base information and oem unlock information is then read and stored in the following structs. 1234567891011struct device_info&#123; unsigned char magic[DEVICE_MAGIC_SIZE]; bool is_unlocked; bool is_tampered; bool is_verified; bool charger_screen_enabled; char display_panel[MAX_PANEL_ID_LEN]; char bootloader_version[MAX_VERSION_LEN]; char radio_version[MAX_VERSION_LEN];&#125;; Then initialize the screen (if any), read the device serial number according to the device definition. Immediately afterwards, the boot mode is determined. If it is force reset (usually a long press of the power button to reboot), it goes directly to normal system boot, otherwise it goes to detect the key. If the volume up and down keys are pressed simultaneously (i.e. keys_get_state(KEY_VOLUMEUP) &amp;&amp; keys_get_state(KEY_VOLUMEDOWN)), the device is rebooted and enters Qualcommâ€™s dload mode. If the Volume Up key or Home key is pressed, mark it as entering recovery mode. If the Volume Down key or Back key is pressed, the device is marked as entering fastboot mode. If there is a pre-set reboot mode (e.g., set by adb reboot), boot into the appropriate mode. Finally, check if any fastboot boot mode flag is set, if not, set the partition where the image used for booting is located according to the recovery flag and boot to Linux from EMMC or flash memory (call function boot_linux_from_xxxx()), otherwise leave it in Aboot, register the commands available for fastboot and initialize fastboot. Boot Linux normally (including Recovery) In both normal boot and boot-to-Recovery modes, Aboot loads the kernel and ramdisk from the partition used for booting (typically the boot partition for normal boot and the recovery partition for Recovery mode). A normal boot image consists of a header that stores meta information, and the rest of the image is used to store the kernel, ramdisk, and other components. When the image is flushed, the start of the partition should be read into the following structure. 123456789101112131415161718192021222324struct boot_img_hdr&#123; unsigned char magic[BOOT_MAGIC_SIZE]; unsigned kernel_size; /* size in bytes */ unsigned kernel_addr; /* physical load addr */ unsigned ramdisk_size; /* size in bytes */ unsigned ramdisk_addr; /* physical load addr */ unsigned second_size; /* size in bytes */ unsigned second_addr; /* physical load addr */ unsigned tags_addr; /* physical addr for kernel tags */ unsigned page_size; /* flash page size we assume */ unsigned dt_size; /* device_tree in bytes */ unsigned unused; /* future expansion: should be 0 */ unsigned char name[BOOT_NAME_SIZE]; /* asciiz product name */ unsigned char cmdline[BOOT_ARGS_SIZE]; unsigned id[8]; /* timestamp / checksum / sha1 / etc */&#125;; where kernel_size and ramdisk_size are the size of the kernel and ramdisk to be loaded, and the corresponding xxx_addr is the physical address of the memory to be loaded into (depending on the configuration and device). Before going through the loading of the kernel, ramdisk (and possibly device tree and secondary bootloader, which are ignored here for now), if the device is not unlocked, the kernel needs to be verified and loaded if it passes the verification, for devices that are already unlocked, Aboot will load them directly. Then call the boot_linux function with the read and prepared arguments to prepare the kernel for booting. 123boot_linux((void *)hdr-&gt;kernel_addr, (void *)hdr-&gt;tags_addr, (const char *)hdr-&gt;cmdline, board_machtype(), (void *)hdr-&gt;ramdisk_addr, hdr-&gt;ramdisk_size); In this function, Aboot first updates the kernelâ€™s command line parameters based on the device, such as the type of device to add to the baseband, the type of storage device, and so on. Then the device tree (if it exists) is updated according to the parameters. The hardware needs to be managed by the kernel, so lk will first turn off some hardware: `target_display Shutting down the display with target_display_shutdown(). call target_uninit() to cancel the hardware initialization performed in lk. call enter_critical_section() to disable device interrupts. initialize Watchdog to monitor for early kernel crashes msm_wdog_init(). call platform_uninit() to clean up platform initialization performed by previous lk. Explicitly invalidate the cache arch_disable_cache(UCACHE) and turn off the memory management unit (MMU) arch_disable_mmu(). Finally, check if the Magic Number of the kernel is 64-bit, so that you can enter the kernel via scm_elexec_call, otherwise you can enter the 32-bit kernel directly in 32-bit mode. Entering fastboot mode If you boot into fastboot, you will first call aboot_fastboot_register_commands() to register the available fastboot commands, and then use fastboot_init to initialize and enter fastboot mode. Note that we will still be in Aboot here, and fastboot is part of Aboot, so to speak. Entering fastboot mode If you boot into fastboot, you will first call aboot_fastboot_register_commands() to register the available fastboot commands, and then use fastboot_init to initialize and enter fastboot mode. Note that we will still be in Aboot here, and fastboot is part of Aboot, so to speak. Registering the fastboot command When registering commands, fastboot_register is a very important function that accepts commands and callback functions as arguments. In this version, the available commands are. 123456789101112131415&#123;\"flash:\", cmd_flash&#125;,&#123;\"erase:\", cmd_erase&#125;,&#123;\"boot\", cmd_boot&#125;,&#123;\"continue\", cmd_continue&#125;,&#123;\"reboot\", cmd_reboot&#125;,&#123;\"reboot-bootloader\", cmd_reboot_bootloader&#125;,&#123;\"oem unlock\", cmd_oem_unlock&#125;,&#123;\"oem unlock-go\", cmd_oem_unlock_go&#125;,&#123;\"oem lock\", cmd_oem_lock&#125;,&#123;\"oem verified\", cmd_oem_verified&#125;,&#123;\"oem device-info\", cmd_oem_devinfo&#125;,&#123;\"preflash\", cmd_preflash&#125;,&#123;\"oem enable-charger-screen\", cmd_oem_enable_charger_screen&#125;, &#123;\"oem enable-charger-screen\", cmd_oem_enable_charger_screen&#125;,&#123;\"oem disable-charger-screen\", cmd_oem_disable_charger_screen&#125;, &#123;\"oem disable-charger-screen\", cmd_oem_disable_charger_screen&#125;,&#123;\"oem select-display-panel\", cmd_oem_select_display_panel&#125;, In addition, fastboot_publish can add some variables that can be considered as fastbootâ€™s environment variables. Initialize and enter fastboot The fastboot_init function that is called is defined in fastboot.c. 1int fastboot_init(void *base, unsigned size); It first calls target_fastboot_init() to initialize the hardware of a particular device, more importantly the USB interface. This is a device-specific function, for example for the MSM8974 device, it is implemented as follows. 12345678910void target_fastboot_init(void)&#123; /* Set the BOOT_DONE flag in PM8921 */ pm8x41_set_boot_done();#ifdef SSD_ENABLE clock_ce_enable(SSD_CE_INSTANCE_1); ssd_load_keystore_from_emmc();#endif&#125; Located in target/msm8974/init.c. After this, the USB hardware should be set up, and Aboot then configures and initializes a USB UDC device on the USB interface to receive and send fastboot-related USB packets. Finally, create a lk thread to handle fastboot-related events and initialize the USB interface to receive fastboot commands. Conclusion This article briefly describes and analyzes the implementation of the Aboot boot loader for Android based on the lk kernel prior to 2016, but does not go too far into how lk is built and set up for a particular platform or architecture. We hope you find this helpful. Additions Note that both ARM32 and AArch64 devices run lk and its application Aboot in 32-bit mode, and it is only when the kernel is loaded that the kernel is determined to be 32-bit or 64-bit, and then the kernel is booted in the appropriate boot mode. At load time, Aboot uses the VA() macro to map the physical address to the virtual address read by lk and loads the kernel to that address, as the MMU may exist.","categories":[{"name":"Linux","slug":"Linux","permalink":"https://blog.inoki.cc/categories/Linux/"},{"name":"Android","slug":"Linux/Android","permalink":"https://blog.inoki.cc/categories/Linux/Android/"},{"name":"Bootloader","slug":"Linux/Android/Bootloader","permalink":"https://blog.inoki.cc/categories/Linux/Android/Bootloader/"}],"tags":[{"name":"Linux","slug":"Linux","permalink":"https://blog.inoki.cc/tags/Linux/"},{"name":"Android","slug":"Android","permalink":"https://blog.inoki.cc/tags/Android/"},{"name":"Bootloader","slug":"Bootloader","permalink":"https://blog.inoki.cc/tags/Bootloader/"},{"name":"Aboot","slug":"Aboot","permalink":"https://blog.inoki.cc/tags/Aboot/"}]},{"title":"Android å¯åŠ¨åŠ è½½å™¨åˆ†æ â€”â€” Aboot","slug":"android-bootloader-analysis-aboot","date":"2021-10-17T10:48:00.000Z","updated":"2025-03-08T09:40:48.608Z","comments":true,"path":"2021/10/17/android-bootloader-analysis-aboot/","link":"","permalink":"https://blog.inoki.cc/2021/10/17/android-bootloader-analysis-aboot/","excerpt":"","text":"å·²ç»æœ‰å¾ˆå¤šæ–‡ç« è§£æè¿‡ Android åœ¨é«˜é€šå¹³å°çš„å¯åŠ¨æµç¨‹äº†ã€‚ä»æˆ‘ç¿»è¯‘çš„ã€è¯‘ã€‘é«˜é€š Android è®¾å¤‡çš„å¯åŠ¨ä¿¡ä»»é“¾ä¸­ï¼Œå¯ä»¥æ€»ç»“ä¸ºä¸‹ï¼š Abootï¼šåœ¨ MSM8994ï¼ˆSnapdragon 810ï¼‰ä¹‹å‰ï¼Œè®¾å¤‡é¦–å…ˆåŠ è½½é«˜é€šçš„ bootromï¼ˆPBLï¼‰å’Œ SBL æ¥åˆå§‹åŒ–ä¸€äº›ç¡¬ä»¶ï¼Œç´§æ¥ç€äº¤ç»™ Abootï¼Œè¿™ä¸ªç¨‹åºæ˜¯åœ¨ LittleKernel ç³»ç»Ÿçš„åŸºç¡€ä¸Šæ„å»ºçš„ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œå®ƒåŒ…å«äº† fastbootï¼Œå¯ä»¥å®ç°æ­£å¸¸å¯åŠ¨ boot åˆ†åŒºçš„é•œåƒï¼ˆåŒ…å« Linux Kernel å’Œ ramdiskï¼‰ã€æˆ–æ˜¯æ ¹æ®ç‰¹å®šæŒ‰é”®ç»„åˆå¯åŠ¨ recovery ä¸­çš„é•œåƒï¼ˆä¸€èˆ¬ä¸º recoveryï¼‰æˆ–ç•™åœ¨ Aboot ä¸­çš„ Fastbootã€‚å½“ä½¿ç”¨ adb reboot bootloader æ—¶ï¼Œå°±æ˜¯å¯åŠ¨åˆ°è¿™é‡Œå¹¶åœç•™åœ¨ fastboot ä¸­ï¼› XBL/ABLï¼šåœ¨ MSM8996ï¼ˆSnapdragon 820ï¼‰ä¹‹åï¼ŒPBL åŠ è½½å…¨æ–°çš„ XBLï¼Œç´§æ¥ç€é“¾å¼åŠ è½½ ABLï¼Œè¿™ä¸ªç¨‹åºæ˜¯åŸºäº EDK II æ„å»ºçš„ç”¨æ¥æ›¿æ¢ Aboot çš„å¯åŠ¨åŠ è½½å™¨ï¼ˆå®é™…ä¸Šåœ¨ MSM8996 å¹³å°ï¼Œç”±äº XBL å’Œ ABL ä¸å¤Ÿæˆç†Ÿï¼Œä»ä½¿ç”¨ Abootï¼Œç”± XBL æ¥å¯¹å…¶è¿›è¡ŒåŠ è½½ï¼‰ï¼Œå®ƒå¯ä»¥æ ¹æ®æŒ‰é”®ç»„åˆé€‰æ‹©ç•™åœ¨ fastbootã€ä½¿ç”¨ç³»ç»Ÿ kernel å’Œåœ¨ç³»ç»Ÿç›®å½•çš„ ramdisk å¯åŠ¨åˆ° Android ç³»ç»Ÿã€æˆ–æ˜¯ä½¿ç”¨ recovery çš„ ramdisk å¯åŠ¨åˆ° Recoveryã€‚ è¿™ä¸¤ç§å¯åŠ¨æ¨¡å¼ä¸­ï¼ŒAboot å’Œ ABL çš„æºç éƒ½å¯ä»¥åœ¨ Google æˆ–æ˜¯ Code Aurora Forum å¤„æ‰¾åˆ°ï¼š CAF Abootï¼šhttps://source.codeaurora.org/quic/la/kernel/lk/ CAF ABLï¼šhttps://source.codeaurora.org/quic/la/abl/tianocore/edk2/ å¯ä»¥çœ‹åˆ°ï¼ŒAboot çš„æºç æ ‘åä¸º lkï¼Œå³ LittleKernel çš„ç®€ç§°ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¯¹ç§°å¤šå¤„ç†ï¼ˆSMPï¼‰çš„å°å‹æ“ä½œç³»ç»Ÿå†…æ ¸ï¼Œè€Œ Aboot æ˜¯åœ¨è¿™ä¸ªæ“ä½œç³»ç»Ÿçš„åŸºç¡€ä¸Šæ„å»ºçš„ä¸€ä¸ªè®¾å¤‡ç›¸å…³çš„åº”ç”¨ç¨‹åºã€‚æœ¬æ–‡å°†å¯¹ Aboot ä½œä¸ºåº”ç”¨ç¨‹åºéƒ¨åˆ†çš„æºç è¿›è¡Œç®€è¦åˆ†æï¼ˆä¸åŒ…æ‹¬åŠ å¯†ä¸é•œåƒéªŒè¯ï¼‰ï¼Œå¹¶æ¶‰åŠä¸€éƒ¨åˆ†è®¾å¤‡ç›¸å…³ä»£ç ã€‚ ä»£ç ç»„ç»‡ è¿™é‡Œä½¿ç”¨ CAF Aboot ä¸­ commit d37db810993015ea77cc5231a95250b250f4eb07ï¼ˆåœ¨æˆæ–‡æ—¶çš„ master åˆ†æ”¯æäº¤ï¼‰ä¸ºå‚è€ƒã€‚ ä½œä¸ºä¸€ä¸ªåº”ç”¨ç¨‹åºï¼ŒAboot çš„æºç åœ¨ app/aboot/ ä¸­ï¼Œæ ¸å¿ƒæ–‡ä»¶ä¸º aboot.c å’Œ fastboot.cï¼Œé™¤æ­¤ä¹‹å¤–å…¶ä¸­è¿˜æœ‰ä¸€äº›æ˜¾ç¤ºç¡¬ä»¶ç›¸å…³çš„è¾…åŠ©ä»£ç ã€‚æ ¹æ® SoC ä¸åŒï¼Œç¡¬ä»¶ç›¸å…³çš„ä»£ç å’Œå®šä¹‰åˆ†å¸ƒåœ¨ platform/ å’Œ target/ ä¸­ï¼Œå¤§éƒ¨åˆ†è®¾å¤‡é©±åŠ¨éƒ½ä½äº dev/ ä¸­ã€‚è€Œ arch ä¸ºæ¶æ„ç›¸å…³ä»£ç ï¼Œkernel ä¸ºå®é™…çš„ lk å†…æ ¸ä»£ç ã€‚ æ•´ä½“æµç¨‹ å¯åŠ¨è¿‡ç¨‹ä¸­ï¼Œlk è¢«åŠ è½½ï¼Œå®Œæˆæ¶æ„å’Œå¹³å°ç›¸å…³çš„åˆå§‹åŒ–ä¹‹åï¼Œå¯åŠ¨ Aboot è¿™ä¸ªåº”ç”¨ç¨‹åºã€‚åœ¨ aboot.c ä»£ç ä¸­ï¼Œä»¥ä¸‹ä»£ç æ³¨å†Œ Aboot ä¸ºä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œå¹¶å°† aboot_init ä½œä¸ºå…¥å£ï¼š 123APP_START(aboot) .init = aboot_init,APP_END åœ¨è¿™ä¸ªå‡½æ•°ä¸­ï¼Œä¼šæ£€æµ‹è®¾å¤‡çš„å‚¨å­˜è®¾å¤‡ç±»å‹ä¸º EMMC è¿˜æ˜¯é—ªå­˜ï¼Œå¹¶æ ¹æ®ç›¸åº”çš„ page å¤§å°è®¾ç½® page_size å’Œ page_mask ä¸¤ä¸ªå…¨å±€å˜é‡ï¼Œè¿™ä¸¤ä¸ªå˜é‡åœ¨ä¹‹åç”¨äºç¡®å®šä»å‚¨å­˜è®¾å¤‡ä¸­åŠ è½½çš„å†…æ ¸ã€ramdisk ç­‰ç»„ä»¶çš„å¤§å°ã€‚ ç„¶åè¯»å–è®¾å¤‡çš„åŸºç¡€ä¿¡æ¯å’Œ oem è§£é”ä¿¡æ¯ï¼Œå‚¨å­˜åˆ°ä»¥ä¸‹ç»“æ„ä½“ä¸­ï¼š 1234567891011struct device_info&#123; unsigned char magic[DEVICE_MAGIC_SIZE]; bool is_unlocked; bool is_tampered; bool is_verified; bool charger_screen_enabled; char display_panel[MAX_PANEL_ID_LEN]; char bootloader_version[MAX_VERSION_LEN]; char radio_version[MAX_VERSION_LEN];&#125;; ç„¶åæ ¹æ®è®¾å¤‡å®šä¹‰åˆå§‹åŒ–å±å¹•ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ã€è¯»å–è®¾å¤‡åºåˆ—å·ã€‚ ç´§æ¥ç€å°±è¿›å…¥å¯åŠ¨æ¨¡å¼çš„ç¡®å®šï¼š å¦‚æœæ˜¯ force resetï¼ˆä¸€èˆ¬ä¸ºé•¿æŒ‰ç”µæºé”®é‡å¯ï¼‰ï¼Œåˆ™ç›´æ¥è¿›å…¥æ­£å¸¸ç³»ç»Ÿå¯åŠ¨ï¼Œå¦åˆ™ä¼šå»æ£€æµ‹æŒ‰é”®ï¼› å¦‚æœæ˜¯éŸ³é‡ä¸Šä¸‹é”®åŒæ—¶æŒ‰ä¸‹ï¼ˆå³ keys_get_state(KEY_VOLUMEUP) &amp;&amp; keys_get_state(KEY_VOLUMEDOWN)ï¼‰ï¼Œåˆ™é‡å¯è®¾å¤‡å¹¶è¿›å…¥é«˜é€šçš„ dload æ¨¡å¼ï¼› å¦‚æœéŸ³é‡ä¸Šé”®æˆ–è€… Home é”®è¢«æŒ‰ä¸‹ï¼Œæ ‡è®°ä¸ºè¿›å…¥ recovery æ¨¡å¼ï¼› å¦‚æœéŸ³é‡ä¸‹é”®æˆ–è€… Back é”®è¢«æŒ‰ä¸‹ï¼Œæ ‡è®°ä¸ºè¿›å…¥ fastboot æ¨¡å¼ï¼› å¦‚æœæœ‰é¢„å…ˆè®¾ç½®çš„ reboot æ¨¡å¼ï¼ˆæ¯”å¦‚ adb reboot è®¾ç½®çš„ï¼‰ï¼Œåˆ™å¯åŠ¨åˆ°ç›¸åº”çš„æ¨¡å¼ï¼› æœ€åï¼Œæ£€æµ‹æ˜¯å¦æœ‰ fastboot å¯åŠ¨æ¨¡å¼çš„æ ‡è®°è¢«è®¾ç½®äº†ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™æ ¹æ® recovery çš„æ ‡è®°è®¾ç½®å¯åŠ¨æ‰€ç”¨çš„é•œåƒæ‰€åœ¨åˆ†åŒºï¼Œå¹¶ä» EMMC æˆ–é—ªå­˜å¯åŠ¨åˆ° Linuxï¼ˆè°ƒç”¨å‡½æ•° boot_linux_from_xxxx()ï¼‰ï¼Œå¦åˆ™å°±ç•™åœ¨ Aboot ä¸­ï¼Œæ³¨å†Œ fastboot å¯ç”¨çš„å‘½ä»¤å¹¶åˆå§‹åŒ– fastbootã€‚ æ­£å¸¸å¯åŠ¨ Linuxï¼ˆåŒ…æ‹¬ Recoveryï¼‰ åœ¨æ­£å¸¸å¯åŠ¨å’Œå¯åŠ¨è‡³ Recovery ä¸¤ç§æ¨¡å¼ä¸‹ï¼ŒAboot éƒ½ä¼šä»å¯åŠ¨æ‰€ç”¨åˆ†åŒºï¼ˆå¯¹æ­£å¸¸å¯åŠ¨æ¥è¯´ä¸€èˆ¬ä¸º boot åˆ†åŒºï¼Œè€Œ Recovery æ¨¡å¼ä¸º recovery åˆ†åŒºï¼‰åŠ è½½å†…æ ¸å’Œ ramdiskã€‚ ä¸€ä¸ªæ­£å¸¸çš„å¯åŠ¨é•œåƒç”± header å‚¨å­˜å…ƒä¿¡æ¯ï¼Œå‰©ä¸‹çš„éƒ¨åˆ†ç”¨æ¥å­˜æ”¾å†…æ ¸ã€ramdisk ç­‰ç»„ä»¶ã€‚å½“åˆ·å…¥é•œåƒæ—¶ï¼Œåˆ†åŒºçš„å¼€å§‹åº”å½“å¯ä»¥è¢«è¯»å–åˆ°ä»¥ä¸‹ç»“æ„ä¸­ï¼š 123456789101112131415161718192021222324struct boot_img_hdr&#123; unsigned char magic[BOOT_MAGIC_SIZE]; unsigned kernel_size; /* size in bytes */ unsigned kernel_addr; /* physical load addr */ unsigned ramdisk_size; /* size in bytes */ unsigned ramdisk_addr; /* physical load addr */ unsigned second_size; /* size in bytes */ unsigned second_addr; /* physical load addr */ unsigned tags_addr; /* physical addr for kernel tags */ unsigned page_size; /* flash page size we assume */ unsigned dt_size; /* device_tree in bytes */ unsigned unused; /* future expansion: should be 0 */ unsigned char name[BOOT_NAME_SIZE]; /* asciiz product name */ unsigned char cmdline[BOOT_ARGS_SIZE]; unsigned id[8]; /* timestamp / checksum / sha1 / etc */&#125;; å…¶ä¸­ kernel_size å’Œ ramdisk_size æ˜¯è¦åŠ è½½çš„å†…æ ¸å’Œ ramdisk çš„å¤§å°ï¼Œå¯¹åº”çš„ xxx_addr æ˜¯éœ€è¦åŠ è½½åˆ°çš„å†…å­˜çš„ç‰©ç†åœ°å€ï¼ˆå–å†³äºé…ç½®å’Œè®¾å¤‡ï¼‰ã€‚ åœ¨ç»è¿‡å†…æ ¸ã€ramdiskï¼ˆä¹Ÿå¯èƒ½æœ‰ device tree å’Œ secondary bootloaderï¼Œè¿™é‡Œæš‚æ—¶å¿½ç•¥ï¼‰çš„åŠ è½½å‰ï¼Œè‹¥è®¾å¤‡æœªè§£é”ï¼Œåˆ™éœ€è¦éªŒè¯å†…æ ¸å¹¶åœ¨éªŒè¯é€šè¿‡çš„æƒ…å†µåŠ è½½ï¼Œå¯¹äºå·²ç»è§£é”çš„è®¾å¤‡ï¼ŒAboot ä¼šç›´æ¥åŠ è½½ã€‚ ç„¶åä½¿ç”¨è¯»å–çš„å’Œå‡†å¤‡å¥½çš„å‚æ•°è°ƒç”¨ boot_linux å‡½æ•°å‡†å¤‡å¯åŠ¨å†…æ ¸ã€‚ 123boot_linux((void *)hdr-&gt;kernel_addr, (void *)hdr-&gt;tags_addr, (const char *)hdr-&gt;cmdline, board_machtype(), (void *)hdr-&gt;ramdisk_addr, hdr-&gt;ramdisk_size); åœ¨è¿™ä¸ªå‡½æ•°ä¸­ï¼ŒAboot ä¼šå…ˆæ ¹æ®è®¾å¤‡æ›´æ–°å†…æ ¸çš„å‘½ä»¤è¡Œå‚æ•°ï¼Œæ¯”å¦‚åŠ å…¥åŸºå¸¦çš„è®¾å¤‡ç±»å‹ã€å‚¨å­˜è®¾å¤‡ç±»å‹ç­‰ã€‚ç„¶åæ ¹æ®å‚æ•°æ›´æ–° device treeï¼ˆå¦‚æœå­˜åœ¨ï¼‰ã€‚ ä¹‹åå°±è¦å‡†å¤‡å¯åŠ¨å†…æ ¸äº†ï¼Œç¡¬ä»¶éœ€è¦ç”±å†…æ ¸ç®¡ç†ï¼Œå› æ­¤ lk ä¼šå…ˆå°†ä¸€äº›ç¡¬ä»¶å…³é—­ï¼š ä½¿ç”¨ target_display_shutdown() å…³é—­æ˜¾ç¤ºï¼› è°ƒç”¨ target_uninit() å–æ¶ˆ lk ä¸­è¿›è¡Œçš„ç¡¬ä»¶åˆå§‹åŒ–ï¼› è°ƒç”¨ enter_critical_section() ç¦ç”¨è®¾å¤‡ä¸­æ–­ï¼› åˆå§‹åŒ– Watchdog æ¥ç›‘æ§æ—©æœŸçš„å†…æ ¸å´©æºƒ msm_wdog_init()ï¼› è°ƒç”¨ platform_uninit() æ¸…ç†ä¹‹å‰ lk è¿›è¡Œçš„çš„å¹³å°åˆå§‹åŒ–ï¼› æ˜¾å¼è®©ç¼“å­˜å¤±æ•ˆ arch_disable_cache(UCACHE) å¹¶å…³é—­å†…å­˜ç®¡ç†å•å…ƒï¼ˆMMUï¼‰arch_disable_mmu()ã€‚ æœ€åï¼Œæ£€æµ‹å†…æ ¸çš„ Magic Number æ˜¯å¦ä¸º 64 ä½ï¼Œä»è€Œé€šè¿‡ scm_elexec_call è¿›å…¥å†…æ ¸ï¼Œå¦åˆ™ç›´æ¥ä»¥ 32 ä½æ¨¡å¼è¿›å…¥ 32 ä½å†…æ ¸ã€‚ è¿›å…¥ fastboot æ¨¡å¼ å¦‚æœå¯åŠ¨è‡³ fastbootï¼Œä¼šå…ˆè°ƒç”¨ aboot_fastboot_register_commands() æ³¨å†Œå¯ç”¨çš„ fastboot å‘½ä»¤ï¼Œç„¶åä½¿ç”¨ fastboot_init åˆå§‹åŒ–å¹¶è¿›å…¥ fastboot æ¨¡å¼ã€‚æ³¨æ„ï¼Œè¿™é‡Œæˆ‘ä»¬ä»ä¼šåœ¨ Aboot ä¸­ï¼Œå¯ä»¥è¯´ fastboot æ˜¯ Aboot çš„ä¸€éƒ¨åˆ†ã€‚ æ³¨å†Œ fastboot å‘½ä»¤ åœ¨æ³¨å†Œå‘½ä»¤æ—¶ï¼Œfastboot_register æ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„å‡½æ•°ï¼Œå®ƒæ¥å—å‘½ä»¤å’Œå›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°ã€‚åœ¨è¿™ä¸ªç‰ˆæœ¬ä¸­ï¼Œå¯ç”¨çš„å‘½ä»¤æœ‰ï¼š 123456789101112131415&#123;\"flash:\", cmd_flash&#125;,&#123;\"erase:\", cmd_erase&#125;,&#123;\"boot\", cmd_boot&#125;,&#123;\"continue\", cmd_continue&#125;,&#123;\"reboot\", cmd_reboot&#125;,&#123;\"reboot-bootloader\", cmd_reboot_bootloader&#125;,&#123;\"oem unlock\", cmd_oem_unlock&#125;,&#123;\"oem unlock-go\", cmd_oem_unlock_go&#125;,&#123;\"oem lock\", cmd_oem_lock&#125;,&#123;\"oem verified\", cmd_oem_verified&#125;,&#123;\"oem device-info\", cmd_oem_devinfo&#125;,&#123;\"preflash\", cmd_preflash&#125;,&#123;\"oem enable-charger-screen\", cmd_oem_enable_charger_screen&#125;,&#123;\"oem disable-charger-screen\", cmd_oem_disable_charger_screen&#125;,&#123;\"oem select-display-panel\", cmd_oem_select_display_panel&#125;, é™¤æ­¤ä¹‹å¤–ï¼Œfastboot_publish å¯ä»¥æ·»åŠ ä¸€äº›å˜é‡ï¼Œå¯ä»¥è¯´æ˜¯ fastboot çš„ç¯å¢ƒå˜é‡ã€‚ åˆå§‹åŒ–å¹¶è¿›å…¥ fastboot è°ƒç”¨çš„ fastboot_init å‡½æ•°å®šä¹‰åœ¨ fastboot.c ä¸­ï¼š 1int fastboot_init(void *base, unsigned size); å…¶é¦–å…ˆè°ƒç”¨ target_fastboot_init() åˆå§‹åŒ–ç‰¹å®šè®¾å¤‡çš„ç¡¬ä»¶ï¼Œæ¯”è¾ƒé‡è¦çš„æ˜¯ USB æ¥å£ã€‚è¿™æ˜¯ä¸€ä¸ªè®¾å¤‡ç‰¹å®šçš„å‡½æ•°ï¼Œæ¯”å¦‚å¯¹äº MSM8974 è®¾å¤‡ï¼Œå®ƒçš„å®ç°å¦‚ä¸‹ï¼š 12345678910void target_fastboot_init(void)&#123; /* Set the BOOT_DONE flag in PM8921 */ pm8x41_set_boot_done();#ifdef SSD_ENABLE clock_ce_enable(SSD_CE_INSTANCE_1); ssd_load_keystore_from_emmc();#endif&#125; ä½äº target/msm8974/init.c ä¸­ã€‚ åœ¨è¿™ä¹‹åï¼ŒUSB ç¡¬ä»¶åº”å½“å·²ç»è®¾ç½®å¥½äº†ï¼ŒAboot å°±åœ¨ USB æ¥å£ä¸Šé…ç½®å¹¶åˆå§‹åŒ–ä¸€ä¸ª USB UDC è®¾å¤‡ï¼Œç”¨æ¥æ¥æ”¶å’Œå‘é€ fastboot ç›¸å…³çš„ USB åŒ…ã€‚ æœ€åï¼Œåˆ›å»ºä¸€ä¸ª lk çš„çº¿ç¨‹æ¥å¤„ç† fastboot ç›¸å…³äº‹ä»¶ï¼Œå¹¶åˆå§‹åŒ– USB çš„æ¥å£æ¥æ¥æ”¶ fastboot å‘½ä»¤ã€‚ ç»“è®º è¿™ç¯‡æ–‡ç« ç®€è¦æè¿°å’Œåˆ†æäº† 2016 å¹´ä¹‹å‰ã€åŸºäº lk å†…æ ¸çš„ Android ä½¿ç”¨çš„ Aboot å¯åŠ¨åŠ è½½å™¨çš„å®ç°ï¼Œä½†å¹¶æ²¡æœ‰å¤ªè¿‡æ·±å…¥ lk é’ˆå¯¹æŸä¸€å¹³å°æˆ–è€…æŸä¸€æ¶æ„è¿›è¡Œæ„å»ºå’Œè®¾ç½®çš„å†…å®¹ã€‚å¸Œæœ›å¯¹æ‚¨æœ‰æ‰€å¸®åŠ©ã€‚ è¡¥å…… è¯·æ³¨æ„ï¼Œæ— è®º ARM32 è¿˜æ˜¯ AArch64 çš„è®¾å¤‡ï¼Œéƒ½ä¼šåœ¨ 32 ä½æ¨¡å¼ä¸‹è¿è¡Œ lk å’Œå…¶ä¸­çš„åº”ç”¨ç¨‹åº Abootï¼Œåœ¨åŠ è½½å†…æ ¸æ—¶æ‰ä¼šç¡®å®šä½¿ç”¨çš„å†…æ ¸ä¸º 32 ä½æˆ–æ˜¯ 64 ä½ï¼Œè¿›è€Œé€šè¿‡ç›¸åº”çš„å¯åŠ¨æ¨¡å¼å¯åŠ¨å†…æ ¸ã€‚ åœ¨åŠ è½½çš„æ—¶å€™ï¼Œç”±äº MMU å¯èƒ½å­˜åœ¨ï¼ŒAboot é€šè¿‡ VA() å®å°†ç‰©ç†åœ°å€æ˜ å°„åˆ° lk è¯»å–åˆ°çš„è™šæ‹Ÿåœ°å€ä¸Šï¼Œå¹¶æŠŠå†…æ ¸åŠ è½½åˆ°è¯¥åœ°å€ã€‚","categories":[{"name":"Linux","slug":"Linux","permalink":"https://blog.inoki.cc/categories/Linux/"},{"name":"Android","slug":"Linux/Android","permalink":"https://blog.inoki.cc/categories/Linux/Android/"},{"name":"Bootloader","slug":"Linux/Android/Bootloader","permalink":"https://blog.inoki.cc/categories/Linux/Android/Bootloader/"}],"tags":[{"name":"ä¸­æ–‡","slug":"ä¸­æ–‡","permalink":"https://blog.inoki.cc/tags/ä¸­æ–‡/"},{"name":"Linux","slug":"Linux","permalink":"https://blog.inoki.cc/tags/Linux/"},{"name":"Android","slug":"Android","permalink":"https://blog.inoki.cc/tags/Android/"},{"name":"Bootloader","slug":"Bootloader","permalink":"https://blog.inoki.cc/tags/Bootloader/"},{"name":"Aboot","slug":"Aboot","permalink":"https://blog.inoki.cc/tags/Aboot/"}]},{"title":"ã€è¯‘ã€‘é«˜é€š Android è®¾å¤‡çš„å¯åŠ¨ä¿¡ä»»é“¾","slug":"android-qcom-chain-of-trust","date":"2021-10-17T09:40:00.000Z","updated":"2025-03-08T09:40:48.608Z","comments":true,"path":"2021/10/17/android-qcom-chain-of-trust/","link":"","permalink":"https://blog.inoki.cc/2021/10/17/android-qcom-chain-of-trust/","excerpt":"","text":"åŸæ–‡é“¾æ¥ï¼šhttps://lineageos.org/engineering/Qualcomm-Firmware/ é«˜é€šå…¬å¸çš„ä¿¡ä»»é“¾æ˜¯ä¸€ä¸ªå¤æ‚çš„ï¼Œä½†åˆç®€å•æ˜“æ‡‚çš„ç¨‹åºé›†ã€‚ä½ ä»¬ä¸­çš„è®¸å¤šäººå¯èƒ½å¬è¯´è¿‡â€œå¯åŠ¨å¼•å¯¼ç¨‹åºâ€è¿™ä¸ªæœ¯è¯­ï¼Œä½†ä¸çŸ¥é“å®ƒå®é™…ä¸Šæ˜¯ä»€ä¹ˆï¼Œæˆ–åšä»€ä¹ˆã€‚åœ¨ä»Šå¤©çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»ä¸é«˜é€šå…¬å¸èŠ¯ç‰‡ç»„æœ‰å…³çš„ä¸Šè¿°å†…å®¹ã€‚ æœ¯è¯­ å¼•å¯¼å™¨ï¼šå¼•å¯¼é“¾ä¸­çš„ä¸€ä¸ªç¯èŠ‚çš„æ€»ç§°ï¼Œå®ƒæœ‰ä¸€ä¸ªç‰¹å®šçš„å·¥ä½œï¼Œåœ¨æ¯æ¬¡å†·å¯åŠ¨æ—¶è¿è¡Œã€‚ å†·å¯åŠ¨ï¼šä»æ–­ç”µçŠ¶æ€é‡æ–°å¯åŠ¨ã€‚ QFUSEï¼šé›†æˆåœ¨ SoC ä¸­çš„å¾®è§‚ç¡¬ä»¶ä¿é™©ä¸ - ä¸€æ—¦ç‰©ç†ä¸Šè¢«ç†”æ–­ï¼Œå°±æ— æ³•é‡ç½®æˆ–æ›´æ¢ã€‚ SoCï¼šç‰‡ä¸Šç³»ç»Ÿï¼ˆä½ çš„æ‰‹æœºçš„â€œä¸»æ¿â€çš„ä¸€ç§ï¼‰ã€‚ EFUSE: åŸºäºè½¯ä»¶çš„ä¿é™©ä¸ï¼Œå…¶æ•°æ®å­˜å‚¨åœ¨ QFPROM ä¸­ã€‚ QFPROMï¼šé«˜é€šå…¬å¸çš„ç†”æ–­å™¨åŒºåŸŸã€‚ TrustZoneï¼šé«˜é€šå…¬å¸ ARM èŠ¯ç‰‡ç»„çš„â€œå®‰å…¨åŸŸâ€å®ç°ã€‚ QSEECOMï¼šä¸€ä¸ª Linux å†…æ ¸é©±åŠ¨ï¼Œè®©æˆ‘ä»¬ä¸ TrustZone è¿›è¡Œé€šä¿¡ï¼Œå¹¶å‘ TrustZone å‘å‡ºä¸€ä¸ª SCM è°ƒç”¨ï¼Œä»¥å®Œæˆä¿é™©ä¸ç†”æ–­ç­‰æ“ä½œã€‚å®ƒåªå…è®¸ç»è¿‡ç­¾åçš„å°ç¨‹åºå’Œç»è¿‡æ‰¹å‡†çš„è°ƒç”¨ã€‚ SCMï¼šå®‰å…¨é€šé“ç®¡ç†å™¨ï¼ˆæ³¨ï¼šä¸ Linux çš„ SMC è°ƒç”¨æ— å…³ï¼‰ã€‚ DTBï¼šè®¾å¤‡æ ‘ Blob äºŒè¿›åˆ¶ã€‚å…¶ç›®çš„æ˜¯ä¸º Linux æä¾›â€œä¸€ç§æè¿°ä¸å¯å‘ç°çš„ç¡¬ä»¶çš„æ–¹æ³•â€ï¼Œé˜…è¯»æ›´å¤šå†…å®¹ã€‚ å®‰å“éªŒè¯å¯åŠ¨ï¼ˆAVBï¼‰ï¼šåœ¨ aboot/ABL å±‚é¢å®æ–½çš„ä¸€å¥—ä¸¥æ ¼çš„æ£€æŸ¥ï¼Œä»¥éªŒè¯æ“ä½œç³»ç»Ÿå„éƒ¨åˆ†çš„å®Œæ•´æ€§ï¼Œè¯·ç‚¹å‡»è¿™é‡Œé˜…è¯»æ›´å¤šå†…å®¹ã€‚ DM-Verity:å®‰å“éªŒè¯å¯åŠ¨çš„ä¸€ä¸ªç»„ä»¶ï¼Œå®ƒæ£€æŸ¥åˆ†åŒºï¼Œçœ‹å®ƒä»¬ä¹‹å‰æ˜¯å¦è¢«å®‰è£…è¿‡è¯»/å†™ï¼Œè¯·ç‚¹å‡»è¿™é‡Œé˜…è¯»æ›´å¤šä¿¡æ¯ã€‚ system_as_root: ä¸€ä¸ªæ–°çš„å®‰å“æŒ‚è½½è®¾ç½®é€»è¾‘ï¼Œå°†ç³»ç»Ÿåˆ†åŒºæŒ‚è½½ä¸º&quot;/&quot;ï¼Œè€Œä¸æ˜¯&quot;/system&quot;ã€‚è¿™æ„å‘³ç€ç³»ç»Ÿæ–‡ä»¶ç°åœ¨ä½äº&quot;/system/system&quot;ã€‚è¿™æ˜¯é«˜é€šå…¬å¸æ£€æŸ¥&quot;/&quot;æ˜¯å¦æ›¾åœ¨éªŒè¯å¯åŠ¨ä¸‹è¢«é‡æ–°æŒ‚è½½è¯»å†™çš„ä¸€ç§æ–¹å¼ã€‚å®ƒè¿˜å¼•å…¥äº†æ–°çš„æ ‡å‡†ï¼Œå³å®‰å“ ramdisk è¦å­˜å‚¨åœ¨ç³»ç»Ÿåˆ†åŒºä¸Šï¼Œè€Œä¸æ˜¯å­˜å‚¨åœ¨å¯åŠ¨é•œåƒä¸­ã€‚ ä»€ä¹ˆæ˜¯é«˜é€šå…¬å¸çš„ä¿¡ä»»é“¾/å¯åŠ¨åºåˆ—ï¼Ÿ é«˜é€šå…¬å¸è®¾å¤‡çš„ä¿¡ä»»é“¾ã€å¼•å¯¼ç¨‹åºåºåˆ—å’Œå®‰å…¨ä¸–ç•Œã€‚ è¯¦ç»†ä¿¡æ¯ æ ¹æ®å®šä¹‰ï¼Œå¼•å¯¼ç¨‹åºæ˜¯ä¸€ä¸ªåŠ è½½æ“ä½œç³»ç»Ÿçš„ç¨‹åºï¼Œæˆ–åœ¨è®¾å¤‡å¼€å¯æ—¶é“¾å¼åŠ è½½å¦ä¸€ä¸ªå¼•å¯¼ç¨‹åºã€‚ é«˜é€šå…¬å¸çš„è®¾å¤‡éƒ½ä½¿ç”¨åŸºäºç†”æ–­å™¨çš„é€»è¾‘æ¥å†³å®šæ°¸ä¹…åŠŸèƒ½é…ç½®/åŠ å¯†å¯†é’¥é›†ã€‚å¦‚ä¸Šæ‰€è¿°ï¼Œå…¶ç‰©ç†ç‰ˆæœ¬è¢«ç§°ä¸º QFUSEï¼Œå¹¶ä»¥è¡Œä¸ºå•ä½å­˜å‚¨åœ¨ SoC ä¸Šç§°ä¸º QFPROM çš„åŒºåŸŸä¸­ã€‚ å¦‚æœæ ‡è®°ä¸ºé«˜é€šå®‰å…¨å¯åŠ¨çš„ QFUSE ä¿é™©ä¸ç†”æ–­ï¼ˆåœ¨éä¸­å›½/OnePlus çš„è®¾å¤‡ä¸Šå°±æ˜¯è¿™æ ·ï¼‰ï¼ŒPBLï¼ˆé«˜é€šçš„ä¸»è¦å¯åŠ¨ç¨‹åºï¼‰è¢«éªŒè¯å¹¶ä» BootROM åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œè¿™æ˜¯ SoC ä¸Šä¸€ä¸ªä¸å¯å†™çš„å­˜å‚¨ç©ºé—´ã€‚ ç„¶åï¼ŒPBL è¢«æ‰§è¡Œï¼Œå¹¶å¯åŠ¨ä¸€ç³»åˆ—ç¡¬ä»¶ï¼Œç„¶åéªŒè¯é“¾ä¸­ä¸‹ä¸€ä¸ªå¼•å¯¼è£…è½½ç¨‹åºçš„ç­¾åï¼ŒåŠ è½½å¹¶æ‰§è¡Œå®ƒã€‚ é“¾ä¸­çš„ä¸‹ä¸€ä¸ªå¼•å¯¼ç¨‹åºæ˜¯ SBL*/XBLï¼ˆé«˜é€šå…¬å¸çš„äºŒçº§/å¯æ‰©å±•å¼•å¯¼ç¨‹åºï¼‰ã€‚è¿™äº›æ—©æœŸçš„å¼•å¯¼ç¨‹åºå¯åŠ¨äº†æ ¸å¿ƒç¡¬ä»¶ï¼Œå¦‚ CPU å†…æ ¸ã€MMU ç­‰ã€‚å®ƒä»¬è¿˜è´Ÿè´£å¯åŠ¨ä¸å®‰å“ç³»ç»ŸåŒæ—¶è¿›è¡Œçš„æ ¸å¿ƒè¿›ç¨‹ï¼Œå¦‚è¢«ç§°ä¸º TrustZone çš„é«˜é€š ARM èŠ¯ç‰‡ç»„çš„å®‰å…¨ä¸–ç•Œã€‚SBL*/XBL çš„æœ€åä¸€ä¸ªç›®çš„æ˜¯éªŒè¯ç­¾åã€åŠ è½½å’Œæ‰§è¡Œ Aboot/ABLã€‚ Aboot å°±æ˜¯ä½ ä»¬å¤§å¤šæ•°äººæ‰€è¯´çš„ â€œbootloader æ¨¡å¼â€ï¼Œå› ä¸ºå®ƒæ˜¯è¯¸å¦‚ fastboot æˆ– OEM å›ºä»¶åˆ·å†™å·¥å…·ç­‰æœåŠ¡çš„æ‰€åœ¨åœ°ã€‚Aboot å°†å¤§éƒ¨åˆ†å‰©ä½™çš„æ ¸å¿ƒç¡¬ä»¶å”¤é†’ï¼Œç„¶åä¾æ¬¡éªŒè¯å¯åŠ¨é•œåƒçš„ç­¾åï¼Œé€šè¿‡ dm-verity å°†éªŒè¯çŠ¶æ€æŠ¥å‘Šç»™ Android éªŒè¯å¯åŠ¨ï¼Œç„¶åç­‰å¾…å‰ä¸¤ä¸ªæ­¥éª¤çš„æˆåŠŸï¼Œå°†å†…æ ¸/ramdisk/DTB åŠ è½½åˆ°å†…å­˜ã€‚åœ¨è®¸å¤šè®¾å¤‡ä¸Šï¼ŒAboot/ABL å¯ä»¥è¢«é…ç½®ä¸ºè·³è¿‡å¯†ç å­¦ç­¾åæ£€æŸ¥ï¼Œå…è®¸å¯åŠ¨ä»»ä½•å†…æ ¸/å¯åŠ¨é•œåƒã€‚åœ¨ Aboot å°†æ‰€æœ‰ä¸œè¥¿åŠ è½½åˆ°å†…å­˜ä¸­åï¼Œå†…æ ¸ï¼ˆåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­æ˜¯ Linuxï¼‰ç„¶åä»å¯åŠ¨é•œåƒä¸­è§£å‹ï¼Œæˆ–è€…åœ¨ system_as_root é…ç½®ä¸­ï¼Œç³»ç»Ÿåˆ†åŒºè¢«éªŒè¯å¹¶æŒ‚è½½åˆ°&quot;/&quot;ï¼Œç„¶åä»é‚£é‡Œæå–å‡º ramdiskã€‚åœ¨è¿™ä¹‹åä¸ä¹…ï¼Œinit è¢«æ‰§è¡Œï¼Œå®ƒå¸¦æ¥äº†æˆ‘ä»¬æ‰€çŸ¥çš„ Androidã€‚ åœ¨ aboot/ABL ä¸­ç¦ç”¨åŠ å¯†æ£€æŸ¥çš„é…ç½®é€‰é¡¹é€šå¸¸è¢«ç§°ä¸ºâ€œBootloader Lock Statusâ€ã€‚å½“ä¸€ä¸ªè®¾å¤‡è¢«é”å®šæ—¶ï¼Œè¿™æ„å‘³ç€ aboot ç›®å‰æ­£åœ¨é€šè¿‡ aboot/ABL å¯¹è¯¥è®¾å¤‡çš„å¯åŠ¨é•œåƒæ‰§è¡Œæ•°å­—ç­¾åå®Œæ•´æ€§æ£€æŸ¥ï¼Œåœ¨è¾ƒæ–°çš„è®¾å¤‡ä¸Šï¼Œæ‰§è¡Œâ€œç»¿è‰²â€çš„ Android éªŒè¯å¯åŠ¨çŠ¶æ€ã€‚è¿™äº›è¢«â€œé”å®šâ€çš„è®¾å¤‡ä¸å…è®¸ç”¨æˆ·åˆ·å†™åˆ†åŒºï¼Œä¹Ÿä¸èƒ½å¯åŠ¨è‡ªå®šä¹‰çš„æ— ç­¾åå†…æ ¸ã€‚å¦‚æœè¢«é”å®šçš„è®¾å¤‡è¢«è®¤ä¸ºæ˜¯å®‰å…¨çš„ï¼Œå®‰å“éªŒè¯å¯åŠ¨é€šå¸¸ä¼šæŠ¥å‘Šâ€œç»¿è‰²â€ï¼Œå¹¶å…è®¸è®¾å¤‡ç»§ç»­å¯åŠ¨ï¼Œå¦‚æœå®ƒè¢«è®¤ä¸ºæ˜¯ä¸å®‰å…¨çš„ï¼Œå®ƒå°†æŠ¥å‘Šâ€œçº¢è‰²â€çŠ¶æ€ï¼Œå¹¶é˜»æ­¢è®¾å¤‡å¯åŠ¨ã€‚åœ¨â€œè§£é”â€çš„è®¾å¤‡ä¸Šï¼Œaboot/ABL å…è®¸è®¾å¤‡åˆ·å†™ï¼Œä¸€äº› OEM å‚å•†å…è®¸ä»å†…å­˜ä¸­å¯åŠ¨æœªç­¾åçš„å¯åŠ¨é•œåƒï¼ˆfastboot å¯åŠ¨ï¼‰ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒéªŒè¯å¯åŠ¨ä¼šæŠ¥å‘Šâ€œæ©™è‰²â€æˆ–â€œçº¢è‰²â€ï¼Œè¿™å–å†³äºé•œåƒæ˜¯å¦æœ‰ç­¾åï¼Œä½†æ— è®ºå¦‚ä½•éƒ½å…è®¸è®¾å¤‡ç»§ç»­å¯åŠ¨ã€‚ ä¿¡ä»»é“¾çš„æˆç†Ÿ åœ¨è¿‡å»åå¹´ä¸­ï¼Œé«˜é€šå…¬å¸çš„ä¿¡ä»»é“¾åœ¨å®‰å…¨æ€§æ–¹é¢æœ‰äº†å·¨å¤§çš„å¢é•¿ã€‚ ä»¥ä¸‹æ˜¯æè¿°ä¿¡ä»»é“¾æˆç†Ÿè¿‡ç¨‹çš„å›¾ç¤ºï¼š è‡³ 2013 æ—¶ä»£ åœ¨ MSM8960ï¼ˆSnapdragon S4 plusï¼‰åŠä¹‹å‰ï¼š 2013-2016 æ—¶ä»£ åœ¨ MSM8974ï¼ˆSnapdragon 800ï¼‰åˆ° MSM8994ï¼ˆSnapdragon 810ï¼‰ä¹‹é—´ï¼š ç°ä»£åŒ– (2016-2018) æ—¶ä»£ åœ¨ MSM8996ï¼ˆSnapdragon 820ï¼‰ä¹‹åï¼š æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œå¼•å¯¼é“¾å·²ç»æœ‰äº†å¾ˆå¤§çš„å‘å±•ã€‚2015 å¹´ï¼Œå¯èƒ½çš„æ”»å‡»åŒºåŸŸè¢«ç¼©å°äº†ï¼ŒäºŒçº§å¼•å¯¼ç¨‹åºï¼ˆSBLï¼‰é“¾è¢«åˆå¹¶æˆä¸€ä¸ªç»Ÿä¸€çš„ SBLã€‚éšç€è¿›ä¸€æ­¥å‘å±•ï¼Œæˆ‘ä»¬çœ‹åˆ° SBL å®Œå…¨è¢«é«˜é€šå…¬å¸çš„æ–°çš„ä¸“æœ‰è§£å†³æ–¹æ¡ˆâ€“å¯æ‰©å±•å¼•å¯¼ç¨‹åºï¼ˆXBLï¼‰æ‰€å–ä»£ï¼Œå®ƒç¼“è§£äº† SBL å¸¦æ¥çš„è®¸å¤šå®‰å…¨é—®é¢˜ã€‚ Aboot ä¹Ÿå·²ç»ä» LittleKernelï¼ˆä¸€ä¸ªå¼€æºçš„å¼•å¯¼ç¨‹åºï¼‰å‘å±•åˆ°äº†å®Œå…¨ç‹¬ç«‹çš„è§£å†³æ–¹æ¡ˆï¼Œç°åœ¨è¢«ç§°ä¸ºä¸“æœ‰çš„ Android å¼•å¯¼ç¨‹åºï¼ˆABLï¼‰ã€‚è¿™ä¸ªæ–°çš„å¼•å¯¼ç¨‹åºå…è®¸ä½¿ç”¨ UEFIï¼Œä»¥åŠå…¶ä»–è®¸å¤šé’ˆå¯¹å¼€å‘è€…/OEM çš„å®‰å…¨å’Œç”Ÿæ´»è´¨é‡çš„æ”¹è¿›ã€‚ è€Œ system_as_root é…ç½®ä¹Ÿå¤§å¤§æ”¹å–„äº†å®‰å…¨æ€§ï¼Œä»¥åŠæ€»ä½“æ¶æ„ã€‚å®ƒå°† Android ramdisk ä»å­˜å‚¨åœ¨å¯åŠ¨é•œåƒä¸­è½¬ç§»åˆ°äº†ç³»ç»Ÿåˆ†åŒºä¸­ï¼Œæ­£å¦‚å…¶åç§°æ‰€æš—ç¤ºçš„ï¼Œç³»ç»Ÿåˆ†åŒºè¢«æŒ‚è½½ä¸º&quot;/&quot;ã€‚è¿™æ ·åšçš„éƒ¨åˆ†åŸå› æ˜¯ä¸ºäº†è®©å®ƒèƒ½å¤Ÿè¢« dm-verity/Android éªŒè¯å¯åŠ¨æ‰€éªŒè¯ã€‚ æ³¨æ„ï¼šæ–°çš„æ— ç¼æ›´æ–°ç³»ç»Ÿè¢«ç§°ä¸ºâ€œA/Bâ€ï¼Œå®ƒä¸ system_as_root æ˜¯ç‹¬ç«‹æ¦‚å¿µçš„ï¼Œå°½ç®¡å®ƒä»¬é€šå¸¸æ˜¯å¹¶åˆ—çš„ã€‚OEM å¯ä»¥é€‰æ‹©å®ç°ä¸€ä¸ªè€Œä¸æ˜¯å¦ä¸€ä¸ªã€‚ OEM é™„åŠ åŠŸèƒ½ è®¸å¤š OEM åœ¨ä»–ä»¬çš„ bootloader è®¾ç½®ä¸­å®æ–½äº†é¢å¤–çš„åŠ å¯†æ£€æŸ¥ï¼Œä»¥è¯•å›¾è¿›ä¸€æ­¥æé«˜å®‰å…¨æ€§ï¼Œæˆ–æ˜¯ä¸ºäº†ä¸€ç§åŠŸèƒ½ï¼ˆå¦‚å…è®¸ç»ˆç«¯ç”¨æˆ·è§£é” bootloaderï¼‰ã€‚ å‡ ä¸ªæ™®éçš„ä¾‹å­ï¼š ä¸‰æ˜Ÿä½¿ç”¨ eMMC CID/a å¯¹åº”çš„å“ˆå¸Œ CID çš„ aboot é•œåƒæ¥å†³å®šå¼€å‘è€…ï¼ˆè§£é”ï¼‰çŠ¶æ€ã€‚ ä¸‰æ˜Ÿçš„â€œKNOX QFUSEâ€åœ¨ä»»ä½•å…¥ä¾µæ—¶éƒ½ä¼šè¢«å¹å“ï¼Œå¦‚æœè¢«è§¦å‘ï¼Œå¯ä»¥è¢«é…ç½®ä¸ºæ“¦é™¤è®¾å¤‡ã€‚ æ‘©æ‰˜ç½—æ‹‰ä½¿ç”¨å•ä¸€çš„ QFUSEï¼Œå¿…é¡»ç†”æ–­æ‰èƒ½è§£é”è®¾å¤‡ï¼Œä»è€Œä½¿ä¿ä¿®æœŸæ°¸ä¹…å¤±æ•ˆã€‚ ç´¢å°¼ä½¿ç”¨äº†ä¸€ä¸ªåŠ å¯† blob å’Œä»–ä»¬çš„â€œTAâ€åˆ†åŒºä¸Šçš„ä¸€ä¸ªä½æ¥å…è®¸è§£é”ã€‚ åŸå§‹è®¾å¤‡åˆ¶é€ å•†ä¹Ÿç»å¸¸å®æ–½ä»–ä»¬è‡ªå·±çš„ä¸“æœ‰æ¨¡å¼ï¼Œè¿™æœ‰å¤šç§ç”¨é€”ã€‚ä¸€äº›ä¾‹å­åŒ…æ‹¬ï¼š ä¸‰æ˜Ÿçš„ä¸“æœ‰ä¸‹è½½æ¨¡å¼ï¼Œç”¨äºå›ºä»¶åˆ·å†™ã€‚ LGä¸“æœ‰çš„ LAFï¼ˆä¸‹è½½ï¼‰æ¨¡å¼ç”¨äºå›ºä»¶åˆ·å†™ã€‚ è°·æ­Œçš„ OSS Fastboot æ¨¡å¼ç”¨äºå›ºä»¶åˆ·å†™ã€‚ ä¸ä¸€èˆ¬çš„è§£å†³æ–¹æ¡ˆç›¸æ¯”ï¼ŒOEM çš„ç‰¹å®šåŠŸèƒ½/æ¨¡å¼å¾€å¾€æœ‰å¾ˆå¤§çš„ä¼˜åŠ¿ï¼Œæ¯”å¦‚æ‘©æ‰˜ç½—æ‹‰æ˜¯ç¬¬ä¸€æ‰¹æ‰©å±• fastboot åè®®ä»¥å…è®¸åˆ·å†™ç¨€ç–åˆ†å—çš„ç³»ç»Ÿé•œåƒçš„ OEM ä¹‹ä¸€ã€‚ç„¶è€Œï¼Œè¿™äº›è§£å†³æ–¹æ¡ˆä¹Ÿå¾ˆæœ‰å¯èƒ½å­˜åœ¨ä¸å¯é¢„è§çš„å®‰å…¨æ¼æ´ï¼Œæ¯”å¦‚ LG ç»å¸¸å‡ºç°çš„ LAF æ¨¡å¼æ¼æ´ï¼Œæˆ–è€…åˆ©ç”¨ä¸‰æ˜Ÿçš„ CID æ–¹æ³•è§£é”å…¶ä»–ä¸å¯è§£é”è®¾å¤‡çš„ SamDunk æ¼æ´ã€‚ åŒæ ·é‡è¦çš„æ˜¯è¦æ³¨æ„ï¼Œè™½ç„¶ OEM å‚å•†å¯ä»¥å®šåˆ¶aboot/ABLï¼Œä»¥åŠæœ‰ä»·æ ¼çš„ SBL*/XBLï¼Œä½† PBL æ˜¯ç”±é«˜é€šå…¬å¸è‡ªå·±åœ¨ SoC ä¸Šæ„å»ºå’Œå‘å¸ƒã€‚PBL å¾ˆå°‘å‡ºç°å…¬å¼€çš„æ¼æ´ï¼Œå› ä¸ºå¤§å¤šæ•°æ¼æ´é€šè¿‡é«˜é€šå…¬å¸çš„ Bug Bounty Program è·å¾—äº†å¤§é‡çš„èµé‡‘ï¼Œå°½ç®¡ PBL ä»¥å‰ä¹Ÿå‡ºç°è¿‡ä¸€äº›å…¬å¼€çš„æ¼æ´ï¼Œä¾‹å¦‚ Aleph Security çš„ EDLï¼ˆé«˜é€šä¸‹è½½æ¨¡å¼ï¼‰æ¼æ´ï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œé˜…è¯»ç›¸å…³ä¿¡æ¯ã€‚","categories":[{"name":"Linux","slug":"Linux","permalink":"https://blog.inoki.cc/categories/Linux/"},{"name":"Android","slug":"Linux/Android","permalink":"https://blog.inoki.cc/categories/Linux/Android/"},{"name":"Bootloader","slug":"Linux/Android/Bootloader","permalink":"https://blog.inoki.cc/categories/Linux/Android/Bootloader/"}],"tags":[{"name":"ç¿»è¯‘","slug":"ç¿»è¯‘","permalink":"https://blog.inoki.cc/tags/ç¿»è¯‘/"},{"name":"ä¸­æ–‡","slug":"ä¸­æ–‡","permalink":"https://blog.inoki.cc/tags/ä¸­æ–‡/"},{"name":"Linux","slug":"Linux","permalink":"https://blog.inoki.cc/tags/Linux/"},{"name":"Android","slug":"Android","permalink":"https://blog.inoki.cc/tags/Android/"},{"name":"ABL","slug":"ABL","permalink":"https://blog.inoki.cc/tags/ABL/"},{"name":"Bootloader","slug":"Bootloader","permalink":"https://blog.inoki.cc/tags/Bootloader/"},{"name":"Aboot","slug":"Aboot","permalink":"https://blog.inoki.cc/tags/Aboot/"},{"name":"XBL","slug":"XBL","permalink":"https://blog.inoki.cc/tags/XBL/"}]},{"title":"ã€è¯‘ã€‘ä»é›¶å¼€å§‹çš„ Wayland åˆæˆå™¨ â€”â€” 3. æ¸²æŸ“ä¸€ä¸ªçª—å£","slug":"Writing-a-wayland-compositor-3","date":"2021-09-06T20:48:40.000Z","updated":"2025-03-08T09:40:48.607Z","comments":true,"path":"2021/09/06/Writing-a-wayland-compositor-3/","link":"","permalink":"https://blog.inoki.cc/2021/09/06/Writing-a-wayland-compositor-3/","excerpt":"","text":"åŸæ–‡é“¾æ¥ï¼šWriting a Wayland Compositor, Part 3: Rendering a window è¯‘è€…æ³¨ï¼šè¿™ä¸ªç³»åˆ—æ–‡ç« ä¸­ä½¿ç”¨çš„ä¸ºæ—©æœŸ wlroots ç‰ˆæœ¬ï¼Œå¤§çº¦åœ¨ 0.3 åˆ° 0.4.1 ä¹‹é—´ï¼Œè¯·æ³¨æ„å®‰è£…çš„ç‰ˆæœ¬ è¿™æ˜¯å…³äºä½¿ç”¨ wlroots ä»å¤´å¼€å§‹ç¼–å†™ Wayland åˆæˆå™¨çš„ç³»åˆ—æ–‡ç« ä¸­çš„ç¬¬ä¸‰ç¯‡ã€‚å¦‚æœä½ è¿˜æ²¡æœ‰çœ‹è¿‡ç¬¬ä¸€ç¯‡æ–‡ç« çš„è¯ï¼Œå¯ä»¥çœ‹çœ‹ã€‚æˆ‘ä»¬ä»ä¸€ä¸ª Wayland æœåŠ¡å™¨å¼€å§‹ï¼Œå®ƒæ¥å—å®¢æˆ·ç«¯çš„è¿æ¥ï¼Œå¹¶æš´éœ²äº†ä¸€äº›å…¨å±€çš„ä¸œè¥¿ï¼Œä½†è¿˜æ²¡æœ‰åšä»»ä½•ç‰¹åˆ«æœ‰è¶£çš„äº‹æƒ…ã€‚æˆ‘ä»¬ä»Šå¤©çš„ç›®æ ‡æ˜¯åšä¸€äº›æœ‰è¶£çš„äº‹æƒ…â€“æ¸²æŸ“ä¸€ä¸ªçª—å£ï¼ã€‚ æœ¬æ–‡æ‰€å‰–æçš„æäº¤æ˜¯ 342b7b6ã€‚ ä¸ºäº†æ¸²æŸ“çª—å£ï¼Œæˆ‘ä»¬è¦åšçš„ç¬¬ä¸€ä»¶äº‹å°±æ˜¯å»ºç«‹åˆæˆå™¨ã€‚å®¢æˆ·ç«¯ä½¿ç”¨ wl_compositor å…¨å±€æ¥åˆ†é… wl_surfacesï¼Œå¹¶å°† wl_buffers é™„åŠ åˆ°è¿™äº› surfaceã€‚è¿™äº› surface åªæ˜¯ä¸€ä¸ªé€šç”¨çš„æœºåˆ¶ï¼Œç”¨äºä¸åˆæˆå™¨å…±äº«åƒç´ ç¼“å†²åŒºï¼Œå¹¶ä¸å¸¦æœ‰éšå«çš„è§’è‰²ï¼Œå¦‚ &quot;åº”ç”¨çª—å£&quot;æˆ– â€œé¢æ¿â€ã€‚ wlroots æä¾›äº†ä¸€ä¸ª wl_compositor çš„å®ç°ã€‚è®©æˆ‘ä»¬ä¸ºå®ƒé¢„ç•™ä¸€ä¸ªå¼•ç”¨ï¼š 12345678struct mcw_server &#123; struct wl_display *wl_display; struct wl_event_loop *wl_event_loop; struct wlr_backend *backend;+ struct wlr_compositor *compositor; struct wl_listener new_output; ç„¶åå°†å…¶ç»„è£…èµ·æ¥ï¼š 12345678 wlr_primary_selection_device_manager_create(server.wl_display); wlr_idle_create(server.wl_display); + server.compositor = wlr_compositor_create(server.wl_display,+ wlr_backend_get_renderer(server.backend));+ wl_display_run(server.wl_display); wl_display_destroy(server.wl_display); å¦‚æœæˆ‘ä»¬ç°åœ¨è¿è¡Œ mcwayfaceï¼Œç”¨ weston-info æŸ¥çœ‹å…¨å±€å˜é‡ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°ä¸€ä¸ª wl_compositor å’Œ wl_subcompositor å·²ç»å‡ºç°ï¼š 12interface: &apos;wl_compositor&apos;, version: 4, name: 8interface: &apos;wl_subcompositor&apos;, version: 1, name: 9 ä½ å¯ä»¥é€šè¿‡ wlroots çš„ wl_compositor è·å¾—ä¸€ä¸ª wl_subcompositorã€‚æˆ‘ä»¬å°†åœ¨ä»¥åçš„æ–‡ç« ä¸­è®¨è®ºå­åˆæˆå™¨ã€‚è¯´åˆ°æˆ‘ä»¬å°†åœ¨å¦ä¸€ç¯‡æ–‡ç« ä¸­è®¨è®ºçš„ä¸œè¥¿ï¼Œä¹Ÿè¦åŠ ä¸Šè¿™ä¸ªï¼š 1234567891011 wlr_primary_selection_device_manager_create(server.wl_display); wlr_idle_create(server.wl_display); server.compositor = wlr_compositor_create(server.wl_display, wlr_backend_get_renderer(server.backend)); + wlr_xdg_shell_v6_create(server.wl_display);+ wl_display_run(server.wl_display); wl_display_destroy(server.wl_display); return 0; è¿˜è®°å¾—æˆ‘ä¹‹å‰è¯´è¿‡ï¼Œsurface åªæ˜¯ä¸€äº›æ²¡æœ‰ä½œç”¨çš„åƒç´ å›¢å—ï¼Ÿ xdg_shell æ˜¯ä¸€ä¸ªå¯ä»¥è®© surface å…·æœ‰ä½œç”¨çš„ä¸œè¥¿ã€‚æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­æ›´å¤šåœ°è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚æ·»åŠ äº†è¿™ä¸ªä¹‹åï¼Œå¾ˆå¤šå®¢æˆ·ç«¯å°±å¯ä»¥è¿æ¥åˆ°ä½ çš„åˆæˆå™¨å¹¶ç”Ÿæˆä¸€ä¸ªçª—å£ã€‚ç„¶è€Œï¼Œå¦‚æœä¸æ·»åŠ å…¶ä»–ä¸œè¥¿ï¼Œè¿™äº›çª—å£æ°¸è¿œä¸ä¼šåœ¨å±å¹•ä¸Šæ˜¾ç¤ºã€‚ä½ å¿…é¡»è¦æ¸²æŸ“å®ƒä»¬! wlroots ä¸ wlc å’Œ libweston ç­‰åº“çš„ä¸åŒä¹‹å¤„åœ¨äºï¼Œwlroots ä¸ä¸ºä½ åšä»»ä½•æ¸²æŸ“ã€‚è¿™ç»™äº†ä½ å¾ˆå¤§çš„çµæ´»æ€§ï¼Œä½ å¯ä»¥ç”¨ä»»ä½•ä½ å–œæ¬¢çš„æ–¹å¼æ¸²æŸ“è¡¨é¢ã€‚å®¢æˆ·ç«¯åªæ˜¯ç»™äº†ä½ ä¸€å †åƒç´ ï¼Œä½ å¦‚ä½•å¤„ç†å®ƒä»¬ç”±ä½ è‡ªå·±å†³å®šâ€“ä¹Ÿè®¸ä½ è¦åšä¸€ä¸ªæ¡Œé¢åˆæˆå™¨ï¼Œä¹Ÿè®¸ä½ æƒ³æŠŠå®ƒä»¬ç”»åœ¨ Android é£æ ¼çš„åº”ç”¨åˆ‡æ¢å™¨ä¸Šï¼Œä¹Ÿè®¸ä½ çš„åˆæˆå™¨åœ¨ VR ä¸­æ’åˆ—çª—å£â€“æ‰€æœ‰è¿™äº›éƒ½å¯ä»¥é€šè¿‡ wlroots å®ç°ã€‚ äº‹æƒ…å³å°†å˜å¾—å¤æ‚ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬ä»ç®€å•çš„éƒ¨åˆ†å¼€å§‹ï¼šåœ¨ output_frame å¤„ç†ç¨‹åºä¸­ï¼Œæˆ‘ä»¬å¿…é¡»è·å¾—æˆ‘ä»¬æƒ³è¦æ¸²æŸ“çš„æ¯ä¸ª wlr_surface çš„å¼•ç”¨ã€‚æ‰€ä»¥è®©æˆ‘ä»¬éå†æˆ‘ä»¬çš„ wlr_compositor æ‰€è®°å½•çš„æ¯ä¸€ä¸ª surfaceï¼š 123456789101112 wlr_renderer_begin(renderer, wlr_output);+ struct wl_resource *_surface;+ wl_resource_for_each(_surface, &amp;server-&gt;compositor-&gt;surfaces) &#123;+ struct wlr_surface *surface = wlr_surface_from_resource(_surface);+ if (!wlr_surface_has_buffer(surface)) &#123;+ continue;+ &#125;+ // TODO: Render this surface+ &#125; wlr_output_swap_buffers(wlr_output, NULL, NULL); wlr_compositor ç»“æ„æœ‰ä¸€ä¸ªåä¸º surface çš„æˆå‘˜ï¼Œå®ƒæ˜¯ä¸€ä¸ª wl_resource çš„åˆ—è¡¨ã€‚æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªè¾…åŠ©æ–¹æ³•æ¥ä»å…¶å¯¹åº”çš„ wl_resource ä¸­äº§ç”Ÿä¸€ä¸ª wlr_surfaceã€‚è°ƒç”¨ wlr_surface_has_buffer åªæ˜¯ä¸ºäº†ç¡®ä¿å®¢æˆ·ç«¯ç¡®å®ç»™äº†æˆ‘ä»¬åƒç´ æ¥æ˜¾ç¤ºåœ¨è¿™ä¸ªè¡¨é¢ã€‚ wlroots å¯èƒ½ä¼šè®©ä½ è‡ªå·±åšæ¸²æŸ“ï¼Œä½†æ˜¯æˆ‘ä»¬æä¾›äº†ä¸€äº›å·¥å…·æ¥å¸®åŠ©ä½ ç¼–å†™å…·æœ‰ç®€å•æ¸²æŸ“è¦æ±‚çš„åˆæˆå™¨ï¼šwlr_rendererã€‚æˆ‘ä»¬å·²ç»ç¨å¾®æ¥è§¦äº†ä¸€ä¸‹ï¼Œä½†ç°åœ¨æˆ‘ä»¬è¦çœŸæ­£ä½¿ç”¨å®ƒäº†ã€‚è¿™é‡Œéœ€è¦æœ‰ä¸€ç‚¹ OpenGL çš„çŸ¥è¯†ã€‚å¦‚æœä½ æ˜¯ä¸€ä¸ªå®Œå…¨ä¸æ‡‚ OpenGL çš„æ–°æ‰‹ï¼Œæˆ‘å¯ä»¥æ¨èè¿™ä¸ªæ•™ç¨‹æ¥å¸®åŠ©ä½ ã€‚ç”±äºä½ å¾ˆåŒ†å¿™ï¼Œæˆ‘ä»¬å°†å¯¹åˆ©ç”¨ wlr_renderer æ‰€éœ€çš„æ¦‚å¿µåšä¸€ä¸ªå¿«é€Ÿçš„é€Ÿæˆè¯¾ç¨‹ã€‚å¦‚æœä½ è¿·è·¯äº†ï¼Œå°±è·³åˆ°ä¸‹ä¸€ä¸ªdiffï¼ŒæŠŠå®ƒå½“ä½œä½¿ä½ çš„çª—å£å‡ºç°çš„é­”æ³•å’’è¯­ã€‚ æˆ‘ä»¬æœ‰ä¸€å †åƒç´ ï¼Œæˆ‘ä»¬æƒ³æŠŠå®ƒæ”¾åœ¨å±å¹•ä¸Šã€‚æˆ‘ä»¬å¯ä»¥ç”¨ç€è‰²å™¨æ¥åšè¿™ä¸ªã€‚å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ wlr_rendererï¼ˆmcwayfaceä¹Ÿä¼šä½¿ç”¨ï¼‰ï¼Œç€è‰²å™¨æ˜¯ä¸ºä½ æä¾›çš„ã€‚ä¸ºäº†ä½¿ç”¨æˆ‘ä»¬çš„ç€è‰²å™¨ï¼Œæˆ‘ä»¬ç»™å®ƒä»¬æä¾›ä¸€ä¸ªçº¹ç†ï¼ˆä¸€å †åƒç´ ï¼‰å’Œä¸€ä¸ªçŸ©é˜µã€‚å¦‚æœæˆ‘ä»¬æŠŠè¡¨é¢ä¸Šçš„æ¯ä¸ªåƒç´ åæ ‡å½“ä½œä¸€ä¸ªçŸ¢é‡ï¼Œä»ï¼ˆ0ï¼Œ0ï¼‰ï¼›å·¦ä¸Šè§’ï¼Œåˆ°ï¼ˆ1ï¼Œ1ï¼‰ï¼›å³ä¸‹è§’ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯äº§ç”Ÿä¸€ä¸ªçŸ©é˜µï¼Œæˆ‘ä»¬å¯ä»¥æŠŠçŸ¢é‡ä¹˜ä»¥è¿™ä¸ªçŸ©é˜µæ¥æ‰¾åˆ°å±å¹•ä¸Šè¦ç»˜åˆ¶çš„åƒç´ çš„æœ€ç»ˆåæ ‡ã€‚æˆ‘ä»¬å¿…é¡»å°†åƒç´ åæ ‡ä»è¿™ä¸ª0-1ç³»ç»ŸæŠ•å°„åˆ°å±å¹•ä¸Šæˆ‘ä»¬æƒ³è¦çš„çŸ©å½¢çš„åæ ‡ã€‚ ç„¶è€Œï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜ï¼šå±å¹•ä¸Šçš„åæ ‡ä¹Ÿæ˜¯ä»0åˆ°1ï¼Œè€Œä¸æ˜¯ï¼Œä¾‹å¦‚ï¼Œ0-1920å’Œ0-1080ã€‚ä¸ºäº†æŠŠ &quot;æŠŠæˆ‘çš„640x480çª—å£æ”¾åœ¨åæ ‡100,100å¤„ &quot;è¿™æ ·çš„åæ ‡æŠ•å°„åˆ°å±å¹•åæ ‡ä¸Šï¼Œæˆ‘ä»¬ä½¿ç”¨æ­£æŠ•å½±çŸ©é˜µã€‚æˆ‘çŸ¥é“è¿™å¬èµ·æ¥å¾ˆå“äººï¼Œä½†ä¸ç”¨æ‹…å¿ƒ-- wlroots ä¸ºä½ åšäº†æ‰€æœ‰çš„å·¥ä½œã€‚ä½ çš„ wlr_output å·²ç»æœ‰ä¸€ä¸ªåˆé€‚çš„çŸ©é˜µï¼Œå«åš transform_matrixï¼Œå®ƒæŠŠä½ çš„å±å¹•çš„å½“å‰åˆ†è¾¨ç‡ã€æ¯”ä¾‹ç³»æ•°å’Œæ—‹è½¬éƒ½çº³å…¥å…¶ä¸­ã€‚ å¥½äº†ï¼Œå¸Œæœ›ä½ è¿˜åœ¨å¬æˆ‘è¯´ã€‚è¿™å¬èµ·æ¥æœ‰ç‚¹å¤æ‚ï¼Œä½†æ‰€æœ‰è¿™äº›åºŸè¯çš„è¡¨ç°æ˜¯ç›¸å½“ç›´æ¥çš„ã€‚wlroots æä¾›äº†ä¸€äº›å·¥å…·ï¼Œä½¿ä¹‹å¯¹ä½ æ¥è¯´å¾ˆå®¹æ˜“ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬è¦å‡†å¤‡ä¸€ä¸ª wlr_boxï¼Œå®ƒä»£è¡¨ï¼ˆåœ¨è¾“å‡ºåæ ‡ä¸­ï¼‰æˆ‘ä»¬å¸Œæœ› surface æ˜¾ç¤ºçš„åœ°æ–¹ã€‚ 12345678910111213 struct wl_resource *_surface; wl_resource_for_each(_surface, &amp;server-&gt;compositor-&gt;surfaces) &#123; struct wlr_surface *surface = wlr_surface_from_resource(_surface); if (!wlr_surface_has_buffer(surface)) &#123; continue; &#125;- // TODO: Render this surface+ struct wlr_box render_box = &#123;+ .x = 20, .y = 20,+ .width = surface-&gt;current-&gt;width,+ .height = surface-&gt;current-&gt;height+ &#125;; &#125; ç°åœ¨ï¼Œæœ€ç²¾å½©çš„éƒ¨åˆ†æ¥äº†ï¼šæˆ‘åˆšæ‰è¯´çš„é‚£äº›èŠ±å“¨çš„æ•°å­¦è¿ç®—éƒ½å¯ä»¥é€šè¿‡ wlroots æä¾›çš„ä¸€ä¸ªè¾…åŠ©å‡½æ•°æ¥å®Œæˆï¼šwlr_matrix_project_boxã€‚ 12345678910111213141516 struct wl_resource *_surface; wl_resource_for_each(_surface, &amp;server-&gt;compositor-&gt;surfaces) &#123; struct wlr_surface *surface = wlr_surface_from_resource(_surface); if (!wlr_surface_has_buffer(surface)) &#123; continue; &#125; struct wlr_box render_box = &#123; .x = 20, .y = 20, .width = surface-&gt;current-&gt;width, .height = surface-&gt;current-&gt;height &#125;;+ float matrix[16];+ wlr_matrix_project_box(&amp;matrix, &amp;render_box,+ surface-&gt;current-&gt;transform,+ 0, &amp;wlr_output-&gt;transform_matrix); &#125; è¿™éœ€è¦ä¸€ä¸ª float[16] çš„å¼•ç”¨æ¥å­˜å‚¨è¾“å‡ºçŸ©é˜µï¼Œä¸€ä¸ªä½ æƒ³æŠ•å½±çš„ç›’å­ï¼Œä¸€äº›å…¶ä»–çš„ä¸œè¥¿ï¼Œç°åœ¨å¹¶ä¸é‡è¦ï¼Œä»¥åŠä½ æƒ³ä½¿ç”¨çš„æŠ•å½±â€“åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åªæ˜¯ä½¿ç”¨ wlr_output æä¾›çš„æŠ•å½±ã€‚ æˆ‘ä»¬ä¹‹æ‰€ä»¥è®©ä½ ç†è§£å¹¶æ‰§è¡Œè¿™äº›æ­¥éª¤ï¼Œæ˜¯å› ä¸ºä½ å®Œå…¨æœ‰å¯èƒ½åœ¨å°†æ¥æƒ³ç”¨ä¸åŒçš„æ–¹å¼æ¥åšè¿™äº›äº‹æƒ…ã€‚è¿™åªæ˜¯æœ€ç®€å•çš„æƒ…å†µï¼Œä½†è¯·è®°ä½ï¼Œwlroots æ˜¯ä¸ºå„ç§æƒ…å†µè®¾è®¡çš„ã€‚ç°åœ¨æˆ‘ä»¬å·²ç»å¾—åˆ°äº†è¿™ä¸ªçŸ©é˜µï¼Œæˆ‘ä»¬ç»ˆäºå¯ä»¥æ¸²æŸ“è¿™ä¸ª surface äº†ã€‚ 123456789101112131415161718 struct wl_resource *_surface; wl_resource_for_each(_surface, &amp;server-&gt;compositor-&gt;surfaces) &#123; struct wlr_surface *surface = wlr_surface_from_resource(_surface); if (!wlr_surface_has_buffer(surface)) &#123; continue; &#125; struct wlr_box render_box = &#123; .x = 20, .y = 20, .width = surface-&gt;current-&gt;width, .height = surface-&gt;current-&gt;height &#125;; float matrix[16]; wlr_matrix_project_box(&amp;matrix, &amp;render_box, surface-&gt;current-&gt;transform, 0, &amp;wlr_output-&gt;transform_matrix);+ wlr_render_with_matrix(renderer, surface-&gt;texture, &amp;matrix, 1.0f);+ wlr_surface_send_frame_done(surface, &amp;now); &#125; æˆ‘ä»¬è¿˜æŠ›å‡ºäº†ä¸€ä¸ª wlr_surface_send_frame_doneï¼Œè¿™è®©å®¢æˆ·ç«¯çŸ¥é“æˆ‘ä»¬å·²ç»å®Œæˆäº†ï¼Œæ‰€ä»¥ä»–ä»¬å¯ä»¥å‘é€å¦ä¸€å¸§ã€‚æˆ‘ä»¬å®Œæˆäº†! ç°åœ¨è¿è¡Œ mcwayfaceï¼Œç„¶åæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š 12$ WAYLAND_DISPLAY=wayland-1 weston-simple-shm &amp;$ WAYLAND_DISPLAY=wayland-1 gnome-terminal -- htop çœ‹çœ‹è¿™ç¾å¦™çš„å›¾ç‰‡ï¼š è¿è¡Œä»»ä½•ä½ å–œæ¬¢çš„å…¶ä»–å®¢æˆ·ç«¯â€“å®ƒä»¬ä¸­çš„è®¸å¤šéƒ½å¯ä»¥å·¥ä½œã€‚ æˆ‘ä»¬ä»Šå¤©ä½¿ç”¨äº†ä¸€ç‚¹é»‘å®¢æŠ€æœ¯ï¼Œç®€å•åœ°æ¸²æŸ“äº† wl_compositor æ‰€çŸ¥é“çš„æ‰€æœ‰è¡¨é¢ã€‚åœ¨å®è·µä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ‰©å±•æˆ‘ä»¬çš„ xdg_shell æ”¯æŒï¼ˆä¹Ÿå¯ä»¥æ·»åŠ ä¸€äº›å…¶ä»–çš„ shellï¼‰æ¥æ­£ç¡®åœ°å®Œæˆè¿™ä¸ªä»»åŠ¡ã€‚æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚ åœ¨ä½ èµ°ä¹‹å‰ï¼Œè¯·æ³¨æ„ï¼šåœ¨è¿™æ¬¡æäº¤ä¹‹åï¼Œæˆ‘é‡æ–°ç»„ç»‡äº†ä¸€äº›ä¸œè¥¿â€“æˆ‘ä»¬å¾ˆå¿«å°±ä¼šæ·˜æ±°è¿™ç§å•æ–‡ä»¶çš„æ–¹æ³•ã€‚è¯·çœ‹è¿™é‡Œçš„æäº¤ã€‚ ä¸‹å›è§! æœ¬æ–‡åŠåŸæ–‡ä½¿ç”¨ CC-BY-SA åè®®å¼€æ”¾ã€‚","categories":[{"name":"Translation","slug":"Translation","permalink":"https://blog.inoki.cc/categories/Translation/"},{"name":"Chinese","slug":"Translation/Chinese","permalink":"https://blog.inoki.cc/categories/Translation/Chinese/"},{"name":"Linux","slug":"Linux","permalink":"https://blog.inoki.cc/categories/Linux/"},{"name":"Wayland","slug":"Linux/Wayland","permalink":"https://blog.inoki.cc/categories/Linux/Wayland/"}],"tags":[{"name":"ç¿»è¯‘","slug":"ç¿»è¯‘","permalink":"https://blog.inoki.cc/tags/ç¿»è¯‘/"},{"name":"ä¸­æ–‡","slug":"ä¸­æ–‡","permalink":"https://blog.inoki.cc/tags/ä¸­æ–‡/"}]},{"title":"ã€è¯‘ã€‘ä»é›¶å¼€å§‹çš„ Wayland åˆæˆå™¨ â€”â€” 2. è£…é…æœåŠ¡å™¨","slug":"Writing-a-wayland-compositor-2","date":"2021-09-06T20:47:40.000Z","updated":"2025-03-08T09:40:48.607Z","comments":true,"path":"2021/09/06/Writing-a-wayland-compositor-2/","link":"","permalink":"https://blog.inoki.cc/2021/09/06/Writing-a-wayland-compositor-2/","excerpt":"","text":"åŸæ–‡é“¾æ¥ï¼šWriting a Wayland Compositor, Part 2: Rigging up the server è¯‘è€…æ³¨ï¼šè¿™ä¸ªç³»åˆ—æ–‡ç« ä¸­ä½¿ç”¨çš„ä¸ºæ—©æœŸ wlroots ç‰ˆæœ¬ï¼Œå¤§çº¦åœ¨ 0.3 åˆ° 0.4.1 ä¹‹é—´ï¼Œè¯·æ³¨æ„å®‰è£…çš„ç‰ˆæœ¬ è¿™æ˜¯å…³äºä½¿ç”¨ wlroots ä»å¤´å¼€å§‹ç¼–å†™ Wayland åˆæˆå™¨çš„ç³»åˆ—æ–‡ç« ä¸­çš„ç¬¬äºŒç¯‡ã€‚å¦‚æœä½ è¿˜æ²¡æœ‰çœ‹è¿‡ç¬¬ä¸€ç¯‡æ–‡ç« ï¼Œå¯ä»¥çœ‹çœ‹ã€‚ä¸Šä¸€æ¬¡ï¼Œæˆ‘ä»¬æœ€ç»ˆå¾—åˆ°äº†ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œå®ƒå¯åŠ¨äº† wlroots åç«¯ï¼Œæšä¸¾äº†è¾“å‡ºè®¾å¤‡ï¼Œå¹¶åœ¨å±å¹•ä¸Šç»˜åˆ¶äº†ä¸€äº›æ¼‚äº®çš„é¢œè‰²ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°†å¼€å§‹æ¥å— Wayland å®¢æˆ·ç«¯çš„è¿æ¥ï¼Œå°½ç®¡æˆ‘ä»¬è¿˜ä¸æ‰“ç®—å¯¹å®ƒä»¬åšä»€ä¹ˆã€‚ æœ¬æ–‡å‰–æçš„æäº¤æ˜¯b45c651ã€‚ å…³äºè¿™äº›åšå®¢æ–‡ç« çš„æ€§è´¨ï¼Œæˆ‘æƒ³è¯´çš„æ˜¯ï¼šæˆ‘ä»¬å°†éœ€è¦å¤§é‡çš„æ–‡ç« æ¥å……å®æˆ‘ä»¬çš„åˆæˆå™¨ã€‚æˆ‘å°†ä¼šæ¯”å¹³æ—¶æ›´é¢‘ç¹åœ°å‘å¸ƒè¿™äº›æ–‡ç« ï¼Œå¤§æ¦‚æ¯å‘¨1-2ç¯‡ï¼Œå¹¶ç»§ç»­ä»¥é€šå¸¸çš„é€Ÿåº¦å‘å¸ƒæˆ‘çš„æ–‡ç« ã€‚å¥½å—ï¼Ÿå¾ˆå¥½ã€‚ æ‰€ä»¥æˆ‘ä»¬å·²ç»å¯åŠ¨äº†åç«¯ï¼Œå¹¶ä¸”æ­£åœ¨æ¸²æŸ“ä¸€äº›æœ‰è¶£çš„ä¸œè¥¿ï¼Œä½†æ˜¯æˆ‘ä»¬ä»ç„¶æ²¡æœ‰è¿è¡ŒWaylandæœåŠ¡å™¨â€“Waylandå®¢æˆ·ç«¯æ²¡æœ‰è¿æ¥åˆ°æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºã€‚æ·»åŠ è¿™ä¸ªå…¶å®å¾ˆå®¹æ˜“ï¼š 12345678910111213141516171819@@ -113,12 +113,18 @@ int main(int argc, char **argv) &#123; server.new_output.notify = new_output_notify; wl_signal_add(&amp;server.backend-&gt;events.new_output, &amp;server.new_output); + const char *socket = wl_display_add_socket_auto(server.wl_display);+ assert(socket);+ if (!wlr_backend_start(server.backend)) &#123; fprintf(stderr, \"Failed to start backend\\n\"); wl_display_destroy(server.wl_display); return 1; &#125; + printf(\"Running compositor on wayland display '%s'\\n\", socket);+ setenv(\"WAYLAND_DISPLAY\", socket, true);+ wl_display_run(server.wl_display); wl_display_destroy(server.wl_display); return 0; è¿™å°±æ˜¯äº†! å¦‚æœä½ å†æ¬¡è¿è¡Œ McWayfaceï¼Œå®ƒå°†æ‰“å°å‡ºè¿™æ ·çš„ä¸œè¥¿ï¼š 1Running compositor on wayland display &apos;wayland-1&apos; Weston æ˜¯ Wayland çš„å‚è€ƒåˆæˆå™¨ï¼ŒåŒ…æ‹¬ä¸€äº›ç®€å•çš„å‚è€ƒå®¢æˆ·ç«¯ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ weston-info è¿æ¥åˆ°æˆ‘ä»¬çš„æœåŠ¡å™¨å¹¶åˆ—å‡ºå…¨å±€å˜é‡ï¼š 12$ WAYLAND_DISPLAY=wayland-1 weston-infointerface: &apos;wl_drm&apos;, version: 2, name: 1 å¦‚æœä½ è¿˜è®°å¾—æˆ‘çš„ã€ŠWayland ç®€ä»‹ã€‹ï¼ŒWayland æœåŠ¡å™¨é€šè¿‡ Wayland æ³¨å†Œè¡¨å‘å®¢æˆ·ç«¯è¾“å‡ºäº†ä¸€ä¸ªå…¨å±€å˜é‡åˆ—è¡¨ã€‚è¿™äº›å…¨å±€å˜é‡æä¾›äº†å®¢æˆ·ç«¯å¯ä»¥ç”¨æ¥ä¸æœåŠ¡å™¨äº’åŠ¨çš„æ¥å£ã€‚æˆ‘ä»¬é€šè¿‡ wlroots è·å¾—äº† wl_drmï¼Œä½†æˆ‘ä»¬å®é™…ä¸Šè¿˜æ²¡æœ‰è¿æ¥ä¸Šä»»ä½•æœ‰ç”¨çš„ä¸œè¥¿ã€‚wlrootsæä¾›äº†è®¸å¤š â€œç±»å‹â€ï¼Œå…¶ä¸­å¤§éƒ¨åˆ†æ˜¯åƒè¿™æ ·çš„ Wayland å…¨å±€æ¥å£çš„å®ç°ã€‚ ä¸€äº› wlroots çš„å®ç°éœ€è¦ä½ è¿›è¡Œä¸€äº›æ“çºµï¼Œä½†å…¶ä¸­æœ‰å‡ ä¸ªæ˜¯è‡ªåŠ¨æå®šçš„ã€‚è£…é…è¿™äº›ä¸œè¥¿å¾ˆå®¹æ˜“ï¼š 1234567891011 printf(\"Running compositor on wayland display '%s'\\n\", socket); setenv(\"WAYLAND_DISPLAY\", socket, true);++ wl_display_init_shm(server.wl_display);+ wlr_gamma_control_manager_create(server.wl_display);+ wlr_screenshooter_create(server.wl_display);+ wlr_primary_selection_device_manager_create(server.wl_display);+ wlr_idle_create(server.wl_display); wl_display_run(server.wl_display); wl_display_destroy(server.wl_display); è¯·æ³¨æ„ï¼Œè¿™äº›æ¥å£ä¸­çš„ä¸€äº›å¹¶ä¸ä¸€å®šæ˜¯ä½ é€šå¸¸æƒ³è¦æš´éœ²ç»™æ‰€æœ‰ Wayland å®¢æˆ·ç«¯çš„æ¥å£â€“ä¾‹å¦‚ï¼Œscreenshooter æ˜¯åº”è¯¥è¢«ä¿æŠ¤èµ·æ¥çš„ä¸œè¥¿ã€‚æˆ‘ä»¬å°†åœ¨åé¢çš„æ–‡ç« ä¸­è®¨è®ºå®‰å…¨é—®é¢˜ã€‚ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬å†æ¬¡è¿è¡Œ weston-infoï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°æ›´å¤šçš„å…¨å±€å˜é‡å·²ç»å‡ºç°ï¼š 12345678$ WAYLAND_DISPLAY=wayland-1 weston-infointerface: &apos;wl_shm&apos;, version: 1, name: 3 formats: XRGB8888 ARGB8888interface: &apos;wl_drm&apos;, version: 2, name: 1interface: &apos;gamma_control_manager&apos;, version: 1, name: 2interface: &apos;orbital_screenshooter&apos;, version: 1, name: 3interface: &apos;gtk_primary_selection_device_manager&apos;, version: 1, name: 4interface: &apos;org_kde_kwin_idle&apos;, version: 1, name: 5 ä½ ä¼šå‘ç° wlroots å®ç°äº†å„ç§ä¸åŒæ¥æºçš„åè®®â€“åœ¨è¿™é‡Œæˆ‘ä»¬çœ‹åˆ° Orbitalã€GTK å’Œ KDEçš„ åè®®ã€‚wlroots åŒ…æ‹¬ä¸€ä¸ª Orbital å±å¹•æˆªå›¾çš„å®¢æˆ·ç«¯å®ä¾‹â€“æˆ‘ä»¬ç°åœ¨å¯ä»¥ç”¨å®ƒæ¥ç»™æˆ‘ä»¬çš„åˆæˆå™¨æˆªä¸ªå›¾ï¼š 12$ WAYLAND_DISPLAY=wayland-1 ./examples/screenshotcannot set buffer size å•Šï¼Œè¿™æ˜¯ä¸ªé—®é¢˜â€“ä½ å¯èƒ½å·²ç»æ³¨æ„åˆ°ï¼Œæˆ‘ä»¬æ²¡æœ‰ä»»ä½• wl_output çš„å…¨å±€å˜é‡ï¼Œå±å¹•æˆªå›¾å®¢æˆ·ç«¯ä¾é å®ƒæ¥è®¡ç®—å±å¹•æˆªå›¾ç¼“å†²åŒºçš„åˆ†è¾¨ç‡ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥æ·»åŠ è¿™äº›ï¼š 1234567@@ -95,6 +99,8 @@ static void new_output_notify(struct wl_listener *listener, void *data) &#123; wl_signal_add(&amp;wlr_output-&gt;events.destroy, &amp;output-&gt;destroy); output-&gt;frame.notify = output_frame_notify; wl_signal_add(&amp;wlr_output-&gt;events.frame, &amp;output-&gt;frame);++ wlr_output_create_global(wlr_output); &#125; å†æ¬¡è¿è¡Œ weston-info ä¼šç»™æˆ‘ä»¬æä¾›ä¸€äº›å…³äºæˆ‘ä»¬ç°åœ¨çš„ output çš„ä¿¡æ¯ï¼š 12345678910111213141516$ WAYLAND_DISPLAY=wayland-1 weston-infointerface: &apos;wl_drm&apos;, version: 2, name: 1interface: &apos;wl_output&apos;, version: 3, name: 2 x: 0, y: 0, scale: 1, physical_width: 0 mm, physical_height: 0 mm, make: &apos;wayland&apos;, model: &apos;wayland&apos;, subpixel_orientation: unknown, output_transform: normal, mode: width: 952 px, height: 521 px, refresh: 0.000 Hz, flags: currentinterface: &apos;wl_shm&apos;, version: 1, name: 3 formats: XRGB8888 ARGB8888interface: &apos;gamma_control_manager&apos;, version: 1, name: 4interface: &apos;orbital_screenshooter&apos;, version: 1, name: 5interface: &apos;gtk_primary_selection_device_manager&apos;, version: 1, name: 6interface: &apos;org_kde_kwin_idle&apos;, version: 1, name: 7 ç°åœ¨æˆ‘ä»¬å¯ä»¥æ‹ä¸‹é‚£å¼ æˆªå›¾äº†! ç»™å®ƒä¸€ä¸ªæœºä¼šï¼ˆwwwwwwï¼‰! æˆ‘ä»¬ç°åœ¨å·²ç»æ¥è¿‘å®Œæˆäº†ã€‚ä¸‹ä¸€ç¯‡æ–‡ç« å°†ä»‹ç» Surface çš„æ¦‚å¿µï¼Œæˆ‘ä»¬å°†ç”¨å®ƒä»¬æ¥æ¸²æŸ“æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªçª—å£ã€‚å¦‚æœä½ åœ¨è¿™ç¯‡æ–‡ç« ä¸­é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œè¯·è”ç³»æˆ‘ï¼Œsir@cmpwn.comï¼Œæˆ–è€…è”ç³» wlroots å›¢é˜Ÿï¼Œ#sway-develã€‚ æœ¬æ–‡åŠåŸæ–‡ä½¿ç”¨ CC-BY-SA åè®®å¼€æ”¾ã€‚","categories":[{"name":"Translation","slug":"Translation","permalink":"https://blog.inoki.cc/categories/Translation/"},{"name":"Chinese","slug":"Translation/Chinese","permalink":"https://blog.inoki.cc/categories/Translation/Chinese/"},{"name":"Linux","slug":"Linux","permalink":"https://blog.inoki.cc/categories/Linux/"},{"name":"Wayland","slug":"Linux/Wayland","permalink":"https://blog.inoki.cc/categories/Linux/Wayland/"}],"tags":[{"name":"ç¿»è¯‘","slug":"ç¿»è¯‘","permalink":"https://blog.inoki.cc/tags/ç¿»è¯‘/"},{"name":"ä¸­æ–‡","slug":"ä¸­æ–‡","permalink":"https://blog.inoki.cc/tags/ä¸­æ–‡/"}]},{"title":"ã€è¯‘ã€‘ä»é›¶å¼€å§‹çš„ Wayland åˆæˆå™¨ â€”â€” 1. Hello wlroots","slug":"Writing-a-wayland-compositor-1","date":"2021-09-05T20:47:40.000Z","updated":"2025-03-08T09:40:48.607Z","comments":true,"path":"2021/09/05/Writing-a-wayland-compositor-1/","link":"","permalink":"https://blog.inoki.cc/2021/09/05/Writing-a-wayland-compositor-1/","excerpt":"","text":"åŸæ–‡é“¾æ¥ï¼šWriting a Wayland Compositor, Part 1: Hello wlroots è¯‘è€…æ³¨ï¼šè¿™ä¸ªç³»åˆ—æ–‡ç« ä¸­ä½¿ç”¨çš„ä¸ºæ—©æœŸ wlroots ç‰ˆæœ¬ï¼Œå¤§çº¦åœ¨ 0.3 åˆ° 0.4.1 ä¹‹é—´ï¼Œè¯·æ³¨æ„å®‰è£…çš„ç‰ˆæœ¬ è¿™æ˜¯ä¸€ç³»åˆ—æ–‡ç« ä¸­çš„ç¬¬ä¸€ç¯‡ã€‚ æˆ‘æ­£åœ¨å†™ä¸€ç¯‡å…³äºä»å¤´å¼€å§‹æ„å»ºä¸€ä¸ª Wayland åˆæˆå™¨çš„æ–‡ç« ã€‚ä½ å¯èƒ½çŸ¥é“ï¼Œæˆ‘ï¼ˆåŸä½œè€…ï¼‰æ˜¯ Sway çš„ä¸»è¦ç»´æŠ¤è€…ï¼Œè¿™æ˜¯ä¸€ä¸ªç›¸å½“å—æ¬¢è¿çš„ Wayland åˆæˆå™¨ã€‚åœ¨è¿‡å»çš„å‡ ä¸ªæœˆé‡Œï¼Œæˆ‘ä»¬å’Œè®¸å¤šå…¶ä»–ä¼˜ç§€çš„å¼€å‘è€…ä¸€èµ·ï¼Œä¸€ç›´åœ¨å¼€å‘ wlrootsã€‚è¿™æ˜¯ä¸€ä¸ªç”¨äºåˆ›å»ºæ–°çš„ Wayland åˆæˆå™¨çš„å¼ºå¤§å·¥å…·ï¼Œä½†å®ƒéå¸¸å¤æ‚éš¾ä»¥ç†è§£ã€‚ä¸è¦æ„Ÿåˆ°ç»æœ›ï¼è¿™ç¯‡æ–‡ç« çš„ç›®çš„æ˜¯è®©å¤§å®¶äº†è§£ Wayland åˆæˆå™¨ã€‚è¿™äº›æ–‡ç« çš„ç›®çš„æ˜¯è®©ä½ ç†è§£å¹¶è‡ªå¦‚åœ°ä½¿ç”¨å®ƒã€‚ åœ¨æˆ‘ä»¬æ·±å…¥è®¨è®ºä¹‹å‰ï¼Œè¯·æ³¨æ„ï¼šwlroots å›¢é˜Ÿä»Šå¤©å¼€å§‹äº†ä¸€é¡¹ä¼—ç­¹æ´»åŠ¨ï¼Œä»¥èµ„åŠ©æˆ‘ä»¬æ¯ä¸ªæ ¸å¿ƒè´¡çŒ®è€…çš„æ—…è¡Œï¼Œè®©ä»–ä»¬äº²è‡ªä¼šé¢å¹¶åœ¨é»‘å®¢é©¬æ‹‰æ¾ä¸Šå·¥ä½œä¸¤å‘¨ã€‚è¯·è€ƒè™‘ä¸ºè¯¥æ´»åŠ¨åšå‡ºè´¡çŒ®! åœ¨è¯•å›¾ç†è§£è¿™ä¸€ç³»åˆ—åšæ–‡ä¹‹å‰ï¼Œä½ å¿…é¡»é˜…è¯»å¹¶ç†è§£æˆ‘ä¹‹å‰çš„æ–‡ç« ã€ŠWayland ä»‹ç»ã€‹ï¼Œå› ä¸ºæˆ‘å°†ä¾é é‚£é‡Œä»‹ç»çš„æ¦‚å¿µå’Œæœ¯è¯­æ¥åŠ å¿«äº‹æƒ…çš„è¿›å±•ã€‚ä¸€äº› OpenGL çš„èƒŒæ™¯æ˜¯æœ‰å¸®åŠ©çš„ï¼Œä½†ä¸æ˜¯å¿…é¡»çš„ã€‚å¯¹ C è¯­è¨€çš„è‰¯å¥½ç†è§£æ˜¯å¿…é¡»çš„ã€‚å¦‚æœä½ å¯¹è¿™ä¸ªç³»åˆ—çš„ä»»ä½•æ–‡ç« æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·é€šè¿‡ sir@cmpwn.com ç›´æ¥è”ç³»æˆ‘ï¼Œæˆ–è€…è”ç³» irc.freenode.net ä¸Šçš„ #sway-devel çš„ wlroots å›¢é˜Ÿã€‚ åœ¨è¿™ä¸€ç³»åˆ—çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬æ­£åœ¨æ„å»ºçš„åˆæˆå™¨å°†æ‰˜ç®¡åœ¨ GitHub ä¸Šâ€”â€”Wayland McWayfaceã€‚æœ¬ç³»åˆ—æ–‡ç« ä¸­çš„æ¯ç¯‡æ–‡ç« éƒ½ä¼šå¯¹ä»é›¶åˆ°åŠŸèƒ½é½å…¨çš„ Wayland åˆæˆå™¨ä¹‹é—´çš„ä¸€æ¬¡æäº¤è¿›è¡Œåˆ†è§£ï¼Œè¿™ç¯‡æ–‡ç« çš„æäº¤æ˜¯ f89092eã€‚æˆ‘åªè§£é‡Šé‡è¦çš„éƒ¨åˆ†â€“æˆ‘å»ºè®®ä½ å•ç‹¬æŸ¥çœ‹æ•´ä¸ªæäº¤ã€‚ è®©æˆ‘ä»¬å¼€å§‹å§ã€‚ ç¬¬ä¸€æ­¥ é¦–å…ˆï¼Œæˆ‘å°†å®šä¹‰ä¸€ä¸ªç»“æ„æ¥ä¿å­˜æˆ‘ä»¬çš„åˆæˆå™¨çš„çŠ¶æ€ï¼š 1234struct mcw_server &#123; struct wl_display *wl_display; struct wl_event_loop *wl_event_loop;&#125;; æ³¨æ„ï¼šmcw æ˜¯ McWayface çš„ç®€ç§°ã€‚æˆ‘ä»¬å°†åœ¨æ•´ä¸ªç³»åˆ—æ–‡ç« ä¸­ä½¿ç”¨è¿™ä¸ªç¼©å†™ã€‚æˆ‘ä»¬å°†æŠŠå…¶ä¸­ä¸€ä¸ªæ”¾åœ¨ä¸€è¾¹ï¼Œå¹¶ä¸ºå®ƒåˆå§‹åŒ–ä¸€ä¸ª Wayland çš„ displayï¼ˆæ³¨æ„ï¼šæˆ‘ä»¬å®Œå…¨å¯ä»¥åˆ©ç”¨ wlroots åç«¯æ¥åˆ¶ä½œé Wayland åˆæˆå™¨çš„åº”ç”¨ç¨‹åºã€‚ç„¶è€Œï¼Œæˆ‘ä»¬è¿˜æ˜¯éœ€è¦ä¸€ä¸ª Wayland çš„ displayï¼Œå› ä¸ºäº‹ä»¶å¾ªç¯å¯¹äºå¾ˆå¤š wlroots çš„å†…éƒ¨ç¨‹åºæ¥è¯´æ˜¯å¿…è¦çš„ï¼‰ï¼š 123456789int main(int argc, char **argv) &#123; struct mcw_server server; server.wl_display = wl_display_create(); assert(server.wl_display); server.wl_event_loop = wl_display_get_event_loop(server.wl_display); assert(server.wl_event_loop); return 0;&#125; Wayland çš„ display ç»™äº†æˆ‘ä»¬å¾ˆå¤šä¸œè¥¿ï¼Œä½†ç°åœ¨æˆ‘ä»¬å…³å¿ƒçš„æ˜¯äº‹ä»¶å¾ªç¯ã€‚è¿™ä¸ªäº‹ä»¶å¾ªç¯è¢«æ·±æ·±åœ°æ•´åˆåˆ°äº† wlroots ä¸­ï¼Œå®ƒè¢«ç”¨æ¥åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­åˆ†é…ä¿¡å·ï¼Œå½“å„ç§æ–‡ä»¶æè¿°ç¬¦ä¸Šçš„æ•°æ®å¯ç”¨æ—¶è¢«é€šçŸ¥ï¼Œç­‰ç­‰ã€‚ åˆ›å»ºåç«¯ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºåç«¯ï¼š 123456struct mcw_server &#123; struct wl_display *wl_display; struct wl_event_loop *wl_event_loop; struct wlr_backend *backend;&#125;; åç«¯æ˜¯æˆ‘ä»¬ç¬¬ä¸€ä¸ª wlroots æ¦‚å¿µï¼Œå®ƒè´Ÿè´£ä»ä½ é‚£é‡ŒæŠ½è±¡å‡ºä½å±‚æ¬¡çš„è¾“å…¥å’Œè¾“å‡ºå®ç°ã€‚æ¯ä¸ªåç«¯å¯ä»¥ç”Ÿæˆé›¶ä¸ªæˆ–å¤šä¸ªè¾“å…¥è®¾å¤‡ï¼ˆå¦‚é¼ æ ‡ã€é”®ç›˜ç­‰ï¼‰å’Œé›¶ä¸ªæˆ–å¤šä¸ªè¾“å‡ºè®¾å¤‡ï¼ˆå¦‚ä½ æ¡Œä¸Šçš„æ˜¾ç¤ºå™¨ï¼‰ã€‚åç«¯ä¸ Wayland æ— å…³â€“å®ƒä»¬çš„ç›®çš„æ˜¯å¸®åŠ©ä½ ä½¿ç”¨ä½ ä½œä¸º Wayland åˆæˆå™¨æ‰€éœ€çš„å…¶ä»– APIã€‚æœ‰å„ç§ä¸åŒç›®çš„çš„åç«¯ï¼š drm åç«¯åˆ©ç”¨ Linux çš„ DRM å­ç³»ç»Ÿç›´æ¥æ¸²æŸ“åˆ°ä½ çš„ç‰©ç†æ˜¾ç¤ºå™¨ libinput åç«¯åˆ©ç”¨ libinput æ¥æšä¸¾å’Œæ§åˆ¶ç‰©ç†è¾“å…¥è®¾å¤‡ Wayland åç«¯åœ¨å¦ä¸€ä¸ªè¿è¡Œ Wayland åˆæˆå™¨çš„çª—å£ä¸Šåˆ›å»º â€œè¾“å‡ºâ€ï¼Œå…è®¸ä½ å¯¹åˆæˆå™¨è¿›è¡ŒåµŒå¥—ã€‚è¿™å¯¹è°ƒè¯•å¾ˆæœ‰ç”¨ X11 åç«¯ä¸ Wayland åç«¯ç±»ä¼¼ï¼Œä½†åœ¨ X11 æœåŠ¡å™¨ä¸Šæ‰“å¼€ä¸€ä¸ª X11 çª—å£ï¼Œè€Œä¸æ˜¯åœ¨ Wayland æœåŠ¡å™¨ä¸Šæ‰“å¼€ä¸€ä¸ª Wayland çª—å£ å¦ä¸€ä¸ªé‡è¦çš„åç«¯æ˜¯å¤šåç«¯ï¼Œå®ƒå…è®¸ä½ åŒæ—¶åˆå§‹åŒ–å‡ ä¸ªåç«¯å¹¶èšåˆå®ƒä»¬çš„è¾“å…¥å’Œè¾“å‡ºè®¾å¤‡ã€‚ä¾‹å¦‚ï¼Œè¿™å¯¹äºåŒæ—¶åˆ©ç”¨ drm å’Œ libinput æ˜¯å¿…è¦çš„ã€‚ æˆ‘ä»¬çš„åº“ wlroots æä¾›äº†ä¸€ä¸ªè¾…åŠ©å‡½æ•°ï¼Œç”¨äºæ ¹æ®ç”¨æˆ·çš„ç¯å¢ƒè‡ªåŠ¨é€‰æ‹©æœ€åˆé€‚çš„åç«¯ï¼š 1234567 server.wl_event_loop = wl_display_get_event_loop(server.wl_display); assert(server.wl_event_loop); server.backend = wlr_backend_autocreate(server.wl_display); assert(server.backend); return 0;&#125; æˆ‘ä¸€èˆ¬å»ºè®®åœ¨å¼€å‘è¿‡ç¨‹ä¸­ä½¿ç”¨ Wayland æˆ– X11 åç«¯ï¼Œç‰¹åˆ«æ˜¯åœ¨æˆ‘ä»¬æœ‰åŠæ³•é€€å‡ºåˆæˆå™¨ä¹‹å‰ã€‚å¦‚æœä½ åœ¨è¿è¡Œä¸­çš„ Wayland æˆ– X11 ä¼šè¯ä¸­è°ƒç”¨ wlr_backend_autocreateï¼Œç›¸åº”çš„åç«¯ä¼šè¢«è‡ªåŠ¨é€‰æ‹©ã€‚ æˆ‘ä»¬ç°åœ¨å¯ä»¥å¯åŠ¨åç«¯å¹¶è¿›å…¥ Wayland äº‹ä»¶å¾ªç¯ï¼š 12345678if (!wlr_backend_start(server.backend)) &#123; fprintf(stderr, \"Failed to start backend\\n\"); return 1;&#125;wl_display_run(server.wl_display);wl_display_destroy(server.wl_display);return 0; å¦‚æœä½ åœ¨è¿™æ—¶è¿è¡Œä½ çš„åˆæˆå™¨ï¼Œä½ åº”è¯¥çœ‹åˆ°åç«¯å¯åŠ¨ï¼Œç„¶åâ€¦ä»€ä¹ˆéƒ½ä¸åšã€‚å¦‚æœä½ ä»è¿è¡Œä¸­çš„ Wayland æˆ– X11 æœåŠ¡å™¨ä¸Šè¿è¡Œï¼Œå®ƒä¼šæ‰“å¼€ä¸€ä¸ªçª—å£ã€‚å¦‚æœä½ åœ¨ DRM ä¸Šè¿è¡Œå®ƒï¼Œå®ƒå¯èƒ½ä¼šåšå¾—å¾ˆå°‘ï¼Œä½ ç”šè‡³ä¸èƒ½åˆ‡æ¢åˆ°å¦ä¸€ä¸ª TTY æ¥æ€æ­»å®ƒã€‚ æ·»åŠ äº‹ä»¶ç›‘å¬å‡½æ•° ä¸ºäº†æ¸²æŸ“ä¸œè¥¿ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“æˆ‘ä»¬å¯ä»¥åœ¨å“ªäº›è¾“å‡ºä¸Šæ¸²æŸ“ã€‚åå°æä¾›äº†ä¸€ä¸ª wl_signalï¼Œå½“å®ƒå¾—åˆ°ä¸€ä¸ªæ–°çš„è¾“å‡ºæ—¶é€šçŸ¥æˆ‘ä»¬ã€‚è¿™å°†å‘ç”Ÿåœ¨å¯åŠ¨æ—¶ï¼Œä»¥åŠä»»ä½•è¾“å‡ºåœ¨è¿è¡Œæ—¶è¢«çƒ­æ’æ‹”æ—¶ã€‚ è®©æˆ‘ä»¬æŠŠå®ƒæ·»åŠ åˆ°æˆ‘ä»¬çš„æœåŠ¡å™¨ç»“æ„ä½“ä¸­ï¼š 12345678struct mcw_server &#123; struct wl_display *wl_display; struct wl_event_loop *wl_event_loop; struct wlr_backend *backend; struct wl_listener new_output; struct wl_list outputs; // mcw_output::link&#125;; è¿™å¢åŠ äº†ä¸€ä¸ª wl_listenersï¼Œå½“æ–°çš„è¾“å‡ºè¢«æ·»åŠ æ—¶ï¼Œå®ƒå°±ä¼šè¢«é€šçŸ¥ã€‚æˆ‘ä»¬è¿˜æ·»åŠ äº†ä¸€ä¸ª wl_listï¼ˆè¿™åªæ˜¯ä¸€ä¸ªç”± libwayland-server æä¾›çš„é“¾æ¥åˆ—è¡¨ï¼‰ï¼Œæˆ‘ä»¬ä»¥åä¼šåœ¨å…¶ä¸­å­˜å‚¨ä¸€äº›çŠ¶æ€ã€‚ä¸ºäº†å¾—åˆ°é€šçŸ¥ï¼Œæˆ‘ä»¬å¿…é¡»ä½¿ç”¨ wl_signal_addï¼š 1234567assert(server.backend);wl_list_init(&amp;server.outputs);server.new_output.notify = new_output_notify;wl_signal_add(&amp;server.backend-&gt;events.new_output, &amp;server.new_output); if (!wlr_backend_start(server.backend)) &#123; æˆ‘ä»¬åœ¨è¿™é‡ŒæŒ‡å®šè¢«é€šçŸ¥çš„å‡½æ•° new_output_notifyï¼š 1234567891011121314151617static void new_output_notify(struct wl_listener *listener, void *data) &#123; struct mcw_server *server = wl_container_of( listener, server, new_output); struct wlr_output *wlr_output = data; if (!wl_list_empty(&amp;wlr_output-&gt;modes)) &#123; struct wlr_output_mode *mode = wl_container_of(wlr_output-&gt;modes.prev, mode, link); wlr_output_set_mode(wlr_output, mode); &#125; struct mcw_output *output = calloc(1, sizeof(struct mcw_output)); clock_gettime(CLOCK_MONOTONIC, &amp;output-&gt;last_frame); output-&gt;server = server; output-&gt;wlr_output = wlr_output; wl_list_insert(&amp;server-&gt;outputs, &amp;output-&gt;link);&#125; è¿™æœ‰ç‚¹å¤æ‚! è¿™ä¸ªå‡½æ•°åœ¨å¤„ç†ä¼ å…¥çš„ wlr_output æ—¶æœ‰å‡ ä¸ªä½œç”¨ã€‚wl_container_of ä½¿ç”¨ä¸€äº›åŸºäº offsetof çš„é­”æ³•ï¼Œä»ç›‘å¬å™¨çš„æŒ‡é’ˆä¸­å¾—åˆ° mcw_server çš„å¼•ç”¨ï¼Œç„¶åæˆ‘ä»¬å°†æ•°æ®æŠ•åˆ°å®é™…çš„ç±»å‹ï¼Œå³ wlr_outputã€‚ è®¾ç½®è¾“å‡º æˆ‘ä»¬è¦åšçš„ä¸‹ä¸€ä»¶äº‹æ˜¯è®¾ç½®è¾“å‡ºæ¨¡å¼ã€‚ä¸€äº›åç«¯ï¼ˆç‰¹åˆ«æ˜¯ X11 å’Œ Waylandï¼‰ä¸æ”¯æŒè®¾ç½®æ¨¡å¼ï¼Œä½†å®ƒä»¬å¯¹äº DRM æ˜¯å¿…è¦çš„ã€‚è¾“å‡ºæ¨¡å¼æŒ‡å®šäº†è¾“å‡ºæ‰€æ”¯æŒçš„å°ºå¯¸å’Œåˆ·æ–°ç‡ï¼Œä¾‹å¦‚ 1920x1080@60Hzã€‚è¿™ä¸ª if è¯­å¥çš„ä¸»ä½“åªæ˜¯é€‰æ‹©äº†æœ€åä¸€ä¸ªï¼ˆé€šå¸¸æ˜¯æœ€é«˜çš„åˆ†è¾¨ç‡å’Œåˆ·æ–°ç‡ï¼‰ï¼Œå¹¶é€šè¿‡ wlr_output_set_mode å°†å…¶åº”ç”¨äºè¾“å‡ºã€‚æˆ‘ä»¬å¿…é¡»è®¾ç½®è¾“å‡ºæ¨¡å¼ï¼Œä»¥ä¾¿å¯¹å…¶è¿›è¡Œæ¸²æŸ“ã€‚ ç„¶åï¼Œæˆ‘ä»¬è®¾ç½®äº†ä¸€äº›çŠ¶æ€ï¼Œè®©æˆ‘ä»¬åœ¨åˆæˆå™¨ä¸­è·Ÿè¸ªè¿™äº›è¾“å‡ºã€‚æˆ‘åœ¨æ–‡ä»¶çš„é¡¶éƒ¨æ·»åŠ äº†è¿™ä¸ªç»“æ„å®šä¹‰ï¼š 1234567struct mcw_output &#123; struct wlr_output *wlr_output; struct mcw_server *server; struct timespec last_frame; struct wl_list link;&#125;; è¿™å°†æ˜¯æˆ‘ä»¬ç”¨æ¥å­˜å‚¨æˆ‘ä»¬å¯¹è¿™ä¸ªè¾“å‡ºçš„ä»»ä½•çŠ¶æ€çš„ç»“æ„ï¼Œè¿™äº›çŠ¶æ€æ˜¯ç‰¹å®šäºæˆ‘ä»¬çš„åˆæˆå™¨éœ€æ±‚çš„ã€‚æˆ‘ä»¬åŒ…æ‹¬ä¸€ä¸ªå¯¹ wlr_output çš„å¼•ç”¨ï¼Œä¸€ä¸ªå¯¹æ‹¥æœ‰è¿™ä¸ªè¾“å‡ºçš„ mcw_server çš„å¼•ç”¨ï¼Œä»¥åŠæœ€åä¸€å¸§çš„æ—¶é—´ï¼Œè¿™åœ¨åé¢ä¼šæœ‰ç”¨ã€‚æˆ‘ä»¬è¿˜é¢„ç•™äº†ä¸€ä¸ª wl_listï¼Œå®ƒè¢« libwayland ç”¨äºé“¾æ¥åˆ—è¡¨ã€‚ æœ€åï¼Œæˆ‘ä»¬å°†è¿™ä¸ªè¾“å‡ºæ·»åŠ åˆ°æœåŠ¡å™¨çš„è¾“å‡ºåˆ—è¡¨ä¸­ã€‚ æˆ‘ä»¬ç°åœ¨å¯ä»¥ä½¿ç”¨äº†ï¼Œä½†å®ƒä¼šæ³„éœ²å†…å­˜ã€‚æˆ‘ä»¬è¿˜éœ€è¦å¤„ç†è¾“å‡ºçš„ç§»é™¤ï¼Œç”¨ä¸€ä¸ªç”± wlr_output æä¾›çš„ä¿¡å·ã€‚æˆ‘ä»¬å°†ç›‘å¬å™¨æ·»åŠ åˆ° mcw_output ç»“æ„ä¸­ï¼š 123456789struct mcw_output &#123; struct wlr_output *wlr_output; struct mcw_server *server; struct timespec last_frame; struct wl_listener destroy; struct wl_list link;&#125;; ç„¶åæˆ‘ä»¬åœ¨å¢åŠ è¾“å‡ºçš„æ—¶å€™æŠŠå®ƒåŠ è¿›æ¥ï¼š 12345 wl_list_insert(&amp;server-&gt;outputs, &amp;output-&gt;link); output-&gt;destroy.notify = output_destroy_notify; wl_signal_add(&amp;wlr_output-&gt;events.destroy, &amp;output-&gt;destroy);&#125; è¿™å°†è°ƒç”¨æˆ‘ä»¬çš„ output_destroy_notify å‡½æ•°æ¥å¤„ç†å½“è¾“å‡ºè¢«æ‹”æ‰æˆ–ä»¥å…¶ä»–æ–¹å¼ä» wlroots ç§»é™¤æ—¶çš„æ¸…ç†å·¥ä½œã€‚æˆ‘ä»¬çš„å¤„ç†ç¨‹åºçœ‹èµ·æ¥åƒè¿™æ ·ï¼š 1234567static void output_destroy_notify(struct wl_listener *listener, void *data) &#123; struct mcw_output *output = wl_container_of(listener, output, destroy); wl_list_remove(&amp;output-&gt;link); wl_list_remove(&amp;output-&gt;destroy.link); wl_list_remove(&amp;output-&gt;frame.link); free(output);&#125; è¿™äº›ä»£ç åº”è¯¥èƒ½å¤Ÿè‡ªè§£é‡Šçš„ã€‚æˆ‘ä»¬ç°åœ¨æœ‰ä¸€ä¸ªå¯¹è¾“å‡ºçš„å¼•ç”¨ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬ä»ç„¶æ²¡æœ‰æ¸²æŸ“ä»»ä½•ä¸œè¥¿â€“å¦‚æœä½ å†æ¬¡è¿è¡Œåˆæˆå™¨ï¼Œä½ ä¼šå‘ç°åŒæ ·çš„è¡Œä¸ºã€‚ ç›‘å¬å¸§çš„æ›´æ–°ä¿¡å· ä¸ºäº†æ¸²æŸ“ä¸œè¥¿ï¼Œæˆ‘ä»¬å¿…é¡»ç›‘å¬å¸§çš„ä¿¡å·ã€‚æ ¹æ®é€‰æ‹©çš„æ¨¡å¼ï¼Œè¾“å‡ºåªèƒ½ä»¥ä¸€å®šçš„é€Ÿç‡æ¥æ”¶æ–°çš„å¸§ã€‚æˆ‘ä»¬åœ¨ wlroots ä¸­ä¸ºä½ è·Ÿè¸ªè¿™ä¸€ç‚¹ï¼Œå¹¶åœ¨ç»˜åˆ¶æ–°å¸§çš„æ—¶å€™å‘å‡ºå¸§ä¿¡å·ã€‚ è®©æˆ‘ä»¬ä¸ºæ­¤ç›®çš„åœ¨ mcw_output ç»“æ„ä¸­æ·»åŠ ä¸€ä¸ªç›‘å¬å™¨ã€‚ 123456789struct mcw_output &#123; struct wlr_output *wlr_output; struct mcw_server *server; struct wl_listener destroy; struct wl_listener frame; struct wl_list link;&#125;; ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥æ‰©å±• new_output_notify æ¥æ³¨å†Œå¸§ä¿¡å·çš„ç›‘å¬å™¨ã€‚ 12345 output-&gt;destroy.notify = output_destroy_notify; wl_signal_add(&amp;wlr_output-&gt;events.destroy, &amp;output-&gt;destroy); output-&gt;frame.notify = output_frame_notify; wl_signal_add(&amp;wlr_output-&gt;events.frame, &amp;output-&gt;frame);&#125; ç°åœ¨ï¼Œæ¯å½“è¾“å‡ºå‡†å¤‡å¥½äº†ä¸€ä¸ªæ–°çš„å¸§ï¼Œoutput_frame_notify å°±ä¼šè¢«è°ƒç”¨ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬ä»ç„¶éœ€è¦ç¼–å†™è¿™ä¸ªå‡½æ•°ã€‚è®©æˆ‘ä»¬ä»æœ€åŸºæœ¬çš„å¼€å§‹ã€‚ 1234static void output_frame_notify(struct wl_listener *listener, void *data) &#123; struct mcw_output *output = wl_container_of(listener, output, frame); struct wlr_output *wlr_output = data;&#125; æ¸²æŸ“ä¸€äº›å†…å®¹ ä¸ºäº†åœ¨è¿™é‡Œæ¸²æŸ“ä»»ä½•ä¸œè¥¿ï¼Œæˆ‘ä»¬éœ€è¦é¦–å…ˆè·å¾—ä¸€ä¸ª wlr_renderer2ã€‚æˆ‘ä»¬å¯ä»¥ä»åç«¯è·å¾—ä¸€ä¸ªã€‚ 12345static void output_frame_notify(struct wl_listener *listener, void *data) &#123; struct mcw_output *output = wl_container_of(listener, output, frame); struct wlr_output *wlr_output = data; struct wlr_renderer *renderer = wlr_backend_get_renderer(wlr_output-&gt;backend);&#125; ç°åœ¨æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¸²æŸ“å™¨ï¼Œåœ¨è¾“å‡ºç«¯ç”»ä¸€äº›ä¸œè¥¿ï¼š 1234567891011121314static void output_frame_notify(struct wl_listener *listener, void *data) &#123; struct mcw_output *output = wl_container_of(listener, output, frame); struct wlr_output *wlr_output = data; struct wlr_renderer *renderer = wlr_backend_get_renderer(wlr_output-&gt;backend); wlr_output_make_current(wlr_output, NULL); wlr_renderer_begin(renderer, wlr_output); float color[4] = &#123;1.0, 0, 0, 1.0&#125;; wlr_renderer_clear(renderer, color); wlr_output_swap_buffers(wlr_output, NULL, NULL); wlr_renderer_end(renderer);&#125; è°ƒç”¨ wlr_output_make_current ä½¿è¾“å‡ºçš„ OpenGL ä¸Šä¸‹æ–‡æˆä¸º â€œå½“å‰â€ï¼Œä»è¿™é‡Œä½ å¯ä»¥ä½¿ç”¨ OpenGL è°ƒç”¨æ¥æ¸²æŸ“åˆ°è¾“å‡ºçš„ç¼“å†²åŒºã€‚æˆ‘ä»¬è°ƒç”¨ wlr_renderer_begin æ¥ä¸ºæˆ‘ä»¬é…ç½®ä¸€äº›åˆç†çš„OpenGLé»˜è®¤å€¼ã€‚ åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹æ¸²æŸ“äº†ã€‚æˆ‘ä»¬å°†åœ¨åé¢è¯¦ç»†ä»‹ç»ä½ èƒ½ç”¨ wlr_renderer åšä»€ä¹ˆï¼Œä½†ç°åœ¨æˆ‘ä»¬å°†æ»¡è¶³äºæŠŠè¾“å‡ºæ¸…é™¤ä¸ºçº¯çº¢è‰²ã€‚ å½“æˆ‘ä»¬å®Œæˆæ¸²æŸ“åï¼Œæˆ‘ä»¬è°ƒç”¨ wlr_output_swap_buffers æ¥äº¤æ¢è¾“å‡ºçš„å‰åç¼“å†²åŒºï¼Œå°†æˆ‘ä»¬æ‰€æ¸²æŸ“çš„å†…å®¹æäº¤åˆ°å®é™…çš„å±å¹•ä¸Šã€‚æˆ‘ä»¬è°ƒç”¨ wlr_renderer_end æ¥æ¸…ç† OpenGL ä¸Šä¸‹æ–‡ï¼Œæˆ‘ä»¬å°±å®Œæˆäº†ã€‚ç°åœ¨è¿è¡Œæˆ‘ä»¬çš„åˆæˆå™¨åº”è¯¥å¯ä»¥çœ‹åˆ°ä¸€ä¸ªçº¯çº¢è‰²çš„å±å¹• æ€»ç»“ ä»Šå¤©çš„æ–‡ç« åˆ°æ­¤ç»“æŸã€‚å¦‚æœä½ çœ‹ä¸€ä¸‹æœ¬æ–‡æ‰€æè¿°çš„æäº¤ï¼Œä½ ä¼šå‘ç°æˆ‘ç”¨ä¸€äº›ä»£ç æ›´è¿›ä¸€æ­¥ï¼Œæ¯ä¸€å¸§éƒ½æŠŠæ˜¾ç¤ºå™¨æ¸…é™¤æˆä¸åŒé¢œè‰²ã€‚è¯·éšæ„å°è¯•ç±»ä¼¼çš„å˜åŒ–å§ åœ¨æ¥ä¸‹æ¥çš„ä¸¤ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†å®Œæˆ Wayland æœåŠ¡å™¨çš„è¿æ¥ï¼Œå¹¶åœ¨å±å¹•ä¸Šå‘ˆç°ä¸€ä¸ª Wayland å®¢æˆ·ç«¯ã€‚è¯·æœŸå¾…å§! æœ¬æ–‡åŠåŸæ–‡ä½¿ç”¨ CC-BY-SA åè®®å¼€æ”¾ã€‚","categories":[{"name":"Translation","slug":"Translation","permalink":"https://blog.inoki.cc/categories/Translation/"},{"name":"Chinese","slug":"Translation/Chinese","permalink":"https://blog.inoki.cc/categories/Translation/Chinese/"},{"name":"Linux","slug":"Linux","permalink":"https://blog.inoki.cc/categories/Linux/"},{"name":"Wayland","slug":"Linux/Wayland","permalink":"https://blog.inoki.cc/categories/Linux/Wayland/"}],"tags":[{"name":"ç¿»è¯‘","slug":"ç¿»è¯‘","permalink":"https://blog.inoki.cc/tags/ç¿»è¯‘/"},{"name":"ä¸­æ–‡","slug":"ä¸­æ–‡","permalink":"https://blog.inoki.cc/tags/ä¸­æ–‡/"}]},{"title":"The right way to store and retrieve SecIdentity/Identity on iOS","slug":"SecIdentity-iOS-storage","date":"2021-09-05T09:42:00.000Z","updated":"2025-03-08T09:40:48.594Z","comments":true,"path":"2021/09/05/SecIdentity-iOS-storage/","link":"","permalink":"https://blog.inoki.cc/2021/09/05/SecIdentity-iOS-storage/","excerpt":"","text":"Apple does have a documentation describing how to store an identity in the keychain. In this doc, it is described as a process much like the storage of certificate in the keychain. The only difference is: Use SecIdentityRef objects instead of SecCertificateRef objects. Use kSecClassIdentity instead of kSecClassCertificate for the kSecClass attribute. So, the code of storing an Identity becomes: 123456789NSDictionary* addquery = @&#123; (id)kSecValueRef: (__bridge id)identity, (id)kSecClass: (id)kSecClassIdentity, (id)kSecAttrLabel: @&quot;Identity&quot;, &#125;;OSStatus status = SecItemAdd((__bridge CFDictionaryRef)addquery, NULL);if (status != errSecSuccess) &#123; // Handle the error&#125; and retrieving as follows: 123456789101112NSDictionary *getquery = @&#123; (id)kSecClass: (id)kSecClassIdentity, (id)kSecAttrLabel: @&quot;Identity&quot;, (id)kSecReturnRef: @YES, &#125;;SecIdentityRef identity = NULL;OSStatus status = SecItemCopyMatching((__bridge CFDictionaryRef)getquery, (CFTypeRef *)&amp;identity);if (status != errSecSuccess) &#123; &lt;# Handle error #&gt; &#125;else &#123; &lt;# Use identity #&gt; &#125;if (identity) &#123; CFRelease(identity); &#125; // After you are done with it Problem However, on the iOS 14.5 emulator, although SecItemAdd returns 0 with no error, there is no identity stored: 1234Identity Test[2377:102582] Internet Password: (null)Identity Test[2377:102582] Cert: (null)Identity Test[2377:102582] Key: (null)Identity Test[2377:102582] Identity: (null) It is very weirdâ€¦ Solution I searched on Internet. This thread helps me a little: I canâ€™t get SecIdentity from Keychain: 1Using labels on an identity is tricky because identities are not stored in the keychain as an atomic item but are store as a separate private key and certificate, and those items use labels in different ways. It inspired me to remove the kSecClass when storing. The code becomes: 12345678NSDictionary* addquery = @&#123; (id)kSecValueRef: (__bridge id)identity, (id)kSecAttrLabel: @&quot;Identity&quot;, &#125;;OSStatus status = SecItemAdd((__bridge CFDictionaryRef)addquery, NULL);if (status != errSecSuccess) &#123; // Handle the error&#125; With these lines of code, when querying, KeyChains gives me: 12345678910111213141516171819202122Identity Test[2555:109912] Internet Password: (null)Identity Test[2555:109912] Cert: ( &#123; ... labl = Identity; ... &#125;)Identity Test[2555:109912] Key: ( &#123; ... labl = Identity; ... &#125;)Identity Test[2555:109912] Identity: ( &#123; ... labl = Identity; ... &#125;) There are a private key, a certificate and an identity with my label. It works now ğŸ˜ƒ When retrieving, we can still keep the kSecClass in the query to filter the identity only. Regarding that these are not mentioned by Apple at all, I hope this workaround can help someone. Unique Identity issue Then, I tried to store a second identity(labelled by Identity1) with the workaround. But it fails with the same observation above. So, I add some code to remove the previous identity before adding new: 12NSDictionary *spec = @&#123;(__bridge id)kSecClass: (id)kSecClassIdentity&#125;;SecItemDelete((__bridge CFDictionaryRef)spec); This will remove the corresponding private key, certificate and the identity itself. And the new identity can be added successfully. Thus, I wonder if the removal of the private key or the certificate will affect the identity? Here are the answers: kSecClass Certificate removed Private key removed Identity removed Identity can be added kSecClassCertificate YES NO YES YES kSecClassKey NO YES YES NO kSecClassIdentity YES YES YES YES We can see that, removing both certificate or identity should work. In my case, I need to store some more certificates other than the one from the identity. So, I should not remove all the certificates. I choose to remove the identity to keep atmost one at the same time. You could also do your own choice. Conclusion This post explores the Identity storage on iOS. Here are my discovery: do not store the identity with kSecClass, the KeyChain service will do this for you; only one identity is OK for an app. Any other questions? Post them in the comments.","categories":[{"name":"iOS","slug":"iOS","permalink":"https://blog.inoki.cc/categories/iOS/"}],"tags":[{"name":"iOS","slug":"iOS","permalink":"https://blog.inoki.cc/tags/iOS/"}]},{"title":"ã€è¯‘ã€‘ Vulkan å…‰çº¿è¿½è¸ª","slug":"Vulkan-Ray-Tracing-Specification","date":"2021-08-02T23:08:10.000Z","updated":"2025-03-08T09:40:48.594Z","comments":true,"path":"2021/08/02/Vulkan-Ray-Tracing-Specification/","link":"","permalink":"https://blog.inoki.cc/2021/08/02/Vulkan-Ray-Tracing-Specification/","excerpt":"","text":"åŸæ–‡é“¾æ¥ï¼šVulkan Ray Tracing Final Specification Release æ€»è§ˆ ä»Šå¤©ï¼ŒKhronosÂ® å‘å¸ƒäº†ä¸€å¥— VulkanÂ®ã€GLSL å’Œ SPIR-V æ‰©å±•è§„èŒƒçš„æœ€ç»ˆç‰ˆæœ¬ï¼Œå°†å…‰çº¿è¿½è¸ªæ— ç¼é›†æˆåˆ°ç°æœ‰çš„Vulkanæ¡†æ¶ä¸­ã€‚è¿™æ˜¯ä¸€ä¸ªé‡è¦çš„é‡Œç¨‹ç¢‘ï¼Œå› ä¸ºå®ƒæ˜¯ä¸šç•Œç¬¬ä¸€ä¸ªå¼€æ”¾çš„ã€è·¨å‚å•†çš„ã€è·¨å¹³å°çš„å…‰çº¿è¿½è¸ªåŠ é€Ÿæ ‡å‡†â€“å¯ä»¥ä½¿ç”¨ç°æœ‰çš„GPUè®¡ç®—æˆ–ä¸“é—¨çš„å…‰çº¿è¿½è¸ªæ ¸å¿ƒæ¥éƒ¨ç½²ã€‚å‡¡æ˜¯ä½¿ç”¨è¿‡ DirectX 12 ä¸­çš„ DirectX å…‰çº¿è¿½è¸ªï¼ˆDXRï¼‰çš„äººéƒ½ä¼šå¯¹ Vulkan å…‰çº¿è¿½è¸ªæ„Ÿåˆ°ç†Ÿæ‚‰ï¼Œä½†å®ƒä¹Ÿå¼•å…¥äº†ä¸€äº›é«˜çº§åŠŸèƒ½ï¼Œæ¯”å¦‚å°†å…‰çº¿è¿½è¸ªè®¾ç½®æ“ä½œè´Ÿè½½å¹³è¡¡åˆ°ä¸»æœº CPU ä¸Šçš„èƒ½åŠ›ã€‚å°½ç®¡å…‰çº¿è¿½è¸ªå°†é¦–å…ˆéƒ¨ç½²åœ¨æ¡Œé¢ç³»ç»Ÿä¸Šï¼Œä½†è¿™äº› Vulkan æ‰©å±•çš„è®¾è®¡æ˜¯ä¸ºäº†ä½¿å…‰çº¿è¿½è¸ªä¹Ÿèƒ½éƒ¨ç½²åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šï¼Œå¹¶æ¿€åŠ±å…‰çº¿è¿½è¸ªçš„ä½¿ç”¨ã€‚ è¿™äº›æ‰©å±•æœ€åˆæ˜¯åœ¨ 2020 å¹´ 3 æœˆä½œä¸ºä¸´æ—¶ç‰ˆæœ¬å‘å¸ƒçš„ã€‚ä»é‚£æ—¶èµ·ï¼ˆè§å›¾ 1ï¼‰ï¼Œæˆ‘ä»¬æ”¶åˆ°å¹¶é‡‡çº³äº†ç¡¬ä»¶ä¾›åº”å•†å’Œè½¯ä»¶å¼€å‘å•†çš„åé¦ˆï¼ŒåŒ…æ‹¬ Khronos å†…éƒ¨å’Œæ›´å¹¿æ³›çš„è¡Œä¸šï¼Œä½† API çš„æ•´ä½“çŠ¶æ€å’Œæä¾›çš„åŠŸèƒ½åŸºæœ¬ä¸Šæ²¡æœ‰å˜åŒ–ã€‚æ„Ÿè°¢æ‰€æœ‰å®¡é˜…å’Œä½¿ç”¨ä¸´æ—¶æ‰©å±•çš„äººï¼Œç‰¹åˆ«æ˜¯é‚£äº›æä¾›åé¦ˆæ„è§çš„äºº! ä»Šå¤©å‘å¸ƒçš„æ‰©å±•è§„èŒƒåªæ˜¯ Vulkan å…‰çº¿è¿½è¸ªæŠ€æœ¯æ¨å¹¿çš„å¼€å§‹ã€‚åœ¨æœªæ¥å‡ å¤©å’Œå‡ å‘¨å†…ï¼Œå…¶ä»–ç”Ÿæ€ç³»ç»Ÿç»„ä»¶ï¼Œå¦‚ç€è‰²å™¨å·¥å…·é“¾å’ŒéªŒè¯å±‚å°†è¢«æ›´æ–°ï¼Œä»¥æ”¯æŒå…‰çº¿è¿½è¸ªåŠŸèƒ½ï¼Œç¡®ä¿å¼€å‘äººå‘˜èƒ½å¤Ÿåœ¨ä»–ä»¬çš„åº”ç”¨ç¨‹åºä¸­è½»æ¾ä½¿ç”¨è¿™äº›æ‰©å±•ã€‚è¿™äº›ç”Ÿæ€ç³»ç»Ÿçš„æ›´æ–°è¿›å±•å¯ä»¥åœ¨ GitHub ä¸Šè·Ÿè¸ªã€‚è¿™å°†åœ¨12æœˆä¸­æ—¬å‘å¸ƒæ”¯æŒ Khronos Vulkan å…‰çº¿è¿½è¸ªçš„ Vulkan SDKï¼ˆ1.2.162.0 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼‰æ—¶è¾¾åˆ°æœ€é«˜æ´»è·ƒåº¦ã€‚ è¿™ç¯‡æ–‡ç« å°†å¼ºè°ƒ Vulkan Ray Tracing æ‰©å±•çš„ä¸´æ—¶ç‰ˆæœ¬å’Œæœ€ç»ˆç‰ˆæœ¬ä¹‹é—´æœ€é‡è¦çš„åŒºåˆ«ï¼Œå¹¶è§£é‡Šè¿™äº›å˜åŒ–èƒŒåçš„ä¸€äº›åŸå› ã€‚ ç§€å‡ºæˆ‘ä»¬çš„è§„èŒƒï¼ è¿™å¥— Vulkan å…‰çº¿è¿½è¸ªæ‰©å±•æ‰€æä¾›çš„æ•´ä½“åŠŸèƒ½è‡ªå…¶ä¸´æ—¶ç‰ˆæœ¬ä»¥æ¥æ²¡æœ‰å˜åŒ–ã€‚ä»Šå¤©å‘å¸ƒçš„æœ€ç»ˆæ‰©å±•é›†æ˜¯ï¼š 12345678910111213Vulkan extension specifications VK_KHR_acceleration_structure VK_KHR_ray_tracing_pipeline VK_KHR_ray_query VK_KHR_pipeline_library VK_KHR_deferred_host_operationsSPIR-V extensions specifications SPV_KHR_ray_tracing SPV_KHR_ray_queryGLSL extensions specifications GLSL_EXT_ray_tracing GLSL_EXT_ray_query GLSL_EXT_ray_flags_primitive_culling æ‹“å±•çš„ç»“æ„ æœ€æ˜æ˜¾çš„å˜åŒ–æ˜¯ï¼Œä¸´æ—¶çš„ VK_KHR_ray_tracing æ‰©å±•å·²ç»è¢«åˆ†æˆäº† 3 ä¸ªæ‰©å±•ï¼š VK_KHR_acceleration_structure - ç”¨äºåŠ é€Ÿç»“æ„çš„æ„å»ºå’Œç®¡ç† VK_KHR_ray_tracing_pipeline - ç”¨äºå…‰çº¿è¿½è¸ªç€è‰²å™¨çš„é˜¶æ®µå’Œæµæ°´çº¿ VK_KHR_ray_query - ä¸ºæ‰€æœ‰ç€è‰²å™¨é˜¶æ®µæä¾›å…‰çº¿æŸ¥è¯¢çš„åŸºæœ¬ æˆ‘ä»¬æ”¶åˆ°çš„åé¦ˆæ˜¯ï¼Œä¸€äº›å¸‚åœºå¸Œæœ›èƒ½å¤Ÿæ”¯æŒå…‰çº¿è¿½è¸ªæŸ¥è¯¢è€Œä¸æ”¯æŒå…‰çº¿è¿½è¸ªæµæ°´çº¿ï¼Œä¸ºäº†é¿å…é‡å¤å’Œäººä¸ºçš„ä¾èµ–ï¼Œæˆ‘ä»¬å¯¹åŸæ¥çš„æ‰©å±•è¿›è¡Œäº†ç»†åˆ†ã€‚å®ç°å¯ä»¥é€‰æ‹©æ”¯æŒ VK_KHR_ray_tracing_pipelineã€VK_KHR_ray_query æˆ–ä¸¤è€…ä¹‹ä¸€ï¼Œå–å†³äºå¸‚åœºéœ€è¦ã€‚è¿™ä¸¤ä¸ªæ‰©å±•éƒ½ä¾èµ–äºVK_KHR_acceleration_structure æ‰©å±•ï¼Œä¸ºåŠ é€Ÿç»“æ„ç®¡ç†æä¾›ä¸€ä¸ªå…±åŒçš„åŸºç¡€ã€‚ä¸»è¦çš„æ¡Œé¢å‚å•†ä»ç„¶è‡´åŠ›äºæ”¯æŒå…‰çº¿æµæ°´çº¿å’Œå…‰çº¿æŸ¥è¯¢ã€‚å…³äºå¯¹å¯é€‰åŠŸèƒ½çš„æ”¯æŒå’Œå¯¹å…¶ä»–å¸‚åœºçš„æ”¯æŒçš„å…·ä½“ç»†èŠ‚ï¼Œè¯·ä¸å„ä¸ªä¾›åº”å•†å•†è°ˆã€‚ Vulkan å…‰çº¿è¿½è¸ªæ‰©å±•ä¸å†è¢«æ ‡è®°ä¸ºä¸´æ—¶æ€§çš„ï¼Œå› æ­¤äº”ä¸ªæ‰©å±•çš„æ‰©å±•æ¥å£ç°åœ¨è¢«å®šä¹‰åœ¨ä¸» vulkan_core.h å¤´ä¸­ï¼Œè€Œä¸æ˜¯ä¸´æ—¶çš„ vulkan_beta.hï¼Œç”¨æˆ·ä¸å†éœ€è¦ #define VK_ENABLE_BETA_EXTENSIONS æ¥å¯ç”¨ Vulkan å…‰çº¿è¿½è¸ªåŠŸèƒ½ã€‚ æ‰©å±•çš„ä¾èµ–æ€§ä¹Ÿæœ‰å˜åŒ–ã€‚ç°åœ¨éœ€è¦ Vulkan 1.1 å’Œ SPIR-V 1.4ã€‚VK_KHR_acceleration_structure éœ€è¦Vulkan 1.1ã€VK_EXT_descriptor_indexingã€VK_KHR_buffer_device_addressï¼Œä»¥åŠVK_KHR_deferred_host_operationsã€‚æˆ‘ä»¬æ„è¯†åˆ°ï¼Œä¸€ä¸ªå†—é•¿çš„æ‰©å±•ä¾èµ–åˆ—è¡¨æ˜¯ä»¤äººè®¨åŒçš„ï¼Œç†æƒ³æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›ç®€å•åœ°è¦æ±‚ Vulkan 1.2ï¼Œä½†ç›®å‰å¹¶éæ‰€æœ‰å¹³å°éƒ½æ”¯æŒ Vulkan 1.2ï¼Œæˆ‘ä»¬ä¸æƒ³ä¸ºé‡‡ç”¨å…‰çº¿è¿½è¸ªåŠŸèƒ½æ·»åŠ ä»»ä½•äººä¸ºéšœç¢ã€‚å¦‚æœæ‰€æœ‰çš„ç›®æ ‡å¸‚åœºéƒ½æ”¯æŒ Vulkan 1.2ï¼Œé‚£ä¹ˆåº”ç”¨ç¨‹åºå°±å¯ä»¥ç›´æ¥ä»¥ Vulkan 1.2 ä¸ºç›®æ ‡ï¼Œä»¥è¾¾åˆ°ç®€åŒ–çš„ç›®çš„ã€‚æˆ‘ä»¬ä¹Ÿè€ƒè™‘è¿‡ä¸æŠŠ VK_KHR_deferred_host_operations ä½œä¸ºä¸€ä¸ªæ˜ç¡®çš„ä¾èµ–å…³ç³»ï¼Œä½†æ˜¯ç”¨å»¶è¿Ÿæ“ä½œåˆ›å»ºæµæ°´çº¿çš„å˜åŒ–è¦æ±‚æˆ‘ä»¬ä¿ç•™å®ƒã€‚æˆ‘ä»¬æŠŠ VK_KHR_pipeline_library ä½œä¸º VK_KHR_ray_tracing_pipeline çš„è½¯è¦æ±‚ï¼Œè€Œä¸æ˜¯ä¸¥æ ¼è¦æ±‚ï¼Œå› æ­¤åº”ç”¨ç¨‹åºåªéœ€è¦åœ¨å®é™…ä½¿ç”¨æ—¶å¯ç”¨å®ƒã€‚é™¤äº† VK_KHR_acceleration_structureï¼ŒVK_KHR_ray_tracing_pipeline å’Œ VK_KHR_ray_query éƒ½è‡³å°‘éœ€è¦ SPIR-V 1.4ï¼Œå› ä¸ºè¯¥ç‰ˆæœ¬ä¸­å¢åŠ äº†å…¥å£ç‚¹è¦æ±‚çš„å˜åŒ–ã€‚SPIR-V 1.5 ä¹Ÿå¯ä»¥ç”¨äº Vulkan 1.2 çš„å®ç°ã€‚ ä»åŠŸèƒ½ä¸Šè®²ï¼Œæ‰€æœ‰çš„å®ç°éƒ½å¿…é¡»å…·å¤‡ä»¥ä¸‹åŠŸèƒ½ï¼š VK_KHR_deferred_host_operations accelerationStructure descriptorBindingAccelerationStructureUpdateAfterBind descriptorIndexing åŠŸèƒ½ï¼ˆå¦‚æœæ”¯æŒ Vulkan 1.2ï¼‰æˆ– VK_EXT_descriptor_indexing æ‰©å±•æ‰€éœ€çš„æ‰€æœ‰åŠŸèƒ½ Vulkan 1.2 ä¸­çš„ bufferDeviceAddress æˆ– VK_KHR_buffer_device_address æ”¯æŒ VK_KHR_ray_tracing_pipeline çš„å®ç°éœ€è¦ï¼š VK_KHR_acceleration_structure rayTracingPipeline rayTracingPipelineTraceRaysIndirect rayTraversalPrimitiveCulling è‹¥ VK_KHR_ray_query ä¹Ÿè¢«æ”¯æŒ VK_KHR_pipeline_library æ”¯æŒ VK_KHR_ray_query çš„å®ç°éœ€è¦ require: VK_KHR_acceleration_structure rayQuery. æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€äº›å¯é€‰æ‹©çš„èƒ½åŠ›ä¸æ‰©å±•å®šä¹‰ã€‚ å¯¹äº VK_KHR_acceleration_structureï¼Œæœ‰ï¼š accelerationStructureCaptureReplay accelerationStructureIndirectBuild accelerationStructureHostCommands å¯¹äº VK_KHR_ray_tracing_pipelineï¼Œæœ‰ï¼š rayTracingPipelineShaderGroupHandleCaptureReplay rayTracingPipelineShaderGroupHandleCaptureReplayMixed rayTraversalPrimitiveCullingï¼Œè‹¥ VK_KHR_ray_query æœªæ”¯æŒ åŠ é€Ÿç»“æ„ åœ¨æœ€ç»ˆçš„ Vulkan å…‰çº¿è¿½è¸ªåŠŸèƒ½ä¸­ï¼Œå¯¹åº”ç”¨ç¨‹åºå½±å“æœ€å¤§çš„å˜åŒ–æ˜¯åŠ é€Ÿç»“æ„çš„åˆ›å»ºå’Œå¸ƒå±€ã€‚ æˆ‘ä»¬ä» API ç¿»è¯‘å±‚ï¼ˆå¦‚ vkd3d-protonï¼‰çš„ä½œè€…é‚£é‡Œå¾—åˆ°åé¦ˆï¼Œåœ¨ä¸´æ—¶ API Vulkan å…‰çº¿è¿½è¸ªåŠ é€Ÿç»“æ„çš„åŸºç¡€ä¸Šåˆ†å±‚ DXR æ˜¯ä¸ç°å®çš„ã€‚è¿™å¯¼è‡´äº†å¯¹åŠ é€Ÿç»“æ„åˆ›å»ºå¤§å°çš„æ”¹å˜ï¼Œå¹¶ä½¿ç”¨ VkBuffer ä¸Šçš„åŠ é€Ÿç»“æ„å­˜å‚¨åˆ†é…ï¼Œè€Œä¸æ˜¯ä¸“é—¨çš„åŠ é€Ÿç»“æ„å¯¹è±¡å­˜å‚¨ã€‚è¿™äº›å˜åŒ–çš„ä¸€ä¸ªå½±å“æ˜¯ï¼ŒVkAccelerationStructureKHR å’Œ VkAccelerationStructureNV ä¸å†æ˜¯åˆ«åï¼Œä¸èƒ½äº’æ¢ä½¿ç”¨ã€‚åŒæ ·åœ°ï¼Œä»»ä½•ä»¥å®ƒä»¬ä¸ºå‚æ•°çš„ç»“æ„æˆ–å‡½æ•°ä¹Ÿä¸å†æ˜¯åˆ«åäº†ã€‚ æˆ‘ä»¬è¿˜ä¸ºåˆ†å±‚æ·»åŠ äº†ä¸€ä¸ªæ–°çš„åŠ é€Ÿç»“æ„ç±»å‹ VK_ACCELERATION_STRUCTURE_TYPE_GENERIC_KHRã€‚ åœ¨å®é™…çš„åŠ é€Ÿç»“æ„ç±»å‹ï¼ˆé¡¶éƒ¨æˆ–åº•éƒ¨ï¼‰è¿˜ä¸æ¸…æ¥šçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥åœ¨åŠ é€Ÿç»“æ„åˆ›å»ºæ—¶ä½¿ç”¨ã€‚å®é™…çš„åŠ é€Ÿç»“æ„ç±»å‹å¿…é¡»æŒ‡å®šä¸º VK_ACCELERATION_STRUCTURE_TYPE_TOP_LEVEL_KHR æˆ– VK_ACCELERATION_STRUCTURE_TYPE_BOTTOM_LEVEL_KHRï¼Œå½“æ‰§è¡Œæ„å»ºæ—¶ä¸èƒ½æ”¹å˜ã€‚ç›´æ¥ä¸º Vulkan ç¼–å†™çš„åº”ç”¨ç¨‹åºä¸åº”è¯¥ä½¿ç”¨ VK_ACCELERATION_STRUCTURE_TYPE_GENERIC_KHRï¼Œå› ä¸ºè¿™å¯èƒ½ä¼šå½±å“æœªæ¥çš„èƒ½åŠ›æˆ–æ€§èƒ½ã€‚ æˆ‘ä»¬è¿˜æ”¶åˆ°äº†åˆ†å±‚ Vulkan å®ç°ï¼ˆå¦‚ MoltenVKï¼‰çš„ä½œè€…çš„åé¦ˆï¼ŒæŒ‡å‡ºä¸€äº›å…‰çº¿è¿½è¸ªçš„è¦æ±‚ï¼ˆå¦‚è®¾å¤‡åœ°å€ï¼‰ä¼šä½¿ Vulkan æ— æ³•åœ¨å…¶ä»–ä¸€äº› API ä¸Šä»¥åˆ†å±‚æ–¹å¼å®ç°ã€‚ä¸å¹¸çš„æ˜¯ï¼Œæˆ‘ä»¬ä¸å¯èƒ½åœ¨è§£å†³è¿™ä¸ªé—®é¢˜çš„åŒæ—¶è¿˜æ”¯æŒå…¶ä»–ç›®æ ‡ï¼Œæ¯”å¦‚ä¸ DXR çš„åŠŸèƒ½å¯¹ç­‰ã€‚æˆ‘ä»¬å¸Œæœ›å…¶ä»– API çš„æœªæ¥ç‰ˆæœ¬ä¹Ÿèƒ½æ·»åŠ å¿…è¦çš„åŠŸèƒ½æ¥å®ç°è¿™ç§åˆ†å±‚ã€‚ æˆ‘ä»¬å¬è¯´å¼€å‘è€…çœŸçš„å¾ˆå–œæ¬¢ç»Ÿä¸€çš„åˆ›å»ºå’Œæ„å»ºå‚æ•°ï¼Œå°±åƒåœ¨ VK_NV_ray_tracing å’Œ DXR ä¸­ã€‚æˆ‘ä»¬å°†åŠ é€Ÿç»“æ„çš„åˆ›å»ºæ”¹ä¸ºåŸºäºå¤§å°ï¼Œå¤§å°å¯ä»¥ä»ç”¨äºæ„å»ºçš„åŒä¸€ç»“æ„ä¸­è®¡ç®—ï¼ˆvkGetAccelerationStructureBuildSizesKHRï¼‰ï¼Œæˆ–è€…ä»ç²¾ç®€æŸ¥è¯¢ä¸­è®¡ç®—ï¼ˆvkCmdWriteAccelerationStructuresPropertiesKHRï¼‰ã€‚æˆ‘ä»¬è¿˜äº†è§£åˆ°ï¼Œä¸€äº›å®ç°åœ¨åˆ›å»ºæ—¶éœ€è¦é¢å¤–çš„ä¿¡æ¯ï¼Œè¿™å¯¼è‡´ vkGetAccelerationStructureBuildSizesKHR ä¸­å¢åŠ äº† pMaxPrimitiveCountsã€‚ ä»¥å‰çš„å‡ ä½•ä½“æè¿°çš„æŸäº›æ–¹é¢å¾ˆæ··ä¹±ï¼Œä¸è‡ªåŠ¨ç”Ÿæˆçš„ä»£ç ä¸èƒ½å¾ˆå¥½åœ°é…åˆï¼ˆå¦‚éªŒè¯å±‚ï¼‰ï¼Œå› æ­¤æˆ‘ä»¬è§£å†³äº† ppGeometries äºŒå…ƒæ€§é€ æˆçš„æ¨¡ç³Šï¼Œå¹¶å¢åŠ äº†ä¸€ä¸ªé¢å¤–çš„ pGeometries å­—æ®µï¼Œä½†è¦æ±‚æ¯æ¬¡åªä½¿ç”¨å…¶ä¸­ä¸€ä¸ªå­—æ®µã€‚ å…¶ä»–æ–°å¢å†…å®¹åŒ…æ‹¬ï¼šåŠ é€Ÿå™¨ç»“æ„çš„åˆ›å»ºæ—¶é—´æ•è·å’Œé‡æ”¾æ ‡å¿—ï¼ˆç”¨äºè°ƒè¯•å·¥å…·ï¼‰ï¼ŒåŠ é€Ÿå™¨ç»“æ„çš„ nullDescriptor æ”¯æŒï¼Œä½œä¸ºä¸ VK_EXT_robustness2 çš„äº¤äº’ï¼Œä»¥åŠåŠ é€Ÿå™¨ç»“æ„çš„ VK_DESCRIPTOR_SET_LAYOUT_CREATE_UPDATE_AFTER_BIND_POOL_BIT æ”¯æŒã€‚ æœ€åä½†å¹¶éæœ€ä¸é‡è¦çš„æ˜¯ï¼Œæˆ‘ä»¬åšäº†ä¿®æ”¹ï¼Œä»¥ä¾¿åœ¨æ‰€æœ‰æ‰©å±•ä¸­ä¸€è‡´åœ°ä½¿ç”¨è®¾å¤‡åœ°å€ã€‚æˆ‘ä»¬è¿˜æå‡ºäº†è®¸å¤šå‘½åå»ºè®®ï¼Œå…¶ä¸­ä¸€äº›è¢«é‡‡çº³äº†ï¼Œå¹¶ä¸”å‡ºäºä¸€è‡´æ€§å’Œå¯æ‰©å±•æ€§çš„è€ƒè™‘ï¼Œæˆ‘ä»¬åšäº†å„ç§å‘½åå’Œé£æ ¼ä¸Šçš„æ”¹å˜ã€‚å…³äºè¿™äº›å’Œå…¶ä»–å˜åŒ–çš„æ›´å¤šç»†èŠ‚ï¼Œè¯·å‚è§é—®é¢˜ 3 å’Œ 4 ä»¥åŠ VK_KHR_acceleration_structure ä¸­çš„å˜åŒ–æ—¥å¿—ã€‚ å»¶è¿Ÿçš„ä¸»æœºæ“ä½œ æˆ‘ä»¬ä¿®æ”¹äº† vkBuildAccelerationStructuresKHR å’Œ vkCreateRayTracingPipelinesKHR å‘½ä»¤ä¸­å»¶è¿Ÿä¸»æœºæ“ä½œçš„ä½¿ç”¨æ–¹å¼ã€‚ç°åœ¨ï¼Œå»¶è¿Ÿæ“ä½œè¯·æ±‚ä¸å†è¢«é“¾å…¥æ¯ä¸ªå•ç‹¬çš„æ„å»ºæˆ–åˆ›å»ºæ“ä½œçš„ pNext ä¸­ï¼Œè€Œæ˜¯ä½œä¸ºå‘½ä»¤çš„é¡¶çº§å‚æ•°ä¼ å…¥ï¼Œæ•´ä¸ªå‘½ä»¤è¦ä¹ˆå»¶è¿Ÿï¼Œè¦ä¹ˆä¸å»¶è¿Ÿã€‚å½“å‘½ä»¤è¢«æ¨è¿Ÿæ—¶ï¼Œåº”ç”¨ç¨‹åºä¸å¾—è®¿é—®è¿”å›å‚æ•°ï¼Œç›´åˆ°æ¨è¿Ÿçš„æ“ä½œå®Œæˆã€‚ä¹‹å‰çš„å‘½ä»¤è¯­ä¹‰ä¸­ï¼Œä¸€äº›å­æ“ä½œå¯ä»¥è¢«å»¶è¿Ÿï¼Œè€Œå¦ä¸€äº›åˆ™ä¸èƒ½ï¼Œè¿™ä½¿å¾—å¯¹å‘½ä»¤è¿”å›å€¼çš„è¡Œä¸ºé¢„æœŸä¸æ˜ç¡®ï¼Œå¾ˆéš¾ç†è§£ä»€ä¹ˆæ—¶å€™è®¿é—®å®ƒä»¬æ˜¯å®‰å…¨çš„ã€‚æˆ‘ä»¬è®¤ä¸ºï¼Œæ–°çš„è¯­ä¹‰æ›´æ¸…æ™°ï¼Œåº”è¯¥èƒ½å¤Ÿæä¾›æ›´å¤šçš„å¹¶è¡Œæœºä¼šï¼Œä½†å¦‚ä¸Šæ‰€è¿°ï¼Œè¿™æ˜¯ä»¥è¦æ±‚ VK_KHR_deferred_host_operations æ‰©å±•åœ¨ä»»ä½•æ—¶å€™éƒ½è¢«å¯ç”¨ä¸ºä»£ä»·ã€‚ å…‰çº¿è¿½è¸ªæµæ°´çº¿ å¯¹å…‰çº¿è¿½è¸ªæµæ°´çº¿æœºåˆ¶çš„æ”¹å˜æ²¡æœ‰é‚£ä¹ˆå‰§çƒˆï¼Œå…¶ä¸­ä¸€äº›åªå½±å“ SPIR-V å’Œç€è‰²å™¨ç¼–è¯‘å™¨å·¥å…·é“¾ã€‚ é™¤äº†ä¸Šé¢æåˆ°çš„é’ˆå¯¹å»¶è¿Ÿæ“ä½œçš„ vkCreateRayTracingPipelinesKHR çš„å˜åŒ–ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›å˜åŒ–ï¼Œä½¿ VkPipelineLibraryCreateInfoKHR å’Œ VkRayTracingPipelineInterfaceCreateInfoKHR æˆä¸ºå¯é€‰é¡¹ï¼Œè¿™æ ·å¦‚æœä¸ä½¿ç”¨ VK_KHR_pipeline_libraryï¼Œå°±ä¸éœ€è¦å¯ç”¨å®ƒä»¬ã€‚ å¯¹äºå…‰çº¿è¿½è¸ªæµæ°´çº¿æ¥è¯´ï¼Œæœ€å¤§çš„ API å˜åŒ–æ˜¯å¢åŠ äº†æ˜ç¡®çš„å †æ ˆå¤§å°ç®¡ç†ã€‚å…‰çº¿è¿½è¸ªæµæ°´çº¿æœ‰ä¸€ä¸ªæ½œåœ¨çš„å¤§å‹ç€è‰²å™¨é›†ï¼Œåœ¨å…‰çº¿è¿½è¸ªè¿‡ç¨‹ä¸­å¯èƒ½ä¼šä»¥å„ç§è°ƒç”¨é“¾ç»„åˆçš„æ–¹å¼è¢«è°ƒç”¨ã€‚åœ¨ç»™å®šçš„ç€è‰²å™¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå®ç°å¯ä»¥ä½¿ç”¨å †æ ˆåœ¨å†…å­˜ä¸­å­˜å‚¨å‚æ•°ï¼Œè¿™ä¸ªå †æ ˆçš„å¤§å°éœ€è¦è¶³å¤Ÿå¤§ï¼Œä»¥å¤„ç†å®ç°å¯ä»¥æ‰§è¡Œçš„ä»»ä½•è°ƒç”¨é“¾ä¸­æ‰€æœ‰ç€è‰²å™¨æ‰€éœ€çš„å †æ ˆå¤§å°ã€‚é»˜è®¤çš„å †æ ˆå¤§å°æœ‰å¯èƒ½ç›¸å½“å¤§ï¼Œæ‰€ä»¥æˆ‘ä»¬å¢åŠ äº†ä¸€ç§æ–¹æ³•ï¼Œè®©åº”ç”¨ç¨‹åºåœ¨æµæ°´çº¿ç¼–è¯‘åæŒ‡å®šä¸€ä¸ªæ›´ç†æƒ³çš„å †æ ˆå¤§å°ã€‚è¿™æ˜¯åœ¨åº”ç”¨ç¨‹åºå¯ä»¥æ ¹æ®å¯¹ç€è‰²å™¨å’Œè°ƒç”¨é“¾å±æ€§çš„ç‰¹å®šåº”ç”¨çŸ¥è¯†è®¡ç®—å‡ºæ›´ä¸¥æ ¼çš„å †æ ˆå¤§å°çº¦æŸçš„æƒ…å†µä¸‹ä½¿ç”¨çš„ã€‚ä¸ºå…‰çº¿è¿½è¸ªæµæ°´çº¿æ·»åŠ äº†ä¸€ä¸ªæ–°çš„åŠ¨æ€çŠ¶æ€ï¼ˆVK_DYNAMIC_STATE_RAY_TRACING_PIPELINE_STACK_SIZE_KHRï¼‰ï¼Œä»¥åŠæŸ¥è¯¢ç€è‰²å™¨ç»„çš„å †æ ˆå¤§å°ï¼ˆvkGetRayTracingShaderGroupStackSizeKHRï¼‰å’Œä¸ºæµæ°´çº¿è®¾ç½®åŠ¨æ€å †æ ˆå¤§å°ï¼ˆvkCmdSetRayTracingPipelineStackSizeKHRï¼‰çš„å‘½ä»¤ã€‚ å¦ä¸€ä¸ªæ–°å¢åŠŸèƒ½æ˜¯åŸºäº DXR åˆ†å±‚å·¥ä½œçš„åé¦ˆï¼Œå³é€šè¿‡åŠ é€Ÿç»“æ„åœ°å€è¿½è¸ªå…‰çº¿çš„èƒ½åŠ›ã€‚æœ‰äº†è¿™ä¸ªåŠŸèƒ½ï¼Œä» vkGetAccelerationStructureDeviceAddressKHR è·å–çš„åŠ é€Ÿç»“æ„çš„è®¾å¤‡åœ°å€å¯ä»¥å­˜å‚¨åœ¨ä¸€ä¸ªç¼“å†²åŒºæˆ–å…¶ä»–ç€è‰²å™¨èµ„æºä¸­ã€‚åœ¨ç€è‰²å™¨ä¸­ï¼Œå¯ä»¥ä½¿ç”¨SPIR-V OpConvertUToAccelerationStructureKHRæŒ‡ä»¤ï¼ˆåœ¨ GLSL ä¸­è¡¨ç°ä¸º accelerationStructureEXT ç±»å‹æ„é€ å™¨ï¼‰å°†å…¶è½¬æ¢ä¸ºä¸é€æ˜çš„ OpTypeAccelerationStructureKHR æè¿°å™¨ç±»å‹ã€‚ç„¶åï¼Œäº§ç”Ÿçš„å˜é‡å¯ä»¥ç”¨æ¥æŒ‡å®šåŠ é€Ÿç»“æ„ï¼Œä»¥ä¾¿åœ¨ OpTraceRayKHR æŒ‡ä»¤ï¼ˆtraceRayEXT()ï¼‰ä¸­è¿›è¡Œè¿½è¸ªã€‚è¿™ç§è½¬æ¢æ˜¯å•å‘çš„ï¼Œåœ¨ä¸é€æ˜çš„åŠ é€Ÿç»“æ„æè¿°ç¬¦ä¸Šä¸æ”¯æŒå…¶ä»–æ“ä½œã€‚ SPIR-V å·¥ä½œç»„ä¹Ÿæä¾›äº†å…³äº SPIR-V æ‰©å±•çš„åé¦ˆï¼Œè¿™å¯¼è‡´äº†å¯¹ OpTraceRayKHR çš„æœ‰æ•ˆè½½è·å‚æ•°å’Œ OpExecuteCallableKHR çš„å¯è°ƒç”¨æ•°æ®å‚æ•°çš„ä¿®æ”¹ã€‚ä»¥å‰ï¼Œè¿™äº›å‚æ•°ä¸ GLSL ä¸­å£°æ˜çš„æœ‰æ•ˆè½½è·æˆ–å¯è°ƒç”¨æ•°æ®ç»“æ„çš„ä½ç½®å¸ƒå±€é™å®šç¬¦åŒ¹é…ã€‚ç„¶è€Œï¼Œè¿™äº›ä½ç½®åœ¨ SPIR-V ä¸­æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œå› æ­¤è¢«æ›¿æ¢ä¸ºç›´æ¥æŒ‡å‘é€‚å½“çš„å­˜å‚¨ç±»çš„æŒ‡é’ˆï¼Œè€Œä¸æ˜¯ä½¿ç”¨æ•´æ•°ä½ç½®ã€‚è¿™å¯¹ GLSL æ‰©å±•æ²¡æœ‰å½±å“ï¼Œå› ä¸º glslang è‡ªåŠ¨å¤„ç†äº†è½¬æ¢ï¼Œç„¶è€Œï¼Œè¿™ç¡®å®éœ€è¦ OpTraceRayKHR å’Œ OpExecuteCallableKHR çš„æ–°æ“ä½œç ï¼Œå®ƒä»¬ä¸èƒ½å†ä¸ SPV_NV_ray_tracing çš„ç›¸åº”æ“ä½œç›¸è”ç³»ã€‚ å¦ä¸€ä¸ªç”±å†…éƒ¨åé¦ˆé©±åŠ¨çš„ SPIR-V å˜åŒ–æ˜¯å°† OpIgnoreIntersectionKHR å’Œ OpTerminateRayKHR å˜æˆç»ˆæ­¢æŒ‡ä»¤ï¼Œå› ä¸ºå®ƒä»¬ç»ˆæ­¢äº†æ‰§è¡Œå®ƒä»¬çš„è°ƒç”¨ã€‚è¿™äº›æŒ‡ä»¤ä¹Ÿå¿…é¡»æ˜¯ä¸€ä¸ªå—ä¸­çš„æœ€åä¸€æ¡æŒ‡ä»¤ã€‚åŒæ ·ï¼Œè¿™ä¹Ÿå¯¼è‡´äº†æ–°çš„æ“ä½œç è¢«åˆ†é…ç»™è¿™äº›æŒ‡ä»¤ã€‚è¿™ä¸€å˜åŒ–ç¡®å®å½±å“äº† GLSLâ€“è¿™äº›æŒ‡ä»¤ä¸å†æ˜¯å†…ç½®å‡½æ•°ï¼Œè€Œæ˜¯è·³è½¬è¯­å¥ï¼Œå› æ­¤åœ¨ç€è‰²å™¨ä¸­ä½¿ç”¨æ—¶ï¼Œä¸å†æ˜¾ç¤ºä¸º ignoreIntersectionEXT()ï¼›è€Œæ˜¯ç®€å•åœ°æ˜¾ç¤ºä¸º ignoreIntersectionEXTï¼›ã€‚ åœ¨æ€»ç»“ SPIR-V å¯¹å…‰çº¿è¿½è¸ªæµæ°´çº¿çš„ä¿®æ”¹æ—¶ï¼Œæœ‰ä¸€ä¸ªæ–°çš„èƒ½åŠ›å’Œæšä¸¾ï¼ˆRayTracingKHRï¼‰ï¼Œä½¿å®ç°å’Œå·¥å…·é“¾èƒ½å¤ŸåŒºåˆ†ä¸ºç°åœ¨å·²ç»è¿‡æ—¶çš„ä¸´æ—¶æ‰©å±•è€Œç¼–å†™çš„ SPIR-V å’Œæœ€ç»ˆè¯­ä¹‰ã€‚æˆ‘ä»¬è¿˜å¯¹ ShaderRecordBufferKHR æ‰€éœ€çš„æ˜ç¡®å¸ƒå±€åšäº†ä¸€äº›æ¾„æ¸…ï¼Œå¹¶å°†å…¶ä¸StorageBufferå­˜å‚¨ç±»çš„å¤„ç†æ–¹å¼ç›¸åŒã€‚æˆ‘ä»¬è¿˜è§„å®šäº† OpReportIntersectionKHR çš„è¿”å›å€¼å’Œè¶…å‡ºèŒƒå›´çš„Tå€¼çš„è¡Œä¸ºï¼Œå¹¶æ¾„æ¸…äº†åªæœ‰ä¸€ä¸ªå­é›†çš„æ¯”ç‰¹ç”¨äºå„ç§å…‰çº¿è¿½è¸ªå‚æ•°ã€‚ ä¸ VK_KHR_acceleration_structure æ‰©å±•ä¸€æ ·ï¼Œæˆ‘ä»¬åšäº†ä¿®æ”¹ï¼Œä»¥å®Œå…¨ä½¿ç”¨ç¼“å†²è®¾å¤‡åœ°å€ï¼Œå› æ­¤ç€è‰²å™¨ç»‘å®šè¡¨ç°åœ¨è¢«ä½œä¸ºç¼“å†²è®¾å¤‡åœ°å€é€šè¿‡ VkStridedDeviceAddressRegionKHR ç»“æ„æä¾›ç»™è¿½è¸ªå…‰çº¿å‘½ä»¤ã€‚åŒæ ·åœ°ï¼ŒvkCmdTraceRaysIndirectKHR çš„é—´æ¥å‚æ•°ä¹Ÿé€šè¿‡ç¼“å†²è®¾å¤‡åœ°å€ä¼ é€’ã€‚ æˆ‘ä»¬è¿˜æ›´æ–°äº†ä¸ Vulkan 1.2 å’Œ VK_KHR_vulkan_memory_model æ‰©å±•çš„äº¤äº’ï¼Œå¹¶è¦æ±‚æŸäº›å†…ç½®å˜é‡ï¼ˆä¸»è¦æ˜¯ä¸å­ç»„ç›¸å…³çš„ï¼‰åœ¨æ”¯æŒç€è‰²å™¨è°ƒç”¨çš„ç€è‰²å™¨ä¸­è¢«æ ‡è®°ä¸º Volatileã€‚ å…¶ä»–å˜åŒ–åŒ…æ‹¬ä¸ºç€è‰²å™¨ç»„å¥æŸ„æ·»åŠ åˆ›å»ºæ—¶é—´æ•è·å’Œé‡æ”¾æ ‡å¿—ï¼Œæ·»åŠ ä»¥å‰é—æ¼çš„å„ç§å±æ€§å’Œé™åˆ¶ï¼Œä»¥åŠä¸€äº›é‡å‘½åä»¥æé«˜æ¸…æ™°åº¦ã€‚å…³äºè¿™äº›å’Œå…¶ä»–å˜åŒ–çš„æ›´å¤šç»†èŠ‚ï¼Œè¯·å‚è§ VK_KHR_ray_tracing_pipeline ä¸­çš„é—®é¢˜ 3 å’Œ 4ï¼ŒSPV_KHR_ray_tracing ä¸­çš„é—®é¢˜ 2ï¼Œä»¥åŠæ‰©å±•å˜åŒ–æ—¥å¿—ã€‚ å…‰çº¿æŸ¥è¯¢ é‰´äº Vulkan çš„ API ä¸­å¾ˆå°‘æœ‰å…‰çº¿æŸ¥è¯¢ï¼Œå¤§éƒ¨åˆ†ä¸å…‰çº¿æŸ¥è¯¢æœ‰å…³çš„å˜åŒ–éƒ½åœ¨ SPIR-V çš„æ‰©å±•å’Œäº¤äº’ä¸­ã€‚ SPV_KHR_ray_query è¿˜åŒ…æ‹¬æ”¯æŒé€šè¿‡åŠ é€Ÿç»“æ„åœ°å€å‘å‡ºå…‰çº¿æŸ¥è¯¢ï¼Œå¹¶å¢åŠ äº†OpConvertUToAccelerationStructureKHRï¼ŒåŒæ ·å¯ä»¥ç”¨æ¥å°†åŠ é€Ÿç»“æ„è®¾å¤‡åœ°å€è½¬æ¢æˆä¸é€æ˜çš„OpTypeAccelerationStructureKHR æè¿°ç¬¦ã€‚ç„¶åï¼Œè¿™äº›æè¿°ç¬¦å¯ä»¥ç”¨æ¥ä¸º OpRayQueryInitializeKHR æŒ‡å®šè¦è¿½è¸ªçš„åŠ é€Ÿç»“æ„ã€‚ ä¸å…‰çº¿æµæ°´çº¿ä¸€æ ·ï¼Œå­˜åœ¨ä¸€ä¸ªæ–°çš„èƒ½åŠ›å’Œæšä¸¾ï¼ˆRayQueryKHRï¼‰ï¼Œä½¿å®ç°å’Œå·¥å…·é“¾èƒ½å¤ŸåŒºåˆ†ä¸ºç°åœ¨å·²ç»è¿‡æ—¶çš„ä¸´æ—¶æ‰©å±•è€Œç¼–å†™çš„ SPIR-V å’Œæœ€ç»ˆè¯­ä¹‰ã€‚æˆ‘ä»¬è¿˜æ¾„æ¸…äº†åªæœ‰ä¸€ä¸ªå­é›†çš„ä½ç”¨äºå‰”é™¤æ©ç ï¼Œå¹¶ä¸”ä¸å…è®¸ä» AABB åŸºå…ƒä¸­æŸ¥è¯¢å€™é€‰ T å€¼ã€‚ æœ€åï¼Œæˆ‘ä»¬è¿˜è§„å®šäº†å…‰çº¿å‚æ•°çš„æ•°å€¼é™åˆ¶ï¼Œè¦æ±‚ HitT åœ¨ OpRayQueryGenerateIntersectionKHR çš„å…‰çº¿åŒºé—´å†…ï¼Œå¹¶å°†è¿½è¸ªé™åˆ¶åœ¨é¡¶å±‚åŠ é€Ÿç»“æ„ä¸Šã€‚ å…³äºè¿™äº›å’Œå…¶ä»–å˜åŒ–çš„æ›´å¤šç»†èŠ‚ï¼Œè¯·å‚è§ VK_KHR_ray_query çš„ç¬¬1æœŸï¼ŒSPV_KHR_ray_query çš„ç¬¬1æœŸï¼Œä»¥åŠæ‰©å±•çš„å˜åŒ–æ—¥å¿—ã€‚ è·¯åœ¨è„šä¸‹ This section gives an overview of the new flow for acceleration structure creation and includes a quick primer on resource creation flags and ray tracing synchronization. åŠ é€Ÿç»“æ„çš„åˆ›å»º ä¸ºäº†åˆ›å»ºä¸€ä¸ªåŠ é€Ÿç»“æ„ï¼Œåº”ç”¨ç¨‹åºå¿…é¡»é¦–å…ˆç¡®å®šåŠ é€Ÿç»“æ„æ‰€éœ€çš„å°ºå¯¸ã€‚å¯¹äºæ„å»ºæ¥è¯´ï¼ŒåŠ é€Ÿç»“æ„çš„å¤§å°ä»¥åŠæ„å»ºå’Œæ›´æ–°çš„ç¼“å†²åŒºå¤§å°æ˜¯é€šè¿‡ vkGetAccelerationStructureBuildSizesInfoKHR ç»“æ„ä¸­çš„ vkGetAccelerationStructureBuildSizesKHR å‘½ä»¤è·å¾—ã€‚è¦åˆ›å»ºçš„åŠ é€Ÿç»“æ„çš„å½¢çŠ¶å’Œç±»å‹åœ¨ VkAccelerationStructureBuildGeometryInfoKHR ç»“æ„ä¸­æè¿°ã€‚è¿™å’Œä»¥åç”¨äºå®é™…æ„å»ºçš„ç»“æ„æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯åŠ é€Ÿç»“æ„å‚æ•°å’Œå‡ ä½•ä½“æ•°æ®æŒ‡é’ˆä¸éœ€è¦åœ¨è¿™æ—¶å®Œå…¨å¡«å……ï¼ˆå°½ç®¡å®ƒä»¬å¯ä»¥å¡«å……ï¼‰ï¼Œåªæ˜¯åŠ é€Ÿç»“æ„ç±»å‹ï¼Œä»¥åŠå‡ ä½•ä½“ç±»å‹ã€è®¡æ•°å’Œæœ€å¤§å°ºå¯¸ã€‚è¿™äº›å°ºå¯¸å¯¹ä»»ä½•è¶³å¤Ÿç›¸ä¼¼çš„åŠ é€Ÿç»“æ„éƒ½æ˜¯æœ‰æ•ˆçš„ã€‚å¯¹äºå°†æˆä¸ºå‹ç¼©æ‹·è´ç›®æ ‡çš„åŠ é€Ÿç»“æ„ï¼Œæ‰€éœ€çš„å°ºå¯¸å¯ä»¥é€šè¿‡ vkCmdWriteAccelerationStructuresPropertiesKHR å‘½ä»¤è·å¾—ã€‚ä¸€æ—¦ç¡®å®šäº†æ‰€éœ€çš„å¤§å°ï¼Œåº”ç”¨ç¨‹åºå°±ä¼šä¸ºåŠ é€Ÿç»“æ„åˆ›å»ºä¸€ä¸ª VkBufferï¼ˆaccelerationStructureSizeï¼‰ï¼Œå¹¶æ ¹æ®éœ€è¦ä¸ºæ„å»ºï¼ˆbuildScratchSizeï¼‰å’Œæ›´æ–°ï¼ˆupdateScratchSizeï¼‰ç¼“å†²åŒºåˆ›å»º VkBufferã€‚ æ¥ä¸‹æ¥ï¼Œå¯ä»¥ä½¿ç”¨ vkCreateAccelerationStructureKHR å‘½ä»¤åˆ›å»º VkAccelerationStructureKHR å¯¹è±¡ï¼Œè¯¥å‘½ä»¤åˆ›å»ºä¸€ä¸ªæŒ‡å®šç±»å‹å’Œå¤§å°çš„åŠ é€Ÿç»“æ„ï¼Œå¹¶å°†å…¶æ”¾ç½®åœ¨ VkAccelerationStructureCreateInfoKHR ä¸­æä¾›çš„ç¼“å†²åŒºçš„åç§»å¤„ã€‚ä¸ Vulkan ä¸­çš„å¤§å¤šæ•°å…¶ä»–èµ„æºä¸åŒï¼Œç¼“å†²åŒºçš„æŒ‡å®šéƒ¨åˆ†å®Œå…¨ä¸ºåŠ é€Ÿç»“æ„æä¾›äº†å†…å­˜ï¼›ä¸éœ€è¦æŸ¥è¯¢é¢å¤–çš„å†…å­˜éœ€æ±‚æˆ–å°†å†…å­˜ç»‘å®šåˆ°åŠ é€Ÿç»“æ„å¯¹è±¡ä¸Šã€‚å¦‚æœéœ€è¦ï¼Œå¯ä»¥åœ¨åŒä¸€ä¸ª VkBuffer ä¸­æ”¾ç½®å¤šä¸ªåŠ é€Ÿç»“æ„ï¼Œåªè¦åŠ é€Ÿç»“æ„ä¸é‡å ã€‚ æœ€åï¼Œå¯ä»¥ä½¿ç”¨ vkCmdBuildAccelerationStructuresKHR å‘½ä»¤æ¥æ„å»ºåŠ é€Ÿç»“æ„ã€‚æ„å»ºæ—¶ä½¿ç”¨ä¸ç¡®å®šåŠ é€Ÿç»“æ„å¤§å°ç›¸åŒçš„ VkAccelerationStructureBuildGeometryInfoKHR ç»“æ„ï¼Œä½†è¿™æ¬¡å¿…é¡»æŒ‡å®šç›®æ ‡åŠ é€Ÿç»“æ„ä»¥åŠæ‰€æœ‰å‡ ä½•æ•°æ®æŒ‡é’ˆï¼ˆç”¨äºé¡¶ç‚¹ã€ç´¢å¼•ã€å˜æ¢ã€aabbså’Œå®ä¾‹ï¼‰å’ŒæŠ“å–æ•°æ®æŒ‡é’ˆã€‚ä¸€æ—¦æ„å»ºå®Œæˆï¼ŒåŠ é€Ÿç»“æ„æ˜¯å®Œå…¨ç‹¬ç«‹çš„ï¼Œæ„å»ºè¾“å…¥å’Œä»å¤´å¼€å§‹çš„ç¼“å†²åŒºå¯ä»¥è¢«åº”ç”¨ç¨‹åºé‡æ–°åˆ©ç”¨ï¼Œé™¤éå®ƒè®¡åˆ’å°†å®ƒä»¬ç”¨äºæœªæ¥çš„æ›´æ–°æ„å»ºã€‚ èµ„æºä½¿ç”¨ä¸åŒæ­¥ æœ¬èŠ‚æä¾›äº†å…³äºä½•æ—¶åº”ä½¿ç”¨å„ç§ç¼“å†²åŒºä½¿ç”¨æ ‡å¿—çš„é«˜å±‚æ¬¡æ¦‚è¿°ï¼Œä»¥åŠå¯¹å„ç§å…‰çº¿è¿½è¸ªæ“ä½œåº”ä½¿ç”¨ä½•ç§ç±»å‹çš„åŒæ­¥çš„ç®€è¦æè¿°ã€‚ å°†ç”¨äºåŠ é€Ÿç»“æ„å¤‡ä»½çš„ç¼“å†²åŒºæ˜¯ç”¨ VK_BUFFER_USAGE_ACCELERATION_STRUCTURE_STORAGE_BIT_KHR ç”¨æ³•åˆ›å»ºçš„ï¼Œå°†ç”¨äºæ„å»ºä»å¤´ç©ºé—´çš„ç¼“å†²åŒºéœ€è¦æŒ‡å®š VK_BUFFER_USAGE_STORAGE_BUFFER_BIT ç”¨æ³•ã€‚å’ŒåŠ é€Ÿç»“æ„çš„æ„å»ºè¾“å…¥ï¼Œå¦‚é¡¶ç‚¹ã€ç´¢å¼•ã€å˜æ¢ã€aabbå’Œå®ä¾‹æ•°æ®ï¼Œéœ€è¦æŒ‡å®š VK_BUFFER_USAGE_ACCELERATION_STRUCTURE_BUILD_INPUT_READ_ONLY_BIT_KHR ç”¨æ³•ã€‚ç”¨äºç€è‰²å™¨ç»‘å®šè¡¨çš„ç¼“å†²åŒºä»¥ VK_BUFFER_USAGE_SHADER_BINDING_TABLE_BIT_KHR ç”¨æ³•åˆ›å»ºï¼Œç”¨äºé—´æ¥æ„å»ºå’Œè·Ÿè¸ªå‚æ•°çš„ç¼“å†²åŒºä»¥ VK_BUFFER_USAGE_INDIRECT_BUFFER_BIT ç”¨æ³•åˆ›å»ºã€‚ ä¸ºäº†ä¸åŠ é€Ÿç»“æ„æ„å»ºå‘½ä»¤ï¼ˆvkCmdBuildAccelerationStructuresKHR vkCmdBuildAccelerationStructuresIndirectKHRï¼‰åŒæ­¥ä¾èµ–ï¼Œä½¿ç”¨ VK_PIPELINE_STAGE_ACCELERATION_STRUCTURE_BUILD_BIT_KHRpipeline é˜¶æ®µã€‚å¯¹æºåŠ é€Ÿç»“æ„æˆ–ç›®æ ‡åŠ é€Ÿç»“æ„çš„è®¿é—®ï¼Œä»¥åŠå¯¹å–å›ç¼“å†²åŒºçš„è®¿é—®ï¼Œä½¿ç”¨ VK_ACCESS_ACCELERATION_STRUCTURE_READ_BIT_KHR æˆ– VK_ACCESS_ACCELERATION_STRUCTURE_WRITE_BIT_KHR çš„è®¿é—®ç±»å‹ã€‚å¯¹æ„å»ºçš„è¾“å…¥ç¼“å†²åŒºï¼ˆé¡¶ç‚¹ã€ç´¢å¼•ã€å˜æ¢ã€aabbæˆ–å®ä¾‹æ•°æ®ï¼‰çš„è®¿é—®ä½¿ç”¨ VK_ACCESS_SHADER_READ_BIT çš„è®¿é—®ç±»å‹ï¼Œå¯¹é—´æ¥å‚æ•°çš„è®¿é—®ä½¿ç”¨ VK_ACCESS_INDIRECT_COMMAND_READ_BIT çš„è®¿é—®ç±»å‹ã€‚ å½“ä¸åŠ é€Ÿç»“æ„å¤åˆ¶å‘½ä»¤ï¼ˆvkCmdWriteAccelerationStructuresPropertiesKHRã€vkCmdCopyAccelerationStructureKHRã€vkCmdCopyAccelerationStructureToMemoryKHR å’Œ vkCmdCopyMemoryToAccelerationStructureKHRï¼‰åŒæ­¥ä¾èµ–æ—¶ï¼Œä¹Ÿä½¿ç”¨ VK_PIPELINE_STAGE_ACCELERATION_STRUCTURE_BUILD_BIT_KHR æµæ°´çº¿é˜¶æ®µã€‚è¯»å–æˆ–å†™å…¥åŠ é€Ÿç»“æ„çš„è®¿é—®åˆ†åˆ«ä½¿ç”¨ VK_ACCESS_ACCELERATION_STRUCTURE_READ_BIT_KHR æˆ–è€… VK_ACCESS_ACCELERATION_STRUCTURE_WRITE_BIT_KHRã€‚é€šè¿‡è®¾å¤‡åœ°å€è®¿é—®ç¼“å†²åŒºè¿›è¡Œè¯»å–æˆ–å†™å…¥ï¼Œåˆ†åˆ«ä½¿ç”¨ VK_ACCESS_TRANSFER_READ_BIT æˆ– VK_ACCESS_TRANSFER_WRITE_BIT çš„è®¿é—®ç±»å‹ã€‚ ä¸ºäº†ä¸å…‰çº¿è¿½è¸ªå‘½ä»¤ï¼ˆvkCmdTraceRaysKHR å’Œ vkCmdTraceRaysIndirectKHRï¼‰åŒæ­¥ä¾èµ–ï¼Œ VK_PIPELINE_STAGE_RAY_TRACING_SHADER_BIT_KHR æµæ°´çº¿é˜¶æ®µè¢«ç”¨äºè®¿é—®ç€è‰²å™¨ç»‘å®šè¡¨ç¼“å†²åŒºï¼Œè®¿é—®ç±»å‹ä¸º VK_ACCESS_SHADER_READ_BITã€‚å¯¹äºé—´æ¥å‚æ•°çš„è®¿é—®ï¼Œä½¿ç”¨ VK_PIPELINE_STAGE_DRAW_INDIRECT_BIT æµæ°´çº¿é˜¶æ®µï¼Œè®¿é—®ç±»å‹ä¸º VK_ACCESS_INDIRECT_COMMAND_READ_BITã€‚ ä¸ºäº†ä¸ä»»ä½•å›¾å½¢ã€è®¡ç®—æˆ–å…‰çº¿è¿½è¸ªæµæ°´çº¿é˜¶æ®µä¸­ç”¨äºå…‰çº¿æŸ¥è¯¢æŒ‡ä»¤çš„åŠ é€Ÿç»“æ„åŒæ­¥ä¾èµ–å…³ç³»ï¼Œé€‚å½“çš„æµæ°´çº¿é˜¶æ®µä¸ VK_ACCESS_ACCELERATION_STRUCTURE_READ_BIT_KHR è®¿é—®ç±»å‹åº”å½“ä¸€èµ·ä½¿ç”¨ã€‚ ç»“è®ºä¸èµ„æº ç°åœ¨ï¼Œæœ€ç»ˆçš„ Vulkan å…‰çº¿è¿½è¸ªæ‰©å±•å·²ç»å‘å¸ƒï¼Œç›®å‰æ”¯æŒä¸´æ—¶è§„èŒƒçš„ç”Ÿæ€ç³»ç»Ÿå·¥ä»¶å°†å°½å¿«æ›´æ–°ï¼Œå·¥å…·å’Œå…¶ä»–ç»„ä»¶çš„æ¨å‡ºå°†åœ¨ GitHub ä¸Šè¿›è¡Œè·Ÿè¸ªã€‚æˆ‘ä»¬é¼“åŠ±æ‰€æœ‰å¼€å‘è€…è¿‡æ¸¡åˆ°ä½¿ç”¨æœ€ç»ˆçš„ Khronos Vulkan å…‰çº¿è¿½è¸ªæ‰©å±•ã€‚ åŒ…æ‹¬ç”¨äº NVIDIA GPU çš„æœ€ç»ˆ Vulkan å…‰çº¿è¿½è¸ªæ‰©å±•çš„é©±åŠ¨ç¨‹åºå¯ä»¥åœ¨ developer.nvidia.com/vulkan-driver ä¸Šæ‰¾åˆ°ï¼ŒåŒæ—¶è¿˜æœ‰å…³äºå“ªäº›GPUå—åˆ°æ”¯æŒçš„ä¿¡æ¯ã€‚æ”¯æŒè¿™äº›æ‰©å±•çš„ AMD GPU çš„åˆå§‹é©±åŠ¨ç¨‹åºå¯ä»¥åœ¨https://www.amd.com/en/support/kb/release-notes/rn-rad-win-20-11-2-vrt-betaã€‚è‹±ç‰¹å°” Xe-HPG GPU å°†æ”¯æŒå…‰çº¿è¿½è¸ªæ‰©å±•ï¼Œäº2021å¹´æ¨å‡ºï¼Œå¹¶é€šè¿‡å¸¸è§„é©±åŠ¨æ›´æ–°ç¨‹åºæä¾›é©±åŠ¨æ”¯æŒã€‚ å…³äºå¦‚ä½•å°† Vulkan å…‰çº¿è¿½è¸ªç”¨äºæ··åˆæ¸²æŸ“çš„è§è§£ï¼Œå…¶ä¸­å…‰æ …åŒ–å’Œå…‰çº¿è¿½è¸ªè¢«ä¸²è”ä½¿ç”¨ï¼Œä»¥å®ç°å¼•äººæ³¨ç›®çš„è§†è§‰ä¿çœŸåº¦å’Œäº’åŠ¨æ€§ï¼Œè¯·æŸ¥çœ‹ Vulkan å…‰çº¿è¿½è¸ªæ··åˆæ¸²æŸ“çš„æœ€ä½³å®è·µåšå®¢ï¼Œå…¶ä¸­è®¨è®ºäº†å…‰çº¿è¿½è¸ªåå°„åœ¨ã€Šé‡è¿”å¾·å†›æ€»éƒ¨ï¼šæ–°è¡€ç¼˜ã€‹ä¸­ä½¿ç”¨æœ€ç»ˆæ‰©å±•æè¿°çš„å…‰çº¿è¿½è¸ªåå°„çš„å®ç°ã€‚ã€‚ ä»Šå¤©è¿˜å‘å¸ƒäº†æœ€æ–°çš„ NVIDIA Vulkan å…‰çº¿è¿½è¸ªæ•™ç¨‹ï¼Œä»¥åŠæ”¯æŒ Vulkan å…‰çº¿è¿½è¸ªæ‰©å±•çš„ NVIDIA Nsight å›¾å½¢å¼€å‘å·¥å…·çš„ 2020.6 ç‰ˆæœ¬ã€‚æ•¬è¯·å…³æ³¨æ›´å¤šå³å°†å‘å¸ƒçš„å…³äºç”Ÿäº§é©±åŠ¨ã€å·¥å…·å’Œç¤ºä¾‹çš„å…¬å‘Šã€‚ Vulkan å·¥ä½œç»„å¾ˆé«˜å…´èƒ½å¤Ÿè®©å¼€å‘è€…å’Œå†…å®¹åˆ›ä½œç¤¾åŒºä½¿ç”¨ Vulkan å…‰çº¿è¿½è¸ªï¼Œæˆ‘ä»¬æ¬¢è¿ä»»ä½•åé¦ˆæˆ–é—®é¢˜ã€‚è¿™äº›é—®é¢˜å¯ä»¥é€šè¿‡ Khronos å¼€å‘è€… Slack å’Œ Vulkan GitHub é—®é¢˜è¿½è¸ªå™¨è¿›è¡Œåˆ†äº«ã€‚ æ¬¢è¿æ¥åˆ°ä¾¿æºå¼ã€è·¨å‚å•†ã€è·¨å¹³å°çš„å…‰çº¿è¿½è¸ªåŠ é€Ÿæ—¶ä»£ï¼","categories":[{"name":"Translation","slug":"Translation","permalink":"https://blog.inoki.cc/categories/Translation/"},{"name":"Chinese","slug":"Translation/Chinese","permalink":"https://blog.inoki.cc/categories/Translation/Chinese/"},{"name":"Computer Graphics","slug":"Computer-Graphics","permalink":"https://blog.inoki.cc/categories/Computer-Graphics/"},{"name":"Vulkan","slug":"Computer-Graphics/Vulkan","permalink":"https://blog.inoki.cc/categories/Computer-Graphics/Vulkan/"}],"tags":[{"name":"ç¿»è¯‘","slug":"ç¿»è¯‘","permalink":"https://blog.inoki.cc/tags/ç¿»è¯‘/"},{"name":"ä¸­æ–‡","slug":"ä¸­æ–‡","permalink":"https://blog.inoki.cc/tags/ä¸­æ–‡/"},{"name":"Computer Graphics","slug":"Computer-Graphics","permalink":"https://blog.inoki.cc/tags/Computer-Graphics/"},{"name":"Vulkan","slug":"Vulkan","permalink":"https://blog.inoki.cc/tags/Vulkan/"},{"name":"Ray Tracing","slug":"Ray-Tracing","permalink":"https://blog.inoki.cc/tags/Ray-Tracing/"}]},{"title":"Write your own IME on macOS - 1. Create project","slug":"Write-your-own-IME-on-macOS-1","date":"2021-06-19T19:15:00.000Z","updated":"2025-03-08T09:40:48.603Z","comments":true,"path":"2021/06/19/Write-your-own-IME-on-macOS-1/","link":"","permalink":"https://blog.inoki.cc/2021/06/19/Write-your-own-IME-on-macOS-1/","excerpt":"","text":"On macOS, it is not so difficult to write an Input Method Engine (IME). Unlike Linux or the other Unix-like OS, macOS provides an official framework, InputMethodKit, to help you write an Input Method Engine. An IME project is in fact a normal Cocoa app located in a special directory, with a special bundle identifier, some special declarations in plist manifest file, and some special classes/objects in the project. This post may help you initiate your own IME project. Letâ€™s go! Create the project First, open XCode, create a new App project: Then, type your IME name. Here I choose the typical name â€œHelloWorldâ€. Notice that there must be an inputmethod identifier in the bundle identifier. I choose to append a suffix to my organization identifier. However, you should also be able to do it in another way. Add some magic In this section, Iâ€™ll add some magic to to turn the app into an IME. Plist magic In the manifest file Info.plist, there are magic to declare some information of your IME: Key Type InputMethodConnectionName String InputMethodServerControllerClass String tsInputMethodCharacterRepertoireKey Array The InputMethodConnectionName will be the name of your IME, recognized by macOS. The InputMethodServerControllerClass is the name of the Input Method controller class in your IME, which is in charge of communicating with macOS, exchanging the input events and submitting the candidate selected by the user. The tsInputMethodCharacterRepertoireKey can help you declare the category of your IME. It will depend where your IME will show up in the Input Source panel of the macOS system preference. As an array, there can be multiple items. Thus, an IME for several languages is possible. For example, Squirrel has a zh-Hans string in the array, so it shows up in the Chinese, Simplified language as follow: If all is set, we can have an Info.plist like this: I choose InokiHelloWorldIME as the connection name. There will be an Input Method controller class named InokiHelloWorldController in my project, in charge of events. And I added zh-Hans, zh-Hant and Latn for the category. Class magic We need to create our Input Method controller class, inheriting IMKInputController class from Input Method Kit. Add these codes to the implementation(.m) file, so that we can observe what happens when we are â€œusingâ€(not actually) the IME: 123456789- (void)activateServer:(id)sender&#123; NSLog(@\"Server activated for %@\", [sender bundleIdentifier]);&#125;- (void)deactivateServer:(id)sender&#123; NSLog(@\"Server deactivated for %@\", [sender bundleIdentifier]);&#125; This method is using one of the controller API to receive input event from macOS: 12345- (BOOL)inputText:(NSString*)string client:(id)sender&#123; NSLog(@\"Controller received: %@\", string); return NO;&#125; There are in fact 3 different APIs to handle the input event, such as: 123- (BOOL)inputText:(NSString*)string key:(NSInteger)keyCode modifiers:(NSUInteger)flags client:(id)sender;- (BOOL)inputText:(NSString*)string client:(id)sender;- (BOOL)handleEvent:(NSEvent*)event client:(id)sender; For more details, you can take a look at the declaration of IMKInputController in InputMethodKit/IMKInputController.h. With all these done, macOS should be able to find your Input Controller, thanks to the runtime information in Objective-C. Main Code magic Finally, we need a minimum main function like this. 123456789101112131415#import &lt;Cocoa/Cocoa.h&gt;#import &lt;InputMethodKit/InputMethodKit.h&gt;NSString* connectionName = @\"InokiHelloWorldIME\";IMKServer* server;int main(int argc, char * argv[]) &#123; @autoreleasepool&#123; server = [[IMKServer alloc] initWithName:(NSString*)connectionName bundleIdentifier:[[NSBundle mainBundle] bundleIdentifier]]; [[NSApplication sharedApplication] run]; &#125; return 0;&#125; In which we create an instance of IMKServer and make it alive during all the life cycle of our app. The server is also registered to macOS, so that the OS knows which process it should communicate. Run it Finally, we can build it and copy it into /Library/Input Methods. For debug or running, this post (in Chinese) is a good example. Here, I concentrate more on the potential and undocumented bug (ok, it might be a feature) as follows. Oups, you may be isolated in a sandbox You may suffer an error like: 1[IMKServer _createConnection]: *Failed* to register NSConnection name=xxxxx Same to me. I took several hours to dive into macOS and debug such error. I found that the reason: IMKServer needs an NSConnection to communicate with macOS. However, by default, the app is sandboxized (by the &lt;project-name.entitlements&gt;) since a version of XCode. So, the solutions are various: Remove the entitlements file; Allow NSConnection from sandbox; Disable the App sandbox in the entitlements file. Then, your IME should be good to go. Conclusion In this post, there is a brief description for creating an IME project. I show an issue that may generally exist related to the sandbox stuff. Hope this can help you. In the next post, Iâ€™ll try to show up the event handle in an IME on macOS.","categories":[{"name":"IME","slug":"IME","permalink":"https://blog.inoki.cc/categories/IME/"}],"tags":[{"name":"macOS","slug":"macOS","permalink":"https://blog.inoki.cc/tags/macOS/"},{"name":"IME","slug":"IME","permalink":"https://blog.inoki.cc/tags/IME/"}]},{"title":"KDE Connect iOS Develop Dairy(3) Certificate","slug":"KDEConnect-iOS-dev-dairy-3","date":"2021-02-07T14:34:50.000Z","updated":"2025-03-08T09:40:48.578Z","comments":true,"path":"2021/02/07/KDEConnect-iOS-dev-dairy-3/","link":"","permalink":"https://blog.inoki.cc/2021/02/07/KDEConnect-iOS-dev-dairy-3/","excerpt":"","text":"As mentioned at the end of my previous post KDE Connect iOS Develop Dairy(2) Identity Protocol, the new version KDE Connect protocol needs a TLS/SSL connection to make a completed identification. Indeed, devices use the TLS/SSL connection to communicate with each other, under secure consideration. In such a connection with asymmetric cryptography, the most important thing is the private key, the public key exchange, and the certificate signed with each deviceâ€™s private key. This post describes how I added a related library (OpenSSL) and used it to generate these elements. Investigation OpenSSL is a widely used library for my purpose. However, there are too many options for each entity. For the private-public key pair, there are several algorithms such as the Elliptic-Curve Digital Signature Algorithm (ECDSA), RSA, etc. What we need to use is precisely the one used by the original KDE Connect. So, I did an investigation on the original version on KDE Invent. Implementation in KDE Connect codebase KDE Connect uses QCA-Qt5 (Qt Cryptographic Architecture), a Qt library providing a straightforward API. To generate a private key (and its paired public key) with 2048 bits from the RSA algorithm, KDE Connect profits this single line: 123456void KdeConnectConfig::generatePrivateKey(const QString&amp; keyPath)&#123; // ... d-&gt;m_privateKey = QCA::KeyGenerator().createRSA(2048); // ...&#125; Then, the generated private key is stored in m_privateKey field. To generate a certificate, KDE Connect uses this method: 1234567891011121314151617181920212223242526void KdeConnectConfig::generateCertificate(const QString&amp; certPath)&#123; // ... QString uuid = QUuid::createUuid().toString(); DBusHelper::filterNonExportableCharacters(uuid); qCDebug(KDECONNECT_CORE) &lt;&lt; \"My id:\" &lt;&lt; uuid; // FIXME: We only use QCA here to generate the cert and key, would be nice to get rid of it completely. // The same thing we are doing with QCA could be done invoking openssl (although it's potentially less portable): // openssl req -new -x509 -sha256 -newkey rsa:2048 -nodes -keyout privateKey.pem -days 3650 -out certificate.pem -subj \"/O=KDE/OU=KDE Connect/CN=_e6e29ad4_2b31_4b6d_8f7a_9872dbaa9095_\" QCA::CertificateOptions certificateOptions = QCA::CertificateOptions(); QDateTime startTime = QDateTime::currentDateTime().addYears(-1); QDateTime endTime = startTime.addYears(10); QCA::CertificateInfo certificateInfo; certificateInfo.insert(QCA::CommonName, uuid); certificateInfo.insert(QCA::Organization,QStringLiteral(\"KDE\")); certificateInfo.insert(QCA::OrganizationalUnit,QStringLiteral(\"Kde connect\")); certificateOptions.setInfo(certificateInfo); certificateOptions.setFormat(QCA::PKCS10); certificateOptions.setSerialNumber(QCA::BigInteger(10)); certificateOptions.setValidityPeriod(startTime, endTime); d-&gt;m_certificate = QSslCertificate(QCA::Certificate(certificateOptions, d-&gt;m_privateKey).toPEM().toLatin1()); // ...&#125; TL;DR, KDE Connect gets a UUID of the current device, use it as Common Name(CN) to generate a certificate with PKCS10; the certificate is valid from one year before to ten years later; there are 2 other fields: Orgnization(O) set to KDE and Organization Unit(OU) set to `Kde connect. Finally, KDE Connect uses the private key to sign the certificate (we can call it self-sign, because there is no authority). We can see that the QCA::Certificate constructor is in charge of all of them. Unfortunately, on iOS, it is not so easy to find an all-in-one solution. I needed to find out how it is done in detail. 123456789Certificate::Certificate(const CertificateOptions &amp;opts, const PrivateKey &amp;key, const QString &amp;provider):d(new Private)&#123; CertContext *c = static_cast&lt;CertContext *&gt;(getContext(QStringLiteral(\"cert\"), provider)); if(c-&gt;createSelfSigned(opts, *(static_cast&lt;const PKeyContext *&gt;(key.context())))) change(c); else delete c;&#125; In the constructor, we can see that a cert context is got, and used to create a self-signed certificate. The method is declared here: 1234567891011121314151617181920212223class QCA_EXPORT CertContext : public CertBase&#123; Q_OBJECTpublic: /** Standard constructor \\param p the provider associated with this context */ CertContext(Provider *p) : CertBase(p, QStringLiteral(\"cert\")) &#123;&#125; /** Create a self-signed certificate based on the given options and private key. Returns true if successful, otherwise false. If successful, this object becomes the self-signed certificate. If unsuccessful, this object is considered to be in an uninitialized state. \\param opts the options to set on the certificate \\param priv the key to be used to sign the certificate */ virtual bool createSelfSigned(const CertificateOptions &amp;opts, const PKeyContext &amp;priv) = 0; and implemented here: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111class MyCertContext : public CertContext&#123; Q_OBJECTpublic: bool createSelfSigned(const CertificateOptions &amp;opts, const PKeyContext &amp;priv) override &#123; _props = CertContextProps(); item.reset(); CertificateInfo info = opts.info(); // Note: removing default constraints, let the app choose these if it wants Constraints constraints = opts.constraints(); // constraints - logic from Botan /*Constraints constraints; if(opts.isCA()) &#123; constraints += KeyCertificateSign; constraints += CRLSign; &#125; else constraints = find_constraints(priv, opts.constraints());*/ EVP_PKEY *pk = static_cast&lt;const MyPKeyContext *&gt;(&amp;priv)-&gt;get_pkey(); X509_EXTENSION *ex; const EVP_MD *md; if(priv.key()-&gt;type() == PKey::RSA) md = EVP_sha1(); else if(priv.key()-&gt;type() == PKey::DSA) md = EVP_sha1(); else return false; // create X509 *x = X509_new(); X509_set_version(x, 2); // serial BIGNUM *bn = bi2bn(opts.serialNumber()); BN_to_ASN1_INTEGER(bn, X509_get_serialNumber(x)); BN_free(bn); // validity period ASN1_TIME_set(X509_get_notBefore(x), opts.notValidBefore().toTime_t()); ASN1_TIME_set(X509_get_notAfter(x), opts.notValidAfter().toTime_t()); // public key X509_set_pubkey(x, pk); // subject X509_NAME *name = new_cert_name(info); X509_set_subject_name(x, name); // issuer == subject X509_set_issuer_name(x, name); // subject key id ex = new_subject_key_id(x); &#123; X509_add_ext(x, ex, -1); X509_EXTENSION_free(ex); &#125; // CA mode ex = new_basic_constraints(opts.isCA(), opts.pathLimit()); if(ex) &#123; X509_add_ext(x, ex, -1); X509_EXTENSION_free(ex); &#125; // subject alt name ex = new_cert_subject_alt_name(info); if(ex) &#123; X509_add_ext(x, ex, -1); X509_EXTENSION_free(ex); &#125; // key usage ex = new_cert_key_usage(constraints); if(ex) &#123; X509_add_ext(x, ex, -1); X509_EXTENSION_free(ex); &#125; // extended key usage ex = new_cert_ext_key_usage(constraints); if(ex) &#123; X509_add_ext(x, ex, -1); X509_EXTENSION_free(ex); &#125; // policies ex = new_cert_policies(opts.policies()); if(ex) &#123; X509_add_ext(x, ex, -1); X509_EXTENSION_free(ex); &#125; // finished X509_sign(x, pk, md); item.cert = x; make_props(); return true; &#125; I could use this as a reference to implement the generation of the private key and the certificate. Implementation on iOS The next step is to generate a certificate and load it on iOS, to test. Generate and store self-signed certificate on iOS I tried several times and several ways, because there were many difficulties. They are noted here. Hope these can help. First generation with OpenSSL cli To make an easy start, I tried to generate a private key and a certificate using OpenSSL. The equivalent command is listed in the comment: 1openssl req -new -x509 -sha256 -newkey rsa:2048 -nodes -keyout privateKey.pem -days 3650 -out certificate.pem -subj &quot;/O=KDE/OU=KDE Connect/CN=_e6e29ad4_2b31_4b6d_8f7a_9872dbaa9095_&quot; After this, I have a privateKey.pem and a certificate.pem. Load self-signed certificate on iOS I tried to separetly load the key and the certificate on iOS, but I did not find a proper API to do so. In a secure connection on iOS, the type needed is SecIdentityRef. However, there is an API to do so: 1OSStatus SecItemImport(CFDataRef importedData, CFStringRef fileNameOrExtension, SecExternalFormat *inputFormat, SecExternalItemType *itemType, SecItemImportExportFlags flags, const SecItemImportExportKeyParameters *keyParams, SecKeychainRef importKeychain, CFArrayRef _Nullable *outItems); only for macOS 10.7+, but not for iOS. There is another one: 1OSStatus SecPKCS12Import(CFDataRef pkcs12_data, CFDictionaryRef options, CFArrayRef _Nullable *items); to import both the private key and the certificate at the same time. But it only accepts the data from a p12 file. So, finally, I sumed the private key and the certificate into a p12 file. And the loading method is like: 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152- (void) loadSecIdentity&#123; BOOL needGenerateCertificate = NO; NSString *resourcePath = NULL; NSArray *documentDirectories = NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES); for (NSString *directory in documentDirectories) &#123; NSLog(@&quot;Find %@&quot;, directory); resourcePath = [directory stringByAppendingString:@&quot;/rsaPrivate.p12&quot;]; &#125; NSFileManager *fileManager = [NSFileManager defaultManager]; if (resourcePath != NULL &amp;&amp; [fileManager fileExistsAtPath:resourcePath]) &#123; NSData *p12Data = [NSData dataWithContentsOfFile:resourcePath]; NSMutableDictionary * options = [[NSMutableDictionary alloc] init]; [options setObject:@&quot;&quot; forKey:(id)kSecImportExportPassphrase]; // No password CFArrayRef items = CFArrayCreate(NULL, 0, 0, NULL); OSStatus securityError = SecPKCS12Import((CFDataRef) p12Data, (CFDictionaryRef)options, &amp;items); SecIdentityRef identityApp; if (securityError == noErr &amp;&amp; CFArrayGetCount(items) &gt; 0) &#123; SecKeyRef privateKeyRef = NULL; CFDictionaryRef identityDict = CFArrayGetValueAtIndex(items, 0); identityApp = (SecIdentityRef)CFDictionaryGetValue(identityDict, kSecImportItemIdentity); securityError = SecIdentityCopyPrivateKey(identityApp, &amp;privateKeyRef); if (securityError != noErr) &#123; // Fail to retrieve private key from the .p12 file needGenerateCertificate = YES; &#125; else &#123; _identity = identityApp; NSLog(@&quot;Certificate loaded successfully from %@&quot;, resourcePath); &#125; &#125; else &#123; // Not valid component in the .p12 file needGenerateCertificate = YES; &#125; &#125; else &#123; // No .p12 file needGenerateCertificate = YES; &#125; if (needGenerateCertificate) &#123; // generate certificate NSLog(@&quot;Need generate certificate&quot;); [self generateAndLoadSecIdentity]; &#125;&#125; The p12 file is still available in the project, and should be removed soon. Attemption on generation with OpenSSL-Universal I tried to use OpenSSL-Universal by adding: 1pod 'OpenSSL-Universal' But it does not work, in both meanings: the generated certificate cannot be correctly loaded; there is an error indicating the missing bitcode on Xcode 11.3.1 and on a real iPhone. Success generation After searching, I choose to use: 1pod 'openssl-ios-bitcode' The final generation method is as follow: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081- (void) generateSecIdentity&#123; // generate private key EVP_PKEY * pkey; pkey = EVP_PKEY_new(); RSA * rsa; rsa = RSA_generate_key( 2048, /* number of bits for the key - 2048 is a sensible value */ RSA_F4, /* exponent - RSA_F4 is defined as 0x10001L */ NULL, /* callback - can be NULL if we aren&apos;t displaying progress */ NULL /* callback argument - not needed in this case */ ); EVP_PKEY_assign_RSA(pkey, rsa); // generate cert X509 *x509; x509 = X509_new(); ASN1_INTEGER_set(X509_get_serialNumber(x509), 10); X509_gmtime_adj(X509_get_notBefore(x509), 0); X509_gmtime_adj(X509_get_notAfter(x509), 31536000L); X509_set_pubkey(x509, pkey); X509_NAME *name; name = X509_get_subject_name(x509); X509_NAME_add_entry_by_txt(name, &quot;OU&quot;, MBSTRING_ASC, // OU = organisational unit (unsigned char *)&quot;Kde connect&quot;, -1, -1, 0); X509_NAME_add_entry_by_txt(name, &quot;O&quot;, MBSTRING_ASC, // O = organization (unsigned char *)&quot;KDE&quot;, -1, -1, 0); X509_NAME_add_entry_by_txt(name, &quot;CN&quot;, MBSTRING_ASC, // CN = common name, TODO: uuid (unsigned char *)[[NetworkPackage getUUID] UTF8String], -1, -1, 0); X509_set_issuer_name(x509, name); if (!X509_sign(x509, pkey, EVP_md5())) &#123; @throw [[NSException alloc] initWithName:@&quot;Fail sign cert&quot; reason:@&quot;Error&quot; userInfo:nil]; &#125; if (!X509_check_private_key(x509, pkey)) &#123; @throw [[NSException alloc] initWithName:@&quot;Fail validate cert&quot; reason:@&quot;Error&quot; userInfo:nil]; &#125; // load algo and encryption components SSLeay_add_all_algorithms(); ERR_load_crypto_strings(); // create p12 format data PKCS12 *p12 = NULL; p12 = PKCS12_create(/* password */ &quot;&quot;, /* name */ &quot;KDE Connect&quot;, pkey, x509, /* ca */ NULL, /* nid_key */ 0, /* nid_cert */ 0, /* iter */ 0, /* mac_iter */ PKCS12_DEFAULT_ITER, /* keytype */ 0); if(!p12) &#123; @throw [[NSException alloc] initWithName:@&quot;Fail getP12File&quot; reason:@&quot;Error creating PKCS#12 structure&quot; userInfo:nil]; &#125; // write into `Documents/rsaPrivate.p12` NSArray *documentDirectories = NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES); NSString *p12FilePath = NULL; for (NSString *directory in documentDirectories) &#123; NSLog(@&quot;Find %@&quot;, directory); p12FilePath = [directory stringByAppendingString:@&quot;/rsaPrivate.p12&quot;]; &#125; if (![[NSFileManager defaultManager] createFileAtPath:p12FilePath contents:nil attributes:nil]) &#123; NSLog(@&quot;Error creating file for P12&quot;); @throw [[NSException alloc] initWithName:@&quot;Fail getP12File&quot; reason:@&quot;Fail Error creating file for P12&quot; userInfo:nil]; &#125; // get a FILE struct for the P12 file NSFileHandle *outputFileHandle = [NSFileHandle fileHandleForWritingAtPath:p12FilePath]; FILE *p12File = fdopen([outputFileHandle fileDescriptor], &quot;w&quot;); i2d_PKCS12_fp(p12File, p12); PKCS12_free(p12); fclose(p12File); [outputFileHandle closeFile];&#125; Conclusion In this post, I described, in general, how I generate and load the private key and certificate in KDE Connect iOS. This aims at preparing a TLS/SSL connection between an iOS device and a device using the current version of KDE Connect. In the next post, I will tell the TLS/SSL transport in KDE Connect iOS. Thanks for reading!","categories":[{"name":"KDE Connect","slug":"KDE-Connect","permalink":"https://blog.inoki.cc/categories/KDE-Connect/"}],"tags":[{"name":"KDE Connect","slug":"KDE-Connect","permalink":"https://blog.inoki.cc/tags/KDE-Connect/"}]},{"title":"ã€è¯‘ã€‘Xen çš„å¥‡å¦™å†’é™© â€”â€” RPi4 ç¯‡","slug":"Xen-on-Raspberry-Pi-4-Adeventures","date":"2021-01-27T15:47:40.000Z","updated":"2025-03-08T09:40:48.607Z","comments":true,"path":"2021/01/27/Xen-on-Raspberry-Pi-4-Adeventures/","link":"","permalink":"https://blog.inoki.cc/2021/01/27/Xen-on-Raspberry-Pi-4-Adeventures/","excerpt":"","text":"åŸæ–‡é“¾æ¥ï¼šXen on Raspberry Pi 4 adventures ä½œè€…ï¼šStefano Stabellini å’Œ Roman Shaposhnik æ ‘è“æ´¾ï¼ˆRPiï¼‰ç”±äºä»·æ ¼ä½å»‰è€Œåº”ç”¨å¹¿æ³›ï¼Œå¤šå¹´æ¥ä¸€ç›´æ˜¯ ARM ç¤¾åŒºçš„å…³é”®è®¾å¤‡ã€‚æ ¹æ® RPi åŸºé‡‘ä¼šçš„æ•°æ®ï¼Œå·²ç»å”®å‡ºäº†è¶…è¿‡ 3500 ä¸‡å°ï¼Œå…¶ä¸­ 44% é”€å¾€å·¥ä¸šé¢†åŸŸã€‚æˆ‘ä»¬ä¸€ç›´æ¸´æœ›åœ¨å…¶ä¸Šè¿è¡Œ Xen ç®¡ç†ç¨‹åºï¼Œä½† RPi ä¸å…¶ä»– ARM å¹³å°ä¹‹é—´çš„æŠ€æœ¯å·®å¼‚ä½¿å…¶åœ¨å¾ˆé•¿ä¸€æ®µæ—¶é—´å†…éƒ½ä¸èƒ½æˆä¸ºç°å®ã€‚å…·ä½“æ¥è¯´ï¼Œå°±æ˜¯å› ä¸ºå…¶ä½¿ç”¨äº†ä¸€ä¸ªæ²¡æœ‰è™šæ‹ŸåŒ–æ”¯æŒçš„éæ ‡å‡†ä¸­æ–­æ§åˆ¶å™¨ã€‚ ç„¶åï¼Œå¸¦æœ‰ä¸€ä¸ªæ ‡å‡† GIC-400 ä¸­æ–­æ§åˆ¶å™¨çš„ Raspberry Pi 4 å‡ºç°äº†ã€‚è¿™ä¸ªä¸­æ–­æ§åˆ¶å™¨æœ¬æ¥å°±è¢« Xen å¹³å°æ”¯æŒã€‚ç»ˆäºï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ RPi è®¾å¤‡ä¸Šè¿è¡Œ Xen äº†ã€‚å¾ˆå¿«ï¼ŒProject EVE çš„ Roman Shaposhnik å’Œå…¶ä»–ä¸€äº›ç¤¾åŒºæˆå‘˜å¼€å§‹åœ¨ xen-devel é‚®ä»¶åˆ—è¡¨ä¸­è¯¢é—®è¿™ä¸ªé—®é¢˜ã€‚&quot;è¿™åº”è¯¥å¾ˆå®¹æ˜“ï¼Œ&quot;æˆ‘ä»¬å›ç­”é“ã€‚&quot;å®ƒç”šè‡³å¯èƒ½ä¸ç”¨ä»»ä½•é¢å¤–å·¥ä½œå°±èƒ½å·¥ä½œï¼Œ&quot;æˆ‘ä»¬åœ¨å›å¤ä¸­å†™é“ã€‚ä½†æˆ‘ä»¬å®Œå…¨æ²¡æœ‰æ„è¯†åˆ°ï¼Œæˆ‘ä»¬å³å°†åœ¨ Xen å†…å­˜åˆ†é…å™¨å’Œ Linux åœ°å€è½¬æ¢å±‚çš„ä¹‹é—´é‡Œå±•å¼€ä¸€åœºå®å¤§çš„å†’é™©ã€‚ ç¬¬ä¸€ä¸ªéšœç¢æ˜¯ä½å†…å­˜åœ°å€çš„å¯ç”¨æ€§ã€‚RPi4 çš„è®¾å¤‡åªèƒ½è®¿é—®å‰ 1GB çš„å†…å­˜ã€‚å¯¹ Dom0 æ¥è¯´ 1GB ä»¥ä¸‹çš„å†…å­˜æ˜¯ä¸å¤Ÿçš„ã€‚Julien Grall é€šè¿‡ä¸€ä¸ªç®€å•çš„å•è¡Œä¿®å¤è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œå¢åŠ äº†åœ¨ RPi4 ä¸Š Dom0 çš„ 1GB ä»¥ä¸‹å†…å­˜åˆ†é…ã€‚è¯¥è¡¥ä¸ç°åœ¨å·²ç»å‡ºç°åœ¨ Xen 4.14 ä¸­ã€‚ &quot;è¿™ç§ä½äº1GBçš„é™åˆ¶è™½ç„¶ä¸å¸¸è§çš„ï¼Œä½†ç°åœ¨å®ƒè¢«ä¿®å¤äº†ï¼Œå®ƒåº”å½“å¯ä»¥å·¥ä½œäº†ã€‚&quot;ä½†æˆ‘ä»¬åˆé”™äº†ï¼ŒLinuxä¸­çš„ Xen å­ç³»ç»Ÿä½¿ç”¨ virt_to_phys å°†è™šæ‹Ÿåœ°å€è½¬æ¢ä¸ºç‰©ç†åœ°å€ï¼Œè¿™å¯¹å¤§å¤šæ•°è™šæ‹Ÿåœ°å€éƒ½æœ‰æ•ˆï¼Œä½†ä¸æ˜¯æ‰€æœ‰çš„è™šæ‹Ÿåœ°å€ã€‚åŸæ¥ï¼ŒRPi4 Linux å†…æ ¸æœ‰æ—¶ä¼šä½¿ç”¨æ— æ³•é€šè¿‡ virt_to_phys è½¬åŒ–ä¸ºç‰©ç†åœ°å€çš„è™šæ‹Ÿåœ°å€ï¼Œè¿™æ ·åšä¼šå¯¼è‡´ä¸¥é‡é”™è¯¯ã€‚ä¿®æ­£çš„æ–¹æ³•æ˜¯åœ¨é€‚å½“çš„æ—¶å€™ä½¿ç”¨ä¸åŒçš„åœ°å€ç¿»è¯‘å‡½æ•°ã€‚ç°åœ¨è¯¥è¡¥ä¸å·²ç»å­˜åœ¨äº Linux çš„ä¸»åˆ†æ”¯ä¸­ã€‚ æˆ‘ä»¬æ„Ÿåˆ°ä¿¡å¿ƒåè¶³ï¼Œç»ˆäºåˆ°äº†ç»ˆç‚¹ã€‚&quot;å†…å­˜åˆ†é…â€“æ£€æŸ¥ã€‚å†…å­˜ç¿»è¯‘â€“æ£€æŸ¥ã€‚æˆäº†ï¼&quot;ä¸ï¼Œè¿˜æ²¡æœ‰ã€‚äº‹å®è¯æ˜ï¼Œæœ€é‡è¦çš„é—®é¢˜è¿˜æ²¡æœ‰è¢«å‘ç°ã€‚Linux å†…æ ¸ä¸€ç›´æœ‰ç‰©ç†åœ°å€å’Œ DMA åœ°å€çš„æ¦‚å¿µï¼Œå…¶ä¸­ DMA åœ°å€æ˜¯ç”¨æ¥ç»™è®¾å¤‡ç¼–ç¨‹çš„ï¼Œå®ƒå¯èƒ½å’Œç‰©ç†åœ°å€ä¸åŒã€‚ä½†å®é™…ä¸Šï¼Œåœ¨ Xen å¯ä»¥è¿è¡Œçš„ x86ã€ARM å’Œ ARM64 å¹³å°ï¼ŒDMA åœ°å€ä¸ç‰©ç†åœ°å€ç›¸åŒã€‚Linux ä¸­çš„ Xen å­ç³»ç»Ÿå°±æ˜¯åˆ©ç”¨ DMA ä¸ç‰©ç†åœ°å€çš„äºŒå…ƒæ€§æ¥è¿›è¡Œè‡ªå·±çš„åœ°å€è½¬æ¢ã€‚å®ƒåˆ©ç”¨å®ƒå°†å®¢æˆ·æœºçœ‹åˆ°çš„ç‰©ç†åœ°å€è½¬æ¢ä¸º Xen çœ‹åˆ°çš„ç‰©ç†åœ°å€ã€‚ è®©æˆ‘ä»¬æ„Ÿåˆ°æƒŠè®¶å’ŒæƒŠå–œçš„æ˜¯ï¼ŒRaspberry Pi 4 æ˜¯ç¬¬ä¸€ä¸ªç‰©ç†åœ°å€ä¸ DMA åœ°å€ä¸åŒçš„å¹³å°ï¼Œå¯¼è‡´ Linux ä¸­çš„ Xen å­ç³»ç»Ÿå´©æºƒã€‚è¦ç¼©å°é—®é¢˜çš„èŒƒå›´å¹¶ä¸å®¹æ˜“ã€‚ä¸€æ—¦æˆ‘ä»¬äº†è§£äº†è¿™ä¸ªé—®é¢˜ï¼Œé€šè¿‡åå‡ ä¸ªè¡¥ä¸ï¼Œæˆ‘ä»¬å®Œå…¨æ”¯æŒäº†åœ¨ Linux ä¸­å¤„ç† DMA ä¸ç‰©ç†åœ°å€çš„è½¬æ¢ã€‚Linux è¡¥ä¸å·²ç»åœ¨ä¸»åˆ†æ”¯ä¸­ï¼Œå°†åœ¨ Linux 5.9 ä¸­æä¾›ã€‚ è§£å†³äº†åœ°å€ç¿»è¯‘é—®é¢˜ï¼Œæˆ‘ä»¬æœ‰è¶£çš„ Hack å†’é™©å°±ç»“æŸäº†ã€‚åº”ç”¨ Xen å’Œ Linux è¡¥ä¸åï¼ŒXen å’Œ Dom0 å¯ä»¥å®Œç¾åœ°å·¥ä½œã€‚ä¸€æ—¦ Linux 5.9 å‡ºæ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥è®© Xen åœ¨ RPi4 ä¸Šå¼€ç®±å³ç”¨ã€‚ æˆ‘ä»¬å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•åœ¨ RPi4 ä¸Šè¿è¡Œ Xenï¼ŒçœŸæ­£çš„ Xen Hack æ–¹å¼ï¼Œå¹¶ä½œä¸ºä¸‹æ¸¸åˆ†å‘çš„ä¸€éƒ¨åˆ†ï¼Œä»¥è·å¾—æ›´ç®€å•çš„æœ€ç»ˆç”¨æˆ·ä½“éªŒã€‚ åœ¨æ ‘è“æ´¾ 4 ä¸Šç©è½¬ Xen å¦‚æœä½ æ‰“ç®—åœ¨ ARM ä¸Šå¯¹ Xen è¿›è¡Œ Hackï¼Œå¹¶å¸Œæœ›ä½¿ç”¨ RPi4 æ¥å®Œæˆï¼Œè¿™é‡Œæ˜¯ä½ éœ€è¦åšçš„ï¼Œä»¥ä½¿ Xen ä½¿ç”¨ UBoot å’Œ TFTP å¯åŠ¨å’Œè¿è¡Œã€‚æˆ‘å–œæ¬¢ä½¿ç”¨ TFTPï¼Œå› ä¸ºå®ƒå¯ä»¥åœ¨å¼€å‘è¿‡ç¨‹ä¸­æå¿«åœ°æ›´æ–°ä»»ä½•äºŒè¿›åˆ¶æ–‡ä»¶ã€‚è¯·å‚é˜…æœ¬æ•™ç¨‹ï¼Œäº†è§£å¦‚ä½•è®¾ç½®å’Œé…ç½® TFTP æœåŠ¡å™¨ã€‚ä½ è¿˜éœ€è¦ä¸€ä¸ª UART è¿æ¥æ¥è·å¾— Xen å’Œ Linux çš„æ—©æœŸè¾“å‡ºï¼Œè¯·å‚è€ƒè¿™ç¯‡æ–‡ç« ã€‚ ä½¿ç”¨ rpi-imager æ ¼å¼åŒ– SD å¡ä¸å¸¸è§„é»˜è®¤çš„ Raspberry Pi æ“ä½œç³»ç»Ÿã€‚æŒ‚è½½ç¬¬ä¸€ä¸ªSDå¡åˆ†åŒºå¹¶ç¼–è¾‘ config.txtã€‚ç¡®ä¿æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š 12345kernel=u-boot.binenable_uart=1arm_64bit=1 ä»ä»»ä½•å‘è¡Œç‰ˆä¸­ä¸‹è½½ä¸€ä¸ªé€‚åˆ RPi4 çš„ U Boot äºŒè¿›åˆ¶æ–‡ä»¶(u-boot.bin)ï¼Œä¾‹å¦‚ OpenSUSEã€‚ä¸‹è½½ JeOS é•œåƒï¼Œç„¶åæ‰“å¼€å®ƒå¹¶ä¿å­˜ u-boot.binã€‚ 1234567xz -d openSUSE-Tumbleweed-ARM-JeOS-raspberrypi4.aarch64.raw.xzkpartx -a ./openSUSE-Tumbleweed-ARM-JeOS-raspberrypi4.aarch64.rawmount /dev/mapper/loop0p1 /mntcp /mnt/u-boot.bin /tmp å°† u-boot.bin å’Œ config.txt ä¸€èµ·æ”¾å…¥ç¬¬ä¸€ä¸ªSDå¡åˆ†åŒºã€‚ä¸‹æ¬¡ç³»ç»Ÿå¯åŠ¨æ—¶ï¼Œä½ ä¼šå¾—åˆ°ä¸€ä¸ª UBoot æç¤ºï¼Œå…è®¸ä½ ä»ç½‘ç»œä¸Šçš„ TFTP æœåŠ¡å™¨åŠ è½½ Xenã€Dom0 çš„ Linux å†…æ ¸ã€Dom0 rootfs å’Œè®¾å¤‡æ ‘ã€‚æˆ‘é€šè¿‡åœ¨ SD å¡ä¸Šæ”¾ç½® UBoot boot.scr è„šæœ¬æ¥è‡ªåŠ¨å®ŒæˆåŠ è½½æ­¥éª¤ï¼š 1234567setenv serverip 192.168.0.1setenv ipaddr 192.168.0.2tftpb 0xC00000 boot2.scrsource 0xC00000 å…¶ä¸­ï¼š 12- serverip æ˜¯ä½ çš„ TFTP æœåŠ¡å™¨çš„ IP- ipaddr æ˜¯ä½ çš„ RPi4 çš„ IP ä½¿ç”¨ mkimage ç”Ÿæˆ boot.scrï¼Œå¹¶å°†å…¶æ”¾åœ¨ config.txt å’Œ u-boot.bin ä¸€èµ·ï¼š 1mkimage -T script -A arm64 -C none -a 0x2400000 -e 0x2400000 -d boot.source boot.scr å…¶ä¸­ï¼š 12- boot.source æ˜¯è¾“å…¥- boot.scr æ˜¯è¾“å‡º UBoot æœƒè‡ªåŠ¨æ‰§è¡Œæ‰€æä¾›çš„ boot.scrï¼Œå®ƒä¼šè®¾å®šç½‘ç»œï¼Œå¹¶ä» TFTP æœåŠ¡å™¨å–å¾—ç¬¬äºŒä¸ªè„šæœ¬ (boot2.scr)ã€‚boot2.scr åº”å½“åŒ…å«äº†æ‰€æœ‰è½½å…¥ Xen å’Œå…¶ä»–æ‰€éœ€äºŒè¿›åˆ¶æ–‡ä»¶çš„æŒ‡ä»¤ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ ImageBuilder ç”Ÿæˆ boot2.scrã€‚ ç¡®ä¿ä½¿ç”¨ Xen 4.14 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚Linux å†…æ ¸åº”è¯¥æ˜¯ä¸»åˆ†æ”¯ï¼ˆæˆ–ç­‰åˆ° 5.9 å‡ºæ¥åï¼Œ5.4-rc4 ä¹Ÿå¯ä»¥ï¼‰ï¼ŒLinux ARM64 é»˜è®¤é…ç½®å¯ä»¥ä½œä¸ºå†…æ ¸é…ç½®ã€‚ä»»ä½• 64 ä½çš„ rootfs éƒ½åº”è¯¥å¯ä»¥ç”¨äº Dom0ã€‚ä½¿ç”¨ä¸Šæ¸¸ Linux è‡ªå¸¦çš„ RPi4 çš„è®¾å¤‡æ ‘ï¼ˆarch/arm64/boot/dts/broadcom/bcm2711-rpi-4-b.dtbï¼‰ã€‚æ³¨æ„ RPi4 æœ‰ä¸¤ä¸ª UARTï¼Œé»˜è®¤æ˜¯åœ°å€ä¸º 0x7e215040 çš„ bcm2835-aux-uartã€‚å®ƒåœ¨è®¾å¤‡æ ‘ä¸­è¢«æŒ‡å®šä¸º serial1ï¼Œè€Œä¸æ˜¯ serial0ã€‚æ‚¨å¯ä»¥é€šè¿‡åœ¨ Xen å‘½ä»¤è¡Œä¸­æŒ‡å®šè®© Xen ä½¿ç”¨ serial1ï¼š 1console=dtuart dtuart=serial1 sync_console Xen å‘½ä»¤è¡Œç”± ImageBuilder ç”Ÿæˆçš„ boot2.scr è„šæœ¬æä¾›ï¼Œåä¸º â€œxen,xen-bootargsâ€ã€‚ç¼–è¾‘ boot2.source åï¼Œä½ å¯ä»¥ç”¨ mkimage é‡æ–°ç”Ÿæˆ boot2.scrï¼š 1mkimage -A arm64 -T script -C none -a 0xC00000 -e 0xC00000 -d boot2.source boot2.scr æ ‘è“æ´¾ 4 ä¸Šçš„ Xenï¼šä¸€ä¸ªç®€å•çš„æ“ä½œ é€šè¿‡åœ¨ RPi 4 ä¸Šä»å¤´å¼€å§‹æ„å»ºå’Œå¯åŠ¨ Xen è¿™æ ·çš„è„æ´»ï¼Œä¸ä»…å¯ä»¥è®©ä½ æ·±æ„Ÿæ»¡è¶³ï¼Œè€Œä¸”å¯ä»¥è®©ä½ æ·±å…¥äº†è§£ ARM ä¸Šçš„ä¸€åˆ‡æ˜¯å¦‚ä½•ç»“åˆåœ¨ä¸€èµ·çš„ã€‚ç„¶è€Œï¼Œæœ‰æ—¶æ‚¨åªæ˜¯æƒ³å¿«é€Ÿä½“éªŒä¸€ä¸‹åœ¨è¿™å—æ¿å­ä¸Šä½¿ç”¨ Xen çš„æ„Ÿè§‰ã€‚å¯¹äº Xen æ¥è¯´ï¼Œè¿™é€šå¸¸ä¸æ˜¯é—®é¢˜ï¼Œå› ä¸ºå‡ ä¹æ¯ä¸ª Linux å‘è¡Œç‰ˆéƒ½æä¾› Xen åŒ…ï¼Œåªéœ€è°ƒç”¨ â€œaptâ€ æˆ– â€œzypperâ€ å°±å¯ä»¥åœ¨ç³»ç»Ÿä¸Šè¿è¡Œä¸€ä¸ªåŠŸèƒ½é½å…¨çš„ Xenã€‚ç„¶è€Œï¼Œé‰´äº Raspberry Pi 4 çš„æ”¯æŒåªæœ‰å‡ ä¸ªæœˆçš„æ—¶é—´ï¼Œæ•´åˆå·¥ä½œè¿˜æ²¡æœ‰å®Œæˆã€‚å”¯ä¸€ä¸€ä¸ªåœ¨ Raspberry Pi 4 ä¸Šå®Œå…¨é›†æˆå’Œæµ‹è¯•æ”¯æŒ Xen çš„æ“ä½œç³»ç»Ÿæ˜¯ LF Edge çš„ Project EVEã€‚ Project EVE æ˜¯ä¸€ä¸ªè®¾è®¡ä¸Šå®‰å…¨çš„æ“ä½œç³»ç»Ÿï¼Œæ”¯æŒåœ¨ç°åœºéƒ¨ç½²çš„è®¡ç®—è®¾å¤‡ä¸Šè¿è¡Œè¾¹ç¼˜å®¹å™¨ã€‚è¿™äº›è®¾å¤‡å¯ä»¥æ˜¯ç‰©è”ç½‘ç½‘å…³ã€å·¥ä¸š PC æˆ–é€šç”¨è®¡ç®—æœºã€‚æ‰€æœ‰åœ¨ EVE ä¸Šè¿è¡Œçš„åº”ç”¨éƒ½è¢«è¡¨ç¤ºä¸ºè¾¹ç¼˜å®¹å™¨ï¼Œå¹¶å—åˆ¶äºç”± k3s é©±åŠ¨çš„å®¹å™¨åè°ƒç­–ç•¥ã€‚è¾¹ç¼˜å®¹å™¨æœ¬èº«å¯ä»¥å°è£…è™šæ‹Ÿæœºã€å®¹å™¨æˆ– Unikernelsã€‚ ä½ å¯ä»¥åœ¨è¯¥é¡¹ç›®ç½‘ç«™ http://projecteve.dev å’Œå…¶ GitHub repo æ‰¾åˆ°æ›´å¤šå…³äº EVE çš„ä¿¡æ¯ã€‚ä¸º Raspberry Pi 4 åˆ›å»ºå¯å¯åŠ¨åª’ä½“çš„æœ€æ–°è¯´æ˜ä¹Ÿå¯åœ¨ä»¥ä¸‹ç½‘ç«™è·å¾—ã€‚ https://github.com/lf-edge/eve/blob/master/docs/README.md å› ä¸º EVE å‘å¸ƒçš„æ˜¯å®Œå…¨ç¼–è¯‘å®Œæˆçš„å¯ä¸‹è½½çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä½¿ç”¨å®ƒåœ¨ Raspberry Pi 4 ä¸Šå°è¯• Xen å°±å¾ˆç®€å•äº†ï¼š 123$ docker pull lfedge/eve:5.9.0-rpi-xen-arm64 # you can pick a different 5.x.y release if you like$ docker run lfedge/eve:5.9.0-rpi-xen-arm64 live &gt; live.raw éšåä½¿ç”¨ä½ å–œæ¬¢çš„å·¥å…·å°†ç”Ÿæˆçš„ live.raw äºŒè¿›åˆ¶æ–‡ä»¶åˆ·å†™åˆ° SD å¡ä¸Šã€‚ ä¸€æ—¦è¿™äº›æ­¥éª¤å®Œæˆï¼Œä½ å°±å¯ä»¥å°†å¡æ’å…¥åˆ°ä½ çš„ Raspberry Pi 4 ä¸­ï¼Œè¿æ¥é”®ç›˜å’Œæ˜¾ç¤ºå™¨ï¼Œäº«å—ä¸€ä¸ªæç®€ä¸»ä¹‰çš„ Linux å‘è¡Œç‰ˆï¼ˆåŸºäº Alpine Linux å’Œ Linuxkitï¼‰ï¼Œè¿™å°±æ˜¯åœ¨ Xen ä¸‹è¿è¡Œçš„ Dom0 é¡¹ç›® EVEã€‚ å°± Linux å‘è¡Œç‰ˆè€Œè¨€ï¼ŒEVE å‘ˆç°å‡ºäº†ä¸€ç§æœ‰äº›æ–°é¢–çš„æ“ä½œç³»ç»Ÿè®¾è®¡ï¼Œä½†åŒæ—¶ï¼Œå®ƒä¹Ÿæ·±å— Qubes OSã€ChromeOSã€Core OS å’Œ Smart OS çš„å¯å‘ã€‚å¦‚æœä½ æƒ³è®©å®ƒè¶…è¶Šç®€å•çš„æ§åˆ¶å°ä»»åŠ¡ï¼Œæ¢ç´¢å¦‚ä½•åœ¨ä¸Šé¢è¿è¡Œç”¨æˆ·åŸŸï¼Œæˆ‘ä»¬å»ºè®®å‰å¾€ EVE çš„å§Šå¦¹é¡¹ç›® Edenï¼ŒæŒ‰ç…§é‚£è¾¹çš„ç®€çŸ­æ•™ç¨‹è¿›è¡Œæ“ä½œã€‚ å¦‚æœæœ‰ä»»ä½•é—®é¢˜ï¼Œæ‚¨å¯ä»¥åœ¨ LF Edge çš„ Slack é¢‘é“ä¸­æ‰¾åˆ°ä¸€ä¸ªæ´»è·ƒçš„ EVE å’Œ Eden ç”¨æˆ·ç¤¾åŒºï¼Œä» http://lfedge.slack.com/ çš„ #eve å¼€å§‹â€“æˆ‘ä»¬å¾ˆä¹æ„å¬åˆ°æ‚¨çš„åé¦ˆã€‚ Hack æ„‰å¿«ï¼","categories":[{"name":"Translation","slug":"Translation","permalink":"https://blog.inoki.cc/categories/Translation/"},{"name":"Embedded System","slug":"Embedded-System","permalink":"https://blog.inoki.cc/categories/Embedded-System/"},{"name":"Chinese","slug":"Translation/Chinese","permalink":"https://blog.inoki.cc/categories/Translation/Chinese/"},{"name":"Raspberry Pi","slug":"Embedded-System/Raspberry-Pi","permalink":"https://blog.inoki.cc/categories/Embedded-System/Raspberry-Pi/"}],"tags":[{"name":"ç¿»è¯‘","slug":"ç¿»è¯‘","permalink":"https://blog.inoki.cc/tags/ç¿»è¯‘/"},{"name":"ä¸­æ–‡","slug":"ä¸­æ–‡","permalink":"https://blog.inoki.cc/tags/ä¸­æ–‡/"}]},{"title":"SDDM tips (1)","slug":"AX88179_178a_USB_Ethernet_adapter_Linux_Driver/SDDM-tips-1","date":"2021-01-25T09:30:40.000Z","updated":"2025-03-08T09:40:48.545Z","comments":true,"path":"2021/01/25/AX88179_178a_USB_Ethernet_adapter_Linux_Driver/SDDM-tips-1/","link":"","permalink":"https://blog.inoki.cc/2021/01/25/AX88179_178a_USB_Ethernet_adapter_Linux_Driver/SDDM-tips-1/","excerpt":"","text":"SDDM is the abbreviation of Simple Desktop Display Manager, which is a default display manager for LXQt and KDE Plasma. It officially supports Linux and FreeBSD, but should also work well with other Unix-like system. User HOME SDDM works under a special user in an UNIX-like system: sddm. Its HOME directory is set to /var/lib/sddm. If we want to install it ourselves, an sddm user needs to be created, with its home set to /var/lib/sddm by default. In this directory, a state.conf will be created. The content of it on my PC is: 123456789[Last]# Name of the last logged-in user.# This user will be preselected when the login screen appearsUser=inoki# Name of the session for the last logged-in user.# This session will be preselected when the login screen appears.Session=/usr/share/xsessions/plasma.desktop which notes the latest login user and the correspond session. This will accelerate the next login. The file is declared in src/common/configuration.h and will be loaded later. Configurations Like the other programs, SDDM also reads configuration from /etc. The file is /etc/sddm.conf, which contains several sections: General Theme Users Wayland X11 Icons User icons are stored in $(DATADIR)/faces/ or ~/.face.icon (for each user). Themes Themes are stored in $(DATADIR)/themes/. SDDM loads Main.qml file in it to create an user interface. Scripts Scripts to launch a specific session under an environment are stored in $(DATADIR)/scripts/. These scripts will start the desktop environment. For example, for X11, the configuration items are: 12345678910111213[X11]DisplayCommand=/usr/share/sddm/scripts/XsetupDisplayStopCommand=/usr/share/sddm/scripts/XstopEnableHiDPI=falseMinimumVT=1ServerArguments=-nolisten tcpServerPath=/usr/bin/XSessionCommand=/usr/share/sddm/scripts/XsessionSessionDir=/usr/share/xsessionsSessionLogFile=.local/share/sddm/xorg-session.logUserAuthFile=.XauthorityXauthPath=/usr/bin/xauthXephyrPath=/usr/bin/Xephyr The script is Xsetup, Xsession, Xstop, etc. The desktop entries for desktop environments are placed in /usr/share/xsessions. In my case, the plasma.desktop indicates the executable: 1234567[Desktop Entry]Type=XSessionExec=/usr/bin/startplasma-x11TryExec=/usr/bin/startplasma-x11DesktopNames=KDEName=Plasma... Conclusion Unfinished. TBCâ€¦","categories":[{"name":"KDE","slug":"KDE","permalink":"https://blog.inoki.cc/categories/KDE/"}],"tags":[{"name":"KDE","slug":"KDE","permalink":"https://blog.inoki.cc/tags/KDE/"},{"name":"SDDM","slug":"SDDM","permalink":"https://blog.inoki.cc/tags/SDDM/"}]},{"title":"æ»‘ç¨½ã€æ··ä¹±ã€å±€ä¿ƒä¸ 2020","slug":"My-2020","date":"2020-12-30T09:41:40.000Z","updated":"2025-03-08T09:40:48.586Z","comments":true,"path":"2020/12/30/My-2020/","link":"","permalink":"https://blog.inoki.cc/2020/12/30/My-2020/","excerpt":"","text":"ä»å»å¹´ 11 æœˆé™†ç»­æ”¶åˆ° offer å¹¶é€‰æ‹©äº†è‡ªå·±æœ€æ„Ÿå…´è¶£çš„ä¸€ä¸ªé‚£ä¸€åˆ»èµ·ï¼Œæˆ‘æƒ³è±¡ä¸­çš„ 2020 æœ¬åº”æœªæ¥å¯æœŸï¼šäºŒæœˆæœ«å®ä¹ ç»“æŸï¼Œå’Œä¸€å¹´æ²¡å›å®¶çš„å¥³æœ‹å‹å›æˆéƒ½åƒå¥½åƒçš„ï¼Œä¸‰æœˆæœ«å†ä¸€èµ·å‡ºå›½ã€åœ¨ä¸€ä¸ªå…¨æ–°çš„åœ°æ–¹å®‰å®¶ï¼Œæˆ‘åŠå…¥å­¦æ‰‹ç»­ï¼Œå¥¹æ‰¾åˆ°å·¥ä½œã€‚ç„¶åå°±å¯ä»¥è¿‡ä¸Šæ²¡ç¾æ²¡è‡Šæ— å¿§æ— è™‘çš„å°ç”Ÿæ´»ã€‚ ä½†æˆ‘æ²¡æƒ³åˆ°ï¼Œåœ¨äºŒåä¸€ä¸–çºªçš„ 10 å¹´ä»½çš„æœ€ååˆçœ‹åˆ°äº†å¼•å‘è‚ºç‚çš„ç—…æ¯’ä¼ æ’­çš„æ¶ˆæ¯ï¼Œæ›´æ²¡æœ‰æƒ³åˆ°ã€å®ƒå¯¹æˆ‘çš„ä¸€å¹´ã€ä¹ƒè‡³ä¹‹åèƒ½äº§ç”Ÿå¤šå¤§çš„å½±å“ã€‚ å¼€ç«¯ è¿™ä¸€å¹´æ˜¯ä»åœ£è¯å’Œå…ƒæ—¦ç»„æˆçš„å‡æœŸå¼€å§‹çš„ï¼Œè¿™ä¸ªå‡æœŸåœ¨è¥¿ç­ç‰™ç©å¾—æŒºå¼€å¿ƒï¼Œä½†ä¹Ÿéšéšæ‹…å¿ƒç—…æ¯’çš„æƒ…å†µï¼Œå›åˆ°ä½æ‰€ä¾¿ç»™åœ¨å›½å†…çš„å®¶é‡Œäººæ‰“ç”µè¯ï¼Œå¸Œæœ›ä»–ä»¬å°å¿ƒã€‚ å‡æœŸç»“æŸï¼Œå›åˆ°å®ä¹ çš„å…¬å¸ï¼Œé‚£æ—¶ WHO å·²ç»å‘å¸ƒäº†å½“æ—¶çš„ç—…æ¯’æƒ…å†µï¼Œä½†è¿˜æ²¡æœ‰æåˆ°äººä¼ äººï¼Œä½†å‡­å€Ÿå°æ—¶å€™çš„ç»éªŒã€ åŠ ä¸Šæˆ‘è™½ç„¶æœ‰é™ä½†è¿˜å­˜åœ¨çš„ç”Ÿç‰©çŸ¥è¯†ï¼Œæˆ‘è§‰å¾—å®ƒå’Œ 03 å¹´é‚£æ¬¡åº”å½“å·®ä¸å¤šã€‚ å’ŒåŒäº‹ä»¬ä¸€èµ·åƒåˆé¥­çš„æ—¶å€™èŠåˆ°äº†ç—…æ¯’ã€‚ç”±äºå‰å¸åœ¨å›½å†…ä¹Ÿæœ‰å¤§é‡ä¸šåŠ¡ï¼Œæœ‰ä¸ªåŒäº‹ç»å¸¸ä¼šå»æ­¦æ±‰å‚ä¸ä¸­å›½å›½æ ‡ GB çš„è§„èŒƒè®¨è®ºï¼Œæˆ‘ä¾¿æé†’ä»–è¦å°å¿ƒã€æœ€è¿‘è¦é¿å…å»æ­¦æ±‰ï¼Œè¿™æ³¢ç–«æƒ…å¯èƒ½ä¼šæŒºä¸¥é‡çš„ã€‚ä½†å†³ç­–ä¹Ÿä¸æ˜¯ä»–å®šçš„ï¼Œä»–ä¹Ÿåªèƒ½è°¢è°¢æˆ‘çš„æé†’ï¼Œè‹¥æ˜¯ä¸Šçº§å‘ä¸‹æ¥è¯ï¼Œè¯¥å»è¿˜æ˜¯è¦å»çš„ã€‚åæ¥ç”±äºå°åŸï¼Œåç»­çš„ä¼šè®®è®¡åˆ’ä¹Ÿå°±å–æ¶ˆäº†ã€‚ åˆ°äº†ä¸€æœˆæœ«ï¼Œå›½å†…å·²ç»å¤§è§„æ¨¡å°åŸï¼ŒåŸé™…æ—…è¡Œéƒ½è¦è¿›è¡Œå¤šæ—¥çš„éš”ç¦»ã€‚åœ¨å®¶äººçš„åŠè¯´ä¸‹ï¼Œå¥³æœ‹å‹å’Œæˆ‘ä¸€å•†é‡ï¼ŒæŠŠå›å›½çš„æœºç¥¨é€€äº†ï¼Œè¿™æ ·æ²¡é‚£ä¹ˆå¤šéº»çƒ¦å’ŒæŠ˜è…¾ã€‚æ²¡æƒ³åˆ°æ›´å¤šçš„äº‹æƒ…è¿˜åœ¨ç­‰ç€æˆ‘ä»¬ã€‚ æ»‘ç¨½ æ—¢ç„¶ä¸æ‰“ç®—å›å›½äº†ï¼Œèµ·ç ä¸‰æœˆä»½æ˜¯ç©ºå‡ºæ¥äº†ï¼Œæˆ‘ä»¬å°±æ‰“ç®—å…ˆå»æ„å¤§åˆ©ç©ä¸€æ®µæ—¶é—´ã€‚è¡Œç¨‹è¿˜æ²¡ç¡®å®šä¸‹æ¥ï¼Œåˆ°äº†äºŒæœˆåˆï¼Œå¿½ç„¶æ„å¤§åˆ©å˜æˆäº†ç–«åŒºï¼ŒåŒ—æ–¹å¾ˆå¤šåŸå¸‚ç¡®è¯Šé£™å¢ï¼Œå¾ˆå¤šåŒºåŸŸè€ƒè™‘å°åŸã€‚äºæ˜¯è¿™ä¸€è¡Œç¨‹å°±æç½®äº†ä¸‹æ¥ã€‚ è½¬å¿µä¸€æƒ³ä¸‰æœˆåˆ°ç‘å£«å»ååç«è½¦ã€æ»‘æ»‘é›ªä¹Ÿå¯ä»¥ï¼Œäºæ˜¯å‡†å¤‡è®¢ä¸‰æœˆçš„ç¥¨ã€‚å¿½ç„¶çˆ†å‡ºäº†ç‘å£«ç¡®è¯Šå¼€å§‹ä¸Šå‡ã€è¿˜è¢«å‘¨è¾¹å›½å®¶æŠ¢äº†å„ç§é˜²ç–«ç‰©èµ„ã€‚ é€€è€Œæ±‚å…¶æ¬¡ï¼Œæˆ‘ä»¬å»æ³¢å°”å¤šå’Œé‡Œæ˜‚æ€»å¯ä»¥äº†å§ï¼Œç»“æœç¬¬äºŒå¤©æ³¢å°”å¤šå°±å‘ç°ä¸€ä¾‹ä»æ­¦æ±‰è€Œæ¥çš„ç¡®è¯Šã€é‡Œæ˜‚ç”±äºä¸´è¿‘æ„å¤§åˆ©ä¹Ÿè¿›å…¥äº†å¢é•¿æœŸã€‚ å„ç§æ—…è¡Œæ–¹æ¡ˆè¢«ç—…æ¯’å¦å†³çš„æƒ…å†µä¸‹ï¼Œæ—¶é—´æ¥åˆ°äº†äºŒæœˆæœ«ï¼Œæˆ‘è¦å›åˆ°å­¦æ ¡æ‰€åœ¨åœ°å¸®å¥³æœ‹å‹æ¬å®¶ã€‚å‡ºè¡Œå‰ä¸€å¤©ï¼Œæ–°é—»çˆ†å‡ºå­¦æ ¡æ‰€åœ¨åœ°æœ‰æ•°ä¾‹ç¡®è¯Šã€æº¯æºä¸æ˜ã€ææˆä¸ºæ³•å›½ç¬¬ä¸€ä¸ªçˆ†å‘ç‚¹ã€‚ å†åŠ ä¸Šåœ£è¯æœŸé—´å»çš„å·´å¡ç½—é‚£å’Œé©¬å¾·é‡Œçš„çˆ†å‘ï¼Œæˆ‘è§‰å¾—è‡ªå·±å¯¹ç–«æƒ…çš„çˆ†å‘çœŸçš„æ˜¯æŒ‡å“ªæ‰“å“ªã€‚å•Šï¼ŒåŸæ¥å°ä¸‘ç«Ÿæ˜¯æˆ‘è‡ªå·±ã€‚ æ··ä¹± æ—¶é—´æ¥åˆ°ä¸‰æœˆä¸­æ—¬ï¼Œåœ¨æ³•å›½å°åŸçš„å‰ä¸€å¤©ï¼Œåªå¸¦äº†ä¸€ç‚¹ç‚¹è¡Œæå°±ç¦»å¼€äº†ä½æ‰€ï¼Œé£åˆ°æ–°å­¦æ ¡æ‰€åœ¨åŸå¸‚é‚£è¾¹ç§Ÿåˆ°çš„æˆ¿å­ï¼ˆè¿™ç‚¹è¶³å¤Ÿå¹¸è¿XDï¼‰ã€‚ä½†æ–°å­¦æ ¡çš„è¡Œæ”¿éƒ¨é—¨æš‚æ—¶è¿œç¨‹ï¼ˆç›´æ¥ç­‰äºä¸å·¥ä½œï¼‰ï¼Œå¯¼è‡´å…¥å­¦æ‰‹ç»­æ²¡æ³•åŠç†ï¼Œé¢„è®¡åˆ°äº”æœˆåº•æ‰èƒ½é‡å¼€ã€‚ æ—¢ç„¶å…¥å­¦å»¶åäº†ï¼Œå°±æ‰“ç®—å…ˆæ‰¾ç‚¹äº‹æƒ…åšã€‚äºæ˜¯ä¸‰æœˆåˆå¼€äº†äº›å¼€æºé¡¹ç›®ã€è¿˜æœ‰åœ¨å’Œåˆä½œè€…çš„é¡¹ç›®é‡Œå†™å†™ä»£ç ï¼›å››æœˆä»½é‡æ–°æ¡èµ·äº† B ç«™å¸å·ï¼Œåšä¸€äº› KDE ç¤¾åŒºçš„å®£ä¼ å·¥ä½œã€æ°´äº†å¥½ä¸€äº›è§†é¢‘ï¼›äº”æœˆè½¬ä¸–äº†æŸå¢ƒå¤–ç¤¾äº¤è´¦å·ï¼Œåˆ¶é€ ä¸€äº›æš´è®ºï¼›å…­æœˆä»½åˆå¼€å§‹æ‹¿ç€ç‹—å®¶çš„èµ„åŠ©æ‰“å·¥ã€‚ å¹¸è¿çš„æ˜¯å¥³æœ‹å‹ä¸´æ—¶ç­¾ä¹Ÿä¸‹æ¥äº†ï¼Œå¯ä»¥å’Œæˆ‘ä¸€èµ·å‘†ä¸€å¹´ï¼Œä¸è‡³äºå¤ªè¿‡å­¤å•ã€‚ä½†ç”±äºä¸æ˜¯å½“åœ°å­¦æ ¡æ¯•ä¸šçš„å­¦ç”Ÿï¼Œå¥¹ä¹Ÿéœ€è¦æ‰¾åˆ°å·¥ä½œæˆ–è€…ç»“å©šæ‰èƒ½æŠŠç­¾è¯ç»­ä¸‹å»ã€‚å¯æƒœä¼¼ä¹å½“åœ°æ‹›äººä¹Ÿä¸æ˜¯å¾ˆå¤šï¼Œæ‰¾æœ‹å‹å†…æ¨äºšéº»çš„æœºä¼šä¹Ÿå› ä¸ºç»éªŒå’Œæ–¹å‘çš„åŸå› è‰è‰æ”¶åœºã€‚åæ¥æ€»ç»“å‘ç°ï¼Œå¤æ‚ç³»ç»ŸçœŸçš„ä¸èƒ½ç®—æ˜¯ä¸€ä¸ªå¥½æ‰¾å·¥ä½œçš„ä¸“ä¸šã€‚ å…­æœˆåˆï¼Œç»ˆäºå®Œæˆä¸€å¤§å † paperwork é¡ºåˆ©å…¥å­¦ï¼Œç„¶åäº‹æƒ…çªç„¶å°±å¤šäº†èµ·æ¥ï¼šåˆä½œè€…çš„é¡¹ç›®ï¼›è‡ªå·±çš„ç§‘ç ”å·¥ä½œï¼›èµšç‹—å®¶èµ„åŠ©çš„æš‘æœŸæ‰“å·¥ï¼›ç»™å¥³æœ‹å‹è®²è®¡ç®—æœºå·¥ç¨‹ã€ç®—æ³•ã€å‰ç«¯ ReactJSã€åç«¯ Javaï¼›è¿˜æœ‰ä¹‹å‰åœ¨å„ä¸ªå¹³å°æŒ–äº†çš„å‘ã€‚ å’Œåˆä½œè€…çš„ä¸Šä¸€ä¸ªé¡¹ç›®æŠ•äº†ä¸ªä»–ä»¬é¢†åŸŸçš„é¡¶åˆŠï¼Œæœ‰å¾ˆå¤šä¿®æ”¹æ„è§ï¼Œç¨‹åºä¹Ÿè·Ÿç€æ„è§æ”¹ï¼Œåªèƒ½æ„Ÿæ…¨é¡¶åˆŠçš„ reviewer å°±æ˜¯è®¤çœŸè´Ÿè´£ä¸”ä¸“ä¸šï¼›è‡ªå·±çš„å·¥ä½œä¹Ÿé€æ¸å…¥é—¨ï¼Œä½†æ¯å¤©å¼€å§‹ push è‡ªå·±èµ¶å¿«å‡ºæˆæœï¼›æš‘æœŸæ‰“å·¥ä¹Ÿè¦ä¿è¯ä¸€å®šçš„å·¥ä½œæ—¶é—´å’Œå·¥ä½œé‡ï¼›è€Œå¥³æœ‹å‹é‚£è¾¹å› ä¸ºç ”ç©¶ç”Ÿä¸»è¦æ˜¯å»ºæ¨¡ã€åˆ†æï¼Œå¤ªä¹…æ²¡æœ‰æ¥è§¦è®¡ç®—æœºå·¥ç¨‹ç›¸å…³çš„ä¸œè¥¿ï¼Œå¾ˆå¤šçŸ¥è¯†å·²ç»å¿˜è®°äº†ï¼Œäºæ˜¯éœ€è¦ä¸€ç‚¹ä¸€ç‚¹ä»å¤´å¼€å§‹æ¢³ç†ï¼›è‡³äºå¹³å°æŒ–çš„å‘ï¼Œæ— éå°±æ˜¯åšä¸€äº›ç¿»è¯‘å·¥ä½œã€å­¦ Rustã€å­¦ k8s ç­‰ã€‚åœ¨è¿œç¨‹å·¥ä½œæœŸé—´ï¼Œç”Ÿæ´»ä¸å·¥ä½œçš„ç•Œé™å˜å¾—æ¨¡ç³Šï¼Œå¤§é‡çš„å·¥ä½œç§¯å‹å°±éå¸¸å®¹æ˜“é¡¾æ­¤å¤±å½¼ï¼Œå¼‚å¸¸çš„æ··ä¹±å°±ç”±æ­¤å¼€å§‹ï¼Œæ¯å¤©æ³¡åœ¨ç”µè„‘å‰åå¤šä¸ªå°æ—¶ï¼Œç¼ºä¹ç¤¾äº¤ï¼Œè„¾æ°”ä¹Ÿæ¸æ¸å˜å·®ã€‚ å‹åŠ›ä¹Ÿæ…¢æ…¢ç§¯æ”’äº†èµ·æ¥ï¼Œä½†æ€»æœ‰çˆ†å‘çš„æ—¶å€™ï¼Œäºæ˜¯åœ¨å…«æœˆåº•åˆ°ä¹æœˆåº•çš„å‘¨æœ«ï¼Œå¼€å§‹æ²¡æ—¥æ²¡å¤œçš„æ‰“æ¸¸æˆï¼šå…ˆæ˜¯ã€ŠGTA: Vã€‹å’Œã€Šé©¬é‡Œå¥¥ï¼šå¥¥å¾·èµ›ã€‹ã€‚æ¥ç€ã€ŠNier: Automataã€‹æˆäº†æ•°å¹´æ²¡æœ‰ç©è¿‡å¤§ä½œçš„è‡ªå·±å®£æ³„çš„å‡ºå£ï¼Œå…ˆæ˜¯ä¸‰å‘¨ç›®é€šå…³ï¼Œç„¶åæ˜¯æ”¯çº¿ï¼Œæ”¯çº¿æœ‰ä»»åŠ¡ä¾èµ–äºæ€ªç‰©å›¾é‰´æ”¶é›†å’Œæ­¦å™¨æœé›†ï¼Œäºæ˜¯åˆ·äº†å¥½å‡ ä¸ª 100% å‡ºæ¥ã€‚å› ä¸ºç¼ºä¹ç¡çœ ï¼Œæ¸æ¸åˆ†ä¸æ¸…æ¸¸æˆå’Œç°å®ï¼Œå†…å¿ƒäº§ç”Ÿäº† â€œè¿™ä¸€åˆ‡éƒ½æ¯«æ— æ„ä¹‰â€ çš„æƒ³æ³•ã€‚å†åŠ ä¸Šå½“æ—¶å…¨ä¸–ç•Œçš„æ··ä¹±ï¼Œè®©æˆ‘è§‰å¾—äººç±»æœ€ç»ˆè¿˜æ˜¯ä¼šå› ä¸ºè‡ªå·±ç­äº¡çš„ï¼Œè‡ªå·±åšä»€ä¹ˆéƒ½æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚ ä¹æœˆåº•çš„æ—¶å€™ï¼Œå¼€å§‹è¯¦ç»†ç ”ç©¶å¦‚ä½•å†™æ›´å¥½çš„ paperã€‚ç–¯ç‹‚çš„è‡ªæˆ‘å¦å®šå’Œå¯¹è¿™ä¸ªä¸–ç•Œçš„å¦å®šä½¿æˆ‘æ¶ˆæåœ°é¢å¯¹ã€‚åæœˆåº•çš„æ—¶å€™ï¼Œå‡†å¤‡å‘æ–‡çš„ä¸€ä¸ªç‚¹å­ç¡®å®šäº†ä¸‹æ¥ï¼Œäºæ˜¯æ¨è¿Ÿäº†å…¶ä»–äº‹æƒ…ï¼Œä¸“å¿ƒåšè¿™ä¸€ä»¶äº‹ã€‚ æ··ä¹±é€æ¸æ¶ˆå¤±ï¼Œå¤§è„‘ä¹Ÿå¼€å§‹æ”¾æ¾ï¼Œå¼€å§‹è€ƒè™‘è‡ªå·±çš„å·¥ä½œä»¥å¤–ã€å´åŒæ ·é‡è¦çš„äº‹æƒ…ã€‚ å±€ä¿ƒ è¿œè·ç¦»æ¬å®¶ç•™ä¸‹äº†å¾ˆå¤šä¸œè¥¿ï¼ŒåŒ…æ‹¬ä¹‹å‰åœ¨å·´é»çš„æˆ¿å­çš„åˆçº¦ã€‚æ³•å›½åˆæ—¶ä¸æ—¶å°åŸã€é™åˆ¶æ—…è¡Œè·ç¦»ã€é™åˆ¶å‡ºå…¥å¢ƒï¼Œå¯¼è‡´æˆ‘æœ¬äººæ²¡æ³•å†é£å›å»æ‹¿è¡Œæå’Œé€€æˆ¿ï¼Œäºæ˜¯å°±æ‹œæ‰˜æœ‹å‹å¸®æˆ‘å®Œæˆé€€æˆ¿ã€‚åŒ†åŒ†å¿™å¿™ä¹‹ä¸‹ï¼Œä¸¢æ‰äº†å¾ˆå¤šä¸œè¥¿ï¼Œæ¯”å¦‚ç§¯æ”’å¤šå¹´çš„ç®—æ³•ç¬”è®°ã€æ¯”å¦‚å®œå®¶å°é²¨é±¼ã€‚æœ€åæŠ½äº†ä¸€å‘¨ï¼Œè¶ç€æ³•å›½æ²¡å°åŸï¼Œé£äº†ä¸€ä¸ªå¾€è¿”ï¼Œä»æœ‹å‹é‚£é‡Œæ‹¿èµ°äº†è¡Œæã€‚è¡Œæå¾ˆå¤šï¼Œåœ¨å·´é»ä¸Šåœ°é“çš„æ—¶å€™ä¸å¤ªæ–¹ä¾¿ï¼Œå·®ç‚¹è¢«é»‘å“¥å“¥æŠ¢äº†ã€‚æœ€åæ‰˜è¿å®Œè¡Œæï¼Œåœ¨æœ€åæ—¶åˆ»èµ¶ä¸Šäº†é£æœºã€‚ è€Œå‡†å¤‡å‘æ–‡çš„é‚£ä¸ª idea ç¡®å®šäº†ä¸‹æ¥ä¹‹åï¼Œéœ€è¦åœ¨ä¸€ä¸ªæœˆçš„æ—¶é—´å†…å®Œæˆæ•´ä¸ªæ–‡ç« ç›¸å…³çš„å®éªŒã€æ–‡ç« çš„ä¹¦å†™å’Œä¿®æ”¹ï¼Œä»é›¶å¼€å§‹æ„å»ºè¿™ä¸€åˆ‡ã€‚å¿…é¡»åšçš„äº‹æƒ…éƒ½æ˜¯å‹ç€ deadline å®Œæˆï¼Œè¿™è®©æˆ‘æ€€ç–‘è‡ªå·±æ˜¯å¦æ¥äº†å¤ªå¤šäº†å·¥ä½œï¼Œäº¦æˆ–æ˜¯èƒ½åŠ›å¼€å§‹é€€åŒ–ã€‚ åäºŒæœˆåˆèµ¶å®Œæœ€åä¸€ä¸ªï¼ŒçŒ›ç„¶å‘ç°ç¦»å¥³æœ‹å‹ä¸´æ—¶ç­¾è¯è¿‡æœŸå·²ç»æ²¡æœ‰å¤šä¹…äº†ï¼Œå»æ‰åœ£è¯èŠ‚å‰åçš„å‡æœŸï¼Œå¥¹åŠæ—¶æ‰¾åˆ°å·¥ä½œçš„å¯èƒ½æ€§å·²ç»é™åˆ°äº†ä¸€ä¸ªæä½çš„æ°´å¹³ã€‚è€ƒè™‘ç»“å©šåˆæ­£é‡åˆ°å¸‚æ”¿å…å»¶ç¼“æ¥å¾…ï¼Œé¢„ä¼°äº†ä¸€ä¸‹æ—¶é—´ï¼Œåº”è¯¥æ˜¯èµ¶ä¸ä¸Šäº†ï¼›å†è€…è¯´ï¼Œè¿™ç§æƒ…å†µä¸‹å©šç¤¼ä¹Ÿä¸å¥½åŠï¼Œè‰è‰äº†äº‹æ€»è§‰å¾—å¯¹ä¸èµ·å¥¹ã€‚ä¸ºäº†ä¸å‘ç”Ÿé»‘æˆ·çš„æƒ…å†µå¯¼è‡´é»‘åå•ï¼Œç­‰ç–«æƒ…ç»“æŸä¹‹åå¥½å†å›æ¥ï¼Œæœ€åå†³å®šè®©ä¸¤å¹´éƒ½æ²¡å›æˆå®¶çš„å¥³æœ‹å‹å…ˆå›å®¶ç©ä¸€æ®µæ—¶é—´ã€‚ å„ç§å±€ä¿ƒçš„äº‹ä»¶å’Œäº‹ä»¶èƒŒæ™¯ä¸‹å±€é™çš„é€‰æ‹©ï¼Œæ„æˆäº†è¿™ä¸€å¹´ã€‚ å°¾å£° æ€»çš„çœ‹ä¸‹æ¥ï¼Œè¿™ä¸€å¹´æˆ‘çš„ä¸»åŸºè°ƒå’Œä¸–ç•Œçš„æ€»ä½“åŸºè°ƒä¿æŒäº†ä¸€è‡´ï¼šæ··ä¹±ã€‚è€Œä¸”å¦‚åŒæ— å¤´è‹è‡ï¼Œä¸çŸ¥ä½•å¤„å»ã€‚ åŸæœ¬å’Œå¥³æœ‹å‹å¤šå»å‡ ä¸ªå›½å®¶ã€åœ°åŒºç©çš„è®¡åˆ’å®Œå…¨è½ç©ºï¼Œåœ¨è¿™ä¸€å¹´ï¼Œæ¯å¤©å°±æ˜¯å‘†åœ¨å®¶é‡Œï¼Œå†™ä»£ç ã€ç©æ¸¸æˆã€åšé¥­ã€‚ åœ¨ä¸€å¹´çš„æœ€åï¼Œå’Œå¥³æœ‹å‹åˆ°æµ·è¾¹ç©ä¸€ç©ï¼Œå®Œå…¨ä¸¢ä¸‹å·¥ä½œæ”¾ç©ºå‡ å¤©ï¼Œä¼¼ä¹åˆæ‰¾å›äº†å¤šå¹´å‰çš„è‡ªå·±ã€‚ ä½†ä¸–ç•Œå†ä¹±ï¼Œç”Ÿæ´»å†éš¾ï¼Œæ€»æœ‰ä¸€äº›å°ç¡®å¹¸ï¼Œä¹Ÿå®Œæˆäº†ä¸€äº›äº‹æƒ…ã€å­¦åˆ°äº†ä¸€äº›ä¸œè¥¿ï¼Œä¹Ÿç®—æœ‰äº†æˆé•¿ã€‚ ä»£ç  å†™äº† iOS ç‰ˆæœ¬çš„ KDE Connectï¼Œç»™å…¨å¹³å°å¡«å¥½äº†å‘ã€‚ ç»™ embox åµŒå…¥å¼ OSã€fcitx è¾“å…¥æ¡†æ¶ã€libpinyin åŠå…¶ ibus ç»‘å®šã€homebrew é¡¹ç›®è´¡çŒ®äº†ä»£ç ã€‚ å­¦äº† Rustã€Haskellï¼ˆæœªå®Œå¾…ç»­ï¼‰ï¼Œå¼€äº†ä¸€ä¸ªç®€å•è§£é‡Šå™¨é¡¹ç›®å’Œä¸€ä¸ª emulator é¡¹ç›®ç»ƒç»ƒæ‰‹ï¼›å­¦äº† Juliaã€k8s å´ä¸çŸ¥é“å¯ä»¥ç”¨åœ¨å“ªï¼›ç ”ç©¶äº† macOS çš„è·¨è¿›ç¨‹é€šä¿¡ XPCã€è·¨å¹³å°ç»˜å›¾æ ‡å‡† EGL å¹¶å†™äº†äº› Hello Worldã€‚ äººé™… åœ¨ç½‘ä¸Šè®¤è¯†äº†å¾ˆå¤šäººï¼Œè™½ç„¶è§‰å¾—æœ‰ä¸€éƒ¨åˆ†äººå¯èƒ½å’Œè‡ªå·±çš„ä¸‰è§‚ä¸æ˜¯å¾ˆåˆï¼Œä½†æˆ‘è¿˜æ˜¯è§‰å¾—äººçš„å¤šæ ·æ€§æ‰æ˜¯è¿™ä¸ªç¤¾ä¼šæœ€ç²¾å½©çš„åœ°æ–¹ï¼Œæ­£å¦‚ç”Ÿç‰©çš„å¤šæ ·æ€§æ‰æ˜¯åœ°çƒçš„å¥‡è¿¹ã€‚äºæ˜¯å¿ƒç†ä¸ŠæŠŠè‡ªå·±å®šä½æˆäººç±»è§‚å¯Ÿè€…ï¼Œçœ‹å¾…ä¸€åˆ‡å°±å®Œå…¨å¹³å’Œäº†ä¸‹æ¥ã€‚æœ€åè¿™ä¸ªæœˆï¼Œç”šè‡³æŠŠæœ¬å°±ä¸ªä½æ•°çš„ Block å’Œ Mute åˆ—è¡¨å…¨éƒ¨æ¸…ç©ºã€‚ é€šè¿‡æ½œæ°´çœ‹ç¾¤å‹è®¨è®ºæ¥é¢†æ‚Ÿ programming languageã€è¿«å®³ç¾¤å‹æˆäº†æ¯å¤©å¿…åšçš„å¿«ä¹çš„äº‹ï¼Œè¿™ä¹Ÿå¾ˆå¤§ç¨‹åº¦ä¸Šå¸®åŠ©æˆ‘ã€‚è™½ç„¶ä¾ç„¶æ€»ä¸çŸ¥é“æ€ä¹ˆä¿æŒå¥½å°ºåº¦ï¼Œå¸Œæœ›æœ‰è§‰å¾—è‡ªå·±è¢«å†’çŠ¯åˆ°çš„æ¨/ç¾¤å‹ç›´æ¥ pm æˆ‘å‘€ã€‚ æœ€åï¼Œå°±å½“å¾—åˆ°çš„å¤±å»çš„éƒ½æ˜¯å‘½ã€‚ äººå˜›ï¼Œä¸€å¹´ä¸€å¹´è¿‡å¾—å¾ˆå¿«çš„ï¼Œå¿«ä¹å°±å¥½äº†ã€‚","categories":[{"name":"Dairy","slug":"Dairy","permalink":"https://blog.inoki.cc/categories/Dairy/"}],"tags":[{"name":"ä¸­æ–‡","slug":"ä¸­æ–‡","permalink":"https://blog.inoki.cc/tags/ä¸­æ–‡/"},{"name":"private","slug":"private","permalink":"https://blog.inoki.cc/tags/private/"}]},{"title":"ã€è¯‘ã€‘GBDK æ‰‹æŸ„","slug":"GBDK-Joypad-Tutorial","date":"2020-09-19T22:41:23.000Z","updated":"2025-03-08T09:40:48.564Z","comments":true,"path":"2020/09/19/GBDK-Joypad-Tutorial/","link":"","permalink":"https://blog.inoki.cc/2020/09/19/GBDK-Joypad-Tutorial/","excerpt":"","text":"åŸæ–‡é“¾æ¥ï¼šhttps://gbdev.gg8.se/wiki/articles/GBDK_Joypad_Tutorial ä»‹ç» æœ¬æ•™ç¨‹æ—¨åœ¨è¯¦ç»†ä»‹ç»å°†æ‰‹æŸ„ä¸ GBDK é…åˆä½¿ç”¨çš„æ–¹æ³•ã€‚ å·¥å…· æ‚¨å°†éœ€è¦ï¼šGBDKï¼Œæ–‡æœ¬ç¼–è¾‘å™¨ï¼ŒGame Boy Tile Designer å’Œä»¿çœŸå™¨ï¼ˆå»ºè®®ä½¿ç”¨ BGBï¼Œå®ƒæœ‰è®¸å¤šè°ƒè¯•åŠŸèƒ½ï¼‰ä»¥åŠä»»ä½•æ°´å¹³çš„ C çŸ¥è¯†ã€‚ å¦‚æœéœ€è¦ï¼Œè¯·æ›¿æ¢æ‚¨å–œæ¬¢çš„å·¥å…·ï¼Œä½†æ˜¯æœ¬æ•™ç¨‹å‡å®šæ‚¨å…·æœ‰ä¸Šé¢åˆ—å‡ºçš„å·¥å…·ã€‚ joypad() å‡½æ•° GBDK çš„ gb.h å…·æœ‰ Joypad() å‡½æ•°ï¼Œè¯¥å‡½æ•°è¿”å›æ‰‹æŸ„çš„çŠ¶æ€ã€‚ joypad() å‡½æ•°å¯ä»¥è¿”å›ä»¥ä¸‹è¾“å…¥çš„çŠ¶æ€ï¼š 12345678J_STARTJ_SELECTJ_BJ_AJ_DOWNJ_UPJ_LEFTJ_RIGHT Program 1: è¿”å› joypad() çŠ¶æ€ è®©æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªç®€å•çš„ç¨‹åºæ¥åœ¨æŒ‰ä¸‹æŒ‰é’®æ—¶è¿”å› joypad() çš„çŠ¶æ€ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546#include &lt;stdio.h&gt; // include this file for the printf() function#include &lt;gb/gb.h&gt; // include this file for Game Boy functionsvoid main(void)&#123; while(1) &#123; switch(joypad()) &#123; case J_RIGHT : // If joypad() is equal to RIGHT printf(\"Right!\\n\"); delay(100); break; case J_LEFT : // If joypad() is equal to LEFT printf(\"Left!\\n\"); delay(100); break; case J_UP : // If joypad() is equal to UP printf(\"Up!\\n\"); delay(100); break; case J_DOWN : // If joypad() is equal to DOWN printf(\"Down!\\n\"); delay(100); break; case J_START : // If joypad() is equal to START printf(\"Start!\\n\"); delay(100); break; case J_SELECT : // If joypad() is equal to SELECT printf(\"Select!\\n\"); delay(100); break; case J_A : // If joypad() is equal to A printf(\"A!\\n\"); delay(100); break; case J_B : // If joypad() is equal to B printf(\"B!\\n\"); delay(100); break; default : break; &#125; &#125; &#125; Program 2: ä½¿ç”¨ waitpad() å’Œ waitpadup() æ‚¨è¿˜å¯ä»¥ä½¿ç”¨å¦å¤–ä¸¤ä¸ªæ¸¸æˆæ‰‹æŸ„çš„å‡½æ•°ï¼š 12waitpad() // This function waits for a button to be pressed.waitpadup() // This function waits for all buttons to be released. è®©æˆ‘ä»¬åœ¨ä¸€ä¸ªç®€å•çš„ç¨‹åºä¸­åŒæ—¶ä½¿ç”¨ waitpad() å‡½æ•°å’Œ waitpadup() å‡½æ•°ï¼š 1234567891011121314151617181920#include &lt;stdio.h&gt; // include this file for the printf() function#include &lt;gb/gb.h&gt; // include this file for Game Boy functionsvoid main(void)&#123; while(1) &#123; printf(\"Please press A\\n\"); waitpad(J_A); // waitpad() is waiting for the A button to be pressed. printf(\"You pressed A! Cool!\\n\\n\"); printf(\"Hold down the LEFT button\\n\"); waitpad(J_LEFT); // waitpad() is waiting for the LEFT button to be pressed. printf(\"You're holding down LEFT!\\n\"); waitpadup(); // waitpadup() is waiting for all buttons to be depressed but you have to hold down LEFT to get here so it is // waiting on LEFT to be depressed. printf(\"You've released LEFT\\n\\n\\n\"); &#125; &#125; Program 3: åœ¨å±å¹•ä¸Šç§»åŠ¨ç²¾çµ ç°åœ¨ï¼Œè®©æˆ‘ä»¬ä½¿ç”¨ joypad() å‡½æ•°åœ¨å±å¹•ä¸Šç§»åŠ¨ç²¾çµã€‚å¦‚æœæ‚¨å¯¹ GBDK Sprite ä¸ç†Ÿæ‚‰ï¼Œåˆ™éœ€è¦æŸ¥çœ‹ GBDK Sprite æ•™ç¨‹ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950#include &lt;gb/gb.h&gt; // include this file for Game Boy functions//Created with GBTD, exported to .c with options from: 0, to: 0, label: smileunsigned char smile[] =&#123; 0x3C,0x3C,0x42,0x42,0x81,0x81,0xA5,0xA5, 0x81,0x81,0x81,0xA5,0x42,0x5A,0x3C,0x3C&#125;;void main()&#123; int x = 55; // Our beginning x coord int y = 75; // Our beginning y coord SPRITES_8x8; set_sprite_data(0, 0, smile); set_sprite_tile(0, 0); move_sprite(0, x, y); // Move sprite to our predefined x and y coords SHOW_SPRITES; while(1)&#123; if(joypad()==J_RIGHT) // If RIGHT is pressed &#123; x++; move_sprite(0,x,y); // move sprite 0 to x and y coords delay(10); &#125; if(joypad()==J_LEFT) // If LEFT is pressed &#123; x--; move_sprite(0,x,y); // move sprite 0 to x and y coords delay(10); &#125; if(joypad()==J_UP) // If UP is pressed &#123; y--; move_sprite(0,x,y); // move sprite 0 to x and y coords delay(10); &#125; if(joypad()==J_DOWN) // If DOWN is pressed &#123; y++; move_sprite(0,x,y); // move sprite 0 to x and y coords delay(10); &#125; &#125;","categories":[{"name":"GBDK","slug":"GBDK","permalink":"https://blog.inoki.cc/categories/GBDK/"}],"tags":[{"name":"ä¸­æ–‡","slug":"ä¸­æ–‡","permalink":"https://blog.inoki.cc/tags/ä¸­æ–‡/"},{"name":"GBDK","slug":"GBDK","permalink":"https://blog.inoki.cc/tags/GBDK/"}]},{"title":"ã€è¯‘ã€‘GBDK Sprite ç²¾çµ","slug":"GBDK-Sprite-Tutorial","date":"2020-09-19T21:41:23.000Z","updated":"2025-03-08T09:40:48.565Z","comments":true,"path":"2020/09/19/GBDK-Sprite-Tutorial/","link":"","permalink":"https://blog.inoki.cc/2020/09/19/GBDK-Sprite-Tutorial/","excerpt":"","text":"åŸæ–‡é“¾æ¥ï¼šhttps://gbdev.gg8.se/wiki/articles/GBDK_Sprite_Tutorial ä»‹ç» æœ¬æ•™ç¨‹æ—¨åœ¨ä»‹ç»ä¸€ç§å·¥ä½œæµç¨‹ï¼Œèƒ½å¤Ÿæ˜¾ç¤ºå¤šä¸ªç²¾çµå’Œè®¾ç½®åŠ¨ç”»ã€‚ä¸ºäº†ä½¿å®ƒå°½å¯èƒ½åœ°æ˜“äºè®¿é—®ï¼Œæˆ‘å‡è®¾æ‚¨ä¸äº†è§£ C è¯­è¨€ã€‚å¦‚æœæ‚¨ä¸æƒ³åœ¨å¼€å§‹ä¹‹å‰çš„å‡ ä¸ªå°æ—¶å†…æµè§ˆå‚è€ƒæ–‡ä»¶ï¼Œè¿™å°±æ˜¯ä¸ºæ‚¨å‡†å¤‡çš„ã€‚ å·¥å…· æ‚¨å°†éœ€è¦ï¼šGBDKï¼Œæ–‡æœ¬ç¼–è¾‘å™¨ï¼ŒGame Boy Tile Designer å’Œä»¿çœŸå™¨ï¼ˆå»ºè®®ä½¿ç”¨ BGBï¼Œå®ƒæœ‰è®¸å¤šè°ƒè¯•åŠŸèƒ½ï¼‰ä»¥åŠä»»ä½•æ°´å¹³çš„ C çŸ¥è¯†ã€‚ å¦‚æœéœ€è¦ï¼Œè¯·æ›¿æ¢æ‚¨å–œæ¬¢çš„å·¥å…·ï¼Œä½†æ˜¯æœ¬æ•™ç¨‹å‡å®šæ‚¨å…·æœ‰ä¸Šé¢åˆ—å‡ºçš„å·¥å…·ã€‚ ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºç“¦å— è¿è¡Œ GBTDã€‚å•å‡»è§†å›¾ï¼Œå›¾å—å¤§å°ï¼Œ16x16ã€‚ ç»˜åˆ¶å›¾åƒï¼Œå°†å…¶å¤åˆ¶å¹¶ç²˜è´´åˆ°ç¬¬äºŒä¸ªç“¦å—æ’æ§½ä¸­ï¼Œç„¶åè¿›è¡Œæ›´æ”¹ä»¥åˆ¶ä½œä¸¤å¸§åŠ¨ç”»ã€‚ æˆ‘ä»¬å°†åœ¨è¿™äº›ä¹‹é—´æ¥å›åˆ‡æ¢ã€‚ å•å‡»æ–‡ä»¶ï¼Œå¯¼å‡ºåˆ°ï¼Œå°† Type æ›´æ”¹ä¸º GBDK C æ–‡ä»¶ï¼ˆ* .cï¼‰ï¼Œå¹¶å°† To æ›´æ”¹ä¸º1ã€‚æˆ‘è¿˜å°†æ–‡ä»¶åå’Œæ ‡ç­¾æ›´æ”¹ä¸ºâ€œ smileâ€ã€‚ ç‚¹å‡»ç¡®å®šã€‚ è¿™å°†åˆ›å»ºä¸€ä¸ª .c å’Œ .h æ–‡ä»¶ã€‚.c æ–‡ä»¶åº”å¦‚ä¸‹æ‰€ç¤ºï¼š 123456789101112131415161718192021//lots of commentsunsigned char smile[] =&#123; 0x0F,0x0F,0x30,0x30,0x40,0x40,0x40,0x40, 0x84,0x84,0x84,0x84,0x84,0x84,0x84,0x84, 0x84,0x84,0x84,0x84,0x80,0x80,0x80,0x80, 0x44,0x44,0x43,0x43,0x30,0x30,0x0F,0x0F, 0xF0,0xF0,0x0C,0x0C,0x02,0x02,0x02,0x02, 0x21,0x21,0x21,0x21,0x21,0x21,0x21,0x21, 0x21,0x21,0x21,0x21,0x01,0x01,0x01,0x01, 0x22,0x22,0xC2,0xC2,0x0C,0x0C,0xF0,0xF0, 0x0F,0x0F,0x30,0x30,0x40,0x40,0x40,0x40, 0x84,0x84,0x84,0x84,0x84,0x84,0x84,0x84, 0x84,0x84,0x84,0x84,0x80,0x80,0x80,0x80, 0x44,0x44,0x43,0x43,0x30,0x30,0x0F,0x0F, 0xF0,0xF0,0x0C,0x0C,0x02,0x02,0x02,0x02, 0x01,0x01,0x01,0x01,0x01,0x01,0xF9,0xF9, 0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01, 0x22,0x22,0xC2,0xC2,0x0C,0x0C,0xF0,0xF0&#125;;//more comments å¯è§ï¼ŒGBTE åªæ˜¯å°†åƒç´ è½¬æ¢ä¸ºä»¥æ ‡ç­¾å‘½åçš„æ•°ç»„ã€‚æˆ‘ä»¬å°†åœ¨è¦ç¼–å†™çš„ä»£ç ä¸­åŒ…å« .c æ–‡ä»¶ã€‚ ç¬¬äºŒæ­¥ï¼šset_sprite_data åœ¨å±å¹•ä¸Šç»˜åˆ¶ç²¾çµ GBDK é€šè¿‡ gb.h ä¸­æä¾›çš„ä¸€äº›å‡½æ•°æ¥å¤„ç†ç²¾çµã€‚ å¯åŠ¨æ‚¨çš„æ–‡æœ¬ç¼–è¾‘å™¨ï¼Œå¹¶åŒ…å«å¿…è¦çš„æ–‡ä»¶ï¼š 12#include &lt;gb/gb.h&gt; //Angle brackets check the compiler's include folders#include \"smile.c\" //double quotes check the folder of the code that's being compiled æ¯ä¸ª C è„šæœ¬éƒ½éœ€è¦ä¸€ä¸ªä¸»å‡½æ•°ï¼Œå› æ­¤è¯·åœ¨å…¶ä¸­æ·»åŠ ä»¥ä¸‹å‡½æ•°ä¹‹ä¸€ï¼š 123void main()&#123;&#125; è¿™æ˜¯æˆ‘ä»¬å°†ç¼–å†™æ‰€æœ‰ä»£ç çš„åœ°æ–¹ã€‚ è¿›å…¥ main å‡½æ•°ï¼Œè¾“å…¥ï¼š 12345SPRITES_8x16;set_sprite_data(0, 8, smile);set_sprite_tile(0, 0);move_sprite(0, 75, 75);SHOW_SPRITES; é€è¡Œæ˜¾ç¤ºï¼š å‘Šè¯‰ GBDK ä¸€æ¬¡åŠ è½½ä¸¤ä¸ª 8x8 ç²¾çµï¼Œåˆ¶ä½œä¸€ä¸ª 8x16 ç“¦ç‰‡ ä»é›¶å¼€å§‹ï¼Œå°† 8 ä¸ª 8x8 ç“¦ç‰‡ä» smile æ•°ç»„æ¨å…¥è¿è¡Œä¸­çš„ç²¾çµæ•°æ® å°†å›¾å— 0 è®¾ç½®ä¸ºç²¾çµæ•°æ®ä¸­ç¼–å·ä¸º 0 çš„ç²¾çµ å°†ç²¾çµ 0 ç§»åŠ¨åˆ°è¯¥åæ ‡ è¿™æ˜¯åˆ°ç›®å‰ä¸ºæ­¢çš„å®Œæ•´ä»£ç ï¼š 12345678910#include &lt;gb/gb.h&gt;#include \"smile.c\"void main()&#123; SPRITES_8x16; set_sprite_data(0, 8, smile); set_sprite_tile(0, 0); move_sprite(0, 75, 75); SHOW_SPRITES;&#125; å°†è¯¥æ–‡ä»¶ä¿å­˜ä¸º filename.cï¼Œä½¿ç”¨ lcc ç¼–è¯‘ï¼š/path/to/GBDK/bin/lcc -o gamename.gb filename.cã€‚ è¿è¡Œ BGB å¹¶åŠ è½½ gamename.gbã€‚ Emmmmmmï¼Œè¿™é‡Œåªæœ‰åŠå¼ è„¸ã€‚å¥½å§ï¼Œç”±äº Gameboy åªèƒ½å¤„ç†æœ€å¤§ 8x16 çš„ç“¦å—ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡æŠŠä¸¤ä¸ª 8x16 çš„ç“¦å—ç”»åœ¨ä¸€èµ·æ¥æ„é€ ä¸€ä¸ª 16x16 çš„ã€‚ é¦–å…ˆï¼Œè®©æˆ‘ä»¬çœ‹çœ‹ç²¾çµå’Œå›¾å—å¦‚ä½•å­˜å‚¨åœ¨ Gameboy ä¸Šã€‚ åœ¨ BGB ä¸­ï¼Œæ‚¨å·²ç¼–å†™çš„ rom å·²åŠ è½½å¹¶è¿è¡Œï¼Œå³é”®å•å‡»ï¼Œå°†é¼ æ ‡æ‚¬åœåœ¨ â€œå…¶ä»–â€ ä¸Šï¼Œå•å‡» â€œVRAMæŸ¥çœ‹å™¨â€ã€‚ åœ¨è¿™é‡Œï¼Œæ‚¨å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ä½¿ç”¨ set_sprite_data è®¾ç½®ä¸º 8x8 ç“¦ç‰‡çš„ç²¾çµã€‚æœ€å·¦ä¾§çš„ä¸¤ä¸ªæ•°å­— 0 å’Œ 1 äº®èµ·ï¼Œè¡¨ç¤ºå®ƒä»¬æ­£åœ¨ä½¿ç”¨ä¸­ã€‚æˆ‘ä»¬æƒ³è¦çš„æ˜¯è®¾ç½®ç¬¬äºŒä¸ªå›¾å—ï¼Œå°†å…¶ç”¨è„¸çš„å³åŠéƒ¨åˆ†å¡«å……ï¼Œç„¶åå°†å…¶ä¸å·¦åŠéƒ¨åˆ†å¯¹é½ã€‚ å°†æ­¤æ·»åŠ åˆ°ä»£ç ä¸­ï¼š 12set_sprite_tile(1, 2);move_sprite(1, 75 + 8, 75); åœ¨ VRAM æŸ¥çœ‹å™¨ä¸­è¿›è¡Œè®¡æ•°æ—¶ï¼Œè¯¥é¢çš„å·¦ä¸Šè±¡é™æ˜¯ç²¾çµ 0ï¼Œå·¦ä¸‹è§’æ˜¯ 1ï¼Œå³ä¸Šè§’ä» 2 å¼€å§‹ï¼Œå¹¶ä¸” SPRITES_8x16 è¡Œå°†ä½¿æˆ‘ä»¬è®¾ç½®çš„å›¾å—åŒ…å«ç²¾çµ 3ï¼Œå³ æ‰€æœ‰å››ä¸ªè±¡é™ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬åœ¨å±å¹•ä¸Šæ¿€æ´»äº†ä¸¤ä¸ªç²¾çµï¼Œåˆ†åˆ«æ˜¯ 0 å·å’Œ 1 å· ï¼Œè€Œç²¾çµ 1 æ¯”ç²¾çµ 0 é å³ 8 ä¸ªåƒç´ ï¼Œè¿™æ„å‘³ç€å®ƒå¯ä»¥å®Œç¾æ’åˆ—ä»¥æ˜¾ç¤ºä¸€ä¸ª 16x16 çš„é¢ã€‚ è¯·è®°ä½ï¼Œæ¯æ¬¡ç§»åŠ¨æ­¤ç²¾çµæ—¶ï¼Œéƒ½éœ€è¦å°†ä¸¤ä¸ªéƒ¨åˆ†ä¸€èµ·ç§»åŠ¨ã€‚ ç¼–è¯‘å¹¶è¿è¡Œå®ƒï¼Œç„¶ååœ¨ VRAM æŸ¥çœ‹å™¨ä¸­æŸ¥çœ‹ã€‚ ç¬¬ä¸‰æ­¥ï¼šåŠ¨ç”» æˆ‘ä»¬å°†å®šæ—¶ä½¿ç”¨ set_sprite_tile æ›¿æ¢å›¾å—ã€‚ åœ¨ SHOW_SPRITES ä¹‹ååœ¨ä¸»å‡½æ•°ä¸­ç¼–å†™ä¸€ä¸ª while å¾ªç¯ã€‚æˆ‘ä»¬ä½¿ç”¨ while(1)ï¼Œè¿™æ ·å®ƒä¼šæ°¸è¿œå¾ªç¯ã€‚ 123while(1)&#123;&#125; åœ¨è¯¥å¾ªç¯å†…ï¼Œå°†å›¾å—ç¼–å· 1ï¼ˆè„¸çš„å³ä¾§ï¼‰æ›´æ”¹ä¸ºç²¾çµ 6ï¼ˆæˆ‘ä½¿ç”¨ VRAM æŸ¥çœ‹å™¨è¿›è¡Œè®¡æ•°ï¼‰ã€‚ 1set_sprite_tile(1, 6); å°†å…¶äº¤æ¢å›å»å¹¶å»¶è¿Ÿå‡ ä¸ªæ—¶é—´ï¼Œä»¥ä¾¿å¯ä»¥çœ‹åˆ°æ›´æ”¹ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ä»¥ä¸‹ä»£ç ï¼š 123456while(1)&#123; set_sprite_tile(1, 6); delay(500); set_sprite_tile(1,2); delay(500);&#125; è¿™æ˜¯æ‰€æœ‰å¯ä»¥ç”¨äºå¤åˆ¶å’Œç²˜è´´çš„ä»£ç ï¼š 12345678910111213141516171819#include &lt;gb/gb.h&gt;#include \"smile.c\"void main()&#123; SPRITES_8x16; set_sprite_data(0, 8, smile); set_sprite_tile(0, 0); move_sprite(0, 75, 75); set_sprite_tile(1, 2); move_sprite(1, 75 + 8, 75); SHOW_SPRITES; while(1)&#123; set_sprite_tile(1, 6); delay(500); set_sprite_tile(1,2); delay(500); &#125;&#125; ç¼–è¯‘å¹¶è¿è¡Œå®ƒã€‚æˆåŠŸè¿è¡Œï¼ åœ¨ VRAM æŸ¥çœ‹å™¨ä¸­å®æ—¶è§‚çœ‹å›¾å—åˆ‡æ¢ã€‚ ä¸€ä¸ªæœ‰è¶£çš„æ³¨é‡Šï¼šç”±äºä»…ç²¾çµçš„å³ä¾§å‘ç”Ÿäº†å˜åŒ–ï¼Œå› æ­¤å·¦ä¾§çš„é‡å¤æ˜¯å¤šä½™çš„ã€‚å°†æ¥çš„è¿­ä»£å¯èƒ½ä¼šåˆ é™¤å®ƒä»¥ä¿å­˜æ•°æ®ã€‚æ­¤å¤–ï¼Œåªæœ‰å³ä¸Šè§’çš„å››åˆ†ä¹‹ä¸€ä¼šå‘ç”Ÿå˜åŒ–ï¼Œå› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬ç»˜åˆ¶å››ä¸ª8x8ç“¦ç‰‡è€Œä¸æ˜¯ä¸¤ä¸ª8x16ç“¦ç‰‡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»…åŒ…å«å¹¶äº¤æ¢è¯¥è±¡é™æ¥èŠ‚çœæ›´å¤šç©ºé—´ã€‚ ç°åœ¨ï¼Œè®©è¿™ä¸ªæ›´åŠ å¤æ‚ä¸€ç‚¹ï¼šåŠ è½½å¤šä¸ªç²¾çµé›†ã€‚ ç¬¬å››æ­¥ï¼šå¤šä¸ªç²¾çµé›†åˆ æœ¬èŠ‚åœ¨è¿™é‡Œå±•ç¤ºäº†è·Ÿè¸ªâ€œå“ªäº›ç²¾çµå­˜å‚¨åœ¨ä½•å¤„â€çš„é‡è¦æ€§ã€‚ æˆ‘ä¸ºåŠ¨ç”»åˆ¶ä½œäº†ç¬¬äºŒå¼ è„¸ï¼Œå¹¶å°†å…¶å¯¼å‡ºåˆ° frown.cï¼ˆå¸¦æœ‰çš±çœ‰æ ‡ç­¾ï¼‰ï¼Œå¹¶ä½¿ç”¨ä¸Šè¿°æ–¹æ³•å°†å…¶åŒ…å«åœ¨ä»£ç ä¸­ã€‚ è¿™æ˜¯æ•°ç»„ï¼š 12345678910111213141516171819unsigned char frown[] =&#123; 0x0F,0x0F,0x30,0x30,0x40,0x40,0x40,0x40, 0x84,0x84,0x84,0x84,0x84,0x84,0x84,0x84, 0x84,0x84,0x84,0x84,0x80,0x80,0x87,0x87, 0x58,0x58,0x40,0x40,0x30,0x30,0x0F,0x0F, 0xF0,0xF0,0x0C,0x0C,0x02,0x02,0x02,0x02, 0x21,0x21,0x21,0x21,0x21,0x21,0x21,0x21, 0x21,0x21,0x21,0x21,0x01,0x01,0xE1,0xE1, 0x1A,0x1A,0x02,0x02,0x0C,0x0C,0xF0,0xF0, 0x0F,0x0F,0x30,0x30,0x40,0x40,0x40,0x40, 0x90,0x90,0x8E,0x8E,0x80,0x80,0x84,0x84, 0x84,0x84,0x84,0x84,0x80,0x80,0x87,0x87, 0x58,0x58,0x40,0x40,0x30,0x30,0x0F,0x0F, 0xF0,0xF0,0x0C,0x0C,0x02,0x02,0x02,0x02, 0x09,0x09,0x71,0x71,0x01,0x01,0x21,0x21, 0x21,0x21,0x21,0x21,0x01,0x01,0xE1,0xE1, 0x1A,0x1A,0x02,0x02,0x0C,0x0C,0xF0,0xF0&#125;; è®©æˆ‘ä»¬åœ¨ä¸»å‡½æ•°ä¸­ï¼ˆåœ¨å¾ªç¯ä¸Šæ–¹ï¼‰å°†å…¶è®¾ç½®ä¸ºæˆ‘ä»¬çš„Spriteæ•°æ®ï¼š 1set_sprite_data(8, 8, frown); è¿™å°±æ˜¯æœ¬æ¼”ç¤ºçš„é‡ç‚¹ï¼šå½“å›¾å—ä»¥æ•°å­—æ–¹å¼è¿›å±•æ—¶ï¼ˆå›¾å— 0ï¼Œå›¾å— 1ï¼Œå›¾å— 2 â€¦ï¼‰ï¼Œset_sprite_data åªæ˜¯å°† 8x8 å­å›¾æ’å…¥åˆ°æ•°æ®é›†ä¸­ã€‚ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æŒ‡å‘å†…å­˜ä¸­çš„ç¬¬ä¸€ä¸ªè‡ªç”±ç²¾çµï¼Œå¹¶ä¸”è¦è®°ä½ï¼Œæˆ‘ä»¬å·²ç»ç”¨å¾®ç¬‘è‰ºæœ¯çš„ 8 ä¸ªç²¾çµå¡«å……äº† 0-7 ã€‚å¦‚æœæˆ‘ä»¬å°†ç¬¬ä¸€ä¸ªå‚æ•°è®¾ç½®ä¸ºå°äº 8 çš„ä»»ä½•å€¼ï¼Œå®ƒå°†è¦†ç›–éƒ¨åˆ†å¾®ç¬‘ï¼Œå¯¹äºæ›´å¤§çš„è¦†ç›–èŒƒå›´ï¼Œå¹¶ä¸”ä¸¤å¼ è„¸ä¹‹é—´ä¼šæœ‰é—´éš™ã€‚ç¬¬äºŒä¸ªå‚æ•°å†æ¬¡æ˜¯æˆ‘ä»¬åœ¨æ­¤å¤„æ’å…¥çš„ 8x8 ç£è´´çš„æ•°é‡ï¼Œå¹¶ä¸”æˆ‘ä»¬çš„å¿ƒç†è®¡æ•°æœ€é«˜è·³åˆ° 16ï¼Œè¿™æ„å‘³ç€ 0-15 è¢«å ç”¨ã€‚ è¿™æ ·åšçš„å¤æ‚ä¹‹å¤„åœ¨äºï¼Œå³ä½¿æˆ‘ä»¬æœ‰å¹¶è¡Œçš„åŠ¨ç”»å‘¨æœŸï¼Œæˆ‘ä»¬ä¹Ÿå¿…é¡»è®°ä½æ¯ä¸ªå›¾å—åœ¨å†…å­˜ä¸­çš„ä½ç½®ã€‚ å¥½å¤„æ˜¯ä»»ä½•å›¾å—éƒ½å¯ä»¥ä»å­ç”»é¢å †æ ˆä¸­çš„ä»»ä½•ä½ç½®æ‹‰å‡ºã€‚ è®©æˆ‘ä»¬å¤åˆ¶å¾®ç¬‘ä»£ç ä»¥ä¾¿ä¸æ–°çš„çš±çœ‰è„¸ä¸€èµ·ä½¿ç”¨ï¼ŒåŒæ—¶äº¤æ¢ç²¾çµï¼š 12345678910111213141516171819202122232425262728293031#include &lt;gb/gb.h&gt;#include \"smile.c\"#include \"frown.c\"void main()&#123; SPRITES_8x16; set_sprite_data(0, 8, smile); set_sprite_tile(0, 0); move_sprite(0, 55, 75); set_sprite_tile(1, 2); move_sprite(1, 55 + 8, 75); set_sprite_data(8, 8, frown); set_sprite_tile(2, 8); move_sprite(2, 95, 75); set_sprite_tile(3, 10); move_sprite(3, 95 + 8, 75); SHOW_SPRITES; while(1)&#123; set_sprite_tile(1, 6); set_sprite_tile(2, 12); set_sprite_tile(3, 14); delay(500); set_sprite_tile(1,2); set_sprite_tile(2, 8); set_sprite_tile(3, 10); delay(500); &#125;&#125; æˆ‘ä»¬ç”¨ç¬¬äºŒå¼ è„¸çš„å·¦åŠéƒ¨åˆ†å’Œå³åŠéƒ¨åˆ†å¡«å……ç¼–å·ä¸º 2 å’Œ 3 çš„ç²¾çµã€‚ å½“ç¬‘è„¸åœ¨ç²¾çµæ•°æ® 2ï¼ˆå’Œ 3ï¼‰å’Œ 6ï¼ˆå’Œ 7ï¼‰ä¹‹é—´åˆ‡æ¢æ—¶ï¼Œçš±çœ‰åœ¨å·¦ä¾§çš„ 8ï¼ˆå’Œ 9ï¼‰å’Œ 12ï¼ˆå’Œ 13ï¼‰ä¹‹é—´ä»¥åŠåœ¨ 10ï¼ˆå’Œ 11ï¼‰å’Œ 14ï¼ˆå’Œ 15ï¼‰ä¹‹é—´å¾ªç¯ã€‚ ï¼‰åœ¨å³ä¾§ï¼Œä¸¤è¾¹åŒæ—¶å‡ºç°ã€‚ ç¼–è¯‘å¹¶åœ¨ VRAM æŸ¥çœ‹å™¨ä¸­æŸ¥çœ‹ï¼ ç»“è®º å¸Œæœ›è¿™å¯ä»¥æ•™æ‚¨å¦‚ä½•ä½¿ç”¨ GBDK åŠ è½½å’Œæ˜¾ç¤ºç²¾çµï¼Œæˆ–è€…è‡³å°‘ä»¥äººç±»å¯è¯»å½¢å¼å‘ˆç°äº†ä¸€ä¸ªçœŸå®ç¤ºä¾‹ã€‚","categories":[{"name":"GBDK","slug":"GBDK","permalink":"https://blog.inoki.cc/categories/GBDK/"}],"tags":[{"name":"ä¸­æ–‡","slug":"ä¸­æ–‡","permalink":"https://blog.inoki.cc/tags/ä¸­æ–‡/"},{"name":"GBDK","slug":"GBDK","permalink":"https://blog.inoki.cc/tags/GBDK/"}]},{"title":"KDE Frameworks - KDNSSD","slug":"KDE-Frameworks-KDNSSD","date":"2020-09-06T08:22:00.000Z","updated":"2025-03-08T09:40:48.573Z","comments":true,"path":"2020/09/06/KDE-Frameworks-KDNSSD/","link":"","permalink":"https://blog.inoki.cc/2020/09/06/KDE-Frameworks-KDNSSD/","excerpt":"","text":"Important: this post assumes that you have knowledge on Qt and CMake/QMake, and that you have at least some concept on library linking. Introduction The KDE Frameworks[1] provides a set of frameworks based on Qt framework. It can largely reduce duplicated work on implementing lots of common-use components in many Desktop Applications. The KDE Frameworks not only support Linux/Unix Desktop, most of its frameworks can also work on Windows, macOS, even Android and iOS. DNS Service Discovery(DNS-SD)[2] is a way of using standard DNS programming interfaces, servers, and packet formats to browse the network for services. The protocol is widely used in the modern applications to provide inter-discovery functionality between devices, for example, printer discovery, Local Area Network multiplayer game, etc. This post shows up how to use KDNSSD[3] framework in KDE Frameworks. KDNSSD Set Up The KDNSSD framework is located at the Layer 1 in the KDE Frameworks, which means that KDNSSD doesnâ€™t rely on any other framework in the KDE Frameworks. It does require Qt, but itâ€™s not a big barricade. If you donâ€™t have Qt development kit, you can easily install one and then continue. In most Linux distribution, in particular, the Linux distribution which has KDE desktop support, there should be software packets of KDNSSD. Installation On Debian/Ubuntu, 1sudo apt install libkf5dnssd libkf5dnssd-dev On RedHat family (CentOS, Fedora) : 1sudo yum install kf5-kdnssd kf5-kdnssd-devel On Arch Linux: 1sudo pacman -S kdnssd The development files (eg. header files) and the runtime libraries should be installed and configured correctly. Linking According to the documentation[4], you can use either CMake or QMake: 12find_package(KF5DNSSD)target_link_libraries(yourapp KF5::DNSSD) 1QT += KDNSSD Even, you could use pkg-config if youâ€™d like. Here I choose to use CMake, the one mostly used in KDE Community. KDNSSD Hello World The first lesson in Computer Engineer is usually a Hello World, which contains the most basic functionality. In KDNSSD, or DNS-SD, the most basic one is to expose a service and to discover a service. So, the Hello World here is to expose a service on the local machine, and discover it Exposing a serivce Firstly, I create a ServicePublisher class in service_publish.cpp, as the service exposer program. Its constructor creates a KDNSSD::PublicService object, which pretends there is a My files service based on HTTP and thus TCP protocol, listening on 8080 port. Then, we set up a connection between signal and slot. And finally publish the DNS-SD information asynchronously. 123456ServicePubisher() // Typo&#123; m_service = new KDNSSD::PublicService(\"My files\", \"_http._tcp\", 8080); connect(m_service, &amp;KDNSSD::PublicService::published, this, &amp;ServicePubisher::isPublished); m_service-&gt;publishAsync();&#125; The published signal is connected to isPublished method in the class. It will output the publish state once the state is notified: 12345678void isPublished(bool state)&#123; if (state) &#123; qDebug() &lt;&lt; \"Service published\"; &#125; else &#123; qDebug() &lt;&lt; \"Service not published\"; &#125;&#125; Exposing a service Then, I created another class ServiceExplorer to try discovering services which are declared to be based on HTTP and TCP protocol. 123456789101112131415ServiceExplorer()&#123; m_browser = new KDNSSD::ServiceBrowser(QStringLiteral(\"_http._tcp\")); connect(m_browser, &amp;KDNSSD::ServiceBrowser::serviceAdded, this, [](KDNSSD::RemoteService::Ptr service) &#123; qDebug() &lt;&lt; \"Service found on\" &lt;&lt; service-&gt;hostName() &lt;&lt; service-&gt;serviceName(); &#125;); connect(m_browser, &amp;KDNSSD::ServiceBrowser::serviceRemoved, this, [](KDNSSD::RemoteService::Ptr service) &#123; qDebug() &lt;&lt; \"Service unregistered on\" &lt;&lt; service-&gt;hostName(); &#125;); m_browser-&gt;startBrowse();&#125; The serviceAdded and serviceRemoved signals are connected with anonymous functions, which only do some output. CMake file At the end, add the 2 programs as executable and link them to the KDNSSD: 1234567add_executable(kdnssd-discover-helloworld service_discover.cpp)add_executable(kdnssd-publish-helloworld service_publish.cpp)find_package(KF5DNSSD)target_link_libraries(kdnssd-discover-helloworld KF5::DNSSD)target_link_libraries(kdnssd-publish-helloworld KF5::DNSSD) Build and run them ğŸ˜ƒ You should be able to discover the fake My Files service published by the ServicePublisher. You can find the source code on my kde-frameworks-tutorial GitHub repo. Give me and my project a star if you like it ğŸ˜ƒ You can also watch it to get notified when there is an update. Conclusion Here I only show a basic use of KDNSSD. To know more details about it, reading documentation is the best way. Good luck! For further reading, you could find the links in Reference chapter. Reference [1] KDE Frameworks, https://kde.org/products/frameworks/ [2] DNS-SD, http://www.dns-sd.org/ [3] RFC 6763 DNS-Based Service Discovery, https://www.ietf.org/rfc/rfc6763.txt [4] KDNSSD Dcoumentation, https://api.kde.org/frameworks/kdnssd/html/index.html","categories":[{"name":"KDE Frameworks","slug":"KDE-Frameworks","permalink":"https://blog.inoki.cc/categories/KDE-Frameworks/"}],"tags":[{"name":"KDE Frameworks","slug":"KDE-Frameworks","permalink":"https://blog.inoki.cc/tags/KDE-Frameworks/"}]},{"title":"ã€è¯‘ã€‘è½¯ä»¶å®šä¹‰æ— çº¿ç”µçš„åŸºç¡€ â€”â€” 3.æ¥æ”¶æœº","slug":"Basic-of-Software-Defined-Radio-3","date":"2020-08-07T20:27:00.000Z","updated":"2025-03-08T09:40:48.548Z","comments":true,"path":"2020/08/07/Basic-of-Software-Defined-Radio-3/","link":"","permalink":"https://blog.inoki.cc/2020/08/07/Basic-of-Software-Defined-Radio-3/","excerpt":"","text":"åŸæ–‡é“¾æ¥ï¼šhttps://www.eetimes.com/sdr-basics-part-3-transmitters/ è½¯ä»¶å®šä¹‰æ— çº¿ç”µï¼ˆSDRï¼‰çš„å‘é€åŠŸèƒ½ä¹ŸåŸºäºæŸç§å½¢å¼çš„è¶…å¤–å·®æˆ–ç›´æ¥è½¬æ¢ã€‚å›¾ 18.8 å’Œ 18.9 è¯´æ˜äº†è¿™ä¸¤ä¸ªé€‰é¡¹ã€‚å¤šè½½æ³¢é€‰é¡¹æœ€é€‚åˆå•è½½æ³¢å’Œå¤šè½½æ³¢åº”ç”¨ï¼Œè€Œç›´æ¥è½¬æ¢ä¸ºå•è½½æ³¢åº”ç”¨æä¾›äº†ä¸€ç§å‡ºè‰²çš„ä½æˆæœ¬è§£å†³æ–¹æ¡ˆã€‚ éšç€é›†æˆæŠ€æœ¯çš„æ”¹è¿›ï¼Œå¤šè½½æ³¢ç›´æ¥è½¬æ¢å¯èƒ½æˆä¸ºå¯èƒ½ã€‚ä½†æ˜¯ï¼Œè¿™æ ·çš„å‘å°„é…ç½®éœ€è¦æ¯”å¯„ç”Ÿéœ€æ±‚å¥½çº¦ 15 dB çš„è¾¹å¸¦æŠ‘åˆ¶ï¼Œä»¥é˜²æ­¢ä¸­å¿ƒé¢‘ç‡ä¸€ä¾§çš„å›¾åƒè¶…è¿‡å¦ä¸€ä¾§çš„æ½œåœ¨å¼±è½½æ³¢ã€‚ åœ¨ä»»ä½•ä¸€ç§åº”ç”¨ä¸­ï¼Œæ•°å­—ä¿¡å·å¤„ç†å™¨ï¼ˆDSPï¼‰æˆ–åŸºå¸¦ ASIC å‡ç”¨äºç”Ÿæˆè°ƒåˆ¶åçš„åŸºå¸¦æ•°æ®ã€‚æ­¤æ•°æ®ç›´æ¥é€å…¥ä¸€å¯¹åŸºå¸¦æ•°å­—/æ¨¡æ‹Ÿè½¬æ¢å™¨ï¼ˆDACï¼‰ï¼ˆI å’Œ Qï¼‰ä»¥è¿›è¡Œç›´æ¥ RF è°ƒåˆ¶ï¼Œæˆ–é€å…¥è´Ÿè´£å°†å…¶æ•°å­—è½¬æ¢ä¸ºåˆé€‚çš„æ•°å­—ä¸­é¢‘ï¼ˆIFï¼‰çš„æ•°å­—å¤„ç†å™¨ã€‚ å–å†³äºåº”ç”¨ï¼Œå¯ä»¥å•ç‹¬ä½¿ç”¨ DSP æˆ–ä¸æ•°å­—å¤„ç†å™¨ç»“åˆä½¿ç”¨ï¼Œå¯¹åŸºå¸¦æ•°æ®è¿›è¡Œæ•°å­—é¢„å¤±çœŸï¼Œä»è€Œæ¶ˆé™¤ä¿¡å·é“¾ä¸­ç¨åäº§ç”Ÿçš„å¤±çœŸäº§ç‰©ã€‚å¦‚æœè¦ä½¿ç”¨ IF çº§ï¼Œåˆ™å¿…é¡»ä½¿ç”¨ FPGA æˆ– ASIC æˆ–ä½¿ç”¨ä¼ ç»Ÿçš„æ··é¢‘å™¨æˆ–è°ƒåˆ¶å™¨å°† DSP äº§ç”Ÿçš„åŸºå¸¦æ•°æ®æ•°å­—åŒ–ä¸Šå˜é¢‘è‡³æ‰€éœ€çš„ IFã€‚ è¿™ç§ä¼ ç»ŸæŠ€æœ¯å·²è¢«æ•°å­—æ–¹å¼æ‰€å–ä»£ï¼Œè¿™æ˜¯ç”±äºæ•°å­—é€»è¾‘æä¾›äº†æ›´å¤šçš„çµæ´»æ€§ã€è€Œä¸”è‰¯å¥½çš„å…·æœ‰æ€§ä»·æ¯”çš„æ•°æ¨¡è½¬æ¢å™¨å·²ç»å¯ç”¨ã€‚ä¸ç›¸å…³çš„æ¥æ”¶åŠŸèƒ½ä¸€æ ·ï¼Œè¯¥è®¾å¤‡çš„ç›®çš„æ˜¯å¯¹æ‰€éœ€é€šé“çš„å¸¦å®½è¿›è¡Œæ•´å½¢ï¼Œç„¶åé€šè¿‡æ•°å­—æ–¹å¼å°†å…¶ä¸Šå˜é¢‘è‡³æ‰€éœ€ IF é¢‘ç‡ã€‚ å¦‚æœéœ€è¦å¤šä¸ªé€šé“ï¼Œåˆ™å¯ä»¥åœ¨ä¸€ä¸ªèŠ¯ç‰‡ä¸Šåˆæˆå®ƒä»¬ã€‚è½¬æ¢åï¼Œå¯ä»¥å°†æ¯ä¸ªé€šé“åŠ åœ¨ä¸€èµ·å¹¶æ’å€¼åˆ°æ‰€éœ€çš„æ•°æ®é€Ÿç‡ï¼Œç„¶åå‘é€åˆ° DACã€‚å¦‚æœéœ€è¦ï¼Œå¯ä»¥å°†æ•°å­—é¢„å¤±çœŸä¸ DSP ä¸€èµ·æ·»åŠ ï¼Œä»¥æ ¡æ­£ä¿¡å·é“¾ä¸­çš„å¤±çœŸã€‚ æ··é¢‘å™¨æˆ–è°ƒåˆ¶å™¨å¯ä»¥ç”¨æ¥å°†é¢‘ç‡è½¬æ¢ä¸ºæœ€ç»ˆ RF é¢‘ç‡ã€‚å¦‚æœé‡‡ç”¨ç›´æ¥å°„é¢‘è°ƒåˆ¶ï¼Œåˆ™ä½¿ç”¨å°„é¢‘è°ƒåˆ¶å™¨ã€‚å¦‚æœä½¿ç”¨ä¸­é¢‘ï¼ˆç›´æ¥æ¥è‡ª DAC æˆ–ä¼ ç»Ÿä¸­é¢‘ä¸Šå˜é¢‘ï¼‰ï¼Œåˆ™å°†ä½¿ç”¨æ··é¢‘å™¨è½¬æ¢ä¸ºæœ€ç»ˆ RF é¢‘ç‡ã€‚ä¸æ¥æ”¶æ··é¢‘å™¨/è§£è°ƒå™¨ä¸€æ ·ï¼Œå¯èƒ½éœ€è¦æ›´æ”¹æ•°æ®çš„åç½®ç”µå¹³æˆ–é©±åŠ¨ç”µå¹³æˆ– LO ç”µå¹³ä»¥ä¼˜åŒ–å¤±çœŸã€‚ 18.8 ä½¿ç”¨å•ä¸ªä¸Šå˜é¢‘è¶…å¤–å·®çš„å¤šé€šé“ä¼ è¾“ 18.9: å•è½½æ³¢ç›´æ¥è½¬æ¢ä¼ è¾“ ä¸æ¥æ”¶ LO ä¸€æ ·ï¼Œå‘é€ LO çš„é¢‘ç‡ä¹Ÿå¯å˜ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ä½¿ç”¨ PLL æˆ– DDS æŠ€æœ¯çš„è½¯ä»¶æ§åˆ¶è½»æ¾ç¼–ç¨‹ã€‚åœ¨æ­¤ï¼Œä¹Ÿå¯èƒ½éœ€è¦æ›´æ”¹ LO é©±åŠ¨ç”µå¹³ï¼Œä»¥ä¼˜åŒ–å„ç§ä¿¡å·æ¡ä»¶ä¸‹çš„æ‚æ•£æ€§èƒ½ã€‚ä¸æ¥æ”¶å™¨çš„å•é¢‘æ®µæ“ä½œä¸€æ ·ï¼Œä¹Ÿå¯èƒ½å­˜åœ¨éœ€è¦å›ºå®š LO çš„æƒ…å†µã€‚ è¿™æ ·çš„ä¾‹å­å°†ç”¨äºåœ¨å•ä¸ªé¢‘å¸¦å†…çš„æ“ä½œï¼Œå…¶ä¸­è°ƒè°åœ¨ ASIC æˆ– FPGA å†…å®Œæˆã€‚ä¸æ¥æ”¶è·¯å¾„ä¸€æ ·ï¼Œæ•°æ®è½¬æ¢å™¨æˆ– DAC é€šå¸¸æ˜¯ç“¶é¢ˆã€‚ä½†æ˜¯ï¼Œç”±äºå‘å°„ä¿¡å·è·¯å¾„çš„åŠ¨æ€èŒƒå›´è¦æ±‚æ¯”æ¥æ”¶è·¯å¾„çš„åŠ¨æ€èŒƒå›´è¦æ±‚ä½å¾—å¤šï¼ˆé€šå¸¸ä¸º 25 è‡³ 45 dBï¼‰ï¼Œå› æ­¤ç»„ä»¶é€‰æ‹©å¹¶ä¸é‚£ä¹ˆå›°éš¾ã€‚æœ‰è®¸å¤šå¯ç”¨çš„ DAC å¯ä»¥ç®€åŒ–å¤§èŒƒå›´çš„è°ƒæ•´ï¼ŒåŒ…æ‹¬å¢ç›Šå’Œå¤±è°ƒæ ¡æ­£ï¼Œä»è€Œå¯ä»¥æœ€å¤§ç¨‹åº¦åœ°å‡å°å‘å°„ä¿¡å·é“¾ä¸­çš„ I/Q ä¸å¹³è¡¡ã€‚ å…¶ä»–æ‰€éœ€çš„åŠŸèƒ½åŒ…æ‹¬æ•°æ®é€Ÿç‡æ’å€¼å’Œ I/Q ç›¸ä½æ ¡æ­£ã€‚ æœ€åï¼Œé€šè¿‡å‰ç½®æ”¾å¤§å™¨å’ŒåŠŸç‡æ”¾å¤§å™¨ï¼ˆPAï¼‰å®ç°åŠŸç‡å¢ç›Šã€‚é™¤äº†è¿™äº›è®¾å¤‡å¿…é¡»åœ¨å¾ˆå®½çš„é¢‘ç‡èŒƒå›´å†…å·¥ä½œä¹‹å¤–ï¼Œè¿˜éœ€è¦è°ƒæ•´RFè¾“å‡ºåŠŸç‡ã€‚è¿™å¯èƒ½å­˜åœ¨è°ƒæ•´çš„é—®é¢˜ï¼Œè¦æ±‚æŸäº›é¢‘ç‡ä»¥æ¯”å…¶ä»–é¢‘ç‡æ›´ä½çš„åŠŸç‡è¿›è¡Œä¼ è¾“ã€‚è™½ç„¶ PA å¢ç›Šé€šå¸¸æ˜¯å›ºå®šçš„ï¼Œä½†å‰ç½®æ”¾å¤§å™¨å¯ä»¥é‡‡ç”¨ VGA çš„å½¢å¼ã€‚ ç»“è®º éšç€å…¨çƒèŒƒå›´å†…æ–°çš„å’Œæ›´å¤æ‚çš„é€šä¿¡æ ‡å‡†çš„å‘å±•ï¼Œå¯¹æ–°æ”¶å‘å™¨æ¶æ„çš„éœ€æ±‚ä¹Ÿå°†å¢é•¿ã€‚ä½†æ˜¯ï¼Œè¶Šæ¥è¶Šå¤šçš„å¯ç”¨èµ„é‡‘ï¼Œæ— è®ºæ˜¯èµ„é‡‘è¿˜æ˜¯äººåŠ›ï¼Œéƒ½é™åˆ¶äº†å¯ä»¥è§£å†³çš„è®¾è®¡ã€‚å¹¸è¿çš„æ˜¯ï¼Œè½¯ä»¶æ— çº¿ç”µæŠ€æœ¯å¯ç”¨äºè¿™äº›æ¶æ„ä¸­ä¸æ–­å£®å¤§çš„ä¸€ç»„ï¼Œè¿™äº›æ¶æ„å…è®¸å•ä¸ªå¹³å°åˆ©ç”¨åˆ°è®¸å¤šä¸åŒçš„è®¾è®¡ä¸­ã€‚å¦‚æ­¤æ–‡æ‰€ç¤ºï¼Œè¿™å…·æœ‰è®¸å¤šæ˜æ˜¾çš„ä¼˜åŠ¿ï¼Œå¹¶ä¸”ä¸ä»…é™äºäº’æ“ä½œæ€§ï¼ŒæŠ•èµ„ä¿æŒå’Œæå¤§çš„çµæ´»æ€§ã€‚ ä¸ä»»ä½•è½¯ä»¶é¡¹ç›®ä¸€æ ·ï¼ŒSDR çš„æ½œåŠ›é€šå¸¸ä»…å—è®¾è®¡äººå‘˜çš„æƒ³è±¡åŠ›é™åˆ¶ã€‚ä¸ä»»ä½•è½¯ä»¶é¡¹ç›®ä¸€æ ·ï¼Œæœ€å¤§çš„å¥½å¤„æ˜¯ï¼Œå¦‚æœå­˜åœ¨è®¾è®¡é”™è¯¯ï¼Œåˆ™å¯ä»¥åŠ¨åŠ¨é”®ç›˜å°±ç®€å•åœ°è§£å†³é—®é¢˜ã€‚ å¹¸è¿çš„æ˜¯ï¼Œæœ€è¿‘åå¹´æ¥ï¼ŒåŠå¯¼ä½“æŠ€æœ¯å–å¾—äº†é‡å¤§è¿›æ­¥ï¼Œä¸ä»…åœ¨æ€§èƒ½ä¸Šï¼Œè€Œä¸”åœ¨æˆæœ¬ä¸Šä¹Ÿå–å¾—äº†ä»¤äººç©ç›®çš„æˆå°±[17]ã€‚SDR æ˜¯ä»è¿™äº›å¤šæ ·åŒ–çš„æŠ€æœ¯ä¸­å—ç›ŠåŒªæµ…çš„é¢†åŸŸï¼Œå¹¶ä¸”éšç€ SDR å«ä¹‰çš„å‘å±•ï¼Œå®ƒå°†ç»§ç»­è¿™æ ·çš„è¶‹åŠ¿ï¼Œå°±åƒç¼–ç¨‹è¯­è¨€å†å²ä¸Šçš„æƒ…å†µä¸€æ ·ã€‚ å°½ç®¡ SDR å¹¶éè§£å†³æ‰€æœ‰é€šä¿¡é—®é¢˜çš„æ–¹æ³•ï¼Œä½†å®ƒå°†åœ¨æœªæ¥å‡ å¹´å†…ä¸ºæŒ‘æˆ˜æ€§è®¾è®¡é—®é¢˜æä¾›å¯é çš„è§£å†³æ–¹æ¡ˆã€‚åŒ…æ‹¬ç›¸æ§é˜µæŠ€æœ¯ï¼Œå®šä½æœåŠ¡ï¼Œäº’æ“ä½œæ€§ä»¥åŠå°šæœªå®šä¹‰çš„å¤æ‚æ¦‚å¿µã€‚ä½†æ˜¯ï¼Œä»ç„¶å­˜åœ¨ä¸€äº›æŒ‘æˆ˜ï¼Œä½¿å¾—æ— æ³•å®Œå…¨æ¥å—è¯¥æŠ€æœ¯ã€‚ä¸¤ä¸ªä¸»è¦é—®é¢˜åˆ†åˆ«æ˜¯æˆæœ¬å’ŒåŠŸè€—ã€‚æœ‰è¶£çš„æ˜¯ï¼Œè¿™ä¸¤è€…å…·æœ‰ä¸€é˜¶æ­£ç›¸å…³å…³ç³»ï¼šè§£å†³ä¸€ä¸ªé—®é¢˜ã€å¦ä¸€ä¸ªåªä¼šå˜å¾—æ›´å¥½ã€‚æ²¡æœ‰ä½åŠŸè€—ï¼Œç”¨æˆ·è®¾å¤‡å°†æ— æ³•å……åˆ†åˆ©ç”¨ SDR æŠ€æœ¯ã€‚æ˜¾ç„¶ï¼Œç”µæºé—®é¢˜æ¥è‡ªå¯¹é«˜æ€§èƒ½ç»„ä»¶çš„éœ€æ±‚ï¼Œé«˜æ€§èƒ½æ„å‘³ç€è¶…çº¿æ€§è®¾å¤‡ï¼Œé«˜çº¿æ€§åº¦å™¨ä»¶æ„å‘³ç€é€šè¿‡é«˜ç”µæµä¼šé™ä½æ•ˆç‡ã€‚ å› æ­¤ï¼Œå¦‚æœè§£å†³äº†å¦‚ä½•è®¾è®¡ä½åŠŸè€—é«˜çº¿æ€§åº¦è®¾å¤‡çš„é—®é¢˜ï¼Œå¹¶ä¸”è¿™æ˜¯å¯ä»¥è§£å†³çš„ï¼Œé‚£ä¹ˆæˆæœ¬ä¹Ÿå°†ä¸‹é™ï¼Œè¿™ä¸ºè®¸å¤šå…¶ä»–åº”ç”¨æ‰“å¼€äº†å¤§é—¨ã€‚å› æ­¤ï¼Œç»§ç»­è¿›è¡Œ SDR å¼€å‘å’Œæ¼”è¿›çš„å…³é”®æ˜¯ç»§ç»­æ²¿æ‘©å°”å®šå¾‹æ›²çº¿æ”¹è¿›è®¾å¤‡ï¼Œå¹¶ç»§ç»­å¯¹çµæ´»çš„æ— çº¿ç”µæ¶æ„äº§ç”Ÿå…´è¶£ã€‚å°½ç®¡å­˜åœ¨è¿™äº›æŒ‘æˆ˜ï¼Œä½†å½“å‰çš„æ€§èƒ½çŠ¶æ€å·²è¶³ä»¥ä½¿å·¥ç¨‹å¸ˆå’Œåˆ¶é€ å•†è®¤çœŸç ”ç©¶ SDR çš„å¯èƒ½æ€§ã€‚ å‚è€ƒ J. H. Reed, Software Radio: A Modern Approach to Radio Engineering, Prentice Hall, Upper Saddle River, NJ, 2002. J. Mitola, III, â€œSoftware Radioâ€Cognitive Radio,â€ http://ourworld. compuserve.com/homepages/jmitola/. B. Brannon, D. Efstathiou, and T. Gratzek, â€œA Look at Software Radios: Are They Fact or Fiction?â€ Electronic Design, (December 1998): pp. 117â€³122. B. Clarke and K. Kreitzer, â€œSoftware Radio Concepts,â€ unpublished paper. B. Brannon, â€œDigital-Radio-Receiver Design Requires Reevaluation of Parameters,â€ EDN, 43 (November 1998): pp. 163â€³170. B. Brannon, â€œNew A/D Converter Benefi ts Digital IFs,â€ RF Design, 18 (May 1995):pp. 50â€³65. W. H. Hayward, â€œIntroduction to Radio Frequency Design,â€ The American Radio Relay League, 1994â€³1996. J. J. Carr, Secrets of RF Circuit Design, McGraw-Hill, New York, 2001. B. Brannon, â€œFast and Hot: Data Converters for Tomorrowâ€™s Software-Defi ned Radios,â€ RF Design, 25 (July 2002): pp. 60â€³66. B. Brannon and C. Cloninger, â€œRedefining the Role of ADCs in Wireless,â€ Applied Microwave and Wireless, 13 (March 2001): pp. 94â€³105. B. Brannon, â€œDNL and Some of Its Effects on Converter Performance,â€ Wireless Design and Development, 9 (June 2001): p. 10. w.newnespress.com B. Brannon, â€œOvercoming Converter Nonlinearies with Dither,â€ Analog Devices Applications Note AN-410, www.analog.com. W. Kester, â€œHigh-Speed Sampling and High-Speed ADCs,â€ Section 4, High-Speed Design Techniques, www.analog.com. W. Kester, â€œHigh-Speed DACs and DDS Systems,â€ Section 6, High-Speed Design Techniques, www.analog.com. About CDMA and CDMA University. Available at http:// www.qualcomm.com. Specifications. Available at http://www.3gpp2.org. R. H. Walden, â€œAnalog-to-Digital Converter Survey and Analysis,â€ IEEE Communications Magazine, 17 (April 1999): pp. 539â€³550. H. Nyquist, â€œCertain Topics in Telegraph Transmission Theory,â€ AIEE Transactions, 47 (April 1928): pp. 617â€³644. AD6645 Datasheet. Available at http://www.analog.com.","categories":[{"name":"Translation","slug":"Translation","permalink":"https://blog.inoki.cc/categories/Translation/"},{"name":"Chinese","slug":"Translation/Chinese","permalink":"https://blog.inoki.cc/categories/Translation/Chinese/"},{"name":"SDR","slug":"SDR","permalink":"https://blog.inoki.cc/categories/SDR/"}],"tags":[{"name":"ç¿»è¯‘","slug":"ç¿»è¯‘","permalink":"https://blog.inoki.cc/tags/ç¿»è¯‘/"},{"name":"ä¸­æ–‡","slug":"ä¸­æ–‡","permalink":"https://blog.inoki.cc/tags/ä¸­æ–‡/"},{"name":"SDR","slug":"SDR","permalink":"https://blog.inoki.cc/tags/SDR/"}]},{"title":"äº‘è¾“å…¥åœ¨ ibus-libpinyin ä¸­çš„å®ç° - é…ç½®é¡¹","slug":"IBus-libpinyin-cloud-input-configurations","date":"2020-07-16T20:20:00.000Z","updated":"2025-03-08T09:40:48.566Z","comments":true,"path":"2020/07/16/IBus-libpinyin-cloud-input-configurations/","link":"","permalink":"https://blog.inoki.cc/2020/07/16/IBus-libpinyin-cloud-input-configurations/","excerpt":"","text":"å‰å‡ ç¯‡æ–‡ç« æè¿°äº†äº‘è¾“å…¥è¯·æ±‚çš„å…¨è¿‡ç¨‹ã€‚å…¶ä¸­ï¼Œå’Œäº‘è¾“å…¥æœ‰å…³çš„å‚æ•°ï¼ˆæ¯”å¦‚ï¼šéœ€è¦è¯·æ±‚å‡ ä¸ªäº‘è¾“å…¥ç»“æœï¼Œå»¶æ—¶å‘é€è¯·æ±‚éœ€è¦å»¶æ—¶å¤šä¹…ç­‰ï¼‰æ˜¯ç”± GLib ä¸­çš„ GSettings æ¨¡å—è´Ÿè´£å‚¨å­˜ä¸è¯»å–çš„ã€‚ å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿™ä¸ªæ¨¡å—éƒ½å¯ä»¥é€šè¿‡è¯»å–é¡¹ç›®ä¸­çš„é…ç½®æè¿°æ–‡ä»¶ï¼Œç”Ÿæˆå¯¹åº”çš„é…ç½®é¡¹ï¼ˆå®é™…ä¸Šï¼Œä¹Ÿå¯ä»¥é€šè¿‡å‘½ä»¤è¡Œåˆ›å»ºã€è¯»å–ã€ä¿®æ”¹é…ç½®é¡¹ï¼Œè¿™é‡Œä¸åšç´¯è¿°ï¼‰ã€‚ é…ç½®æè¿°æ–‡ä»¶ GSettings é€šè¿‡è¯»å–ä¸€ä¸ªä»¥ .gschema.xml ç»“å°¾ã€XML æ ¼å¼çš„é…ç½®æè¿°æ–‡ä»¶ç”Ÿæˆå¯¹åº”é…ç½®é¡¹ã€‚ä¸€ä¸ªå…¸å‹çš„é…ç½®æè¿°æ–‡ä»¶å¦‚ä¸‹ï¼š 123456789101112131415161718&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;&lt;schemalist&gt; &lt;schema path=\"/org/example/myapp/\" id=\"org.example.myapp\"&gt; &lt;key name='automatic-updates' type='b'&gt; &lt;default&gt;true&lt;/default&gt; &lt;summary&gt;Automatically install updates&lt;/summary&gt; &lt;description&gt; If enabled, updates will automatically be downloaded and installed. If disabled, updates will still be downloaded, but the user will be asked to install them manually. &lt;/description&gt; &lt;/key&gt; &lt;/schema&gt;&lt;/schemalist&gt; æ¯ä¸ª &lt;schema&gt; æ ‡ç­¾å¯¹åº”ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼›æ¯ä¸ª &lt;key&gt; å¯¹åº”ä¸€ä¸ªé…ç½®é¡¹ï¼Œname å±æ€§æŒ‡å®šäº†é…ç½®é¡¹çš„åç§°ï¼Œtype å±æ€§æŒ‡å®šäº†å€¼çš„ç±»å‹ï¼Œç¤ºä¾‹ä¸­çš„ automatic-updates å±æ€§ä¸ºä¸€ä¸ªå¸ƒå°”å€¼ï¼Œé»˜è®¤å€¼ä¸º trueã€‚ åˆ›å»ºå¥½ä¸€ä¸ªé…ç½®é¡¹æè¿°æ–‡ä»¶äº†ä¹‹åï¼Œåœ¨ Makefile.am ä¸­å°†æ–‡ä»¶åä¼ ç»™ gsettings_SCHEMASï¼ŒGLib ä¸­ automake ç›¸å…³çš„æ“ä½œä¼šè¿›è¡Œä¹‹åçš„æ“ä½œã€‚æ¯”å¦‚ï¼Œåœ¨ ibus-libpinyin ä¸­çš„ data/Makefile.am è¿™ä¸€è¡Œå°±å£°æ˜äº†é¡¹ç›®ä¸­çš„é…ç½®æè¿°æ–‡ä»¶ï¼š 1gsettings_SCHEMAS = com.github.libpinyin.ibus-libpinyin.gschema.xml åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œå£°æ˜äº†ä¸¤ä¸ªâ€œåº”ç”¨ç¨‹åºâ€çš„é…ç½®é¡¹ï¼Œå› ä¸ºå®é™…ä¸Š ibus-libpinyin åŒ…å«äº†ä¸€ä¸ªæ‹¼éŸ³è¾“å…¥æ³• libpinyin å’Œä¸€ä¸ªæ³¨éŸ³è¾“å…¥æ³• libbopomofoã€‚ 123&lt;schema path=\"/com/github/libpinyin/ibus-libpinyin/libpinyin/\" id=\"com.github.libpinyin.ibus-libpinyin.libpinyin\"&gt;&lt;/schema&gt;&lt;schema path=\"/com/github/libpinyin/ibus-libpinyin/libbopomofo/\" id=\"com.github.libpinyin.ibus-libpinyin.libbopomofo\"&gt;&lt;/schema&gt; äº‘è¾“å…¥ç›¸å…³é…ç½®é¡¹ åœ¨è¿™ä¸¤ç»„é…ç½®é¡¹ä¸­ï¼Œä¸äº‘è¾“å…¥æœ‰å…³çš„é…ç½®é¡¹å¦‚ä¸‹ï¼š 12345678910111213141516&lt;key name=\"enable-cloud-input\" type=\"b\"&gt; &lt;default&gt;false&lt;/default&gt; &lt;summary&gt;Enable Cloud Input&lt;/summary&gt;&lt;/key&gt;&lt;key name=\"cloud-input-source\" type=\"i\"&gt; &lt;default&gt;0&lt;/default&gt; &lt;summary&gt;Cloud Input Source&lt;/summary&gt;&lt;/key&gt;&lt;key name=\"cloud-candidates-number\" type=\"i\"&gt; &lt;default&gt;1&lt;/default&gt; &lt;summary&gt;Cloud Candidates Number&lt;/summary&gt;&lt;/key&gt;&lt;key name=\"cloud-request-delay-time\" type=\"i\"&gt; &lt;default&gt;600&lt;/default&gt; &lt;summary&gt;Sending Cloud request with delay&lt;/summary&gt;&lt;/key&gt; å…¶ä¸­ï¼Œenable-cloud-input ä¸ºæ˜¯å¦å¯ç”¨äº‘è¾“å…¥ï¼Œcloud-input-source ä¸ºäº‘è¾“å…¥æºçš„é€‰æ‹©ï¼Œcloud-candidates-number æ˜¯æœŸæœ›è¿”å›çš„äº‘è¾“å…¥å€™é€‰ä¸ªæ•°ï¼Œcloud-request-delay-time æ˜¯å»¶æ—¶å‘é€äº‘è¾“å…¥è¯·æ±‚çš„æ—¶é—´ï¼Œå•ä½ä¸ºæ¯«ç§’ã€‚ ç°åœ¨ç‰ˆæœ¬ä¸­çš„é…ç½®é¡¹æ˜¯ä» 18 ç‰ˆç²¾ç®€ä¹‹åçš„ï¼Œç²¾ç®€ä¹‹å‰çš„é…ç½®é¡¹æ›´åŠ ç¹çï¼Œå¦‚å›¾æ‰€ç¤ºï¼š é…ç½®ç•Œé¢ ç°åœ¨å‡ºç°åœ¨é…ç½®é¡µé¢ä¸­çš„é…ç½®é¡¹åªæœ‰ä¸¤ä¸ªäº†ï¼Œäºæ˜¯å°†ä¹‹å‰ 18 ç‰ˆä¸­å•ç‹¬çš„é…ç½®é¡µé¢ç§»é™¤ï¼Œé…ç½®é¡¹æ”¾å…¥ pinyin é…ç½®é¡µä¸­ï¼š åœ¨è¿™ä¸ªé…ç½®é¡µé¢ä¸­ï¼Œä»…æœ‰äº‘è¾“å…¥çš„å¯ç”¨å’Œäº‘è¾“å…¥æºçš„é€‰æ‹©å¯ç”¨ã€‚ å»¶æ—¶å‘é€äº‘è¾“å…¥è¯·æ±‚çš„æ—¶é—´ä¸€èˆ¬æƒ…å†µä¸‹ä¸ä¼šæœ‰äººä¿®æ”¹ï¼Œç›®å‰çš„å€¼å…ˆè®¾ä¸º 600msï¼Œä¸Šçº¿åæ”¶é›†ç”¨æˆ·çš„åé¦ˆï¼Œæ ¹æ®æƒ…å†µè¿›è¡Œä¿®æ”¹ã€‚å¦å¤–ï¼Œç”¨æˆ·ä¹Ÿå¯ä»¥é€šè¿‡ GSettings çš„å‘½ä»¤è¡Œæ¥å£å¯¹è¿™ä¸ªå€¼è¿›è¡Œä¿®æ”¹ã€‚è€ŒæœŸæœ›è¿”å›çš„äº‘è¾“å…¥å€™é€‰ä¸ªæ•°ï¼Œç”±äºå‰æ–‡æ‰€è¯´çš„â€œç™¾åº¦äº‘è¾“å…¥æºæ— è®ºä½•æ—¶éƒ½åªè¿”å›ä¸€ä¸ªå€™é€‰â€ï¼Œç›®å‰é»˜è®¤å®šä¸º1ã€‚ é…ç½®çš„ GUI ç•Œé¢æ˜¯ setup/ibus-libpinyin-preferences.ui æ–‡ä»¶æè¿°çš„ï¼Œåœ¨ setup/main2.py ä»£ç ä¸­ç”± Gtk çš„ Python ç»‘å®šè´Ÿè´£å®ä¾‹åŒ–å’Œäº‹ä»¶å¤„ç†ã€‚ å…³äºé…ç½®éƒ¨åˆ†çš„æ•´ä½“æ¶æ„å¦‚å›¾ï¼š é…ç½®ç•Œé¢ GUI å’Œ Python ç¨‹åºå¯ä»¥è¯»å–æˆ–ä¿®æ”¹ GSettings ä¸­çš„é…ç½®å€¼ã€‚ ibus-libpinyin ä¸­çš„ libpinyin æˆ– libbopomofo çš„å„ä¸ªæ¨¡å—å¯ä»¥è¯»å–åˆ°é…ç½®å€¼ã€‚ é€šè¿‡ GSettings å‘½ä»¤è¡Œå·¥å…·ä¹Ÿå¯ä»¥ç›´æ¥ä¿®æ”¹å¯¹åº”çš„å€¼ã€‚ ibus-libpinyin ä¸»ç¨‹åºä¸­çš„äº‘è¾“å…¥é…ç½®é¡¹ PYConfig æ–‡ä»¶ä¸­å£°æ˜äº† Config ç±»ï¼Œä»¥åŠä¸é…ç½®ç›¸å…³çš„ä¸€ç³»åˆ—å€¼ã€‚æ¯”å¦‚ä¸äº‘è¾“å…¥ç›¸å…³çš„ CloudInputSource äº‘è¾“å…¥æºï¼š 1234enum CloudInputSource&#123; BAIDU = 0, GOOGLE&#125;; åœ¨ Config ç±»ä¸­å‚¨å­˜äº†ä¸äº‘è¾“å…¥é…ç½®é¡¹æœ‰å…³çš„ä¿æŠ¤å˜é‡åŠå…¶è¯»å–å‡½æ•°ï¼š 123456789gboolean enableCloudInput (void) const &#123; return m_enable_cloud_input; &#125;guint cloudInputSource (void) const &#123; return m_cloud_input_source; &#125;guint cloudCandidatesNumber (void) const &#123; return m_cloud_candidates_number; &#125;guint cloudRequestDelayTime (void) const &#123; return m_cloud_request_delay_time; &#125;gboolean m_enable_cloud_input;guint m_cloud_input_source;guint m_cloud_candidates_number;guint m_cloud_request_delay_time; æ­£å¦‚ä¹‹å‰é…ç½®è¯»å–æ¶æ„æè¿°çš„é‚£æ ·ï¼Œè¿™é‡Œçš„æ•°æ®æµåº”å½“æ˜¯å•å‘çš„ï¼Œå› æ­¤ä¸åº”å½“æœ‰ä»æ­¤å¤„æ›´æ”¹é…ç½®å€¼çš„æ“ä½œã€‚ è¯»å–é…ç½®æ—¶éœ€è¦ç”¨åˆ°é…ç½®é¡¹åå­—ï¼Œå¯¹åº”çš„æ˜¯ .gschema.xml ä¸­çš„ key æ ‡ç­¾çš„ name å±æ€§å€¼ï¼Œåœ¨ ibus-libpinyin ä¸­å£°æ˜æˆä¸€ç³»åˆ—å¸¸é‡ï¼š 1234const gchar * const CONFIG_INIT_ENABLE_CLOUD_INPUT = \"enable-cloud-input\";const gchar * const CONFIG_CLOUD_INPUT_SOURCE = \"cloud-input-source\";const gchar * const CONFIG_CLOUD_CANDIDATES_NUMBER = \"cloud-candidates-number\";const gchar * const CONFIG_CLOUD_REQUEST_DELAY_TIME = \"cloud-request-delay-time\"; åœ¨è¿™ä¸ªç±»ä¸­ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹æ³•è¯»å–ä¸€ä¸ªå±æ€§å€¼ï¼š 1m_enable_cloud_input = read (CONFIG_INIT_ENABLE_CLOUD_INPUT, false); è¯»å–è¿‡åï¼Œè¿˜æœ‰å¯¹å€¼çš„åˆæ³•æ€§çš„ä¸€ç³»åˆ—æ£€æŸ¥ï¼Œå¦‚æœè¶…è¿‡äº†é™åˆ¶ï¼Œä¼šç½®ä¸ºé»˜è®¤å€¼ï¼Œå¹¶æ˜¾ç¤ºä¸€ä¸ªè­¦å‘Šã€‚ 12345678910111213141516m_cloud_candidates_number = read (CONFIG_CLOUD_CANDIDATES_NUMBER, 1);if (m_cloud_candidates_number &gt; 10 || m_cloud_candidates_number &lt; 1) &#123; m_cloud_candidates_number = 1; g_warn_if_reached ();&#125;m_cloud_input_source = read (CONFIG_CLOUD_INPUT_SOURCE, 0);if (m_cloud_input_source != BAIDU &amp;&amp; m_cloud_input_source != GOOGLE) &#123; m_cloud_input_source = BAIDU; g_warn_if_reached ();&#125;m_cloud_request_delay_time = read (CONFIG_CLOUD_REQUEST_DELAY_TIME, 600);if (m_cloud_request_delay_time &gt; 2000 || m_cloud_request_delay_time &lt; 200) &#123; m_cloud_request_delay_time = 600; g_warn_if_reached ();&#125; åœ¨æ„é€ å‡½æ•°ä¸­ï¼Œåˆå§‹åŒ–è¿‡é»˜è®¤å€¼ä¹‹åï¼Œä¼šå°† valueChangedCallback å‡½æ•°æ³¨å†Œä¸º changed ä¿¡å·çš„å›è°ƒã€‚ 12345initDefaultValues ();g_signal_connect (m_settings, \"changed\", G_CALLBACK (valueChangedCallback), this); å¦‚æœå€¼å‘ç”Ÿäº†å˜åŒ–ï¼Œè¿™ä¸ªå‡½æ•°ä¼šè¢«è°ƒç”¨ï¼Œç„¶åå¯¹åº”çš„é…ç½®å€¼ä¼šè¢«æ›´æ–°ã€‚ äº‘è¾“å…¥ä¸­è·å–é…ç½®çš„å®ç° ç›®å‰ï¼Œäº‘è¾“å…¥çš„é…ç½®ä»…ä»…åœ¨ CloudCandidates æ„é€ å‡½æ•°ä¸­è¯»å–ï¼š 123m_cloud_source = m_editor-&gt;m_config.cloudInputSource ();m_delayed_time = m_editor-&gt;m_config.cloudRequestDelayTime ();m_cloud_candidates_number = m_editor-&gt;m_config.cloudCandidatesNumber (); ä¹‹åçš„è¿‡ç¨‹éƒ½ç›´æ¥ä½¿ç”¨ CloudCandidates å†…æš‚å­˜çš„é…ç½®å€¼ã€‚ è¿™æ ·é€ æˆçš„é—®é¢˜æ˜¯ï¼Œç”¨æˆ·åœ¨æ›´æ”¹äº†é…ç½®ä¹‹åï¼Œå€¼æ›´æ”¹çš„äº‹ä»¶ä¼šè¢«è§¦å‘ï¼ŒConfig å’Œå®ƒçš„å­ç±»ä¸­çš„å€¼ä¼šæ›´æ–°ä¸ºæ–°å€¼ï¼›ä½† CloudCandidates ä¸­ä»ä¸ºæ—§å€¼ï¼Œåªæœ‰åœ¨åˆ‡æ¢åˆ°å…¶ä»–è¾“å…¥æ³•ï¼Œå†åˆ‡æ¢å›æ¥ï¼ŒCloudCandidates çš„æ„é€ å‡½æ•°æ‰ä¼šå†æ¬¡è¢«è°ƒç”¨ï¼Œæ–°çš„é…ç½®å€¼æ‰ä¼šæ›´æ–°åˆ°è¿™ä¸ªæ–°çš„ CloudCandidates å®ä¾‹ã€‚ ä¼˜åŒ–çš„å…¶ä¸­ä¸€é¡¹æ–¹æ³•æ˜¯å°†æš‚å­˜çš„å€¼å–æ¶ˆï¼Œæ¯æ¬¡ä½¿ç”¨æ—¶ç›´æ¥ä» Config çš„å®ä¾‹è¯»å–ï¼Œè¿™æ ·èƒ½ä¿è¯ä¸€ç›´æ˜¯æœ€æ–°çš„å€¼ã€‚ æ€»ç»“ è¿™ç¯‡æ–‡ç« ç²—ç•¥ä»‹ç»äº†ä½¿ç”¨ GLib çš„ GSettings å®ç°åº”ç”¨ç¨‹åºé…ç½®çš„è¿‡ç¨‹ï¼Œä»¥åŠå…·ä½“çš„åœ¨ ibus-libpinyin ä¸­çš„å®ç°ã€‚","categories":[{"name":"ibus-libpinyin","slug":"ibus-libpinyin","permalink":"https://blog.inoki.cc/categories/ibus-libpinyin/"}],"tags":[{"name":"IBus","slug":"IBus","permalink":"https://blog.inoki.cc/tags/IBus/"},{"name":"ibus-libpinyin","slug":"ibus-libpinyin","permalink":"https://blog.inoki.cc/tags/ibus-libpinyin/"},{"name":"Cloud Input","slug":"Cloud-Input","permalink":"https://blog.inoki.cc/tags/Cloud-Input/"}]},{"title":"KDE Connect å®‰è£… Q&A","slug":"KDEConnect-Install-QA","date":"2020-07-07T23:33:33.000Z","updated":"2025-03-08T09:40:48.574Z","comments":true,"path":"2020/07/07/KDEConnect-Install-QA/","link":"","permalink":"https://blog.inoki.cc/2020/07/07/KDEConnect-Install-QA/","excerpt":"","text":"è¿™ç¯‡æ–‡ç« è®°å½•äº† QQ ç¾¤ä¸­å›ç­”çš„ä¸€äº›å®‰è£…é…ç½®æ–¹é¢çš„é—®é¢˜ã€‚ ç¾¤å·ç ï¼š668331167 æˆ–ç‚¹å‡»é“¾æ¥åŠ å…¥ç¾¤èŠã€KDE Connect ä¸­æ–‡äº¤æµç¾¤ã€‘ Windows å®‰è£…åæ— æ³•è¿è¡Œé—®é¢˜ https://bugs.kde.org/show_bug.cgi?id=412665 æ–‡ä»¶ï¼šbin/data/dbus-1/services/org.kde.kdeconnect.service æŠŠè¿™ä¸ªæ–‡ä»¶é‡Œé¢çš„ExecåŸæœ¬çš„ C:/CraftRoot/bin/kdeconnectd æ”¹æˆ &lt;ä½ çš„å®‰è£…è·¯å¾„&gt;/bin/kdeconnectd æˆ– kdeconnectdã€‚ 32 ä½ç³»ç»Ÿ æš‚æ—¶æ— è§£ï¼Œè¯·ç­‰å¾… KDE çš„æ‰“åŒ…ç³»ç»Ÿæ›´æ–°ã€‚ åŒæ­¥ Win çš„é€šçŸ¥ ç°åœ¨æ¡Œé¢ç‰ˆè¯»å–é€šçŸ¥ä»…é™ KDE plasma ä¸‹å¯ç”¨ã€‚ ä¼ å¤šä¸ªæ–‡ä»¶ å®ƒå®é™…ä¸Šæ˜¯å»å¼€äº† kdeconnect-handlerï¼ŒæŠŠæ–‡ä»¶è·¯å¾„å½“å‚æ•°ä¼ è¿›å»ï¼Œä½†æ˜¯ä¼°è®¡å®ç°ä¸å¥½ï¼ŒæŠŠå¤šä¸ªæ–‡ä»¶è·¯å¾„å½“ä½œä¸€ä¸ªäº†ï¼Œå°±å‡º bugã€‚ å¯ä»¥åœ¨çŠ¶æ€æ å›¾æ ‡é‚£å³é”®é€‰ send filesï¼Œç„¶åå†å¤šé€‰ã€‚ Linux Ubuntu/Debian â€œæ¼”è®²æŒ‡é’ˆâ€æ’ä»¶å´©æºƒ å‰å‡ å¤©æœ‰æœ‹å‹åé¦ˆï¼Œåœ¨ kubuntu ä¸‹çš„ä½¿ç”¨â€œæ¼”è®²æŒ‡é’ˆâ€æ’ä»¶å­˜åœ¨å´©æºƒçš„é—®é¢˜ï¼Œæ˜¯å› ä¸ºç¼ºä¸€ä¸ªè¿è¡Œæ—¶ä¾èµ–ï¼Œå¯ä»¥è¿™æ ·è§£å†³ï¼š 1sudo apt-get install qml-module-qtquick-particles2 Ubuntu å’Œ Kubuntu åº”è¯¥æ˜¯ç›¸ä¼¼çš„ apt æºï¼Œå¯èƒ½ä¹Ÿå­˜åœ¨ç±»ä¼¼çš„é—®é¢˜ Deepin ç³»ç»Ÿè‡ªå¸¦ç‰ˆæœ¬ è¥¿ç­ç‰™äººç»´æŠ¤çš„è½¯ä»¶æºé‡Œé¢æœ‰ 1.0 ç‰ˆæœ¬çš„ indicator-kdeconnect å’Œ kdeconnect æœ¬ä½“ã€‚ éœ€è¦çš„è¯åœ¨å®‰è£…è½¯ä»¶æºä¹‹åå¯ä»¥å®‰è£…ï¼š 123sudo apt updatesudo apt install kdeconnectsudo apt install indicator-kdeconnect Flatpak å…ˆå®‰ä¸Šflatpakï¼Œdebian/ubuntu/deepin å¯ä»¥ç›´æ¥ 1sudo apt install flatpak æ·»åŠ å®˜æ–¹ flathub æºï¼ˆéœ€æŒ‚æ¢¯å­ï¼‰ï¼š 1flatpak remote-add --if-not-exists flathub https://flathub.org/repo/flathub.flatpakrepo æ·»åŠ  KDE å®˜æ–¹ä¾èµ–çš„ flatpak æº 1flatpak remote-add kdeapps http://distribute.kde.org/kdeapps.flatpakrepo åœ¨å®‰è£…ä¹‹åæ‰§è¡Œè¿™ä¸ªå‘½ä»¤ï¼Œå…è®¸ KDE Connect è®¿é—®ä¸‹è½½æ–‡ä»¶å¤¹ï¼š 1sudo flatpak override --filesystem=xdg-download org.kde.kdeconnect ç”µè„‘å‘é€æ–‡ä»¶è¿˜æœ‰é—®é¢˜ã€å¾…ä¿®å¤ã€‘â€”â€” xdg-portal-desktop ç‰ˆæœ¬å¤ªè€ï¼Œè¯»å†™æ–‡ä»¶çš„ bug ç¡®è®¤è‡³å°‘åœ¨ 0.11 ç‰ˆå°±å·²ç»è¢«ä¿®å¤äº†ã€‚å¯ä»¥å°è¯•å®‰è£…æ–°ç‰ˆ xdg-portal-desktop ä¿®å¤ã€‚ å¸è½½ 1flatpak uninstall org.kde.kdeconnect GSConnect https://extensions.gnome.org/extension/1319/gsconnect/ Android Android 10 å‰ªè´´æ¿ Android 10 ä¸è®©åå°åº”ç”¨è®¿é—®å‰ªè´´æ¿äº†ï¼Œæ–°ç‰ˆæœ¬å¯ä»¥ä»é€šçŸ¥æ ä¸»åŠ¨å‘é€å‰ªè´´æ¿å†…å®¹ã€‚ Android æ— æ³•æ¥æ”¶åˆ°æ–‡ä»¶ å¦‚æœæ˜¯ Android 10 çš„è¯éœ€è¦é¢„å…ˆé…ç½®å¥½è®¿é—®æƒé™ï¼š æ’ä»¶è®¾ç½®-ã€‹ FileSystem Expose åŠ ä¸Šä¼ è¾“ç›®å½•å°±è¡Œã€‚ MIUI æœ‰äººåæ˜ è¿‡æœ‰äº›æ–‡ä»¶ä¼ è¾“é—®é¢˜ã€‚ã€‚ã€‚ macOS ç¿»è¯‘é—®é¢˜ åœ¨ä¸­æ–‡ç³»ç»Ÿä¸‹ç•Œé¢ç›®å‰æ²¡æœ‰ç¿»è¯‘ã€‚ macOS ä¸»åŠ¨æŸ¥æ‰¾è®¾å¤‡é—®é¢˜ å‘ç°ä¸€ä¸ª macOS ç‰ˆæœ¬çš„ bugï¼Œmac æ— çº¿ç½‘ç»œä¸æ”¯æŒ 1500 ä»¥ä¸Šçš„ MTUï¼Œæ‰€ä»¥å‘ä¸å‡º UDP å¹¿æ’­è¯†åˆ«åŒ…ã€‚ è§£å†³æ–¹æ³•:ä»æ‰‹æœºç«¯åˆ·æ–°ï¼Œæ‰¾åˆ° Mac å¹¶è¿æ¥é…å¯¹ğŸ˜‚ é…ç½®é¡µé¢ä¸åœ¨æœ€å‰ é…ç½®äº†ä¸è®© KDE Connect çš„å›¾æ ‡åœ¨ Dock æ æ˜¾ç¤ºçš„å‰¯ä½œç”¨ã€‚ å¦‚æœæœ‰éœ€è¦çš„è¯ï¼Œå¯ä»¥æŠŠ kdeconnect-indicator.app/Contents/Info.plist é‡Œçš„ 12&lt;key&gt;LSUIElement&lt;/key&gt;&lt;string&gt;1&lt;/string&gt; åˆ æ‰ï¼Œå°±å¯ä»¥åœ¨æœ€ä¸Šå±‚æ‰“å¼€çª—å£äº†ï¼Œä½†æ˜¯ç›¸åº”çš„ KDE Connect çš„å›¾æ ‡ä¼šåœ¨ Dock ä¸­æ˜¾ç¤ºã€‚ Chrome OS Android å­ç³»ç»Ÿè‡ªå¸¦ NAT æˆ‘æ‰å‘ç° chrome OS ä¹Ÿèƒ½ç”¨ï¼ˆAndroid ç‰ˆçš„ï¼‰ï¼Œä½†æ˜¯å› ä¸ºæœ‰å±‚ NATï¼Œéœ€è¦æ·»åŠ IP+ä» Chrome OS é‡Œå‘èµ·é…å¯¹è¯·æ±‚ğŸ˜‚ ç³»ç»Ÿæ— å…³ æ¢¯å­ç›¸å…³ Chienï¼šä½ æ¢¯å­çš„è§„åˆ™å¯èƒ½æ²¡è®¾ç½®å¥½ï¼Œç»•è¿‡å±€åŸŸç½‘å’Œå¤§é™†åœ°å€æ¯”è¾ƒå¥½ã€‚å›½æƒ…å›½æƒ…ï¼Œå›½å†…ç½‘ç»œç¯å¢ƒå¤ªå¤æ‚äº† è§£å†³æ–¹æ¡ˆï¼š å…ˆæ£€æŸ¥æ˜¯å¦æŒ‚äº†æ¢¯å­ è¯·åœ¨æ¢¯å­çš„ä¾‹å¤–åˆ—è¡¨æ·»åŠ  KDE Connect æˆ–åœ¨ç™½åå•æ·»åŠ è·¯ç”±å™¨å†…ç½‘ å¾®ä¿¡é€šçŸ¥æ— æ³•åŒæ­¥ TIM å¯ä»¥ï¼ŒQQ å¯èƒ½å¯ä»¥ï¼Œå¾®ä¿¡é€šçŸ¥ä¸å®Œå…¨èµ°ç³»ç»Ÿé€šçŸ¥ï¼Œç›®å‰è¿˜æœ‰é—®é¢˜ã€‚","categories":[{"name":"KDE Connect","slug":"KDE-Connect","permalink":"https://blog.inoki.cc/categories/KDE-Connect/"},{"name":"ä¸­æ–‡","slug":"KDE-Connect/ä¸­æ–‡","permalink":"https://blog.inoki.cc/categories/KDE-Connect/ä¸­æ–‡/"}],"tags":[{"name":"KDE Connect","slug":"KDE-Connect","permalink":"https://blog.inoki.cc/tags/KDE-Connect/"}]},{"title":"ã€è¯‘ã€‘ä¸º Rust ç”Ÿæˆ Qt ç»‘å®š","slug":"Rust-Qt-Binding-Generator","date":"2020-07-04T16:51:00.000Z","updated":"2025-03-08T09:40:48.593Z","comments":true,"path":"2020/07/04/Rust-Qt-Binding-Generator/","link":"","permalink":"https://blog.inoki.cc/2020/07/04/Rust-Qt-Binding-Generator/","excerpt":"","text":"åŸæ–‡é“¾æ¥ï¼šhttps://www.vandenoever.info/blog/2017/09/04/rust_qt_binding_generator.html è¿™ç¯‡åšå®¢æ–‡ç« æ˜¯ Rust Qt Binding Generator çš„å‘å¸ƒã€‚è¯¥é¡¹ç›®æ­£åœ¨å®¡æ ¸ä¸­ï¼Œä¹‹åä¼šåŠ å…¥åˆ° KDE å½“ä¸­ã€‚æ‚¨å¯ä»¥åœ¨æ­¤å¤„è·å–æºä»£ç ã€‚ è¯¥ä»£ç ç”Ÿæˆå™¨å¯å¸®åŠ©åœ¨ Qt å’Œ QML ä¸­å¿«é€Ÿå¼€å§‹ä½¿ç”¨ Rust ä»£ç ã€‚æ¢å¥è¯è¯´ï¼Œå®ƒæœ‰åŠ©äºåœ¨ Rust ä»£ç ä¹‹ä¸Šåˆ›å»ºåŸºäº Qt çš„ GUIã€‚ Qtæ˜¯æˆç†Ÿçš„è·¨å¹³å°å›¾å½¢ç”¨æˆ·ç•Œé¢åº“ã€‚è€Œ Rust æ˜¯ä¸€ç§æ–°çš„ç¼–ç¨‹è¯­è¨€ï¼Œå…·æœ‰å¼ºå¤§çš„ç¼–è¯‘æ—¶æ£€æŸ¥å’Œç°ä»£è¯­æ³•ã€‚ å…¥é—¨ æœ‰ä¸¤ä¸ªæ¨¡æ¿é¡¹ç›®å¯å¸®åŠ©æ‚¨å¿«é€Ÿå…¥é—¨ã€‚ä¸€ä¸ªç”¨äº Qt Widgetsï¼Œå¦ä¸€ä¸ªç”¨äº Qt Quickã€‚åªéœ€å¤åˆ¶è¿™äº›æ–‡ä»¶å¤¹ã€ä½œä¸ºæ–°é¡¹ç›®å¼€å§‹ç¼–ç ã€‚ æ–‡ä»¶å…³ç³» Qt Widgets (main.cpp) / Qt Quick (main.qml) âŸµ å†™å‡ºçš„ UI ä»£ç  src/Binding.h, src/Binding.cpp, rust/src/interface.rs âŸµ ä» binding.json ä¸­ç”Ÿæˆ rust/src/implementation.rs âŸµ å†™å‡ºçš„ Rust ä»£ç  ä¸ºäº†ç»“åˆ Qt å’Œ Rustï¼Œéœ€è¦åœ¨ä¸€ä¸ª JSON æ–‡ä»¶ä¸­ç¼–å†™ä¸€ä¸ªæ¥å£ã€‚ç”Ÿæˆå™¨ä¼šä»è¿™ä¸ªæ–‡ä»¶åˆ›å»º Qt ä»£ç å’Œ Rust ä»£ç ã€‚Qt ä»£ç å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚è€Œ Rust ä»£ç æœ‰ä¸¤ä¸ªæ–‡ä»¶ï¼šæ¥å£å’Œå®ç°ã€‚æ¥å£å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚ 12345678910111213141516171819&#123; \"cppFile\": \"src/Binding.cpp\", \"rust\": &#123; \"dir\": \"rust\", \"interfaceModule\": \"interface\", \"implementationModule\": \"implementation\" &#125;, \"objects\": &#123; \"Greeting\": &#123; \"type\": \"Object\", \"properties\": &#123; \"message\": &#123; \"type\": \"QString\", \"write\": true &#125; &#125; &#125; &#125;&#125; è¿™ä¸ªæ–‡ä»¶æè¿°äº† Greeting è¿™ä¸ªå¯¹è±¡çš„ç»‘å®šã€‚å®ƒæœ‰ä¸€ä¸ªå¯å†™å±æ€§ messageã€‚ è¿è¡Œè¿™ä¸ªå‘½ä»¤ï¼ŒRust çš„ Qt ç»‘å®šç”Ÿæˆå™¨ä¼šä»æè¿°ä¸­åˆ›å»ºç»‘å®šæºä»£ç ï¼š 1rust_qt_binding_generator binding.json è¿™ä¸ªè¿‡ç¨‹ä¼šç”Ÿæˆä¸‹é¢å››ä¸ªæ–‡ä»¶ï¼š src/Binding.h src/Binding.cpp rust/src/interface.rs rust/src/implementation.rs åªéœ€è¦æ›´æ”¹ Implementation.rs å³å¯ï¼Œå…¶ä½™æ–‡ä»¶æ˜¯ç»‘å®šæ–‡ä»¶ã€‚Implementation.rs æ˜¯ä½¿ç”¨ä¸€ä¸ªç®€å•å®ç°åˆ›å»ºå‡ºçš„ï¼Œå¸¦æœ‰ä¸€äº›æ³¨é‡Šï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334use interface::*;/// A Greetingpub struct Greeting &#123; /// Emit signals to the Qt code. emit: GreetingEmitter, /// The message of the greeting. message: String,&#125;/// Implementation of the binding/// GreetingTrait is defined in interface.rsimpl GreetingTrait for Greeting &#123; /// Create a new greeting with default data. fn new(emit: GreetingEmitter) -&gt; Greeting &#123; Greeting &#123; emit: emit, message: \"Hello World!\".into(), &#125; &#125; /// The emitter can emit signals to the Qt code. fn emit(&amp;self) -&gt; &amp;GreetingEmitter &#123; &amp;self.emit &#125; /// Get the message of the Greeting fn message(&amp;self) -&gt; &amp;str &#123; &amp;self.message &#125; /// Set the message of the Greeting fn set_message(&amp;mut self, value: String) &#123; self.message = value; self.emit.message_changed(); &#125;&#125; Qt å’Œ QML é¡¹ç›®çš„æ„å»ºå…³é”®æ˜¯ QObject å’Œ Model View ç±»ã€‚ rust_qt_binding_generator è¯»å–ä¸€ä¸ª json æ–‡ä»¶ä»¥ç”Ÿæˆ QObject æˆ– QAbstractItemModel ç±»ï¼Œè¿™äº›ç±»ä¼šè°ƒç”¨ç”Ÿæˆçš„ Rust æ–‡ä»¶ã€‚å¯¹äº JSON æ–‡ä»¶ä¸­çš„æ¯ç§ç±»å‹ï¼Œéƒ½ä¼šç”Ÿæˆåº”å®ç°çš„ Rust Traitã€‚ è¿™æ ·ï¼ŒRust ä»£ç å°±å¯ä»¥ä» Qt å’Œ QML é¡¹ç›®ä¸­è°ƒç”¨äº†ã€‚ Qt Widgets ä¸ Rust è¿™é‡Œçš„ C++ ä»£ç ä½¿ç”¨äº†ä¸Šé¢ç¼–å†™çš„ Rust ä»£ç ã€‚ 1234567#include \"Binding.h\"#include &lt;QDebug&gt;int main() &#123; Greeting greeting; qDebug() &lt;&lt; greeting.message(); return 0;&#125; Qt Quick ä¸ Rust è¿™é‡Œçš„ Qt Quickï¼ˆQMLï¼‰ ä»£ç ä½¿ç”¨äº†ä¸Šé¢ç¼–å†™çš„ Rust ä»£ç ã€‚ 12345678Rectangle &#123; Greeting &#123; id: rust &#125; Text &#123; text: rust.message &#125;&#125; ç¤ºä¾‹ç¨‹åº è¯¥é¡¹ç›®å¸¦æœ‰ä¸€ä¸ªæ¼”ç¤ºåº”ç”¨ç¨‹åºï¼Œè¯¥åº”ç”¨ç¨‹åºæ˜¾ç¤ºäº†åŸºäº Rust çš„ Qt ç”¨æˆ·ç•Œé¢ã€‚ å®ƒä½¿ç”¨äº†å¯¹è±¡ï¼Œåˆ—è¡¨å’Œæ ‘çš„æ‰€æœ‰åŠŸèƒ½ã€‚é˜…è¯»è¿™äº›æ¼”ç¤ºä»£ç æ˜¯å…¥é—¨çš„å¥½æ–¹æ³•ã€‚ Dcoekr å¼€å‘ç¯å¢ƒ ä¸ºäº†å¿«é€Ÿä¸Šæ‰‹ï¼Œè¯¥é¡¹ç›®é™„å¸¦äº†ä¸€ä¸ªDockerfileã€‚æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å¯ä»¥å¯åŠ¨å…·æœ‰æ‰€éœ€ä¾èµ–é¡¹çš„ Docker ä¼šè¯ï¼š 1./docker/docker-bash-session.sh æ›´å¤šä¿¡æ¯ Rust Qt Binding Generator Qt Qt ç¤ºä¾‹ä¸æ•™ç¨‹ The QML Book","categories":[{"name":"Translation","slug":"Translation","permalink":"https://blog.inoki.cc/categories/Translation/"},{"name":"Chinese","slug":"Translation/Chinese","permalink":"https://blog.inoki.cc/categories/Translation/Chinese/"},{"name":"Qt","slug":"Qt","permalink":"https://blog.inoki.cc/categories/Qt/"},{"name":"Rust","slug":"Rust","permalink":"https://blog.inoki.cc/categories/Rust/"}],"tags":[{"name":"ç¿»è¯‘","slug":"ç¿»è¯‘","permalink":"https://blog.inoki.cc/tags/ç¿»è¯‘/"},{"name":"ä¸­æ–‡","slug":"ä¸­æ–‡","permalink":"https://blog.inoki.cc/tags/ä¸­æ–‡/"},{"name":"Qt","slug":"Qt","permalink":"https://blog.inoki.cc/tags/Qt/"},{"name":"Rust","slug":"Rust","permalink":"https://blog.inoki.cc/tags/Rust/"}]},{"title":"ã€è¯‘ã€‘è½¯ä»¶å®šä¹‰æ— çº¿ç”µçš„åŸºç¡€ â€”â€” 2.æ¥æ”¶æœº","slug":"Basic-of-Software-Defined-Radio-2","date":"2020-07-03T20:08:00.000Z","updated":"2025-03-08T09:40:48.547Z","comments":true,"path":"2020/07/03/Basic-of-Software-Defined-Radio-2/","link":"","permalink":"https://blog.inoki.cc/2020/07/03/Basic-of-Software-Defined-Radio-2/","excerpt":"","text":"åŸæ–‡é“¾æ¥ï¼šhttps://www.eetimes.com/sdr-basics-part-2-receivers/ æ¶æ„ ç†æƒ³æƒ…å†µä¸‹ï¼ŒSDR çš„è®¾è®¡äººå‘˜å¸Œæœ›å°†æ•°æ®è½¬æ¢å™¨ç›´æ¥æ”¾åœ¨å¤©çº¿ä¸Šã€‚ä½†æ˜¯ï¼Œè¿™ä¸æ˜¯å®é™…æƒ…å†µä¸­çš„è§£å†³æ–¹æ¡ˆã€‚å®é™…ä¸Šï¼Œä¸€äº›æ¨¡æ‹Ÿå‰ç«¯å¿…é¡»åœ¨æ¥æ”¶è·¯å¾„ä¸­çš„ ADC ä¹‹å‰å’Œå‘é€è·¯å¾„ä¸­çš„æ•°æ¨¡è½¬æ¢å™¨ä¹‹åæ‰èƒ½ä½¿ç”¨ï¼Œæ¥æ‰§è¡Œé€‚å½“çš„é¢‘ç‡è½¬æ¢ã€‚è¿™äº›ä½“ç³»ç»“æ„ä¸­æœ€å¸¸è§çš„æ˜¯è¶…å¤–å·®ï¼ˆsuper-heterodyneï¼‰æ¶æ„ã€‚å°½ç®¡è¿™ç§æ¶æ„å·²ç»æœ‰æ•°åå¹´çš„å†å²äº†ï¼Œä½†å…¨æ–°çš„åŠå¯¼ä½“æŠ€æœ¯å’Œæ›´é«˜çš„é›†æˆåº¦ä½¿è¯¥ä½“ç³»ç»“æ„ä»ç„¶å……æ»¡æ´»åŠ›ï¼Œå¹¶åœ¨å‘é€å’Œæ¥æ”¶ä¿¡å·è·¯å¾„ä¸­éƒ½å¾—åˆ°äº†å¹¿æ³›ä½¿ç”¨[5ï¼Œ6]ã€‚ å…¶ä»–ä½“ç³»ç»“æ„ï¼ˆä¾‹å¦‚ç”¨äºå‘é€å’Œæ¥æ”¶çš„ç›´æ¥è½¬æ¢ï¼‰åœ¨è¦æ±‚ä¸é«˜çš„åº”ç”¨ç¨‹åºä¸­å—åˆ°æ¬¢è¿ã€‚å½“å‰ï¼Œç›´æ¥è½¬æ¢ï¼ˆTxå’ŒRxï¼‰åœ¨ç”¨æˆ·ç»ˆç«¯ä¸­è¢«å‘ç°ç”¨äºèœ‚çªé€šä¿¡ã€ä»¥åŠåœ¨åŸºç«™ä¾§çš„ Txï¼Œéšç€æœªæ¥çš„å‘å±•ï¼Œä¹Ÿå­˜åœ¨äºæ¥æ”¶ç«¯å®ç°ç›´æ¥è½¬æ¢çš„å¯èƒ½æ€§ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œè¶…å¤–å·®æ¶æ„å°†ç»§ç»­ä»¥ä¸€ç§æˆ–å¦ä¸€ç§å½¢å¼ä½¿ç”¨ã€‚ æ¥æ”¶å™¨ é«˜æ€§èƒ½ SDR æ¥æ”¶å™¨é€šå¸¸ç”±è¶…å¤–å·®æ¶æ„çš„æŸäº›å˜ä½“æ„é€ è€Œæˆã€‚è¶…å¤–å·®æ¥æ”¶å™¨å¯åœ¨å¾ˆå¤§çš„é¢‘ç‡èŒƒå›´å†…æä¾›ç¨³å®šçš„æ€§èƒ½ï¼ŒåŒæ—¶ä¿æŒè‰¯å¥½çš„çµæ•åº¦å’Œé€‰æ‹©æ€§[7ï¼Œ8]ã€‚å°½ç®¡è®¾è®¡å¹¶éæ˜“äº‹ï¼Œä½†ç»“åˆä½¿ç”¨å®½å¸¦æ¨¡æ‹ŸæŠ€æœ¯å’Œå¤šä¸ªå‰ç«¯çš„å¯èƒ½æ€§å°†å…è®¸åœ¨ä¸åŒçš„ RF é¢‘æ®µä¸Šè¿›è¡Œæ“ä½œã€‚å¯¹äºå¤šè½½æ³¢åº”ç”¨ï¼Œå¿…è¦æ—¶ä¹Ÿå¯ä»¥åŒæ—¶è¿›è¡Œã€‚ å¤šè½½æ³¢ å–å†³äºåº”ç”¨ç¨‹åºï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦ä¸€ä¸ªæˆ–å¤šä¸ªæ¥æ”¶é€šé“ã€‚ä¼ ç»Ÿåº”ç”¨å¯èƒ½åªéœ€è¦ä¸€ä¸ª RF é€šé“ã€‚ä½†æ˜¯ï¼Œéœ€è¦é«˜å®¹é‡æˆ–äº’æ“ä½œæ€§çš„åº”ç”¨ç¨‹åºå¯èƒ½éœ€è¦å¤šè½½æ³¢è®¾è®¡ã€‚ç”±äº SDR é‡‡ç”¨å…·æœ‰è¶³å¤Ÿå¯ç”¨å¸¦å®½çš„é«˜åº¦è¿‡é‡‡æ · ADC ï¼Œå› æ­¤éå¸¸é€‚åˆå¤šè½½æ³¢åº”ç”¨ã€‚ è¿‡é‡‡æ · ADC æ˜¯ä¸€ç§é‡‡æ ·ç‡è¶…å‡ºäº†æ»¡è¶³å¥ˆå¥æ–¯ç‰¹æŠ½æ ·å‡†åˆ™[18]è¦æ±‚çš„é‡‡æ ·ç‡çš„ ADC ï¼Œè¯¥å‡†åˆ™è§„å®šè½¬æ¢å™¨çš„é‡‡æ ·ç‡å¿…é¡»æ˜¯ä¿¡æ¯å¸¦å®½çš„ä¸¤å€ã€‚ç”±äº SDR å¯èƒ½ä¸æ¸…æ¥šå°†ç”¨äºæ¥æ”¶ä¿¡å·çš„å¸¦å®½ï¼Œå› æ­¤é‡‡æ ·ç‡å¿…é¡»è¶³å¤Ÿé«˜æ‰èƒ½å¯¹æ‰€æœ‰é¢„æœŸçš„å¸¦å®½è¿›è¡Œé‡‡æ ·ã€‚ å½“å‰çš„ ADC æŠ€æœ¯å…è®¸å°†é«˜è¾¾ 100 MHz çš„é«˜åŠ¨æ€èŒƒå›´å¸¦å®½æ•°å­—åŒ–ã€‚æœ‰äº†è¿™ä¹ˆå¤šçš„å¸¦å®½ï¼Œä¹Ÿå°±å¯ä»¥å¤„ç†å¤šä¸ªé€šé“ã€‚å›¾ 18.5 ç»™å‡ºäº†ä¸€ä¸ªå…¸å‹çš„å¤šè½½æ³¢æ¥æ”¶æœºç¤ºä¾‹ï¼Œå›¾ 18.6 ç»™å‡ºäº†å…¶é¢‘è°±æ˜¾ç¤ºã€‚ 18.5. å¤šè½½æ³¢ CDMA ç¤ºä¾‹ 18.6. ä½¿ç”¨ IS-95 çš„å¤šæ¨¡å¼é¢‘è°±å’Œçª„å¸¦è½½æ³¢ åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œ ADC çš„é‡‡æ ·ç‡è®¾ç½®ä¸º 61.44 å…†é‡‡æ ·/ç§’ï¼ˆMSPSï¼‰ï¼Œè¿™æä¾›äº† 30.72 MHz çš„å¥ˆå¥æ–¯ç‰¹å¸¦å®½ã€‚å¦‚æœæ¯ä¸ªRFé€šé“çš„å®½åº¦ä¸º 1.25 MHzï¼Œåˆ™å¥ˆå¥æ–¯ç‰¹è¡¨ç¤ºæ½œåœ¨é¢‘é“çš„æ•°é‡çº¦ä¸º 24.5ã€‚å®é™…ä¸Šï¼Œé€šè¿‡åœ¨æŠ—æ··å æ»¤æ³¢å™¨ä¸Šå…è®¸åˆç†çš„è¿‡æ¸¡å¸¦ï¼Œå…¸å‹çš„å¯ç”¨å¸¦å®½æ˜¯é‡‡æ ·ç‡çš„ä¸‰åˆ†ä¹‹ä¸€ï¼Œè€Œä¸æ˜¯å¥ˆå¥æ–¯ç‰¹çš„ä¸€åŠã€‚å› æ­¤ï¼Œè¿™ä¸ªç¤ºä¾‹çš„å¯ç”¨å¸¦å®½ä¸º 20.48 MHzï¼Œåœ¨ 1.25 MHz å¸¦å®½æ—¶ä»…å…è®¸ 16 ä¸ªé¢‘é“ã€‚ ç”±äºå¯ä»¥æ”¹å˜ä¿¡é“ç‰¹æ€§ï¼Œå› æ­¤å¾ˆå®¹æ˜“å°† CDMA ç¤ºä¾‹æ›´æ”¹ä¸º GSM ç¤ºä¾‹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé€šè¿‡å°†æ•°å­—é€šé“æ»¤æ³¢å™¨ä» GSM æ›´æ”¹ä¸º CDMA å¹¶å°†æ–°çš„å¤„ç†ä»£ç åŠ è½½åˆ° DSP ä¸­ï¼Œåˆ†åˆ«é‡æ–°é…ç½®äº†æ•°å­—é¢„å¤„ç†å’Œé€šç”¨ DSPã€‚ç”±äº GSM ä¿¡é“çš„å®½åº¦ä¸º 200 kHzï¼Œå› æ­¤å¯ä»¥è½»æ¾åœ°å°†è¯¥ç¤ºä¾‹é‡æ–°é…ç½®ä¸º 102 ä¿¡é“çš„ GSM æ¥æ”¶å™¨ã€‚ è™½ç„¶è¿™ä¸¤ä¸ªç¤ºä¾‹éƒ½æä¾›äº†å¾ˆå¤šå®ç”¨æ€§ï¼Œä½†ä¹Ÿè®¸æ›´æœ‰è¶£çš„ç¤ºä¾‹æ˜¯ï¼šé…ç½®æ¥æ”¶å™¨ï¼Œä»¥ä½¿éƒ¨åˆ†ä¿¡é“å¯ä»¥æ˜¯ CDMAï¼Œè€Œå…¶ä»–ä¿¡é“å¯ä»¥é…ç½®ä¸º GSMï¼ æ­¤å¤–ï¼Œå¦‚æœå…¶ä¸­ä¸€ç§é…ç½®å·²æ»¡è´Ÿè·ä½¿ç”¨ï¼Œè€Œå¦ä¸€ç§é…ç½®æœªå¾—åˆ°å……åˆ†åˆ©ç”¨ï¼Œåˆ™å¯ä»¥å°† CDMA ä¿¡é“è½¬æ¢ä¸ºå¤šä¸ª GSM ä¿¡é“ï¼Œåä¹‹äº¦ç„¶ï¼Œä»è€Œå¯ä»¥æ ¹æ®éœ€è¦çµæ´»åœ°åŠ¨æ€é‡æ–°åˆ†é…ç³»ç»Ÿèµ„æºï¼ˆè½¯ä»¶å®šä¹‰æ— çº¿ç”µçš„ä¸»è¦ç›®æ ‡ï¼‰ã€‚ å•è½½æ³¢ å¹¶éæ‰€æœ‰ SDR åº”ç”¨ç¨‹åºéƒ½éœ€è¦ä¸€ä¸ªä»¥ä¸Šçš„ä¿¡é“ã€‚ä½å®¹é‡ç³»ç»Ÿå¯èƒ½åªéœ€è¦ä¸€ä¸ªè½½æ³¢ã€‚åœ¨è¿™äº›åº”ç”¨ä¸­ï¼Œä»ç„¶éœ€è¦ä¸€ä¸ªé«˜çš„è¿‡é‡‡æ ·ç‡ã€‚å¦‚æœè¿™ä¸ªä¿¡é“æ˜¯å¯é‡æ–°ç¼–ç¨‹çš„ï¼Œåˆ™å¯èƒ½ä¼šçª„åˆ°å‡ ä¸ª kHz æˆ– 5-10 MHzã€‚ä¸ºäº†é€‚åº”æ­¤å¸¦å®½èŒƒå›´ï¼Œé‡‡æ ·ç‡åº”é€‚åˆæœ€é«˜çš„æ½œåœ¨å¸¦å®½ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ä¸º 10 MHzã€‚ä»å¤šè½½æ³¢ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸å°†é‡‡æ ·è‡³å°‘ä¸‰å€çš„å¸¦å®½ã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œ30.72 MSPS æˆ–æ›´é«˜çš„é‡‡æ ·ç‡å°†å…è®¸å¤„ç†ä»å‡  kHz åˆ°æœ€é«˜ 10 MHz çš„ä¿¡å·å¸¦å®½ã€‚é™¤äº†åªå¤„ç†ä¸€ä¸ªä¿¡é“ä¹‹å¤–ï¼Œå•è½½æ³¢æ¥æ”¶æœºä¹Ÿå…·æœ‰å¤šè½½æ³¢æ¥æ”¶æœºçš„å…¨éƒ¨å®¹é‡ï¼Œä¹Ÿå¯ä»¥æ ¹æ®éœ€è¦é‡æ–°é…ç½®ã€‚ SDR æ¥æ”¶å™¨çš„å…ƒç´  å‚è€ƒå›¾ 18.7 ä¸­çš„å•è½½æ³¢æ¡†å›¾ï¼ŒåŒæ—¶è¦è®°ä½è¿™ä¹Ÿé€‚ç”¨äºå¤šè½½æ³¢ç¤ºä¾‹ï¼Œä¸€ä¸ªå®Œå…¨å¼€å‘çš„ SDR å°†å…·æœ‰æ‰€æœ‰å¯ç¼–ç¨‹çš„ä¿¡å·å…ƒç´ ã€‚ 18.7. å•è½½æ³¢æ¥æ”¶ç¤ºä¾‹ å¤©çº¿ä¹Ÿä¸ä¾‹å¤–ï¼Œä¹Ÿæ˜¯å¯ç¼–ç¨‹çš„ã€‚ä½†ä¸å¹¸çš„æ˜¯ï¼Œå®ƒæ˜¯ SDR ä¸­æœ€å¼±çš„å…ƒç´ ä¹‹ä¸€[1]ã€‚ç”±äºå¤§å¤šæ•°å¤©çº¿ç»“æ„çš„å¸¦å®½ä»…ä¸ºå…¶ä¸­å¿ƒé¢‘ç‡çš„ä¸€å°éƒ¨åˆ†ï¼Œå› æ­¤å¤šé¢‘å¸¦æ“ä½œä¼šå˜å¾—å›°éš¾ã€‚åœ¨ä½¿ç”¨å•ä¸ªå·¥ä½œé¢‘å¸¦çš„è®¸å¤šåº”ç”¨ä¸­ï¼Œè¿™ä¸æ˜¯ä¸ªé—®é¢˜ã€‚ä½†æ˜¯ï¼Œå¯¹äºå¿…é¡»åœ¨å¤šä¸ªå‡ ä¸ªé¢‘ç‡ä¸Šè¿è¡Œçš„ç³»ç»Ÿï¼Œå¿…é¡»é€šè¿‡æŸç§æ–¹å¼è°ƒæ•´å¤©çº¿ä»¥è·Ÿè¸ªå·¥ä½œé¢‘ç‡ã€ä¿æŒå·¥ä½œæ•ˆç‡ã€‚ çš„ç¡®ï¼Œå‡ ä¹æ‰€æœ‰å¤©çº¿éƒ½å¯ä»¥ä¸æœ‰æºç”µå­è®¾å¤‡è¿›è¡Œé˜»æŠ—åŒ¹é…ï¼Œä½†æ˜¯é€šå¸¸ä¼šç‰ºç‰²é“¾è·¯å¢ç›Šï¼Œä»è€Œå¯èƒ½å¯¼è‡´å¤©çº¿æŸè€—ï¼Œè€Œå¤§å¤šæ•°å¤©çº¿è®¾è®¡å®é™…ä¸Šåº”è¯¥æä¾›é€‚åº¦çš„ä¿¡å·å¢ç›Šã€‚å› æ­¤ï¼Œéœ€è¦é€šè¿‡ç®€å•åœ°æ”¹å˜å¤©çº¿çš„åŒ¹é…æ¥è°ƒæ•´å¤©çº¿çš„ç”µé•¿åº¦ã€‚TODO:å°è¯•è§£é‡Šã€‚ ä¿¡å·é“¾ä¸­çš„ä¸‹ä¸€ä¸ªæ˜¯é¢‘å¸¦é€‰æ‹©æ»¤æ³¢å™¨è¿™ä¸€ç”µå­å™¨ä»¶ã€‚æä¾›è¯¥å…ƒä»¶æ˜¯ä¸ºäº†é™åˆ¶å‘ˆç°ç»™é«˜å¢ç›Šé˜¶æ®µçš„è¾“å…¥é¢‘ç‡çš„èŒƒå›´ï¼Œä»¥æœ€å¤§ç¨‹åº¦åœ°å‡å°äº’è°ƒå¤±çœŸçš„å½±å“ã€‚å³ä½¿åœ¨äº’è°ƒä¸æˆé—®é¢˜çš„æƒ…å†µä¸‹ï¼Œé«˜å¼ºåº¦çš„é¢‘å¸¦å¤–ä¿¡å·ä¹Ÿæœ‰å¯èƒ½åœ¨éšåçš„é˜¶æ®µä¸­é™åˆ¶æ½œåœ¨çš„å¢ç›Šé‡ï¼Œä»è€Œå¯¼è‡´çµæ•åº¦å—é™ï¼Œå°¤å…¶æ˜¯å¯¹äºåœ¨å‘å°„åŠŸç‡ç”µå¹³å¯èƒ½è¶…è¿‡ 100 kW çš„ç”µè§†å’ŒéŸ³é¢‘å¹¿æ’­æœåŠ¡é™„è¿‘è°ƒè°çš„æ¥æ”¶å™¨ã€‚ å¯¹äºå¿…é¡»å¤„ç†è®¸å¤šæ•°é‡çº§ä¿¡å·å¹…åº¦çš„å¤šè½½æ³¢æ¥æ”¶æœºè€Œè¨€ï¼Œè¿™å°¤å…¶æˆé—®é¢˜ã€‚å¦‚æœæ‰€æœ‰ä¿¡å·éƒ½ä»¤äººæ„Ÿå…´è¶£ï¼Œé‚£ä¹ˆå°†ä¸å¯èƒ½å¯¹è¾ƒå¼ºçš„ä¿¡å·è¿›è¡Œæ»¤æ³¢ï¼Œè€Œä¸”å¾—åˆ°çš„æ¥æ”¶å™¨å¿…é¡»å…·æœ‰ç›¸å¯¹è¾ƒå¤§çš„ä¿¡å·åŠ¨æ€èŒƒå›´[8]ã€‚ å¤§å¤šæ•°æ¥æ”¶å™¨éœ€è¦ä¸€ä¸ªä½å™ªå£°æ”¾å¤§å™¨ï¼ˆLNAï¼‰ã€‚ä¸€ä¸ª SDR ç†æƒ³æƒ…å†µä¸‹åº”åŒ…å«èƒ½å¤Ÿåœ¨æ‰€éœ€é¢‘ç‡èŒƒå›´å†…å·¥ä½œçš„ LNAã€‚é™¤äº†å…¸å‹çš„ LNA å’Œ High IP3 ä¹‹å¤–ï¼Œå¯èƒ½è¿˜éœ€è¦å…·æœ‰è°ƒæ•´å¢ç›Šçš„èƒ½åŠ›ï¼Œå¹¶åœ¨å¯èƒ½çš„æƒ…å†µä¸‹æŒ‰æ¯”ä¾‹å‡å°åŠŸç‡ï¼ˆé€šå¸¸æ˜¯ NF å’Œ IP3 è·Ÿè¸ªåç½®ç”µæµï¼‰ï¼Œè¿™å°†å…è®¸å„ç§ä¿¡å·æ¡ä»¶åœ¨æ•´ä¸ªæ“ä½œçš„é¢‘å¸¦èŒƒå›´å†…éƒ½å­˜åœ¨ã€‚// TODO: ä¼˜åŒ–ç¿»è¯‘ æ··é¢‘å™¨ç”¨äºå°† RF é¢‘è°±è½¬æ¢ä¸ºåˆé€‚çš„ IF é¢‘ç‡ã€‚å°½ç®¡åœ¨å›¾ 18.7 ä¸­ä»…æ˜¾ç¤ºäº†ä¸€ä¸ªæ··é¢‘å™¨ï¼Œä½†æ˜¯è®¸å¤šæ¥æ”¶å™¨å¯ä»¥ä½¿ç”¨ä¸¤ä¸ªæˆ–ä¸‰ä¸ªæ··é¢‘å™¨çº§ï¼Œæ¯ä¸ªçº§ä¾æ¬¡äº§ç”Ÿä¸€ä¸ªè¾ƒä½çš„é¢‘ç‡ã€‚ï¼ˆè¯·æ³¨æ„ï¼šæ¥æ”¶å™¨ IF å¹¶ä¸æ€»æ˜¯ä½äº RF ä¿¡å·ã€‚åœ¨é«˜é¢‘æ¥æ”¶å™¨ä¸­å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªå¸¸è§çš„ä¾‹å­ï¼Œåœ¨è¯¥æ¥æ”¶å™¨ä¸­ï¼Œæ‰€éœ€çš„RFä¿¡å·å¯èƒ½åªæœ‰å‡ ä¸ª MHzã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œå®ƒä»¬ç»å¸¸æ··é¢‘åˆ° 10.7 MHzï¼Œ21.4 MHzï¼Œ45 MHz æˆ–æ›´é«˜çš„ IF é¢‘ç‡ï¼Œå› ä¸ºæ‰€éœ€ç»„ä»¶çš„å¯ç”¨æ€§æˆ–æ€§èƒ½ï¼‰æ¯ä¸ªè¿ç»­çº§è¿˜åˆ©ç”¨äº†åˆ†å¸ƒåœ¨æ•´ä¸ªé“¾ä¸­çš„æ»¤æ³¢åŠŸèƒ½ï¼Œä»¥æ¶ˆé™¤ä¸éœ€è¦çš„åƒ/ï¼Œä»¥åŠå…¶ä»–åœ¨æ··åˆè¿‡ç¨‹ä¸­ç•™å­˜ä¸‹æ¥çš„ä¸éœ€è¦çš„ä¿¡å·ã€‚æ»¤æ³¢ä¹Ÿåº”é€‚åˆè¯¥åº”ç”¨ç¨‹åºã€‚ä¼ ç»Ÿçš„å•è½½æ³¢æ¥æ”¶å™¨é€šå¸¸ä¼šé€šè¿‡æ··é¢‘å™¨çº§åº”ç”¨ä¿¡é“æ»¤æ³¢ï¼Œä»¥å¸®åŠ©æ§åˆ¶æ¯çº§çš„ IP3 è¦æ±‚ã€‚è€Œåœ¨å¤šè½½æ³¢æ¥æ”¶æœºçš„æƒ…å†µä¸‹ï¼Œæ— æ³•é¢„å…ˆçŸ¥é“ä¿¡é“å¸¦å®½ï¼Œä»è€Œæ— æ³•è¿›è¡Œæ¨¡æ‹Ÿä¿¡é“æ»¤æ³¢ã€‚ å› æ­¤ï¼Œæ··åˆè¿‡ç¨‹å¿…é¡»ä¿ç•™æ•´ä¸ªæ„Ÿå…´è¶£çš„é¢‘è°±ã€‚åŒæ ·ï¼Œæˆ‘ä»¬çš„å•è½½æ³¢ SDR åº”ç”¨ç¨‹åºä¹Ÿå¿…é¡»ä¿ç•™æœ€å¤§å¯èƒ½çš„é¢‘è°±ï¼Œä»¥é˜² SDR éœ€è¦å…¨é¢‘è°±ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå³ä½¿ä»…å…³æ³¨ä¸€ä¸ªè½½æ³¢ï¼Œæˆ‘ä»¬çš„å•è½½æ³¢ç¤ºä¾‹ä¹Ÿå¯èƒ½æ­£åœ¨å¤„ç†è®¸å¤šè½½æ³¢ã€‚ä¸ LNA ä¸€æ ·ï¼Œæˆ‘ä»¬å¸Œæœ› SDR ä¸­çš„æ··é¢‘å™¨å…·æœ‰å¯è°ƒçš„åç½®ã€‚ä¸ LNA ä¸€æ ·ï¼Œè¯¥åç½®å¯ç”¨äºæ­£ç¡®è®¾ç½®è®¾å¤‡çš„è½¬æ¢å¢ç›Šå’Œ IP3 ä»¥å¯¹åº”äºæ‰€éœ€çš„ä¿¡å·æ¡ä»¶ã€‚ é™¤æ··åˆå™¨ä¹‹å¤–æˆ–ä»£æ›¿æ··åˆå™¨ï¼ŒæŸäº›æ¥æ”¶æœºä½“ç³»ç»“æ„è¿˜ä½¿ç”¨æ­£äº¤è§£è°ƒå™¨ã€‚è§£è°ƒå™¨çš„ç›®çš„æ˜¯åˆ†ç¦» I å’Œ Q åˆ†é‡ã€‚ åˆ†å¼€åï¼ŒI å’Œ Q è·¯å¾„å¿…é¡»ä¿æŒå•ç‹¬çš„ä¿¡å·è°ƒç†ã€‚åœ¨æ•°å­—åŸŸï¼Œè¿™ä¸æ˜¯é—®é¢˜ã€‚ä½†æ˜¯ï¼Œåœ¨æ¨¡æ‹ŸåŸŸä¸­ï¼Œä¿¡å·è·¯å¾„å¿…é¡»å®Œç¾åŒ¹é…ï¼Œå¦åˆ™å°†å¼•å…¥ I/Q ä¸å¹³è¡¡ï¼Œä»è€Œå¯èƒ½é™åˆ¶ç³»ç»Ÿçš„é€‚ç”¨æ€§ã€‚ å¦‚å•è½½æ³¢ç¤ºä¾‹æ‰€ç¤ºï¼Œè®¸å¤š SDR æ¥æ”¶å™¨é€šè¿‡åˆ©ç”¨å®é‡‡æ ·ï¼ˆè€Œä¸æ˜¯å¤é‡‡æ ·ï¼‰æ¥é¿å…æ­¤é—®é¢˜ï¼Œå¹¶åœ¨æ•°å­—é¢„å¤„ç†å™¨ä¸­ä½¿ç”¨å¯æä¾›å®Œç¾æ­£äº¤çš„æ•°å­—æ­£äº¤è§£è°ƒå™¨ã€‚ å½“ä¸è¾“å…¥çš„ RF ä¿¡å·æ··åˆæ—¶ï¼Œæœ¬åœ°æŒ¯è¡å™¨ç”¨äºç”Ÿæˆé€‚å½“çš„ IFã€‚é€šå¸¸ï¼Œæœ¬åœ°æŒ¯è¡å™¨ï¼ˆLOï¼‰çš„é¢‘ç‡å¯å˜ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨ PLL æˆ– DDS æŠ€æœ¯é€šè¿‡è½¯ä»¶æ§åˆ¶è½»æ¾ç¼–ç¨‹ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒLO å¯èƒ½ä¸éœ€è¦è·³é¢‘ã€‚ä¸€ä¸ªä¾‹å­æ˜¯ç”¨äºæ¥æ”¶å›ºå®šé¢‘å¸¦å†…çš„å¤šä¸ªè½½æ³¢ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒLO æ˜¯å›ºå®šçš„ï¼Œå¹¶ä¸”æ•´ä¸ªé¢‘å¸¦è¢«æŒ‰å—è½¬æ¢ä¸ºæ‰€éœ€çš„ä¸­é¢‘ã€‚é€šå¸¸å¯èƒ½éœ€è¦æ›´æ”¹ LO çš„é©±åŠ¨ç”µå¹³ï¼Œä»¥ä¼˜åŒ–å„ç§ä¿¡å·æ¡ä»¶ä¸‹çš„å¯„ç”Ÿ/ä¼ªæ€§èƒ½ã€‚// TODO: ä¼˜åŒ–ç¿»è¯‘ ä¸­é¢‘æ”¾å¤§å™¨é€šå¸¸æ˜¯ AGC å½¢å¼çš„ã€‚AGC çš„ç›®æ ‡æ˜¯åœ¨ä¸è¿‡åº¦é©±åŠ¨ä¿¡å·é“¾å…¶ä½™éƒ¨åˆ†çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨å¯èƒ½çš„æœ€å¤§å¢ç›Šã€‚æœ‰æ—¶ï¼ŒAGC ç”±æ¨¡æ‹Ÿæ§åˆ¶å›è·¯æ§åˆ¶ã€‚ä½†æ˜¯ï¼Œæ•°å­—æ§åˆ¶å›è·¯ä¹Ÿå¯ä»¥ç”¨äºå®ç°ä½¿ç”¨æ¨¡æ‹Ÿåé¦ˆæ— æ³•å®ç°çš„å›°éš¾æ§åˆ¶å›è·¯ã€‚åœ¨å¤šè½½æ³¢åº”ç”¨ä¸­ï¼Œä½¿ç”¨ AGC æœ€å¥½çš„æƒ…å†µä¸‹ä¹Ÿå¾ˆéš¾ã€‚å¦‚æœæ¥æ”¶å™¨ä¸­çš„åŠ¨æ€èŒƒå›´ä¸è¶³ï¼ˆä¸»è¦ç”± ADC å†³å®šï¼‰ï¼Œåˆ™å¼ºä¿¡å·çš„å¢ç›Šé™ä½å¯èƒ½ä¼šå¯¼è‡´è¾ƒå¼±çš„ä¿¡å·åœ¨æ¥æ”¶å™¨çš„æœ¬åº•å™ªå£°ä¸­ä¸¢å¤±ã€‚åœ¨è¿™æ ·çš„åº”ç”¨ä¸­ï¼Œç†æƒ³çš„å¢ç›Šæ•°å­—æ§åˆ¶ç¯è·¯ã€‚åªè¦æ²¡æœ‰ä¿¡å·ä¸¢å¤±çš„å±é™©ï¼Œå°±å¯ä»¥æ­£å¸¸ä½¿ç”¨æ§åˆ¶å›è·¯ã€‚ ç„¶è€Œï¼Œå¦‚æœåœ¨å­˜åœ¨éå¸¸å¼ºçš„ä¿¡å·çš„æƒ…å†µä¸‹æ£€æµ‹åˆ°å¼±ä¿¡å·ï¼Œå¯ä»¥åšå‡ºå†³å®šå…è®¸æœ‰é™é‡çš„å‰Šé™¤ï¼Œè€Œä¸æ˜¯å‡å°‘å¼±ä¿¡å·çš„å¢ç›Šï¼Œè€Œå› æ­¤äº§ç”Ÿå¼±ä¿¡å·ä¸¢å¤±çš„é£é™©ã€‚é€šè¿‡æ•°å­—æ§åˆ¶ç¯è·¯æ¯”é€šè¿‡æ¨¡æ‹Ÿç¯è·¯æ›´å®¹æ˜“æ§åˆ¶æ­¤ç±»æ¡ä»¶æƒ…å†µï¼Œä»è€Œå¯ä»¥æ›´å¥½åœ°æ§åˆ¶æ¥æ”¶å™¨çš„æ€»è½¬æ¢å¢ç›Šã€‚ ADC ç”¨äºå°†ä¸€ä¸ªæˆ–å¤šä¸ª IF ä¿¡å·è½¬æ¢ä¸ºæ•°å­—æ ¼å¼ä»¥è¿›è¡Œå¤„ç†ã€‚ADC é€šå¸¸æ˜¯ç“¶é¢ˆï¼Œè€Œ ADC çš„é€‰æ‹©é€šå¸¸æ˜¯å†³å®š SDR æ¶æ„çš„é©±åŠ¨å› ç´ [1ã€9ã€10]ã€‚é€šå¸¸ï¼Œè®¾è®¡äººå‘˜è¢«è¿«é€‰æ‹©æœ€ä½³çš„å¯ç”¨ ADCï¼Œå› ä¸ºæ„è¯†åˆ°åœ¨è®¸å¤šæƒ…å†µä¸‹ ADC å¯èƒ½ä¼šè¢«è¿‡åº¦æŒ‡å®šã€‚ è¿˜æœ‰ä¸€äº›æ—¶å€™ï¼Œç©ºä¸­æ¥å£æ ‡å‡†å¯èƒ½ä¸é’ˆå¯¹å¤šè½½æ³¢æ¥æ”¶å™¨ï¼Œå¹¶ä¸”æ¯”åœ¨ç°åœºéƒ¨ç½²æ—¶æ‰€è¦æ±‚çš„ ADC è¦å¥½å¾—å¤šï¼Œè¿™ä»…ä»…æ˜¯å› ä¸ºè¯¥æ ‡å‡†è§„å®šäº†æµ‹è¯•æ–¹æ³•ã€‚å¯¹äº ADCï¼Œå¯èƒ½éœ€è¦æ›´æ”¹é‡‡æ ·ç‡ï¼Œè¾“å…¥èŒƒå›´ä»¥åŠæ½œåœ¨çš„æ´»åŠ¨å¸¦å®½ã€‚æ•°å­—é¢„å¤„ç†å™¨å¯ä»¥é‡‡ç”¨å¤šç§å½¢å¼ã€‚å¯¹äºå¾ˆé«˜çš„é‡‡æ ·ç‡å’Œæ•°æ®é€Ÿç‡ï¼Œé€šå¸¸å°†å…¶å®ç°ä¸º FPGA æˆ– ASICã€‚è¿™äº›ç”µè·¯æœ¬è´¨ä¸Šåœ¨åŠŸèƒ½å’Œå‚æ•°èŒƒå›´ä¸Šéƒ½éå¸¸çµæ´»ã€‚å½“ç„¶ï¼Œå¯ä»¥é’ˆå¯¹æ‰€éœ€çš„ä»»ä½•åŠŸèƒ½å¯¹ FPGA è¿›è¡Œç¼–ç¨‹ã€‚é€šå¸¸ï¼Œå°†å¯¹ FPGA è¿›è¡Œç¼–ç¨‹ä»¥æ‰§è¡Œæ­£äº¤è§£è°ƒå’Œè°ƒè°ï¼Œé€šé“æ»¤æ³¢ä»¥åŠæ•°æ®é€Ÿç‡é™ä½ã€‚// TODO: ä¼˜åŒ–ç¿»è¯‘ å…¶ä»–åŠŸèƒ½ï¼Œä¾‹å¦‚ RF åŠŸç‡æµ‹é‡å’Œä¿¡é“çº¿æ€§åŒ–ä¹Ÿæ˜¯å¯èƒ½çš„ã€‚æ‰€æœ‰è¿™äº›å…ƒç´ éƒ½å¯ä»¥ä½¿ç”¨å¤šç§æ•°å­—æŠ€æœ¯è½»æ¾ç”Ÿæˆï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡å°†å„ç§ç³»æ•°åŠ è½½åˆ° FPGA æ¥è½»æ¾è¿›è¡Œç¼–ç¨‹ã€‚é€šè¿‡è¿™æ ·åšï¼Œå¯ä»¥ä½¿ç”¨å•èŠ¯ç‰‡é…ç½®æ¥ç”Ÿæˆæ•°å­—é¢„å¤„ç†å™¨ï¼Œè¿™æ ·çš„æ•°å­—é¢„å¤„ç†å™¨èƒ½å¤Ÿè°ƒæ•´ ADC çš„å¥ˆå¥æ–¯ç‰¹é¢‘å¸¦çš„æ•´ä¸ªèŒƒå›´ï¼Œè¿˜å¯ä»¥è¿‡æ»¤ä»æ•° kHz åˆ°æ•° MHz å¸¦å®½çš„ä¿¡å·ã€‚å½“éœ€è¦å¤šä¸ªé¢‘é“æ—¶ï¼Œå¯ä»¥é‡å¤è®¾è®¡ä»¥å¡«å…… FPGAã€‚å¦‚æœéœ€è¦ä½æˆæœ¬çš„é€‰æ‹©ï¼Œåˆ™å¯ä»¥ä½¿ç”¨æ‰§è¡Œè¿™äº›åŠŸèƒ½çš„å„ç§ ASICï¼Œå®ƒä»¬é€šå¸¸è¢«ç§°ä¸ºé€šé“å™¨ï¼ŒRSP æˆ– DDCã€‚ SDR ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ æ˜¯ DSPã€‚ç”±äºè¿™æ˜¯ä¸€ä¸ªé€šç”¨ DSPï¼Œå› æ­¤å¯ä»¥é’ˆå¯¹ä»»ä½•æ‰€éœ€çš„å¤„ç†ä»»åŠ¡è¿›è¡Œç¼–ç¨‹ã€‚å…¸å‹çš„ä»»åŠ¡åŒ…æ‹¬å‡è¡¡ï¼Œæ£€æµ‹ï¼Œå®ç° rake æ¥æ”¶å™¨çš„åŠŸèƒ½ï¼Œç”šè‡³æ˜¯å®ç°ç½‘ç»œæ¥å£ï¼Œä»…ä¸¾å‡ ä¾‹ã€‚ ç”±äºå®ƒä»¬æ˜¯å®Œå…¨å¯ç¼–ç¨‹çš„ï¼Œå› æ­¤å®ƒä»¬å‡ ä¹å¯ä»¥ç”¨äºä»»ä½•ä¿¡å·å¤„ç†ä»»åŠ¡ï¼Œå¹¶æ§åˆ¶æ¡†å›¾å…¶ä»–å…ƒç´ ä¸­çš„æ‰€æœ‰åŠŸèƒ½ã€‚éšç€ DSP å¤„ç†èƒ½åŠ›çš„æé«˜ï¼Œå®ƒä¹Ÿå¯èƒ½ä¼šæ¥ç®¡æ•°å­—é¢„å¤„ç†å™¨ä¸­çš„è®¸å¤šåŠŸèƒ½ã€‚ æ€»ç»“ ç¬¬ä¸‰éƒ¨åˆ†å°†ä¼šè®²è§£ SDR çš„å‘é€ç«¯ã€‚ å‚è€ƒ J. H. Reed, Software Radio: A Modern Approach to Radio Engineering, Prentice Hall, Upper Saddle River, NJ, 2002. J. Mitola, III, â€œSoftware Radioâ€Cognitive Radio,â€ http://ourworld. compuserve.com/homepages/jmitola/. B. Brannon, D. Efstathiou, and T. Gratzek, â€œA Look at Software Radios: Are They Fact or Fiction?â€ Electronic Design, (December 1998): pp. 117â€³122. B. Clarke and K. Kreitzer, â€œSoftware Radio Concepts,â€ unpublished paper. B. Brannon, â€œDigital-Radio-Receiver Design Requires Reevaluation of Parameters,â€ EDN, 43 (November 1998): pp. 163â€³170. B. Brannon, â€œNew A/D Converter Benefi ts Digital IFs,â€ RF Design, 18 (May 1995): pp. 50â€³65. W. H. Hayward, â€œIntroduction to Radio Frequency Design,â€ The American Radio Relay League, 1994â€³1996. J. J. Carr, Secrets of RF Circuit Design, McGraw-Hill, New York, 2001. B. Brannon, â€œFast and Hot: Data Converters for Tomorrowâ€™s Software-Defi ned Radios,â€ RF Design, 25 (July 2002): pp. 60â€³66. B. Brannon and C. Cloninger, â€œRedefi ning the Role of ADCs in Wireless,â€ Applied Microwave and Wireless, 13 (March 2001): pp. 94â€³105. B. Brannon, â€œDNL and Some of Its Effects on Converter Performance,â€ Wireless Design and Development, 9 (June 2001): p. 10. w.newnespress.com B. Brannon, â€œOvercoming Converter Nonlinearies with Dither,â€ Analog Devices Applications Note AN-410, www.analog.com. W. Kester, â€œHigh-Speed Sampling and High-Speed ADCs,â€ Section 4, High-Speed Design Techniques, www.analog.com. W. Kester, â€œHigh-Speed DACs and DDS Systems,â€ Section 6, High-Speed Design Techniques, www.analog.com. About CDMA and CDMA University. Available at http:// www.qualcomm.com. Specifi cations. Available at http://www.3gpp2.org. R. H. Walden, â€œAnalog-to-Digital Converter Survey and Analysis,â€ IEEE Communications Magazine, 17 (April 1999): pp. 539â€³550. H. Nyquist, â€œCertain Topics in Telegraph Transmission Theory,â€ AIEE Transactions, 47 (April 1928): pp. 617â€³644. AD6645 Datasheet. Available at http://www.analog.com.","categories":[{"name":"Translation","slug":"Translation","permalink":"https://blog.inoki.cc/categories/Translation/"},{"name":"Chinese","slug":"Translation/Chinese","permalink":"https://blog.inoki.cc/categories/Translation/Chinese/"},{"name":"SDR","slug":"SDR","permalink":"https://blog.inoki.cc/categories/SDR/"}],"tags":[{"name":"ç¿»è¯‘","slug":"ç¿»è¯‘","permalink":"https://blog.inoki.cc/tags/ç¿»è¯‘/"},{"name":"ä¸­æ–‡","slug":"ä¸­æ–‡","permalink":"https://blog.inoki.cc/tags/ä¸­æ–‡/"},{"name":"SDR","slug":"SDR","permalink":"https://blog.inoki.cc/tags/SDR/"}]},{"title":"KDE Frameworks - Introduction","slug":"KDE-Frameworks-Introduction","date":"2020-07-02T23:22:00.000Z","updated":"2025-03-08T09:40:48.573Z","comments":true,"path":"2020/07/02/KDE-Frameworks-Introduction/","link":"","permalink":"https://blog.inoki.cc/2020/07/02/KDE-Frameworks-Introduction/","excerpt":"","text":"Note: this is an extraction of KDE Frameworks API with some comments Italics means the project might be interesting to some developers. Bold means the project can be very useful for some applications. The KDE Frameworks build on the Qt framework, providing everything from simple utility classes (such as those in KCoreAddons) to integrated solutions for common requirements of desktop applications (such as KNewStuff, for fetching downloadable add-on content in an application, or the powerful KIO multi-protocol file access framework). The KDE Frameworks can be used in CMake-based and QMake-based projects, and most of them are portable to at least Windows, Mac and Linux. The documentation of each framework has code snippets that show how to include the framework in a QMake or CMake project. The frameworks are divided into four tiers, based on the kind of dependencies that they have. For instance, Tier 1 frameworks depend on Qt and possibly some third-party libraries, but not on other frameworks. This makes them easy to integrate into existing applications. Tier 1 Tier 1 frameworks depend only on Qt (and possibly a small number of other third-party libraries), so can easily be used by any Qt-based project. Framework Type Description Note Attica functional Open Collaboration Services API, version 1.6, REST BluezQt integration Qt wrapper for BlueZ 5 (Bluetooth) DBus API Linux Only BreezeIcons functional Breeze icon theme Beautiful icons ECM functional Extra CMake modules KApiDox functional Scripts and data for building API documentation (dox) in a standard format and style KArchive functional File compression KCalendarCore functional The KDE calendar access library KCGroups functional control cgroup resources through systemd dbus interface Linux only KCodecs functional provide a collection of methods to manipulate strings using various encodings KConfig functional Configuration system gconfig-like KCoreAddons functional Addons to QtCore KDBusAddons functional Addons to QtDBus KDNSSD integration a library for handling the DNS-based Service Discovery Protocol (DNS-SD) KGuiAddons functional Addons to QtGui KHolidays functional Holiday calculation library KI18n functional Advanced internationalization framework KIdleTime functional Monitoring user activity Kirigami2 functional QtQuick plugins to build user interfaces based on the KDE human interface guidelines KItemModels functional Models for Qt Model/View system KItemViews functional Widget addons for Qt Model/View KPlotting functional Lightweight plotting framework KQuickCharts functional A QtQuick module providing high-performance charts I donâ€™t know why, but it only supports Linux and FreeBSD KSyntaxHighlighting functional Syntax Highlighting Kate uses it, helpful for Text Editor KUserFeedback solution User feedback framework KWayland integration Qt-style API to interact with the wayland-client and wayland-server API KWidgetsAddons functional Addons to QtWidgets KWindowSystem integration Access to the windowing system ModemManagerQt integration Qt wrapper for ModemManager API Linux Only NetworkManagerQt integration Qt wrapper for NetworkManager API Linux Only Oxygen-icons functional Oxygen icon theme Prison solution Barcode abstraction layer providing uniform access to generation of barcodes QQC2-Desktop-Style functional QtQuickControls 2 style that integrates with the desktop Solid integration Hardware integration and detection Hardware Discovery, Power Management, Network Management Sonnet solution Support for spellchecking plugin-based spell checking library ThreadWeaver functional High-level multithreading framework job-based interface to queue tasks Tier 2 Tier 2 frameworks additionally depend on tier 1 frameworks, but still have easily manageable dependencies. Framework Type Description Note KActivities solution Runtime and library to organize the user work in separate activities KAuth integration Abstraction to system policy and authentication features run high-privileged tasks (Linux, macOS, etc) KCompletion functional Text completion helpers and widgets completion for user input KContacts functional Support for vCard contacts read/write data in vCard standard (RFC 2425 / RFC 2426) KCrash integration Support for application crash analysis and bug report from apps crash report KDocTools functional Documentation generation from docbook KFileMetaData integration A file metadata and text extraction library extracting the text and metadata from different files KImageFormats functional Image format plugins for Qt additional image format plugins for QtGui (runtime plugin) KJobWidgets functional Widgets for tracking KJob instances widgets for showing progress of asynchronous jobs KNotifications solution Abstraction for system notifications cross-platform notification! KPackage functional Library to load and install packages of non binary files as they were a plugin KPeople functional Provides access to all contacts and the people who hold them gather all types of contacts KPty integration Pty abstraction interfacing with pseudo terminal devices KQuickImageEditor functional QtQuick plugins for image editing UI QtQuick components for image editing, Linux only KUnitConversion functional Support for unit conversion Unit Conversion Syndication functional An RSS/Atom parser library parse RSS (0.9/1.0, 0.91â€¦2.0) and Atom (0.3 and 1.0) feeds Tier 3 Tier 3 frameworks are generally more powerful, comprehensive packages, and consequently have more complex dependencies. Framework Type Description Note Baloo solution Baloo is a file indexing and searching framework for KDE Plasma, Linux/FreeBSD only KActivitiesStats solution A library for accessing the usage data collected by the activities system KBookmarks functional Support for bookmarks and the XBEL format access and manipulate bookmarks KCMUtils integration Utilities for working with KCModules KConfigWidgets integration Widgets for configuration dialogs can be integrated into KDE Plasma system setting KDAV functional The KDav library interact with WebDAV calendars and todos with KJobs KDeclarative functional Provides integration of QML and KDE Frameworks bridge between QML and KDE Frameworks KDED solution Extensible deamon for providing system level services Linux/FreeBSD only KDESu integration Integration with su for elevated privileges su GUI for console mode programs, Linux/FreeBSD only KEmoticons functional Support for emoticons and emoticons themes from text to images in HTML KGlobalAccel integration Add support for global workspace shortcuts Linux/FreeBSD only KIconThemes integration Support for icon themes KInit solution Process launcher to speed up launching KDE applications KIO solution Resource and network access abstraction SFTP, Samba, etc KNewStuff solution Support for downloading application assets from the network collaborative data sharing for applications KNotifyConfig integration Configuration system for KNotify KParts solution Document centric plugin system KRunner solution Parallelized query system KService solution Advanced plugin and service introspection handling desktop services KTextEditor solution Advanced embeddable text editor with rich text support KTextWidgets functional Advanced text editing widgets KWallet solution Secure and unified container for user passwords KXmlGui integration User configurable main windows managing menu and toolbar actions in an abstract way Plasma solution Plugin based UI runtime used to write primary user interfaces KDE Plasma! Purpose integration Offers available actions for a specific purpose allow other apps use this one Tier 4 Tier 4 frameworks can be mostly ignored by application programmers; this tier consists of plugins acting behind the scenes to provide additional functionality or platform integration to existing frameworks (including Qt). Framework Type Description Note FrameworkIntegration integration Workspace and cross-framework integration plugins Porting Aids Porting Aids frameworks provide code and utilities to ease the transition from kdelibs 4 to KDE Frameworks 5. Code should aim to port away from this framework, new projects should avoid using these libraries. Framework Type Description Note KDELibs4Support solution Porting aid from KDELibs4 KDesignerPlugin functional Tool to generate custom widget plugins for Qt Designer/Creator KDEWebKit integration KDE Integration for QtWebKit KHtml solution KHTML APIs KJS functional Support for JS scripting in applications KJsEmbed functional Embedded JS KMediaPlayer integration Plugin interface for media player features Kross solution Multi-language application scripting KXmlRpcClient functional Interaction with XMLRPC services","categories":[{"name":"KDE Frameworks","slug":"KDE-Frameworks","permalink":"https://blog.inoki.cc/categories/KDE-Frameworks/"}],"tags":[{"name":"KDE Frameworks","slug":"KDE-Frameworks","permalink":"https://blog.inoki.cc/tags/KDE-Frameworks/"}]},{"title":"ã€è¯‘ã€‘è½¯ä»¶å®šä¹‰æ— çº¿ç”µçš„åŸºç¡€ â€”â€” 1.æ¦‚è¿°","slug":"Basic-of-Software-Defined-Radio-1","date":"2020-07-02T20:08:00.000Z","updated":"2025-03-08T09:40:48.547Z","comments":true,"path":"2020/07/02/Basic-of-Software-Defined-Radio-1/","link":"","permalink":"https://blog.inoki.cc/2020/07/02/Basic-of-Software-Defined-Radio-1/","excerpt":"","text":"åŸæ–‡é“¾æ¥ï¼šhttps://www.eetimes.com/basics-of-software-defined-radio-part-1/ åœ¨è¿‡å»åå¹´é‡Œï¼ŒåŠå¯¼ä½“ç§‘æŠ€åœ¨æ€§èƒ½å’Œä»·æ ¼æ–¹é¢éƒ½å¤§æœ‰æ”¹å–„ï¼Œè®¸å¤šæ–°å‹çš„æ— çº¿ç”µæŠ€æœ¯ä»å†›ç”¨å’Œç ”å‘å®éªŒå®¤ä¸­æµå‡ºï¼Œå¹¶æˆä¸ºäº†ä¸»æµã€‚å…¶ä¸­ä¸€é¡¹æŠ€æœ¯å°±æ˜¯è½¯ä»¶å®šä¹‰æ— çº¿ç”µã€‚ å°½ç®¡è¿‘äº›å¹´å·²ç»è®¨è®ºäº†å¾ˆå¤šï¼Œè½¯ä»¶æ— çº¿ç”µä»æ²¡æœ‰èƒ½å¤Ÿè¢«å¾ˆå¥½çš„å®šä¹‰ã€‚å¾ˆå¤§ç¨‹åº¦ä¸Šï¼Œè¿™æ˜¯ç”±äºè½¯ä»¶æ— çº¿ç”µæä¾›çš„çµæ´»æ€§ï¼Œå…è®¸å®ƒä»¬åœ¨å®è·µä¸­çš„è®¸å¤šå½¢å¼ä¸Šè¿›è¡Œå˜é€šï¼Œæ¥é€‚åº”ä¸åŒçš„éœ€æ±‚ã€‚ç„¶è€Œï¼Œè½¯ä»¶å®šä¹‰æ— çº¿ç”µï¼Œç®€ç§° SDRï¼Œåœ¨ä¸å…¶ä»–ç±»å‹çš„æ— çº¿ç”µè¿›è¡Œæ¯”è¾ƒçš„æ—¶å€™ï¼Œçš„ç¡®å…·æœ‰è®¸å¤šå”¯ä¸€çš„ç‰¹å¾ã€‚æ°å¦‚å…¶åï¼ŒSDR å…·æœ‰é€šè¿‡è½¯ä»¶æˆ–å¯é‡å®šä¹‰é€»è¾‘æ”¹å˜è‡ªèº«åŠŸèƒ½çš„èƒ½åŠ›ã€‚è¿™äº›äº‹æƒ…æ˜¯ç”±æ•°å­—ä¿¡å·å¤„ç†å™¨ï¼ˆDSPï¼‰æˆ–è€…å¯ç¼–ç¨‹é€»è¾‘é˜µåˆ—ï¼ˆFPGAï¼‰æ¥å®Œæˆçš„ï¼Œæˆ‘ä»¬ä¼šåœ¨ä¹‹åçš„ç« èŠ‚ä¸­å¯¹å®ƒä»¬è¿›è¡Œè®¨è®ºã€‚ ä¸ºäº†ä½¿ç”¨æ•°å­—å¤„ç†ï¼Œå¿…é¡»å°†ä¼ ç»Ÿçš„æ¨¡æ‹Ÿä¿¡å·ä¸æ•°å­—åŸŸè¿›è¡Œç›¸äº’è½¬æ¢ã€‚è¿™é¡¹æ“ä½œæ˜¯ä½¿ç”¨æ¨¡æ•°ï¼ˆADCï¼‰å’Œæ•°æ¨¡ï¼ˆDACï¼‰è½¬æ¢å™¨å®Œæˆçš„ã€‚ä¸ºäº†å……åˆ†åˆ©ç”¨æ•°å­—å¤„ç†çš„ä¼˜åŠ¿ï¼ŒSDR åœ¨ä¿¡å·é“¾ä¸­ã€å°†ä¿¡å·å°½å¯èƒ½å¤šçš„ä¿æŒåœ¨çš„æ•°å­—åŸŸä¸­ï¼Œå¹¶åœ¨å°½å¯èƒ½é è¿‘å¤©çº¿çš„ä½ç½®è¿›è¡Œæ•°å­—åŒ–å’Œä¿¡å·é‡æ„ï¼Œä»è€Œä½¿æ•°å­—æŠ€æœ¯èƒ½å¤Ÿæ‰§è¡Œä¼ ç»Ÿä¸Šç”±æ¨¡æ‹Ÿç»„ä»¶å®Œæˆçš„åŠŸèƒ½ï¼Œä»¥åŠå…¶ä»–åœ¨æ¨¡æ‹Ÿé¢†åŸŸæ— æ³•å®ç°çš„åŠŸèƒ½ã€‚ä½†æ˜¯ï¼Œè¿™æ˜¯æœ‰ä¸€å®šå±€é™çš„ã€‚å°½ç®¡å°† ADC æˆ– DAC ç›´æ¥è¿æ¥åˆ°å¤©çº¿æ˜¯ä¸€ä¸ªç†æƒ³çš„æœ€ç»ˆç›®æ ‡ï¼Œä»å­˜åœ¨æ¨¡æ‹Ÿå‰ç«¯èƒ½å¤Ÿæ”¹è¿›çš„é€‰æ‹©æ€§å’Œçµæ•åº¦é—®é¢˜ã€‚ åœ¨å¤©çº¿å¤„æ•°å­—åŒ–çš„æ›¿ä»£æ–¹æ³•ï¼Œå°±æ˜¯ä½¿ç”¨å®Œå…¨çµæ´»çš„æ¨¡æ‹Ÿå‰ç«¯ï¼ˆAFEï¼‰ï¼Œè¯¥å‰ç«¯èƒ½å¤Ÿå°†å„ç§é¢‘ç‡å’Œé¢‘å¸¦è½¬æ¢ä¸ºæ•°æ®è½¬æ¢å™¨æœ¬èº«å¯ä»¥é€‚å½“å¤„ç†çš„é¢‘ç‡å’Œé¢‘å¸¦[1]ã€‚SDR åœ¨ç”¨äºå¤šè½½æ³¢ã€å•è½½æ³¢ã€å•é¢‘å¸¦ã€å¤šé¢‘å¸¦å’Œå¤šæ¨¡å¼æ”¶å‘å™¨æ—¶æ•ˆæœéå¸¸ç†æƒ³ã€‚å…¶ä¸­ä¸€äº›é—®é¢˜å°†åœ¨ä»¥åä»‹ç»ã€‚å…³é”®åœ¨äºï¼ŒSDR å…·æœ‰è¶…è¶Šç®€å•çš„å•é€šé“ã€å•æ¨¡å¼æ”¶å‘å™¨æŠ€æœ¯çš„èƒ½åŠ›ï¼Œå¹¶ä¸”å¯ä»¥ä»»æ„æ›´æ”¹æ¨¡å¼ï¼Œé¢‘é“å¸¦å®½ã€é€Ÿç‡å’Œè°ƒåˆ¶éƒ½å¯ä»¥é€šè¿‡è½¯ä»¶çµæ´»ç¡®å®šã€‚è¿™äº›ç‰¹æ€§å¯ä»¥é€šè¿‡ç›´æ¥è¾“å…¥ã€è½¯ç›˜ã€æ— çº¿ä¸‹è½½æˆ–é€šè¿‡ä½¿ç”¨ç»†è‡´çš„ä¿¡å·åˆ†æï¼Œé€šè¿‡ç§°ä¸º æ— çº¿ç”µè®¤çŸ¥ çš„è¿‡ç¨‹æ¥æ›´æ”¹ï¼Œè¿™ä¸€è¿‡ç¨‹æ˜¯æŒ‡ç¡®å®šä¿¡æ¯æ˜¯å¦‚ä½•ç¼–ç [2]ã€‚ æ— è®ºé‡‡ç”¨ä½•ç§æ–¹å¼é‡æ–°é…ç½®æ— çº¿ç”µï¼Œå®Œå…¨å®ç°çš„ SDR éƒ½å°†èƒ½å¤Ÿä½¿ç”¨å¯ç¼–ç¨‹çš„ä¿¡é“å¸¦å®½å’Œè°ƒåˆ¶ç‰¹æ€§æ¥æ‰¾åˆ°ä¸€ä¸ªå®½é˜”çš„é¢‘ç‡èŒƒå›´ã€‚ä¸‹è¡¨åˆ—å‡ºäº† SDR çš„ä¸€äº›å¯èƒ½çš„åŠ¨æ€ç‰¹æ€§ï¼š é¢‘é“å¸¦å®½ æ•°æ®é€Ÿç‡ è°ƒåˆ¶ç±»å‹ è½¬æ¢å¢ç›Š é™¤ RF è°ƒè°å¤–ï¼Œæ”¶å‘å™¨è¿˜å¿…é¡»å…·å¤‡åˆ©ç”¨è¿™äº›ç‰¹æ€§ä¸­çš„ä¸€ä¸ªä»¥ä¸Šç‰¹æ€§çš„èƒ½åŠ›ï¼Œæ‰èƒ½è¢«è§†ä¸º SDRã€‚ è½¯ä»¶æ— çº¿ç”µçš„å„ä¸ªæ–¹é¢ æ­£å¦‚å‰é¢çš„åˆ—è¡¨æ‰€ç¤ºï¼ŒSDR å…·æœ‰è®¸å¤šç‰¹å¾ã€‚å°½ç®¡ä¸è¦æ±‚ SDR å…·æœ‰æ‰€æœ‰è¿™äº›ç‰¹å¾ï¼Œä½†æ˜¯éœ€è¦æ‹¥æœ‰ä¸€ä¸ªä»¥ä¸Šè¿™äº›ç‰¹å¾ã€‚æ­¤å¤–ï¼Œå‰é¢çš„ç±»åˆ«å¯ä»¥è¿›ä¸€æ­¥ç»†åˆ†ï¼Œä¸‹é¢å„èŠ‚ä¼šå¯¹å…¶è¿›è¡Œæè¿°ã€‚åº”è¯¥è®°ä½çš„æ˜¯ï¼Œè½¯ä»¶å®šä¹‰æ„å‘³ç€é«˜åº¦çš„çµæ´»æ€§å’Œå¯å˜æ€§ï¼Œå› æ­¤è¯¥è®¨è®ºå¹¶æ²¡æœ‰å›Šæ‹¬æ‰€æœ‰å†…å®¹ï¼Œå¹¶ä¸”ä¼šéšç€æ—¶é—´çš„æ¨ç§»è€Œå˜åŒ–ã€‚ä½†æ˜¯ï¼Œå®ƒå¯ä»¥ä½œä¸ºäº†è§£ SDR å¯èƒ½å­˜åœ¨çš„æ–¹æ–¹é¢é¢çš„èµ·ç‚¹ã€‚ å¤šé¢‘æ®µ å¤§å¤šæ•°ä¼ ç»Ÿçš„æ— çº¿ç”µæ¶æ„åœ¨å•ä¸ªé¢‘æ®µä¸Šæˆ–ä¸€ä¸ªé¢‘ç‡èŒƒå›´ä¸Šæ“ä½œã€‚åœ¨è®¸å¤šåº”ç”¨ä¸­ï¼Œéœ€è¦è¿›è¡Œå¤šç§é¢‘ç‡æ“ä½œã€‚ä¸¾å‡ ä¸ªä¾‹å­ï¼šèœ‚çªé€šä¿¡ï¼Œæ”¿åºœå’Œéæ”¿åºœæœºæ„ä»¥åŠæ™ºèƒ½æ”¶é›†ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œé€šå¸¸çš„åšæ³•æ˜¯ä½¿ç”¨å¤šä¸ªæ— çº¿ç”µï¼Œæ¯ä¸ªæ— çº¿ç”µéƒ½è®¾è®¡ä¸ºåœ¨ä¸€ä¸ªæŒ‡å®šçš„é¢‘æ®µå†…å·¥ä½œã€‚å¤šé¢‘æ®µæ— çº¿ç”µå…·æœ‰æŒ‰é¡ºåºæˆ–åŒæ—¶åœ¨ä¸¤ä¸ªæˆ–å¤šä¸ªé¢‘æ®µä¸Šè¿è¡Œçš„èƒ½åŠ›ï¼Œä¾‹å¦‚åœ¨åŸºç«™å¯èƒ½é“¾æ¥æ¥è‡ªä¸åŒé¢‘æ®µçš„æ‰‹æœºçš„æƒ…å†µä¸‹ã€‚ å¤šè½½æ³¢ å¤šè½½æ³¢æˆ–å¤šé€šé“æ— çº¿ç”µå…·æœ‰ä¸€æ¬¡åŒæ—¶åœ¨ä¸€ä¸ªä»¥ä¸Šé¢‘ç‡ä¸Šè¿è¡Œçš„èƒ½åŠ›ï¼Œå¯ä»¥åœ¨åŒä¸€é¢‘å¸¦å†…ï¼Œæˆ–è€…ä¹Ÿå¯ä»¥åœ¨å¤šé¢‘å¸¦æ— çº¿ç”µçš„æƒ…å†µä¸‹ï¼ŒåŒæ—¶åœ¨ä¸¤ä¸ªä¸åŒé¢‘å¸¦å†…ã€‚é€šå¸¸ï¼Œå¤šè½½æ³¢é€‚ç”¨äºå¯èƒ½åŒæ—¶æœåŠ¡å¤šä¸ªç”¨æˆ·çš„åŸºç«™ï¼Œä½†æ˜¯å®ƒä¹Ÿé€‚ç”¨äºå¯èƒ½æ­£åœ¨ä¸åŒ RF è½½æ³¢ä¸Šå¤„ç†è¯­éŸ³å’Œæ•°æ®çš„ç”¨æˆ·ç»ˆç«¯ã€‚ å¤šæ¨¡å¼ å¤šæ¨¡å¼æ„å‘³ç€èƒ½å¤Ÿå¤„ç†å‡ ç§ä¸åŒç±»å‹çš„æ ‡å‡†ã€‚ æ ‡å‡†åŒ…æ‹¬ AMï¼Œ FMï¼Œ GMSK å’Œ CDMAï¼Œä½†ä¸é™äºè¿™äº›ã€‚SDR èƒ½å¤Ÿä¸è®¸å¤šä¸åŒçš„æ ‡å‡†ä¸€èµ·å·¥ä½œå¹¶ä¸æ–­è¿›è¡Œé‡æ–°ç¼–ç¨‹ã€‚å› æ­¤ï¼Œæ¯”å¤šæ¨¡å¼æ›´å¥½çš„æœ¯è¯­æ˜¯å¤šå˜çš„æ¨¡å¼ï¼Œå…¶æš—ç¤ºç¦»æ•£æ•°é‡çš„æ¨¡å¼ï¼Œæ˜¯ä¸€ç§å¯å˜çš„æ¨¡å¼ï¼Œä¹Ÿæ„å‘³ç€è¿ç»­å¯å˜çš„æ“ä½œæ¨¡å¼ã€‚ä¸å…¶ä»–ç‰¹å¾ä¸€æ ·ï¼Œåœ¨å¤šè½½æ³¢æ— çº¿ç”µçš„æƒ…å†µä¸‹ï¼Œè¿™äº›æ¨¡å¼å¯ä»¥æ˜¯è¿ç»­çš„æˆ–åŒæ—¶çš„ã€‚ å¤šé€Ÿç‡ å¤šé€Ÿç‡ä¸å¤šæ¨¡å¼å¯†åˆ‡ç›¸å…³ã€‚å¤šé€Ÿç‡æ— çº¿ç”µå¯ä»¥åœ¨ä¸åŒçš„é‡‡æ ·ç‡ä¸­å¤„ç†ä¿¡å·é“¾çš„ä¸åŒéƒ¨åˆ†ï¼ˆä¾‹å¦‚åœ¨å¤šé€Ÿç‡æ»¤æ³¢å™¨ä¸­ï¼‰ï¼Œæˆ–æ˜¯å…·æœ‰å¤„ç†éœ€è¦ä¸åŒæ•°æ®é€Ÿç‡çš„ä¸åŒæ¨¡å¼çš„èƒ½åŠ›ã€‚å¤šé€Ÿç‡æ— çº¿ç”µçš„ä¸€ä¸ªç¤ºä¾‹æ˜¯å¯ä»¥å¤„ç† 270.833 kSPS çš„ GSM æˆ– 1.2288 MCPS çš„CDMAçš„æ— çº¿ç”µã€‚ä¸å…¶ä»–ç‰¹å¾ä¸€æ ·ï¼Œè¿™å¯ä»¥åœ¨ä¸åŒçš„è½½æ³¢ä¸Šè¿ç»­æ‰§è¡Œæˆ–åŒæ—¶æ‰§è¡Œã€‚ å¯å˜å¸¦å®½ å¯å˜å¸¦å®½æ˜¯å¤šæ¨¡å¼çš„å¦ä¸€ä¸ªæ–¹é¢ã€‚ ä¼ ç»Ÿæ— çº¿ç”µä½¿ç”¨å›ºå®šçš„æ¨¡æ‹Ÿæ»¤æ³¢å™¨ï¼ˆä¾‹å¦‚ SAW æˆ–é™¶ç“·æ»¤æ³¢å™¨ï¼‰æ¥ç¡®å®šä¿¡é“å¸¦å®½ã€‚ ä½†æ˜¯ï¼ŒSDR ä½¿ç”¨å¯ä»¥æ›´æ”¹çš„æ•°å­—æ»¤æ³¢å™¨æ¥ç¡®å®šé€šé“å¸¦å®½ã€‚å°½ç®¡å¯ä»¥ä½¿ç”¨ä¸€ç³»åˆ—å¼€å…³æ¨¡æ‹Ÿæ»¤æ³¢å™¨æ¥æ›´æ”¹ä¼ ç»Ÿæ¥æ”¶å™¨ä¸­çš„ä¿¡é“å¸¦å®½ï¼Œä½†å…¶ä¸­åªæœ‰å°‘æ•°å‡ ä¸ªå®ç”¨ã€‚å¦å¤–ï¼Œæ•°å­—æ»¤æ³¢å™¨å…·æœ‰å®ç°æ¨¡æ‹ŸåŸŸä¸­ä¸å¯èƒ½çš„æ»¤æ³¢å™¨çš„æ½œåŠ›ã€‚ æœ€åï¼Œæ•°å­—æ»¤æ³¢å™¨ä¹Ÿæ˜¯å¯ä»¥å®šåˆ¶çš„ï¼Œä»¥é€‚åº”å¹²æ‰°æºå¹¶è¡¥å¿ä¼ è¾“è·¯å¾„å¤±çœŸï¼Œè¿™æ˜¯æ¨¡æ‹Ÿæ»¤æ³¢å™¨éš¾ä»¥å®ç°çš„ä¸¤ä¸ªåŠŸèƒ½ã€‚ æ€»ç»“ ç¬¬äºŒéƒ¨åˆ†ä¼šç€çœ¼äºæ¥æ”¶å™¨ï¼Œæè¿° SDR çš„æ¶æ„ã€‚ å‚è€ƒ J. H. Reed, Software Radio: A Modern Approach to Radio Engineering, Prentice Hall, Upper Saddle River, NJ, 2002. J. Mitola, III, â€œSoftware Radioâ€Cognitive Radio,â€ http://ourworld.compuserve.com/homepages/jmitola/.","categories":[{"name":"Translation","slug":"Translation","permalink":"https://blog.inoki.cc/categories/Translation/"},{"name":"Chinese","slug":"Translation/Chinese","permalink":"https://blog.inoki.cc/categories/Translation/Chinese/"},{"name":"SDR","slug":"SDR","permalink":"https://blog.inoki.cc/categories/SDR/"}],"tags":[{"name":"ç¿»è¯‘","slug":"ç¿»è¯‘","permalink":"https://blog.inoki.cc/tags/ç¿»è¯‘/"},{"name":"ä¸­æ–‡","slug":"ä¸­æ–‡","permalink":"https://blog.inoki.cc/tags/ä¸­æ–‡/"},{"name":"SDR","slug":"SDR","permalink":"https://blog.inoki.cc/tags/SDR/"}]},{"title":"äº‘è¾“å…¥åœ¨ ibus-libpinyin ä¸­çš„å®ç° - çŠ¶æ€ä¸é”™è¯¯å¤„ç†","slug":"IBus-libpinyin-cloud-input-state-and-error-handle","date":"2020-06-15T16:33:00.000Z","updated":"2025-03-08T09:40:48.568Z","comments":true,"path":"2020/06/15/IBus-libpinyin-cloud-input-state-and-error-handle/","link":"","permalink":"https://blog.inoki.cc/2020/06/15/IBus-libpinyin-cloud-input-state-and-error-handle/","excerpt":"","text":"ä¸Šä¸€ç¯‡æ–‡ç« æè¿°äº†äº‘è¾“å…¥éƒ¨åˆ†å‘å‡ºè¯·æ±‚ï¼Œæ¥æ”¶åˆ°å›å¤ä¹‹åå¯¹å›å¤çš„éªŒè¯ã€å¤„ç†ï¼Œä»¥åŠå¯¹è¿”å›çš„å€™é€‰è¯çš„æå–ã€‚åœ¨å–å¾—å€™é€‰ä¹‹åï¼Œä¼šå°†å…¶åŠ å…¥åˆ° parser ä¸­çš„ m_candidates åˆ—è¡¨ä¸­ï¼Œå¹¶è¿”å›ä¸€ä¸ªçŠ¶æ€ï¼›è‹¥æ²¡æœ‰å–å¾—å€™é€‰æˆ–è€…åœ¨éªŒè¯è¿‡ç¨‹ä¸­å‘ç°äº†é—®é¢˜ï¼Œä¹Ÿä¼šè¿”å›ä¸€ä¸ªæŒ‡å‡ºé—®é¢˜çš„é”™è¯¯çŠ¶æ€ã€‚ è¿™ç¯‡æ–‡ç« æ¥ç€è¿™ä¸ªæµç¨‹ï¼Œå™è¿°åœ¨ä»£ç ä¸­æ˜¯å¦‚ä½•å¯¹è¿™äº›çŠ¶æ€æˆ–é”™è¯¯è¿›è¡Œä¸€ç³»åˆ—å¤„ç†çš„ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œåœ¨å‘é€è¯·æ±‚å‰å’Œå‘é€è¯·æ±‚æ—¶ä¹Ÿæœ‰ç›¸åº”çš„çŠ¶æ€ï¼Œè¿™ç¯‡æ–‡ç« çš„æœ€åä¹Ÿä¼šå¯¹è¿™ä¸ªè¿‡ç¨‹è¿›è¡Œæè¿°ã€‚ ç”±äºä¹‹å‰çš„ç‰ˆæœ¬å¹¶æ²¡æœ‰çŠ¶æ€ä¸é”™è¯¯å¤„ç†çš„æµç¨‹ï¼Œå› æ­¤åœ¨è¿™ç¯‡æ–‡ç« ä¸­ä¸å†å¯¹ 18 å’Œ 20 ç‰ˆè¿›è¡ŒåŒºåˆ†ï¼Œåªæè¿°æœ€æ–°ç‰ˆæœ¬ä¸­çš„åšæ³•ã€‚ çŠ¶æ€æŒ‡ç¤ºå­—ç¬¦ä¸² åœ¨å¤„ç†è¿‡ç¨‹ä¸­ï¼Œä¼šä½¿ç”¨ä¸€ç³»åˆ—å­—ç¬¦ä¸²è¢«æ›´æ–°åˆ°å€™é€‰åˆ—è¡¨ä¸­ï¼Œç”¨æ¥æ›¿ä»£æœ€åˆçš„å ä½ç¬¦ï¼Œå‘Šè¯‰ç”¨æˆ·äº‘è¾“å…¥å€™é€‰å¤„ç†å½“å‰çš„çŠ¶æ€ï¼š å·²è¿‡æœŸ: 1234567static const std::string CANDIDATE_CLOUD_PREFIX = \"â˜\";static const std::string CANDIDATE_PENDING_TEXT = CANDIDATE_CLOUD_PREFIX;static const std::string CANDIDATE_LOADING_TEXT = CANDIDATE_CLOUD_PREFIX + \"...\";static const std::string CANDIDATE_NO_CANDIDATE_TEXT = CANDIDATE_CLOUD_PREFIX + \"[No Candidate]\";static const std::string CANDIDATE_INVALID_DATA_TEXT = CANDIDATE_CLOUD_PREFIX + \"[Invalid Data]\";static const std::string CANDIDATE_BAD_FORMAT_TEXT = CANDIDATE_CLOUD_PREFIX + \"[Bad Format]\"; æ›´æ–°ï¼š 1234567891011static const std::string CANDIDATE_PENDING_TEXT_WITHOUT_PREFIX = \"[â±ï¸]\";static const std::string CANDIDATE_LOADING_TEXT_WITHOUT_PREFIX = \"...\";static const std::string CANDIDATE_NO_CANDIDATE_TEXT_WITHOUT_PREFIX = \"[ğŸš«]\";static const std::string CANDIDATE_INVALID_DATA_TEXT_WITHOUT_PREFIX = \"[âŒ]\";static const std::string CANDIDATE_BAD_FORMAT_TEXT_WITHOUT_PREFIX = \"[â“]\";static const std::string CANDIDATE_PENDING_TEXT = CANDIDATE_CLOUD_PREFIX + CANDIDATE_PENDING_TEXT_WITHOUT_PREFIX;static const std::string CANDIDATE_LOADING_TEXT = CANDIDATE_CLOUD_PREFIX + CANDIDATE_LOADING_TEXT_WITHOUT_PREFIX;static const std::string CANDIDATE_NO_CANDIDATE_TEXT = CANDIDATE_CLOUD_PREFIX + CANDIDATE_NO_CANDIDATE_TEXT_WITHOUT_PREFIX;static const std::string CANDIDATE_INVALID_DATA_TEXT = CANDIDATE_CLOUD_PREFIX + CANDIDATE_INVALID_DATA_TEXT_WITHOUT_PREFIX ;static const std::string CANDIDATE_BAD_FORMAT_TEXT = CANDIDATE_CLOUD_PREFIX + CANDIDATE_BAD_FORMAT_TEXT_WITHOUT_PREFIX; å…¶ä¸­ï¼Œå¸¦æœ‰ WITHOUT_PREFIX åç¼€çš„åœ¨çŠ¶æ€æ”¹å˜æ—¶ï¼Œä¼šè¢«å‚¨å­˜åœ¨ç¼“å­˜çš„å€™é€‰åˆ—è¡¨ m_candidates ä¸­ï¼Œæ›´æ–°å€™é€‰æ—¶æ·»åŠ åˆ°å€™é€‰åˆ—è¡¨ä¸­ã€‚ è¿™äº›å­—ç¬¦ä¸²å¸¦æœ‰ä¸€ä¸ª â€œâ˜â€ çš„å‰ç¼€ï¼Œåé¢åˆ™æ˜¯å¯¹åº”çš„çŠ¶æ€å­—ç¬¦ä¸²ã€‚ CANDIDATE_PENDING_TEXT ç”¨æ¥æŒ‡ç¤ºè¯·æ±‚è¿˜æœªå‘é€ï¼› CANDIDATE_LOADING_TEXT åœ¨è¯·æ±‚å·²å‘é€ï¼Œä½†æœªæ”¶åˆ°æœ‰æ•ˆå›å¤æ—¶æ˜¾ç¤ºã€‚ å…¶ä»–ä¸‰ä¸ªåˆ™æ˜¯ç”¨æ¥æ˜¾ç¤ºå¤„ç†è¯·æ±‚çš„å›å¤æ—¶çš„é”™è¯¯çŠ¶æ€ã€‚ å¤„ç†å›å¤æ—¶å¯èƒ½çš„é”™è¯¯/çŠ¶æ€ åœ¨ CloudCandidates.cpp ä¸­ï¼Œå®šä¹‰äº†ä¸€ç³»åˆ—å¯èƒ½çš„é”™è¯¯æˆ–çŠ¶æ€ï¼š 12345678enum CandidateResponseParserError &#123; PARSER_NOERR, PARSER_INVALID_DATA, PARSER_BAD_FORMAT, PARSER_NO_CANDIDATE, PARSER_NETWORK_ERROR, PARSER_UNKNOWN&#125;; å…¶ä¸­ PARSER_NOERR æ˜¯æ²¡æœ‰å‘ç°å¤„ç†è¿‡ç¨‹ä¸­å­˜åœ¨é—®é¢˜ã€‚ PARSER_INVALID_DATA å’Œ PARSER_BAD_FORMAT æ˜¯æŒ‡åœ¨éªŒè¯è¿‡ç¨‹ä¸­å‘ç°è¿”å›çš„ç»“æ„ä¸åŒã€æˆ–è€…è¿”å›çš„ç»“æœæ— æ•ˆã€‚ å¦‚æœåˆ°æœ€åï¼Œå‘ç°äº‘è¾“å…¥æºæ²¡æœ‰è¿”å›ä»»ä½•å€™é€‰ï¼Œé‚£ä¹ˆå°±ç”¨ PARSER_NO_CANDIDATE é€šçŸ¥ä¸Šå±‚ã€‚ ä»¥ä¸Šå‡ ä¸ªé”™è¯¯æˆ–çŠ¶æ€éƒ½åœ¨ä¸Šç¯‡æ–‡ç« ã€Šäº‘è¾“å…¥åœ¨ ibus-libpinyin ä¸­çš„å®ç° - å€™é€‰è¯è§£æã€‹ä¸­å‡ºç°è¿‡ã€‚ è€Œ PARSER_NETWORK_ERROR æ¯”è¾ƒç‰¹æ®Šï¼Œå®ƒä»…ä»…ç”¨åœ¨å–å¾—çš„å›å¤çš„è¾“å…¥æµ/ç¼“å†²åŒºæ— æ•ˆæ—¶ï¼Œå®ƒä»…ä»…åœ¨ CloudCandidatesResponseJsonParser è¢«è¿”å›ï¼š 1234567guint CloudCandidatesResponseJsonParser::parse (GInputStream *stream)&#123; /* ... */ if (!stream) return PARSER_NETWORK_ERROR; /* ... */&#125; å¦‚æœè¾“å…¥æµæˆ–è€…ç¼“å†²åŒºçš„è¯»å–æ²¡æœ‰é—®é¢˜ï¼Œå°±äº¤ç»™å…·ä½“å®ç°çš„ parseJsonResponse å»è§£æï¼Œå¹¶è¿”å›å®ƒä¼ å›çš„é”™è¯¯ï¼ˆæ— é”™è¯¯åˆ™è¿”å› PARSER_NOERRï¼‰ã€‚ æœ€åä¸€ä¸ª PARSER_UNKNOWN ä»…ä½œä¿ç•™ï¼Œæ²¡æœ‰ä½¿ç”¨ã€‚ é”™è¯¯/çŠ¶æ€çš„å¤„ç† å¤„ç†æ”¶åˆ°çš„å›å¤æ—¶ï¼Œæ˜¯ç”± CloudCandidates ä¸­çš„ processCloudResponse æ–¹æ³•æ¥è°ƒç”¨å…·ä½“çš„ Parser å®ç°çš„ parse æ–¹æ³•çš„ï¼Œè¿”å›çš„é”™è¯¯ä¹Ÿå°±å‚¨å­˜åœ¨ processCloudResponse æ–¹æ³•çš„ ret_code å˜é‡ä¸­ï¼š 1ret_code = parser-&gt;parse (stream); æ¥ä¸‹æ¥ä¼šå…ˆå¯¹å¤„ç†è¿‡ç¨‹ä¸­ä¸€ä¸ªé‡è¦çš„æµç¨‹â€”â€”å¦‚ä½•æ›¿æ¢å€™é€‰åˆ—è¡¨ä¸­çš„äº‘è¾“å…¥å ä½ç¬¦ï¼Œè¿›è¡Œæè¿°ã€‚ç„¶åæ˜¯å¯¹å„ä¸ªé”™è¯¯ç±»å‹çš„å¤„ç†ã€‚ æ›¿æ¢å ä½ç¬¦ã€æ›´æ–°å€™é€‰çš„æ–¹æ³• åœ¨å¤„ç†æ—¶ï¼Œå¾ˆé‡è¦çš„ä¸€ä¸ªæ“ä½œæ˜¯æ‰¾åˆ°ä¹‹å‰æ’å…¥çš„äº‘è¾“å…¥å ä½ç¬¦çš„ä½ç½®ï¼Œä»¥ä¾¿æ›´æ–°å ä½ç¬¦å¤„çš„æ–‡æœ¬ã€‚ ä½¿ç”¨è¿­ä»£å™¨è®°å½• ä¸Šä¸ª 20 ç‰ˆçš„ç‰ˆæœ¬ä¸­ï¼Œåœ¨æ’å…¥å ä½ç¬¦æ—¶ï¼Œm_cloud_candidates_first_pos å’Œ m_candidates_end_pos è®°å½•ä¸‹æ¥çš„äº†äº‘è¾“å…¥å ä½ç¬¦çš„å¼€å§‹ä½ç½®å’Œç»“æŸä½ç½®ã€‚è¿™é‡Œçš„ m_cloud_candidates_first_pos æŒ‡å‘æ•´å¥å€™é€‰ä¹‹åçš„ç¬¬ä¸€ä¸ªä½ç½®ï¼Œè€Œ m_candidates_end_pos æŒ‡å‘å®ƒä¹‹åç¬¬ N ä¸ªä½ç½®ï¼Œå…¶ä¸­ N ä¸ºé…ç½®çš„äº‘è¾“å…¥å€™é€‰è¯ä¸ªæ•°ã€‚ åœ¨è¿›è¡Œæ›´æ–°å ä½ç¬¦æ—¶ï¼Œä½¿ç”¨ä¸‹é¢çš„å¾ªç¯å³å¯ï¼Œä¹‹åçš„ç« èŠ‚ä¸­ä¸å†ç´¯è¿°ï¼š 123for (std::vector&lt;EnhancedCandidate&gt;::iterator pos = m_cloud_candidates_first_pos; pos != m_candidates_end_pos; ++pos) &#123; /* ... */&#125; è¿™ç§æ–¹æ³•çš„ç¡®èƒ½æé«˜æ›´æ–°é€Ÿåº¦ï¼Œå› ä¸ºå®ƒå‡å°‘äº†æ¯æ¬¡ä»å¤´æŸ¥æ‰¾çš„å¤šä½™æ“ä½œã€‚ä½†æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œå¦‚æœäº‘è¾“å…¥æ’å…¥å ä½ç¬¦å¹¶è®°å½•ä¸‹æ¥ä¹‹åï¼Œå…¶ä»–å€™é€‰å¤„ç†è¿‡ç¨‹åˆæ·»åŠ äº†æ–°çš„å€™é€‰ï¼Œè¿™æ—¶è¿™ä¸¤ä¸ªè¿­ä»£å™¨çš„æŒ‡å‘å¯èƒ½å°±ä¸å¯¹äº†ã€‚ æ¯”å¦‚ï¼Œåœ¨äº‘è¾“å…¥è¿›è¡Œ processCandidates ä¹‹åï¼Œ Lua è„šæœ¬å€™é€‰åˆåœ¨ç›¸åŒä½ç½®ï¼ˆæ•´å¥å€™é€‰ä¹‹åçš„ç¬¬ä¸€ä¸ªä½ç½®ï¼‰è¿›è¡Œäº†æ·»åŠ å’Œå¤„ç†ï¼Œè¿™æ—¶ m_cloud_candidates_first_pos çš„æŒ‡å‘å®é™…ä¸Šæ˜¯ Lua è„šæœ¬å€™é€‰è¯ï¼Œäºæ˜¯åœ¨æ›´æ–°è¿‡ç¨‹ä¸­ï¼Œå®ƒï¼ˆä»¬ï¼‰å°±ä¼šè¢«äº‘è¾“å…¥çš„å€™é€‰è¦†ç›–æ‰ã€‚ æˆ‘é‡‡ç”¨çš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼Œå°†äº‘è¾“å…¥çš„å€™é€‰å¤„ç†æ”¾åˆ°æœ€åã€‚ ä¸è®°å½•äº‘å ä½ç¬¦çš„ä½ç½® ä¸ºäº†è§£å†³ä½¿ç”¨è¿­ä»£å™¨è®°å½•äº§ç”Ÿçš„é—®é¢˜ï¼Œå†åŠ ä¸Šæ¯æ¬¡äº‘è¾“å…¥è¯·æ±‚éƒ½ä¼šè®°å½•è¯·æ±‚çš„æ‹¼éŸ³ã€å¹¶ä¿å­˜å·²è§£æçš„å€™é€‰ï¼Œæœ€è¿‘çš„ 20 ç‰ˆäº‘è¾“å…¥å·²ç»å¯ä»¥é€šè¿‡ editor çš„ updateCandidates è°ƒç”¨ CloudCandidates çš„ processCandidates æ­£å¸¸æ›´æ–°å€™é€‰ã€‚ ä½¿ç”¨ä¸‹æ ‡è®°å½• è€Œä¹‹å‰çš„ç‰ˆæœ¬æ˜¯ä½¿ç”¨ä¸€ä¸ªå›ºå®šå¼€å§‹ä¸‹æ ‡å’Œå›ºå®šçš„å ä½ç¬¦ä¸ªæ•°æ¥è®°å½•ï¼Œè¿™ç§è®°å½•æ–¹æ³•å¯èƒ½ä¼šå¯¼è‡´ç¨‹åºåœ¨ç‰¹å®šæƒ…å†µä¸‹å´©æºƒã€‚æ¯”å¦‚ï¼Œå›ºå®šçš„å¼€å§‹ä¸‹æ ‡ä¸º2æ—¶ï¼Œå‡å¦‚åªæœ‰ä¸€ä¸ªåŒ¹é…çš„å€™é€‰ï¼Œä½¿ç”¨2è¿™ä¸ªä¸‹æ ‡è®¿é—®å€™é€‰è¯åˆ—è¡¨ï¼Œå°±ä¼šå‘ç”Ÿè¶Šç•Œçš„é—®é¢˜ã€‚ å¤„ç† PARSER_NETWORK_ERROR é¦–å…ˆè¿›è¡Œå¤„ç†çš„æ˜¯æœ€ç‰¹æ®Šçš„é”™è¯¯çŠ¶æ€ï¼Œå³ç½‘ç»œå‡ºé”™æ—¶ã€‚ 1pos-&gt;m_display_string = CANDIDATE_INVALID_DATA_TEXT; åœ¨è¾“å…¥æˆ–è€…ç¼“å†²åŒºä¸å¯ç”¨æ—¶ï¼Œä¼šæŠŠæ‰€æœ‰çš„å ä½ç¬¦éƒ½ä¿®æ”¹ä¸ºæ˜¾ç¤ºæœ€å¼€å§‹æåˆ°çš„ä¸€ç³»åˆ—çŠ¶æ€æŒ‡ç¤ºå­—ç¬¦ä¸²ä¸­çš„ CANDIDATE_INVALID_DATA_TEXTã€‚ å¤„ç† PARSER_NETWORK_ERROR ä¹‹å å¦‚æœæ²¡æœ‰å‘ç”Ÿç½‘ç»œé”™è¯¯ï¼Œè¯´æ˜è‡³å°‘å›å¤æ˜¯è¢«å¤„ç†äº†çš„ã€‚è€ƒè™‘åˆ°å¼‚æ­¥è¯·æ±‚æ— æ³•ä¿è¯å…ˆåé¡ºåºï¼Œåœ¨è¿›è¡Œæ¥ä¸‹æ¥çš„å…¶ä»–åˆ¤æ–­æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›ç¡®å®šåœ¨å¤„ç†çš„çš„ç¡®æ˜¯æœ€è¿‘ä¸€æ¬¡è¯·æ±‚çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåªæœ‰åœ¨è¿™ä¸ªåˆ¤æ–­ç¡®è®¤æ˜¯æœ€è¿‘ä¸€æ¬¡çš„è¯·æ±‚æ—¶ï¼Œæ‰è¿›ä¸€æ­¥åˆ¤æ–­ä¹‹åçš„å°èŠ‚é‡Œæè¿°çš„å…¶ä»–çŠ¶æ€ã€‚ æˆ‘çš„æ–¹æ³•æ˜¯åˆ¤æ–­ parser ä¸­è·å–åˆ°çš„æ‹¼éŸ³æ˜¯å¦ä¸å½“å‰ç¼–è¾‘å™¨ä¸­çš„ä¸€è‡´ï¼š 1234else if (!g_strcmp0 (annotation, text) || !g_strcmp0 (annotation, double_pinyin_text))&#123; /* ... */&#125; åœ¨ä¸Šä¸€ç¯‡ä¸­çš„ç« èŠ‚ ä¸¤ä¸ªæºè¿”å›ç»“æœä¸Šçš„å·®å¼‚ ä¸­ï¼Œæœ‰æåˆ°ä»ç™¾åº¦æºè§£æå‡ºçš„æ‹¼éŸ³æ˜¯è¿›è¡Œäº†è‡ªåŠ¨è¡¥å…¨çš„ï¼Œè¿™ç§æƒ…å†µä¸‹å°±ä¼šå¯¼è‡´è¿™é‡Œçš„åˆ¤æ–­ç»“æœä¸ºå‡ï¼Œä»è€Œå¯¼è‡´ç»“æœè¢«ä¸¢å¼ƒã€‚ ç›®å‰é‡‡ç”¨çš„æ–¹æ¡ˆæ˜¯ï¼Œå¯¹ç™¾åº¦æºä¸è¿›è¡Œè¿™ä¸€åˆ¤æ–­ã€‚å› æ­¤ï¼Œåœ¨æ–°ç‰ˆæœ¬ä¸­è¿™ä¸ªæ¡ä»¶æ·»åŠ äº†å½“å‰ä½¿ç”¨çš„æ˜¯å¦æ˜¯ç™¾åº¦æºçš„åˆ¤æ–­ã€‚ å¤„ç† PARSER_NOERR è¿™æ˜¯æ— é”™è¯¯çš„æƒ…å†µã€‚ 1234if (ret_code == PARSER_NOERR)&#123; /* update to the candidates list */ std::vector&lt;std::string&gt; &amp;updated_candidates = parser-&gt;getStringCandidates (); é¦–å…ˆï¼Œå°†è·å–åˆ°çš„å‚¨å­˜åœ¨ parser ä¸­çš„å€™é€‰å–å‡ºã€‚ 12std::vector&lt;EnhancedCandidate&gt;::iterator pos = m_cloud_candidates_first_pos;std::vector&lt;EnhancedCandidate&gt;::iterator cached_candidate_pos = m_candidates.begin(); æ‰¾åˆ°å€™é€‰è¯åˆ—è¡¨ä¸­å ä½ç¬¦çš„åˆå§‹ä½ç½®ï¼Œè·å–åœ¨ CloudCandidates ç¼“å­˜çš„å ä½ç¬¦çš„è¿­ä»£å™¨ã€‚ 1234567891011121314 for (guint i = 0; cached_candidate_pos != m_candidates.end() &amp;&amp; pos != m_candidates_end_pos &amp;&amp; i &lt; updated_candidates.size (); ++i, ++pos, ++cached_candidate_pos) &#123; /* display candidate with prefix in lookup table */ EnhancedCandidate &amp; enhanced = *pos; enhanced.m_candidate_id = i; enhanced.m_display_string = CANDIDATE_CLOUD_PREFIX + updated_candidates[i]; /* cache candidate without prefix in m_candidates */ EnhancedCandidate &amp; cached = *cached_candidate_pos; cached.m_display_string = updated_candidates[i]; cached.m_candidate_id = enhanced.m_candidate_id; &#125;&#125; ç´§æ¥ç€å¯¹æ¯ä¸ªå€™é€‰è¯åˆ—è¡¨ä¸­çš„å ä½ç¬¦è¿›è¡Œæ›´æ–°ï¼Œå°†å…¶ä¿®æ”¹ä¸º &quot;â˜&quot; + å€™é€‰è¯ï¼ŒåŒæ—¶å°†ç¼“å­˜çš„å ä½ç¬¦ä¿®æ”¹ä¸ºä¸å¸¦ &quot;â˜&quot; çš„å€™é€‰è¯ï¼Œå¹¶åŒæ­¥å¯¹åº”çš„å€™é€‰åœ¨å€™é€‰è¯åˆ—è¡¨ä¸­çš„ idã€‚è¿™æ ·ï¼Œå½“ç”¨æˆ·é€‰æ‹©ä¸€ä¸ªå€™é€‰æ—¶ï¼Œåªéœ€è¦éå†ç¼“å­˜åœ¨ CloudCandidates ä¸­çš„å€™é€‰ï¼Œå°†ä¼ å…¥çš„å€™é€‰ï¼ˆä¸ºç”¨æˆ·é€‰ä¸­çš„ï¼‰ä¿®æ”¹ä¸ºç¼“å­˜çš„å¯¹åº”çš„ä¸å¸¦æœ‰ &quot;â˜&quot; çš„é¡¹å¹¶è¿”å›ã€‚ åœ¨ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œç¼“å­˜çš„å ä½ç¬¦æ²¡æœ‰è¢«å¾ˆå¥½çš„ä½¿ç”¨ï¼Œå½“ç”¨æˆ·é€‰æ‹©æ—¶ï¼Œä¼šå»éå†ä¼ å…¥çš„é€‰ä¸­çš„å€™é€‰çš„å­—ç¬¦å†…å®¹ï¼Œå¦‚æœæ‰¾åˆ° &quot;â˜&quot; æ ‡è®°ï¼Œåˆ™å°†å…¶ç§»é™¤å¹¶è¿”å›ã€‚ æ–°çš„å®ç°æ›´å¥½ä¸€äº›ï¼Œèƒ½å¤Ÿç‰©å°½å…¶ç”¨ï¼Œå°†ç¼“å­˜çš„å€™é€‰æœ€å¤§ç¨‹åº¦åˆ©ç”¨ä¸Šã€‚ è¯¦ç»†çš„ç”¨æˆ·é€‰æ‹©åçš„æ“ä½œåœ¨ã€Šäº‘è¾“å…¥åœ¨ ibus-libpinyin ä¸­çš„å®ç° - æ¦‚è¿°ã€‹ å¤„ç†ç”¨æˆ·é€‰æ‹©çš„å€™é€‰ ä¸€ç« ã€‚ å¤„ç† PARSER_NO_CANDIDATE è¿™ç§æƒ…å†µæ˜¯æŒ‡ç»“æ„æ­£ç¡®ã€è§£æè¿‡ç¨‹ä¸­æ²¡æœ‰å‡ºç°é—®é¢˜ï¼Œä½†æ²¡æœ‰è§£æå‡ºå€™é€‰ã€‚ 1pos-&gt;m_display_string = CANDIDATE_NO_CANDIDATE_TEXT; æˆ‘è®¤ä¸ºè¿™åº”å½“æ˜¯ä¸€ä¸ªå‡ºç°äº†é”™è¯¯çš„çŠ¶æ€ï¼Œè€Œä¸æ˜¯è¯´æ˜¯å•çº¯çš„æ²¡æœ‰å€™é€‰ã€‚å› æ­¤ï¼Œè¿™é‡ŒæŠŠæ‰€æœ‰çš„å ä½ç¬¦éƒ½ä¿®æ”¹ä¸ºçŠ¶æ€æŒ‡ç¤ºå­—ç¬¦ä¸²ä¸­çš„ CANDIDATE_NO_CANDIDATE_TEXTã€‚ å¤„ç† PARSER_INVALID_DATA è¿™ç§æƒ…å†µå‘Šè¯‰ç”¨æˆ·ï¼Œè¯·æ±‚æ—¶è¿”å›çš„æ•°æ®æ— æ•ˆã€‚ 1pos-&gt;m_display_string = CANDIDATE_INVALID_DATA_TEXT; ç±»ä¼¼çš„ï¼ŒæŠŠæ‰€æœ‰çš„å ä½ç¬¦éƒ½ä¿®æ”¹ä¸ºçŠ¶æ€æŒ‡ç¤ºå­—ç¬¦ä¸²ä¸­çš„ CANDIDATE_INVALID_DATA_TEXTã€‚ å¤„ç† PARSER_BAD_FORMAT åœ¨å¤„ç†æ—¶å‘ç°æ•°æ®çš„æ ¼å¼æœ‰é—®é¢˜ï¼Œå°±ä¼šè¿”å›è¿™ç§é”™è¯¯çŠ¶æ€ï¼Œè¿™ç§æƒ…å†µå¯èƒ½åœ¨è¾“å…¥æµæˆ–ç¼“å†²åŒºä¸å®Œæ•´æ—¶å‡ºç°ã€‚æ¯”å¦‚è¿™é‡Œçš„è¯»å–æµå¹¶è¿›è¡Œ Json è§£ææ—¶ï¼š 123456/* parse Json from input steam */if (!json_parser_load_from_stream (m_parser, stream, NULL, error) || error != NULL)&#123; g_input_stream_close (stream, NULL, error); /* Close stream to release libsoup connexion */ return PARSER_BAD_FORMAT;&#125; åŒæ ·ï¼Œè¿™é‡ŒæŠŠæ‰€æœ‰çš„å ä½ç¬¦éƒ½ä¿®æ”¹ä¸ºçŠ¶æ€æŒ‡ç¤ºå­—ç¬¦ä¸²ä¸­çš„ CANDIDATE_BAD_FORMAT_TEXTã€‚ 1pos-&gt;m_display_string = CANDIDATE_BAD_FORMAT_TEXT; ä¸åŒé˜¶æ®µä¸‹çš„çŠ¶æ€ é™¤äº†ä¸Šè¿°çš„å¯¹æ”¶åˆ°çš„å›å¤çš„è§£ææ—¶çš„é”™è¯¯æˆ–çŠ¶æ€çš„å¤„ç†ï¼Œåœ¨æ­¤ä¹‹å‰ï¼Œè¿˜æœ‰å¯¹å»¶æ—¶è¯·æ±‚å’Œç­‰å¾…å›å¤ä¸¤ä¸ªçŠ¶æ€ã€‚è¿™ä¸¤ä¸ªçŠ¶æ€å¯ä»¥ç®€åŒ–åœ¨å‡ºç°é”™è¯¯æ—¶å¯¹é”™è¯¯çš„å®šä½ã€‚ å»¶è¿Ÿè¯·æ±‚çŠ¶æ€ åœ¨å€™é€‰è¯åˆ—è¡¨æ’å…¥å ä½ç¬¦æ—¶ï¼Œå ä½ç¬¦çš„åˆå§‹æ˜¾ç¤ºä¸º CANDIDATE_PENDING_TEXTã€‚æ’å…¥å ä½ç¬¦ä¹‹åï¼Œå³è¿›å…¥å»¶æœŸç­‰å¾…çŠ¶æ€ã€‚ ç­‰å¾…å›å¤çŠ¶æ€ åœ¨å»¶æ—¶ç­‰å¾…ç»“æŸä¹‹åï¼ŒcloudAsyncRequest æ–¹æ³•ä¼šè¢«è°ƒç”¨ç”¨æ¥å‘é€è¯·æ±‚ã€‚ 12345678910111213141516171819voidCloudCandidates::cloudAsyncRequest (const gchar* requestStr)&#123; /* ... */ SoupMessage *msg = soup_message_new (\"GET\", queryRequest); soup_session_send_async (m_session, msg, NULL, cloudResponseCallBack, static_cast&lt;gpointer&gt; (this)); m_message = msg; /* update loading text to replace pending text */ for (std::vector&lt;EnhancedCandidate&gt;::iterator pos = m_cloud_candidates_first_pos; pos != m_candidates_end_pos; ++pos) &#123; if (CANDIDATE_CLOUD_INPUT == pos-&gt;m_candidate_type) &#123; if (CANDIDATE_PENDING_TEXT == pos-&gt;m_display_string) &#123; pos-&gt;m_display_string = CANDIDATE_LOADING_TEXT; &#125; &#125; else break; &#125; /* ... */&#125; åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œè¯·æ±‚å‘é€å®Œæˆä¹‹åï¼Œä¼šå°†å ä½ç¬¦æ›´æ–°ä¸º CANDIDATE_LOADING_TEXTã€‚ æ€»ç»“ è¿™ç¯‡æ–‡ç« è®²è¿°äº†äº‘è¾“å…¥çš„ä¸åŒé˜¶æ®µä¸‹å¯¹çŠ¶æ€çš„å¤„ç†ï¼Œä»¥åŠè§£æè¯·æ±‚çš„å›å¤ä¹‹åã€å¯¹è§£ææˆåŠŸä¸å¦çš„çŠ¶æ€å’Œé”™è¯¯çš„å¤„ç†ã€‚ å®ƒä»¬éƒ½å°†ç‰¹å®šçš„å­—ç¬¦ä¸²æ›´æ–°åˆ°äº†å€™é€‰è¯åˆ—è¡¨ä¸­ï¼Œä½†è¿™ä¸ªåˆ—è¡¨æ˜¯å­˜åœ¨åœ¨ ibus-libpinyin ä¸­çš„ï¼ŒçœŸæ­£æ˜¾ç¤ºåœ¨ç”¨æˆ·çœ¼å‰ï¼Œåˆ™æ˜¯é€šè¿‡ ibus-libpinyin é€šçŸ¥ ibus æœ‰æ–°çš„å€™é€‰åˆ—è¡¨å®Œæˆçš„ã€‚è¿™ä¸€è¿‡ç¨‹åœ¨ã€Šäº‘è¾“å…¥åœ¨ ibus-libpinyin ä¸­çš„å®ç° - æ¦‚è¿°ã€‹20-ç‰ˆå¼‚æ­¥è¯·æ±‚ä¸­æœ‰ç›¸å…³è§£é‡Šã€‚ ä¸‹ä¸€ç¯‡æ–‡ç« ä¼šé‡ç‚¹è®¨è®ºä¸€ä¸‹ä¸äº‘è¾“å…¥æœ‰å…³çš„é…ç½®é¡¹ã€‚åˆ°è¿™é‡Œï¼Œäº‘è¾“å…¥çš„æ•´ä½“æµç¨‹åº”å½“å·²ç»æ¯”è¾ƒæ¸…æ¥šäº†ï¼Œæˆ‘è¿˜ä¼šç»§ç»­è·Ÿç€å¼€å‘è¿‡ç¨‹æ›´æ–°è¿™å‡ ç¯‡æ–‡ç« ä¸­ç›¸å…³çš„å†…å®¹ã€‚ ä¸å‡ºæ„å¤–ï¼Œåœ¨äº‘è¾“å…¥åˆå¹¶ä¹‹åï¼Œä¸‹ä¸€æ­¥å°±æ˜¯å®ç°åŒæ‹¼å½¢ç ç›¸å…³çš„åŠŸèƒ½äº†ã€‚","categories":[{"name":"ibus-libpinyin","slug":"ibus-libpinyin","permalink":"https://blog.inoki.cc/categories/ibus-libpinyin/"}],"tags":[{"name":"IBus","slug":"IBus","permalink":"https://blog.inoki.cc/tags/IBus/"},{"name":"ibus-libpinyin","slug":"ibus-libpinyin","permalink":"https://blog.inoki.cc/tags/ibus-libpinyin/"},{"name":"Cloud Input","slug":"Cloud-Input","permalink":"https://blog.inoki.cc/tags/Cloud-Input/"}]},{"title":"äº‘è¾“å…¥åœ¨ ibus-libpinyin ä¸­çš„å®ç° - å€™é€‰è¯è§£æ","slug":"IBus-libpinyin-cloud-input-candidate-parser","date":"2020-06-05T23:55:00.000Z","updated":"2025-03-08T09:40:48.566Z","comments":true,"path":"2020/06/05/IBus-libpinyin-cloud-input-candidate-parser/","link":"","permalink":"https://blog.inoki.cc/2020/06/05/IBus-libpinyin-cloud-input-candidate-parser/","excerpt":"","text":"ä¸Šä¸€ç¯‡æ–‡ç« ç²—ç•¥åœ°ä»‹ç»äº†ç›®å‰åœ¨ ibus-libpinyin çš„äº‘è¾“å…¥å®ç°çš„æ•´ä¸ªæµç¨‹ï¼Œå…¶ä¸­å¯¹è¯·æ±‚è¿”å›ç»“æœçš„è§£ææ²¡æœ‰æåŠã€‚è¿™ç¯‡æ–‡ç« ä¼šé‡ç‚¹é˜è¿°è¿”å›ç»“æœçš„è§£ææ˜¯å¦‚ä½•å®ç°çš„ï¼Œä¹‹åçš„è¿‡ç¨‹ï¼ŒåŒ…æ‹¬åœ¨å€™é€‰åˆ—è¡¨ä¸­æ›´æ–°å ä½ç¬¦ã€é”™è¯¯å¤„ç†ï¼Œä¼šåœ¨ä¸‹ä¸€ç¯‡ä¸­è¯¦ç»†è®²è§£ã€‚ æ³¨ï¼šåŒä¸Šä¸€ç¯‡æ–‡ç« ä¸€æ ·ï¼Œä¹‹å‰çš„ç‰ˆæœ¬ç§°ä¸º 18 ç‰ˆäº‘è¾“å…¥ï¼Œç°åœ¨çš„ä¸€ç³»åˆ—ç‰ˆæœ¬ç§°ä¸º 20 ç‰ˆã€‚ è¿”å›ç»“æœçš„ç¤ºä¾‹ ç›®å‰ï¼Œäº‘è¾“å…¥åŠŸèƒ½å¯é€‰çš„æœ‰ Google å’Œç™¾åº¦ä¸¤ä¸ªæºï¼Œå¯èƒ½æ˜¯ä¸ºäº†è®©å¢™å†…å¤–çš„ç”¨æˆ·éƒ½èƒ½ä½¿ç”¨å§ã€‚ å…¶ä¸­ï¼Œä¸€ä¸ªå…¸å‹çš„ Google æºè¿”å›ç»“æœå¦‚ä¸‹ï¼š 1[\"SUCCESS\",[[\"ceshi\",[\"æµ‹è¯•\"],[],&#123;\"annotation\":[\"ce shi\"],\"candidate_type\":[0],\"lc\":[\"16 16\"]&#125;]]] å…³é”®çš„è¯·æ±‚å‚æ•°ä¸ºï¼š å‚æ•°å å‚æ•°å€¼ text ceshi num 1 å…¶ä¸­ text æ˜¯è¯·æ±‚çš„æ‹¼éŸ³ï¼Œnum æ˜¯æœŸæœ›è¿”å›çš„å€™é€‰ä¸ªæ•°ã€‚ ç™¾åº¦æºçš„è¿”å›ç»“æœåŠå…¶å¯¹åº”çš„è¯·æ±‚å‚æ•°æ˜¯ï¼š 1&#123;\"errmsg\":\"\",\"errno\":\"0\",\"result\":[[[\"ç™¾åº¦\",5,&#123;\"pinyin\":\"bai'du\",\"type\":\"IMEDICT\"&#125;]],\"bai'du\"],\"status\":\"T\"&#125; å‚æ•°å å‚æ•°å€¼ input baidu ed 1 è¿™é‡Œï¼Œinput æ˜¯è¯·æ±‚çš„æ‹¼éŸ³ï¼Œè€Œ ed æ˜¯è¯·æ±‚çš„å€™é€‰è¯ä¸ªæ•°ã€‚ å¯ä»¥çœ‹å‡ºï¼Œä¸¤ä¸ªæºè¿”å›çš„éƒ½æ˜¯ json å­—ç¬¦ä¸²ï¼Œå¹¶ä¸”æ ¼å¼è¿˜ç®—æ˜¯æ¸…æ™°ã€‚æ¥ä¸‹æ¥å°±æ˜¯æŠŠå€™é€‰ï¼ˆæ¯”å¦‚ Google æºçš„ç¤ºä¾‹ä¸­çš„â€œæµ‹è¯•â€å’Œç™¾åº¦æºçš„ç¤ºä¾‹ä¸­çš„â€œç™¾åº¦â€ï¼‰è§£ææå–å‡ºæ¥çš„è¿‡ç¨‹ã€‚ 18 ç‰ˆè§£æå®ç° 18 ç‰ˆçš„äº‘è¾“å…¥ä½¿ç”¨äº†ä¸€ä¸ªéå¸¸ç®€æ˜“çš„è§£ææ–¹å¼ï¼šå°†å›å¤å­˜å…¥å­—ç¬¦ä¸²ï¼Œé€šè¿‡æˆªå–å­ä¸²çš„æ–¹å¼å¤„ç†å­—ç¬¦ä¸²æ¥æå–å€™é€‰ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œé¦–å…ˆè¦å°†å›å¤æ”¾å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­ã€‚ å°†å›å¤æ”¾å…¥å­—ç¬¦ä¸² åœ¨ 18 ç‰ˆä¸­ï¼Œæ— è®ºæ˜¯åŒæ­¥æ¨¡å¼è¿˜æ˜¯å¼‚æ­¥æ¨¡å¼ï¼Œç»“æœæœ€ç»ˆéƒ½è¢«å‚¨å­˜åœ¨å«åš res çš„å­—ç¬¦ä¸²ä¸­ã€‚ åŒæ­¥ åŒæ­¥æ¨¡å¼ä¸‹ï¼Œåœ¨è¯·æ±‚å®Œå…¨ç»“æŸåï¼ŒæŠŠæ¶ˆæ¯å–å‡ºå¹¶ç½®å…¥ buffer ç¼“å†²åŒºï¼Œæœ€åæ”¾å…¥ res ä¸­ã€‚ 1234567891011SoupMessageBody *msgBody =soup_message_body_new ();soup_message_body_truncate (msgBody);msgBody = msg-&gt;response_body;/* clear useless characters */soup_message_body_flatten(msgBody);SoupBuffer *bufferBody= soup_message_body_get_chunk(msgBody, 0);const gchar *buffer= bufferBody-&gt;data;String res;res.clear ();res.append (buffer); å¼‚æ­¥ å¼‚æ­¥æ¨¡å¼ä¸‹ï¼Œåœ¨è¯·æ±‚å®Œæˆåå¯ä»¥è·å–åˆ°å›å¤çš„è¾“å…¥æµã€‚ 12GError **error = NULL;GInputStream *stream = soup_session_send_finish (SOUP_SESSION(source_object), result, error); ç„¶åä»è¾“å…¥æµä¸­è¯»å–å­—ç¬¦åˆ° buffer å˜é‡ä¸­ï¼Œæœ€åå°†å…¶æ”¾å…¥ res å­—ç¬¦ä¸²ä¸­ã€‚ 12345678gchar buffer[BUFFERLENGTH];error = NULL;g_input_stream_read (stream, buffer, BUFFERLENGTH, NULL, error);CloudCandidates *cloudCandidates = static_cast&lt;CloudCandidates *&gt; (user_data);String res;res.clear ();res.append (buffer); å¼‚æ­¥æ¨¡å¼ä¸‹ï¼Œè¿”å›çš„è¾“å…¥æµå¹¶ä¸ä¸€å®šåŒ…å«å®Œæ•´çš„å­—ç¬¦ä¸²ï¼Œå¤§éƒ¨åˆ†å»¶è¿Ÿè¾ƒé«˜çš„æƒ…å†µä¸‹ï¼Œå½“æ‰§è¡Œåˆ°ä¸Šé¢ä»£ç ä¸­çš„ g_input_stream_read æ—¶ï¼Œæµä¸­çš„å†…å®¹éƒ½ä¸æ˜¯å®Œæ•´çš„ï¼Œä»è€Œå¯¼è‡´ res ä¸­åªå‚¨å­˜äº†å‰å‡ ä¸ªå­—ç¬¦ï¼Œè¿™ä¼šå¯¼è‡´ä¸‹é¢å­—ç¬¦ä¸²å¤„ç†æ—¶ç¨‹åºå´©æºƒã€‚ é€šè¿‡å­—ç¬¦ä¸²å¤„ç†è§£æå€™é€‰ å¯¹ç™¾åº¦æºçš„å›å¤çš„è§£ææ˜¯ä¸€ä¸ªç®€æ˜“çš„å­—ç¬¦ä¸²åˆ¤æ–­ä¸æå–ï¼š 12345678910111213141516/*BAIDU */if (res[11]=='T')&#123; if (res[49] !=']') &#123; /*respond true , with results*/ gchar **resultsArr = g_strsplit(res.data()+49, \"],\", 0); guint resultsArrLength = g_strv_length(resultsArr); for(int i = 0; i != resultsArrLength-1; ++i) &#123; int end =strcspn(resultsArr[i], \",\"); std::string tmp = g_strndup(resultsArr[i]+2,end-3); cloudCandidates-&gt;m_candidates[i].m_display_string = tmp; &#125; &#125;&#125; ä»£ç ä¸­å¤šå¤„å‡ºç°äº†ç¡¬ç¼–ç  res æ•°ç»„ä¸‹æ ‡çš„æƒ…å†µã€‚è™½ç„¶è¿™é‡Œçš„ä»£ç åœ¨ç½‘å…³æ­£å¸¸è¿”å›ç»“æœçš„æ—¶å€™çš„ç¡®å¯ä»¥è¿è¡Œï¼Œä½†ç½‘å…³è¿”å›é”™è¯¯ä¿¡æ¯æ—¶ã€æˆ–è€…å¼‚æ­¥æ¨¡å¼ä¸‹ res ä¸­å‚¨å­˜çš„ä¸æ˜¯å®Œæ•´çš„æµä¸­çš„å­—ç¬¦ä¸²æ—¶ï¼Œå°±ä¼šäº§ç”Ÿæ•°ç»„è¶Šç•Œã€éæ³•è®¿é—®ï¼Œä»è€Œå¯¼è‡´è¾“å…¥æ³•å´©æºƒã€‚ å¯¹ Google æºçš„è§£æä¹Ÿä¸€æ ·æ˜¯å­—ç¬¦ä¸²çš„åˆ¤æ–­å’Œæå–ï¼š 12345678910111213/*GOOGLE */const gchar *tmp_res = res;const gchar *prefix = \"[\\\"SUCCESS\\\"\";if (g_str_has_prefix (tmp_res, prefix))&#123; gchar **prefix_arr = g_strsplit (tmp_res, \"\\\",[\\\"\", -1); gchar *prefix_str = prefix_arr[1]; gchar **suffix_arr = g_strsplit (prefix_str, \"\\\"],\", -1); std::string tmp = suffix_arr[0]; cloudCandidates-&gt;m_candidates[0].m_display_string = tmp; g_strfreev (prefix_arr); g_strfreev (suffix_arr);&#125; è¿™é‡Œçš„ä»£ç æ²¡æœ‰ç¡¬ç¼–ç çš„ä¸‹æ ‡ï¼Œä½†å¦‚æœ res ä¸­æ²¡èƒ½å–åˆ°å›å¤è¾“å…¥æµä¸­çš„æ‰€æœ‰å­—ç¬¦ï¼Œä¼šå¯¼è‡´æ²¡æœ‰å€™é€‰çš„æƒ…å†µå‡ºç°ã€‚ 20 ç‰ˆè§£æå®ç° åœ¨ 20 ç‰ˆä¸­ï¼Œä¸ºäº†éªŒè¯æ•°æ®ï¼Œä¹Ÿä¸ºäº†è§£æè¿™ä¸€è¿‡ç¨‹çš„å¥å£®æ€§ï¼Œæˆ‘é€‰æ‹©ç§»é™¤ 18 ç‰ˆä¸­çš„å­—ç¬¦ä¸²åˆ¤æ–­ä¸æå–è¿™ä¸€æ–¹æ³•ï¼Œè½¬è€Œä½¿ç”¨å®Œæ•´çš„ json è§£æã€‚ å…¶ä¸­ï¼Œè€ƒè™‘åˆ° ibus-libpinyin æ•´ä½“ä¾èµ–äº glibï¼Œç›´æ¥ä½¿ç”¨ JSON-GLib ä¼šæ›´åŠ æ–¹ä¾¿ï¼Œäºæ˜¯æ·»åŠ äº†å®ƒä½œä¸ºä¸€ä¸ªä¾èµ–ã€‚ ç±»å…³ç³» ä¸ºäº†å¯æ‹“å±•æ€§ï¼Œå‚è€ƒäº†å¯¼å¸ˆçš„æ„è§ï¼Œæˆ‘åˆ›å»ºäº† CloudCandidatesResponseParser ç±»ä½œä¸ºæ‰€æœ‰è§£æç±»çš„åŸºç±»ã€‚ 1234567891011121314151617class CloudCandidatesResponseParser&#123;public: CloudCandidatesResponseParser () : m_annotation (NULL) &#123;&#125; virtual ~CloudCandidatesResponseParser () &#123;&#125; virtual guint parse (GInputStream *stream) = 0; virtual guint parse (const gchar *data) = 0; virtual std::vector&lt;std::string&gt; &amp;getStringCandidates () &#123; return m_candidates; &#125; virtual std::vector&lt;EnhancedCandidate&gt; getCandidates (); virtual const gchar *getAnnotation () &#123; return m_annotation; &#125;protected: std::vector&lt;std::string&gt; m_candidates; const gchar *m_annotation;&#125;; å®ƒåŒ…å«äº†ä¸¤ä¸ªç§æœ‰ï¼ˆä¿æŠ¤ï¼‰å±æ€§å’Œå®ƒä»¬çš„ getterï¼š m_candidates æ˜¯è§£æå‡ºçš„å€™é€‰åˆ—è¡¨ï¼Œæ¯ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼› m_annotation æ˜¯è§£æå‡ºçš„ç»“æœä¸­è¿”å›çš„æ‹¼éŸ³çš„å€¼ã€‚ 12virtual guint parse (GInputStream *stream) = 0;virtual guint parse (const gchar *data) = 0; è¿™æ˜¯ä¸¤ä¸ªæœªå®ç°çš„æ–¹æ³•ï¼Œéœ€è¦åœ¨å…·ä½“çš„ç±»ä¸­å®ç°ï¼Œç”¨æ¥è´Ÿè´£è§£ææµä¸­æˆ–è€…ç¼“å†²åŒºä¸­çš„æ•°æ®ã€‚ 1234567891011121314class CloudCandidatesResponseJsonParser : public CloudCandidatesResponseParser&#123;public: CloudCandidatesResponseJsonParser (); virtual ~CloudCandidatesResponseJsonParser (); guint parse (GInputStream *stream); guint parse (const gchar *data);protected: JsonParser *m_parser; virtual guint parseJsonResponse (JsonNode *root) = 0;&#125;; æ¥ä¸‹æ¥ï¼ŒCloudCandidatesResponseJsonParser ç±»ç»§æ‰¿äº† CloudCandidatesResponseParser ç±»ï¼Œå¹¶å®ç°äº†ä¸Šè¿°çš„ä¸¤ä¸ªæ–¹æ³•ã€‚ 12345678910111213141516171819202122232425262728293031guint CloudCandidatesResponseJsonParser::parse (GInputStream *stream)&#123; GError **error = NULL; if (!stream) return PARSER_NETWORK_ERROR; /* parse Json from input steam */ if (!json_parser_load_from_stream (m_parser, stream, NULL, error) || error != NULL) &#123; g_input_stream_close (stream, NULL, error); // Close stream to release libsoup connexion return PARSER_BAD_FORMAT; &#125; g_input_stream_close (stream, NULL, error); // Close stream to release libsoup connexion return parseJsonResponse (json_parser_get_root (m_parser));&#125;guint CloudCandidatesResponseJsonParser::parse (const gchar *data)&#123; GError **error = NULL; if (!data) return PARSER_NETWORK_ERROR; /* parse Json from data */ if (!json_parser_load_from_data (m_parser, data, strlen (data), error) || error != NULL) return PARSER_BAD_FORMAT; return parseJsonResponse (json_parser_get_root (m_parser));&#125; å®ƒä»¬éƒ½æ˜¯ç”¨ä¸€ä¸ª JSON-GLib ä¸­çš„ JsonParser ç¤ºä¾‹å»è§£æï¼Œå¹¶æŠŠè§£æçš„å¯¹è±¡ä¼ ç»™ CloudCandidatesResponseJsonParser ä¸­å®šä¹‰çš„ parseJsonResponse æ¥è¿›è¡Œå…·ä½“çš„å¤„ç†ã€‚ è¿™ä¸ªæ–¹æ³•åœ¨å½“å‰ç±»ä¸­ä¹Ÿæ˜¯æœªå®ç°çš„çŠ¶æ€ï¼Œå…·ä½“çš„å¤„ç†è¡Œä¸ºæ˜¯å’Œäº‘è¾“å…¥çš„æºæœ‰å…³çš„ï¼Œå› æ­¤ï¼Œäº¤ç»™ä¸‹é¢åœ¨ GoogleCloudCandidatesResponseJsonParser å’Œ BaiduCloudCandidatesResponseJsonParser ä¸­å®ç°çš„ parseJsonResponse åˆ†åˆ«è¿›è¡Œ Google æºå’Œç™¾åº¦æºè¿”å›ç»“æœçš„å¤„ç†ã€‚ 123456789101112131415161718class GoogleCloudCandidatesResponseJsonParser : public CloudCandidatesResponseJsonParser&#123;protected: guint parseJsonResponse (JsonNode *root);public: GoogleCloudCandidatesResponseJsonParser () : CloudCandidatesResponseJsonParser () &#123;&#125;&#125;;class BaiduCloudCandidatesResponseJsonParser : public CloudCandidatesResponseJsonParser&#123;private: guint parseJsonResponse (JsonNode *root);public: BaiduCloudCandidatesResponseJsonParser () : CloudCandidatesResponseJsonParser () &#123;&#125; ~BaiduCloudCandidatesResponseJsonParser () &#123; if (m_annotation) g_free ((gpointer)m_annotation); &#125;&#125;; ä¸‹é¢çš„å°èŠ‚å°±æ¥æè¿°ä¸€ä¸‹åœ¨è¿™ä¸¤ä¸ªç±»ä¸­ parseJsonResponse åšäº†ä»€ä¹ˆã€‚ å€™é€‰è¯æå–å¤„ç† è¿™ä¸€æ­¥çš„ç›®çš„ï¼Œæ˜¯å°†å€™é€‰è¯å’Œæ‹¼éŸ³è§£æå‡ºæ¥ï¼Œåˆ†åˆ«æ”¾å…¥ m_candidates åˆ—è¡¨å’Œ m_annotation ä¸­ã€‚ä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œä¸‹é¢ç»“åˆä¹‹å‰æåˆ°çš„ä¸¤ä¸ªå…·ä½“ä¾‹å­æ¥è¾…åŠ©ç†è§£ã€‚ Google æºçš„è¿”å›ç»“æœå¤„ç† 1[\"SUCCESS\",[[\"ceshi\",[\"æµ‹è¯•\"],[],&#123;\"annotation\":[\"ce shi\"],\"candidate_type\":[0],\"lc\":[\"16 16\"]&#125;]]] æˆ‘ä»¬ä½¿ç”¨æœ€åˆçš„é‚£ä¸ª Google æºçš„å›å¤ä¸¾ä¾‹ï¼ŒGoogle æºçš„å¤„ç†å®ç°å¦‚ä¸‹ï¼Œå…¶ä¸­çš„å‚æ•° JsonNode *root ä¸º JSON-GLib è§£æå‡ºçš„ä¸€ä¸ªå®ä¾‹ï¼š 1234guint GoogleCloudCandidatesResponseJsonParser::parseJsonResponse (JsonNode *root)&#123; if (!JSON_NODE_HOLDS_ARRAY (root)) return PARSER_BAD_FORMAT; é¦–å…ˆå…ˆæ£€æŸ¥æ ¼å¼ï¼Œæœ€å¤–å±‚åº”å½“æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œè‹¥æ ¼å¼æœ‰é—®é¢˜ï¼Œå°±è¿”å›ä¸€ä¸ª PARSER_BAD_FORMAT çš„çŠ¶æ€ã€‚ 123456789101112/* validate Google source and the structure of response */JsonArray *google_root_array = json_node_get_array (root);const gchar *google_response_status;JsonArray *google_response_array;JsonArray *google_result_array;const gchar *google_candidate_annotation;JsonArray *google_candidate_array;guint result_counter;if (json_array_get_length (google_root_array) &lt;= 1) return PARSER_INVALID_DATA; ç´§æ¥ç€è·å–åˆ°è¿™ä¸ªæ•°ç»„å®ä¾‹ï¼Œå¹¶å‡†å¤‡ä¸€äº›å˜é‡æ–¹ä¾¿ä¹‹åå¯¹å…ƒç´ çš„æè¿°ã€‚ ç„¶åæ£€æµ‹æ•°ç»„çš„å¤§å°æ˜¯å¦è‡³å°‘ä¸º2ï¼Œä»¥å…ä¹‹åè·å–å…ƒç´ æ—¶å‡ºç°è¶Šç•Œã€‚è‹¥å…ƒç´ æ•°é‡ç¬¦åˆæœŸå¾…ï¼Œç´§æ¥ç€å°±å¯ä»¥åšè¿›ä¸€æ­¥çš„å…ƒç´ å–å‡ºã€‚å¦åˆ™è¿”å›ä¸€ä¸ª PARSER_INVALID_DATA çŠ¶æ€ã€‚ 1234567891011google_response_status = json_array_get_string_element (google_root_array, 0);if (g_strcmp0 (google_response_status, \"SUCCESS\")) return PARSER_INVALID_DATA;google_response_array = json_array_get_array_element (google_root_array, 1);if (json_array_get_length (google_response_array) &lt; 1) return PARSER_INVALID_DATA;google_result_array = json_array_get_array_element (google_response_array, 0); ç´§æ¥ç€ï¼Œå–å‡ºæ•°ç»„ä¸­çš„å…ƒç´ ï¼š ç¬¬ä¸€ä¸ªå…ƒç´ ï¼ˆä¸‹æ ‡ä¸º0ï¼‰ï¼Œåº”å½“æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæè¿°è¿™æ¬¡è¯·æ±‚æ˜¯å¦æ˜¯æˆåŠŸçš„ï¼Œè‹¥ä¸æˆåŠŸï¼Œåˆ™è¿”å›ä¸€ä¸ª PARSER_INVALID_DATA çŠ¶æ€ã€‚ ç¬¬äºŒä¸ªå…ƒç´ æ˜¯æ¥ä¸‹æ¥è¦å¤„ç†çš„ google_response_array è¿™ä¸ªæ•°ç»„ç»“æ„ï¼Œé•¿åº¦è‡³å°‘ä¸º1ï¼Œå¯¹åº”çš„ json éƒ¨åˆ†ä¸ºï¼š 1[[\"ceshi\",[\"æµ‹è¯•\"],[],&#123;\"annotation\":[\"ce shi\"],\"candidate_type\":[0],\"lc\":[\"16 16\"]&#125;]] ç„¶åè¿›ä¸€æ­¥çš„å–åˆ°å®ƒçš„å†…å±‚æ•°ç»„ google_result_arrayï¼Œä»è¿™é‡Œå¼€å§‹ï¼Œå°±æœ‰äº†çœŸæ­£éœ€è¦çš„æ•°æ®ã€‚ 1234567google_candidate_annotation = json_array_get_string_element (google_result_array, 0);if (!google_candidate_annotation) return PARSER_INVALID_DATA;/* update annotation with the returned annotation */m_annotation = google_candidate_annotation; ç¬¬ä¸€ä¸ªå–å‡ºçš„æ˜¯ google_result_array çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œè¿™ä¸ªå…ƒç´ åº”å½“æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºçš„æ˜¯ç”¨æˆ·çš„è¾“å…¥ï¼Œåœ¨ä¸Šè¿°ä¾‹å­ä¸­ä¸º &quot;ceshi&quot; è¿™ä¸ªå…ƒç´ ã€‚å¹¶æŠŠå®ƒå­˜åˆ°å½“å‰å®ä¾‹çš„ m_annotation å±æ€§ä¸­ã€‚ 123456789101112131415 google_candidate_array = json_array_get_array_element (google_result_array, 1); result_counter = json_array_get_length (google_candidate_array); if (result_counter &lt; 1) return PARSER_NO_CANDIDATE; for (guint i = 0; i &lt; result_counter; ++i) &#123; std::string candidate = json_array_get_string_element (google_candidate_array, i); m_candidates.push_back (candidate); &#125; return PARSER_NOERR;&#125; ç¬¬äºŒä¸ªå–å‡ºçš„æ˜¯ google_result_array çš„ç¬¬äºŒä¸ªå…ƒç´ ï¼Œæ˜¯ä¸€ä¸ªåŒ…å«äº†å€™é€‰è¯çš„æ•°ç»„ï¼Œå–åä¸º google_candidate_arrayã€‚ å…ˆåˆ¤æ–­å®ƒçš„é•¿åº¦ï¼Œè‹¥ä¸åŒ…å«ä»»ä½•å…ƒç´ ï¼Œåˆ™è¿”å› PARSER_NO_CANDIDATE çŠ¶æ€ã€‚ æœ‰å…ƒç´ çš„è¯å°±æŠŠæ‰€æœ‰å…ƒç´ å–å‡ºï¼Œæ·»åŠ åˆ° m_candidates è¿™ä¸ªå±æ€§å¯¹åº”çš„å€™é€‰è¯åˆ—è¡¨ä¸­ã€‚ç„¶åè¿”å› PARSER_NOERR çŠ¶æ€ã€‚ ç™¾åº¦æºçš„è¿”å›ç»“æœå¤„ç† 1&#123;\"errmsg\":\"\",\"errno\":\"0\",\"result\":[[[\"ç™¾åº¦\",5,&#123;\"pinyin\":\"bai'du\",\"type\":\"IMEDICT\"&#125;]],\"bai'du\"],\"status\":\"T\"&#125; åŒæ ·çš„ï¼Œå¯¹äºç™¾åº¦ï¼Œæˆ‘ä»¬ä¹Ÿä½¿ç”¨æœ€åˆçš„ä¾‹å­ï¼Œå…¶ä¸­çš„å‚æ•° JsonNode *root ä¹Ÿæ˜¯ JSON-GLib è§£æå‡ºçš„ä¸€ä¸ªå®ä¾‹ï¼š 1234guint BaiduCloudCandidatesResponseJsonParser::parseJsonResponse (JsonNode *root)&#123; if (!JSON_NODE_HOLDS_OBJECT (root)) return PARSER_BAD_FORMAT; å…ˆæ£€æŸ¥æ ¼å¼ï¼Œæœ€å¤–å±‚åº”å½“æ˜¯ä¸€ä¸ªå¯¹åº”ï¼Œåœ¨æ ¼å¼ä¸åŒ¹é…çš„æƒ…å†µä¸‹å°±è¿”å›ä¸€ä¸ª PARSER_BAD_FORMAT çš„çŠ¶æ€ã€‚ 1234567/* validate Baidu source and the structure of response */JsonObject *baidu_root_object = json_node_get_object (root);const gchar *baidu_response_status;JsonArray *baidu_result_array;JsonArray *baidu_candidate_array;const gchar *baidu_candidate_annotation;guint result_counter; ç±»ä¼¼ä½†å´ä¸åŒçš„ï¼Œè¿™é‡Œæ˜¯è·å–åˆ°è¿™ä¸ª json å¯¹è±¡çš„å®ä¾‹ï¼Œå¹¶åˆ›å»ºä¸€ç³»åˆ—å˜é‡ç”¨æ¥æ¥æ”¶ä¹‹åçš„å…ƒç´ ã€‚ 1234567if (!json_object_has_member (baidu_root_object, \"status\")) return PARSER_INVALID_DATA;baidu_response_status = json_object_get_string_member (baidu_root_object, \"status\");if (g_strcmp0 (baidu_response_status, \"T\")) return PARSER_INVALID_DATA; é¦–å…ˆå…ˆçœ‹ status å…ƒç´ å­˜åœ¨ä¸”æ˜¯å¦ä¸º Tï¼Œå¦‚æœä¸å­˜åœ¨æˆ–è€…ä¸ºå…¶ä»–å€¼ï¼Œè¿™æ¬¡è¯·æ±‚çš„åº”å½“å·²ç»æ˜¯å¤±è´¥çš„äº†ï¼Œå°±ä¸éœ€è¦è¿›è¡Œä¸‹ä¸€æ­¥çš„æ“ä½œï¼Œç›´æ¥è¿”å› PARSER_INVALID_DATA çŠ¶æ€ã€‚ 123456if (!json_object_has_member (baidu_root_object, \"result\")) return PARSER_INVALID_DATA;baidu_result_array = json_object_get_array_member (baidu_root_object, \"result\");baidu_candidate_array = json_array_get_array_element (baidu_result_array, 0); ç„¶ååˆ™æ˜¯å¯¹ result å…ƒç´ å­˜åœ¨æ€§çš„æ£€æµ‹ï¼Œè¿™ä¸ªå…ƒç´ æ˜¯å­˜æ”¾æœ‰ç»“æœçš„ä¸€ä¸ªæ•°ç»„ã€‚è¿™ä¸ªæ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯å­˜æ”¾æœ‰å€™é€‰è¯ä¿¡æ¯çš„æ•°ç»„ï¼Œå°†å…¶å–å‡ºï¼Œç”¨ baidu_candidate_array æŒ‡å‘å®ƒã€‚è¿™æ˜¯ä¹‹åå–å€™é€‰è¯æ—¶ä¸»è¦è¦æ“ä½œçš„å¯¹è±¡ã€‚ 12345678910baidu_candidate_annotation = json_array_get_string_element (baidu_result_array, 1);if (!baidu_candidate_annotation) return PARSER_INVALID_DATA;/* update annotation with the returned annotation */m_annotation = NULL;gchar **words = g_strsplit (baidu_candidate_annotation, \"'\", -1);m_annotation = g_strjoinv (\"\", words);g_strfreev (words); ç¬¬äºŒä¸ªå…ƒç´ åˆ™æ˜¯è¿”å›å›æ¥çš„åŒ¹é…åˆ°çš„æ‹¼éŸ³ï¼Œå®ƒæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¿™ä¸ªè¡¨ç¤ºæ‹¼éŸ³çš„å­—ç¬¦ä¸²ä½¿ç”¨äº†å•å¼•å· ' ä½œä¸ºåˆ†å‰²ï¼Œè€Œæˆ‘ä»¬æ‰€å¸Œæœ›çš„æ˜¯ä¸€ä¸ªæ²¡æœ‰åˆ†éš”ç¬¦çš„è¿ç»­çš„æ‹¼éŸ³ä¸²ï¼ˆæ–¹ä¾¿ä¸å½“å‰ç¼–è¾‘å™¨ä¸­çš„ç”¨æˆ·è¾“å…¥ï¼‰ï¼Œå› æ­¤éœ€è¦å¯¹å…¶è¿›è¡Œåˆ†å‰²ä¸åˆå¹¶çš„å¤„ç†ã€‚ è¿›è¡Œå¤„ç†åï¼Œå­˜æ”¾åœ¨ m_annotation ä¸­ã€‚ç”±äºæ˜¯é€šè¿‡ g_strjoinv åˆ›å»ºå‡ºæ¥çš„ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²æ˜¯éœ€è¦æ‰‹åŠ¨é‡Šæ”¾çš„ã€‚äºæ˜¯ï¼Œåœ¨ä¸Šé¢å±•ç¤ºçš„ BaiduCloudCandidatesResponseJsonParser ç±»çš„ææ„å‡½æ•°ä¸­å®Œæˆäº†è¿™ä¸€é‡Šæ”¾è¿‡ç¨‹ï¼š 1~BaiduCloudCandidatesResponseJsonParser () &#123; if (m_annotation) g_free ((gpointer)m_annotation); &#125; å¤„ç†å®Œäº†æ‹¼éŸ³ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥æ‹¿èµ·ä¹‹å‰å–å‡ºçš„ baidu_candidate_array å€™é€‰è¯æ•°ç»„äº†ã€‚æ•´ä½“æµç¨‹å’Œ Google æºçš„ååˆ†ç›¸ä¼¼ï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯æ›´å†…å±‚çš„å¤„ç†ã€‚ 1234result_counter = json_array_get_length (baidu_candidate_array);if (result_counter &lt; 1) return PARSER_NO_CANDIDATE; é¦–å…ˆæ˜¯çœ‹å€™é€‰æ•°ç»„çš„é•¿åº¦ï¼Œåˆ¤æ–­æœ‰æ— å¯ç”¨çš„å€™é€‰è¯ã€‚ è€Œæ•°ç»„å†…çš„æ¯ä¸€ä¸ªå€™é€‰è¯ï¼Œéƒ½æœ‰ä»¥ä¸‹ç»“æ„ï¼š 1[\"ç™¾åº¦\",5,&#123;\"pinyin\":\"bai'du\",\"type\":\"IMEDICT\"&#125;] ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯å€™é€‰è¯çš„å­—ç¬¦ä¸²ï¼Œç´§è·Ÿç€çš„åº”å½“æ˜¯å€™é€‰åœ¨ UTF-8 ç¼–ç æƒ…å†µä¸‹çš„é•¿åº¦ï¼Œä¹‹åæ˜¯è¿™ä¸ªå€™é€‰å¯¹åº”ï¼ŒåŒ…å«æ‹¼éŸ³å’Œç±»å‹çš„ä¸€ä¸ª json å¯¹è±¡ã€‚ 123456789101112131415 for (guint i = 0; i &lt; result_counter; ++i) &#123; std::string candidate; JsonArray *baidu_candidate = json_array_get_array_element (baidu_candidate_array, i); if (json_array_get_length (baidu_candidate) &lt; 1) candidate = CANDIDATE_INVALID_DATA_TEXT; else candidate = json_array_get_string_element (baidu_candidate, 0); m_candidates.push_back (candidate); &#125; return PARSER_NOERR;&#125; è¿™é‡Œæˆ‘ä»¬åªå–å€™é€‰æ•°ç»„é‡Œçš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œä¹Ÿå°±æ˜¯å€™é€‰è¯çš„å­—ç¬¦ä¸²ï¼Œå¹¶å°†å…¶åŠ å…¥åˆ° m_candidates å€™é€‰æ•°ç»„ä¸­ã€‚å¦‚æœæ²¡æœ‰è¿™ä¸ªå…ƒç´ ï¼Œå°±æ·»åŠ ä¸€ä¸ª CANDIDATE_INVALID_DATA_TEXT ä½œä¸ºæç¤ºã€‚ æœ€åï¼Œè¿”å› PARSER_NOERRã€‚ ä¸¤ä¸ªæºè¿”å›ç»“æœä¸Šçš„å·®å¼‚ ä¸¤ä¸ªæºä¸Šè¿”å›çš„å†…å®¹æœ‰ä¸ä¸€è‡´çš„åœ°æ–¹ï¼Œå› æ­¤ä¸ªåˆ«ç»†èŠ‚éœ€è¦å•ç‹¬è€ƒè™‘ã€‚ å…¶ä¸­æ¯”è¾ƒé‡è¦çš„ï¼Œä¹Ÿæ˜¯å¼•å‘ä¸€äº›å…¶ä»–é—®é¢˜çš„ä¸€ä¸ªç‚¹å°±æ˜¯ï¼Œå¯¹ç”¨æˆ·è¾“å…¥çš„ echoã€‚ åœ¨ 20 ç‰ˆå¼‚æ­¥æ¨¡å¼ä¸‹ï¼Œå¯èƒ½ä¼šæœ‰å¤šä¸ªè¯·æ±‚çš„å›å¤é™†ç»­åˆ°è¾¾ï¼Œè€Œå®ƒä»¬çš„é¡ºåºæ˜¯æ— æ³•ä¿è¯çš„ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯¹è¿”å›ç»“æœå¯¹åº”çš„ç”¨æˆ·è¾“å…¥å’Œå½“å‰çš„ç”¨æˆ·è¾“å…¥è¿›è¡Œäº†æ¯”è¾ƒï¼Œå¦‚æœä¸€è‡´ï¼Œè¯´æ˜æ˜¯å½“å‰ç”¨æˆ·è¾“å…¥è¿›è¡Œçš„è¯·æ±‚ï¼Œå¦åˆ™å°±ä¸¢å¼ƒè¿™ä¸ªç»“æœå¯¹åº”çš„å€™é€‰ã€‚ Google æºåœ¨è¿”å›å€™é€‰è¯ç»“æœæ—¶ï¼Œä¸ä»…å¯¹å€™é€‰è¯è¿›è¡Œäº†æ‹¼éŸ³æ ‡æ³¨ï¼Œè¿˜å°†è¯·æ±‚æ—¶çš„ç”¨æˆ·è¾“å…¥è¿”å›ï¼› ç™¾åº¦æºåˆ™æ²¡æœ‰è¿”å›è¯·æ±‚æ—¶å‘é€çš„åŸå§‹çš„ç”¨æˆ·è¾“å…¥ï¼Œæœ‰å¯¹å€™é€‰è¯çš„æ‹¼éŸ³æ ‡æ³¨ï¼Œå’Œè‡ªåŠ¨è¡¥å…¨æ‹¼éŸ³åçš„ç”¨æˆ·è¾“å…¥ã€‚ å› æ­¤ï¼Œå¯¹ç™¾åº¦æºè¿”å›çš„ç»“æœï¼Œç›®å‰æ— æ³•æ‰¾å›åŸå§‹çš„ç”¨æˆ·è¾“å…¥ï¼Œä¹Ÿå°±æ— æ³•å’Œå½“å‰ç¼–è¾‘å™¨ä¸­çš„ç”¨æˆ·è¾“å…¥è¿›è¡ŒæˆåŠŸåŒ¹é…ã€‚åœ¨è¾“å…¥æ‹¼éŸ³ä¸å®Œå…¨çš„æ—¶å€™ä¼šæœ‰å€™é€‰è¯è¢«ä¸¢å¼ƒçš„æƒ…å†µå‡ºç°ã€‚ å¯¹æ­¤ï¼Œæœ‰ä»¥ä¸‹å‡ ç§æ–¹æ¡ˆï¼š å¯¼å¸ˆæå‡ºäº†åœ¨æœ‰ä¸å®Œæ•´æ‹¼éŸ³ï¼ˆæ¨¡ç³Šæ‹¼éŸ³ï¼‰çš„æƒ…å†µä¸‹ä¸ç»™ç™¾åº¦æºå‘é€è¯·æ±‚ï¼› å†™ä¸€ä¸ªå­—ç¬¦ä¸²ç›¸ä¼¼ç¨‹åº¦çš„ç®—æ³•ï¼Œä¸ºç™¾åº¦æºçš„è¿”å›ç»“æœè®¾å®šä¸€ä¸ªç›¸ä¼¼åº¦é˜ˆå€¼ï¼Œè¾¾åˆ°é˜ˆå€¼ä¹‹åå°±å…è®¸æ˜¾ç¤ºï¼› æ— è®ºæ˜¯å¦åŒ¹é…ï¼Œåœ¨ç™¾åº¦æºçš„æƒ…å†µä¸‹éƒ½å…è®¸æ˜¾ç¤ºã€‚ å…·ä½“é‡‡ç”¨å“ªä¸€ç§æ¯”è¾ƒå¥½ï¼Œè¿˜éœ€è¦è¿›ä¸€æ­¥çš„è®¨è®ºã€‚ç›®å‰é‡‡ç”¨çš„æ˜¯ç¬¬ä¸‰ç§æ–¹æ¡ˆã€‚ æ€»ç»“ è¿™ç¯‡æ–‡ç« è®²è¿°äº†å¯¹ä»è¯·æ±‚çš„å›å¤ä¸­æå–å€™é€‰çš„è¿‡ç¨‹ï¼Œæå–å‡ºå€™é€‰åï¼Œä¼šæ ¹æ®çŠ¶æ€å¤„ç†æå–å‡ºæ¥çš„å€™é€‰ï¼Œè¿™éƒ¨åˆ†ä¼šåœ¨ä¸‹ç¯‡æ–‡ç« å™è¿°ã€‚æœ€åäº¤ç”±åœ¨ äº‘è¾“å…¥åœ¨ ibus-libpinyin ä¸­çš„å®ç° - æ¦‚è¿° ä¸€æ–‡ä¸­æè¿°çš„è¿‡ç¨‹ï¼Œæ›´æ–°æ›¿æ¢å€™é€‰è¯çš„å ä½ç¬¦ï¼Œå®Œæˆæ•´ä¸ªäº‘è¾“å…¥çš„è¿‡ç¨‹ã€‚","categories":[{"name":"ibus-libpinyin","slug":"ibus-libpinyin","permalink":"https://blog.inoki.cc/categories/ibus-libpinyin/"}],"tags":[{"name":"IBus","slug":"IBus","permalink":"https://blog.inoki.cc/tags/IBus/"},{"name":"ibus-libpinyin","slug":"ibus-libpinyin","permalink":"https://blog.inoki.cc/tags/ibus-libpinyin/"},{"name":"Cloud Input","slug":"Cloud-Input","permalink":"https://blog.inoki.cc/tags/Cloud-Input/"}]},{"title":"äº‘è¾“å…¥åœ¨ ibus-libpinyin ä¸­çš„å®ç° - æ¦‚è¿°","slug":"IBus-libpinyin-cloud-input-global-view","date":"2020-05-31T23:55:00.000Z","updated":"2025-03-08T09:40:48.567Z","comments":true,"path":"2020/05/31/IBus-libpinyin-cloud-input-global-view/","link":"","permalink":"https://blog.inoki.cc/2020/05/31/IBus-libpinyin-cloud-input-global-view/","excerpt":"","text":"åœ¨ 2018 å¹´çš„ Google Summer of Code (GSoC)ä¸­ï¼Œibus-libpinyin çš„äº‘è¾“å…¥åŠŸèƒ½ç”± Linyu Xu é¦–æ¬¡å¼•å…¥ã€‚è¯¥ç‰ˆæœ¬å¹¶æ²¡æœ‰è¢«åˆå¹¶å…¥ä¸»åˆ†æ”¯ä¸­ï¼Œæœ¬æ–‡å°†å…¶ç§°ä¸º 18 ç‰ˆäº‘è¾“å…¥ã€‚ 18 ç‰ˆé‡‡ç”¨äº†åŒæ­¥è¯·æ±‚å€™é€‰è¯çš„æ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå‘é€è¯·æ±‚ã€è§£æè¯·æ±‚çš„è¿‡ç¨‹ä¼šé˜»å¡ ibus-libpinyin çš„è¡Œä¸ºï¼Œåœ¨ç½‘ç»œæƒ…å†µä¸å¥½æ—¶ï¼Œå°±ä¼šè®©äººæ„Ÿè§‰åˆ°ååˆ†å¡é¡¿ï¼Œå‡ºç°æœªå“åº”çš„ç°è±¡ã€‚åŒæ—¶ï¼Œç”±äºè¿”å›ç»“æœè§£æé‡‡ç”¨äº†æ¯”è¾ƒç®€æ˜“çš„å­—ç¬¦ä¸²æå–ï¼Œå¯¼è‡´å–å‡ºå€™é€‰çš„å®ç°å¥å£®æ€§ä¸é«˜ã€‚ä¸€ç³»åˆ—åŸå› å¯¼è‡´ 18 ç‰ˆäº‘è¾“å…¥å¹¶ä¸èƒ½ä½œä¸ºä¸€ä¸ªç”Ÿäº§ç¯å¢ƒå¯ç”¨çš„åŠŸèƒ½ã€‚ ä»Šå¹´ï¼ˆ2020ï¼‰æˆ‘çš„ GSoC é¡¹ç›®ç›®æ ‡ä¹‹ä¸€å°±æ˜¯ä¼˜åŒ–è¯¥åŠŸèƒ½ï¼Œå¹¶å°†å…¶åˆå¹¶å…¥ ibus-libpinyin çš„ä¸»åˆ†æ”¯ä¸­ã€‚ ç›®å‰æ­£åœ¨è¿­ä»£çš„ä¸€ç³»åˆ—ç‰ˆæœ¬åœ¨æ”¹æ–‡ä¸­è¢«ç»Ÿç§°ä¸º 20 ç‰ˆäº‘è¾“å…¥ï¼Œæœ¬æ–‡å°†å¯¹äº‘è¾“å…¥æŒ‰ç…§æ—¶é—´é¡ºåºè¿›è¡Œä¸€ä¸ªç®€è¦ä»‹ç»ï¼Œè®©è¯»è€…å¯¹äº‘è¾“å…¥åŠŸèƒ½æœ‰ä¸€ä¸ªæ¦‚è§ˆã€‚ å½“ç”¨æˆ·æŒ‰ä¸‹é”®ç›˜ åœ¨ ibus-libpinyin ä¸­ï¼Œç”¨æˆ·è¿›è¡Œè¾“å…¥ä¹‹åï¼Œç¼–è¾‘å™¨çš„å®ä¾‹ PhoneticEditor ä¼šè°ƒç”¨ updateCandidates æ–¹æ³•ã€‚åœ¨è¯¥æ–¹æ³•ä¸­ï¼Œæ¯ä¸€ç§å€™é€‰è¯å®ä¾‹çš„ processCandidates æ–¹æ³•éƒ½ä¼šè¢«è°ƒç”¨ï¼Œä¿®æ”¹å€™é€‰è¯åˆ—è¡¨ã€‚ äº‘è¾“å…¥éƒ¨åˆ†çš„å€™é€‰è¯å¤„ç†ç”± PYPCloudCandidates ä¸­çš„ CloudCandidates å®Œæˆã€‚ä½†è¿™æ—¶ï¼Œæˆ‘ä»¬è¿˜æ²¡æœ‰äº‘è¾“å…¥å€™é€‰çš„ç»“æœï¼Œå› æ­¤éœ€è¦å…ˆæ’å…¥å ä½ç¬¦ï¼Œæ–¹ä¾¿ä¹‹åè¿›è¡Œæ›¿æ¢ï¼Œä»è€Œå°†äº‘è¾“å…¥è¿”å›çš„ç»“æœåŠ å…¥å€™é€‰è¯åˆ—è¡¨ä¸­ã€‚ æ·»åŠ å€™é€‰è¯å ä½ç¬¦ é¦–å…ˆï¼ŒCloudCandidates ä¼šæ‰¾åˆ°æŒ‡å®šçš„ä½ç½®ï¼Œä»è¯¥ä½ç½®å¼€å§‹æ’å…¥é¢„å…ˆè®¾å®šä¸ªæ•°çš„å€™é€‰è¯å ä½ç¬¦ã€‚ç›®å‰ä½¿ç”¨äº†ä¸€ä¸ªäº‘çš„ç¬¦å·â˜ï¼ˆåœ¨ 18 ç‰ˆä¸­ä¸ºçœç•¥å·ï¼‰ï¼Œç”¨æ¥æç¤ºç”¨æˆ·è¯¥ä½ç½®æ˜¯ä¸€ä¸ªäº‘è¾“å…¥çš„å€™é€‰è¯ï¼Œå°†ä¼šè¢«äº‘è¾“å…¥è¯·æ±‚è¿”å›çš„å€™é€‰è¯å–ä»£ã€‚ è¿™ä¸ªä½ç½®åœ¨ 18 ç‰ˆäº‘è¾“å…¥æ˜¯ç”± m_first_cloud_candidate_position å±æ€§æŒ‡å®šçš„ï¼Œä½œä¸ºä¸€ä¸ªæ•´æ•°è¡¨ç¤ºçš„ä¸‹æ ‡ï¼Œå®ƒç»™å®šäº†ä¸€ä¸ªå›ºå®šä½ç½®æ¥æ’å…¥ã€ä¿®æ”¹å ä½ç¬¦ã€‚è¿™æ ·å¯èƒ½ä¼šåœ¨å€™é€‰è¯è¾ƒå°‘æ—¶å¯¼è‡´ç”¨æ•°ç»„ä¸‹æ ‡è®¿é—®è¶Šç•Œçš„é—®é¢˜ã€‚ 20 ç‰ˆäº‘è¾“å…¥ä¸­ï¼Œåˆ™å°†å…¶æ”¾åœ¨ 1-3 ä¸ªæ•´å¥å€™é€‰è¯çš„åé¢ã€‚å¹¶æŠŠè¯¥ä½ç½®ç”¨ä¸€ä¸ªè¿­ä»£å™¨è®°å½•ä¸‹æ¥ï¼Œæ–¹ä¾¿å–åˆ°å€™é€‰è¯ä¹‹åå¯¹å ä½ç¬¦è¿›è¡Œå¿«é€Ÿçš„ä¿®æ”¹ã€‚ åœ¨è¿™ä¸¤ä¸ªç‰ˆæœ¬çš„äº‘è¾“å…¥ä¸­ï¼Œm_cloud_candidates_number éƒ½ç”¨æ¥æŒ‡å®šå€™é€‰è¯çš„ä¸ªæ•°ã€‚ ä¸€åˆ‡å¤„ç†ç»“æŸåï¼Œè‹¥æ‹¼éŸ³é•¿åº¦å¤§äº m_min_cloud_trigger_lengthï¼Œå³æœ€å°çš„è§¦å‘äº‘è¾“å…¥è¯·æ±‚çš„æ‹¼éŸ³é•¿åº¦ï¼ˆ18 ç‰ˆä¸­å¯é…ç½®ï¼Œ20 ç‰ˆä¸­ç”± CLOUD_MINIMUM_TRIGGER_LENGTH å®å®šä¹‰ï¼‰ï¼ŒCloudCandidates ä¼šå»è°ƒç”¨å¯¹åº”çš„æ–¹æ³•æ¥è¯·æ±‚äº‘è¾“å…¥çš„å€™é€‰ï¼Œä»¥ä¾¿ä¹‹åå¯¹å ä½ç¬¦è¿›è¡Œæ›¿æ¢ã€‚ åœ¨å¼‚æ­¥æ¨¡å¼ä¸‹ï¼Œå¦‚æœä½¿ç”¨è¿­ä»£å™¨è®°å½•å ä½ç¬¦çš„æ’å…¥ä½ç½®ï¼Œå¦ä¸€è¾¹ä½¿ç”¨è¿™ä¸ªä½ç½®è¿›è¡Œè¯»å–çš„è¯ï¼Œæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œå¯èƒ½ä¼šäº§ç”Ÿæ•°æ®ç«äº‰ã€‚è€Œåœ¨å€™é€‰åˆ—è¡¨æ›´æ–°åï¼Œå¦‚æœå¦ä¸€ä¸ªçº¿ç¨‹ä»ä½¿ç”¨ä¹‹å‰çš„è¿­ä»£å™¨ï¼Œå­˜åœ¨éæ³•è®¿é—®çš„å¯èƒ½æ€§ã€‚ æœ€æ–°çš„ç‰ˆæœ¬ä¸­ï¼Œä¸å†å¯¹å ä½ç¬¦æ’å…¥ä½ç½®è¿›è¡Œè®°å½•ã€‚è€Œæ˜¯åœ¨æ¯æ¬¡è¢«è°ƒç”¨æ—¶ï¼Œåˆ¤æ–­è®°å½•çš„æœ€è¿‘ä¸€æ¬¡è¯·æ±‚æ‹¼éŸ³æ˜¯å¦ä¸æœ¬æ¬¡ä¸€è‡´ï¼š å¦‚æœä¸€è‡´ï¼Œåˆ™å°† m_candidates æ›´æ–°åˆ°å€™é€‰åˆ—è¡¨ä¸­ å¦‚æœä¸ä¸€è‡´ï¼Œåˆ™æ·»åŠ å ä½ç¬¦åˆ°å€™é€‰åˆ—è¡¨ä¸­ å ä½ç¬¦ä¸ªæ•°çš„å¤„ç† 18 ç‰ˆäº‘è¾“å…¥ä¸­ï¼Œè™½ç„¶åœ¨é…ç½®é¡µé¢æœ‰è°ƒæ•´å ä½ç¬¦ä¸ªæ•°çš„é…ç½®é¡¹ï¼Œåœ¨ gsetting ä¸­ä¹Ÿæœ‰å¯¹åº”çš„æ•°æ®é¡¹ï¼Œä½†åœ¨ CloudCandidates ä¸­ï¼Œä»ä½¿ç”¨äº† 1m_cloud_candidates_number = 1; å°†å…¶é…åˆ¶æˆäº†ä¸€ä¸ªå¸¸å€¼ã€‚ åœ¨ 20 ç‰ˆäº‘è¾“å…¥çš„æ”¹è¿›è¿‡ç¨‹å½“ä¸­ï¼Œæˆ‘é¦–å…ˆå°†è¿™ä¸ªå¸¸å€¼æ”¹ä¸ºä»é…ç½®ä¸­è¯»å–ã€‚åœ¨åæ¥çš„æµ‹è¯•ä¸­ï¼Œæˆ‘å‘ç°åœ¨ç™¾åº¦çš„äº‘è¾“å…¥æºä¸­ï¼Œæ— è®ºä¼ å…¥çš„å¸Œæœ›è¿”å›å€™é€‰è¯çš„ä¸ªæ•°æ˜¯å¤šå°‘ï¼ˆæŸ¥è¯¢å­—ç¬¦ä¸²ä¸­çš„ ed å­—æ®µï¼‰ï¼Œå®ƒéƒ½åªè¿”å›ä¸€ä¸ªå€™é€‰è¯ï¼›è€Œ Google æºå¯ä»¥è¿”å›é¢„æœŸä¸ªæ•°çš„å€™é€‰è¯ã€‚ ä¸ºäº†ä¿æŒè¡Œä¸ºçš„ä¸€è‡´æ€§ï¼Œç›®å‰å·²å°†å…¶ä»é…ç½®ç•Œé¢ä¸­ç§»å‡ºï¼Œå¹¶å›ºå®šè¿™ä¸€é…ç½®é¡¹çš„å€¼ä¸º1ã€‚ç”¨æˆ·ä¾ç„¶å¯é€šè¿‡ gsetting å¯¹å…¶è¿›è¡Œä¿®æ”¹ã€‚ å‘é€è¯·æ±‚ åœ¨æ–‡ç« å¼€å¤´æåˆ°è¿‡ï¼Œ18 ç‰ˆäº‘è¾“å…¥ä½¿ç”¨äº†åŒæ­¥çš„æœºåˆ¶æ¥è¯·æ±‚å€™é€‰è¯ï¼Œè¿™æ ·ä¼šé˜»å¡è¿›ç¨‹ï¼›å½“æ—¶çš„å¼‚æ­¥è¯·æ±‚æ¨¡å¼å¹¶æ²¡æœ‰å®Œæˆã€‚ åœ¨ 20 ç‰ˆäº‘è¾“å…¥ä¸­ï¼Œå¼‚æ­¥è¯·æ±‚æ¨¡å¼æœ‰äº†ä¸€ä¸ªå¯ç”¨çš„å®ç°ï¼Œåæ¥ï¼Œåœ¨ä¼˜åŒ–ç”¨æˆ·ä½“éªŒã€å‡å°‘æ— ç”¨çš„è¯·æ±‚çš„ç›®æ ‡ä¸‹ï¼Œæˆ‘åˆå®ç°äº†å»¶æ—¶çš„å¼‚æ­¥è¯·æ±‚ï¼Œä¹Ÿå°±æ˜¯åœ¨è®¤ä¸ºç”¨æˆ·å®Œæˆè¾“å…¥åæ‰å‘èµ·ç½‘ç»œè¯·æ±‚è·å–äº‘è¾“å…¥å€™é€‰è¯ã€‚ åŒæ­¥è¯·æ±‚ åŒæ­¥è¯·æ±‚æ¨¡å¼ä¸‹ï¼ŒcloudSyncRequest æ–¹æ³•ä¼šåœ¨æ’å…¥å ä½ç¬¦å®Œæˆåè¢«è°ƒç”¨ã€‚ è¯¥æ–¹æ³•ä½¿ç”¨ libsoup çš„ API å‘é€è¯·æ±‚ï¼Œå¹¶æŠŠç»“æœå‚¨å­˜åœ¨ä¸€ä¸ªç¼“å†²åŒºä¸­è¿›è¡Œè§£æã€‚ç»“æœå¤„ç†éƒ¨åˆ†åœ¨ä¹‹åçš„æ–‡ç« ä¸­è¯¦ç»†è§£é‡Šã€‚ å–åˆ°å€™é€‰è¯ä¹‹åï¼Œå®ƒæŠŠå ä½ç¬¦æ›¿æ¢ä¸ºå¯¹åº”çš„å€™é€‰è¯å¹¶è¿”å›ã€‚ è¿™ä¹‹åï¼Œibus-libpinyin æ‰å¯ä»¥å“åº”æ¥ä¸‹æ¥çš„å…¶ä»–äº‹ä»¶ã€‚å‘é€è¯·æ±‚æ˜¯ä¸€ä¸ªè€—æ—¶æ“ä½œï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªè¿‡ç¨‹å¯¼è‡´åŒæ­¥è¯·æ±‚æ¨¡å¼ä¸‹å¡é¡¿ã€‚å¼‚æ­¥æ¨¡å¼å°±æ˜¯ä¸ºäº†è§£å†³è¿™ç§æ— å“åº”çŠ¶æ€è€Œç”Ÿã€‚ å¼‚æ­¥è¯·æ±‚ å¼‚æ­¥è¯·æ±‚åœ¨ 18 ç‰ˆäº‘è¾“å…¥ä¸­å…¶å®å·²ç»æœ‰äº†ä¸€ä¸ªé›å½¢ï¼Œå³ cloudAsyncRequest æ–¹æ³•ã€‚ è¿™ä¸ªæ–¹æ³•è°ƒç”¨ soup_session_send_async æ¥å‘é€è¯·æ±‚ï¼ŒcloudResponseCallBack è¢«ä½œä¸ºå›è°ƒå‡½æ•°å‚æ•°ä¼ å…¥ï¼Œå®Œæˆæ—¶ä¼šè¢«è°ƒç”¨æ¥å¤„ç†ç»“æœã€‚ ä»è¿™é‡Œå¼€å§‹ï¼Œ18 ç‰ˆå’Œ 20 ç‰ˆå¼€å§‹æœ‰å®ç°ä¸Šçš„å·®åˆ«ã€‚ 18 ç‰ˆçš„å®ç°å°è¯• å¼‚æ­¥æ¨¡å¼ä¸‹ï¼Œæœ€åå–åˆ°çš„ç»“æœæ˜¯ä¸€ä¸ªè¾“å…¥æµï¼Œè¯¥ç‰ˆæœ¬é‡ŒæŠŠè¿™ä¸ªè¾“å…¥æµä¸­çš„å­—ç¬¦å…¨éƒ¨è¯»å‡ºï¼Œæ”¾åˆ°ä¸€ä¸ªç¼“å†²åŒºä¸­ï¼š 1g_input_stream_read (stream, buffer, BUFFERLENGTH, NULL, error); ä½†å¯¹äºæµæ¥è¯´ï¼Œåœ¨è¯¥æ—¶åˆ»è¿”å›çš„å­—ç¬¦å¹¶ä¸ä¸€å®šæ˜¯å®Œæ•´çš„ç»“æœï¼Œç”¨è¿™ä¸ªå‡½æ•°è¯»å‡ºæ¥å¤§éƒ¨åˆ†æƒ…å†µä¸‹æ˜¯ä¸å®Œæ•´çš„å­—ç¬¦ä¸²ï¼Œä»è€Œå¯¼è‡´å€™é€‰è¯ä¸èƒ½è¢«æ­£å¸¸æ‰¾åˆ°å¹¶å–å‡ºã€‚ åœ¨ 20 ç‰ˆä¸­ï¼Œç”±äºåŠ å…¥äº† JSON è§£æçš„è¿‡ç¨‹ï¼Œè¯»å–æµä¸­å­—ç¬¦å¹¶è§£æçš„æ“ä½œäº¤ç»™äº† json-glib åº“ï¼Œå®ƒä¼šä¸€ç›´å°è¯•è¯»å–æµä¸­çš„å­—ç¬¦ï¼Œç›´åˆ°å®Œæˆ JSON å­—ç¬¦ä¸²çš„è§£æï¼Œè¿™æ ·å–å‡ºçš„ç»“æœé€šå¸¸æƒ…å†µä¸‹éƒ½æ˜¯å®Œæ•´çš„ï¼Œæå¤§çš„å¢å¼ºäº†å…¶å¥å£®æ€§ã€‚ è¿™é‡Œï¼Œæˆ‘ä»¬å‡å®šè¿”å›ç»“æœè¢«å®Œæ•´å–å‡ºäº†ï¼Œä¹‹åä½¿ç”¨ç›¸åŒçš„ç»“æœå¤„ç†è¿‡ç¨‹ï¼Œå°†è¿”å›çš„å€™é€‰è¯æ›´æ–°åˆ°å€™é€‰è¯åˆ—è¡¨ä¸­ã€‚ æœ€åï¼Œè¿™ä¸ªæ–¹æ³•å°è¯•è°ƒç”¨ cloudCandidates-&gt;m_editor-&gt;update () æ¥å°†æ›´æ–°åçš„å€™é€‰è¯åˆ·æ–°åˆ°è¾“å…¥æ³•é¢æ¿ä¸Šã€‚ 1234567891011voidPhoneticEditor::update (void)&#123; guint lookup_cursor = getLookupCursor (); pinyin_guess_candidates (m_instance, lookup_cursor, m_config.sortOption ()); updateLookupTable (); updatePreeditText (); updateAuxiliaryText ();&#125; è¿™ä¸ªæ–¹æ³•ä¼šé‡æ–°è°ƒç”¨ updateLookupTable æ–¹æ³•ï¼š 12345678910111213voidPhoneticEditor::updateLookupTable (void)&#123; m_lookup_table.clear (); updateCandidates (); fillLookupTable (); if (m_lookup_table.size()) &#123; Editor::updateLookupTable (m_lookup_table, TRUE); &#125; else &#123; hideLookupTable (); &#125;&#125; è¿›è€Œè°ƒç”¨ updateCandidates æ–¹æ³•ï¼š 12345678910111213141516171819gbooleanPhoneticEditor::updateCandidates (void)&#123; m_candidates.clear (); m_libpinyin_candidates.processCandidates (m_candidates); if (m_config.emojiCandidate ()) m_emoji_candidates.processCandidates (m_candidates); #ifdef ENABLE_CLOUD_INPUT_MODE if(m_cloud_candidates.m_cloud_state) m_cloud_candidates.processCandidates (m_candidates);#endif /* ... */ return TRUE;&#125; å¯ä»¥çœ‹åˆ°åœ¨è¿™é‡Œï¼Œæ‰€æœ‰å€™é€‰è¯è¢«æ¸…é™¤åˆé‡æ–°ç”Ÿæˆäº†ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸€æ“ä½œå¹¶ä¸èƒ½æ­£å¸¸å®Œæˆï¼Œå°†äº‘è¾“å…¥çš„å€™é€‰è¯æ›´æ–°åˆ°è¾“å…¥æ³•é¢æ¿çš„æ“ä½œã€‚ 20 ç‰ˆå¼‚æ­¥è¯·æ±‚ åœ¨ cloudResponseCallBack è·å–åˆ°è¿”å›çš„ç»“æœçš„è¾“å…¥æµä¹‹åï¼ŒprocessCloudResponse è¢«è°ƒç”¨æ¥å¤„ç†å’Œè§£æç»“æœï¼Œç»“æœä¼šè¢«æ›´æ–°åˆ°å€™é€‰è¯åˆ—è¡¨ä¸­ï¼Œæ›¿æ¢åŸæ¥çš„å ä½ç¬¦ã€‚è¿™ä¸ªè¿‡ç¨‹åœ¨ä¹‹åçš„æ–‡ç« ä¼šè¯¦ç»†æè¿°ã€‚ å·²è¿‡æœŸï¼š ä¹‹åå°±æ˜¯å°†å€™é€‰æ›´æ–°åˆ°è¾“å…¥æ³•é¢æ¿äº†ï¼Œä¸ºäº†é¿å…å’Œ 18 ç‰ˆä¸€æ ·çš„é—®é¢˜ï¼Œè¿™é‡Œæˆ‘æ²¡æœ‰å†ç›´æ¥è°ƒç”¨ update æ–¹æ³•ï¼Œè€Œæ˜¯é€‰æ‹©æ€§çš„è°ƒç”¨ä¸€äº›æ“ä½œï¼š 1234/* regenerate lookup table */cloudCandidates-&gt;m_editor-&gt;m_lookup_table.clear ();cloudCandidates-&gt;m_editor-&gt;fillLookupTable ();cloudCandidates-&gt;m_editor-&gt;updateLookupTableFast (); æ¸…é™¤æŸ¥è¯¢è¡¨ï¼› ç”¨æ–°çš„å€™é€‰è¯åˆ—è¡¨é‡æ–°å¡«å……æŸ¥è¯¢è¡¨ï¼› å¿«é€Ÿæ›´æ–°æŸ¥è¯¢è¡¨ã€‚ è¿™é‡Œçš„è¿‡ç¨‹æ˜¯å¦å¯ä»¥ç®€åŒ–ï¼Œè¿˜éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å’Œè®¨è®ºã€‚ æ›´æ–°ï¼š åœ¨æœ€æ–°çš„ç‰ˆæœ¬ä¸­ï¼ŒåŠ å…¥äº†æœ€è¿‘ä¸€æ¬¡è¯·æ±‚çš„æ‹¼éŸ³å­—ç¬¦ä¸²å’Œå¯¹åº”çš„ç»“æœçš„ç¼“å­˜ï¼Œæ‰€æœ‰å¯¹å ä½ç¬¦è¿›è¡Œçš„ä¿®æ”¹ã€ä»¥åŠäº‘è¾“å…¥å€™é€‰çš„æ›´æ–°éƒ½è¢«æ”¾åœ¨äº† CloudCandidates::processCandidates ä¸­å¤„ç†ã€‚ å› æ­¤ï¼Œåœ¨éœ€è¦æ›´æ–°çš„æ—¶å€™ï¼Œåªéœ€è¦å°†éœ€è¦çš„å€™é€‰ç½®å…¥ç»“æœç¼“å­˜ m_candidates ä¸­ï¼Œç„¶åè°ƒç”¨ä¸‹é¢çš„æ›´æ–°æ–¹æ³•å³å¯ï¼š 12345678910111213141516171819voidCloudCandidates::updateLookupTable ()&#123; /* retrieve cursor position in lookup table */ guint cursor = m_editor-&gt;m_lookup_table.cursorPos (); /* update cached cloud input candidates */ m_editor-&gt;updateCandidates (); /* regenerate lookup table */ m_editor-&gt;m_lookup_table.clear (); m_editor-&gt;fillLookupTable (); /* recover cursor position in lookup table */ m_editor-&gt;m_lookup_table.setCursorPos (cursor); /* notify ibus */ m_editor-&gt;updateLookupTableFast ();&#125; è¿™ä¸ªæ›´æ–°çš„å®ç°è¿˜è€ƒè™‘äº†ä¿å­˜å…‰æ ‡ä½ç½®ï¼Œå¹¶åœ¨æ›´æ–°ä¹‹åæ¢å¤ï¼Œé˜²æ­¢ç”±äºäº‘è¾“å…¥å€™é€‰çš„æ›´æ–°å¯¼è‡´ç”¨æˆ·é€‰æ‹©å€™é€‰çš„å…‰æ ‡é‡ç½®çš„é—®é¢˜ã€‚ å»¶æ—¶å¼‚æ­¥ å¼‚æ­¥è¯·æ±‚ä¼šåœ¨æ¯ä¸€æ¬¡ processCloudResponse æ—¶å‘å‡ºä¸€ä¸ªæ–°çš„å¼‚æ­¥è¯·æ±‚ï¼Œåœ¨è¿›è¡Œé•¿å¥çš„è¾“å…¥æ—¶ï¼Œä¹‹å‰å‘é€çš„è¯·æ±‚è¿”å›çš„ç»“æœä¼šè¢«ä¸¢å¼ƒï¼Œè¿™é€ æˆäº†å¤§é‡è¯·æ±‚çš„æµªè´¹ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè¿›ä¸€æ­¥çš„æ”¹è¿›åŠ å…¥äº†å»¶æ—¶è¯·æ±‚è¡Œä¸ºã€‚ å»¶æ—¶è¯·æ±‚ä½¿ç”¨äº† glib ä¸­çš„ g_timeout_add_full å‡½æ•°ï¼Œè¯¥å‡½æ•°çš„åŸå‹ä¸ºï¼š 123456guintg_timeout_add_full (gint priority, guint interval, GSourceFunc function, gpointer data, GDestroyNotify notify); å®ƒçš„ç®€åŒ–ç‰ˆå‡½æ•°åŸå‹æ˜¯ï¼š 1234guintg_timeout_add (guint interval, GSourceFunc function, gpointer data); è¯¥å‡½æ•°ä¼šåœ¨ glib çš„äº‹ä»¶å¾ªç¯ä¸­æ·»åŠ ä¸€ä¸ªè¢«å‘¨æœŸè°ƒç”¨çš„å‡½æ•°ï¼Œæ¯éš”ç»™å®šçš„æ¯«ç§’æ•°ä¹‹åï¼Œè¿™ä¸ªå‡½æ•°éƒ½ä¼šè¢«è°ƒç”¨ä¸€æ¬¡ï¼Œç›´åˆ°è¿™ä¸ªå‡½æ•°è¿”å› FALSEã€‚ é—´éš”çš„æ¯«ç§’æ•°ç”± interval ç»™å®šï¼Œè°ƒç”¨çš„å‡½æ•°æ˜¯ä¼ å…¥çš„ function å‚æ•°ï¼Œè€Œ data å˜é‡å¯ä»¥æºå¸¦ä»»ä½•å¼€å‘è€…æƒ³ä¼ å…¥åˆ° function å‡½æ•°ä¸­çš„ç”¨æˆ·æ•°æ®ã€‚æ­¤å¤–ï¼Œå®Œæ•´ç‰ˆçš„å‡½æ•°è¿˜å…è®¸æŒ‡å®šè°ƒç”¨çš„ä¼˜å…ˆçº§ï¼Œä»¥ä¾¿äº‹ä»¶å¾ªç¯åˆç†å®‰æ’è°ƒç”¨é¡ºåºï¼›å¹¶ä¸”å…è®¸ä¼ å…¥ä¸€ä¸ªé”€æ¯å‰çš„é€šçŸ¥ï¼Œæ–¹ä¾¿å¼€å‘è€…è¿›è¡Œä¸€äº›æ¸…ç†å·¥ä½œã€‚ åœ¨ 20 ç‰ˆçš„å®ç°ä¸­ï¼Œä¸ºäº†ä¼ å…¥è¶³å¤Ÿçš„æ•°æ®ï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ªç»“æ„ä½“æ¥å‚¨å­˜ä¸€äº›å¿…è¦ä¿¡æ¯ï¼š 123456typedef struct&#123; guint event_id; const gchar request_str[MAX_PINYIN_LEN + 1]; CloudCandidates *cloud_candidates;&#125; DelayedCloudAsyncRequestCallbackUserData; å…¶ä¸­ï¼Œthread_id event_id æ˜¯å½“å‰çš„ç”¨æˆ·æ•°æ®å¯¹åº”çš„äº‹ä»¶ idï¼Œrequest_str æ˜¯å½“å‰å»¶æ—¶å¸Œæœ›å‘å‡ºè¯·æ±‚æ‰€ç”¨çš„æ‹¼éŸ³ï¼Œè€Œcloud_candidates åˆ™æ˜¯å¯¹äº‘è¾“å…¥å€™é€‰è¿›è¡Œå¤„ç†çš„å®ä¾‹çš„å¼•ç”¨ï¼Œä¹Ÿå°±æ˜¯å»¶æ—¶çš„å‘é€è€…ã€‚ åœ¨åˆ›å»ºå»¶æ—¶ä¹‹å‰ï¼Œä¼šé¦–å…ˆåˆ†é…ã€åˆ›å»ºä¸€ä¸ª DelayedCloudAsyncRequestCallbackUserData çš„å®ä¾‹ï¼Œå¹¶æŠŠå¯¹åº”çš„æ•°æ®å¡«å…¥ã€‚ ç„¶åï¼Œåˆ›å»ºå»¶æ—¶äº‹ä»¶å¹¶åœ¨å½“å‰ CloudCandidates å®ä¾‹ä¸­è®°å½•å…¶ idï¼š 1event_id = m_source_event_id = g_timeout_add_full(G_PRIORITY_DEFAULT, m_delayed_time, delayedCloudAsyncRequestCallBack, user_data, delayedCloudAsyncRequestDestroyCallBack); å‡½æ•° delayedCloudAsyncRequestCallBack ä¼šåœ¨å»¶æ—¶ç»“æŸåè¢«è°ƒç”¨ï¼ŒdelayedCloudAsyncRequestDestroyCallBack åˆ™ä¼šåœ¨ delayedCloudAsyncRequestCallBack è¿”å› FALSEï¼Œäº‹ä»¶å¾ªç¯å†³å®šç»“æŸå»¶æ—¶äº‹ä»¶åè¢«è°ƒç”¨ã€‚ ç¬¬äºŒä¸ªå‡½æ•° delayedCloudAsyncRequestDestroyCallBack æ¯”è¾ƒç®€å•ï¼Œè¿™é‡Œå…ˆè¡Œä»‹ç»ï¼š 1234567voidCloudCandidates::delayedCloudAsyncRequestDestroyCallBack (gpointer user_data)&#123; /* clean up */ if (user_data) g_free (user_data);&#125; å³å°†ä¹‹å‰åˆ›å»ºçš„ç”¨æˆ·æ•°æ®æ‰€å ç”¨çš„å†…å­˜é‡Šæ”¾ï¼Œé¿å…å†…å­˜æ³„æ¼ã€‚ è€Œåœ¨ delayedCloudAsyncRequestCallBack ä¸­ï¼Œé™¤äº†ä¸€å¼€å§‹å¯¹æ•°æ®è¿›è¡Œæ£€æŸ¥å¤–ï¼Œæœ€é‡è¦çš„æ˜¯è¿™æ®µä»£ç ï¼š 123456/* only send with a latest timer */if (data-&gt;event_id == cloudCandidates-&gt;m_source_event_id)&#123; cloudCandidates-&gt;m_source_event_id = 0; cloudCandidates-&gt;cloudAsyncRequest(data-&gt;request_str);&#125; é¦–å…ˆï¼Œå¯¹å½“å‰ç”¨æˆ·æ•°æ®ä¸­çš„äº‹ä»¶ id å’Œ CloudCandidates å®ä¾‹ä¸­è®°å½•çš„ id è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœä¸€è‡´ï¼Œè¯´æ˜æˆ‘ä»¬å½“å‰äº‹ä»¶çš„ç¡®æ˜¯æœ€è¿‘ä¸€æ¬¡å‘å‡ºçš„å»¶æ—¶äº‹ä»¶ï¼Œåˆ™è°ƒç”¨å¯¹åº”çš„å‡½æ•°ï¼Œå¼€å§‹å‘é€å¼‚æ­¥è¯·æ±‚ã€‚ æœ€åï¼Œæ— è®ºåœ¨å“ªç§æƒ…å†µä¸‹ï¼Œéƒ½ä¼šè¿”å› FALSEï¼Œä»¥ä¾¿è®©äº‹ä»¶å¾ªç¯å¼€å§‹æ¸…ç†ï¼Œè€Œéç»§ç»­å¾ªç¯æ‰§è¡Œè¯¥äº‹ä»¶ã€‚ ç›®å‰çš„å»¶æ—¶æ—¶é•¿ä¸º 600msï¼Œä¹Ÿå¯ä»¥åœ¨ gsetting ä¸­é…ç½®ã€‚ å¤„ç†ç”¨æˆ·é€‰æ‹©çš„å€™é€‰ é™¤å»ä¸­é—´çš„å¤„ç†äº‘è¾“å…¥è¯·æ±‚è¿”å›ç»“æœçš„è¿‡ç¨‹ï¼ˆåœ¨ã€Šå€™é€‰è¯è§£æã€‹è¿™ç¯‡æ–‡ç« ä¸­è¯¦è¿°ï¼‰ï¼Œå’Œç”¨æˆ·äº¤äº’çš„æœ€åä¸€æ­¥å°±æ˜¯ç”¨æˆ·å¯¹å€™é€‰è¿›è¡Œé€‰æ‹©çš„è¿‡ç¨‹ã€‚ åœ¨è¿™ä¸€è¿‡ç¨‹ä¸­ï¼ŒCloudCandidates å®ä¾‹ä¸­çš„ selectCandidate ä¼šè¢«è°ƒç”¨ï¼Œè¢«é€‰ä¸­çš„å€™é€‰ä¼šä½œä¸ºå‚æ•°ä¼ å…¥ã€‚ é¦–å…ˆå¯¹å…¶è¿›è¡Œä¸€ä¸ªåˆ¤æ–­ï¼Œç¡®å®šè¿™ä¸ªå€™é€‰è¯å·²ç»æ˜¯å¦ä»æ˜¯å ä½ç¬¦ï¼Œè‹¥æ˜¯å ä½ç¬¦ï¼Œåˆ™æš‚æ—¶ä¸åšå‡ºååº”ã€‚è‹¥ä¸æ˜¯å ä½ç¬¦ï¼Œå°±è¿›è¡Œè¿›ä¸€æ­¥çš„å¤„ç†ã€‚ åœ¨æœ€æ–°çš„ç‰ˆæœ¬ä¸­ï¼Œä¼ å…¥çš„å€™é€‰æ˜¯å¸¦æœ‰äº‘è¾“å…¥å‰ç¼€ â˜ çš„ï¼Œè€Œåœ¨ CloudCandidates å®ä¾‹çš„ m_candidates ä¸­ç¼“å­˜äº†ä¸å¸¦æœ‰å‰ç¼€çš„å€™é€‰ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å°è¯•æ‰¾åˆ°å¯¹åº” id çš„å€™é€‰ï¼Œå°†ä¼ å…¥çš„å€™é€‰ä¿®æ”¹ä¸ºæ— å‰ç¼€çš„äº‘è¾“å…¥å€™é€‰è¯å¹¶è¿”å›ã€‚è¿™æ—¶å€™é€‰è¯å°±ä¼šä¸Šå±ã€‚ 12345678/* take the cached candidate with the same candidate id */for (std::vector&lt;EnhancedCandidate&gt;::iterator pos = m_candidates.begin(); pos != m_candidates.end(); ++pos) &#123; if (pos-&gt;m_candidate_id == enhanced.m_candidate_id) &#123; enhanced.m_display_string = pos-&gt;m_display_string; /* modify in-place and commit */ return SELECT_CANDIDATE_COMMIT | SELECT_CANDIDATE_MODIFY_IN_PLACE; &#125;&#125; åœ¨ä¸Šä¸€ç‰ˆä¸­ï¼ŒCloudCandidates å®ä¾‹çš„ m_candidates æ²¡æœ‰è¢«å¾ˆå¥½çš„åˆ©ç”¨ã€‚å»é™¤äº‘è¾“å…¥å‰ç¼€ â˜ çš„å¤„ç†æ˜¯é€šè¿‡è¿­ä»£å™¨ä¿®æ”¹ä¼ å…¥çš„å€™é€‰æ¥å®Œæˆçš„ã€‚ä¸è¿‡ä¹Ÿèƒ½è¾¾åˆ°ç›¸åŒçš„ç›®çš„ã€‚ æ€»ç»“ æœ¬æ–‡æŒ‰ç…§äº‹ä»¶å‘ç”Ÿçš„æ—¶é—´é¡ºåºç²—ç•¥æè¿°äº†äº‘è¾“å…¥åŠŸèƒ½èƒŒåå‘ç”Ÿäº†ä»€ä¹ˆï¼Œå…¶ä¸­ä¸­é—´çš„ä¸€äº›éƒ¨åˆ†ä¼šæ”¾åœ¨å…¶ä»–çš„ç›¸å…³æ–‡ç« ä¸­è¯¦ç»†æè¿°ã€‚ è€Œéšç€ç‰ˆæœ¬çš„è¿­ä»£ï¼Œæ•´ä½“æµç¨‹å¯èƒ½è¿˜æ˜¯ä¼šå‘ç”Ÿä¸€äº›å¾®å°çš„å˜åŒ–ï¼Œè¿™ç¯‡æ–‡ç« ä¹Ÿä¼šè·Ÿç€æ›´æ–°ã€‚","categories":[{"name":"ibus-libpinyin","slug":"ibus-libpinyin","permalink":"https://blog.inoki.cc/categories/ibus-libpinyin/"}],"tags":[{"name":"IBus","slug":"IBus","permalink":"https://blog.inoki.cc/tags/IBus/"},{"name":"ibus-libpinyin","slug":"ibus-libpinyin","permalink":"https://blog.inoki.cc/tags/ibus-libpinyin/"},{"name":"Cloud Input","slug":"Cloud-Input","permalink":"https://blog.inoki.cc/tags/Cloud-Input/"}]},{"title":"ã€è¯‘ã€‘LoRaWAN å…¥é—¨","slug":"LoRa-Primer","date":"2020-05-26T10:28:00.000Z","updated":"2025-03-08T09:40:48.583Z","comments":true,"path":"2020/05/26/LoRa-Primer/","link":"","permalink":"https://blog.inoki.cc/2020/05/26/LoRa-Primer/","excerpt":"","text":"LoRaWANï¼ˆæˆ–ç®€ç§° LoRaï¼‰æ˜¯ LPWANï¼ˆâ€œä½åŠŸè€—å¹¿åŸŸç½‘â€ï¼‰æŠ€æœ¯ã€‚æ‰€ä½¿ç”¨çš„æ— çº¿ç”µæŠ€æœ¯å¾ˆæ¼‚äº®ï¼Œå¯ç¡®ä¿æ‚¨ä»¥å¾ˆå°çš„å‘å°„åŠŸç‡å°±å¯ä»¥åœ¨ç›¸å½“é•¿çš„è·ç¦»å†…å‘é€æ•°æ®ã€‚ LoRa åœ¨ç§°ä¸ºçš„ ISM ï¼ˆä¹Ÿç§°ä¸ºâ€œå·¥ä¸šç§‘å­¦åŒ»å­¦â€ï¼‰é¢‘æ®µä¸­è¿è¡Œï¼Œè¯¥é¢‘æ®µæ˜¯æœªç»è®¸å¯çš„æ— çº¿ç”µé¢‘è°±çš„ä¸€éƒ¨åˆ†ã€‚è¿™å¹¶ä¸æ„å‘³ç€æ‚¨å¯ä»¥ä»¥ä»»ä½•æœŸæœ›çš„æ–¹å¼ä½¿ç”¨å®ƒï¼Œä¸€æ¬¡å¯ä»¥ä½¿ç”¨å¤šå°‘åŠŸç‡ä»¥åŠå¯ä»¥ä¼ è¾“å¤šé•¿æ—¶é—´æ˜¯æœ‰é™åˆ¶çš„ã€‚è¿™å°±æ˜¯æ‰€è°“çš„â€œå ç©ºæ¯”â€ã€‚LoRa çš„å ç©ºæ¯”åœ¨1ï¼…åˆ°0.1ï¼…ä¹‹é—´ï¼Œå…·ä½“å–å†³äºæ‚¨è¦å‘é€çš„æ¯”ç‰¹ç‡ã€‚ LoRaWAN çš„é¸Ÿç°å›¾ LoRaWANç½‘ç»œç”±ç½‘å…³ï¼Œç½‘ç»œï¼Œåº”ç”¨ç¨‹åºå’Œè®¾å¤‡ç»„æˆã€‚è®¾å¤‡å°†æ— çº¿ç”µæ•°æ®åŒ…å‘é€åˆ°ç½‘ç»œçš„ç½‘å…³ã€‚ç½‘ç»œç”±å†æ¬¡ç”±é›¶ä¸ªæˆ–å¤šä¸ªè®¾å¤‡ç»„æˆçš„åº”ç”¨ç¨‹åºç»„æˆã€‚ç½‘ç»œå’Œåº”ç”¨ç¨‹åºé€šå¸¸æ˜¯åç«¯æœåŠ¡ä¸­çš„æŠ½è±¡ã€‚ è®¾å¤‡é€šè¿‡æ— çº¿ç”µä¸ä¸€ä¸ªæˆ–å¤šä¸ªç½‘å…³é€šä¿¡ã€‚æ¯ä¸ªæ•°æ®åŒ…éƒ½å¾ˆçŸ­ï¼Œé€šå¸¸ä¸è¶…è¿‡å‡ åä¸ªå­—èŠ‚ã€‚æ•°æ®åŒ…è¢«ä¸€ä¸ªæˆ–å¤šä¸ªç½‘å…³æ‹¾å–ï¼Œè®¾å¤‡è¿›å…¥ç¡çœ çŠ¶æ€ï¼Œé€šå¸¸ç­‰å¾…ä¸€ç§’é’Ÿï¼Œç„¶åè®¾å¤‡å¼€å§‹ä¾¦å¬æ¥è‡ªç½‘å…³çš„å“åº”ã€‚å¦‚æœç½‘å…³å…·æœ‰ä¸ºè®¾å¤‡å®‰æ’çš„æ•°æ®ï¼Œå®ƒå°†æŠŠæ•°æ®å‘é€åˆ°è®¾å¤‡ã€‚å®Œæˆæ­¤æ“ä½œåï¼Œè®¾å¤‡å°†å†æ¬¡è¿›å…¥ç¡çœ çŠ¶æ€ï¼Œç›´åˆ°æœ‰æ›´å¤šæ•°æ®å¹¶å…è®¸å…¶æ ¹æ®å ç©ºæ¯”å‘é€ä¸ºæ­¢ã€‚ ç½‘å…³å°†æ— çº¿ç”µæ•°æ®åŒ…è§£ç ä¸ºä¸€ä¸ªå°ç¼“å†²åŒºï¼Œç„¶åå°†ç¼“å†²åŒºè½¬å‘åˆ° LoRa åç«¯ã€‚LoRa åç«¯è·Ÿè¸ªæ‰€æœ‰ç½‘å…³å’Œç½‘ç»œï¼Œå¹¶ç¡®å®šæ•°æ®åŒ…æ‰€å±çš„ç½‘ç»œï¼Œå¦‚æœç½‘ç»œçŸ¥é“è®¾å¤‡ï¼Œåˆ™å°†æ•°æ®ä¼ é€’åˆ°è¯¥è®¾å¤‡æ‰€å±çš„åº”ç”¨ç¨‹åºã€‚å¦‚æœä¸ºè¯¥è®¾å¤‡å®‰æ’äº†æ•°æ®ï¼Œå®ƒå°†é€šè¿‡ç½‘å…³è¿”å›åˆ°è¯¥è®¾å¤‡ã€‚ å¸¦å®½ ç”±äºè®¾å¤‡å‘é€çš„æ•°æ®åŒ…å¾ˆå°ï¼Œå¹¶ä¸”è®¾å¤‡æ¯äº”åˆ†é’Ÿä»…å‘é€ä¸€ä¸ªæ•°æ®åŒ…ï¼Œå› æ­¤æ‚¨ä¸ä¼šåœ¨è®¾å¤‡ä¹‹é—´æ”¶åˆ°å¤§é‡æ•°æ®ï¼Œå› æ­¤å…¸å‹çš„ç”¨ä¾‹åœºæ™¯æ˜¯è®¾å¤‡ä¸ç»å¸¸å‘é€ï¼Œä¸”å‘é€å°‘é‡æ•°æ®ï¼Œé€šå¸¸æ¯å°æ—¶æˆ–æ¯å¤©åªæœ‰å‡ æ¬¡ã€‚ èŒƒå›´ è®¾å¤‡çš„è¦†ç›–èŒƒå›´ä»¤äººå°è±¡æ·±åˆ»ã€‚ä¸€ä¸ªç®€å•çš„æœ‰çº¿å¤©çº¿è¶³ä»¥åˆ°è¾¾å‡ å…¬é‡Œå¤–çš„ç½‘å…³ã€‚åœ¨é‡‘å±ç¬¼å­é‡Œå°†æ— æ³•è·å¾—è‰¯å¥½çš„è¦†ç›–ï¼Œæ— çº¿ç”µæ³¢ä¸ä¼šç©¿è¿‡å¢™å£æˆ–é‡‘å±ï¼Œä½†æ˜¯è¯¥åè®®æœ¬èº«å¯ä»¥å®ç°å¾®å¼±çš„ä¼ è¾“ã€‚ç°åœºå®éªŒè¡¨æ˜ï¼ŒLoRa è®¾å¤‡åœ¨åŸå¸‚ç¯å¢ƒä¸­å¯ä»¥è¾¾åˆ°å‡ å…¬é‡Œçš„èŒƒå›´ï¼Œå¹¶ä¸”è§†çº¿èŒƒå›´ç”šè‡³å¯ä»¥è¾¾åˆ° 20 å…¬é‡Œç”šè‡³æ›´é«˜ã€‚æ— çº¿ç”µæ³¢å¾ˆå¥‡æ€ªï¼Œå› æ­¤ä½ å¯èƒ½å¯ä»¥åœ¨çœ‹ä¼¼ä¸å¯èƒ½çš„åœ°æ–¹è·å¾—è‰¯å¥½çš„è¦†ç›–ï¼Œè€Œåœ¨å…¶ä»–åœ°æ–¹å‡ ä¹æ²¡æœ‰ã€‚ è·å–ç½‘å…³ å¦‚æœæ‚¨æ— æ³•åœ¨è‡ªå·±çš„ä½æ‰€æˆ–åŸé•‡ä¸­å¾—åˆ°è¦†ç›–ï¼Œè¯·ä¸è¦æ‹…å¿ƒã€‚LoRa ç½‘å…³ç›¸å¯¹ä¾¿å®œï¼ˆ200æ¬§å…ƒåŠä»¥ä¸Šï¼‰ï¼Œå‡ ä¹ä¸éœ€è¦ç»´æŠ¤ã€‚ä¸è¿‡ï¼Œç½‘å…³å¿…é¡»è¿æ¥åˆ°ä¸€é¡¹åç«¯æœåŠ¡ï¼Œå¹¶ä¸”æœ‰å¾ˆå¤šå¯ä¾›é€‰æ‹©ã€‚æœ€è‘—åçš„æœåŠ¡æ˜¯ The Things Network å’Œ loriot.ioï¼Œå®ƒä»¬éƒ½å…è®¸æ‚¨è¿æ¥è‡ªå·±çš„ç½‘å…³ã€‚å¦‚æœæ‚¨ä½åœ¨æŒªå¨ï¼Œåˆ™å¯ä»¥ä» Telenor è¿æ¥åˆ° Cloud Connectã€‚æˆ‘ä»¬å·²ç»è¦†ç›–äº†å‡ ä¸ªåŸå¸‚ï¼Œå¹¶ä¸”è¿™é¡¹æœåŠ¡æ˜¯å…è´¹çš„ï¼Œå¯ç”¨äºå¼€å‘å·¥ä½œã€‚ å®‰å…¨ LoRaWAN ç½‘ç»œä¸­çš„è®¾å¤‡å’Œåº”ç”¨ç¨‹åºä¹‹é—´ä¼ è¾“çš„æ‰€æœ‰æ•°æ®å‡ä½¿ç”¨ AES-128 åŠ å¯†ï¼Œä½¿ç”¨ä¸¤ä¸ªåŠ å¯†å¯†é’¥ï¼Œä¸€ä¸ªç½‘ç»œä¼šè¯å¯†é’¥å’Œä¸€ä¸ªåº”ç”¨ç¨‹åºä¼šè¯å¯†é’¥ã€‚è¿™ä¸¤ä¸ªå¯†é’¥å¯¹äºè®¾å¤‡è€Œè¨€éƒ½æ˜¯å”¯ä¸€çš„ï¼Œåˆ†åˆ«ç”¨äºç½‘ç»œæ¶ˆæ¯å’Œåº”ç”¨ç¨‹åºæœ‰æ•ˆè´Ÿè½½ã€‚å¦‚æœæ‚¨ä½¿ç”¨ä¸€äº›èªæ˜çš„å¯†é’¥ç®¡ç†ç­–ç•¥ï¼Œåˆ™å¯ä»¥ä½¿åº”ç”¨ç¨‹åºä¸è®¾å¤‡çš„è´Ÿè½½æœ‰æ•ˆåŠ å¯†ï¼Œä»…ç”±åº”ç”¨ç¨‹åºå’Œè®¾å¤‡å…±äº«ï¼Œè€Œç½‘ç»œï¼ˆæˆ–ç½‘å…³ï¼‰æ“ä½œå‘˜ä¸çŸ¥é“æœ‰æ•ˆè´Ÿè½½æ˜¯ä»€ä¹ˆã€‚ ç½‘è·¯ LoRaWAN ä¸­çš„ç½‘ç»œçš„å·¥ä½œæ–¹å¼ç±»ä¼¼äºæ‰‹æœºç½‘ç»œã€‚å¤šä¸ªç½‘ç»œå¯ä»¥åœ¨åŒä¸€åŒºåŸŸä¸­è¿è¡Œï¼Œå¹¶ä¸”å¤šä¸ªç½‘ç»œå¯ä»¥åœ¨åŒä¸€ç½‘å…³ä¹‹å¤–è¿è¡Œã€‚æœ€å¤§çš„åŒºåˆ«æ˜¯ LoRaWAN ä¸­çš„è®¾å¤‡æ— æ³•ä»ä¸€ä¸ªç½‘ç»œè·³åˆ°å¦ä¸€ä¸ªç½‘ç»œï¼Œå› ä¸ºè¿æ¥åˆ°åº”ç”¨ç¨‹åºçš„è®¾å¤‡åªèƒ½æ˜¯å•ä¸ªç½‘ç»œçš„æˆå‘˜ã€‚ åº”ç”¨é¢†åŸŸ LoRaWAN ä¸­çš„åº”ç”¨ç¨‹åºåªæ˜¯åœ¨ç»™å®šç½‘ç»œä¸Šè¿è¡Œçš„è®¾å¤‡çš„é›†åˆã€‚ä¸€å°è®¾å¤‡ä¸èƒ½å±äºä¸€ä¸ªä»¥ä¸Šçš„åº”ç”¨ç¨‹åºï¼Œæ²¡æœ‰åº”ç”¨ç¨‹åºçš„è¯è¯¥è®¾å¤‡ä¹Ÿå°±ä¸èƒ½å­˜åœ¨ã€‚ ç›¸å…³é“¾æ¥ äº†è§£LoRaWANçš„å±€é™æ€§ï¼ˆAdelantadoï¼ŒVilajosanaç­‰äººï¼ŒIEEEæ‚å¿—2017å¹´1æœˆï¼‰ï¼šhttps://arxiv.org/pdf/1607.08011.pdf","categories":[{"name":"LoRa","slug":"LoRa","permalink":"https://blog.inoki.cc/categories/LoRa/"}],"tags":[{"name":"ç¿»è¯‘","slug":"ç¿»è¯‘","permalink":"https://blog.inoki.cc/tags/ç¿»è¯‘/"},{"name":"ä¸­æ–‡","slug":"ä¸­æ–‡","permalink":"https://blog.inoki.cc/tags/ä¸­æ–‡/"},{"name":"LoRaWAN","slug":"LoRaWAN","permalink":"https://blog.inoki.cc/tags/LoRaWAN/"},{"name":"LoRa","slug":"LoRa","permalink":"https://blog.inoki.cc/tags/LoRa/"},{"name":"IoT","slug":"IoT","permalink":"https://blog.inoki.cc/tags/IoT/"}]},{"title":"ã€è¯‘ã€‘LoRa æ•°æ®é€Ÿç‡å’Œæ‰©é¢‘å› å­","slug":"LoRa-Data-rate-and-spreading-factor","date":"2020-05-25T11:20:00.000Z","updated":"2025-03-08T09:40:48.582Z","comments":true,"path":"2020/05/25/LoRa-Data-rate-and-spreading-factor/","link":"","permalink":"https://blog.inoki.cc/2020/05/25/LoRa-Data-rate-and-spreading-factor/","excerpt":"","text":"åŸæ–‡é“¾æ¥ï¼šhttps://docs.exploratory.engineering/lora/dr_sf/ æˆ–æ—©æˆ–æ™šä½ ä¼šé‡åˆ°æœ¯è¯­ï¼šæ•°æ®é€Ÿç‡ï¼ˆDRï¼‰ï¼Œæ‰©é¢‘å› å­ï¼ˆSFï¼‰å’Œå¸¦å®½ï¼ˆBWï¼‰ã€‚è¿™ä¸‰ä¸ªæœ¯è¯­æ˜¯ç›¸å…³çš„ï¼Œä½†æ˜¯å®ƒä»¬ä¹‹é—´çš„è”ç³»å¹¶ä¸æ˜¯å¾ˆæ˜æ˜¾ã€‚ LoRaä½¿ç”¨äº†æ‰€è°“çš„â€œçº¿æ€§è°ƒé¢‘â€åè®®ï¼Œè¯¥åè®®æ˜¯åœ¨ç¬¬äºŒæ¬¡ä¸–ç•Œå¤§æˆ˜æœŸé—´ä¸ºå£°çº³å’Œé›·è¾¾åº”ç”¨å¼€å‘çš„ï¼Œå› æ­¤ç»ä¸æ˜¯ä¸€é¡¹æ–°æŠ€æœ¯ã€‚ çº¿æ€§è°ƒé¢‘åè®®ä½¿ç”¨å›ºå®šå¹…åº¦çš„é¢‘ç‡è°ƒåˆ¶ã€‚å®ƒå¯ä»¥é€šè¿‡äº§ç”Ÿæ‰«è¿‡æ•´ä¸ªä¿¡é“çš„ä¿¡å·æ¥åˆ©ç”¨åˆ†é…çš„æ•´ä¸ªé¢‘è°±æ¥ä¼ è¾“ä¿¡å·,è¿™ç§ä¿¡å·ç§°ä¸ºå•å•¾ã€‚å•å•¾æœ‰ä¸¤ç§ï¼šâ€œä¸Šå•å•¾â€é¢‘ç‡å‘ä¸Šç§»åŠ¨å’Œï¼ˆæ¯«ä¸æ„å¤–ï¼‰â€œä¸‹å•å•¾â€é¢‘ç‡å‘ä¸‹ç§»åŠ¨ï¼Œå³å½“æœ‰å•å•¾æ—¶ï¼Œå®ƒå°†æ²¿åˆ†é…çš„é¢‘ç‡åœ¨ä¸€ä¸ªæ–¹å‘ä¸Šç§»åŠ¨ ã€‚ å¸¦å®½ LoRaä½¿ç”¨ä¸‰ç§å¸¦å®½ï¼š125kHzï¼Œ250kHz å’Œ 500kHzï¼Œçº¿æ€§è°ƒé¢‘è„‰å†²ä¼šå ç”¨æ•´ä¸ªå¸¦å®½ã€‚å¦‚æœæ‚¨åœ¨ç±»ä¼¼ Gqrx çš„ SDR åº”ç”¨ç¨‹åºä¸­æŸ¥çœ‹ LoRa æ•°æ®åŒ…ï¼Œåˆ™ä¼šçœ‹åˆ°æ¸…æ™°å®šä¹‰çš„å•å•¾æ­£æ–¹å½¢ã€‚ æ‰©é¢‘å› å­ ç®€è€Œè¨€ä¹‹ï¼Œæ‰©é¢‘å› å­æ˜¯rpçš„æŒç»­æ—¶é—´ã€‚ LoRa çš„æ‰©é¢‘å› å­ä¸º 7 åˆ° 12ã€‚SF7æ˜¯ç©ºä¸­æ—¶é—´æœ€çŸ­çš„ï¼ŒSF12æ˜¯ç©ºä¸­æ—¶é—´æœ€é•¿çš„ã€‚æ‰©å±•å› å­çš„æ¯å¢åŠ ä¸€ï¼Œä¼ è¾“ç›¸åŒæ•°é‡æ•°æ®çš„æ—¶é—´å°±è¦å¢åŠ ä¸€å€ã€‚åœ¨ç›¸åŒçš„å¸¦å®½ä¸‹ï¼Œæ›´é•¿çš„ç©ºä¸­æ—¶é—´æ˜¾ç„¶ä¼šå¯¼è‡´å•ä½æ—¶é—´å†…ä¼ è¾“çš„æ•°æ®æ›´å°‘ã€‚ æ•°æ®é€Ÿç‡ LoRaWAN ä½¿ç”¨ä¸åŒçš„é¢‘ç‡ï¼Œæ‰©é¢‘å› å­å’Œå¸¦å®½é…ç½®ï¼Œå…·ä½“å–å†³äºæ‚¨åœ¨ä¸–ç•Œä¸Šçš„ä½ç½®ã€‚å¯¹äº EU868ï¼ŒEU433ï¼ŒCN780 å’Œ AS923 é¢‘æ®µï¼Œæ•°æ®é€Ÿç‡å¦‚ä¸‹ï¼š Data Rate Configuration bits/s Max payload DR0 SF12/125kHz 250 59 DR1 SF11/125kHz 440 59 DR2 SF10/125kHz 980 59 DR3 SF9/125kHz 1 760 123 DR4 SF8/125kHz 3 125 230 DR5 SF7/125kHz 5 470 230 DR6 SF7/250kHz 11 000 230 DR7 FSK: 50kpbs 50 000 230 è¯·æ³¨æ„ï¼Œå–å†³äºé…ç½®ï¼ŒAS923 é¢‘å¸¦å¯èƒ½ä¸ä½¿ç”¨ DR0 å’Œ DR1ã€‚ åœ¨ US902-928 å’Œ AU915-928 é¢‘æ®µä¸­ï¼Œæ•°æ®é€Ÿç‡å¦‚ä¸‹ï¼š Data Rate Configuration bits/s Max payload DR0 SF10/125kHz 980 19 DR1 SF9/125kHz 1 760 61 DR2 SF8/125kHz 3 125 133 DR3 SF7/125kHz 5 470 250 DR4 SF8/500kHz 12 500 250 DR8 SF12/500kHz 980 41 DR9 SF11/500kHz 1 760 117 DR10 SF10/500kHz 3 900 230 DR11 SF9/500kHz 7 000 230 DR12 SF8/500kHz 12 500 230 DR13 SF7/500kHz 21 900 230 å¯¹äº CN470-510 å’Œ KR920-923 é¢‘æ®µï¼Œåªæœ‰äº”ä¸ªå®šä¹‰çš„æ•°æ®é€Ÿç‡ï¼š Data Rate Configuration bits/s Max payload DR0 SF12/125kHz 250 59 DR1 SF11/125kHz 440 59 DR2 SF10/125kHz 980 59 DR3 SF9/125kHz 1 760 123 DR4 SF8/125kHz 3 125 230 DR5 SF7/125kHz 5 470 230 å¦‚è¡¨æ‰€è§ï¼ŒDR4 åœ¨ä¸¤ä¸ªä¸åŒçš„åœ°åŒºå¯èƒ½æ˜¯ä¸¤ä¸ªä¸åŒçš„ä¸œè¥¿ã€‚å¹¸è¿çš„æ˜¯ï¼Œæ‚¨ä¸å¿…æ‹…å¿ƒè¿™ä¸€ç‚¹ï¼Œå› ä¸ºè®¾å¤‡ä¸Šçš„åº“å’Œåç«¯æœåŠ¡é€šå¸¸ä¼šè®¾æ³•é€‰æ‹©è¦ä½¿ç”¨çš„æœ€ä½³æ•°æ®é€Ÿç‡ã€‚ ä¿¡æ¯æœ€å¤§æœ‰æ•ˆè´Ÿè½½å¤§å°å¾ˆé‡è¦ï¼ å³ä½¿é€šå¸¸æƒ…å†µä¸‹å¯ä»¥å¿½ç•¥æ‰€é€‰çš„æ•°æ®é€Ÿç‡ï¼Œæœ€å¤§æœ‰æ•ˆè´Ÿè½½å¤§å°ä¹Ÿæ„å‘³ç€åº”å°†æœ‰æ•ˆè´Ÿè½½è¿›è¡Œé™åˆ¶ã€‚å¦‚æœè·è½½è¶…è¿‡æœ€å¤§é•¿åº¦ï¼Œåˆ™åº”å°†å…¶åˆ†æˆå¤šæ®µã€‚","categories":[{"name":"LoRa","slug":"LoRa","permalink":"https://blog.inoki.cc/categories/LoRa/"}],"tags":[{"name":"ç¿»è¯‘","slug":"ç¿»è¯‘","permalink":"https://blog.inoki.cc/tags/ç¿»è¯‘/"},{"name":"ä¸­æ–‡","slug":"ä¸­æ–‡","permalink":"https://blog.inoki.cc/tags/ä¸­æ–‡/"},{"name":"LoRaWAN","slug":"LoRaWAN","permalink":"https://blog.inoki.cc/tags/LoRaWAN/"},{"name":"LoRa","slug":"LoRa","permalink":"https://blog.inoki.cc/tags/LoRa/"},{"name":"IoT","slug":"IoT","permalink":"https://blog.inoki.cc/tags/IoT/"}]},{"title":"ã€è¯‘ã€‘LoRa ä¸­çš„å…³é”®æ¦‚å¿µ","slug":"LoRa-Key_Concept","date":"2020-05-25T11:20:00.000Z","updated":"2025-03-08T09:40:48.583Z","comments":true,"path":"2020/05/25/LoRa-Key_Concept/","link":"","permalink":"https://blog.inoki.cc/2020/05/25/LoRa-Key_Concept/","excerpt":"","text":"åŸæ–‡é“¾æ¥ï¼šhttps://docs.exploratory.engineering/lora/lora_key_concepts/ LoRaWAN å…³é”®æ¦‚å¿µ LoRaWAN è®¾å¤‡çš„é…ç½®å¯èƒ½ä¼šä»¤äººå›°æƒ‘ã€‚æ‚¨éœ€è¦è·Ÿè¸ªä¸¤ä¸ªå…³é”®ç‚¹ï¼ŒEUI å’Œå¿…é¡»çš„å„ç§å„æ ·å¥‡æ€ªçš„é…ç½®å‚æ•°ã€‚ è®¾å¤‡ EUIï¼Œç½‘ç»œ EUIï¼Œåº”ç”¨ EUI å’Œ DevAddr åœ¨ LoRaWAN ä¸­ï¼Œç½‘ç»œï¼Œåº”ç”¨ç¨‹åºå’Œè®¾å¤‡ç”± EUI64 æ ‡è¯†ç¬¦æ ‡è¯†ã€‚EUI64æ˜¯å…¨çƒå”¯ä¸€çš„æ ‡è¯†ç¬¦ã€‚æ‚¨å¯ä»¥åœ¨æ­¤å¤„äº†è§£æ›´å¤šä¿¡æ¯ï¼šhttps://standards.ieee.org/develop/regauth/tut/eui64.pdfã€‚EUI ç”¨äºåœ¨åç«¯æœåŠ¡å™¨å†…éƒ¨æ ‡è¯† LoRaWAN æ‰€æœ‰çš„ï¼ˆè™šæ‹Ÿï¼‰éƒ¨åˆ†ã€‚ DevAddr å€¼æ˜¯ç‰¹å®šç½‘ç»œä¸­è®¾å¤‡çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚å®ƒç”± NwkID å’Œ NetAddr çš„ä¸¤ä¸ªä¸åŒéƒ¨åˆ†ç»„æˆï¼Œè¿™æ˜¯ä¸€ä¸ª32ä½æ— ç¬¦å·æ•´æ•°ï¼Œç”¨äºæ ‡è¯†ä½ çš„è®¾å¤‡ï¼Œæ˜¯è®¾å¤‡åŠ å…¥ç½‘ç»œåç”¨äºæ ‡è¯†è®¾å¤‡çš„æ ‡è¯†ç¬¦ã€‚ ç½‘ç»œå’Œåº”ç”¨ç¨‹åºä¼šè¯å¯†é’¥ LoRaWAN ä¸­çš„åŠ å¯†ç›¸å¯¹ç®€å•ã€‚å¦‚æœæ‚¨ä½¿ç”¨ABPï¼ˆâ€œä¸ªæ€§åŒ–æ¿€æ´»â€è®¾å¤‡ï¼›å…·æœ‰é¢„é…ç½®å¯†é’¥çš„è®¾å¤‡ï¼‰ï¼Œåˆ™å¯èƒ½éœ€è¦æ‹…å¿ƒä¸¤ä¸ªå¯†é’¥ï¼š ç½‘ç»œä¼šè¯å¯†é’¥æ˜¯ç½‘ç»œå’Œè®¾å¤‡å·²çŸ¥çš„æ¯ä¸ªè®¾å¤‡çš„å”¯ä¸€å¯†é’¥ï¼Œè¯¥å¯†é’¥ç”¨äºä¸æºå¸¦ä»»ä½•æœ‰æ•ˆè´Ÿè½½çš„å†…éƒ¨ç®¡ç†æ¶ˆæ¯ã€‚è¯¥å¯†é’¥ç”¨äºå‘å‘é€åˆ°è®¾å¤‡çš„æ¶ˆæ¯æ·»åŠ æ ¡éªŒå’Œã€‚ åº”ç”¨ç¨‹åºä¼šè¯å¯†é’¥æ˜¯åº”ç”¨ç¨‹åºå’Œè®¾å¤‡å·²çŸ¥çš„æ¯ä¸ªè®¾å¤‡çš„å”¯ä¸€å¯†é’¥ï¼Œç”¨äºåŠ å¯†æ¥è‡ªè®¾å¤‡çš„æœ‰æ•ˆè´Ÿè½½çš„å¯†é’¥ï¼Œä½¿å¾—ä»»ä½•äººéƒ½å¾ˆéš¾çªƒå¬ä¸åç«¯æœåŠ¡å™¨çš„é€šä¿¡ã€‚è¯¥å¯†é’¥ä¹Ÿç”¨äºè®¡ç®—æ ¡éªŒå’Œã€‚ ABP ä¸ OTAA è®¾å¤‡ LoRaWAN ç½‘ç»œä¸­æœ‰ä¸¤ç§è®¾å¤‡ï¼Œå³â€œABPâ€è®¾å¤‡å’Œâ€œ OTAAâ€è®¾å¤‡ï¼š ABPï¼ˆä¸ªæ€§åŒ–æ¿€æ´»ï¼‰è®¾å¤‡ è¿™ç§è®¾å¤‡å¸¦æœ‰ä¸‰é¡¹ä¿¡æ¯ï¼šç½‘ç»œä¼šè¯å¯†é’¥ï¼Œåº”ç”¨ç¨‹åºä¼šè¯å¯†é’¥å’Œè®¾å¤‡åœ°å€ã€‚ è¿™äº›è®¾å¤‡é€šç”µåå¯ä»¥ç«‹å³å¼€å§‹å‘é€ï¼Œä½†æ˜¯æ¯ä¸ªè®¾å¤‡éƒ½éœ€è¦ä¸€ç»„å”¯ä¸€çš„å¯†é’¥ã€‚å¦‚æœæœ‰äººé—¯å…¥æ‚¨çš„è®¾å¤‡å¹¶æ‹¿åˆ°äº†å¯†é’¥ï¼Œä½ å¯ä»¥è½»æ¾åœ°ä»…å¯¹å—å½±å“çš„ä¸€å°è®¾å¤‡è¿›è¡Œå¸ƒå»ºï¼Œè€Œæ— éœ€æ›´æ”¹å…¶ä»–çš„è®¾å¤‡ã€‚ è¿™ç§è®¾å¤‡ç±»å‹çš„æœ€å¤§ç¼ºç‚¹æ˜¯ï¼Œæ‚¨å¿…é¡»è·Ÿè¸ªåŠ ç”µä¹‹é—´å¾€è¿”äºåç«¯æœåŠ¡å™¨çš„æ¶ˆæ¯çš„å¸§è®¡æ•°å™¨ã€‚é€šå¸¸ï¼Œåç«¯æœåŠ¡å™¨ä¼šå¿½ç•¥å¸§è®¡æ•°å™¨ä¸é¢„æœŸçš„è®¡æ•°å™¨ä¸åŒçš„æ¶ˆæ¯ï¼Œä½†æ˜¯æ‚¨å¯ä»¥åœ¨æµ‹è¯•è®¾å¤‡æ—¶å–æ¶ˆæ­¤æ£€æŸ¥ã€‚æ³¨æ„ï¼šå…³é—­æ­¤æ£€æŸ¥ä¼šä½¿è®¾å¤‡å®¹æ˜“å—åˆ°é‡æ”¾æ”»å‡»ï¼Œå› æ­¤é€šå¸¸ä¿ç•™ç”¨äºæµ‹è¯•ã€‚ OTAAï¼ˆç©ºä¸­æ¿€æ´»ï¼‰è®¾å¤‡ è¿™æ˜¯æœ€å¸¸è§çš„è®¾å¤‡ç±»å‹ã€‚åœ¨é…ç½®å®ƒä»¬æ—¶ï¼Œè¿™äº›è®¾å¤‡ä¸­çš„æ¯ä¸€ä¸ªéƒ½å°†è·å¾—ä¸‰éƒ¨åˆ†ä¿¡æ¯ï¼šåº”ç”¨ç¨‹åºå¯†é’¥ï¼Œåº”ç”¨ç¨‹åºEUIå’Œè®¾å¤‡EUIã€‚æ‰“å¼€è®¾å¤‡ç”µæºåï¼Œå®ƒå°†å¯åŠ¨åŠ å…¥ç½‘ç»œè¿‡ç¨‹ï¼Œåœ¨æ­¤è¿‡ç¨‹ä¸­å®ƒå°†æ ¹æ®ç°æœ‰çš„åº”ç”¨ç¨‹åºå¯†é’¥åå•†ä¸€ç»„æ–°çš„å¯†é’¥ã€‚åå•†å®Œæˆåï¼ˆé€šå¸¸åœ¨ä¸åˆ°äº”ç§’é’Ÿçš„æ—¶é—´å†…ï¼‰ï¼Œå…¶è¡Œä¸ºå°†ç±»ä¼¼äº ABP è®¾å¤‡ã€‚ å¦‚æœå…³é—­è®¾å¤‡ç”µæºï¼Œåˆ™å¯åŠ¨æ—¶å®ƒå¿…é¡»å†æ¬¡åŠ å…¥ç½‘ç»œã€‚è‡ªç„¶ï¼Œå¯¹ OTAA è®¾å¤‡æ¥è¯´æœ€é‡è¦çš„æ˜¯åº”ç”¨ç¨‹åºå¯†é’¥ã€‚å¦‚æœæœ‰äººè®¾æ³•ä»æ‚¨çš„ä¸€å°è®¾å¤‡ä¸ŠæŠ¢èµ°å¯†é’¥ï¼Œåˆ™æ”»å‡»è€…å¯èƒ½ä¼šå‡å†’æ‚¨ç½‘ç»œä¸­çš„ä»»ä½•è®¾å¤‡ã€‚å¦ä¸€æ–¹é¢ï¼Œä½¿ç”¨OTAAè®¾å¤‡å¯ä»¥è½»æ¾ç®¡ç†å¤§é‡è®¾å¤‡ï¼Œå› ä¸ºæ‚¨æ— éœ€ç®¡ç†å¾ˆå¤šå¯†é’¥ã€‚ é€‰æ‹© æ‚¨é€‰æ‹©å“ªç§è®¾å¤‡ç±»å‹å–å†³äºæ‚¨è®¡åˆ’å¦‚ä½•é…ç½®æ–°è®¾å¤‡ã€‚å¼€å¯æ—¶ï¼Œæ— è®ºæ‚¨çš„è®¾å¤‡æ˜¯å¦åœ¨ç½‘å…³èŒƒå›´å†…ï¼ŒABP è®¾å¤‡éƒ½å¯ä»¥ç«‹å³å¼€å§‹å‘é€ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœæ‚¨çš„è®¾å¤‡å¤§å¤šä½äºç½‘å…³çš„èŒƒå›´å†…ï¼Œå¹¶ä¸”ä¼šåœ¨æ²¡æœ‰ä»»ä½•æ¿è½½å­˜å‚¨çš„æƒ…å†µä¸‹é¢‘ç¹ä¸Šä¸‹ç”µï¼Œåˆ™å¯ä»¥ä½¿ç”¨ OTAA è®¾å¤‡ã€‚å¼€å‘æ–°è®¾å¤‡æ—¶ï¼ŒOTAAè®¾å¤‡æœ€ä¸ºæ–¹ä¾¿ã€‚ ä»€ä¹ˆæ˜¯â€œç§äººç½‘ç»œâ€ï¼Ÿ å¦‚æœæ‚¨çœ‹åˆ°é…ç½®æ–‡ä»¶ä¸­æŸå¤„æåˆ°çš„â€œä¸“ç”¨ç½‘ç»œâ€ï¼Œå°±åƒå…¶ä»–è®¸å¤šäººä¸€æ ·â€”â€”ä½ å¯èƒ½æƒ³çŸ¥é“å®ƒçš„çœŸæ­£å«ä¹‰ï¼Œå› ä¸ºå®ƒæ˜¯æ‚¨è®¾ç½®çš„å‚æ•°ï¼Œä½†æ˜¯æ²¡æœ‰å†æ¬¡çœ‹åˆ°ã€‚ LoRaWAN ä¸­çš„ä¸“ç”¨ç½‘ç»œæ˜¯ä¸€ç§è®¾å¤‡ï¼ˆå’Œç½‘å…³ï¼‰ç½‘ç»œï¼Œå®ƒæ¥å—å¸¦æœ‰ä¸“ç”¨å‰å¯¼ç ï¼ˆä½œä¸ºæ¶ˆæ¯çš„ç¬¬ä¸€ä½å‘é€çš„æ ‡è¯†ç¬¦ï¼‰è€Œä¸æ˜¯æ ‡å‡†çš„å‰å¯¼ç çš„æ¶ˆæ¯ã€‚LoRaWAN ä¸­åªæœ‰ä¸¤ç§ç±»å‹çš„å‰å¯¼ç ï¼šæ ‡å‡†çš„ LoRaWAN å…¬å…±å‰å¯¼æˆ–ç§æœ‰å‰å¯¼ã€‚ å¦‚æœå‘é€äº†ç§æœ‰å‰å¯¼ç ï¼Œåˆ™æ•°æ®æ ¼å¼å®Œå…¨å–å†³äºè®¾å¤‡å’Œåç«¯æœåŠ¡å™¨ã€‚å¦‚æœè¦ä¸å…¶ä»–ç½‘ç»œå…¼å®¹ï¼ˆå¹¶ä¸”å…¼å®¹ï¼‰ï¼Œéœ€è¦ä¿æŒç§æœ‰ç½‘ç»œæ ‡å¿—ä¸ºå…³é—­çŠ¶æ€ã€‚ ADR è‡ªé€‚åº”æ•°æ®é€Ÿç‡ ADRï¼ˆè‡ªé€‚åº”æ•°æ®é€Ÿç‡ï¼‰æ˜¯åç«¯æœåŠ¡å™¨å¯ç”¨æ¥è®©è®¾å¤‡ä»¥å°½å¯èƒ½ä½çš„åŠŸç‡ä¼ è¾“çš„æŠ€å·§ã€‚å¦‚æœè®¾å¤‡é è¿‘ç½‘å…³ï¼Œåˆ™è®¾å¤‡å¯ä»¥ä»¥è¾ƒä½çš„åŠŸç‡å’Œè¾ƒé«˜çš„æ•°æ®é€Ÿç‡è¿›è¡Œä¼ è¾“ï¼Œä½¿ç”¨å°½å¯èƒ½å°‘çš„åŠŸç‡ã€‚å¦‚æœä¸¤ä¸ªæˆ–ä¸‰ä¸ªç½‘å…³å¯ä»¥æ¥æ”¶åˆ°è®¾å¤‡çš„æ¶ˆæ¯ï¼Œåˆ™å¯ä»¥è°ƒå›ä¼ è¾“åŠŸç‡å¹¶èŠ‚çœèƒ½æºã€‚ æ¶ˆæ¯ç±»å‹ï¼šç¡®è®¤çš„å’Œä¸ç¡®è®¤çš„æ¶ˆæ¯ LoRaWAN å®šä¹‰äº†ä¸¤ç§æ¶ˆæ¯-ç¡®è®¤çš„å’Œä¸ç¡®è®¤çš„ã€‚ç¡®è®¤çš„æ¶ˆæ¯éœ€è¦åç«¯æœåŠ¡å™¨çš„ç¡®è®¤ï¼Œå¦‚æœæ²¡æœ‰æ”¶åˆ°ç¡®è®¤ï¼Œåˆ™æ¶ˆæ¯å°†ä»¥ä¸åŒçš„æ‰©å±•å› å­å’Œå¸¦å®½é‡æ–°å‘é€ã€‚ åŒæ ·ï¼Œåç«¯æœåŠ¡å™¨å°†é‡æ–°ä¼ è¾“ç¡®è®¤çš„æ¶ˆæ¯ï¼Œç›´åˆ°è®¾å¤‡ç¡®è®¤å“åº”ã€‚ ç”±äº LoRaWAN ä»…ä½¿ç”¨äº†ä¸€ä¸ªç¡®è®¤æ ‡å¿—ï¼Œå› æ­¤æ— æ³•ç¡®è®¤æ—§æ¶ˆæ¯ã€‚ ä¸Šä¸‹æ¸¸æ¶ˆæ¯ è¿Ÿæ—©æœ‰äººä¼šæåˆ°â€œä¸Šæ¸¸â€å’Œâ€œä¸‹æ¸¸â€ã€‚å¦‚æœæ‚¨åœ¨è®¾å¤‡ä¸Šå·¥ä½œï¼Œåˆ™æ— æ³•å®Œå…¨ç›´è§‚åœ°äº†è§£æ˜¯å“ªä¸ªæ–¹å‘ï¼Œä½†æ˜¯è¯·è®°ä½ä¸Šæ¸¸æ–¹å‘æœç€ç½‘å…³å¤©çº¿å»çš„æ–¹å‘ï¼Œä¸‹æ¸¸æ–¹å‘æ˜¯ä»ç½‘å…³å¤©çº¿å‡ºå‘çš„æ–¹å‘ã€‚ä½†å¦‚æœå°†è®¾å¤‡æ”¾åœ¨æ°”è±¡æ°”çƒä¸­ï¼Œåˆ™ä¼šè¿™ä¸ªè§„åˆ™ä¸å†é€‚ç”¨ã€‚ æˆ‘è®©æˆ‘çš„è®¾å¤‡å‘é€æ¶ˆæ¯æ—¶ï¼Œå®ƒæ²¡æœ‰å‘é€ï¼ å¦‚æœæ‚¨åœ¨è®¾å¤‡ä¸Šå®‰æ’ä¸€æ¡æ¶ˆæ¯ï¼Œæœ‰æ—¶æ‚¨ä¼šæ„Ÿåˆ°è¯¥æ¶ˆæ¯ä¼šåœ¨è®¾å¤‡ä¸Šä¿ç•™å¾ˆé•¿ä¸€æ®µæ—¶é—´ï¼Œç›´åˆ°å‘é€å‡ºå»ä¸ºæ­¢ï¼Œå…¶ä»–æƒ…å†µä¸‹ï¼Œæ¶ˆæ¯ä¼šç«‹å³å‘é€å‡ºå»ã€‚ è¿™æ˜¯å› ä¸º LoRaWAN è®¾å¤‡å¿…é¡»å§‹ç»ˆéµå®ˆçš„ ISM é¢‘æ®µä¸Šçš„å ç©ºæ¯”é™åˆ¶ï¼ˆå³å‘é€å’Œä¸å‘é€æ‰€èŠ±è´¹çš„æ—¶é—´çš„æ¯”ç‡ï¼‰ã€‚å¯¹äºæŸäº›é¢‘ç‡ï¼Œæœ€å¤§å ç©ºæ¯”ä¸º1ï¼…ï¼Œè€Œå¯¹äºå…¶ä»–é¢‘ç‡ï¼Œæœ€å¤§å ç©ºæ¯”ä»…ä¸º0.1ï¼…ã€‚å¦‚æœæ‚¨èŠ±è´¹ä¸€ç§’é’Ÿå‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œåˆ™å¿…é¡»ç­‰å¾…99ç§’ï¼Œç„¶åæ‰èƒ½åœ¨å ç©ºæ¯”ä¸º1ï¼…æ—¶å‘é€å¦ä¸€æ¡æ¶ˆæ¯ï¼Œè€Œå¦‚æœå ç©ºæ¯”ä¸º0.1ï¼…ï¼Œåˆ™å¯èƒ½å¿…é¡»ç­‰å¾…15åˆ†é’Ÿä»¥ä¸Šã€‚","categories":[{"name":"LoRa","slug":"LoRa","permalink":"https://blog.inoki.cc/categories/LoRa/"}],"tags":[{"name":"ç¿»è¯‘","slug":"ç¿»è¯‘","permalink":"https://blog.inoki.cc/tags/ç¿»è¯‘/"},{"name":"ä¸­æ–‡","slug":"ä¸­æ–‡","permalink":"https://blog.inoki.cc/tags/ä¸­æ–‡/"},{"name":"LoRaWAN","slug":"LoRaWAN","permalink":"https://blog.inoki.cc/tags/LoRaWAN/"},{"name":"LoRa","slug":"LoRa","permalink":"https://blog.inoki.cc/tags/LoRa/"},{"name":"IoT","slug":"IoT","permalink":"https://blog.inoki.cc/tags/IoT/"}]},{"title":"Enable UART to play with Raspberry Pi Bare Metal","slug":"Enable-UART-Raspberry-Pi-Bare-Metal","date":"2020-05-17T23:57:50.000Z","updated":"2025-03-08T09:40:48.562Z","comments":true,"path":"2020/05/17/Enable-UART-Raspberry-Pi-Bare-Metal/","link":"","permalink":"https://blog.inoki.cc/2020/05/17/Enable-UART-Raspberry-Pi-Bare-Metal/","excerpt":"","text":"If you want to write an OS for Raspberry Pi, you may need play with its Bare Metal mode. Thus, a UART debug serial is needed. Considering that the bootloader of Raspberry Pi is proprietary, and itâ€™s provided as a binary file in the /boot partition, we cannot modify the boot sequence, and we cannot see the output of the binary executable. Through the UART serial, the only thing that we can see is the successful boot after the loading of Raspian kernel: But, as we are on Bare Metal mode, if anything goes wrong during booting your own â€œkernelâ€, itâ€™s not easy to find out the reason. This post will help you enable the UART debug mode to see whatâ€™s happening behind the proprietary code before loading your own kernel. Bootloader file bootcode.bin Mount the /boot partition on the SD card, you can see lots of files. Some of them are device tree files; some of them are configuration files. The one we concentrate on, is bootcode.bin, the proprietary executable from Raspberry Pi. Itâ€™s a binary file, so itâ€™s not readable for human-being. But there are some static strings in the binary file, which might be meaningful to us. For us, the most important string is BOOT_UART. To enable the debug output of the binary executable, just modify its value from 0 to 1: Save and boot Save that modification and insert the SD card into your Raspberry Pi. Then boot it, you will see the magic output: I hope this post can help you, and enjoy your Raspberry Pi Bare Metal development!","categories":[{"name":"Embedded System","slug":"Embedded-System","permalink":"https://blog.inoki.cc/categories/Embedded-System/"},{"name":"Raspberry Pi","slug":"Embedded-System/Raspberry-Pi","permalink":"https://blog.inoki.cc/categories/Embedded-System/Raspberry-Pi/"}],"tags":[{"name":"Embedded System","slug":"Embedded-System","permalink":"https://blog.inoki.cc/tags/Embedded-System/"},{"name":"Bare Metal","slug":"Bare-Metal","permalink":"https://blog.inoki.cc/tags/Bare-Metal/"},{"name":"Raspberry Pi","slug":"Raspberry-Pi","permalink":"https://blog.inoki.cc/tags/Raspberry-Pi/"},{"name":"Debug","slug":"Debug","permalink":"https://blog.inoki.cc/tags/Debug/"},{"name":"UART","slug":"UART","permalink":"https://blog.inoki.cc/tags/UART/"}]},{"title":"ã€è¯‘ã€‘æ‰©é¢‘å› å­å¦‚ä½•å½±å“ LoRaWAN è®¾å¤‡çš„ç”µæ± å¯¿å‘½","slug":"LoRaWAN-how-spreading-factor-affects-lorawan-device-battery-life","date":"2020-05-16T22:27:00.000Z","updated":"2025-03-08T09:40:48.583Z","comments":true,"path":"2020/05/16/LoRaWAN-how-spreading-factor-affects-lorawan-device-battery-life/","link":"","permalink":"https://blog.inoki.cc/2020/05/16/LoRaWAN-how-spreading-factor-affects-lorawan-device-battery-life/","excerpt":"","text":"åŸæ–‡é“¾æ¥ï¼šhttps://www.thethingsnetwork.org/article/how-spreading-factor-affects-lorawan-device-battery-life åœ¨ LoRaWAN ä¸­ï¼Œæ‰©é¢‘å› å­æ˜¯ä¸€ä¸ªå…³é”®æŒ‡æ ‡ï¼Œå®ƒæ—¢å¯ä»¥å¸®åŠ©ä½ å®Œæˆä½ çš„ IoT è§£å†³æ–¹æ¡ˆï¼Œä¹Ÿå¯ä»¥æ¯æ‰å®ƒï¼Œæ‰€è°“ â€œæˆä¹ŸSFï¼Œè´¥ä¹ŸSFâ€ã€‚æ‰¾åˆ°æ­£ç¡®çš„æ‰©é¢‘å› å­å¯¹å®ç° LoRaWAN è®¾å¤‡é•¿æœŸæ€§èƒ½è‡³å…³é‡è¦ã€‚è¿™ç¯‡æ–‡ç« ä¼šè§£é‡Šå¦‚ä½•æ‰¾åˆ°ç”µæ± å¯¿å‘½å’Œé•¿è·ç¦»é€šä¿¡ä¹‹é—´çš„æ­£ç¡®å¹³è¡¡ã€‚ æ‰©é¢‘å› å­ï¼ˆSFï¼‰å†³å®šæ¯ç§’å‘é€å¤šå°‘ä¸ªçº¿æ€§è°ƒé¢‘è„‰å†²ï¼Œå³æ•°æ®çš„è½½ä½“ã€‚ç½‘ç»œæ ¹æ®é€šä¿¡è®¾å¤‡å’Œç½‘å…³ä¹‹é—´çš„ç¯å¢ƒæ¡ä»¶æ¥å†³å®šæ‰©å±•å› å­ï¼ˆç­‰çº§åœ¨7-12ä¹‹é—´ï¼‰ã€‚æˆ‘ä»¬å‡å®šè®¾å¤‡å·²å¯ç”¨ â€œè‡ªé€‚åº”æ•°æ®é€Ÿç‡ï¼ˆADRï¼‰â€ åŠŸèƒ½ï¼Œé™¤æŒç»­ç§»åŠ¨çš„è®¾å¤‡å¤–ï¼Œè¿™ä¸ªåŠŸèƒ½åº”å½“åº”ç”¨äºæ‰€æœ‰è®¾å¤‡ã€‚ è¾ƒä½çš„ SF æ„å‘³ç€æ¯ç§’å‘é€æ›´å¤šçš„ Chirpsï¼›å› æ­¤ï¼Œæ‚¨å¯ä»¥æ¯ç§’ç¼–ç æ›´å¤šæ•°æ®ã€‚è¾ƒé«˜çš„ SF æ„å‘³ç€æ¯ç§’æ›´å°‘çš„ Chirpsï¼›å› æ­¤ï¼Œæ¯ç§’èƒ½ç¼–ç çš„æ•°æ®è¾ƒå°‘ã€‚ç”±äºæ•°æ®é€Ÿç‡ä½ï¼Œå‘é€å…·æœ‰è¾ƒé«˜ SF çš„ç›¸åŒæ•°é‡çš„æ•°æ®éœ€è¦æ›´é•¿çš„ä¼ è¾“æ—¶é—´ï¼Œå³ç©ºä¸­æ—¶é—´ã€‚æ›´é•¿çš„é€šè¯æ—¶é—´æ„å‘³ç€è°ƒåˆ¶è§£è°ƒå™¨çš„å¯åŠ¨å’Œè¿è¡Œæ—¶é—´æ›´é•¿ï¼Œå¹¶ä¸”æ¶ˆè€—æ›´å¤šçš„èƒ½é‡ã€‚ é«˜ SF çš„å¥½å¤„åœ¨äºï¼Œæ›´é•¿çš„é€šè¯æ—¶é—´ä½¿æ¥æ”¶æœºæœ‰æ›´å¤šæœºä¼šå¯¹ä¿¡å·åŠŸç‡è¿›è¡Œé‡‡æ ·ï¼Œä»è€Œæé«˜äº†çµæ•åº¦ã€‚æ›´é«˜çš„çµæ•åº¦æ„å‘³ç€æ‚¨å¯ä»¥åœ¨æ›´è¿œçš„åœ°æ–¹æ¥æ”¶ä¿¡å·ï¼Œä»è€Œè·å¾—æ›´å¥½çš„è¦†ç›–èŒƒå›´ã€‚ä»ç†è®ºä¸Šè®²ï¼ŒSFä¸­çš„æ¯ä¸€æ­¥éƒ½å°†ä¼ è¾“ç›¸åŒæ•°é‡çš„æ•°æ®çš„æ—¶é—´åŠ å€ï¼Œè¯·å‚è§ä¸‹å›¾ã€‚SF çš„æ¯ä¸€ä¸ªæ­¥é•¿éƒ½ä¸å¤§çº¦ 2.5dB çš„é¢å¤–é“¾è·¯é¢„ç®—ç›¸å…³ã€‚ ç†è®ºéƒ½å¾ˆç¾å¥½ï¼Œä½†å®è·µä¸­ç©ºä¸­ä¼ è¾“æ—¶é—´å’Œç”µæ± å¯¿å‘½å¦‚ä½•å‘¢ï¼Ÿ ä¸ºäº†å¯¹æ­¤è·å¾—ä¸€ä¸ªä¼°è®¡ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸¤ä¸ªå·¥å…·ï¼š LoRaTools ä¸­çš„ç©ºä¸­ä¼ è¾“æ—¶é—´è®¡ç®—å™¨ ç”¨ Otii æµ‹è¯• SF7 å’Œ SF12 çš„èƒ½é‡æ¶ˆè€—æ›²çº¿ åœ¨æ­¤æµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬æµ‹é‡äº† Bintel çš„ä¸€ä¸ª LoRaWAN è®¾å¤‡ï¼Œè¯¥è®¾å¤‡ä½¿ç”¨ Semtech çš„ SX1276 èŠ¯ç‰‡ç»„ã€‚æˆ‘ä»¬çš„è®¾ç½®æ˜¯å®¤å†…å®¤å¤–åœºæ™¯ï¼šè®¾å¤‡æ˜¯åœ¨åŠå…¬å®¤ï¼Œåœ¨å¼€å‘äººå‘˜çš„æ¡Œå­ä¸Šï¼Œå¹¶ä¸”ç½‘å…³ä½äºé™„è¿‘ä¸€æ ‹å»ºç­‘ç‰©çš„å¤–é¢ã€‚å› æ­¤ï¼Œè¿™ä¸æ˜¯è¯¥è®¾å¤‡çš„æ­£å¸¸ä½¿ç”¨åœºæ™¯ï¼Œä»–çš„æ­£å¸¸ä½¿ç”¨åœºæ™¯æ˜¯æˆ·å¤–çš„åƒåœ¾ç®±ã€‚æˆ‘ä»¬ä½¿ç”¨ 19 å­—èŠ‚çš„æœ‰æ•ˆè´Ÿè½½å’Œ 125kHz çš„å¸¦å®½æµ‹é‡äº†ç¬¬ä¸€æ¬¡ä¼ è¾“å’Œæ•´ä¸ªæ´»åŠ¨å‘¨æœŸçš„èƒ½è€—ã€‚ æµ‹é‡ä¸­ï¼Œæ´»åŠ¨å‘¨æœŸåŒ…å«äº†å¯¹ä¸€ä¸ªéœ€è¦ç¡®è®¤çš„æ¶ˆæ¯çš„ä¼ è¾“å’Œä¸€ä¸ªå¯¹ ACK çš„ç›‘å¬å‘¨æœŸã€‚ æµ‹é‡æ˜¾ç¤ºï¼Œä¸ SF7 ç›¸æ¯”ï¼Œåœ¨ SF12 ä¸­ä¼ è¾“å¤§çº¦éœ€è¦25å€çš„æ—¶é—´å’Œ25å€çš„èƒ½é‡ã€‚ç©ºä¸­æ—¶é—´è®¡ç®—å™¨æ˜¾ç¤ºäº†ç›¸åŒçš„ç»“æœã€‚ ä½†æ˜¯ï¼Œæ•°å­— 25 å¹¶éä¸€æˆä¸å˜ã€‚å®ƒå–å†³äºæœ‰æ•ˆè´Ÿè½½å¤§å°å’Œåˆ†é…ç”¨äºä¼ è¾“çš„æŠ¥å¤´ã€‚å¦‚æœæ‚¨ä½¿ç”¨ä¸åŒå¤§å°çš„æœ‰æ•ˆè½½è·ï¼Œåˆ™å¯ä»¥çœ‹åˆ°ä¸åŒçš„å€æ•°ã€‚ è¯·æ³¨æ„ï¼Œä»¥ä¸Šè®¡ç®—ä»…ä»…å¯¹äºå‘é€æ—¶é—´ï¼Œå¹¶ä¸æ˜¯æ•´ä¸ªæ´»åŠ¨å‘¨æœŸã€‚åœ¨æ­¤ç‰¹å®šæµ‹é‡ä¸­ï¼ŒSF12ä¸­æ¯ä¸ªæ´»åŠ¨å‘¨æœŸçš„èƒ½é‡æ¶ˆè€—æ¯”æ˜¯SF7èƒ½é‡çš„20å€ï¼ˆèƒ½é‡ç»Ÿè®¡æ˜¾ç¤º 55.1 uWh å¯¹ 2.78 uWhï¼Œè§ä¸‹å›¾ï¼‰ã€‚ å€¼å¾—ä¸€æçš„æ˜¯ï¼Œæ´»åŠ¨å‘¨æœŸçš„èƒ½è€—å–å†³äºè®¾å¤‡çš„ç±»åˆ«ã€‚å¦‚æœæ˜¯ A ç±»è®¾å¤‡ï¼Œåˆ™åªæœ‰ä¸¤ä¸ªæ¥æ”¶çª—å£ï¼Œè¿™æ„å‘³ç€æ¥æ”¶å™¨çš„å”¤é†’æ—¶é—´ä¸ä¼šè¶…è¿‡è¿™ä¸¤ä¸ªçª—å£ã€‚å¦ä¸€ç§é…ç½®ï¼ˆCç±»ï¼‰å¯ä»¥æ˜¯è®¾å¤‡ä¿æŒè¿ç»­æ”¶å¬ï¼Œè¿™ä¼šå¤§å¤§å¢åŠ èƒ½è€—ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒSF æ•°æ— å…³ç´§è¦ã€‚ ç”±äºæ¯ç§åº”ç”¨éƒ½æ˜¯ç‹¬ç‰¹çš„ï¼Œå¾ˆéš¾å¾—å‡ºæ›´å¤šçš„ç»“è®ºã€‚ä½†æ˜¯æˆ‘ä»¬è¦å¼ºè°ƒçš„æ˜¯ï¼Œä½¿èƒ½è€—æœ€ä½çš„æœ€ä½³æ‰©å±•å› å­ä¸ä¸€å®šæ˜¯æœ€é«˜æˆ–æœ€ä½çš„ï¼Œè€Œæ˜¯å¾ˆå¯èƒ½ä»‹äºä¸¤è€…ä¹‹é—´ï¼šç”±äºéœ€è¦ç¡®è®¤æ¶ˆæ¯ï¼Œå¦‚æœé‡ä¼ æ¬¡æ•°è¿‡å¤šï¼Œåˆ™çŸ­æ—¶ä¼ è¾“çš„èŠ‚èƒ½å°†å› é‡ä¼ è€Œè¿…é€Ÿä¸¢å¤±ã€‚è¦è®°ä½çš„é‡è¦ä¸€ç‚¹æ˜¯ï¼Œæ€»èƒ½è€—æ°¸è¿œä¸ä¼šä»…é€šè¿‡ä¸€ä¸ªå‚æ•°è¿›è¡Œä¼˜åŒ–ã€‚ æ‚¨å¯ä»¥ä¸‹è½½ä¸‹é¢çš„ .otii æ–‡ä»¶æ¥æ£€æŸ¥ä¸åŒ SF è®¾ç½®æ—¶çš„èƒ½è€—æµ‹é‡ï¼š éœ€è¦ç”¨ Otii åº”ç”¨ç¨‹åº æ‰“å¼€ï¼š https://github.com/qoitech/otii-example-projects/blob/master/LoRa-SF7-vs-SF12.otii æ›´å¤šæœ‰å…³ LoRa, LoRaWAN çš„ä¿¡æ¯å¯ä»¥åœ¨ä¸‹åˆ—é“¾æ¥æ‰¾åˆ°ï¼š LoRa CHIRP LoRa crash course Decoding the LoRa PHY","categories":[{"name":"LoRa","slug":"LoRa","permalink":"https://blog.inoki.cc/categories/LoRa/"}],"tags":[{"name":"ç¿»è¯‘","slug":"ç¿»è¯‘","permalink":"https://blog.inoki.cc/tags/ç¿»è¯‘/"},{"name":"ä¸­æ–‡","slug":"ä¸­æ–‡","permalink":"https://blog.inoki.cc/tags/ä¸­æ–‡/"},{"name":"LoRaWAN","slug":"LoRaWAN","permalink":"https://blog.inoki.cc/tags/LoRaWAN/"},{"name":"LoRa","slug":"LoRa","permalink":"https://blog.inoki.cc/tags/LoRa/"},{"name":"IoT","slug":"IoT","permalink":"https://blog.inoki.cc/tags/IoT/"}]},{"title":"LoRaWAN specification 1.1 - Glossary","slug":"LoRaWAN-spec-read-gloassary","date":"2020-05-16T10:27:00.000Z","updated":"2025-03-08T09:40:48.585Z","comments":true,"path":"2020/05/16/LoRaWAN-spec-read-gloassary/","link":"","permalink":"https://blog.inoki.cc/2020/05/16/LoRaWAN-spec-read-gloassary/","excerpt":"","text":"Abbreviation Full text ä¸­æ–‡ ADR Adaptive Data Rate è‡ªé€‚åº”æ•°æ®é€Ÿç‡ AES Advanced Encryption Standard é«˜çº§åŠ å¯†æ ‡å‡† AFA Adaptive Frequency Agility è‡ªé€‚åº”é¢‘ç‡æ·å˜ AR Acknowledgement Request ç¡®è®¤è¯·æ±‚ CBC Cipher Block Chaining å¯†ç å—é“¾æ¥ CMAC Cipher-based Message Authentication Code åŸºäºå¯†ç çš„æ¶ˆæ¯è®¤è¯ä»£ç  CR Coding Rate ç¼–ç ç‡ CRC Cyclic Redundancy Check å¾ªç¯å†—ä½™æ ¡éªŒ DR Data Rate æ•°æ®é€Ÿç‡ ECB Electronic Code Book ç”µå­å¯†ç æœ¬ ETSI European Telecommunications Standards Institute æ¬§æ´²ç”µä¿¡æ ‡å‡†åä¼š EIRP Equivalent Isotropically Radiated Power ç­‰æ•ˆå„å‘åŒæ€§è¾å°„åŠŸç‡ FSK Frequency Shift Keying modulation technique é¢‘ç§»é”®æ§è°ƒåˆ¶æŠ€æœ¯ GPRS General Packet Radio Service é€šç”¨åˆ†ç»„æ— çº¿ä¸šåŠ¡ HAL Hardware Abstraction Layer ç¡¬ä»¶æŠ½è±¡å±‚ IP Internet Protocol äº’è”ç½‘åè®® LBT Listen Before Talk / Listen Before Transmit å…ˆå¬åå‘ LoRaTM Long Range modulation technique é•¿ç¨‹è°ƒåˆ¶æŠ€æœ¯ LoRaWANTM Long Range Network protocol é•¿ç¨‹ç½‘ç»œåè®® MAC Medium Access Control ä»‹è´¨è®¿é—®æ§åˆ¶ MIC Message Integrity Code æ¶ˆæ¯å®Œæ•´æ€§ç  RF Radio Frequency æ— çº¿ç”µé¢‘ç‡ RFU Reserved for Future Usage ä¿ç•™ä»¥å¤‡å°†æ¥ä½¿ç”¨ Rx Receiver æ¥å—ç«¯ RSSI Received Signal Strength Indicator æ¥æ”¶ä¿¡å·å¼ºåº¦æŒ‡ç¤ºå™¨ SF Spreading Factor æ‰©é¢‘å› å­ SNR Signal Noise Ratio ä¿¡å™ªæ¯” SPI Serial Peripheral Interface ä¸²è¡Œå¤–è®¾æ¥å£ SSL Secure Socket Layer å®‰å…¨å¥—ç»“å±‚ Tx Transmitter å‘é€ç«¯ USB Universal Serial Bus é€šç”¨ä¸²è¡Œæ€»çº¿ Extra è¡¥å……å†…å®¹ Block cipher mode of operation åˆ†ç»„å¯†ç å·¥ä½œæ¨¡å¼ In cryptography, a block cipher mode of operation is an algorithm that uses a block cipher to provide information security such as confidentiality or authenticity. Mode Formulas Ciphertext Electronic codebook (ECB) Yi = F(PlainTexti, Key) Yi Cipher block chaining (CBC) Yi = PlainTexti XOR Ciphertextiâˆ’1 F(Y, Key); Propagating CBC (PCBC) Yi = PlainTexti XOR (Ciphertextiâˆ’1 XOR PlainTextiâˆ’1) F(Y, Key); Ciphertext0 = IV Cipher feedback (CFB) Yi = Ciphertextiâˆ’1 Plaintext XOR F(Y, Key); Ciphertext0 = IV Output feedback (OFB) Yi = F(Yiâˆ’1, Key); Y0 = IV Plaintext XOR Yi Counter (CTR) Yi = F(IV + g(i), Key); IV = token() Plaintext XOR Yi ECB The simplest of the encryption modes is the electronic codebook (ECB) mode (named after conventional physical codebooks). The message is divided into blocks, and each block is encrypted separately. æœ€ç®€å•çš„åŠ å¯†æ¨¡å¼å³ä¸ºç”µå­å¯†ç æœ¬ï¼ˆElectronic codebookï¼ŒECBï¼‰æ¨¡å¼ã€‚éœ€è¦åŠ å¯†çš„æ¶ˆæ¯æŒ‰ç…§å—å¯†ç çš„å—å¤§å°è¢«åˆ†ä¸ºæ•°ä¸ªå—ï¼Œå¹¶å¯¹æ¯ä¸ªå—è¿›è¡Œç‹¬ç«‹åŠ å¯†ã€‚ CBC Ehrsam, Meyer, Smith and Tuchman invented the cipher block chaining (CBC) mode of operation in 1976. In CBC mode, each block of plaintext is XORed with the previous ciphertext block before being encrypted. This way, each ciphertext block depends on all plaintext blocks processed up to that point. To make each message unique, an initialization vector must be used in the first block. 1976å¹´ï¼ŒIBMå‘æ˜äº†å¯†ç åˆ†ç»„é“¾æ¥ï¼ˆCBCï¼ŒCipher-block chainingï¼‰æ¨¡å¼ã€‚åœ¨CBCæ¨¡å¼ä¸­ï¼Œæ¯ä¸ªæ˜æ–‡å—å…ˆä¸å‰ä¸€ä¸ªå¯†æ–‡å—è¿›è¡Œå¼‚æˆ–åï¼Œå†è¿›è¡ŒåŠ å¯†ã€‚åœ¨è¿™ç§æ–¹æ³•ä¸­ï¼Œæ¯ä¸ªå¯†æ–‡å—éƒ½ä¾èµ–äºå®ƒå‰é¢çš„æ‰€æœ‰æ˜æ–‡å—ã€‚åŒæ—¶ï¼Œä¸ºäº†ä¿è¯æ¯æ¡æ¶ˆæ¯çš„å”¯ä¸€æ€§ï¼Œåœ¨ç¬¬ä¸€ä¸ªå—ä¸­éœ€è¦ä½¿ç”¨åˆå§‹åŒ–å‘é‡ã€‚ Others å…¶ä»–åŠ å¯†æ–¹å¼ Propagating cipher block chaining (PCBC) Cipher feedback (CFB) Output feedback (OFB) Counter (CTR) Listen Before Talk/Transmit å…ˆå¬åå‘ Listen Before Talk (LBT) or sometimes called Listen Before Transmit is a technique used in radio-communications whereby a radio transmitters first sense its radio environment before it starts a transmission. LBT can be used by a radio device to find a network the device is allowed to operate on or to find a free radio channel to operate on. Difficulty in the latter situation is the signal threshold down to which the device has to listen. â€œå…ˆå¬åè¯´â€ï¼ˆLBTï¼‰æˆ–æœ‰æ—¶ç§°ä¸ºâ€œå…ˆå¬åå‘â€æ˜¯æ— çº¿ç”µé€šä¿¡ä¸­ä½¿ç”¨çš„ä¸€ç§æŠ€æœ¯ï¼Œé€šè¿‡è¯¥æŠ€æœ¯ï¼Œæ— çº¿ç”µå‘å°„æœºåœ¨å¼€å§‹ä¼ è¾“ä¹‹å‰é¦–å…ˆä¼šæ„ŸçŸ¥å…¶æ— çº¿ç”µç¯å¢ƒã€‚ æ— çº¿ç”µè®¾å¤‡å¯ä»¥ä½¿ç”¨ LBT å®Œæˆï¼š æŸ¥æ‰¾å…è®¸è¯¥è®¾å¤‡è¿è¡Œçš„ç½‘ç»œ æˆ–è€…æ‰¾åˆ°è¦è¿è¡Œçš„ç©ºé—²æ— çº¿ç”µä¿¡é“ã€‚ åä¸€ç§æƒ…å†µçš„å›°éš¾åœ¨äºè®¾å¤‡å¿…é¡»ç›‘å¬ä¿¡å·é˜ˆå€¼ã€‚ LoRa Modulation Spreading Factor æ‰©é¢‘å› å­ LoRa æ‰©é¢‘è°ƒåˆ¶æŠ€æœ¯é‡‡ç”¨å¤šä¸ªä¿¡æ¯ç ç‰‡æ¥ä»£è¡¨æœ‰æ•ˆè´Ÿè½½ä¿¡æ¯çš„æ¯ä¸ªä½ã€‚æ‰©é¢‘ä¿¡æ¯çš„å‘é€é€Ÿåº¦ç§°ä¸ºç¬¦å·é€Ÿç‡(Rs)ï¼Œè€Œç ç‰‡é€Ÿç‡ä¸æ ‡ç§°ç¬¦å·é€Ÿç‡ä¹‹é—´çš„æ¯”å€¼å³ä¸ºæ‰©é¢‘å› å­ï¼Œå…¶è¡¨ç¤ºæ¯ä¸ªä¿¡æ¯ä½å‘é€çš„ç¬¦å·æ•°é‡ã€‚LoRaTM è°ƒåˆ¶è§£è°ƒå™¨ä¸­æ‰©é¢‘å› å­çš„å–å€¼èŒƒå›´è§ä¸‹è¡¨ã€‚æ‰©é¢‘å› å­ä¸º6æ—¶ï¼ŒLoRa çš„æ•°æ®ä¼ è¾“é€Ÿç‡æœ€å¿«ã€‚ æ³¨æ„ï¼šå› ä¸ºä¸åŒçš„SFä¹‹é—´ä¸ºæ­£äº¤å…³ç³»ï¼Œå› æ­¤å¿…é¡»æå‰è·çŸ¥é“¾è·¯å‘é€ç«¯å’Œæ¥æ”¶ç«¯çš„SFã€‚å¦å¤–ï¼Œè¿˜å¿…é¡»è·çŸ¥æ¥å—æœºè¾“å…¥ç«¯çš„ä¿¡å™ªæ¯”ã€‚ã€‚åœ¨è´Ÿä¿¡å™ªæ¯”æ¡ä»¶ä¸‹ä¿¡å·ä¹Ÿèƒ½æ­£å¸¸æ¥æ”¶ï¼Œè¿™æ”¹å–„äº†LoRaæ¥å—æœºçš„çµæ•åº¦ï¼Œé“¾è·¯é¢„ç®—åŠè¦†ç›–èŒƒå›´ã€‚ æ‰©é¢‘è°ƒåˆ¶å¸¦å®½(BW) å¢åŠ å¸¦å®½ï¼Œå¯ä»¥æé«˜æœ‰æ•ˆæ•°æ®é€Ÿç‡ä»¥ç¼©çŸ­ä¼ è¾“æ—¶é—´ï¼Œä½†æ˜¯ä¼šç‰ºç‰²æ¥æ”¶çµæ•åº¦ã€‚ LoRaç¬¦å·é€Ÿç‡Rså¯ä»¥é€šè¿‡ä»¥ä¸‹å…¬å¼è®¡ç®—ï¼š Rs=BW2sRs= \\frac{BW}{2^s} Rs=2sBWâ€‹ æ¯Hzæ¯ç§’å‘é€ä¸€ä¸ªç ç‰‡ã€‚ LoRa æ•°æ®é€Ÿç‡ DR å¯ä»¥é€šè¿‡ä»¥ä¸‹å…¬å¼è®¡ç®—ï¼š DR=SFâˆ—BW2sâˆ—CRDR = SF* \\frac{BW}{2^s} * CR DR=SFâˆ—2sBWâ€‹âˆ—CR LoRa æ‰©é¢‘æŠ€æœ¯ä¸€ç»æ¨å‡ºï¼Œå°±å‡­å€Ÿå®ƒæƒŠäººçš„çµæ•åº¦(-148dbm)ã€å¼ºæ‚çš„æŠ—å¹²æ‰°èƒ½åŠ›ã€å‡ºè‰²çš„ç³»ç»Ÿå®¹é‡è¡¨ç°ï¼Œèµ¢å¾—äº†å¹¿æ³›çš„å…³æ³¨ã€‚è¯´é€šä¿—ç‚¹ï¼ŒLoRaæ‰©é¢‘æŠ€æœ¯æ”¹å˜äº†ä¼ è¾“åŠŸè€—å’Œä¼ è¾“è·ç¦»ä¹‹é—´çš„å¹³è¡¡ï¼Œå½»åº•æ”¹å˜äº†åµŒå…¥å¼æ— çº¿é€šä¿¡é¢†åŸŸçš„å±€é¢ã€‚å®ƒç»™äººä»¬å‘ˆç°äº†ä¸€ä¸ªèƒ½å®ç°è¿œè·ç¦»ã€é•¿ç”µæ± å¯¿å‘½ã€å¤§ç³»ç»Ÿå®¹é‡ã€ä½ç¡¬ä»¶æˆæœ¬çš„å…¨æ–°é€šä¿¡æŠ€æœ¯ï¼Œè€Œè¿™æ­£æ˜¯ç‰©è”ç½‘(IoT)æ‰€éœ€è¦çš„ã€‚ LoRaæ‰©é¢‘åŸç† å¸¸è§„çš„æ•°å­—æ•°æ®é€šä¿¡åŸç†æ˜¯ä½¿ç”¨ä¸æ•°æ®é€Ÿç‡ç›¸é€‚åº”çš„å°½å¯èƒ½å°çš„å¸¦å®½ã€‚è¿™æ˜¯å› ä¸ºå¸¦å®½æ•°æ˜¯æœ‰é™çš„ï¼Œè€Œä¸”æœ‰å¾ˆå¤šçš„ç”¨æˆ·è¦åˆ†äº«ã€‚ æ‰©é¢‘é€šä¿¡çš„åŸç†æ˜¯å°½å¯èƒ½ä½¿ç”¨æœ€å¤§å¸¦å®½æ•°, åŒæ ·çš„èƒ½é‡åœ¨ä¸€ä¸ªå¤§çš„å¸¦å®½ä¸Šä¼ æ’­ã€‚è¿™é‡Œæ‰©é¢‘å¸¦å®½çš„å¾ˆå°éƒ¨åˆ†ä¸å¸¸è§„æ— çº¿ä¿¡å·ç›¸å¹²æ‰°ï¼Œ ä½†å¸¸è§„æ— çº¿ä¿¡å·ä¸å½±å“æ‰©é¢‘ä¿¡å·ï¼Œè¿™æ˜¯å› ä¸ºä¸¤è€…ç›¸æ¯”å¸¸è§„ä¿¡å·å¸¦å®½å¾ˆçª„ã€‚ ä¸ºä½•ä½¿ç”¨æ‰©é¢‘æŠ€æœ¯: æ‰©å¤§å¸¦å®½ã€å‡å°‘å¹²æ‰°ã€‚å½“æ‰©é¢‘å› å­ä¸º1æ—¶ï¼Œæ•°æ®1å°±ç”¨â€œ1â€æ¥è¡¨ç¤ºï¼Œæ‰©é¢‘å› å­ä¸º4æ—¶ï¼Œå¯èƒ½ç”¨â€œ1011â€æ¥è¡¨ç¤º1ï¼Œè¿™æ ·ä¼ è¾“çš„æ—¶å€™å¯ä»¥é™ä½è¯¯ç ç‡ä¹Ÿå°±æ˜¯ä¿¡å™ªæ¯”ï¼Œä½†æ˜¯å´å‡å°‘äº†å¯ä»¥ä¼ è¾“çš„å®é™…æ•°æ®ï¼Œæ‰€ä»¥ï¼Œæ‰©é¢‘å› å­è¶Šå¤§ï¼Œä¼ è¾“çš„æ•°æ®æ•°ç‡å°±è¶Šå°ã€‚ æ ¹æ®å¯¹é€Ÿç‡çš„ä¸åŒè¦æ±‚åˆ†é…ä¸åŒæ•°é‡çš„ç é“ï¼Œæé«˜åˆ©ç”¨ç‡ã€‚æ‰©é¢‘å› å­è¿˜æœ‰å¦ä¸€ä¸ªç”¨é€”ï¼Œé‚£å°±æ˜¯æ­£äº¤ç (OVSF: Orthogonal Variable Spreading Factor ï¼Œæ­£äº¤å¯å˜æ‰©é¢‘å› å­)ï¼Œé€šè¿‡OVSFå¯ä»¥è·å¾—æ­£äº¤çš„æ‰©é¢‘ç ï¼Œæ‰©é¢‘å› å­ä¸º4æ—¶æœ‰4ä¸ªæ­£äº¤çš„æ‰©é¢‘ç ï¼Œæ­£äº¤çš„æ‰©é¢‘ç å¯ä»¥è®©åŒæ—¶ä¼ è¾“çš„æ— çº¿ä¿¡å·äº’ä¸å¹²æ‰°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ‰©é¢‘å› å­ä¸º4æ—¶ï¼Œå¯ä»¥åŒæ—¶ä¼ è¾“4ä¸ªäººçš„ä¿¡æ¯ã€‚ One of references: Data Rate and Spreading Factor","categories":[{"name":"LoRa","slug":"LoRa","permalink":"https://blog.inoki.cc/categories/LoRa/"}],"tags":[{"name":"LoRaWAN","slug":"LoRaWAN","permalink":"https://blog.inoki.cc/tags/LoRaWAN/"},{"name":"LoRa","slug":"LoRa","permalink":"https://blog.inoki.cc/tags/LoRa/"},{"name":"IoT","slug":"IoT","permalink":"https://blog.inoki.cc/tags/IoT/"}]},{"title":"KDE Connect iOS å¼€å‘æ—¥è®°(2) è¯†åˆ«åè®®","slug":"KDEConnect-iOS-dev-dairy-ZHCN-2","date":"2020-04-19T15:34:50.000Z","updated":"2025-03-08T09:40:48.582Z","comments":true,"path":"2020/04/19/KDEConnect-iOS-dev-dairy-ZHCN-2/","link":"","permalink":"https://blog.inoki.cc/2020/04/19/KDEConnect-iOS-dev-dairy-ZHCN-2/","excerpt":"","text":"åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼ŒKDE Connect iOS çš„æ„å»ºå·²ä¿®å¤ï¼Œå¯ä»¥å°†åº”ç”¨ç¨‹åºå®‰è£…åˆ°è®¾å¤‡æˆ–æ¨¡æ‹Ÿå™¨ä¸­ã€‚ è¦ä¸å…¶ä»–è®¾å¤‡è¿æ¥ï¼Œæˆ‘ä»¬éœ€è¦ä¸å®ƒä»¬é…å¯¹ã€‚ä½†æ˜¯ï¼Œåœ¨æ­¤ä¹‹å‰ï¼Œè®¾å¤‡éœ€è¦ä½¿ç”¨ KDE Connect è¯†åˆ«æœºåˆ¶ç›¸äº’å‘ç°ã€‚ è¯†åˆ«è¿‡ç¨‹ åˆå§‹èº«ä»½éªŒè¯è¿‡ç¨‹éå¸¸ç®€å•ï¼Œå¦‚ä¸‹æ‰€ç¤º: 1.é¦–å…ˆï¼Œè®¾å¤‡ A å°†å‘é€ä¸€ä¸ª UDP å¹¿æ’­æ•°æ®åŒ…ï¼Œå…¶ä¸­åŒ…å«å…¶èº«ä»½æ•°æ®åŒ…ï¼› 2.æ¯ä¸ªæ¥æ”¶åˆ° UDP å¹¿æ’­çš„è®¾å¤‡ B éƒ½ä¼šå°è¯•æå–æ•°æ®åŒ…ä¸­çš„ TCP ç«¯å£ä¿¡æ¯ï¼Œå¹¶å°è¯•é€šè¿‡è¯¥ç«¯å£ä¸è®¾å¤‡è¿æ¥ï¼› 3.é€šè¿‡ TCP è¿æ¥ï¼Œæ¯ä¸ªè®¾å¤‡ B éƒ½ä¼šå‘è®¾å¤‡ A å‘é€è‡ªå·±çš„æ ‡è¯†æ•°æ®åŒ…ï¼› 4.ç„¶åï¼Œè®¾å¤‡ä¼šå°†é“¾æ¥é¡¹æ·»åŠ åˆ°å‘ç°çš„è®¾å¤‡åˆ—è¡¨ä¸­ï¼Œå¹¶ç­‰å¾…ç”¨æˆ·çš„æ“ä½œã€‚ å‡çº§è¯†åˆ«ç½‘ç»œåŒ… ç¬¬ä¸€æ¬¡å°è¯•ï¼Œé™¤äº† iOS è®¾å¤‡ï¼Œæˆ‘æ‰€æœ‰çš„è®¾å¤‡éƒ½å¯ä»¥æ‰¾åˆ°å½¼æ­¤ã€‚ åœ¨è°ƒè¯•æ¨¡å¼ä¸‹ï¼Œæˆ‘çœ‹åˆ°å‘ç°æ¶ˆæ¯å’Œç›¸å…³çš„è¾“å‡ºï¼š 1&quot;Inoki&quot; uses an old protocol version, this won&apos;t work å› æ­¤ï¼Œæˆ‘ä½¿ç”¨ Wireshark æ•è·æ•°æ®åŒ…ï¼Œä»¥äº†è§£ä¸ºä»€ä¹ˆ KDE Connect iOS ä¸­çš„æ—§å®ç°æ— æ³•æ­£å¸¸å·¥ä½œã€‚ åŒºåˆ«åœ¨äºæ•°æ®åŒ…å†…å®¹å’Œå®šåˆ¶æ•°æ®ã€‚ è¯†åˆ«ç½‘ç»œåŒ…å†…å®¹ æ‰€æœ‰çš„ç½‘ç»œåŒ…éƒ½æ˜¯é€šè¿‡åºåˆ—åŒ– NetWorkPackage ç±»æ¥å®ç°çš„ï¼Œè¿™ä¸ªç±»åœ¨ lib/NetworkPackage.h å’Œ lib/NetworkPackage.m æ–‡ä»¶ä¸­è¢«å®šä¹‰ã€‚ ç±»ä¸­åŒ…å«çš„å±æ€§æœ‰: 123456@property(nonatomic) NSString* _Id;@property(nonatomic) NSString *_Type;@property(nonatomic) NSMutableDictionary *_Body;@property(nonatomic) NSData *_Payload;@property(nonatomic) NSDictionary *_PayloadTransferInfo;@property(nonatomic)long _PayloadSize; åºåˆ—åŒ–ä¹‹åï¼Œå†…å®¹å°†æ˜¯ JSON æ ¼å¼çš„å­—ç¬¦ä¸²ã€‚ä¾‹å¦‚ï¼Œæ¥è‡ª KDE Connect iOS çš„æ•°æ®åŒ…å†…å®¹ä¸ºï¼š 12345678910111213&#123; \"id\":\"1587284674\", \"type\":\"kdeconnect.identity\", \"body\":&#123; \"deviceId\":\"test-kdeconnect-ios\", \"SupportedOutgoingInterfaces\":\"kdeconnect.ping,kdeconnect.mpris,kdeconnect.share,kdeconnect.clipboard,kdeconnect.mousepad,kdeconnect.battery,kdeconnect.calendar,kdeconnect.reminder,kdeconnect.contact\", \"protocolVersion\":5, \"tcpPort\":1714, \"deviceType\":\"Phone\", \"deviceName\":\"Inoki\", \"SupportedIncomingInterfaces\":\"kdeconnect.calendar,kdeconnect.clipboard,kdeconnect.ping,kdeconnect.reminder,kdeconnect.share,kdeconnect.contact\" &#125;&#125; æ¥è‡ª KDE Connect çš„å…¶ä»–å¹³å°çš„å†…å®¹æ˜¯ï¼š 1234567891011121314151617&#123; \"id\":1587284383, \"type\":\"kdeconnect.identity\", \"body\":&#123; \"deviceId\":\"9985DA4FDD3449C78ACC8597D2C5A782\", \"protocolVersion\":7, \"tcpPort\":1716, \"deviceType\":\"phone\", \"deviceName\":\"Inoki\", \"incomingCapabilities\":[ \"kdeconnect.calendar\",\"kdeconnect.clipboard\",\"kdeconnect.ping\",\"kdeconnect.reminder\",\"kdeconnect.share\",\"kdeconnect.contact\" ], \"outgoingCapabilities\":[ \"kdeconnect.ping\",\"kdeconnect.mpris\",\"kdeconnect.share\",\"kdeconnect.clipboard\",\"kdeconnect.mousepad\",\"kdeconnect.battery\",\"kdeconnect.calendar\",\"kdeconnect.reminder\",\"kdeconnect.contact\" ] &#125;&#125; ä¿®å¤ id å­—æ®µçš„ç±»å‹ æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç¬¬ä¸€ä¸ªåŒºåˆ«æ˜¯å…³äº id å­—æ®µã€‚åœ¨ KDE Connect iOS æ•°æ®åŒ…ä¸­ï¼Œå®ƒæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚ä½†æ˜¯åœ¨è¾ƒæ–°ç‰ˆæœ¬çš„åè®®ä¸­ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ•´æ•°ã€‚ å› æ­¤æˆ‘å°†å…¶ç±»å‹ä» NSString æ”¹ä¸º NSNumber: 123456@property(nonatomic) NSNumber *_Id;@property(nonatomic) NSString *_Type;@property(nonatomic) NSMutableDictionary *_Body;@property(nonatomic) NSData *_Payload;@property(nonatomic) NSDictionary *_PayloadTransferInfo;@property(nonatomic)long _PayloadSize; æ›´æ–°æ”¯æŒçš„åŠŸèƒ½ç±»å‹ å¦ä¸€ä¸ªé‡å¤§æ›´æ”¹æ˜¯åŠŸèƒ½æè¿°çš„ç±»å‹å’Œåç§°ï¼š å®ƒä»¬ä¹‹å‰åˆ†åˆ«æ˜¯ SupportedOutgoingInterfaces å’Œ SupportedIncomingInterfacesï¼Œå­—ç¬¦ä¸²ç±»å‹ï¼› åœ¨æœ€æ–°ç‰ˆæœ¬ä¸­ï¼Œå®ƒä»¬æ˜¯ incomingCapabilities å’Œ outgoingCapabilitiesï¼Œæ•°ç»„ç±»å‹ã€‚ åœ¨ KDE Connect iOS ä¸­ï¼Œå®ƒæ˜¯ç”± lib/NetworkPackage.m ä¸­çš„ä»¥ä¸‹ä»£ç ç”Ÿæˆçš„ï¼š 12[np setObject:[[[PluginFactory sharedInstance] getSupportedIncomingInterfaces] componentsJoinedByString:@&quot;,&quot;] forKey:@&quot;SupportedIncomingInterfaces&quot;];[np setObject:[[[PluginFactory sharedInstance] getSupportedOutgoingInterfaces] componentsJoinedByString:@&quot;,&quot; ] forKey:@&quot;SupportedOutgoingInterfaces&quot;]; æ˜¾ç„¶ï¼Œè¿”å›çš„å€¼æ˜¯æ•°ç»„ï¼Œä½†æ˜¯å®ƒä»¬ç”±é€—å·å­—ç¬¦ä¸²è¿æ¥å½¢æˆä¸€ä¸ªå­—ç¬¦ä¸²ã€‚å› æ­¤ï¼Œæˆ‘åªæ˜¯æ›´æ”¹äº†é”®åï¼Œå¹¶åˆ é™¤äº† componentsJoinedByString æ–¹æ³•ï¼š 12[np setObject:[[PluginFactory sharedInstance] getSupportedIncomingInterfaces] forKey:@&quot;incomingCapabilities&quot;];[np setObject:[[PluginFactory sharedInstance] getSupportedOutgoingInterfaces] forKey:@&quot;outgoingCapabilities&quot;]; æ›´æ–°åè®®ç‰ˆæœ¬ åè®®ç‰ˆæœ¬å­—æ®µåœ¨å¤´æ–‡ä»¶ä¸­å®šä¹‰ï¼š 1#define ProtocolVersion 5 æˆ‘å°†å…¶å‡çº§ä¸º 7 æ¥åŒ¹é…ç°ç‰ˆæœ¬ã€‚ èº«ä»½æ•°æ®åŒ…å®šåˆ¶æ•°æ® åœ¨ Wireshark æ•°æ®åŒ…ä¸­ KDE Connect iOS çš„èº«ä»½æ•°æ®åŒ…çš„å®šåˆ¶æ•°æ®ä¸º \\x0D\\x0Aã€‚æ¥è‡ªå…¶ä»– KDE Connect ç‰ˆæœ¬çš„æ˜¯ \\x0Aã€‚ å› æ­¤ï¼Œæˆ‘æ›´æ”¹äº† lib/NetworkPackage.m ä¸­çš„ä»£ç ï¼š 12- #define LFDATA [NSData dataWithBytes:&quot;\\x0D\\x0A&quot; length:2]+ #define LFDATA [NSData dataWithBytes:&quot;\\x0A&quot; length:1] ç»“è®º æœ€ç»ˆï¼ŒKDE Connect iOS å¯ä»¥æ‰¾åˆ°å…¶ä»–è®¾å¤‡å¹¶å»ºç«‹ä¸å®ƒä»¬çš„è¿æ¥ï¼š ç›¸åï¼Œå…¶ä»–äººè¿˜æ‰¾ä¸åˆ° KDE Connect iOS å®¢æˆ·ç«¯ã€‚è¿™æ˜¯å› ä¸ºæ–°ç‰ˆæœ¬åœ¨ TCP è¿æ¥åéœ€è¦ TLS / SSLã€‚è¿™å°†åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­è§£å†³ã€‚ ç¥æˆ‘å¥½è¿ï¼","categories":[{"name":"Translation","slug":"Translation","permalink":"https://blog.inoki.cc/categories/Translation/"},{"name":"Chinese","slug":"Translation/Chinese","permalink":"https://blog.inoki.cc/categories/Translation/Chinese/"},{"name":"KDE Connect","slug":"KDE-Connect","permalink":"https://blog.inoki.cc/categories/KDE-Connect/"}],"tags":[{"name":"ç¿»è¯‘","slug":"ç¿»è¯‘","permalink":"https://blog.inoki.cc/tags/ç¿»è¯‘/"},{"name":"ä¸­æ–‡","slug":"ä¸­æ–‡","permalink":"https://blog.inoki.cc/tags/ä¸­æ–‡/"},{"name":"KDE Connect","slug":"KDE-Connect","permalink":"https://blog.inoki.cc/tags/KDE-Connect/"}]},{"title":"KDE Connect iOS Develop Dairy(2) Identity Protocol","slug":"KDEConnect-iOS-dev-dairy-2","date":"2020-04-19T14:34:50.000Z","updated":"2025-03-08T09:40:48.577Z","comments":true,"path":"2020/04/19/KDEConnect-iOS-dev-dairy-2/","link":"","permalink":"https://blog.inoki.cc/2020/04/19/KDEConnect-iOS-dev-dairy-2/","excerpt":"","text":"In the previous post, KDE Connect iOS Develop Dairy(1) Build, the build of KDE Connect iOS has been fixed, we can install the application into a device or a simulator. To connect with the other devices, we need to pair with them. But, before that, the devices need to discover each other with the KDE Connect identity mechanism. Identity Process The initial identity process is straightforward, as shown below: First, device A will send a UDP broadcast packet, which carries its identity packet; Each device B, which receives the UDP broadcast, will try to extract the TCP port information in the packet and try to connect with the device via the port; With a TCP connection, each device B will send its identity packet to device A; Then, the devices will add a link item to the discovered device list and wait for usersâ€™ actions. Update Identity Packet With a first attempt, all my devices can find each other, except the iOS one. In the debug mode, I saw a discover message and an associated output: 1&quot;Inoki&quot; uses an old protocol version, this won&apos;t work So, I captured the packets using Wireshark, to see why the old implementation in KDE Connect iOS does not work. The differences are in the packet content and tailored data. Identity Packet content All network packets are generated by serializing NetWorkPackage class, which is defined in lib/NetworkPackage.h and lib/NetworkPackage.m. The properties of that class are: 123456@property(nonatomic) NSString* _Id;@property(nonatomic) NSString *_Type;@property(nonatomic) NSMutableDictionary *_Body;@property(nonatomic) NSData *_Payload;@property(nonatomic) NSDictionary *_PayloadTransferInfo;@property(nonatomic)long _PayloadSize; After the serialization, the content will be a JSON format string. For example, the packet content from KDE Connect iOS is: 12345678910111213&#123; \"id\":\"1587284674\", \"type\":\"kdeconnect.identity\", \"body\":&#123; \"deviceId\":\"test-kdeconnect-ios\", \"SupportedOutgoingInterfaces\":\"kdeconnect.ping,kdeconnect.mpris,kdeconnect.share,kdeconnect.clipboard,kdeconnect.mousepad,kdeconnect.battery,kdeconnect.calendar,kdeconnect.reminder,kdeconnect.contact\", \"protocolVersion\":5, \"tcpPort\":1714, \"deviceType\":\"Phone\", \"deviceName\":\"Inoki\", \"SupportedIncomingInterfaces\":\"kdeconnect.calendar,kdeconnect.clipboard,kdeconnect.ping,kdeconnect.reminder,kdeconnect.share,kdeconnect.contact\" &#125;&#125; And the one from KDE Connect on the other platforms is: 1234567891011121314151617&#123; \"id\":1587284383, \"type\":\"kdeconnect.identity\", \"body\":&#123; \"deviceId\":\"9985DA4FDD3449C78ACC8597D2C5A782\", \"protocolVersion\":7, \"tcpPort\":1716, \"deviceType\":\"phone\", \"deviceName\":\"Inoki\", \"incomingCapabilities\":[ \"kdeconnect.calendar\",\"kdeconnect.clipboard\",\"kdeconnect.ping\",\"kdeconnect.reminder\",\"kdeconnect.share\",\"kdeconnect.contact\" ], \"outgoingCapabilities\":[ \"kdeconnect.ping\",\"kdeconnect.mpris\",\"kdeconnect.share\",\"kdeconnect.clipboard\",\"kdeconnect.mousepad\",\"kdeconnect.battery\",\"kdeconnect.calendar\",\"kdeconnect.reminder\",\"kdeconnect.contact\" ] &#125;&#125; Fix id field type We can see the first difference is about the id field. In the KDE Connect iOS packet, it is a string. But in the newer version protocol, it is an integer. So, I changedÃŸ its property type from NSString to NSNumber: 123456@property(nonatomic) NSNumber *_Id;@property(nonatomic) NSString *_Type;@property(nonatomic) NSMutableDictionary *_Body;@property(nonatomic) NSData *_Payload;@property(nonatomic) NSDictionary *_PayloadTransferInfo;@property(nonatomic)long _PayloadSize; Update capabilities type Another significant change is the type and the name of description of capacibilities: They were SupportedOutgoingInterfaces and SupportedIncomingInterfaces, with string type; In the latest version, they are incomingCapabilities and outgoingCapabilities, with array type. In KDE Connect iOS, it is generated by the following lines in lib/NetworkPackage.m: 12[np setObject:[[[PluginFactory sharedInstance] getSupportedIncomingInterfaces] componentsJoinedByString:@&quot;,&quot;] forKey:@&quot;SupportedIncomingInterfaces&quot;];[np setObject:[[[PluginFactory sharedInstance] getSupportedOutgoingInterfaces] componentsJoinedByString:@&quot;,&quot; ] forKey:@&quot;SupportedOutgoingInterfaces&quot;]; The returned values are arrays, and a comma string joins them. So, I changed the key and removed the componentsJoinedByString method: 12[np setObject:[[PluginFactory sharedInstance] getSupportedIncomingInterfaces] forKey:@&quot;incomingCapabilities&quot;];[np setObject:[[PluginFactory sharedInstance] getSupportedOutgoingInterfaces] forKey:@&quot;outgoingCapabilities&quot;]; Update the protocol version The protocol version field is defined in the header file: 1#define ProtocolVersion 5 I update it to 7 to match the current version. Identity Packet tailor data The tailor data of identity packet from KDE Connect iOS in a Wireshark traffic is \\x0D\\x0A. And the one from other KDE Connect versions is \\x0A. So, I change the line in lib/NetworkPackage.m: 12- #define LFDATA [NSData dataWithBytes:&quot;\\x0D\\x0A&quot; length:2]+ #define LFDATA [NSData dataWithBytes:&quot;\\x0A&quot; length:1] Conclusion Finally, the KDE Connect iOS can find the other device and establish connections to them: On the contrary, the others cannot find KDE Connect iOS client out yet. Thatâ€™s because the new version requires TLS/SSL after a TCP connection. This will get fixed in the next post. Good luck to myself!","categories":[{"name":"KDE Connect","slug":"KDE-Connect","permalink":"https://blog.inoki.cc/categories/KDE-Connect/"}],"tags":[{"name":"KDE Connect","slug":"KDE-Connect","permalink":"https://blog.inoki.cc/tags/KDE-Connect/"}]},{"title":"KDE Connect iOS å¼€å‘æ—¥è®°(1) æ„å»º","slug":"KDEConnect-iOS-dev-dairy-ZHCN-1","date":"2020-04-18T22:20:30.000Z","updated":"2025-03-08T09:40:48.578Z","comments":true,"path":"2020/04/18/KDEConnect-iOS-dev-dairy-ZHCN-1/","link":"","permalink":"https://blog.inoki.cc/2020/04/18/KDEConnect-iOS-dev-dairy-ZHCN-1/","excerpt":"","text":"å¤„ç†ä¾èµ– KDE Connect iOS é¡¹ç›®ä½¿ç”¨ CocoaPods æ¥ç®¡ç†ä¾èµ–: COCOAPODS æ˜¯ä»€ä¹ˆ CocoaPods æ˜¯ Swift å’Œ Objective-C Cocoa é¡¹ç›®çš„ä¾èµ–é¡¹ç®¡ç†å™¨ã€‚ å®ƒæ‹¥æœ‰è¶…è¿‡ 7.2 ä¸‡ä¸ªåº“ï¼Œå¹¶åœ¨è¶…è¿‡300ä¸‡ä¸ªåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ã€‚ CocoaPodså¯ä»¥å¸®åŠ©æ‚¨ä¼˜é›…åœ°æ‰©å±•é¡¹ç›®ã€‚ ä¸ CocoaPods æœ‰å…³çš„æ–‡ä»¶æ˜¯ Podfileï¼Œå®ƒæŒ‡å®šäº†è¿™ä¸ªé¡¹ç›®é¢å‘çš„ iOS çš„ç‰ˆæœ¬ (7.0)ï¼Œä¾èµ–çš„åç§°ã€ç‰ˆæœ¬å’Œæºï¼š 1234567platform :ios, &apos;7.0&apos;pod &apos;CocoaAsyncSocket&apos;, &apos;~&gt; 7.3.5&apos;pod &apos;MRProgress&apos;pod &apos;InAppSettingsKit&apos;, &apos;~&gt; 2.1&apos;pod &apos;VTAcknowledgementsViewController&apos;pod &apos;XbICalendar&apos;, :podspec =&gt; &apos;https://raw.githubusercontent.com/libical/XbICalendar/master/XbICalendar.podspec&apos;pod &apos;MYBlurIntroductionView&apos; æ„å»ºçš„ç¬¬ä¸€æ­¥å°±æ˜¯å®‰è£…è¿™äº›ä¾èµ–ã€‚åœ¨å®‰è£…äº† CocoaPods ä¹‹åï¼Œæˆ‘æ ¹æ®å®˜æ–¹æ–‡æ¡£è¿è¡Œäº† pod installï¼Œä½†æ˜¯å‡ºç°äº†é—®é¢˜ï¼š 12345678910111213141516171819202122232425262728$ pod installAnalyzing dependenciesFetching podspec for `XbICalendar` from `https://raw.githubusercontent.com/libical/XbICalendar/master/XbICalendar.podspec`Downloading dependenciesInstalling CocoaAsyncSocket (7.3.5)Installing InAppSettingsKit (2.15)Installing MRProgress (0.8.3)Installing MYBlurIntroductionView (1.0.3)Installing VTAcknowledgementsViewController (1.5.2)Installing XbICalendar (0.3.3)Generating Pods projectIntegrating client projects[!] Could not automatically select an Xcode workspace. Specify one in your Podfile like so: workspace &apos;path/to/Workspace.xcworkspace&apos;[!] The abstract target Pods is not inherited by a concrete target, so the following dependencies won&apos;t make it into any targets in your project: - CocoaAsyncSocket (~&gt; 7.3.5) - InAppSettingsKit (~&gt; 2.1) - MRProgress - MYBlurIntroductionView - VTAcknowledgementsViewController - XbICalendar (from `https://raw.githubusercontent.com/libical/XbICalendar/master/XbICalendar.podspec`)[!] The platform of the target `Pods` (iOS 7.0) may not be compatible with `InAppSettingsKit (2.15)` which has a minimum requirement of iOS 8.0.[!] The platform of the target `Pods` (iOS 7.0) may not be compatible with `VTAcknowledgementsViewController (1.5.2)` which has a minimum requirement of iOS 8.0 - tvOS 9.0. çœ‹èµ·æ¥æœ‰ä¸€äº› bug è¦ä¿®äº† ğŸ˜ƒ ä¿®å¤ Bug 123[!] Could not automatically select an Xcode workspace. Specify one in your Podfile like so: workspace &apos;path/to/Workspace.xcworkspace&apos; åœ¨è¿™ä¸ªé¡¹ç›®ä¸­ï¼Œ.xcworkspace æ–‡ä»¶å¯¹åº”çš„æ˜¯ kdeconnect-ios.xcworkspaceã€‚æ‰€ä»¥æˆ‘åœ¨æ–‡ä»¶ä¸­æ·»åŠ äº† workspace 'kdeconnect-ios' ä¸€å¥ã€‚ 123[!] The platform of the target `Pods` (iOS 7.0) may not be compatible with `InAppSettingsKit (2.15)` which has a minimum requirement of iOS 8.0.[!] The platform of the target `Pods` (iOS 7.0) may not be compatible with `VTAcknowledgementsViewController (1.5.2)` which has a minimum requirement of iOS 8.0 - tvOS 9.0. å¾ˆæ˜æ˜¾ï¼Œè¿™ä¸ªè¾“å‡ºæŒ‡å‡ºï¼Œç›®æ ‡çš„ç³»ç»Ÿç‰ˆæœ¬éœ€è¦å‡çº§ã€‚ä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ç›´æ¥æŠŠå®ƒå‡çº§åˆ°äº† platform :ios, '12.0'ã€‚ 12[!] The abstract target Pods is not inherited by a concrete target, so the following dependencies won&apos;t make it into any targets in your project: ... è¿™ä¸ªæ¶ˆæ¯åˆ™è¯´æ˜ pods(å¯¹åº”ä¾èµ–çš„æ¦‚å¿µ) æ²¡æœ‰æŒ‡å®šç›®æ ‡é¡¹ç›®ã€‚æ ¹æ® CocoaPod çš„æ–‡æ¡£ï¼Œæˆ‘åº”å½“æ·»åŠ  target &quot;kdeconnect-ios&quot; å¹¶æŠŠæ‰€æœ‰çš„ pods æ”¾åœ¨ä¸€ä¸ª do ... end ç»“æ„ä¸­ã€‚ æœ€ç»ˆç‰ˆæœ¬ Podfile æœ€ç»ˆï¼ŒPodfile æ–‡ä»¶å˜æˆäº†ï¼š 123456789101112workspace &apos;kdeconnect-ios&apos;target &quot;kdeconnect-ios&quot; doplatform :ios, &apos;12.0&apos;pod &apos;CocoaAsyncSocket&apos;, &apos;~&gt; 7.3.5&apos;pod &apos;MRProgress&apos;pod &apos;InAppSettingsKit&apos;, &apos;~&gt; 2.1&apos;pod &apos;VTAcknowledgementsViewController&apos;pod &apos;XbICalendar&apos;, :podspec =&gt; &apos;https://raw.githubusercontent.com/libical/XbICalendar/master/XbICalendar.podspec&apos;pod &apos;MYBlurIntroductionView&apos;end ä¿®å¤è¿‡åï¼Œè¾“å‡ºæ­£å¸¸äº†èµ·æ¥ï¼š 123456$ pod installAnalyzing dependenciesDownloading dependenciesGenerating Pods projectIntegrating client projectPod installation complete! There are 6 dependencies from the Podfile and 6 total pods installed. ä½¿ç”¨ XCode æ„å»º æ—¢ç„¶å®‰è£…ä¾èµ–éƒ¨åˆ†å·²ç»æ²¡æœ‰é—®é¢˜äº†ï¼Œä½¿ç”¨ XCode ç¼–è¯‘æ„å»ºå®ƒå°±å˜å¾—é¡ºç†æˆç« äº†ï¼ˆè™½ç„¶ XCode æ˜¯ä¸–ç•Œæœ€å·® IDE æ²¡æœ‰ä¹‹ä¸€ï¼‰ã€‚ åº”ç”¨ç¨‹åºæ ‡è¯†ç¬¦ ç¬¬ä¸€ä¸ªé—®é¢˜å‡ºç°åœ¨æˆ‘ç‚¹å‡» Build æŒ‰é’®çš„æ—¶å€™ï¼š 12Failed to register bundle identifier.The app identifier &quot;application-identifier&quot; cannot be registered to your development team. Change your bundle identifier to a unique string to try again. Apple è¯•å›¾ä¸ºæˆ‘çš„ Apple å¸å·å’Œè¿™ä¸ªåº”ç”¨ç¨‹åºç”Ÿæˆä¸€ä¸ªè‡ªç­¾åè¯ä¹¦ã€‚ä½†å®ƒæ²¡æ³•å¤„ç†ç°åœ¨è¿™ä¸ªæ ¼å¼çš„æ ‡è¯†ç¬¦ã€‚ å› æ­¤æˆ‘æŠŠæ ‡è¯†ç¬¦æ”¹æˆäº† org.kde.kdeconnect.iosï¼Œç„¶åç‚¹å‡» Try againï¼Œè¿™æ¬¡ï¼Œè‡ªç­¾åè¯ä¹¦ç”ŸæˆæˆåŠŸã€‚ Multiple commands produce ç´§æ¥ç€ï¼Œæˆ‘é‡æ–°å¼€å§‹æ„å»ºã€‚å¦ä¸€ä¸ª bug å°±å‡ºç°äº†ï¼š 123Multiple commands produce &apos;/Users/inoki/Library/Developer/Xcode/DerivedData/kdeconnect-ios-hhcvmcgjatxxdugxbjbrwgotfgna/Build/Products/Debug-iphoneos/kdeconnect-ios.app/zh-Hans.lproj/Localizable.strings&apos;:1) Target &apos;kdeconnect-ios&apos; (project &apos;kdeconnect-ios&apos;) has copy command from &apos;/Users/inoki/Projects/kdeconnect-ios-test/kdeconnect-ios/zh-Hans.lproj/Localizable.strings&apos; to &apos;/Users/inoki/Library/Developer/Xcode/DerivedData/kdeconnect-ios-hhcvmcgjatxxdugxbjbrwgotfgna/Build/Products/Debug-iphoneos/kdeconnect-ios.app/zh-Hans.lproj/Localizable.strings&apos;2) Target &apos;kdeconnect-ios&apos; (project &apos;kdeconnect-ios&apos;) has copy command from &apos;/Users/inoki/Projects/kdeconnect-ios-test/kdeconnect-ios/zh-Hans.lproj/Localizable.strings&apos; to &apos;/Users/inoki/Library/Developer/Xcode/DerivedData/kdeconnect-ios-hhcvmcgjatxxdugxbjbrwgotfgna/Build/Products/Debug-iphoneos/kdeconnect-ios.app/zh-Hans.lproj/Localizable.strings&apos; æˆ‘å‚è€ƒäº†è¿™ä¸ªåœ¨ GitHub ä¸Šçš„ issueï¼ŒæŠŠæ„å»ºç³»ç»Ÿæ›´æ”¹ä¸º legacyï¼š ç¼ºå¤±çš„å¤´æ–‡ä»¶ æ¥ç€ï¼Œå¦ä¸€ä¸ªé”™è¯¯å‡ºç°äº†ï¼š 1kdeconnect-ios/AppSettingViewController.m:27:9: &apos;IASKPSTitleValueSpecifierViewCell.h&apos; file not found è¿™ä¸ªé—®é¢˜å¯èƒ½æ˜¯æŸä¸ªä¾èµ–ç‰ˆæœ¬å‡çº§å¯¼è‡´çš„ï¼Œç›´æ¥ç§»é™¤è¿™è¡Œï¼š 1#import &quot;IASKPSTitleValueSpecifierViewCell.h&quot; åº“é“¾æ¥é”™è¯¯ï¼Œç¦ç”¨ Bitcode ä¹‹åï¼Œæˆ‘å†æ¬¡é‡æ–°æ„å»ºï¼Œåˆä¸€ä¸ªé—®é¢˜å‡ºç°äº†ï¼š 1ld: &apos;/Users/inoki/Projects/kdeconnect-ios-test/Pods/XbICalendar/libical/lib/libical.a(icalcomponent.c.o)&apos; does not contain bitcode. You must rebuild it with bitcode enabled (Xcode setting ENABLE_BITCODE), obtain an updated library from the vendor, or disable bitcode for this target. for architecture arm64 Bitcode å¯èƒ½æ˜¯ä¸€ä¸ªæ–°çš„ç‰¹æ€§ï¼Œä½†ç›®å‰æ¥è¯´æˆ‘æƒ³å°½å¿«å°† KDE Connect iOS æ„å»ºèµ·æ¥ã€‚å› æ­¤æˆ‘åœ¨ Build Settings-&gt;Build Options ä¸­ç¦ç”¨äº†å®ƒï¼š é“¾æ¥ WebKit åº“ å¦ä¸€ä¸ªé—®é¢˜æ˜¯ä¸ WebKit æœ‰å…³çš„ï¼š 1Undefined symbols for architecture arm64: &quot;_OBJC_CLASS_$_WKWebView&quot; çœ‹èµ·æ¥æ˜¯å› ä¸º WebKit æ¡†æ¶æ²¡æœ‰è¢«åŠ å…¥åˆ°é¡¹ç›®ä¸­ã€‚æ‰€ä»¥ï¼Œå¯ä»¥åœ¨ Build Phases-&gt;Link Binary with Libraries å°†å…¶åŠ å…¥ï¼š æ–‡ä»¶æœªæ‰¾åˆ°(Pods-acknowledgements.plist, Pods-resources.sh) æœ€ç»ˆï¼Œå½“ä¸€åˆ‡éƒ½å®Œæˆæ„å»ºï¼Œåˆä¸€ä¸ªé—®é¢˜å‡ºç°ï¼š 1Pods/Pods-acknowledgements.plist:0: Reading data: The file â€œPods-acknowledgements.plistâ€ couldnâ€™t be opened because there is no such file. è¿™å¯èƒ½æ˜¯å› ä¸º CocoaPod ç‰ˆæœ¬å¯¼è‡´çš„ä¸å…¼å®¹é—®é¢˜ã€‚æˆ‘æŠŠ Pods/Target Support Files/Pods-kdeconnect-ios ä¸­å¯¹åº”çš„æ–‡ä»¶å¤åˆ¶åˆ° Pods/ é‡Œæ¥ä¿®å¤ï¼š 12cp Pods-kdeconnect-ios-acknowledgements.plist ../../Pods-acknowledgements.plistcp Pods-kdeconnect-ios-resources.sh ../../Pods-resources.sh æœ€ç»ˆï¼Œç¨‹åºç»ˆäºæ„å»ºæˆåŠŸå¹¶åœ¨è®¾å¤‡ä¸Šè¿è¡Œäº† ğŸ˜ƒ","categories":[{"name":"Translation","slug":"Translation","permalink":"https://blog.inoki.cc/categories/Translation/"},{"name":"Chinese","slug":"Translation/Chinese","permalink":"https://blog.inoki.cc/categories/Translation/Chinese/"},{"name":"KDE Connect","slug":"KDE-Connect","permalink":"https://blog.inoki.cc/categories/KDE-Connect/"}],"tags":[{"name":"ç¿»è¯‘","slug":"ç¿»è¯‘","permalink":"https://blog.inoki.cc/tags/ç¿»è¯‘/"},{"name":"ä¸­æ–‡","slug":"ä¸­æ–‡","permalink":"https://blog.inoki.cc/tags/ä¸­æ–‡/"},{"name":"KDE Connect","slug":"KDE-Connect","permalink":"https://blog.inoki.cc/tags/KDE-Connect/"}]},{"title":"KDE Connect iOS Develop Dairy(1) Build","slug":"KDEConnect-iOS-dev-dairy-1","date":"2020-04-18T21:43:50.000Z","updated":"2025-03-08T09:40:48.574Z","comments":true,"path":"2020/04/18/KDEConnect-iOS-dev-dairy-1/","link":"","permalink":"https://blog.inoki.cc/2020/04/18/KDEConnect-iOS-dev-dairy-1/","excerpt":"","text":"Handle Dependencies The project uses CocoaPods to manage its dependencies: WHAT IS COCOAPODS CocoaPods is a dependency manager for Swift and Objective-C Cocoa projects. It has over 72 thousand libraries and is used in over 3 million apps. CocoaPods can help you scale your projects elegantly. The CocoaPods file is Podfile, which describes the iOS version (7.0) to use, and the dependencies name, version, and source: 1234567platform :ios, &apos;7.0&apos;pod &apos;CocoaAsyncSocket&apos;, &apos;~&gt; 7.3.5&apos;pod &apos;MRProgress&apos;pod &apos;InAppSettingsKit&apos;, &apos;~&gt; 2.1&apos;pod &apos;VTAcknowledgementsViewController&apos;pod &apos;XbICalendar&apos;, :podspec =&gt; &apos;https://raw.githubusercontent.com/libical/XbICalendar/master/XbICalendar.podspec&apos;pod &apos;MYBlurIntroductionView&apos; The first step to build it is installing the dependencies. After installing CocoaPods, I ran pod install and got some errors: 12345678910111213141516171819202122232425262728$ pod installAnalyzing dependenciesFetching podspec for `XbICalendar` from `https://raw.githubusercontent.com/libical/XbICalendar/master/XbICalendar.podspec`Downloading dependenciesInstalling CocoaAsyncSocket (7.3.5)Installing InAppSettingsKit (2.15)Installing MRProgress (0.8.3)Installing MYBlurIntroductionView (1.0.3)Installing VTAcknowledgementsViewController (1.5.2)Installing XbICalendar (0.3.3)Generating Pods projectIntegrating client projects[!] Could not automatically select an Xcode workspace. Specify one in your Podfile like so: workspace &apos;path/to/Workspace.xcworkspace&apos;[!] The abstract target Pods is not inherited by a concrete target, so the following dependencies won&apos;t make it into any targets in your project: - CocoaAsyncSocket (~&gt; 7.3.5) - InAppSettingsKit (~&gt; 2.1) - MRProgress - MYBlurIntroductionView - VTAcknowledgementsViewController - XbICalendar (from `https://raw.githubusercontent.com/libical/XbICalendar/master/XbICalendar.podspec`)[!] The platform of the target `Pods` (iOS 7.0) may not be compatible with `InAppSettingsKit (2.15)` which has a minimum requirement of iOS 8.0.[!] The platform of the target `Pods` (iOS 7.0) may not be compatible with `VTAcknowledgementsViewController (1.5.2)` which has a minimum requirement of iOS 8.0 - tvOS 9.0. There are some bugs to fix ğŸ˜ƒ Bugfix 123[!] Could not automatically select an Xcode workspace. Specify one in your Podfile like so: workspace &apos;path/to/Workspace.xcworkspace&apos; In this project, the .xcworkspace file is kdeconnect-ios.xcworkspace. So, I add workspace 'kdeconnect-ios' into the file. 123[!] The platform of the target `Pods` (iOS 7.0) may not be compatible with `InAppSettingsKit (2.15)` which has a minimum requirement of iOS 8.0.[!] The platform of the target `Pods` (iOS 7.0) may not be compatible with `VTAcknowledgementsViewController (1.5.2)` which has a minimum requirement of iOS 8.0 - tvOS 9.0. The target OS version should be updated. I directly update it to platform :ios, '12.0'. 12[!] The abstract target Pods is not inherited by a concrete target, so the following dependencies won&apos;t make it into any targets in your project: ... This message indicates that the pods(dependencies) do not have a target; according to the CocoaPod doc, I should add target &quot;kdeconnect-ios&quot; and wrap all the pods with a do ... end body. Final Podfile As a result, the Podfile should be: 123456789101112workspace &apos;kdeconnect-ios&apos;target &quot;kdeconnect-ios&quot; doplatform :ios, &apos;12.0&apos;pod &apos;CocoaAsyncSocket&apos;, &apos;~&gt; 7.3.5&apos;pod &apos;MRProgress&apos;pod &apos;InAppSettingsKit&apos;, &apos;~&gt; 2.1&apos;pod &apos;VTAcknowledgementsViewController&apos;pod &apos;XbICalendar&apos;, :podspec =&gt; &apos;https://raw.githubusercontent.com/libical/XbICalendar/master/XbICalendar.podspec&apos;pod &apos;MYBlurIntroductionView&apos;end After fixing, the output seems normal: 123456$ pod installAnalyzing dependenciesDownloading dependenciesGenerating Pods projectIntegrating client projectPod installation complete! There are 6 dependencies from the Podfile and 6 total pods installed. Build with XCode Without error in installing dependencies, it is possible to open and build it with XCode (though it could be the worst IDE in the world). Identifier The first issue occurred while I click Build: 12Failed to register bundle identifier.The app identifier &quot;application-identifier&quot; cannot be registered to your development team. Change your bundle identifier to a unique string to try again. Apple wants to generate a self-signed certificate for my Apple account and the application. But it cannot handle the identifier. I change it to org.kde.kdeconnect.ios and click Try again. It works. Multiple commands produce Then, rebuild. And another one came out: 123Multiple commands produce &apos;/Users/inoki/Library/Developer/Xcode/DerivedData/kdeconnect-ios-hhcvmcgjatxxdugxbjbrwgotfgna/Build/Products/Debug-iphoneos/kdeconnect-ios.app/zh-Hans.lproj/Localizable.strings&apos;:1) Target &apos;kdeconnect-ios&apos; (project &apos;kdeconnect-ios&apos;) has copy command from &apos;/Users/inoki/Projects/kdeconnect-ios-test/kdeconnect-ios/zh-Hans.lproj/Localizable.strings&apos; to &apos;/Users/inoki/Library/Developer/Xcode/DerivedData/kdeconnect-ios-hhcvmcgjatxxdugxbjbrwgotfgna/Build/Products/Debug-iphoneos/kdeconnect-ios.app/zh-Hans.lproj/Localizable.strings&apos;2) Target &apos;kdeconnect-ios&apos; (project &apos;kdeconnect-ios&apos;) has copy command from &apos;/Users/inoki/Projects/kdeconnect-ios-test/kdeconnect-ios/zh-Hans.lproj/Localizable.strings&apos; to &apos;/Users/inoki/Library/Developer/Xcode/DerivedData/kdeconnect-ios-hhcvmcgjatxxdugxbjbrwgotfgna/Build/Products/Debug-iphoneos/kdeconnect-ios.app/zh-Hans.lproj/Localizable.strings&apos; To fix it, I refer this GitHub issue and change the build system to the legacy one: Missing header After that, another error occurs: 1kdeconnect-ios/AppSettingViewController.m:27:9: &apos;IASKPSTitleValueSpecifierViewCell.h&apos; file not found This may be an update of one dependency; remove this import line: 1#import &quot;IASKPSTitleValueSpecifierViewCell.h&quot; Link error, disable Bitcode I rebuilt it, but another one cameâ€¦ 1ld: &apos;/Users/inoki/Projects/kdeconnect-ios-test/Pods/XbICalendar/libical/lib/libical.a(icalcomponent.c.o)&apos; does not contain bitcode. You must rebuild it with bitcode enabled (Xcode setting ENABLE_BITCODE), obtain an updated library from the vendor, or disable bitcode for this target. for architecture arm64 Bitcode may be a feature, but I want to get it to build as soon as possible. So, I disable it in Build Settings-&gt;Build Options: Link with WebKit Another link error occurs. It is about the WebView stuff: 1Undefined symbols for architecture arm64: &quot;_OBJC_CLASS_$_WKWebView&quot; It seems that the WebKit framework is not included in the project. So, add it in Build Phases-&gt;Link Binary with Libraries: File(Pods-acknowledgements.plist, Pods-resources.sh) not found Finally, at the end of building phases, the error came out: 1Pods/Pods-acknowledgements.plist:0: Reading data: The file â€œPods-acknowledgements.plistâ€ couldnâ€™t be opened because there is no such file. This could be an error caused by CocoaPod version. To fix it, copy the files in Pods/Target Support Files/Pods-kdeconnect-ios to Pods/: 12cp Pods-kdeconnect-ios-acknowledgements.plist ../../Pods-acknowledgements.plistcp Pods-kdeconnect-ios-resources.sh ../../Pods-resources.sh Finally, it works ğŸ˜ƒ","categories":[{"name":"KDE Connect","slug":"KDE-Connect","permalink":"https://blog.inoki.cc/categories/KDE-Connect/"}],"tags":[{"name":"KDE Connect","slug":"KDE-Connect","permalink":"https://blog.inoki.cc/tags/KDE-Connect/"}]},{"title":"KDE Connect iOS Develop Dairy(0) Index","slug":"KDEConnect-iOS-dev-dairy-0","date":"2020-04-18T10:34:50.000Z","updated":"2025-03-08T09:40:48.574Z","comments":true,"path":"2020/04/18/KDEConnect-iOS-dev-dairy-0/","link":"","permalink":"https://blog.inoki.cc/2020/04/18/KDEConnect-iOS-dev-dairy-0/","excerpt":"","text":"Preface Thanks to the previous work on KDE Connect for iOS, there is a not bad codebase on KDE git. This serie of blogs aims in bringing KDE Connect back to the iOS platform. You could check the progress here. Context KDE Connect iOS Develop Dairy(1) Build KDE Connect iOS Develop Dairy(2) Identity Protocol KDE Connect iOS Develop Dairy(3) Certificate â€¦Under Construction Preview Here are some screenshots:","categories":[{"name":"KDE Connect","slug":"KDE-Connect","permalink":"https://blog.inoki.cc/categories/KDE-Connect/"}],"tags":[{"name":"KDE Connect","slug":"KDE-Connect","permalink":"https://blog.inoki.cc/tags/KDE-Connect/"}]},{"title":"KDE Connect iOS å¼€å‘æ—¥è®°(0) ç´¢å¼•","slug":"KDEConnect-iOS-dev-dairy-ZHCN-0","date":"2020-04-18T10:34:50.000Z","updated":"2025-03-08T09:40:48.578Z","comments":true,"path":"2020/04/18/KDEConnect-iOS-dev-dairy-ZHCN-0/","link":"","permalink":"https://blog.inoki.cc/2020/04/18/KDEConnect-iOS-dev-dairy-ZHCN-0/","excerpt":"","text":"å‰è¨€ æ„Ÿè°¢å…ˆå‰ç¤¾åŒºå†…å¼€å‘è€…çš„åŠªåŠ›ï¼ŒKDE Connect iOS ç‰ˆæœ¬å·²ç»æœ‰äº†ä¸€å®šé‡çš„ä»£ç ï¼Œå¯ä»¥åœ¨ KDE git ä¸Šæ‰¾åˆ°ã€‚è¿™ä¸ªç³»åˆ—åšå®¢è‡´åŠ›äºè®°å½•æˆ‘å¦‚ä½•å°† KDE Connect é‡æ–°å¸¦å› iOS å¹³å°ã€‚ ç›®å½• KDE Connect iOS å¼€å‘æ—¥è®°(1) æ„å»º KDE Connect iOS å¼€å‘æ—¥è®°(2) è¯†åˆ«åè®® KDE Connect iOS å¼€å‘æ—¥è®°(3) è¯ä¹¦ â€¦å‰©ä½™éƒ¨åˆ†ä»åœ¨æ„å»ºä¸­ é¢„è§ˆ åœ¨è¿™é‡Œå¯ä»¥çœ‹åˆ°ç›®å‰è¿›åº¦çš„æˆªå›¾:","categories":[{"name":"Translation","slug":"Translation","permalink":"https://blog.inoki.cc/categories/Translation/"},{"name":"Chinese","slug":"Translation/Chinese","permalink":"https://blog.inoki.cc/categories/Translation/Chinese/"},{"name":"KDE Connect","slug":"KDE-Connect","permalink":"https://blog.inoki.cc/categories/KDE-Connect/"}],"tags":[{"name":"ç¿»è¯‘","slug":"ç¿»è¯‘","permalink":"https://blog.inoki.cc/tags/ç¿»è¯‘/"},{"name":"ä¸­æ–‡","slug":"ä¸­æ–‡","permalink":"https://blog.inoki.cc/tags/ä¸­æ–‡/"},{"name":"KDE Connect","slug":"KDE-Connect","permalink":"https://blog.inoki.cc/tags/KDE-Connect/"}]},{"title":"åœ¨ Ubuntu 18.04 æ„å»º Intelligent Input Bus (IBus)","slug":"Build-iBus","date":"2020-02-29T10:40:00.000Z","updated":"2025-03-08T09:40:48.556Z","comments":true,"path":"2020/02/29/Build-iBus/","link":"","permalink":"https://blog.inoki.cc/2020/02/29/Build-iBus/","excerpt":"","text":"ç®€ä»‹ Intelligent Input Busï¼Œç®€ç§°IBusï¼Œæ˜¯ Unix-like æ“ä½œç³»ç»Ÿä¸‹çš„å¤šè¯­è¾“å…¥æ³•å¹³å°ã€‚å› ä¸ºå®ƒé‡‡ç”¨äº†æ€»çº¿ï¼ˆBusï¼‰å¼çš„æ¶æ„ï¼Œæ‰€ä»¥å‘½åä¸ºBusã€‚ åœ¨ä¸œåŒ—äºšå¼€æºè½¯ä»¶ï¼ˆOSSï¼‰è®ºå›ç¬¬3å·¥ä½œå°ç»„æå‡ºçš„ã€Šè¾“å…¥æ³•å¼•æ“æœåŠ¡æä¾›è€…ç•Œé¢è§„æ ¼ã€‹ï¼ˆSpecification of IM engine Service Provider Interfaceï¼‰è‰æ¡ˆé‡Œï¼Œèƒ½å®ç°ä»¥ Bus ä¸ºæ ¸å¿ƒçš„æ¶æ„è¢«å»ºè®®é‡‡ç”¨ã€‚SCIM-1.4 çš„æ¶æ„å¹¶ä¸è¢«çœ‹å¥½ï¼Œå› ä¸ºå®ƒæ˜¯ç”¨ C++ å¼€å‘çš„ï¼Œå› æ­¤å¸¸å¸¸ä¼šæœ‰C++åº”ç”¨äºŒè¿›åˆ¶æ¥å£ä¸ç¬¦åˆçš„æƒ…å†µå‘ç”Ÿã€‚ ä»é‚£æ—¶èµ·ï¼Œä¸€äº›äººå¼€å§‹ç€æ‰‹å¼€å‘ä¸‹ä¸€ä»£çš„è¾“å…¥æ³•å¹³å°ï¼Œåƒæ˜¯è‹å“²é¢†å¯¼çš„IM-Busï¼Œä»¥åŠèƒ¡æ­£çš„SCIM-2ï¼Œå¯æƒœçš„æ˜¯å®ƒä»¬çš„å¼€å‘è¿›åº¦ä»ç„¶åœæ»ä¸å‰ã€‚å› æ­¤ï¼Œæ—¶ä»»çº¢å¸½ï¼ˆç°ä»»è°·æ­Œï¼‰çš„é»„é¹å¼€å§‹ç”¨ Python å¼€å‘ IBus ä»¥å®ç° IM-Bus æå‡ºçš„æ„æƒ³ã€‚IBus å¹¶ä¸å®Œå…¨å®ç°ä¸œåŒ—äºš OSS è®ºå›æ‰€å»ºè®®çš„å‡½æ•°ï¼Œè€Œæ˜¯é‡‡ç”¨D-BusåŠGlibæ¥å®åšã€‚å°½ç®¡å¦‚æ­¤ï¼ŒIBus å·²ç»å¼€å§‹è¢« OSS ç¤¾ç¾¤æ‰€æ¥å—ï¼ŒFreeBSD ä»¥åŠå„å¤§ Linux å‘è¡Œç‰ˆ å¦‚ Fedoraã€Ubuntu å·²ç»å°† IBus çº³å…¥å…¶åŒ…åº“é‡Œã€‚åœ¨ Fedora 11 é‡Œï¼ŒIBus å·²ç»æˆä¸ºé»˜è®¤çš„å¤šè¯­è¾“å…¥å¹³å°ã€‚ IBus æ˜¯ç”¨ C åŠ Python å¼€å‘çš„ï¼Œå¦‚æ­¤å¯ä»¥é¿å… C++ ABI transition é—®é¢˜ã€‚IBus ä¸»è¦é€è¿‡ä¸‹åˆ—ä¸‰ç§æœåŠ¡(Service)æ¥æä¾›åŠŸèƒ½ï¼š è¾“å…¥æ³•å¼•æ“æœåŠ¡ï¼šä¸ºè¾“å…¥æ³•æœ¬èº«ã€‚ é…ç½®æœåŠ¡ï¼šç®¡ç†IBusä»¥åŠè¾“å…¥æ³•çš„è®¾ç½®é€‰é¡¹ã€‚ æ§åˆ¶é¢æ¿æœåŠ¡ï¼šæä¾›è¯¸å¦‚è¯­è¨€æ¡ï¼Œå€™é€‰å­—èœå•ç­‰ç”¨æˆ·ç•Œé¢ã€‚ IBus ä½¿ç”¨ D-Bus ä½œ ibus-daemonæœåŠ¡ï¼Œä»¥åŠ IMå®¢æˆ·ç«¯ï¼ˆåƒæ˜¯konsole, gedit, firefox)ä¹‹é—´çš„æ²Ÿé€šã€‚ ibus-daemon é€è¿‡æ¥å—æœåŠ¡ç™»å½•ï¼Œä»¥åŠå‘é€ D-Bus æ¶ˆæ¯æ¥ç®¡ç†æœåŠ¡åŠIMå®¢æˆ·ç«¯ã€‚IBusæ”¯æŒ XIM åè®®åŠ Gtk IM æ¨¡å—ä»¥åŠ Qt IM æ¨¡å—ã€‚ é¡¹ç›®æ‰˜ç®¡åœ¨ GitHub IBus ç»„ç»‡ä¸‹ https://github.com/ibus/ibusã€‚ æ„å»º é¦–å…ˆï¼Œè·å–æœ€æ–°çš„æºä»£ç ï¼Œå¹¶è¿›å…¥å…¶ç›®å½•ï¼š 12git clone https://github.com/ibus/ibus.gitcd ibus ç›®å‰è¿™é‡Œä½¿ç”¨çš„æ˜¯ master åˆ†æ”¯ä¸Šçš„ä»£ç ï¼Œæœ‰æ—¶è¯¥åˆ†æ”¯å¯èƒ½å¹¶ä¸ç¨³å®šã€‚å¯ä»¥ä½¿ç”¨ä¸€ä¸ª release åˆ†æ”¯æˆ–æ ‡ç­¾çš„ä»£ç æ¥æ„å»ºï¼Œä»¥é¿å…ä¸€äº›å¥‡æ€ªçš„é”™è¯¯ã€‚è¿™é‡Œæˆ‘ä½¿ç”¨ 1.5.y åˆ†æ”¯çš„ä»£ç ï¼š 1git checkout -b 1.5.y origin/1.5.y ä½¿ç”¨è„šæœ¬è°ƒç”¨ auto configure å·¥å…·é“¾ï¼Œæ¥ç”Ÿæˆ Makefile æ–‡ä»¶ 1./autogen.sh --prefix=/usr --sysconfdir=/etc è¿™æ—¶ï¼Œå¦‚æœæœ‰é”™è¯¯ï¼Œè¯´æ˜æœ‰äº›ä¾èµ–å¹¶æ²¡æœ‰è¢«å®‰è£…åœ¨ç³»ç»Ÿé‡Œï¼Œéœ€è¦ç”¨æˆ·æ‰‹åŠ¨å®‰è£…ï¼Œè¯·çœ‹ä¾èµ–ç« èŠ‚ã€‚ å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨ make è¿›è¡Œæ„å»ºå’Œå®‰è£…äº†ï¼š 1make &amp;&amp; sudo make install å¦‚æœæ„å»ºå¤±è´¥ï¼Œè¯·å¯¹ç…§æ„å»ºæ—¶ä¾èµ–ç›¸å…³é—®é¢˜ã€‚ å®Œæˆä¹‹åè¿è¡Œä¸€ä¸‹ï¼š 1ibus-setup åœ¨ IBus çš„ä»£ç é‡Œï¼Œæœ‰ä¸€ä¸ª simple engine è¾“å…¥å¼•æ“æœåŠ¡ï¼Œå®ƒä¸æä¾›ä»»ä½•çœŸå®çš„è¾“å…¥åŠŸèƒ½ï¼Œåªæ˜¯æŠŠæ¡Œé¢ç¯å¢ƒæ”¯æŒçš„å„ç§é”®ç›˜å¸ƒå±€æ˜¾ç¤ºå‡ºæ¥ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ£€æµ‹ IBus æ˜¯å¦æˆåŠŸæ„å»ºï¼š è‹¥æ²¡æœ‰è¿™äº›é”®ç›˜å¸ƒå±€ï¼Œå¯èƒ½ ibus-daemon å‡ºäº†äº›é—®é¢˜ï¼Œå°è¯•è¿è¡Œï¼š 1ibus-daemon åœ¨è¿è¡Œæ—¶ä¾èµ–ç›¸å…³é—®é¢˜ä¸­æœ‰ä¸€äº›æˆ‘é‡åˆ°çš„é—®é¢˜ï¼Œå¯ä¾›å‚è€ƒã€‚ ä¹‹åå°±å¯ä»¥æ„å»ºæƒ³ç”¨çš„è¾“å…¥æœåŠ¡äº†ã€‚æ®å®˜æ–¹æ–‡æ¡£ï¼Œç›®å‰çš„å¼•æ“æœ‰ï¼š ibus-anthy: æ—¥æ–‡è¾“å…¥æ³•ã€‚ ibus-array: è¡Œåˆ—è¾“å…¥æ³• ibus-bopomofo: ä½¿ç”¨æ³¨éŸ³ç¬¦å·çš„æ‹¼éŸ³è¾“å…¥æ³•ï¼ŒåŸºäºibus-pinyinå¼•æ“å¼€å‘ï¼Œä½†è¾“å…¥æ–¹å¼ä¸ä¸€èˆ¬æ ‡å‡†æ™ºèƒ½å½¢æ³¨éŸ³è¾“å…¥æ³•ï¼ˆå¦‚æ–°é…·éŸ³è¾“å…¥æ³•æˆ–å¾®è½¯æ–°æ³¨éŸ³ï¼‰ä¸åŒã€‚ ibus-chewing: æ–°é…·éŸ³è¾“å…¥æ³•ï¼Œæ™ºèƒ½å½¢æ³¨éŸ³è¾“å…¥æ³•ã€‚ ibus-hangul: éŸ©æ–‡è¾“å…¥æ³•ã€‚ ibus-kkcï¼šæ—¥æ–‡å‡åæ±‰å­—è½¬æ¢è¾“å…¥æ³•ã€‚ ibus-m17n: ä½¿ç”¨m17n-dbçš„å¤šè¯­è¾“å…¥æ³•ã€‚ ibus-pinyin: æ‹¼éŸ³è¾“å…¥æ³•ï¼Œä¸ºIBusä¸»è¦å¼€å‘è€…æ‰€å¼€å‘ã€‚ ibus-libpinyin: æ˜¯ Red Hat å·¥ç¨‹å¸ˆä¸»å¯¼ã€åŸºäº n-gram è¯­è¨€æ¨¡å‹çš„é›†æˆæ€§æ³›æ‹¼éŸ³è¾“å…¥æ³•å¼•æ“ã€‚ ibus-libzhuyin: ä¸ ibus-libpinyin ç³»å‡ºåŒæºï¼Œæ”¯æŒæ³¨éŸ³ç¬¦å·è¾“å…¥ï¼Œåä¸ºâ€œæ–°æ³¨éŸ³â€(New Zhuyin) è¾“å…¥æ³•ï¼Œæ˜¯æ™ºèƒ½å½¢çš„æ³¨éŸ³è¾“å…¥æ³•ã€‚ ibus-table: ç è¡¨è¾“å…¥å¼•æ“ã€‚ ibus-googlepinyin: Googleæ‹¼éŸ³è¾“å…¥æ³•çš„ibusç‰ˆæœ¬ï¼ˆè¿™ä¸ªå¹¶ä¸æ˜¯å®˜æ–¹çš„Googleè¾“å…¥æ³•ï¼Œè€Œæ˜¯ç”±çˆ±å¥½è€…ä»Androidé¡¹ç›®ä¸Šè¿ç§»è¿‡æ¥ï¼‰ ä¾èµ– æœ€åŸºç¡€çš„ä¾èµ–æ˜¯ D-Bus åŠå…¶ Python ç»‘å®šï¼Œåœ¨ Ubuntu é‡Œï¼Œè¿™äº›ä»¥æ¥åº”è¯¥æ˜¯å·²ç»è¢«é¢„ç½®åœ¨æ¡Œé¢ç‰ˆæœ¬çš„ç³»ç»Ÿä¸­äº†ï¼š 123python &gt;= 2.5dbus-glib &gt;= 0.74dbus-python &gt;= 0.83.0 å®˜æ–¹æ–‡æ¡£è¿˜æ¨èå®‰è£…qt &gt;= 4.4.0ï¼Œè¿™æ˜¯ä¸ºäº†è®© IBus èƒ½å’Œ Qt çš„ IM åä½œï¼Œè¿™ä¸ªä¾èµ–å¯¹äºä½¿ç”¨ Qt çš„åº”ç”¨ç¨‹åºï¼ˆå¦‚ä½¿ç”¨çš„æ¡Œé¢ç¯å¢ƒæ˜¯KDEï¼‰æ¥è¯´æ˜¯è‡³å…³é‡è¦çš„ã€‚ä½†åœ¨ Ubuntu 18.04 ä¸­ï¼Œ Gnome è¢«ä½œä¸ºé»˜è®¤çš„æ¡Œé¢ç¯å¢ƒï¼Œå› æ­¤ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦æ¥é…ç½®ã€‚ æ„å»ºæ—¶ä¾èµ–ç›¸å…³é—®é¢˜ æ ¹æ®æˆ‘çš„ç»å†ï¼Œä»¥ä¸‹è¿™äº›æ˜¯æˆ‘åœ¨ Ubuntu 18.04 ä¸Šé…ç½®æœŸé—´é‡åˆ°çš„é—®é¢˜ï¼š é…ç½®æœŸé—´ï¼Œæç¤ºæœªæ‰¾åˆ° gnome-autogen.shï¼šå®‰è£… gnome-common é…ç½®æœŸé—´ï¼Œæç¤ºæœªæ‰¾åˆ° gtk-docï¼šå®‰è£… gtk-doc é…ç½®æœŸé—´ï¼Œæç¤ºæœªæ‰¾åˆ° gtkÂ±2.0ï¼šå®‰è£… libgtk2.0-dev é…ç½®æœŸé—´ï¼Œæç¤ºæœªæ‰¾åˆ° gtkÂ±3.0ï¼šå®‰è£… libgtk-3-dev é…ç½®æœŸé—´ï¼Œæç¤ºæœªæ‰¾åˆ° dconfï¼šå®‰è£… libdconf-dev é…ç½®æœŸé—´ï¼Œæç¤ºæœªæ‰¾åˆ° emoji-test.txtï¼šå®‰è£… unicode-data é…ç½®æœŸé—´ï¼Œæç¤ºæœªæ‰¾åˆ° annotations/en.xmlï¼šå®‰è£… unicode-cldr-core é…ç½®æœŸé—´ï¼Œæç¤ºæœªæ‰¾åˆ° unicode/ucd/NamesList.txtï¼šåˆ›å»ºä¸€ä¸ªç¬¦å·é“¾æ¥ unicode/NamesList.txt -&gt; unicode/ucd/NamesList.txt (unicode-data åŒ…å·²å®‰è£…) é…ç½®æœŸé—´ï¼Œæç¤ºæœªæ‰¾åˆ° unicode/ucd/Blocks.txtï¼šåˆ›å»ºä¸€ä¸ªç¬¦å·é“¾æ¥ unicode/Blocks.txt -&gt; unicode/ucd/Blocks.txt (unicode-data åŒ…å·²å®‰è£…) ç¼–è¯‘æœŸé—´ï¼Œæç¤ºæœªæ‰¾åˆ° valacï¼šå®‰è£… valac-0.40-vapi, valac-0.40-dev ç¼–è¯‘æœŸé—´ï¼Œæç¤º Vala bindings require Gobject Introspectionï¼šå®‰è£… libgirepository1.0-dev è¿è¡Œæ—¶ä¾èµ–ç›¸å…³é—®é¢˜ ibus_serializable_serialize_object ç¬¦å·æœªæ‰¾åˆ° æˆ‘åœ¨è¿è¡Œ ibus-daemon æ—¶é‡åˆ°äº† Not found symbol ibus_serializable_serialize_object çš„æŠ¥é”™ã€‚ æ ¹æ®åˆ†æï¼Œæ˜¯ libibus-1.0.so è¢«å®‰é”™äº†åœ°æ–¹ï¼š ibus-daemon é“¾æ¥åˆ° /usr/lib/x86_64-linux-gnu/libibus-1.0.so.5ï¼Œè¿™ä¸ªæ–‡ä»¶æ˜¯ä¸ªç¬¦å·é“¾æ¥ï¼ŒæŒ‡å‘çœŸæ­£çš„ so æ–‡ä»¶ã€‚è€Œåœ¨æˆ‘çš„ç”µè„‘å®ƒæŒ‡å‘äº†ä¸Šä¹‹å‰çš„åŒ…ç®¡ç†å™¨å®‰è£…çš„ so ç‰ˆæœ¬ï¼Œäºæ˜¯å°±å‡ºç° ABI ä¸å…¼å®¹çš„é—®é¢˜ï¼Œæç¤ºæ‰¾ä¸åˆ° symbolã€‚ æ ¹æ® logï¼Œå®‰è£…è„šæœ¬é‡Œçš„ç¡®å®‰è£…äº†æ–°ç‰ˆæœ¬çš„ so å¹¶ä¸”å¤„ç†äº†æŒ‡å‘ï¼Œåªæ˜¯å®ƒè¢«å®‰åœ¨äº† /usr/libã€‚äºæ˜¯æˆ‘æŠŠ /usr/lib/x86_64-linux-gnu/libibus-1.0.so.5 æŒ‡å‘æ”¹ä¸ºäº†æ–°å®‰è£…çš„ so æ–‡ä»¶ï¼Œå†æ¬¡è¿è¡Œï¼Œä¸€åˆ‡æ­£å¸¸ã€‚","categories":[{"name":"Build","slug":"Build","permalink":"https://blog.inoki.cc/categories/Build/"}],"tags":[{"name":"IBus","slug":"IBus","permalink":"https://blog.inoki.cc/tags/IBus/"},{"name":"Ubuntu","slug":"Ubuntu","permalink":"https://blog.inoki.cc/tags/Ubuntu/"}]},{"title":"Visual Studio Code c/cpp configuration","slug":"VSCode-c-cpp-configuration","date":"2020-01-05T08:40:40.000Z","updated":"2025-03-08T09:40:48.594Z","comments":true,"path":"2020/01/05/VSCode-c-cpp-configuration/","link":"","permalink":"https://blog.inoki.cc/2020/01/05/VSCode-c-cpp-configuration/","excerpt":"","text":"123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121&#123; \"configurations\": [ &#123; \"name\": \"Craft-KDE\", \"includePath\": [ \"$&#123;workspaceFolder&#125;/**\", \"/usr/local/include\", \"/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include\", \"&lt;CraftRoot-Path&gt;/include\", \"&lt;CraftRoot-Path&gt;/include/KF5/KActivities\", \"&lt;CraftRoot-Path&gt;/include/KF5/KActivitiesStats\", \"&lt;CraftRoot-Path&gt;/include/KF5/KArchive\", \"&lt;CraftRoot-Path&gt;/include/KF5/KAuth\", \"&lt;CraftRoot-Path&gt;/include/KF5/KBookmarks\", \"&lt;CraftRoot-Path&gt;/include/KF5/KCMUtils\", \"&lt;CraftRoot-Path&gt;/include/KF5/KCodecs\", \"&lt;CraftRoot-Path&gt;/include/KF5/KCompletion\", \"&lt;CraftRoot-Path&gt;/include/KF5/KConfigCore\", \"&lt;CraftRoot-Path&gt;/include/KF5/KConfigGui\", \"&lt;CraftRoot-Path&gt;/include/KF5/KConfigWidgets\", \"&lt;CraftRoot-Path&gt;/include/KF5/KContacts\", \"&lt;CraftRoot-Path&gt;/include/KF5/KCoreAddons\", \"&lt;CraftRoot-Path&gt;/include/KF5/KCrash\", \"&lt;CraftRoot-Path&gt;/include/KF5/KDBusAddons\", \"&lt;CraftRoot-Path&gt;/include/KF5/KDELibs4Support\", \"&lt;CraftRoot-Path&gt;/include/KF5/KDEWebKit\", \"&lt;CraftRoot-Path&gt;/include/KF5/KDNSSD\", \"&lt;CraftRoot-Path&gt;/include/KF5/KDeclarative\", \"&lt;CraftRoot-Path&gt;/include/KF5/KDocTools\", \"&lt;CraftRoot-Path&gt;/include/KF5/KEmoticons\", \"&lt;CraftRoot-Path&gt;/include/KF5/KFileMetaData\", \"&lt;CraftRoot-Path&gt;/include/KF5/KGlobalAccel\", \"&lt;CraftRoot-Path&gt;/include/KF5/KGuiAddons\", \"&lt;CraftRoot-Path&gt;/include/KF5/KHolidays\", \"&lt;CraftRoot-Path&gt;/include/KF5/KHtml\", \"&lt;CraftRoot-Path&gt;/include/KF5/KI18n\", \"&lt;CraftRoot-Path&gt;/include/KF5/KIOCore\", \"&lt;CraftRoot-Path&gt;/include/KF5/KIOFileWidgets\", \"&lt;CraftRoot-Path&gt;/include/KF5/KIOGui\", \"&lt;CraftRoot-Path&gt;/include/KF5/KIOWidgets\", \"&lt;CraftRoot-Path&gt;/include/KF5/KIconThemes\", \"&lt;CraftRoot-Path&gt;/include/KF5/KIdleTime\", \"&lt;CraftRoot-Path&gt;/include/KF5/KItemModels\", \"&lt;CraftRoot-Path&gt;/include/KF5/KItemViews\", \"&lt;CraftRoot-Path&gt;/include/KF5/KJobWidgets\", \"&lt;CraftRoot-Path&gt;/include/KF5/KJsEmbed\", \"&lt;CraftRoot-Path&gt;/include/KF5/KMediaPlayer\", \"&lt;CraftRoot-Path&gt;/include/KF5/KNewStuff3\", \"&lt;CraftRoot-Path&gt;/include/KF5/KNotifications\", \"&lt;CraftRoot-Path&gt;/include/KF5/KNotifyConfig\", \"&lt;CraftRoot-Path&gt;/include/KF5/KPackage\", \"&lt;CraftRoot-Path&gt;/include/KF5/KParts\", \"&lt;CraftRoot-Path&gt;/include/KF5/KPeople\", \"&lt;CraftRoot-Path&gt;/include/KF5/KPlotting\", \"&lt;CraftRoot-Path&gt;/include/KF5/KPty\", \"&lt;CraftRoot-Path&gt;/include/KF5/KRunner\", \"&lt;CraftRoot-Path&gt;/include/KF5/KService\", \"&lt;CraftRoot-Path&gt;/include/KF5/KStyle\", \"&lt;CraftRoot-Path&gt;/include/KF5/KSyntaxHighlighting\", \"&lt;CraftRoot-Path&gt;/include/KF5/KTextEditor\", \"&lt;CraftRoot-Path&gt;/include/KF5/KTextWidgets\", \"&lt;CraftRoot-Path&gt;/include/KF5/KUnitConversion\", \"&lt;CraftRoot-Path&gt;/include/KF5/KWallet\", \"&lt;CraftRoot-Path&gt;/include/KF5/KWidgetsAddons\", \"&lt;CraftRoot-Path&gt;/include/KF5/KWindowSystem\", \"&lt;CraftRoot-Path&gt;/include/KF5/KXmlGui\", \"&lt;CraftRoot-Path&gt;/include/KF5/KXmlRpcClient\", \"&lt;CraftRoot-Path&gt;/include/KF5/Kirigami2\", \"&lt;CraftRoot-Path&gt;/include/KF5/KrossCore\", \"&lt;CraftRoot-Path&gt;/include/KF5/KrossUi\", \"&lt;CraftRoot-Path&gt;/lib/QtConcurrent.framework/Headers\", \"&lt;CraftRoot-Path&gt;/lib/QtCore.framework/Headers\", \"&lt;CraftRoot-Path&gt;/lib/QtDBus.framework/Headers\", \"&lt;CraftRoot-Path&gt;/lib/QtDesigner.framework/Headers\", \"&lt;CraftRoot-Path&gt;/lib/QtDesignerComponents.framework/Headers\", \"&lt;CraftRoot-Path&gt;/lib/QtGui.framework/Headers\", \"&lt;CraftRoot-Path&gt;/lib/QtHelp.framework/Headers\", \"&lt;CraftRoot-Path&gt;/lib/QtLocation.framework/Headers\", \"&lt;CraftRoot-Path&gt;/lib/QtMacExtras.framework/Headers\", \"&lt;CraftRoot-Path&gt;/lib/QtMultimedia.framework/Headers\", \"&lt;CraftRoot-Path&gt;/lib/QtMultimediaQuick.framework/Headers\", \"&lt;CraftRoot-Path&gt;/lib/QtMultimediaWidgets.framework/Headers\", \"&lt;CraftRoot-Path&gt;/lib/QtNetwork.framework/Headers\", \"&lt;CraftRoot-Path&gt;/lib/QtOpenGL.framework/Headers\", \"&lt;CraftRoot-Path&gt;/lib/QtPositioning.framework/Headers\", \"&lt;CraftRoot-Path&gt;/lib/QtPositioningQuick.framework/Headers\", \"&lt;CraftRoot-Path&gt;/lib/QtPrintSupport.framework/Headers\", \"&lt;CraftRoot-Path&gt;/lib/QtQml.framework/Headers\", \"&lt;CraftRoot-Path&gt;/lib/QtQuick.framework/Headers\", \"&lt;CraftRoot-Path&gt;/lib/QtQuickControls2.framework/Headers\", \"&lt;CraftRoot-Path&gt;/lib/QtQuickParticles.framework/Headers\", \"&lt;CraftRoot-Path&gt;/lib/QtQuickShapes.framework/Headers\", \"&lt;CraftRoot-Path&gt;/lib/QtQuickTemplates2.framework/Headers\", \"&lt;CraftRoot-Path&gt;/lib/QtQuickTest.framework/Headers\", \"&lt;CraftRoot-Path&gt;/lib/QtQuickWidgets.framework/Headers\", \"&lt;CraftRoot-Path&gt;/lib/QtScript.framework/Headers\", \"&lt;CraftRoot-Path&gt;/lib/QtScriptTools.framework/Headers\", \"&lt;CraftRoot-Path&gt;/lib/QtSensors.framework/Headers\", \"&lt;CraftRoot-Path&gt;/lib/QtSql.framework/Headers\", \"&lt;CraftRoot-Path&gt;/lib/QtSvg.framework/Headers\", \"&lt;CraftRoot-Path&gt;/lib/QtTest.framework/Headers\", \"&lt;CraftRoot-Path&gt;/lib/QtTextToSpeech.framework/Headers\", \"&lt;CraftRoot-Path&gt;/lib/QtUiPlugin.framework/Headers\", \"&lt;CraftRoot-Path&gt;/lib/QtWebChannel.framework/Headers\", \"&lt;CraftRoot-Path&gt;/lib/QtWebKit.framework/Headers\", \"&lt;CraftRoot-Path&gt;/lib/QtWebKitWidgets.framework/Headers\", \"&lt;CraftRoot-Path&gt;/lib/QtWidgets.framework/Headers\", \"&lt;CraftRoot-Path&gt;/lib/QtXml.framework/Headers\", \"&lt;CraftRoot-Path&gt;/lib/QtXmlPatterns.framework/Headers\", \"&lt;CraftRoot-Path&gt;/lib/qca-qt5.framework/Headers\" ], \"defines\": [\"Q_OS_MAC\", \"Q_OS_MACOS\"], \"macFrameworkPath\": [\"/System/Library/Frameworks\", \"/Library/Frameworks\", \"&lt;CraftRoot-Path&gt;/lib/\"], \"compilerPath\": \"/usr/bin/clang\", \"cStandard\": \"c11\", \"cppStandard\": \"c++17\", \"intelliSenseMode\": \"$&#123;default&#125;\" &#125; ], \"version\": 4&#125;","categories":[{"name":"VSCode","slug":"VSCode","permalink":"https://blog.inoki.cc/categories/VSCode/"}],"tags":[{"name":"VSCode","slug":"VSCode","permalink":"https://blog.inoki.cc/tags/VSCode/"}]},{"title":"FFmpeg Decoding","slug":"FFmpeg-Decoding","date":"2019-12-16T18:42:00.000Z","updated":"2025-03-08T09:40:48.564Z","comments":true,"path":"2019/12/16/FFmpeg-Decoding/","link":"","permalink":"https://blog.inoki.cc/2019/12/16/FFmpeg-Decoding/","excerpt":"","text":"FFmpeg is a complete, cross-platform solution to record, convert and stream audio and video. But on the Internet, almost all tutorials only tell you how to use the FFmpeg with its executables. Although the origin tool ffmpeg executable is good enough, itâ€™s still good to know how FFmpeg works behind. This serie of posts will explore and build encoders, decoders, filters and other utilities with FFmpeg libraries for you and for myself. In this post, we aim at building a video decoder from scratch. Target To make it simple, weâ€™re going to build a program: which accepts an argument, as the path of video and the second argument, as the frame index of frames in the video So, we just need a simple main function: 123456789101112int main(int argc, char *argv[])&#123; // argc == 3 // argv[1] - file path // argv[2] - frame index if (argc &lt; 3) &#123; printf(\"Please provide file path and frame index\"); return -1; &#125; return 0;&#125; Read arguments For the file path, we should be able to directly use it to open the file. As a result, we do not need to handle with it. 1234567int frameIndex = 0;frameIndex = atoi(argv[2]);if (frameIndex &lt;= 0) &#123; printf(\"Please provide a positive frame index\"); return -1;&#125; Here we just read the second argument and transfer it to an integer. Read file We have already got the file path, so we can use the function avformat_open_input, defined in libavformat/avformat.h and implemented in libavformat/utils.c, to open and store it into a FFmpeg readable and operatable format. 1int avformat_open_input(AVFormatContext **ps, const char *url, ff_const59 AVInputFormat *fmt, AVDictionary **options); To call it, we need an AVFormatContext instance. For the last two parameters, we just let them NULL. 12345AVFormatContext *pFormatCtx = NULL;// Open video fileif (avformat_open_input(&amp;pFormatCtx, argv[1], NULL, NULL) != 0) return -1; // Couldn't open file Up to now, we have the handle(context) to the file. Find video stream There are several streams in one video file, for example, there is video stream, audio stream. Some has also subtitle stream. We firstly get the stream information, and it will be filled into pFormatCtx-&gt;nb_streams. 12345678910111213// Retrieve stream informationif (avformat_find_stream_info(pFormatCtx, NULL) &lt; 0) return -1; // Couldn't find stream information// Find the first video streamvideoStream = -1;printf(\"Stream counter: %d\\n\", pFormatCtx-&gt;nb_streams);for (i = 0; i &lt; pFormatCtx-&gt;nb_streams; i++) &#123; if (pFormatCtx-&gt;streams[i]-&gt;codec-&gt;codec_type == AVMEDIA_TYPE_VIDEO) &#123; videoStream = i; break; &#125;&#125; Then we try to find out which is the video stream. Codec context As not to destroy the information in the origin video, itâ€™s better to make a copy to the video. 12345678910111213141516171819202122232425262728293031323334353637AVCodecContext *pCodecCtxOrig = NULL;AVCodecContext *pCodecCtx = NULL;AVCodec *pCodec = NULL;AVCodecParameters *par = NULL;// Allocate memory to store itpar = avcodec_parameters_alloc();// Get a pointer to the codec context for the video streampCodecCtxOrig = pFormatCtx-&gt;streams[videoStream]-&gt;codec;// Find the decoder for the video streampCodec = avcodec_find_decoder(pCodecCtxOrig-&gt;codec_id);if (pCodec == NULL) &#123; fprintf(stderr, \"Unsupported codec!\\n\"); return -1; // Codec not found&#125;else &#123; printf(\"Codec: %s!\\n\", pCodec-&gt;long_name);&#125;// Copy contextpCodecCtx = avcodec_alloc_context3(pCodec);if (avcodec_parameters_from_context(par, pCodecCtxOrig) &lt; 0) &#123; fprintf(stderr, \"Copy param from origin context failed!\\n\"); return -1; // Codec not found&#125;if (avcodec_parameters_to_context(pCodecCtx, par) &lt; 0) &#123; fprintf(stderr, \"Copy param to context failed!\\n\"); return -1; // Codec not found&#125;// Open codecif (avcodec_open2(pCodecCtx, pCodec, NULL) &lt; 0) return -1; // Could not open codec Read frame The core functionnality is here: 12345678910111213141516171819202122232425AVFrame *pFrame = NULL;AVPacket packet;// Allocate video framepFrame = av_frame_alloc();// Read frames and save first five frames to diski = 0;while (av_read_frame(pFormatCtx, &amp;packet) &gt;= 0) &#123; // Is this a packet from the video stream? if (packet.stream_index == videoStream) &#123; // Decode video frame // avcodec_decode_video2(pCodecCtx, pFrame, &amp;frameFinished, &amp;packet); avcodec_send_packet(pCodecCtx, &amp;packet); avcodec_receive_frame(pCodecCtx, pFrame); // Frame got if (++i == frameIndex) printf(\"Frame \\t%d: width - %d height - %d\\n\", i, pFrame-&gt;width, pFrame-&gt;height); &#125; // Free the packet that was allocated by av_read_frame // av_free_packet(&amp;packet); av_packet_unref(&amp;packet);&#125; In this code, we use av_read_frame to read a frame until there is no more frame. Then, avcodec_send_packet(pCodecCtx, &amp;packet); and avcodec_receive_frame(pCodecCtx, pFrame); are called to use the codec context to retrieve the frame in this packet. Then, we can get the frame information and the origin bytes stream in the AVFrame structure. Free memory Finally, do not forget to free all momeries which have been allocated. 1234567891011avcodec_parameters_free(&amp;par);// Free the YUV frameav_frame_free(&amp;pFrame);// Close the codecsavcodec_close(pCodecCtx);avcodec_close(pCodecCtxOrig);// Close the video fileavformat_close_input(&amp;pFormatCtx); Conclusion Up to here, we have been abled to retrieve all frames in a video, and may do some processing on it ğŸ˜ƒ You should know how we can do a decoding of video using FFmpeg API. You can find the full code here: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128#include &lt;stdio.h&gt;#include &lt;libavformat/avformat.h&gt;#include &lt;libavcodec/avcodec.h&gt;#include &lt;libavutil/avutil.h&gt;int main(int argc, char *argv[])&#123; // Initalizing these to NULL prevents segfaults! AVFormatContext *pFormatCtx = NULL; int i, videoStream; AVCodecContext *pCodecCtxOrig = NULL; AVCodecContext *pCodecCtx = NULL; AVCodec *pCodec = NULL; AVFrame *pFrame = NULL; AVPacket packet; AVCodecParameters *par = NULL; int frameIndex = 0; if (argc &lt; 3) &#123; printf(\"Please provide file path and frame index\"); return -1; &#125; frameIndex = atoi(argv[2]); if (frameIndex &lt;= 0) &#123; printf(\"Please provide a positive frame index\"); return -1; &#125; par = avcodec_parameters_alloc(); // Do not need // av_register_all(); // Open video file if (avformat_open_input(&amp;pFormatCtx, argv[1], NULL, NULL) != 0) return -1; // Couldn't open file // Retrieve stream information if (avformat_find_stream_info(pFormatCtx, NULL) &lt; 0) return -1; // Couldn't find stream information // Dump information about file onto standard error av_dump_format(pFormatCtx, 0, argv[1], 0); // Find the first video stream videoStream = -1; printf(\"Stream counter: %d\\n\", pFormatCtx-&gt;nb_streams); for (i = 0; i &lt; pFormatCtx-&gt;nb_streams; i++) &#123; if (pFormatCtx-&gt;streams[i]-&gt;codec-&gt;codec_type == AVMEDIA_TYPE_VIDEO) &#123; videoStream = i; break; &#125; &#125; if (videoStream == -1) return -1; // Didn't find a video stream printf(\"Stream %d is the video stream\\n\", videoStream); // Get a pointer to the codec context for the video stream pCodecCtxOrig = pFormatCtx-&gt;streams[videoStream]-&gt;codec; // Find the decoder for the video stream pCodec = avcodec_find_decoder(pCodecCtxOrig-&gt;codec_id); if (pCodec == NULL) &#123; fprintf(stderr, \"Unsupported codec!\\n\"); return -1; // Codec not found &#125; else &#123; printf(\"Codec: %s!\\n\", pCodec-&gt;long_name); &#125; // Copy context pCodecCtx = avcodec_alloc_context3(pCodec); if (avcodec_parameters_from_context(par, pCodecCtxOrig) &lt; 0) &#123; fprintf(stderr, \"Copy param from origin context failed!\\n\"); return -1; // Codec not found &#125; if (avcodec_parameters_to_context(pCodecCtx, par) &lt; 0) &#123; fprintf(stderr, \"Copy param to context failed!\\n\"); return -1; // Codec not found &#125; // Open codec if (avcodec_open2(pCodecCtx, pCodec, NULL) &lt; 0) return -1; // Could not open codec // Allocate video frame pFrame = av_frame_alloc(); // Read frames and save first five frames to disk i = 0; while (av_read_frame(pFormatCtx, &amp;packet) &gt;= 0) &#123; // Is this a packet from the video stream? if (packet.stream_index == videoStream) &#123; // Decode video frame // avcodec_decode_video2(pCodecCtx, pFrame, &amp;frameFinished, &amp;packet); avcodec_send_packet(pCodecCtx, &amp;packet); avcodec_receive_frame(pCodecCtx, pFrame); // Frame got if (++i == frameIndex) printf(\"Frame \\t%d: width - %d height - %d\\n\", i, pFrame-&gt;width, pFrame-&gt;height); &#125; // Free the packet that was allocated by av_read_frame // av_free_packet(&amp;packet); av_packet_unref(&amp;packet); &#125; avcodec_parameters_free(&amp;par); // Free the YUV frame av_frame_free(&amp;pFrame); // Close the codecs avcodec_close(pCodecCtx); avcodec_close(pCodecCtxOrig); // Close the video file avformat_close_input(&amp;pFormatCtx); return 0;&#125;","categories":[{"name":"FFmpeg","slug":"FFmpeg","permalink":"https://blog.inoki.cc/categories/FFmpeg/"}],"tags":[{"name":"FFmpeg","slug":"FFmpeg","permalink":"https://blog.inoki.cc/tags/FFmpeg/"}]},{"title":"Bug AX88179_178a USB-Ethernet adapter Linux Driver","slug":"Bug_AX88179_178a_USB_Ethernet_adapter_Linux_Driver","date":"2019-12-12T10:52:00.000Z","updated":"2025-03-08T09:40:48.548Z","comments":true,"path":"2019/12/12/Bug_AX88179_178a_USB_Ethernet_adapter_Linux_Driver/","link":"","permalink":"https://blog.inoki.cc/2019/12/12/Bug_AX88179_178a_USB_Ethernet_adapter_Linux_Driver/","excerpt":"","text":"In my previous post, AX88179_178a USB-Ethernet adapter Linux Driver, there is a simple analysis of the Linux Driver of AX88179_178a. And I mentioned that on the mainline, there is a bug while handling the USB packet that we received. Background The phenomenon is that the TLS connection cannot be established through a bridged network. Both in the two following cases: Bridged network on VirtualBox In VirtualBox, we setuped a bridged network via the device Edimax EU-4306, to connect the Virtual Machine with a raspberry. Bridged network on Raspberry Pi On device B, we made a network bridge to connect the PC and the device A. All the packets which donâ€™t have a destination to device a will be resent to the other side. Diagnosis It was a mystery why in these two cases, the communication doesnâ€™t work. So, I used Wireshark to do a monitoring on the interfaces. First one was running on the PC: We can see that, the first packet with 1514 length is the No.616. We should note that the packet No.617 is the one with length 336, and it acts as a TLS handshake packet. The second one is on the device B, monitoring the network interface which is created by Edimax EU-4306: The packet matches the No.616 is the packet No.1858 on this interface. And No.617 matches No.1859. Both of them has two bytes in addition at the end. The two bytes are translated as VSS-Monitoring ethernet trailer, Source Port: 26490 or something similar. The device B should resent all packets to the other network interface. Here is the traffic on the other network interface: We cannot find the index of packet, but we can well find the packet in order. The two we are following are the one with 1516 length and the one following it with 338 length. And finally, on the device A, our destination, we can see that all packets with 1516 length disappeared, which means that they are dropped. Problem Up to here, we can see that itâ€™s the Edimax EU-4306 USB-Ethernet Adapter causing the bug. But, why? So, we need firstly introduce the concept of MTU, Maximum Transmission Unit. In Linux world and maybe the other system, itâ€™s the maximum size, in byte, of a packet, which can be sent to a network interface. The sender will check the size of data itâ€™s going to send, and do some segmentation to cut the data into packets if the size of data is larger than MTU. But the device which acts as a switch, that means which provides the bridged network, will not do the segmentation because it has no such permission. The device just receives a packet, and try to resend it to another physical network. Meanwhile, the network interface of this device will do a check of packet size. The packet will be dropped if itâ€™s too large(larger than MTU). Itâ€™s kind of something abstract. So we just take the second case in the Background chapter as an example. This is the topology of the bridged network. All MTU in the picture are 1500, itâ€™s also the one in the Ethernet protocol. To describe better the question, we just use a packet of size 1514(1500 + 6 bytes destionation MAC address + 6 bytes source MAC address + 2 bytes protocol type). The target is to send this packet to device A. The first step is using the USB network driver to wrap the network packet, with some necessary USB information. This will be done by Linux Kernel, and the output will be sent to the USB device. When the adapter receives the packet, it will handle with it, there may be some control message. The adapter squashes out the network packet, and send it to another side. Another side is also an adapter, it will wrap the network packet to a USB packet, as to send it to the USB Host. Here the USB Host is device B. Here, the adapter is well Edimax EU-4306 using AX88179_178a driver. The driver unwraps the USB packet, but unfortunately, adds two bytes at the end of network packet. So, the size of network packet becomes 1516, with two bytes in addition and by accident. Then, device B, as a switch, tries to resend the network packet to the other interface. But the other interface realizes the packet is larger than its MTU. Finally, it drops the network packet. Thus, device A will never receive the packet. Fixup Up to now, itâ€™s clear that the error is caused by the reception function of AX88178_179a, while unwrapping a packet. Single packet To make it simpler, we come back to the tiny packet describe in my previous post: Obviously, the larger one is the USB packet. The analysis in detail of the packet can be found in that post. Weâ€™ll directly the data that is extracted from the packet. The packet length should be 0x3e -&gt; 62 bytes. So, if we count from 0040, the end should be at 007d. 123456789if (pkt_cnt == 0) &#123; /* Skip IP alignment psudo header */ skb_pull(skb, 2); skb-&gt;len = pkt_len; skb_set_tail_pointer(skb, pkt_len); skb-&gt;truesize = pkt_len + sizeof(struct sk_buff); ax88179_rx_checksum(skb, pkt_hdr); return 1;&#125; With the code on Linux mainline codebase: Remove the first two bytes because they are useless, and they just work as an auxiliary tool to align some bytes. Here, 0xee 0xee are removed , the length in the buffer structure is also reduced. So, the real packet size is 0x3c - 60 bytes. Then, set the length to the packet length: 0x3e. Finally, do something with the buffer. We donâ€™t care this. If you are sensitive, you should have already realized that the problem occured in the second step. We begin at 0042 after the removing. But it always ends up with an offset of 62 bytes. So, we got a packet from 0xff 0xff to 0xf9 0xc2, where the last two bytes are not in the origin network packet, they are a part of USB packet. Here is my code to fix it up: 123456789if (pkt_cnt == 0) &#123; /* Skip IP alignment psudo header */ skb-&gt;len = pkt_len; skb_pull(skb, 2); skb_set_tail_pointer(skb, pkt_len); skb-&gt;truesize = skb-&gt;len + sizeof(struct sk_buff); ax88179_rx_checksum(skb, pkt_hdr); return 1;&#125; Itâ€™s really simple, I just change the order of the first step and the second step. It means that weâ€™ll firstly change the size to the packet size that we extract, then we remove the first two bytes and reduce the size by 2. Thus, the packet is okay, with 60 bytes and from 0xff 0xff. Multiple packet For the case when we have plenty of network packets in a single USB packet, we do nearly the same thing: 123456789101112131415161718ax_skb = skb_clone(skb, GFP_ATOMIC);if (ax_skb) &#123; /* Code on mainline ax_skb-&gt;len = pkt_len; ax_skb-&gt;data = skb-&gt;data + 2; */ ax_skb-&gt;len = pkt_len; ax_skb-&gt;data = skb-&gt;data + 2; /* Skip IP alignment psudo header */ skb_pull(ax_skb, 2); skb_set_tail_pointer(ax_skb, pkt_len); ax_skb-&gt;truesize = ax_skb-&gt;len + sizeof(struct sk_buff); ax88179_rx_checksum(ax_skb, pkt_hdr); usbnet_skb_return(dev, ax_skb);&#125; else &#123; return 0;&#125; Okay, we test! Test We test it with the ARP packet mentioned in my last post: Here we can see the length is 60, no more 62. It means we fixed it! Conclusion This is a serious bug in common, but the use case is not in common: if the packet need not be resent, there is no panic because the protocol on top-level can well handle the packet length with its own length field. I hope one day the bug can be fixed on the mainline codebase of Linux. Maybe I can do that? As itâ€™s a driver of a device for a manufacturer, I donâ€™t know whether have the right to do thatâ€¦","categories":[{"name":"Source Code","slug":"Source-Code","permalink":"https://blog.inoki.cc/categories/Source-Code/"},{"name":"Linux Driver","slug":"Source-Code/Linux-Driver","permalink":"https://blog.inoki.cc/categories/Source-Code/Linux-Driver/"},{"name":"Bug","slug":"Bug","permalink":"https://blog.inoki.cc/categories/Bug/"},{"name":"USB-Net","slug":"Source-Code/Linux-Driver/USB-Net","permalink":"https://blog.inoki.cc/categories/Source-Code/Linux-Driver/USB-Net/"},{"name":"Linux Driver","slug":"Linux-Driver","permalink":"https://blog.inoki.cc/categories/Linux-Driver/"},{"name":"Linux Driver","slug":"Bug/Linux-Driver","permalink":"https://blog.inoki.cc/categories/Bug/Linux-Driver/"}],"tags":[{"name":"Linux","slug":"Linux","permalink":"https://blog.inoki.cc/tags/Linux/"},{"name":"Linux Driver","slug":"Linux-Driver","permalink":"https://blog.inoki.cc/tags/Linux-Driver/"},{"name":"ASIX","slug":"ASIX","permalink":"https://blog.inoki.cc/tags/ASIX/"},{"name":"Bug","slug":"Bug","permalink":"https://blog.inoki.cc/tags/Bug/"}]},{"title":"Write your first FFmpeg program on Windows","slug":"Write-your-first-ffmpeg-program-on-Windows","date":"2019-12-09T22:48:00.000Z","updated":"2025-03-08T09:40:48.603Z","comments":true,"path":"2019/12/09/Write-your-first-ffmpeg-program-on-Windows/","link":"","permalink":"https://blog.inoki.cc/2019/12/09/Write-your-first-ffmpeg-program-on-Windows/","excerpt":"","text":"FFmpeg is a complete, cross-platform solution to record, convert and stream audio and video. Itâ€™s not difficult to write your own simple video editor with it. This post will give you a guide, how to write a program with FFmpeg on Windows, with Visual Studio. Download FFmpeg library and development files In general, for an Open Source library, we may usually need build one from source code. And on Windows, it could be kind of confusing. Luckily, there is a nice hacker, who has built FFmpeg on Windows for us. We can find them on https://ffmpeg.zeranoe.com/builds/. What we need is two linking type files on Windows. So, for â€œArchitectureâ€, Windows-32bits or Windows-64bits. And in linking, we need dev and shared. Shared library can proivde runtime for the compiled program, meanwhile, in dev, we will have header files and exported symbol information to use during development. Create VS Project Create a new Visual C++ project, do not use precompiled header file. Then, right click on the project to open Property panel. DLL files Add your ffmpeg-&lt;version&gt;-win64-shared\\bin into your system PATH. Include files Add your ffmpeg-&lt;version&gt;-win64-dev\\include into VC++ Directory -&gt; Include directory. Lib files Add your ffmpeg-&lt;version&gt;-win64-dev\\lib into VC++ Directory -&gt; Reference directory. Add swscale.lib, avutil.lib, avformat.lib, avcodec.lib, avdevice.lib, avfilter.lib, swresample.lib and postproc.lib into Linker -&gt; Input -&gt; Addons. Code This code comes from FFmpeg samples, it works as a video decoder but it just gets and prints video meta information. 1234567891011121314151617181920212223242526272829303132#include &lt;stdio.h&gt;#include &lt;libavformat/avformat.h&gt;#include &lt;libavutil/dict.h&gt;int main (int argc, char **argv)&#123; AVFormatContext *fmt_ctx = NULL; AVDictionaryEntry *tag = NULL; int ret; if (argc != 2) &#123; printf(\"usage: %s &lt;input_file&gt;\\n\" \"example program to demonstrate the use of the libavformat metadata API.\\n\" \"\\n\", argv[0]); return 1; &#125; if ((ret = avformat_open_input(&amp;fmt_ctx, argv[1], NULL, NULL))) return ret; if ((ret = avformat_find_stream_info(fmt_ctx, NULL)) &lt; 0) &#123; av_log(NULL, AV_LOG_ERROR, \"Cannot find stream information\\n\"); return ret; &#125; while ((tag = av_dict_get(fmt_ctx-&gt;metadata, \"\", tag, AV_DICT_IGNORE_SUFFIX))) printf(\"%s=%s\\n\", tag-&gt;key, tag-&gt;value); avformat_close_input(&amp;fmt_ctx); return 0;&#125; Launch To run it in Visual Studio, in debugging, add the path of your video into command line arguments. And right click on the green triangle. In the terminal, you should be able to see the meta information like this: 1234major_brand=mp42minor_version=0compatible_brands=mp41isomcreation_time=2019-08-25T20:22:43.000000Z Enjoy!","categories":[{"name":"FFmpeg","slug":"FFmpeg","permalink":"https://blog.inoki.cc/categories/FFmpeg/"}],"tags":[{"name":"Windows","slug":"Windows","permalink":"https://blog.inoki.cc/tags/Windows/"},{"name":"FFmpeg","slug":"FFmpeg","permalink":"https://blog.inoki.cc/tags/FFmpeg/"}]},{"title":"AX88179_178a USB-Ethernet adapter Linux Driver","slug":"AX88179_178a_USB_Ethernet_adapter_Linux_Driver","date":"2019-12-09T10:52:00.000Z","updated":"2025-03-08T09:40:48.545Z","comments":true,"path":"2019/12/09/AX88179_178a_USB_Ethernet_adapter_Linux_Driver/","link":"","permalink":"https://blog.inoki.cc/2019/12/09/AX88179_178a_USB_Ethernet_adapter_Linux_Driver/","excerpt":"","text":"In this post, weâ€™ll analyze the Linux Driver of USB-Ethernet adapters, which are using AX88179/AX88178a chips. Introduction AX88179 and AX88178a is a chip from ASIX Electronics Corporation, which is a leading fabless semiconductor supplier with focus on networking, communication and connectivity applications, founded in May 1995 in Hsinchu Science Park, Taiwan. AX88179 is a USB3.0 to 10/100/1000M Gigabit Ethernet Controller, and AX88178a is the one for USB2.0. Since there are still lots of devices which are using USB 2.0, they are usually integrated into one single adapter to provide backward-compatibility. More information about the chips can be found on the offcial website of ASIX: AX88179 AX88178a The one which Iâ€™m using is an adapter from Edimax, named Edimax EU-4306 Adaptateur USB Ethernet. Everyone can buy it with a fair price - about 25 euros in France. Driver Selection The source code of the driver in current version kernel is located at drivers/net/usb/ax88179_178a.c. Its first commit is on Mar 2, 2013. So, up to now, we should be able to use it without panic. To validate that it can be rightly loaded in your system, just plug in. Use this command to find information of your device and the software assoiated with it: 12345678910&gt; usb-devices...T: Bus=02 Lev=01 Prnt=01 Port=00 Cnt=01 Dev#= 2 Spd=5000 MxCh= 0D: Ver= 3.00 Cls=ff(vend.) Sub=ff Prot=00 MxPS= 9 #Cfgs= 1P: Vendor=0b95 ProdID=1790 Rev=01.00S: Manufacturer=ASIX Elec. Corp.S: Product=AX88179S: SerialNumber=xxxxxxC: #Ifs= 1 Cfg#= 1 Atr=a0 MxPwr=496mAI: If#= 0 Alt= 0 #EPs= 3 Cls=ff(vend.) Sub=ff Prot=00 Driver=ax88179_178a We can see at the last line, there is Driver=ax88179_178a, which means my device uses the right driver. To associate a device and a usb driver, one important thing is the vendor ID and product ID, showing in the third line: Vendor=0b95 ProdID=1790. So, if your device cannot be allocated with an appropriate driver, pleas check the vendor ID and product ID of it. The ID table of compatible devices for AX88179/178a is defined as below: 12345678910111213141516171819202122232425262728293031323334353637static const struct usb_device_id products[] = &#123;&#123; /* ASIX AX88179 10/100/1000 */ USB_DEVICE(0x0b95, 0x1790), .driver_info = (unsigned long)&amp;ax88179_info,&#125;, &#123; /* ASIX AX88178A 10/100/1000 */ USB_DEVICE(0x0b95, 0x178a), .driver_info = (unsigned long)&amp;ax88178a_info,&#125;, &#123; /* Cypress GX3 SuperSpeed to Gigabit Ethernet Bridge Controller */ USB_DEVICE(0x04b4, 0x3610), .driver_info = (unsigned long)&amp;cypress_GX3_info,&#125;, &#123; /* D-Link DUB-1312 USB 3.0 to Gigabit Ethernet Adapter */ USB_DEVICE(0x2001, 0x4a00), .driver_info = (unsigned long)&amp;dlink_dub1312_info,&#125;, &#123; /* Sitecom USB 3.0 to Gigabit Adapter */ USB_DEVICE(0x0df6, 0x0072), .driver_info = (unsigned long)&amp;sitecom_info,&#125;, &#123; /* Samsung USB Ethernet Adapter */ USB_DEVICE(0x04e8, 0xa100), .driver_info = (unsigned long)&amp;samsung_info,&#125;, &#123; /* Lenovo OneLinkDock Gigabit LAN */ USB_DEVICE(0x17ef, 0x304b), .driver_info = (unsigned long)&amp;lenovo_info,&#125;, &#123; /* Belkin B2B128 USB 3.0 Hub + Gigabit Ethernet Adapter */ USB_DEVICE(0x050d, 0x0128), .driver_info = (unsigned long)&amp;belkin_info,&#125;, &#123; &#125;,&#125;;MODULE_DEVICE_TABLE(usb, products); Notice that USB_DEVICE is a macro defined in include/linux/usb.h, to quickly assign vendor ID and product ID. Meanwhile, make the mode be strictly matching, which means that only device has this vendor ID AND product ID will be allowed to use this driver. 1234#define USB_DEVICE(vend, prod) \\ .match_flags = USB_DEVICE_ID_MATCH_DEVICE, \\ .idVendor = (vend), \\ .idProduct = (prod) More, products is a table of type struct usb_device_id, defined in include/linux/mod_devicetable.h. Since weâ€™ve already included include/linux/usb.h\\(&lt;linux/usb.h&gt;\\), we do not need import it once more. 123456789101112131415161718192021222324252627struct usb_device_id &#123; /* which fields to match against? */ __u16 match_flags; /* Used for product specific matches; range is inclusive */ __u16 idVendor; __u16 idProduct; __u16 bcdDevice_lo; __u16 bcdDevice_hi; /* Used for device class matches */ __u8 bDeviceClass; __u8 bDeviceSubClass; __u8 bDeviceProtocol; /* Used for interface class matches */ __u8 bInterfaceClass; __u8 bInterfaceSubClass; __u8 bInterfaceProtocol; /* Used for vendor-specific interface matches */ __u8 bInterfaceNumber; /* not matched against */ kernel_ulong_t driver_info __attribute__((aligned(sizeof(kernel_ulong_t))));&#125;; But, if yours is not one of them, it might be another device. This post will have limited usage to you. Driver module registration To make system be able to allocate the right driver, we need register the driver. usb_driver structure The structure to describe a driver for USB is defined in include/linux/usb.h: 12345678910111213141516171819202122232425262728struct usb_driver &#123; const char *name; int (*probe) (struct usb_interface *intf, const struct usb_device_id *id); void (*disconnect) (struct usb_interface *intf); int (*unlocked_ioctl) (struct usb_interface *intf, unsigned int code, void *buf); int (*suspend) (struct usb_interface *intf, pm_message_t message); int (*resume) (struct usb_interface *intf); int (*reset_resume)(struct usb_interface *intf); int (*pre_reset)(struct usb_interface *intf); int (*post_reset)(struct usb_interface *intf); const struct usb_device_id *id_table; const struct attribute_group **dev_groups; struct usb_dynids dynids; struct usbdrv_wrap drvwrap; unsigned int no_dynamic_id:1; unsigned int supports_autosuspend:1; unsigned int disable_hub_initiated_lpm:1; unsigned int soft_unbind:1;&#125;; Itâ€™s a huge one, but we need not define all of them. What we need is just: 1234567891011static struct usb_driver ax88179_178a_driver = &#123; .name = \"ax88179_178a\", .id_table = products, .probe = usbnet_probe, .suspend = ax88179_suspend, .resume = ax88179_resume, .reset_resume = ax88179_resume, .disconnect = usbnet_disconnect, .supports_autosuspend = 1, .disable_hub_initiated_lpm = 1,&#125;; .name This is the name of driver, and it will be shown at the last line of the output of usb-devices. I got the output above by changing the name to ax88179_178a_inoki. struct usb_interface *intf We can see that many of fields are pointers to functions with an argument of type struct usb_interface *intf. Itâ€™s defined in include/linux/usb.h. 1234567891011121314151617181920212223242526272829struct usb_interface &#123; /* array of alternate settings for this interface, * stored in no particular order */ struct usb_host_interface *altsetting; struct usb_host_interface *cur_altsetting; /* the currently * active alternate setting */ unsigned num_altsetting; /* number of alternate settings */ /* If there is an interface association descriptor then it will list * the associated interfaces */ struct usb_interface_assoc_descriptor *intf_assoc; int minor; /* minor number this interface is * bound to */ enum usb_interface_condition condition; /* state of binding */ unsigned sysfs_files_created:1; /* the sysfs attributes exist */ unsigned ep_devs_created:1; /* endpoint \"devices\" exist */ unsigned unregistering:1; /* unregistration is in progress */ unsigned needs_remote_wakeup:1; /* driver requires remote wakeup */ unsigned needs_altsetting0:1; /* switch to altsetting 0 is pending */ unsigned needs_binding:1; /* needs delayed unbind/rebind */ unsigned resetting_device:1; /* true: bandwidth alloc after reset */ unsigned authorized:1; /* used for interface authorization */ struct device dev; /* interface specific device info */ struct device *usb_dev; struct work_struct reset_ws; /* for resets in atomic context */&#125;; With this parameter, we can distinguish which device is under operating. As well, it requires the caller pass a right reference ğŸ˜ƒ .probe = usbnet_probe The usbnet_probe is a function defined in include/linux/usb/usbnet.h. 1extern int usbnet_probe(struct usb_interface *, const struct usb_device_id *); When a device is plugged into the USB bus that matches the device ID that your driver registered with the USB core, the probe function is called, with the interface instance, and the device information. .disconnect = usbnet_disconnect Conversely, when the device is removed from the USB bus, the disconnect function is called with the device pointer. For this callback and the callback which will be used in probing, the driver uses the standard USB net functions in include/linux/usb/usbnet.h. 1extern void usbnet_disconnect(struct usb_interface *); There are lots of standard functions defined in this header file. But we cannot expect the standard stuff can handle with all devices. So, in most case, we need write our own handlers for specific devices. .suspend = ax88179_suspend Called when the device is going to be suspended by the system either from system sleep or runtime suspend context. This line can let the specific function suspend in the driver codebase be called. .resume = ax88179_resume and .reset_resume = ax88179_resume .resume will be called when the device is being resumed by the system. .reset_resume will be called when the suspended device has been reset instead of being resumed. Both two can let the specific function resume in the driver codebase be called. Registration Then, register the driver in the system. 1module_usb_driver(ax88179_178a_driver); Itâ€™s not a function, but a macro defined in include/linux/usb.h: 123#define module_usb_driver(__usb_driver) \\ module_driver(__usb_driver, usb_register, \\ usb_deregister) Then it will be expanded to a set of instructions in include/linux/device.h. 1234567891011#define module_driver(__driver, __register, __unregister, ...) \\static int __init __driver##_init(void) \\&#123; \\ return __register(&amp;(__driver) , ##__VA_ARGS__); \\&#125; \\module_init(__driver##_init); \\static void __exit __driver##_exit(void) \\&#123; \\ __unregister(&amp;(__driver) , ##__VA_ARGS__); \\&#125; \\module_exit(__driver##_exit); Such instructions can control the life cycle of a driver module. But weâ€™ll not go deeper into the module functions, becaus they are out of scope. Here, we come back to the module_usb_driver macro. Except __usb_driver is the specific driven instance, usb_register and usb_deregister could be also an interesting point in this post. In fact, they are defined in include/linux/usb.h as well: 123456789101112/* * use these in module_init()/module_exit() * and don't forget MODULE_DEVICE_TABLE(usb, ...) */extern int usb_register_driver(struct usb_driver *, struct module *, const char *);/* use a define to avoid include chaining to get THIS_MODULE &amp; friends */#define usb_register(driver) \\ usb_register_driver(driver, THIS_MODULE, KBUILD_MODNAME)extern void usb_deregister(struct usb_driver *); The 2 functions will be called while module is being initialized or is being exited. Core Functions After the module life cycle management, here we need talk more about the actions of driver, while there are arriving packets. Except vendor ID and product ID, there is also driver_info field which is set according to the different devices. 123456789&#123; /* ASIX AX88179 10/100/1000 */ USB_DEVICE(0x0b95, 0x1790), .driver_info = (unsigned long)&amp;ax88179_info,&#125;, &#123; /* ASIX AX88178A 10/100/1000 */ USB_DEVICE(0x0b95, 0x178a), .driver_info = (unsigned long)&amp;ax88178a_info,&#125; Driver Info We can take a look at the 0x0b95, 0x1790(AX88179) and 0x0b95, 0x178(AX88178A). The driver info is an unsigned long pointer to the struct driver_info instance. Thus, Linux kernel can find the driver info instance when it needs. The driver info structure is in fact a USB network driver info structure, defined in include/linux/usb/usbnet.h: 12345678910111213141516171819202122struct driver_info &#123; char *description; int flags; int (*bind)(struct usbnet *, struct usb_interface *); void (*unbind)(struct usbnet *, struct usb_interface *); int (*reset)(struct usbnet *); int (*stop)(struct usbnet *); int (*check_connect)(struct usbnet *); int (*manage_power)(struct usbnet *, int); void (*status)(struct usbnet *, struct urb *); int (*link_reset)(struct usbnet *); int (*rx_fixup)(struct usbnet *dev, struct sk_buff *skb); struct sk_buff *(*tx_fixup)(struct usbnet *dev, struct sk_buff *skb, gfp_t flags); void (*recover)(struct usbnet *dev); int (*early_init)(struct usbnet *dev); void (*indication)(struct usbnet *dev, void *ind, int indlen); void (*set_rx_mode)(struct usbnet *dev); int in; /* rx endpoint */ int out; /* tx endpoint */ unsigned long data; /* Misc driver specific data */&#125;; Just like the other huge structure, we will only use a small part of it. AX88179 Driver Info 123456789101112static const struct driver_info ax88179_info = &#123; .description = \"ASIX AX88179 USB 3.0 Gigabit Ethernet\", .bind = ax88179_bind, .unbind = ax88179_unbind, .status = ax88179_status, .link_reset = ax88179_link_reset, .reset = ax88179_reset, .stop = ax88179_stop, .flags = FLAG_ETHER | FLAG_FRAMING_AX, .rx_fixup = ax88179_rx_fixup, .tx_fixup = ax88179_tx_fixup,&#125;; AX88178a Driver Info 123456789101112static const struct driver_info ax88178a_info = &#123; .description = \"ASIX AX88178A USB 2.0 Gigabit Ethernet\", .bind = ax88179_bind, .unbind = ax88179_unbind, .status = ax88179_status, .link_reset = ax88179_link_reset, .reset = ax88179_reset, .stop = ax88179_stop, .flags = FLAG_ETHER | FLAG_FRAMING_AX, .rx_fixup = ax88179_rx_fixup, .tx_fixup = ax88179_tx_fixup,&#125;; .flags In flags, we might have several bitwise flag. This is created for some special feature of each device. In these two devices, we have Ethernet device feature and ASIX specific device features. 12#define FLAG_ETHER 0x0020 /* maybe use \"eth%d\" names */#define FLAG_FRAMING_AX 0x0040 /* AX88772/178 packets */ Lifecycle-related sequence System will call the function pointed by .bind to initialize device. The one pointed by .unbind will be called to do a cleanup in the system. To reset device, system will call .reset. To actively stop device, .stop will be invoked. Linux will also use .status to query the device satus. And .link_reset can be called for link reset handling purpose. These functions are so long and so device-specific that we do not need to concentrate on them. The most important functionality is transmission of packets, which is implemented by .rx_fixup(for receiving), and .tx_fixup(for sending). .rx_fixup The function pointed by .rx_fixup works on doing frame stripping. Whatâ€™s frame stripping? These are two screenshots of an ARP network packet in USB traffic(above) and in Ethernet traffic(below), captured by Wireshark. We can see that the highlighted part, from 0042 to 0079 in USB traffic, is exactly the same thing. So, what has RX fixup done is clear: it tries to extract the Ethernet packet from a USB frame. Function Prototype 1static int ax88179_rx_fixup(struct usbnet *dev, struct sk_buff *skb); The function accepts two parameters, one is the deivce, the other is the data received. The type struct sk_buff is defined in include/linux/skbuff.h, and is widely used in the network modules. Itâ€™s the abbreviation of socket buffer. Implementation on mainline In this chapter, weâ€™ll take a look at every lines of this function on Linux Kernel mainline. First, complying to C89, all of variables should be declared at the beginning of the scope block. 12345struct sk_buff *ax_skb;int pkt_cnt;u32 rx_hdr;u16 hdr_off;u32 *pkt_hdr; ax_skb is a pointer which can point to a new socket buffer instance. pkt_cnt is the counter of packet, which counts how many packets are there in the packet. rx_hdr can represent the header of the USB packet that we received, this variable is a 32 bits one, or 4 bytes or 4 octets. pkt_hdr is a pointer to unsigned 32 bits integer, literally it can point to the header of packet. hdr_off is an unsigned 16 bits integer, which records the offset of real header. 123/* This check is no longer done by usbnet */if (skb-&gt;len &lt; dev-&gt;net-&gt;hard_header_len) return 0; In current version, the driver should check the length is compliable with the device or not. return 0 means that the packet isnâ€™t handled correctly. And then, it uses skb_trim to cut the last 4 bytes, reduce the length and calculate other fields in the structure. 1skb_trim(skb, skb-&gt;len - 4); To know better how it works, we can take the previous packet to make an example: With the trim function, the last 01 00 04 00 should be dropped. 12memcpy(&amp;rx_hdr, skb_tail_pointer(skb), 4);le32_to_cpus(&amp;rx_hdr); But in fact, they are not totally dropper, the data is still their. The next step is rightly copying them into rx_hdr, with correspondant byte order. For example, my Linux is x86_64, so with little-endian. And the 01 00 is exactly 0x0001 in our brain. So, the number should be 00 40 00 01. 12pkt_cnt = (u16)rx_hdr;hdr_off = (u16)(rx_hdr &gt;&gt; 16); Then, with some magic, we can assign the packet counter pkt_cnt and the header offset hdr_off. With the humain readable representation 00 40 00 01, we could see there is one packet and the offset is 64 bytes (0x40 in decimal). 1pkt_hdr = (u32 *)(skb-&gt;data + hdr_off); Weâ€™ll have the header of the packet with pkt_hdr variable. In our case, it will point at a byte which has 0x40 offset from the beginning of the packet. We should notice that, the packet begins at 0x40, so, with the offset, it should point at 0x80, where there are 00 88 3e 00. Then, weâ€™ill attemp to iterately get all network packets in this single USB packet. 1while (pkt_cnt--) &#123; As usual, do the initialization at first. We will extract the length of each packet to pkt_len. 12u16 pkt_len;le32_to_cpus(pkt_hdr); Extract packet length. 1pkt_len = (*pkt_hdr &gt;&gt; 16) &amp; 0x1fff; Here, we should have 00 3e 00 88 as the human readable order. So, the packet length should be 0x3e -&gt; 62 bytes. If we look at the USB-Net packet capture, we could know itâ€™s correct! 1234567/* Check CRC or runt packet */if ((*pkt_hdr &amp; AX_RXHDR_CRC_ERR) || (*pkt_hdr &amp; AX_RXHDR_DROP_ERR)) &#123; skb_pull(skb, (pkt_len + 7) &amp; 0xFFF8); pkt_hdr++; continue;&#125; If AX_RXHDR_CRC_ERR or AX_RXHDR_DROP_ERR is set, just drop this packet because itâ€™s not what we want. We only care the network packet. 12#define AX_RXHDR_CRC_ERR ((u32)BIT(29))#define AX_RXHDR_DROP_ERR ((u32)BIT(31)) The two flags are defined at the top of source code file. We can see in our packet, the 29th bit and the 31st bit are both 0. So, just ignore the code mentioned above. We continue. 123456789if (pkt_cnt == 0) &#123; /* Skip IP alignment psudo header */ skb_pull(skb, 2); skb-&gt;len = pkt_len; skb_set_tail_pointer(skb, pkt_len); skb-&gt;truesize = pkt_len + sizeof(struct sk_buff); ax88179_rx_checksum(skb, pkt_hdr); return 1;&#125; If we are handling the last packet, firstly we remove the first two bytes. They are two 0xee at the beginning. In this function, the length will also be reduced by 2. But itâ€™s not the pkt_len, itâ€™s the length field in the socket buffer instance which is reduced. Then, we update the length to the right length of Network Packet and do some cleanup work. Then the stripped frame will be used by the system, as a network packet. Note: only the last packet will be â€œreturnedâ€ by the origin socket buffer. But if we take a look at the end of the network packet, there are serveral bytes which are not used by the protocol itself. This will lead an error, Iâ€™ll talk about it in the next post. 1234567891011121314ax_skb = skb_clone(skb, GFP_ATOMIC);if (ax_skb) &#123; ax_skb-&gt;len = pkt_len; ax_skb-&gt;data = skb-&gt;data + 2; skb_set_tail_pointer(ax_skb, pkt_len); ax_skb-&gt;truesize = pkt_len + sizeof(struct sk_buff); ax88179_rx_checksum(ax_skb, pkt_hdr); usbnet_skb_return(dev, ax_skb);&#125; else &#123; return 0;&#125;skb_pull(skb, (pkt_len + 7) &amp; 0xFFF8);pkt_hdr++; Finally in the loop, we know that there are still several network packets in the USB packet. So we try to clone the raw packet, regulate the boundary, and return it by usbnet_skb_return function. If there are still packets to be handled, go on. 1&#125; Otherwise, the loop ends. 1return 1; In the end, if we reach here, it means there are not any more the packets to be handled. So, it â€œreportsâ€ to the system that weâ€™ve finished succefully. .tx_fixup After analysis of RX fixup, what TX fixup should do is obvious. It just wrapped the raw paquet into a USB frame, and send it to the device. The device will send it to the other side. Function Prototype 12static struct sk_buff *ax88179_tx_fixup(struct usbnet *dev, struct sk_buff *skb, gfp_t flags) The two first parameters have the same type, and the same usage as the two in RX fixup. The last one is a set of flags, but itâ€™s not used in the implementation. So, we neglict it. Implementation on mainline 123456u32 tx_hdr1, tx_hdr2;int frame_size = dev-&gt;maxpacket;int mss = skb_shinfo(skb)-&gt;gso_size;int headroom;tx_hdr1 = skb-&gt;len;tx_hdr2 = mss; Declarations and initializations of variables. 1234if (((skb-&gt;len + 8) % frame_size) == 0) tx_hdr2 |= 0x80008000; /* Enable padding */headroom = skb_headroom(skb) - 8; skb_headroom returns the number of bytes of free space at the head of an sk_buff. So, this is a boundary check for adding more bytes. 12345if ((skb_header_cloned(skb) || headroom &lt; 0) &amp;&amp; pskb_expand_head(skb, headroom &lt; 0 ? 8 : 0, 0, GFP_ATOMIC)) &#123; dev_kfree_skb_any(skb); return NULL;&#125; If our socket buffer is a clone or we have no more space to store stuff, weâ€™ll fail to send. 123skb_push(skb, 4);cpu_to_le32s(&amp;tx_hdr2);skb_copy_to_linear_data(skb, &amp;tx_hdr2, 4); Append the flag to the current end of packet. 123skb_push(skb, 4);cpu_to_le32s(&amp;tx_hdr1);skb_copy_to_linear_data(skb, &amp;tx_hdr1, 4); Copy the length to the end of packet. 1return skb; Return the instance. Conclusion By analyzing this codebase, we should be able to know how a USB network device works. In the next post, Iâ€™ll talk about the serious bug which is found in this driver. See you!","categories":[{"name":"Source Code","slug":"Source-Code","permalink":"https://blog.inoki.cc/categories/Source-Code/"},{"name":"Linux Driver","slug":"Source-Code/Linux-Driver","permalink":"https://blog.inoki.cc/categories/Source-Code/Linux-Driver/"},{"name":"USB-Net","slug":"Source-Code/Linux-Driver/USB-Net","permalink":"https://blog.inoki.cc/categories/Source-Code/Linux-Driver/USB-Net/"},{"name":"Linux Driver","slug":"Linux-Driver","permalink":"https://blog.inoki.cc/categories/Linux-Driver/"}],"tags":[{"name":"Linux","slug":"Linux","permalink":"https://blog.inoki.cc/tags/Linux/"},{"name":"Linux Driver","slug":"Linux-Driver","permalink":"https://blog.inoki.cc/tags/Linux-Driver/"},{"name":"ASIX","slug":"ASIX","permalink":"https://blog.inoki.cc/tags/ASIX/"}]},{"title":"Install Linux QQ on ChromeOS","slug":"Install-linux-QQ-on-chromeos","date":"2019-12-08T22:38:00.000Z","updated":"2025-03-08T09:40:48.568Z","comments":true,"path":"2019/12/08/Install-linux-QQ-on-chromeos/","link":"","permalink":"https://blog.inoki.cc/2019/12/08/Install-linux-QQ-on-chromeos/","excerpt":"","text":"Recently, Tencent has updated and released their out-of-date QQ client for Linux, on their official Linux QQ website. Meanwhile, Chrome OS has already an experimental feature: Linux subsystem, which is equipped with a Linux distro named Penguin, under Debian. So, installing the full-featured desktop QQ on Chrome OS can be interesting. Get the right package We can see that, there are several options on the download page. But which one should we choose ? It depends on the architecture of your Chrome Book. We need to recognise it to choose the right version. So, firstly, we need to check the archtecture. Architecture Open your Linux terminal and run the uname -m command. My output is like this: 12&gt; uname -mx86_64 Intel processor: x86_64 Here I have x86_64. If yours is same with mine, fortunately, we can directly download the deb in the x64 line. As well, if yours is amd64 or i686, you should be able to use the same package. It means you have Intel/AMD x86 processor and the machine is running in 64 bit mode. If you have x86 processor, but youâ€™ve got something like i386, you may have a wrong version Chrome OS. Please check it! ARM 64 bits processor: aarch64 If youâ€™ve got one of these: aarch64 arm64 You should be able to use deb in the ARM64 line. The string arm64 was created by Apple for its 64 bits ARM processor. But itâ€™s not an official name of ARM 64 processors. Apple finally removed it and adopts aarch64, see here. But maybe itâ€™s still being used by some machines somewhere. So, if you have one of them, just choose one in the ARM64 line. mips 64 bits, little endian processor: mips64el If youâ€™ve seen mips64el, unfortunately, you need choose the only version in the MIPS64 line. If youâ€™ve seen only mips, you cannot use any version on that page. We donâ€™t have either the source code. So, explain to Tencent ğŸ˜ƒ Format The distro penguin is one based on Debain, so the easiest way is to download deb file. But, considering the mips processor, some people may need use the shell script, because of missing of deb. Dependence Before installing, we need prepare the dependence of it. It requires gtk 2.0 library to run the GUI. On Debian distro like Penguin, just run 1&gt; sudo apt install libgtk2.0-0 Well done! Install Itâ€™s very simple to install it. Just open a terminal, and find the instruction for your format. deb To install deb file, just run 1&gt; sudo dpkg -i linuxqq_1.0.1-b1-100_&lt;arch&gt;.deb or 1&gt; sudo apt install -y /path/to/linuxqq_1.0.1-b1-100_&lt;arch&gt;.deb shell To install shell, just run 1&gt; sudo ./linuxqq_1.0.1-b1-100_&lt;arch&gt;.sh The script will create a tarball and extract it to your system. Run Run linuxqq in the terminal or click on the icon in your Chrome OS to launch it. Problem of character displaying You may see that in the picture, there are lots of characters which are not being shown correctly. Because in the Linux distro, there is not chinese font to show them. We can install a chinese font to display them correctly. 1&gt; sudo apt-get install ttf-wqy-zenhei ttf-wqy-microhei Rerun After installation, run it: Itâ€™s okay! Enjoy!","categories":[{"name":"Chrome OS","slug":"Chrome-OS","permalink":"https://blog.inoki.cc/categories/Chrome-OS/"}],"tags":[{"name":"Chrome OS","slug":"Chrome-OS","permalink":"https://blog.inoki.cc/tags/Chrome-OS/"}]},{"title":"ã€è¯‘ã€‘Python è„šæœ¬å¯¼è‡´æ•°ä»¥ç™¾è®¡çš„è®ºæ–‡æ— æ•ˆ","slug":"Python-invalidate-hundreds-of-papers","date":"2019-10-22T22:59:24.000Z","updated":"2025-03-08T09:40:48.592Z","comments":true,"path":"2019/10/22/Python-invalidate-hundreds-of-papers/","link":"","permalink":"https://blog.inoki.cc/2019/10/22/Python-invalidate-hundreds-of-papers/","excerpt":"","text":"åŸæ–‡é“¾æ¥ï¼šhttps://i-programmer.info/news/231-methodology/13188-python-script-invalidates-hundreds-of-papers.html è¯¥æ–°é—»ä¹‹æ‰€ä»¥æœ‰è¶£ï¼Œä¸ä»…æ˜¯å› ä¸ºå®ƒç»™æˆ‘ä»¬æ‰€æœ‰äººä¸Šäº†ä¸€è¯¾ï¼Œè¿˜å› ä¸ºå®ƒè¢«æŠ¥é“ä¸ºâ€œ Bug In Python Script â€¦â€ï¼Œå¹¶æš—ç¤º Python æ˜¯é—®é¢˜çš„èµ·å› ã€‚å®é™…ä¸Šï¼ŒçœŸç›¸æ›´åŠ æœ‰è¶£ã€‚ è¯¥è„šæœ¬å¤§çº¦æ˜¯æœ‰ 1000 è¡Œ Python ä»£ç ï¼Œå®ƒä¸æ˜¯ä¸€ä¸ªå°ç¨‹åºã€‚è¿™ä¸ªç”± Patrick Willoughbyï¼ŒMatthew Jansma å’Œ Thomas Hoye åˆ›å»ºçš„è„šæœ¬ï¼Œè‡ª 2014 å¹´ä»¥æ¥ä¸€ç›´åœ¨ä½¿ç”¨ï¼Œç”¨æ¥è·å–åŸå§‹æ•°æ®å¹¶è®¡ç®— NMR ä½ç§»ã€‚åœ¨ã€Šè‡ªç„¶åè®®ã€‹æ‚å¿—ä¸­ï¼Œå®ƒè¢«ç§°ä¸ºâ€œWilloughby-Hoyeâ€è„šæœ¬ã€‚ åŸæœ¬ä¸€åˆ‡éƒ½æ­£å¸¸ï¼Œç›´åˆ°å¤å¨å¤·å¤§å­¦çš„ç ”ç©¶äººå‘˜æ³¨æ„åˆ°å½“åœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿä¸Šè¿è¡Œç›¸åŒçš„æ•°æ®å’Œè„šæœ¬æ—¶ï¼Œä»–ä»¬å¾—åˆ°äº†ä¸åŒçš„ç»“æœã€‚ Windows å’Œä¸€ä¸ªç‰ˆæœ¬çš„ MacOS ç»™å‡ºäº†æ­£ç¡®çš„ç­”æ¡ˆï¼Œä½†å¦ä¸€ä¸ªç‰ˆæœ¬çš„ MacOS å’Œ Ubuntu ç»™å‡ºäº†é”™è¯¯çš„ç»“æœã€‚è¿™ä¸æ˜¯æ‚¨å¯¹é”™è¯¯çš„é¢„æœŸè¡Œä¸ºï¼šé”™è¯¯é€šå¸¸ä¸ä»…åœ¨æŸäº›ç¯å¢ƒä¸­æœ‰ï¼Œè€Œæ˜¯åœ¨ä»»ä½•ç¯å¢ƒä¸­éƒ½å­˜åœ¨ã€‚ é‚£ä¹ˆï¼Œæ˜¯ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ é—®é¢˜ä¸€ç›´è¢«è¿½æº¯åˆ°æ•°æ®æ£€ç´¢çš„æ–¹å¼ã€‚æ¯æ¬¡è¿è¡Œçš„æ•°æ®éƒ½å­˜å‚¨åœ¨ä¸¤ä¸ªæ–‡ä»¶ä¸­ã€‚è¿™äº›æ–‡ä»¶æ˜¯æŒ‰æ–‡ä»¶åæˆå¯¹æ£€ç´¢å¹¶æˆå¯¹å¤„ç†çš„ã€‚é—®é¢˜åœ¨äºï¼Œæ–‡ä»¶çš„æ£€ç´¢é¡ºåºæ ¹æ®æ“ä½œç³»ç»Ÿè€Œä¸åŒã€‚åªè¦æ–‡ä»¶å¯¹åŒ¹é…ï¼Œæ‚¨å°±å¯ä»¥è·å¾—æ­£ç¡®çš„ç»“æœã€‚å¦‚æœæ²¡æœ‰é…å¯¹ï¼Œå°†ä¼šå¤„ç†ä¸¤æ¬¡ä¸åŒè¿è¡Œä¸­äº§ç”Ÿçš„æ•°æ®ã€‚ è®¸å¤šæ–°é—»æŠ¥é“çš„ç½ªé­ç¥¸é¦–æ˜¯ Python æ ‡å‡†åº“æ¨¡å— globï¼Œå®ƒå°†è¿”å›ä¸æ–‡ä»¶/è·¯å¾„è§„èŒƒåŒ¹é…çš„æ–‡ä»¶åˆ—è¡¨ï¼ŒåŒ…æ‹¬é€šé…ç¬¦ã€‚å®ƒå¯ä»¥å·¥ä½œï¼Œä½†æ˜¯æ²¡æœ‰æŒ‰æŒ‡å®šé¡ºåºè¿”å›ç»“æœã€‚è¿™æ˜¯é”™è¯¯å—ï¼Ÿå¹¶ä¸æ˜¯çš„ã€‚ glob çš„æ–‡æ¡£çš„ç¬¬ä¸€å¥è¯å°±æ˜¯ï¼š â€œå°½ç®¡ç»“æœä»¥ä»»æ„é¡ºåºè¿”å›ï¼Œä½† glob æ¨¡å—æ ¹æ® Unix shell ä½¿ç”¨çš„è§„åˆ™æŸ¥æ‰¾ä¸æŒ‡å®šæ¨¡å¼åŒ¹é…çš„æ‰€æœ‰è·¯å¾„åã€‚â€ å› æ­¤ï¼Œè¿™å‡ ä¹ä¸æ˜¯é”™è¯¯ã€‚ä¹‹åæ€ä¹ˆæ ·äº†ï¼Ÿæ­£å¼çš„ç”¨æˆ·ï¼ˆä»»åŠ¡ä¸æ˜¯ç¼–ç¨‹çš„ç¼–ç¨‹äººå‘˜ï¼‰ç»å¸¸å¯¹ä»€ä¹ˆæ˜¯åˆç†çš„åšå‡ºå‡è®¾ï¼Œè€Œä¸è€ƒè™‘ä¸ç¼–å†™å¥å£®ä»£ç çš„åæœã€‚é€šè¿‡ä»¥ç²—ä½“æ˜¾ç¤ºâ€œä»¥ä»»æ„é¡ºåºè¿”å›â€ï¼Œæ–‡æ¡£æ˜¯å¦å¯¹æ‰€æœ‰äººéƒ½æœ‰ç”¨ï¼Ÿæ‰§è¡Œç‰¹å®šå‘½ä»¤è€Œä¸æ˜¯å°†å…¶ä¿ç•™ä¸ºæœªå®šä¹‰çš„è¡Œä¸ºä¼šæ›´åˆç†å—ï¼ŸæŸäº›æ“ä½œç³»ç»Ÿä¼¼ä¹è¿”å›æ’åºåˆ—è¡¨è€Œä½¿é—®é¢˜æ›´åŠ å¤æ‚ï¼Œå› æ­¤åº”å½“ç¡®è®¤ç”¨æˆ·çš„å‡è®¾ã€‚æ“ä½œç³»ç»Ÿæ˜¯å¦åº”è¯¥ä»˜å‡ºæ›´å¤šåŠªåŠ›ä»¥ä½¿åˆ—è¡¨ä»¥ä»»æ„é¡ºåºè¿”å›ï¼Ÿ ä»æœªå®šä¹‰çš„è¡Œä¸ºçš„è§’åº¦ä¸Šæ¥è¯´ï¼Œè¿™ä¸ªé—®é¢˜ä¹Ÿè®¸å¹¶ä¸æ˜¯ä»»ä½•äººçš„é”™ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸è¿”å›æ’åºåˆ—è¡¨çš„åŸå› æ˜¯æ•ˆç‡ï¼šå¦‚æœå¾ˆå¤šç”¨æˆ·ä¸éœ€è¦å¯¹åˆ—è¡¨è¿›è¡Œæ’åºï¼Œä¸ºä»€ä¹ˆè¿˜è¦å¯¹åˆ—è¡¨è¿›è¡Œæ’åºï¼Ÿ æ‚¨å¯ä»¥è¯´ï¼Œæ›´å¥½çš„ç¼–ç¨‹æŠ€èƒ½ä¼šæœ‰æ‰€å¸®åŠ©ã€‚ä¾‹å¦‚ï¼ŒåŒ…æ‹¬ä¸€äº›æµ‹è¯•å¯èƒ½ä¼šå‘ç°é—®é¢˜æ‰€åœ¨ï¼Œä½†æ˜¯ä¼šå—ï¼Ÿå¦‚æœæ‚¨è¦ç¼–å†™æµ‹è¯•ï¼Œåˆ™éœ€è¦äº†è§£æ‚¨çš„å‡è®¾ï¼Œå¦‚æœç¨‹åºå‘˜çŸ¥é“æ­¤å…³é”®å‡è®¾ï¼Œä»–ä»¬ä¼šæ³¨æ„åˆ°æ–‡æ¡£ä¸­çš„ç¬¬ä¸€å¥è¯å¹¶é¿å…ä½¿ç”¨å®ƒã€‚ä¸ºæ‚¨çŸ¥é“å¿…é¡»æ˜¯çœŸå®çš„äº‹æƒ…ç¼–å†™æµ‹è¯•éœ€è¦å¤§é‡çš„æ ‡å‡†å’Œå‡†åˆ™ã€‚ æˆ‘ä»¬å¦‚ä½•å‡å°‘å†æ¬¡å‘ç”Ÿè¿™ç§æƒ…å†µçš„å¯èƒ½æ€§å‘¢ï¼Ÿ","categories":[{"name":"Translation","slug":"Translation","permalink":"https://blog.inoki.cc/categories/Translation/"},{"name":"Chinese","slug":"Translation/Chinese","permalink":"https://blog.inoki.cc/categories/Translation/Chinese/"}],"tags":[{"name":"ç¿»è¯‘","slug":"ç¿»è¯‘","permalink":"https://blog.inoki.cc/tags/ç¿»è¯‘/"},{"name":"ä¸­æ–‡","slug":"ä¸­æ–‡","permalink":"https://blog.inoki.cc/tags/ä¸­æ–‡/"}]},{"title":"Python Source Code Analysis (1)","slug":"Python-code-analyse-1","date":"2019-10-21T16:49:40.000Z","updated":"2025-03-08T09:40:48.591Z","comments":true,"path":"2019/10/21/Python-code-analyse-1/","link":"","permalink":"https://blog.inoki.cc/2019/10/21/Python-code-analyse-1/","excerpt":"","text":"In this post, we will take a dissecion of source code of Python. To benefit the simplicity and meanwhile follow the most recent functionnalities, I choose Python 3.6.9 to do the analysis. In the last post, the entry of Python is found, so itâ€™s time to look at it! Py_Main - the Python Main function According to C89 standard, in a C function, all the variables should be declared at the beginning. So, we can take a look at those variables. Variables The variables are listed below, though weâ€™ll not explicite them at the moment. 1234567891011121314151617181920 int c; int sts; wchar_t *command = NULL; wchar_t *filename = NULL; wchar_t *module = NULL; FILE *fp = stdin; char *p;#ifdef MS_WINDOWS wchar_t *wp;#endif int skipfirstline = 0; int stdin_is_interactive = 0; int help = 0; int version = 0; int saw_unbuffered_flag = 0; char *opt; PyCompilerFlags cf; PyObject *main_importer_path = NULL; PyObject *warning_option = NULL; PyObject *warning_options = NULL; Arguments Then, after listing and initializing all variables, Python will try to find flags in the arguments. First, Python tries to find some options which are needed by some initializations. 12345678910111213/* Hash randomization needed early for all string operations (including -W and -X options). */while ((c = _PyOS_GetOpt(argc, argv, PROGRAM_OPTS)) != EOF) &#123; if (c == 'm' || c == 'c') &#123; /* -c / -m is the last option: following arguments are not interpreter options. */ break; &#125; if (c == 'E') &#123; Py_IgnoreEnvironmentFlag++; break; &#125;&#125; PROGRAM_OPTS is defined as BASE_OPTS, and #define BASE_OPTS L&quot;bBc:dEhiIJm:OqRsStuvVW:xX:?&quot; is at the header of main.c. _PyOS_GetOpt is implemented in Python/getopt.c, which validates and returns argument option. If an option is not in PROGRAM_OPTS, a _ will be returned. It will not accept --argument and returns a -1 if an argument with that form is found. In these lines, only options E, m, c are detected: if E is detected, the flag which leads to the negligence of PYTHONPATH, PYTHONHOME environment variables. once m or c is detected, following parameters should be the name of module(for m option) or the command that will be executed(for c option). So we terminated this loop. Then, Python gets the PYTHONMALLOC variables and tries to use it to setup allocators. 123456opt = Py_GETENV(\"PYTHONMALLOC\");if (_PyMem_SetupAllocators(opt) &lt; 0) &#123; fprintf(stderr, \"Error in PYTHONMALLOC: unknown allocator \\\"%s\\\"!\\n\", opt); exit(1);&#125; Valid allocators are pymalloc, pymalloc_debug, malloc, malloc_debug and debug. If youâ€™d like to get more about them, Objects/obmalloc.c is a good place. And then Python does an initialization of Random module. In this module, PYTHONHASHSEED can be used to initialize random module. And it resets warning options, resets option parsing process to process all options. 12345678_PyRandom_Init();PySys_ResetWarnOptions();_PyOS_ResetGetOpt();while ((c = _PyOS_GetOpt(argc, argv, PROGRAM_OPTS)) != EOF) &#123; // ...&#125; We finally enter the period to parse all arguments. They will be explicited in order. Option c -c cmd : program passed in as string (terminates option list)` 12345678910111213141516if (c == 'c') &#123; size_t len; /* -c is the last option; following arguments that look like options are left for the command to interpret. */ len = wcslen(_PyOS_optarg) + 1 + 1; command = (wchar_t *)PyMem_RawMalloc(sizeof(wchar_t) * len); if (command == NULL) Py_FatalError( \"not enough memory to copy -c argument\"); wcscpy(command, _PyOS_optarg); command[len - 2] = '\\n'; command[len - 1] = 0; break;&#125; If we encounter an c option, all other arguments will be neglected. The following argument will be parsed as the commands to be run. Option m -m mod : run library module as a script (terminates option list) 1234567if (c == 'm') &#123; /* -m is the last option; following arguments that look like options are left for the module to interpret. */ module = _PyOS_optarg; break;&#125; If we encounter an m option, all other arguments will be neglected. The following argument will be parsed as the module to be run. Other options 1234567891011121314151617181920212223-B : don&apos;t write .py[co] files on import; also PYTHONDONTWRITEBYTECODE=x-d : debug output from parser; also PYTHONDEBUG=x-E : ignore PYTHON* environment variables (such as PYTHONPATH)-h : print this help message and exit (also --help)-i : inspect interactively after running script; forces a prompt even if stdin does not appear to be a terminal; also PYTHONINSPECT=x-O : optimize generated bytecode slightly; also PYTHONOPTIMIZE=x-OO : remove doc-strings in addition to the -O optimizations-R : use a pseudo-random salt to make hash() values of various types be unpredictable between separate invocations of the interpreter, as a defense against denial-of-service attacks-Q arg : division options: -Qold (default), -Qwarn, -Qwarnall, -Qnew-s : don&apos;t add user site directory to sys.path; also PYTHONNOUSERSITE-S : don&apos;t imply &apos;import site&apos; on initialization-t : issue warnings about inconsistent tab usage (-tt: issue errors)-u : unbuffered binary stdout and stderr; also PYTHONUNBUFFERED=x see man page for details on internal buffering relating to &apos;-u&apos;-v : verbose (trace import statements); also PYTHONVERBOSE=x can be supplied multiple times to increase verbosity-V : print the Python version number and exit (also --version)-W arg : warning control; arg is action:message:category:module:lineno also PYTHONWARNINGS=arg-x : skip first line of source, allowing use of non-Unix forms of #!cmd 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100switch (c) &#123;case 'b': Py_BytesWarningFlag++; break;case 'd': Py_DebugFlag++; break;case 'i': Py_InspectFlag++; Py_InteractiveFlag++; break;case 'I': Py_IsolatedFlag++; Py_NoUserSiteDirectory++; Py_IgnoreEnvironmentFlag++; break;/* case 'J': reserved for Jython */case 'O': Py_OptimizeFlag++; break;case 'B': Py_DontWriteBytecodeFlag++; break;case 's': Py_NoUserSiteDirectory++; break;case 'S': Py_NoSiteFlag++; break;case 'E': /* Already handled above */ break;case 't': /* ignored for backwards compatibility */ break;case 'u': Py_UnbufferedStdioFlag = 1; saw_unbuffered_flag = 1; break;case 'v': Py_VerboseFlag++; break;case 'x': skipfirstline = 1; break;case 'h':case '?': help++; break;case 'V': version++; break;case 'W': if (warning_options == NULL) warning_options = PyList_New(0); if (warning_options == NULL) Py_FatalError(\"failure in handling of -W argument\"); warning_option = PyUnicode_FromWideChar(_PyOS_optarg, -1); if (warning_option == NULL) Py_FatalError(\"failure in handling of -W argument\"); if (PyList_Append(warning_options, warning_option) == -1) Py_FatalError(\"failure in handling of -W argument\"); Py_DECREF(warning_option); break;case 'X': PySys_AddXOption(_PyOS_optarg); break;case 'q': Py_QuietFlag++; break;case 'R': /* Ignored */ break;/* This space reserved for other options */default: return usage(2, argv[0]); /*NOTREACHED*/&#125; Actions and behaviors After recording all options in specified flags, Python can handle them with a determined order or a determined prority (if actions are incompatible). Help, Version 1234567if (help) return usage(0, argv[0]);if (version) &#123; printf(\"Python %s\\n\", version &gt;= 2 ? Py_GetVersion() : PY_VERSION); return 0;&#125; The option for help has the highest priority, then the option for the version. If they occured, Python will directly terminate after executing their proper actions. Sync with env Then, Python tries to get env 12345678910if (!Py_InspectFlag &amp;&amp; (p = Py_GETENV(\"PYTHONINSPECT\")) &amp;&amp; *p != '\\0') Py_InspectFlag = 1;if (!saw_unbuffered_flag &amp;&amp; (p = Py_GETENV(\"PYTHONUNBUFFERED\")) &amp;&amp; *p != '\\0') Py_UnbufferedStdioFlag = 1;if (!Py_NoUserSiteDirectory &amp;&amp; (p = Py_GETENV(\"PYTHONNOUSERSITE\")) &amp;&amp; *p != '\\0') Py_NoUserSiteDirectory = 1; One thing should be noticed is that, Py_GETENV is a macro like this: 1#define Py_GETENV(s) (Py_IgnoreEnvironmentFlag ? NULL : getenv(s)) which will actually return NULL if the flag Py_IgnoreEnvironmentFlag is not zero. The flag is set by -E option. I think this is a good design. Parse warning option Python then uses the code below to parse warning option in different systems, since they might have different default character sets. 123456789101112#ifdef MS_WINDOWS// ...#else// ...#endifif (warning_options != NULL) &#123; Py_ssize_t i; for (i = 0; i &lt; PyList_GET_SIZE(warning_options); i++) &#123; PySys_AddWarnOptionUnicode(PyList_GET_ITEM(warning_options, i)); &#125;&#125; At the end, add them to Python warning option list. Get script file name Get filename if no command, no module, the arguments are not all read, and the current argument is not -. 12345if (command == NULL &amp;&amp; module == NULL &amp;&amp; _PyOS_optind &lt; argc &amp;&amp; wcscmp(argv[_PyOS_optind], L\"-\") != 0)&#123; filename = argv[_PyOS_optind];&#125; Check interactivity of current terminal 1234567891011121314151617181920stdin_is_interactive = Py_FdIsInteractive(stdin, (char *)0);// Python/pylifecycle.c/* * The file descriptor fd is considered ``interactive'' if either * a) isatty(fd) is TRUE, or * b) the -i flag was given, and the filename associated with * the descriptor is NULL or \"&lt;stdin&gt;\" or \"???\". */intPy_FdIsInteractive(FILE *fp, const char *filename)&#123; if (isatty((int)fileno(fp))) return 1; if (!Py_InteractiveFlag) return 0; return (filename == NULL) || (strcmp(filename, \"&lt;stdin&gt;\") == 0) || (strcmp(filename, \"???\") == 0);&#125; So, stdin is always interactive. Play with buffers Use -u option to disable input/ouput buffer in Python. This can resolve some problem if youâ€™d like to use pipe as the input or the output of a Python program. 1234567891011if (Py_UnbufferedStdioFlag) &#123;#ifdef HAVE_SETVBUF setvbuf(stdin, (char *)NULL, _IONBF, BUFSIZ); setvbuf(stdout, (char *)NULL, _IONBF, BUFSIZ); setvbuf(stderr, (char *)NULL, _IONBF, BUFSIZ);#else /* !HAVE_SETVBUF */ setbuf(stdin, (char *)NULL); setbuf(stdout, (char *)NULL); setbuf(stderr, (char *)NULL);#endif /* !HAVE_SETVBUF */&#125; If Py_UnbufferedStdioFlag is not set, but weâ€™ll enter the interactive mode, do not either use the input/output buffer. 12345678910111213else if (Py_InteractiveFlag) &#123;#ifdef MS_WINDOWS /* Doesn't have to have line-buffered -- use unbuffered */ /* Any set[v]buf(stdin, ...) screws up Tkinter :-( */ setvbuf(stdout, (char *)NULL, _IONBF, BUFSIZ);#else /* !MS_WINDOWS */#ifdef HAVE_SETVBUF setvbuf(stdin, (char *)NULL, _IOLBF, BUFSIZ); setvbuf(stdout, (char *)NULL, _IOLBF, BUFSIZ);#endif /* HAVE_SETVBUF */#endif /* !MS_WINDOWS */ /* Leave stderr alone - it should be unbuffered anyway. */&#125; Play with program name Python wants to set itself as the program name through Py_SetProgramName function. Itâ€™s a simple function, but on macOS, the Python interpreter can be in an App package rather than a bare environment. So, it requires lots of lines to retrieve the program name. 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051#ifdef __APPLE__ /* On MacOS X, when the Python interpreter is embedded in an application bundle, it gets executed by a bootstrapping script that does os.execve() with an argv[0] that's different from the actual Python executable. This is needed to keep the Finder happy, or rather, to work around Apple's overly strict requirements of the process name. However, we still need a usable sys.executable, so the actual executable path is passed in an environment variable. See Lib/plat-mac/bundlebuiler.py for details about the bootstrap script. */ if ((p = Py_GETENV(\"PYTHONEXECUTABLE\")) &amp;&amp; *p != '\\0') &#123; wchar_t* buffer; size_t len = strlen(p) + 1; buffer = PyMem_RawMalloc(len * sizeof(wchar_t)); if (buffer == NULL) &#123; Py_FatalError( \"not enough memory to copy PYTHONEXECUTABLE\"); &#125; mbstowcs(buffer, p, len); Py_SetProgramName(buffer); /* buffer is now handed off - do not free */ &#125; else &#123;#ifdef WITH_NEXT_FRAMEWORK char* pyvenv_launcher = getenv(\"__PYVENV_LAUNCHER__\"); if (pyvenv_launcher &amp;&amp; *pyvenv_launcher) &#123; /* Used by Mac/Tools/pythonw.c to forward * the argv0 of the stub executable */ wchar_t* wbuf = Py_DecodeLocale(pyvenv_launcher, NULL); if (wbuf == NULL) &#123; Py_FatalError(\"Cannot decode __PYVENV_LAUNCHER__\"); &#125; Py_SetProgramName(wbuf); /* Don't free wbuf, the argument to Py_SetProgramName * must remain valid until Py_FinalizeEx is called. */ &#125; else &#123; Py_SetProgramName(argv[0]); &#125;#else Py_SetProgramName(argv[0]);#endif &#125;#else Py_SetProgramName(argv[0]);#endif Otherwise, we can see that, argv[0] is passed in. Initialize Python This function will call Py_InitializeEx(1); and then _Py_InitializeEx_Private(install_sigs, 1);. 1Py_Initialize(); The function _Py_InitializeEx_Private will establish the entire environment. In the next post, we can get deeper in it. Print Python version in interactive mode Python will then print Python version if we want to directly enter into interactive mode, i.e, run python without any other arguments. 12345678if (!Py_QuietFlag &amp;&amp; (Py_VerboseFlag || (command == NULL &amp;&amp; filename == NULL &amp;&amp; module == NULL &amp;&amp; stdin_is_interactive))) &#123; fprintf(stderr, \"Python %s on %s\\n\", Py_GetVersion(), Py_GetPlatform()); if (!Py_NoSiteFlag) fprintf(stderr, \"%s\\n\", COPYRIGHT);&#125; Prepare argv for Python os.argv Use -m or -c as premier argument. 1234567891011if (command != NULL) &#123; /* Backup _PyOS_optind and force sys.argv[0] = '-c' */ _PyOS_optind--; argv[_PyOS_optind] = L\"-c\";&#125;if (module != NULL) &#123; /* Backup _PyOS_optind and force sys.argv[0] = '-m'*/ _PyOS_optind--; argv[_PyOS_optind] = L\"-m\";&#125; Prepare main importer path Main importer path is exactly the module in which Python will run as __main__. So, to launch Python with a file in the arguments, itâ€™s to use the file as the main importer path. 123if (filename != NULL) &#123; main_importer_path = AsImportPathEntry(filename);&#125; If there is no file name provided, main_importer_path will not be set, either. So we do not know which we should use as the first parameter in sys.argv. Python chooses to treat it after. 1234567if (main_importer_path != NULL) &#123; /* Let RunMainFromImporter adjust sys.path[0] later */ PySys_SetArgvEx(argc-_PyOS_optind, argv+_PyOS_optind, 0);&#125; else &#123; /* Use config settings to decide whether or not to update sys.path[0] */ PySys_SetArgv(argc-_PyOS_optind, argv+_PyOS_optind);&#125; Prepare for interactive mode If we are going to use interactive/inspect mode, weâ€™ll need the library readline. So, import it and decrease the reference count of it, to delete it later. 12345678910if ((Py_InspectFlag || (command == NULL &amp;&amp; filename == NULL &amp;&amp; module == NULL)) &amp;&amp; isatty(fileno(stdin)) &amp;&amp; !Py_IsolatedFlag) &#123; PyObject *v; v = PyImport_ImportModule(\"readline\"); if (v == NULL) PyErr_Clear(); else Py_DECREF(v);&#125; Run command if conform 1234if (command) &#123; sts = run_command(command, &amp;cf); PyMem_RawFree(command);&#125; Run module if conform 123else if (module) &#123; sts = (RunModule(module, 1) != 0);&#125; Run interactive or run files If neither command nor module conforms, Python will try to find other way to launch. Firstly, it tries to run interactive mode, while filename is not set. This action is what happens in the background when we launch python without arguments from our terminal. But it is not where the program begins. Here, weâ€™ve just launched a hook to mark that we need interactive mode. 12345if (filename == NULL &amp;&amp; stdin_is_interactive) &#123; Py_InspectFlag = 0; /* do exit on SystemExit */ RunStartupFile(&amp;cf); RunInteractiveHook();&#125; Then, if main_importer_path is set(previously by the file), the main program will run with the file as the main importer. As you know, import all things in the module and set __name__ to __main__. 12345sts = -1; /* keep track of whether we've already run __main__ */if (main_importer_path != NULL) &#123; sts = RunMainFromImporter(main_importer_path);&#125; But what will happen if file name is set, but main importer is not found, or the file doesnâ€™t exist? Python tries to open the file and read it line by line, then executes it. 12345678910111213141516171819202122232425262728293031323334353637383940if (sts==-1 &amp;&amp; filename != NULL) &#123; fp = _Py_wfopen(filename, L\"r\"); if (fp == NULL) &#123; char *cfilename_buffer; const char *cfilename; int err = errno; cfilename_buffer = Py_EncodeLocale(filename, NULL); if (cfilename_buffer != NULL) cfilename = cfilename_buffer; else cfilename = \"&lt;unprintable file name&gt;\"; fprintf(stderr, \"%ls: can't open file '%s': [Errno %d] %s\\n\", argv[0], cfilename, err, strerror(err)); if (cfilename_buffer) PyMem_Free(cfilename_buffer); return 2; &#125; else if (skipfirstline) &#123; int ch; /* Push back first newline so line numbers remain the same */ while ((ch = getc(fp)) != EOF) &#123; if (ch == '\\n') &#123; (void)ungetc(ch, fp); break; &#125; &#125; &#125; &#123; struct _Py_stat_struct sb; if (_Py_fstat_noraise(fileno(fp), &amp;sb) == 0 &amp;&amp; S_ISDIR(sb.st_mode)) &#123; fprintf(stderr, \"%ls: '%ls' is a directory, cannot continue\\n\", argv[0], filename); fclose(fp); return 1; &#125; &#125;&#125; sts will be set to another value, so the following lines will only be executed if there is no file name given. 12if (sts == -1) sts = run_file(fp, filename, &amp;cf); From here, the Python main program is over. Except some small things will be executed after the running. Re-run Interactive 1234567if (Py_InspectFlag &amp;&amp; stdin_is_interactive &amp;&amp; (filename != NULL || command != NULL || module != NULL)) &#123; Py_InspectFlag = 0; RunInteractiveHook(); /* XXX */ sts = PyRun_AnyFileFlags(stdin, \"&lt;stdin&gt;\", &amp;cf) != 0;&#125; As we see above, we need Py_InspectFlag, stdin_is_interactive are both true, and set at least a file name, a command or a module to run interactive mode. Which means, probably there was one script which has been executed, an the script imported the interactive mode. 12345678/* Check this environment variable at the end, to give programs the * opportunity to set it from Python. */if (!Py_InspectFlag &amp;&amp; (p = Py_GETENV(\"PYTHONINSPECT\")) &amp;&amp; *p != '\\0')&#123; Py_InspectFlag = 1;&#125; Thus, run python -c &quot;import os; os.environ['PYTHONINSPECT']='1'&quot; can also help enter interactive mode ğŸ˜ƒ But notice that, it will be executed if Py_InspectFlag is not set. That means previously we are not in the interactive mode. Thus, run python and &quot;import os; os.environ['PYTHONINSPECT']='1'&quot; in it, then exit, this will not help to re-enter the interactive mode. Clear and end up 1234567if (Py_FinalizeEx() &lt; 0) &#123; /* Value unlikely to be confused with a non-error exit status or other special meaning */ sts = 120;&#125;return sts; Conclusion Up to now, a Python interpreter/program has been launched and finished. In the next post, weâ€™ll look deeper into _Py_InitializeEx_Private, to see how Python Main function builds Python env through this function. But at the beginning, weâ€™ll talk about other functions in Python/main.c, they are small functions but really vital. See you then!","categories":[{"name":"Programming Language","slug":"Programming-Language","permalink":"https://blog.inoki.cc/categories/Programming-Language/"},{"name":"Source Code","slug":"Source-Code","permalink":"https://blog.inoki.cc/categories/Source-Code/"},{"name":"Python","slug":"Programming-Language/Python","permalink":"https://blog.inoki.cc/categories/Programming-Language/Python/"},{"name":"Python","slug":"Source-Code/Python","permalink":"https://blog.inoki.cc/categories/Source-Code/Python/"}],"tags":[{"name":"Python","slug":"Python","permalink":"https://blog.inoki.cc/tags/Python/"},{"name":"Source Code","slug":"Source-Code","permalink":"https://blog.inoki.cc/tags/Source-Code/"}]},{"title":"é¢è¯•å¸¸è§åŸºç¡€æ•°æ®ç»“æ„","slug":"Data-Structure","date":"2019-10-20T11:29:40.000Z","updated":"2025-03-08T09:40:48.561Z","comments":true,"path":"2019/10/20/Data-Structure/","link":"","permalink":"https://blog.inoki.cc/2019/10/20/Data-Structure/","excerpt":"","text":"åŸæ–‡é“¾æ¥ï¼šhttps://segmentfault.com/a/1190000018019127 å¸¸ç”¨çš„æ•°æ®ç»“æ„ æˆ‘ä»¬é¦–å…ˆåˆ—å‡ºæœ€å¸¸ç”¨çš„æ•°æ®ç»“æ„ï¼Œç„¶åå†æŒ¨ä¸ªè®²è§£ï¼š æ•°ç»„(Array) æ ˆ(Heap, Stack) é˜Ÿåˆ—(Queue) é“¾è¡¨(Linked List) æ ‘(Tree) å›¾(Graph) å­—å…¸æ ‘(Dictoinary Tree) å“ˆå¸Œè¡¨(Hash Table) æ•°ç»„ æ•°ç»„æ˜¯ä¸€ç§æœ€ç®€å•å’Œæœ€å¹¿æ³›ä½¿ç”¨çš„æ•°æ®ç»“æ„ï¼Œå…¶å®ƒæ•°æ®ç»“æ„æ¯”å¦‚æ ˆå’Œé˜Ÿåˆ—éƒ½æºè‡ªæ•°ç»„ã€‚ ä¸‹å›¾æ˜¯ä¸€ä¸ªå¤§å°ä¸º 4 çš„ç®€å•æ•°ç»„ï¼ŒåŒ…å«å‡ ä¸ªå…ƒç´ ï¼ˆ 1 , 2 , 3ï¼Œ4ï¼‰ã€‚ æ¯ä¸ªæ•°æ®å…ƒç´ ä¼šè¢«åˆ†é…ä¸€ä¸ªæ­£çš„æ•°å€¼ï¼Œå«ä½œâ€œç´¢å¼•â€ï¼Œå®ƒå¯¹åº”è¯¥å…ƒç´ åœ¨æ•°ç»„ä¸­çš„ä½ç½®ã€‚å¤§éƒ¨åˆ†ç¼–ç¨‹è¯­è¨€éƒ½å°†åˆå§‹ç´¢å¼•å®šä¹‰ä¸º 0. ä»¥ä¸‹æ˜¯ä¸¤ç§æ•°ç»„ï¼š ä¸€ç»´æ•°ç»„ï¼ˆå¦‚ä¸Šæ‰€ç¤ºï¼‰ å¤šç»´æ•°ç»„ï¼ˆæ•°ç»„çš„æ•°ç»„ï¼‰ æ•°ç»„çš„åŸºæœ¬æ“ä½œï¼š Insertâ€”â€”åœ¨ç»™å®šç´¢å¼•ä½ç½®æ’å…¥ä¸€ä¸ªå…ƒç´  Getâ€”â€”è¿”å›ç»™å®šç´¢å¼•ä½ç½®çš„å…ƒç´  Deleteâ€”â€”åˆ é™¤ç»™å®šç´¢å¼•ä½ç½®çš„å…ƒç´  Sizeâ€”â€”è·å–æ•°ç»„å†…æ‰€æœ‰å…ƒç´ çš„æ€»æ•° å¸¸é—®çš„æ•°ç»„é¢è¯•é—®é¢˜ï¼š æ‰¾åˆ°æ•°ç»„ä¸­ç¬¬äºŒå°çš„å…ƒç´  æ‰¾åˆ°æ•°ç»„ä¸­ç¬¬ä¸€ä¸ªæ²¡æœ‰é‡å¤çš„æ•´æ•° åˆå¹¶ä¸¤ä¸ªåˆ†ç±»æ•°ç»„ é‡æ–°æ’åˆ—æ•°ç»„ä¸­çš„æ­£å€¼å’Œè´Ÿå€¼ æ ˆ æˆ‘ä»¬éƒ½ç†Ÿæ‚‰å¾ˆæœ‰åçš„æ’¤é”€ï¼ˆUndoï¼‰é€‰é¡¹ï¼Œå®ƒå‡ ä¹å­˜åœ¨æ¯ä¸ªåº”ç”¨ç¨‹åºä¸­ã€‚æœ‰æ²¡æœ‰æƒ³è¿‡å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿå…¶æ€è·¯å°±æ˜¯ï¼ŒæŒ‰ç…§æœ€åçš„çŠ¶æ€æ’åˆ—åœ¨å…ˆçš„é¡ºåºå°†å·¥ä½œçš„å…ˆå‰çŠ¶æ€ï¼ˆé™äºç‰¹å®šæ•°å­—ï¼‰å­˜å‚¨åœ¨å†…å­˜ä¸­ã€‚è¿™åªç”¨æ•°ç»„æ˜¯æ— æ³•å®ç°çš„ï¼Œå› æ­¤æ ˆå°±æœ‰äº†ç”¨æ­¦ä¹‹åœ°ã€‚ å¯ä»¥æŠŠæ ˆçœ‹ä½œä¸€å †å‚ç›´æ’åˆ—çš„ä¹¦ç±ã€‚ä¸ºäº†è·å¾—ä½äºä¸­é—´ä½ç½®çš„ä¹¦ï¼Œä½ éœ€è¦æ‹¿æ‰æ”¾åœ¨å®ƒä¸Šé¢çš„æ‰€æœ‰ä¹¦ç±ã€‚è¿™å°±æ˜¯ LIFOï¼ˆåè¿›å…ˆå‡ºï¼‰æ–¹æ³•çš„å·¥ä½œåŸç†ã€‚ è¿™æ˜¯ä¸€ä¸ªåŒ…å«ä¸‰ä¸ªæ•°æ®å…ƒç´ ï¼ˆ1,2 å’Œ 3ï¼‰çš„æ ˆå›¾åƒï¼Œå…¶ä¸­3ä½äºé¡¶éƒ¨ï¼Œé¦–å…ˆæŠŠå®ƒåˆ é™¤ï¼š æ ˆçš„åŸºæœ¬æ“ä½œï¼š Pushâ€”â€”åœ¨é¡¶éƒ¨æ’å…¥å…ƒç´  Popâ€”â€” ä»æ ˆä¸­åˆ é™¤åè¿”å›é¡¶éƒ¨å…ƒç´  isEmptyâ€”â€”å¦‚æœæ ˆä¸ºç©ºï¼Œåˆ™è¿”å› true Top â€”â€”è¿”å›é¡¶éƒ¨å…ƒç´ ï¼Œä½†ä¸ä»æ ˆä¸­åˆ é™¤ å¸¸è§çš„æ ˆé¢è¯•é—®é¢˜ï¼š ä½¿ç”¨æ ˆè®¡ç®—åç¼€è¡¨è¾¾å¼ å¯¹æ ˆä¸­çš„å€¼è¿›è¡Œæ’åº æ£€æŸ¥è¡¨è¾¾å¼ä¸­çš„æ‹¬å·æ˜¯å¦å¹³è¡¡ é˜Ÿåˆ— ä¸æ ˆç±»ä¼¼ï¼Œé˜Ÿåˆ—æ˜¯å¦ä¸€ç§çº¿æ€§æ•°æ®ç»“æ„ï¼Œä»¥é¡ºåºæ–¹å¼å­˜å‚¨å…ƒç´ ã€‚æ ˆå’Œé˜Ÿåˆ—ä¹‹é—´å”¯ä¸€çš„æ˜¾ç€åŒºåˆ«æ˜¯ï¼Œé˜Ÿåˆ—ä¸æ˜¯ä½¿ç”¨ LIFO æ–¹æ³•ï¼Œè€Œæ˜¯åº”ç”¨ FIFO æ–¹æ³•ï¼Œè¿™æ˜¯ First in First Outï¼ˆå…ˆå…¥å…ˆå‡ºï¼‰çš„ç¼©å†™ã€‚ é˜Ÿåˆ—çš„å®Œç¾ç°å®ä¾‹å­ï¼šä¸€åˆ—äººåœ¨å”®ç¥¨äº­ç­‰å€™ã€‚å¦‚æœæœ‰æ–°äººæ¥ï¼Œä»–ä»¬æ˜¯ä»æœ«å°¾åŠ å…¥é˜Ÿåˆ—ï¼Œè€Œä¸æ˜¯åœ¨å¼€å¤´â€”â€”ç«™åœ¨å‰é¢çš„äººå°†å…ˆä¹°åˆ°ç¥¨ç„¶åç¦»å¼€é˜Ÿåˆ—ã€‚ ä¸‹å›¾æ˜¯ä¸€ä¸ªåŒ…å«å››ä¸ªæ•°æ®å…ƒç´ ï¼ˆ1,2,3 å’Œ 4ï¼‰çš„é˜Ÿåˆ—ï¼Œå…¶ä¸­ 1 ä½äºé¡¶éƒ¨ï¼Œé¦–å…ˆæŠŠå®ƒåˆ é™¤ï¼š é˜Ÿåˆ—çš„åŸºæœ¬æ“ä½œï¼š Enqueue() â€”â€” å‘é˜Ÿåˆ—æœ«å°¾æ’å…¥å…ƒç´  Dequeue() â€”â€” ä»é˜Ÿåˆ—å¤´éƒ¨ç§»é™¤å…ƒç´  isEmpty() â€”â€” å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™è¿”å› true Top() â€”â€” è¿”å›é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªå…ƒç´  å¸¸é—®çš„é˜Ÿåˆ—é¢è¯•é—®é¢˜ï¼š ä½¿ç”¨é˜Ÿåˆ—æ¥å®ç°æ ˆ é¢ å€’é˜Ÿåˆ—ä¸­å‰ k ä¸ªå…ƒç´ çš„é¡ºåº ä½¿ç”¨é˜Ÿåˆ—ç”Ÿæˆä» 1 åˆ° n çš„äºŒè¿›åˆ¶æ•° é“¾è¡¨ é“¾è¡¨æ˜¯å¦ä¸€ä¸ªé‡è¦çš„çº¿æ€§æ•°æ®ç»“æ„ï¼Œåˆšä¸€çœ‹å¯èƒ½çœ‹èµ·æ¥åƒæ•°ç»„ï¼Œä½†åœ¨å†…å­˜åˆ†é…ï¼Œå†…éƒ¨ç»“æ„ä»¥åŠå¦‚ä½•æ‰§è¡Œæ’å…¥å’Œåˆ é™¤çš„åŸºæœ¬æ“ä½œæ–¹é¢æœ‰æ‰€ä¸åŒã€‚ é“¾è¡¨å°±åƒä¸€ä¸ªèŠ‚ç‚¹é“¾ï¼Œå…¶ä¸­æ¯ä¸ªèŠ‚ç‚¹åŒ…å«æ•°æ®å’ŒæŒ‡å‘é“¾ä¸­åç»­èŠ‚ç‚¹çš„æŒ‡é’ˆç­‰ä¿¡æ¯ã€‚æœ‰ä¸€ä¸ªå¤´æŒ‡é’ˆï¼ŒæŒ‡å‘é“¾è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¦‚æœåˆ—è¡¨æ˜¯ç©ºçš„ï¼Œé‚£ä¹ˆå®ƒåªæŒ‡å‘ null æˆ–ä¸æŒ‡å‘ä»»ä½•å†…å®¹ã€‚ é“¾è¡¨ç”¨äºå®ç°æ–‡ä»¶ç³»ç»Ÿï¼Œå“ˆå¸Œè¡¨å’Œé‚»æ¥è¡¨ã€‚ä¸‹å›¾æ˜¯é“¾è¡¨å†…éƒ¨ç»“æ„çš„ç›´è§‚å±•ç¤ºï¼š ä¸‹é¢æ˜¯å‡ ç§ç±»å‹çš„é“¾è¡¨ï¼š å•é“¾è¡¨ï¼ˆå•å‘ï¼‰ åŒé“¾è¡¨ï¼ˆåŒå‘ï¼‰ é“¾è¡¨çš„åŸºæœ¬æ“ä½œï¼š InsertAtEnd â€”â€” åœ¨é“¾è¡¨æœ«å°¾æ’å…¥æŒ‡å®šå…ƒç´  InsertAtHead â€”â€” åœ¨é“¾è¡¨å¤´éƒ¨æ’å…¥æŒ‡å®šå…ƒç´  Delete â€”â€” ä»é“¾è¡¨ä¸­åˆ é™¤æŒ‡å®šå…ƒç´  DeleteAtHead â€”â€” åˆ é™¤é“¾è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´  Search â€”â€” è¿”å›é“¾è¡¨ä¸­çš„æŒ‡å®šå…ƒç´  isEmpty â€”â€” å¦‚æœé“¾è¡¨ä¸ºç©ºï¼Œè¿”å› true å¸¸é—®çš„é“¾è¡¨é¢è¯•é—®é¢˜ï¼š ç¿»è½¬åˆ—è¡¨ æ£€æµ‹é“¾è¡¨ä¸­çš„å¾ªç¯ è¿”å›é“¾è¡¨ä¸­å€’æ•°ç¬¬ n ä¸ªèŠ‚ç‚¹ ç§»é™¤é“¾è¡¨ä¸­çš„é‡å¤å€¼ å›¾ å›¾å°±æ˜¯ä¸€ç»„èŠ‚ç‚¹ï¼Œä»¥ç½‘ç»œçš„å½¢å¼äº’ç›¸è¿æ¥ã€‚èŠ‚ç‚¹ä¹Ÿè¢«ç§°ä¸ºé¡¶ç‚¹ï¼ˆverticesï¼‰ã€‚ä¸€å¯¹ï¼ˆx,yï¼‰å°±å«åšä¸€ä¸ªè¾¹ï¼Œè¡¨ç¤ºé¡¶ç‚¹ x å’Œé¡¶ç‚¹ y ç›¸è¿ã€‚ä¸€ä¸ªè¾¹å¯èƒ½åŒ…å«æƒé‡/æˆæœ¬ï¼Œæ˜¾ç¤ºä»é¡¶ç‚¹ x åˆ° y æ‰€éœ€çš„æˆæœ¬ã€‚ å›¾çš„ç±»å‹ï¼š æ— å‘å›¾ æœ‰å‘å›¾ åœ¨ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œå›¾å¯ä»¥è¡¨ç¤ºä¸ºä¸¤ç§å½¢å¼ï¼š é‚»æ¥çŸ©é˜µ é‚»æ¥åˆ—è¡¨ å¸¸è§çš„å›¾éå†ç®—æ³•ï¼š å¹¿åº¦ä¼˜å…ˆæœç´¢ æ·±åº¦ä¼˜å…ˆæœç´¢ å¸¸é—®çš„å›¾é¢è¯•é—®é¢˜ï¼š å®ç°å¹¿åº¦ä¼˜å…ˆæœç´¢å’Œæ·±åº¦ä¼˜å…ˆæœç´¢ æ£€æŸ¥ä¸€ä¸ªå›¾æ˜¯å¦ä¸ºæ ‘ è®¡ç®—ä¸€å¼ å›¾ä¸­çš„è¾¹çš„æ•°é‡ æ‰¾åˆ°ä¸¤ä¸ªé¡¶ç‚¹ä¹‹é—´çš„æœ€çŸ­è·¯å¾„ æ ‘ æ ‘æ˜¯ä¸€ç§å±‚çº§æ•°æ®ç»“æ„ï¼ŒåŒ…å«äº†è¿æ¥å®ƒä»¬çš„é¡¶ç‚¹ï¼ˆèŠ‚ç‚¹ï¼‰å’Œè¾¹ã€‚æ ‘å’Œå›¾å¾ˆç›¸ä¼¼ï¼Œä½†äºŒè€…æœ‰ä¸ªå¾ˆå¤§çš„ä¸åŒç‚¹ï¼Œå³æ ‘ä¸­æ²¡æœ‰å¾ªç¯ã€‚ æ ‘å¹¿æ³›åº”ç”¨åœ¨äººå·¥æ™ºèƒ½å’Œå¤æ‚çš„ç®—æ³•ä¸­ï¼Œä¸ºè§£å†³å„ç§é—®é¢˜æä¾›é«˜æ•ˆçš„å­˜å‚¨æœºåˆ¶ã€‚ ä¸‹å›¾æ˜¯ä¸€ä¸ªç®€å•çš„æ ‘ï¼Œä»¥åŠåœ¨æ ‘å‹æ•°æ®ç»“æ„ä¸­æ‰€ç”¨çš„åŸºæœ¬æœ¯è¯­ï¼š ä¸‹é¢æ˜¯å‡ ç§ç±»å‹çš„æ ‘ï¼š N å‰æ ‘ å¹³è¡¡æ ‘ äºŒå‰æ ‘ äºŒå‰æœç´¢æ ‘ å¹³è¡¡äºŒå‰æ ‘ çº¢é»‘æ ‘ 2-3 æ ‘ å…¶ä¸­ï¼ŒäºŒå‰æ ‘å’ŒäºŒå‰æœç´¢æ ‘æ˜¯æœ€å¸¸ç”¨çš„æ ‘ã€‚ å¸¸é—®çš„æ ‘é¢è¯•é—®é¢˜ï¼š æ‰¾åˆ°ä¸€ä¸ªäºŒå‰æ ‘çš„é«˜åº¦ æ‰¾åˆ°ä¸€ä¸ªäºŒå‰æœç´¢æ ‘ä¸­ç¬¬ k ä¸ªæœ€å¤§å€¼ æ‰¾åˆ°è·ç¦»æ ¹éƒ¨â€œkâ€ä¸ªè·ç¦»çš„èŠ‚ç‚¹ æ‰¾åˆ°ä¸€ä¸ªäºŒå‰æ ‘ä¸­ç»™å®šèŠ‚ç‚¹çš„ç¥–å…ˆï¼ˆancestorsï¼‰ å­—å…¸æ ‘ å­—å…¸æ ‘ï¼Œä¹Ÿå«â€œå‰ç¼€æ ‘â€ï¼Œæ˜¯ä¸€ç§æ ‘å½¢ç»“æ„ï¼Œåœ¨è§£å†³å­—ç¬¦ä¸²ç›¸å…³é—®é¢˜ä¸­éå¸¸é«˜æ•ˆã€‚å…¶æä¾›éå¸¸å¿«é€Ÿçš„æ£€ç´¢åŠŸèƒ½ï¼Œå¸¸ç”¨äºæœç´¢å­—å…¸ä¸­çš„å•è¯ï¼Œä¸ºæœç´¢å¼•æ“æä¾›è‡ªåŠ¨æœç´¢å»ºè®®ï¼Œç”šè‡³èƒ½ç”¨äºIPè·¯ç”±é€‰æ‹©ã€‚ ä¸‹é¢å±•ç¤ºäº†â€œtopâ€â€œthusâ€å’Œâ€œtheirâ€è¿™ä¸‰ä¸ªè¯æ˜¯å¦‚ä½•å­˜å‚¨åœ¨å­—å…¸æ ‘ä¸­çš„ï¼š è¿™äº›å•è¯ä»¥ä»ä¸Šåˆ°ä¸‹çš„æ–¹å¼å­˜å‚¨ï¼Œå…¶ä¸­ç»¿è‰²èŠ‚ç‚¹â€œpâ€ï¼Œâ€œsâ€å’Œâ€œrâ€åˆ†åˆ«è¡¨ç¤ºâ€œtopâ€ï¼Œâ€œthusâ€å’Œâ€œtheirâ€çš„æœ«å°¾ã€‚ å¸¸è§çš„å­—å…¸æ ‘é¢è¯•é—®é¢˜ï¼š è®¡ç®—å­—å…¸æ ‘ä¸­çš„æ€»å­—æ•° æ‰“å°å­˜å‚¨åœ¨å­—å…¸æ ‘ä¸­çš„æ‰€æœ‰å•è¯ ä½¿ç”¨å­—å…¸æ ‘å¯¹æ•°ç»„çš„å…ƒç´ è¿›è¡Œæ’åº ä½¿ç”¨å­—å…¸æ ‘ä»å­—å…¸ä¸­å½¢æˆå•è¯ æ„å»ºä¸€ä¸ªT9å­—å…¸ å“ˆå¸Œè¡¨ æ•£åˆ—æ˜¯ä¸€ä¸ªç”¨äºå”¯ä¸€æ ‡è¯†å¯¹è±¡å¹¶åœ¨ä¸€äº›é¢„å…ˆè®¡ç®—çš„å”¯ä¸€ç´¢å¼•ï¼ˆç§°ä¸ºâ€œå¯†é’¥â€ï¼‰å­˜å‚¨æ¯ä¸ªå¯¹è±¡çš„è¿‡ç¨‹ã€‚å› æ­¤ï¼Œå¯¹è±¡ä»¥â€œé”®å€¼â€å¯¹çš„å½¢å¼å­˜å‚¨ï¼Œè¿™äº›é¡¹çš„é›†åˆè¢«ç§°ä¸ºâ€œå­—å…¸â€ã€‚å¯ä»¥ä½¿ç”¨è¯¥é”®å€¼æœç´¢æ¯ä¸ªå¯¹è±¡ã€‚æœ‰å¤šç§ä¸åŒçš„åŸºäºå“ˆå¸Œçš„æ•°æ®ç»“æ„ï¼Œä½†æœ€å¸¸ç”¨çš„æ•°æ®ç»“æ„æ˜¯å“ˆå¸Œè¡¨ã€‚ å“ˆå¸Œè¡¨é€šå¸¸ä½¿ç”¨æ•°ç»„å®ç°ã€‚ å“ˆå¸Œæ•°æ®ç»“æ„çš„æ€§èƒ½å–å†³äºä»¥ä¸‹ä¸‰ä¸ªå› ç´ ï¼š å“ˆå¸Œå‡½æ•° å“ˆå¸Œè¡¨çš„å¤§å° ç¢°æ’å¤„ç†æ–¹æ³• ä¸‹å›¾å±•ç¤ºäº†å¦‚ä½•åœ¨æ•°ç»„ä¸­æ˜ å°„å“ˆå¸Œã€‚è¯¥æ•°ç»„çš„ç´¢å¼•æ˜¯é€šè¿‡å“ˆå¸Œå‡½æ•°è®¡ç®—çš„ã€‚ å¸¸é—®çš„å“ˆå¸Œé¢è¯•é—®é¢˜ï¼š æ‰¾åˆ°æ•°ç»„ä¸­çš„å¯¹ç§°å¯¹ è¿½è¸ªéå†çš„å®Œæ•´è·¯å¾„ æŸ¥çœ‹ä¸€ä¸ªæ•°ç»„æ˜¯å¦ä¸ºå¦ä¸€ä¸ªæ•°ç»„çš„å­é›† æ£€æŸ¥ç»™å®šæ•°ç»„æ˜¯å¦ä¸ç›¸äº¤ ä»¥ä¸Šå°±æ˜¯ä½ åœ¨å‡†å¤‡ç¼–ç¨‹é¢è¯•å‰éœ€è¦æŒæ¡çš„8ç§æ•°æ®ç»“æ„ã€‚","categories":[{"name":"Data Structure","slug":"Data-Structure","permalink":"https://blog.inoki.cc/categories/Data-Structure/"},{"name":"Algorithm","slug":"Data-Structure/Algorithm","permalink":"https://blog.inoki.cc/categories/Data-Structure/Algorithm/"}],"tags":[{"name":"ä¸­æ–‡","slug":"ä¸­æ–‡","permalink":"https://blog.inoki.cc/tags/ä¸­æ–‡/"}]},{"title":"Win 10 IoT - Deployment","slug":"Win10-IoT-Deploy","date":"2019-10-19T19:29:40.000Z","updated":"2025-03-08T09:40:48.600Z","comments":true,"path":"2019/10/19/Win10-IoT-Deploy/","link":"","permalink":"https://blog.inoki.cc/2019/10/19/Win10-IoT-Deploy/","excerpt":"","text":"In the previous months, I deployed Win IoT programs through Windows Device Portal. Because my Visual Studio could not find the remote device to do the deplyment and debug. It seems to be a bug in the previous Win 10 IoT version. My previous version was 15xxx. So I used Windows Device Portal to deploy an application. Deploy through Windows Device Portal You should be able to look up the information of your device through Windows Device Portal with a browser. The link is the address of your Raspberry Pi, and the port is 8080. The application can be installed and controlled in Apps -&gt; Apps Manager. Deploy via Visual Studio After reinstalling Win 10 IoT to v.10.0.17763.107, the deployment via Visual Studio is normal. So, I set the PIN for debugging in Windows Device Portal. Everything works well: To do this, you just need to right click on the project, then choose Properties. In the Debug tab, input the IP address of your Raspberry Pi, choose General as authentification. If needed, input the PIN youâ€™ve set. Enjoy!","categories":[{"name":"Embedded System","slug":"Embedded-System","permalink":"https://blog.inoki.cc/categories/Embedded-System/"},{"name":"Raspberry Pi","slug":"Embedded-System/Raspberry-Pi","permalink":"https://blog.inoki.cc/categories/Embedded-System/Raspberry-Pi/"},{"name":"IoT","slug":"Embedded-System/IoT","permalink":"https://blog.inoki.cc/categories/Embedded-System/IoT/"},{"name":"Win 10 IoT","slug":"Embedded-System/IoT/Win-10-IoT","permalink":"https://blog.inoki.cc/categories/Embedded-System/IoT/Win-10-IoT/"}],"tags":[{"name":"Embedded System","slug":"Embedded-System","permalink":"https://blog.inoki.cc/tags/Embedded-System/"},{"name":"Raspberry Pi","slug":"Raspberry-Pi","permalink":"https://blog.inoki.cc/tags/Raspberry-Pi/"},{"name":"Win 10 IoT","slug":"Win-10-IoT","permalink":"https://blog.inoki.cc/tags/Win-10-IoT/"}]},{"title":"OpenCL - Heterogeneous Computing (0)","slug":"OpenCL-0","date":"2019-10-18T22:29:40.000Z","updated":"2025-03-08T09:40:48.591Z","comments":true,"path":"2019/10/18/OpenCL-0/","link":"","permalink":"https://blog.inoki.cc/2019/10/18/OpenCL-0/","excerpt":"","text":"OpenCL (Open Computing Language) is a framework for writing programs that execute across heterogeneous platforms consisting of central processing units (CPUs), graphics processing units (GPUs), digital signal processors (DSPs), field-programmable gate arrays (FPGAs) and other processors or hardware accelerators. OpenCL specifies programming languages (based on C99 and C++11) for programming these devices and application programming interfaces (APIs) to control the platform and execute programs on the compute devices. OpenCL provides a standard interface for parallel computing using task- and data-based parallelism. This is the definition of OpenCL on Wikipedia. In this post, Iâ€™d like to do some research about the architecture in a brief view, based on Arch Linux. Arch Linux is chosen because of its clear software source, in which we can find out what exactly in a package for OpenCL components. Here, we only talk about the type that runs on GPU. GPGPU GPGPU is a notion standing General-Purpose computing on Graphics Processing Units. Itâ€™s called General Purpose because through it, we will not use Graphics Processing Units to process graphics data. Instead, weâ€™d like to use them as more general computing devices. To achieve this, there are several frameworks proposed by different communities, organizations or companies. For example: NVIDIA Cuda ATI Stream OpenCL NVIDIA Cuda is proprietary and of course supported by NVIDIA. OpenCL is an open standard maintained by the non-profit technology consortium Khronos Group. But in face, the implementations rely on hardware/software providers. The important stuff of the various implementations is OpenCL Runtime libraries, which are prerequisites of executing a program that uses OpenCL. OpenCL Runtime libraries To be clarified, OpenCL Runtime libraries depend on hardware manufacturers. So, we should install the runtime libraries that match our hardwares. For example, I have an Intel CPU along with integrated Intel GPU, and a NVIDIA GPU beside. So, what I need to use all GPU devices is just to install Intel GPU OpenCL runtime libraries and NVIDIA GPU OpenCL runtime libraries. If you have an AMD GPU, or other types of devices, like an integrated FPGA(wow, you must be really professional), you should install the libraries provided by their manufacturers, or a compatible version. On Arch Linux, pacman is used to install packages. There are not bad OpenCL runtime library packages in the repository: 1234567891011121314151617181920AMD/ATI opencl-mesa: free runtime for AMDGPU and Radeon opencl-amdAUR: proprietary standalone runtime for AMDGPU (pal and legacy stacks in a single package) rocm-opencl-runtimeAUR: Part of AMD&apos;s fully open-source ROCm GPU compute stack, which supports GFX8 and later cards(Fiji, Polaris, Vega) opencl-amdgpu-pro-orcaAUR: proprietary runtime for AMDGPU PRO (supports legacy products older than Vega 10) opencl-amdgpu-pro-palAUR: proprietary runtime for AMDGPU PRO (supports Vega 10 and later products) opencl-catalystAUR: AMD proprietary runtime, soon to be deprecated in favor of AMDGPU amdapp-sdkAUR: AMD CPU runtimeNVIDIA opencl-nvidia: official NVIDIA runtimeIntel intel-compute-runtime: a.k.a. the Neo OpenCL runtime, the open-source implementation for Intel HD Graphics GPU on Gen8 (Broadwell) and beyond. beignet: the open-source implementation for Intel HD Graphics GPU on Gen7 (Ivy Bridge) and beyond, deprecated by Intel in favour of NEO OpenCL driver, remains recommended solution for legacy HW platforms (e.g. Ivy Bridge, Sandy Bridge, Haswell). intel-openclAUR: the proprietary implementation for Intel HD Graphics GPU on Gen7 (Ivy Bridge) and beyond, deprecated by Intel in favour of NEO OpenCL driver, remains recommended solution for legacy HW platforms (e.g. Ivy Bridge, Sandy Bridge, Haswell). intel-opencl-runtimeAUR: the implementation for Intel Core and Xeon processors. It also supports non-Intel CPUs.Others poclAUR: LLVM-based OpenCL implementation Iâ€™d like to install the one for NVIDIA, so I did 1sudo pacman -S opencl-nvidia We can see what are in the package from Arch website. 1234567891011121314etc/etc/OpenCL/etc/OpenCL/vendors/etc/OpenCL/vendors/nvidia.icdusr/usr/lib/usr/lib/libnvidia-compiler.sousr/lib/libnvidia-compiler.so.435.21usr/lib/libnvidia-opencl.sousr/lib/libnvidia-opencl.so.1usr/lib/libnvidia-opencl.so.435.21usr/share/usr/share/licenses/usr/share/licenses/opencl-nvidia There are some dynamic libraries for OpenCL with NVIDIA prefixes and a configuration file in /etc/OpenCL/vendors. The configuration file in etc/OpenCL/vendors/nvidia.icd should be able to tell someone, that there is NVIDIA OpenCL runtime, and where it is. The file content is: 1libnvidia-opencl.so.1 If youâ€™d like also to use Intel GPU, install intel-compute-runtime. Files to be installed is below: 1234567891011121314etc/etc/OpenCL/etc/OpenCL/vendors/etc/OpenCL/vendors/intel.icdusr/usr/bin/usr/bin/oclocusr/lib/usr/lib/intel-opencl/usr/lib/intel-opencl/libigdrcl.sousr/share/usr/share/licenses/usr/share/licenses/intel-compute-runtime/usr/share/licenses/intel-compute-runtime/LICENSE You may notice that, there is nothing like libnvidia-compiler in Intel OpenCL Runtime. But itâ€™s not true, the fact is that the OpenCL compiler of Intel OpenCL runtime is installed in another library, intel-graphics-compiler. And, this package is a mandatory dependency of intel-compute-runtime. You should be able to install other OpenCL runtime if you have other devices. But itâ€™s not the end, we are not aiming at just â€œrunningâ€ an OpenCL program, we aim at developing one. Develop Environment Basically, OpenCL is for C/C++ development. To develop, at least we need header files and dynamic libraries. The most used header file is CL/cl.h, which can be installed by installing opencl-headers package, which will import other necessary headers as well. 123456789101112131415161718usr/usr/include/usr/include/CL/usr/include/CL/cl.husr/include/CL/cl.hppusr/include/CL/cl2.hppusr/include/CL/cl_egl.husr/include/CL/cl_ext.husr/include/CL/cl_ext_intel.husr/include/CL/cl_gl.husr/include/CL/cl_gl_ext.husr/include/CL/cl_platform.husr/include/CL/cl_va_api_media_sharing_intel.husr/include/CL/opencl.husr/share/usr/share/licenses/usr/share/licenses/opencl-headers/usr/share/licenses/opencl-headers/LICENSE And, the most import library is libOpenCL.so, which is in ocl-icd package. 123456789101112131415161718192021222324usr/usr/include/usr/include/ocl_icd.husr/lib/usr/lib/libOpenCL.sousr/lib/libOpenCL.so.1usr/lib/libOpenCL.so.1.0.0usr/lib/pkgconfig/usr/lib/pkgconfig/OpenCL.pcusr/lib/pkgconfig/ocl-icd.pcusr/share/usr/share/doc/usr/share/doc/ocl-icd/usr/share/doc/ocl-icd/examples/usr/share/doc/ocl-icd/examples/ocl_icd_bindings.cusr/share/doc/ocl-icd/html/usr/share/doc/ocl-icd/html/libOpenCL.htmlusr/share/licenses/usr/share/licenses/ocl-icd/usr/share/licenses/ocl-icd/COPYINGusr/share/man/usr/share/man/man7/usr/share/man/man7/libOpenCL.7.gzusr/share/man/man7/libOpenCL.so.7.gz The full name of this package is OpenCL Installable Client Driver. Itâ€™s a mechanism to allow developers to build applications against an Installable Client Driver loader (ICD loader) rather than linking their applications against a specific OpenCL implementation. The ICD Loader is responsible for: Exporting OpenCL API entry points Enumerating OpenCL implementations Forwarding OpenCL API calls to the correct implementation The official implementation of ICD Loader can be found here on GitHub: https://github.com/KhronosGroup/OpenCL-ICD-Loader. There are other SDKs as well, but we ought not talk about them because they are out of scope: 123intel-opencl-sdkAUR: Intel OpenCL SDK (old version, new OpenCL SDKs are included in the INDE and Intel Media Server Studio)amdapp-sdkAUR: This package is installed as /opt/AMDAPP and apart from SDK files it also contains a number of code samples (/opt/AMDAPP/SDK/samples/). It also provides the clinfo utility which lists OpenCL platforms and devices present in the system and displays detailed information about them. As AMD APP SDK itself contains CPU OpenCL driver, no extra driver is needed to execute OpenCL on CPU devices (regardless of its vendor). GPU OpenCL drivers are provided by the catalystAUR package (an optional dependency).cuda: Nvidia&apos;s GPU SDK which includes support for OpenCL 1.1. Besides, for the OpenCL Implementations, weâ€™ve already talked about them. They are runtime libraries along with configuration files in /etc/OpenCL/vendors. A utility to show all possible properties on your system, is clinfo. Owning headers, OpenCL dynamic libraries and runtime libraries, we can start developing and running OpenCL program on C/C++. As well, there are lots of bindings for other languages, take ease to use them if you want. In the next post, we will write a first OpenCL program. See you then!","categories":[{"name":"OpenCL","slug":"OpenCL","permalink":"https://blog.inoki.cc/categories/OpenCL/"}],"tags":[{"name":"OpenCL","slug":"OpenCL","permalink":"https://blog.inoki.cc/tags/OpenCL/"},{"name":"Heterogeneous Computing","slug":"Heterogeneous-Computing","permalink":"https://blog.inoki.cc/tags/Heterogeneous-Computing/"}]},{"title":"Python Source Code Analysis (0)","slug":"Python-code-analyse-0","date":"2019-10-17T15:47:40.000Z","updated":"2025-03-08T09:40:48.591Z","comments":true,"path":"2019/10/17/Python-code-analyse-0/","link":"","permalink":"https://blog.inoki.cc/2019/10/17/Python-code-analyse-0/","excerpt":"","text":"In this post, we will take a dissecion of source code of Python. To benefit the simplicity and meanwhile follow the most recent functionnalities, I choose Python 3.6.9 to do the analysis. The first step, is to build! Build Python As other projects, Python uses autoconf toolset to configure and then make to build itself. If it doesnâ€™t make sense to you, just ignore it. What you really need is just a set of single commands to make it: Run ./configure, it will detect your environment along with the architecture, the dependencies, the features supported by your compiler After that, if there is no error, a Makefile file should be generated and placed in the same directory Run make, and you will get your own Python build! Now we use default configurations to build, because we donâ€™t aim at building a Python binary. If youâ€™d like to play with Python builds, you can find more information at https://docs.python.org/3.6/using/unix.html#building-python. Project Structure Before we configure the project, the structure of project is really clear and simple: 123456aclocal.m4 configure Lib Misc Programs python-config.pybuild configure.ac LICENSE Modules pyconfig.h python-gdb.pyconfig.guess Doc Mac Objects pyconfig.h.in README.rstconfig.log Grammar Makefile Parser python setup.pyconfig.status Include Makefile.pre PC Python Toolsconfig.sub install-sh Makefile.pre.in PCbuild python-config aclocal.m4, config.guess, config.sub, configure, configure.ac, install-sh, Makefile.pre.in, pyconfig.h.in are files which concerns the configuration and the compilation. LICENSE is the license file. Doc/ This folder contains the documentation of Python. Grammar1/ In Grammar folder, there is only one file, which described the abstract grammar representation of Python. Include/ All Python headers used during Python compilation. Some of those will be intalled in your system for a further development. Lib/ All libraries written in Python. Mac/ Build tools for macOS build. Misc/ Other things, not so important. Modules/ Modules written in C. Objects/ Declarations and implementations of various Python Objects. Parser/ Python code parser. PC/ The code for Windows PC. PCbuild/ The Windows PC build files, such as Visual Studio Prject files. Programms/ Main functions of Python. Python/ Python main implementation codes. Tools/ Auxiliary tools and demo. Programm Entry, Programs/python.c In the analysis, we start by the main entry of program. At the beginning, &quot;Python.h&quot; and &lt;locale.h&gt; are imported. Then, the main function has two branches: Windows On Windows, the function wmain instead of main is used as the main entry. 12345intwmain(int argc, wchar_t **argv)&#123; return Py_Main(argc, argv);&#125; This function is for the unicode environment, you can go to the doc page of Microsoft for further information: https://docs.microsoft.com/en-us/cpp/c-language/using-wmain?view=vs-2019. In the main function, it calls the real Main Function of Python, Py_Main with command-line arguments. Other Unix-Like Systems Itâ€™s not so simple as the one for Windows. 12345 wchar_t **argv_copy;/* We need a second copy, as Python might modify the first one. */wchar_t **argv_copy2;int i, res;char *oldloc; In this code, some necessary variables are declared, regarding C89 or above. Then, to copy arguments, Python requests to use malloc to allocate memories by invoking (void)_PyMem_SetupAllocators(&quot;malloc&quot;);. Then two memory spaces are allocated: 123456argv_copy = (wchar_t **)PyMem_RawMalloc(sizeof(wchar_t*) * (argc+1));argv_copy2 = (wchar_t **)PyMem_RawMalloc(sizeof(wchar_t*) * (argc+1));if (!argv_copy || !argv_copy2) &#123; fprintf(stderr, \"out of memory\\n\"); return 1;&#125; Then, Python did one thing like this: 1oldloc = _PyMem_RawStrdup(setlocale(LC_ALL, NULL)); This line will return C locale and store it in oldloc. Then Python tries to set locale with user-prefered one by setlocale(LC_ALL, &quot;&quot;), and to decode all command line arguments with new locale. 12345678910111213setlocale(LC_ALL, \"\");for (i = 0; i &lt; argc; i++) &#123; argv_copy[i] = Py_DecodeLocale(argv[i], NULL); if (!argv_copy[i]) &#123; PyMem_RawFree(oldloc); fprintf(stderr, \"Fatal Python error: \" \"unable to decode the command line argument #%i\\n\", i + 1); return 1; &#125; argv_copy2[i] = argv_copy[i];&#125;argv_copy2[argc] = argv_copy[argc] = NULL; After decoding command line arguments with user-prefered locale, Python would like to use the old default C locale and do some clean things. 12setlocale(LC_ALL, oldloc);PyMem_RawFree(oldloc); After everything about decoding and copying arguments is ready, run Python main process: 1res = Py_Main(argc, argv_copy); After finishing Python main process, all memory spaces which were allocated should be released properly with following code: 123456789/* Force again malloc() allocator to release memory blocks allocated before Py_Main() */(void)_PyMem_SetupAllocators(\"malloc\");for (i = 0; i &lt; argc; i++) &#123; PyMem_RawFree(argv_copy2[i]);&#125;PyMem_RawFree(argv_copy);PyMem_RawFree(argv_copy2); And then, return the result through return res;. Before the end In this post, we tried to compile Python with all default configurations, and we explicited the main entry function. In the next post, weâ€™ll get involve with Py_Main function, as well as some Python Objects or types if possible. See you then!","categories":[{"name":"Programming Language","slug":"Programming-Language","permalink":"https://blog.inoki.cc/categories/Programming-Language/"},{"name":"Source Code","slug":"Source-Code","permalink":"https://blog.inoki.cc/categories/Source-Code/"},{"name":"Python","slug":"Programming-Language/Python","permalink":"https://blog.inoki.cc/categories/Programming-Language/Python/"},{"name":"Python","slug":"Source-Code/Python","permalink":"https://blog.inoki.cc/categories/Source-Code/Python/"}],"tags":[{"name":"Python","slug":"Python","permalink":"https://blog.inoki.cc/tags/Python/"},{"name":"Source Code","slug":"Source-Code","permalink":"https://blog.inoki.cc/tags/Source-Code/"}]},{"title":"KDE Craft now delivers with vlc and libvlc on macOS","slug":"Craft-vlc","date":"2019-05-19T19:57:22.000Z","updated":"2025-03-08T09:40:48.556Z","comments":true,"path":"2019/05/19/Craft-vlc/","link":"","permalink":"https://blog.inoki.cc/2019/05/19/Craft-vlc/","excerpt":"","text":"Lacking VLC and libvlc in Craft, phonon-vlc cannot be built successfully on macOS. It caused the failed building of KDE Connect in Craft. As a small step of my GSoC project, I managed to build KDE Connect by removing the phonon-vlc dependency. But itâ€™s not a good solution. I should try to fix phonon-vlc building on macOS. So during the community bonding period, to know better the community and some important tools in the Community, I tried to fix phonon-vlc. Fixing phonon-vlc At first, I installed libVLC in MacPorts. All Header files and libraries are installed into the system path. So theoretically, there should not be a problem of the building of phonon-vlc. But an error occurred: We can figure that the compiling is ok, the error is just at the end, during the linking. The error message tells us there is no QtDBus lib. So to fix it, I made a small patch to add QtDBus manually in the CMakeLists file. 12345678910111213diff --git a/src/CMakeLists.txt b/src/CMakeLists.txtindex 47427b2..1cdb250 100644--- a/src/CMakeLists.txt+++ b/src/CMakeLists.txt@@ -81,7 +81,7 @@ if(APPLE) endif(APPLE) automoc4_add_library(phonon_vlc MODULE $&#123;phonon_vlc_SRCS&#125;)-qt5_use_modules(phonon_vlc Core Widgets)+qt5_use_modules(phonon_vlc Core Widgets DBus) set_target_properties(phonon_vlc PROPERTIES PREFIX \"\" And it works well! A small problem is that Hannah said she didnâ€™t get an error during linking. It may be something about Qt version. If someone gets some idea, welcome to contact me. My Qt version is 5.12.3. Fixing VLC To fix VLC, I tried to pack the VLC binary just like the one on Windows. But unfortunately, in the .app package, the Header files are not completed. Comparing to Windows version, the entire plugins folder is missing. So I made a patch for all those files. But the patch is too huge (25000 lines!). So it is not a good idea to merge it into master branch. Thanks to Hannah, she has made a libs/vlc blueprint in the master branch, so in Craft, feel free to install it by running craft libs/vlc. Troubleshooting If you cannot build libs/vlc, just like me, you can also choose the binary version VLC with Header files patch. The patch of Headers for binary is too big. Adding it to the master branch is not a good idea. So I published it on my own repository: https://github.com/Inokinoki/craft-blueprints-inoki To use it, run craft --add-blueprint-repository https://github.com/inokinoki/craft-blueprints-inoki.git and the blueprint(s) will be added into your local blueprint directory. Then, craft binary/vlc will help get the vlc binary and install Header files, libraries into Craft include path and lib path. Finally, you can build what you want with libvlc dependency. Conclusion Up to now, KDE Connect is using QtMultimedia rather than phonon and phonon-vlc to play a sound. But this work could be also useful for other applications or libraries who depend on phonon, phonon-vlc or vlc. This small step may help build them successfully on macOS. I hope this can help someone!","categories":[{"name":"KDE","slug":"KDE","permalink":"https://blog.inoki.cc/categories/KDE/"},{"name":"Craft","slug":"KDE/Craft","permalink":"https://blog.inoki.cc/categories/KDE/Craft/"},{"name":"Blueprints","slug":"KDE/Craft/Blueprints","permalink":"https://blog.inoki.cc/categories/KDE/Craft/Blueprints/"}],"tags":[{"name":"Craft","slug":"Craft","permalink":"https://blog.inoki.cc/tags/Craft/"},{"name":"KDE","slug":"KDE","permalink":"https://blog.inoki.cc/tags/KDE/"}]},{"title":"Win 10 ARM Installing on Raspberry Pi 3","slug":"Win10-ARM-RPI-INSTALL","date":"2019-05-16T23:44:40.000Z","updated":"2025-03-08T09:40:48.594Z","comments":true,"path":"2019/05/16/Win10-ARM-RPI-INSTALL/","link":"","permalink":"https://blog.inoki.cc/2019/05/16/Win10-ARM-RPI-INSTALL/","excerpt":"","text":"Since Microsoft published their Win 10 on ARM (WoA), many devices based on ARM64 get their own versions of Windows 10. The one I prefer is the Lumia 950 XL stuff by @imbushuo. This gives new life to Lumia 950 and Lumia 950 XL, although WoA cannot be used in the productivity environment on these two phones. This article will show a simple step to install WoA on Raspberry Pi (3rd generation or later). And the platform of your host should be Windows. Preparation You can follow the step on the https://pi64.win/ using WoA deployer. But here, in this article, we will use the other one: Windows on Raspberry Installer on https://www.worproject.ml/. So download and extract it. To install Windows on ARM, we should have a SD card with capacity of more than 8G, 32G is recommanded. Getting image Before flashing, we need prepare the Windows image and drivers. Image can be got on https://uup.rg-adguard.net/. You can follow the guide on https://github.com/WOA-Project/guides/blob/master/GettingWOA.md. Download the script and run it in the cmd. After long waiting, there should be an image file in the same directory of the downloaded script. Getting drivers Download drivers on the same page of Windows on Raspberry Installer. Getting UEFI firmware Access https://github.com/andreiw/RaspberryPiPkg/ and take one .fd file in Binary/prebuilt/ folders, in general, we use the latest one. Its name could be RPI_EFI.fd. Flashing your SD card Open the application and choose your language. Here we just use English for more readers. Choose your SD card. Select the image which you downloaded during the preparing periode, and choose the version you want to install. Select the zipped drivers you downloaded. Select the UEFI firmware you downloaded. And just flash it ! Launch Win 10 on Raspberry Pi If all goes well, you can get into the activation screen of Win 10 (after a really long waiting, because Raspberry Pi is not so performent). Count the processor if you want, and there are many interesting things to do ğŸ˜ƒ Bug fix If you get stuck during the UEFI boot screen, please reboot the device, before the loading bar ended, press an appropriate key to enter BIOS setting. Move Windows boot item as the first one, save and exit.","categories":[{"name":"Embedded System","slug":"Embedded-System","permalink":"https://blog.inoki.cc/categories/Embedded-System/"},{"name":"Raspberry Pi","slug":"Embedded-System/Raspberry-Pi","permalink":"https://blog.inoki.cc/categories/Embedded-System/Raspberry-Pi/"}],"tags":[{"name":"Embedded System","slug":"Embedded-System","permalink":"https://blog.inoki.cc/tags/Embedded-System/"},{"name":"Raspberry Pi","slug":"Raspberry-Pi","permalink":"https://blog.inoki.cc/tags/Raspberry-Pi/"},{"name":"Win 10 ARM","slug":"Win-10-ARM","permalink":"https://blog.inoki.cc/tags/Win-10-ARM/"}]},{"title":"Craft Bootstrap Script","slug":"Craft-bootstrap","date":"2019-05-10T16:41:40.000Z","updated":"2025-03-08T09:40:48.556Z","comments":true,"path":"2019/05/10/Craft-bootstrap/","link":"","permalink":"https://blog.inoki.cc/2019/05/10/Craft-bootstrap/","excerpt":"","text":"Here we talk about KDE Craft buildtool, rather than something like Minecraft, Warcraft or Starcraft. Craft is an open source meta build system and package manager written in Python. It manages dependencies and builds libraries and applications from source, on Windows, Mac, Linux and FreeBSD. Please go to https://community.kde.org/Craft for more information. To setup Craft, follow the steps on Setup Craft on KDE Community Wiki. Here I use Craftin Unix/Linux environment. So, if all is well, we should use source CraftRoot/craft/craftenv.sh to enter the build environment. But try to stop doing this, the subject of the post is to study the bootstrap script. The most important stuffs for bootstrapping of Craft is the craftenv.sh script, which script is used for preparing Craft environment. We try to comprehend the environment configuration script craftenv.sh. What does it happen when we execute source craftenv.sh? Find craftenv.sh directory There is no assumption of interpreter at the beginning of this script. For the compatibility, the script firstly try to get BASH_SOURCE[0]. If nothing is contained in the variable, at least we can infer the interpreter is not a bash Bourne-Again shell. And then for others, if none of ${BASH_SOURCE[0]}, $0 and $_ works, we may use an interpreter which is not supported by this script. We just stop trying to continue the work. Meanwhile, the script store the relative path into $craftRoot. 1234567891011craftRoot=\"$&#123;BASH_SOURCE[0]&#125;\"if [[ -z \"$craftRoot\" ]];then craftRoot=\"$0\"fiif [[ -z \"$craftRoot\" ]];then craftRoot=\"$_\"fiif [[ -z \"$craftRoot\" ]];then echo \"Failed to determine interpreter\" exit 1fi In fact, after the detection, the shell is not important anymore. Which we concerned is just the $craftRoot. Find compatible Python 3 with appropriate minor version Itâ€™s confirmed that Craft would like to use Python 3. It recommends user Python 3.6. Craft bootstrap script uses command -v python-&lt;version&gt; to check if an appropriate version of Python exists. 1234if command -v python3.7 &gt;/dev/null; then CRAFT_PYTHON_BIN=$(command -v python3.7)elif command -v python3.6 &gt;/dev/null; then CRAFT_PYTHON_BIN=$(command -v python3.6) This section is to used to detect whether Python 3.7 or Python 3.6 exists in your system path. By the way, Iâ€™d like to introduce something about versions in software distribution. If this is useful, it will be my pleasure. We usually use Semantic Versioning to describe changes. It means: given a version number MAJOR.MINOR.PATCH, increment the: MAJOR version when you make incompatible API changes, MINOR version when you add functionality in a backwards-compatible manner, and PATCH version when you make backwards-compatible bug fixes. So the difference is in the minor version. We can see the Python 3.7 is also supported by Craft. And the preference is Python 3.7 according to the priority of instruction. Then, the script tries to find other potentially compitable Python version. But at least, it should be Python 3.6. Otherwise it will not continue. 12345678910111213141516171819...else # could not find python 3.6, try python3 if ! command -v python3 &gt;/dev/null; then echo \"Failed to python Python 3.6+\" exit 1 fi # check if python3 is at least version 3.6: python_version=$(python3 --version) # sort and use . as separator and then check if the --version output is sorted later # Note: this is just a sanity check. craft.py should check sys.version comparison=$(printf '%s\\nPython 3.6.0\\n' \"$python_version\" | sort -t.) if [ \"$(echo \"$&#123;comparison&#125;\" | head -n1)\" != \"Python 3.6.0\" ]; then echo \"Found Python3 version $&#123;python_version&#125; is too old. Need at least 3.6\" exit 1 fi CRAFT_PYTHON_BIN=$(command -v python3)fiexport CRAFT_PYTHON_BIN So if Python is ok, its path will be stored in $CRAFT_PYTHON_BIN and exported. As we already have Python, the script uses it immediately, to correct the $craftRoot. If the variable is not a directory, we get its parent directory and replace the $craftRoot. 123if [[ ! -d \"$craftRoot\" ]]; then craftRoot=$($&#123;CRAFT_PYTHON_BIN&#125; -c \"import os; import sys; print(os.path.dirname(os.path.abspath(sys.argv[1])));\" \"$craftRoot\")fi For now, $craftRoot should be craft/ in your Craft install directory. Generating and exporting $CRAFT_ENV The following single line is used for acquiring some environment variables for Craft. 1CRAFT_ENV=$($&#123;CRAFT_PYTHON_BIN&#125; \"$craftRoot/bin/CraftSetupHelper.py\" --setup) In fact, it called bin/CraftSetupHelper.py with --setup option, it does have done many things. 123456789101112131415161718192021222324252627 def run(self): parser = argparse.ArgumentParser() parser.add_argument(\"--get\", action=\"store_true\") parser.add_argument(\"--print-banner\", action=\"store_true\") parser.add_argument(\"--getenv\", action=\"store_true\") parser.add_argument(\"--setup\", action=\"store_true\") parser.add_argument(\"rest\", nargs=argparse.REMAINDER) args = parser.parse_args() if args.get: default = \"\" if len(args.rest) == 3: default = args.rest[2] CraftCore.log.info(CraftCore.settings.get(args.rest[0], args.rest[1], default)) elif args.print_banner: self.printBanner() elif args.getenv: self.printEnv() elif args.setup: self.printEnv() self.printBanner()# ...helper = SetupHelper()if __name__ == '__main__': helper.run() We can see that printEnv and printBanner are invoked, all their ouputs will be filled into $CRAFT_ENV in shell. The generated env variables are too many, here we only talk about the bootstrapping. Maybe there will be an article about those. 123456789101112131415# Split the CraftSetupHelper.py output by newlines instead of any whitespace# to also handled environment variables containing spaces (e.g. $PS1)# See https://stackoverflow.com/q/24628076/894271function export_lines() &#123; local IFS=$'\\n' local lines=($1) local i for (( i=0; i&lt;$&#123;#lines[@]&#125;; i++ )) ; do local line=$&#123;lines[$i]&#125; if [[ \"$line\" =~ \"=\" ]] &amp;&amp; [[ $line != _=* ]] ; then export \"$line\" || true fi done&#125;export_lines \"$CRAFT_ENV\" Then with export_lines, all the lines can be exported seperatly without confusion. Exporting other necessary variables and functions If the prompt exists in $PS1, which means the interpreter is using the strings in $PS1 as its prompt, then the script add CRAFT: before it. This would be realy useful because it could remind user that weâ€™re in the Craft environment. 123if [ -n \"$PS1\" ]; then export PS1=\"CRAFT: $PS1\"fi Then just some useful functions: 123craft() &#123; $&#123;CRAFT_PYTHON_BIN&#125; \"$craftRoot/bin/craft.py\" $@&#125; The main entry of Craft. It will invoke bin/craft.py. All other things will be done in it. 12345678cs() &#123; dir=$(craft -q --ci-mode --get \"sourceDir()\" $1) if (($? &gt; 0));then echo $dir else cd \"$dir\" fi&#125; Change current work directory to source directory in Craft. 12345678cb() &#123; dir=$(craft -q --ci-mode --get \"buildDir()\" $1) if (($? &gt; 0));then echo $dir else cd \"$dir\" fi&#125; Change current work directory to build directory in Craft. 123cr() &#123; cd \"$KDEROOT\"&#125; Change current work directory to root in Craft. And export them 1declare -x -F cs cb cr Conclusion With all environment variables prepared, and some useful function exported, we can begin our trip in building everything with Craft. References KDE Craft wiki, https://community.kde.org/Craft Utilisation de la variable BASH_SOURCE[0], https://logd.fr/utilisation-variable-bash_source/","categories":[{"name":"System","slug":"System","permalink":"https://blog.inoki.cc/categories/System/"},{"name":"Utility","slug":"System/Utility","permalink":"https://blog.inoki.cc/categories/System/Utility/"},{"name":"Build tool","slug":"System/Utility/Build-tool","permalink":"https://blog.inoki.cc/categories/System/Utility/Build-tool/"}],"tags":[{"name":"System","slug":"System","permalink":"https://blog.inoki.cc/tags/System/"},{"name":"Craft","slug":"Craft","permalink":"https://blog.inoki.cc/tags/Craft/"}]},{"title":"Win 10 IoT - Blink","slug":"Win10-IoT-Blink","date":"2019-05-07T22:58:40.000Z","updated":"2025-03-08T09:40:48.596Z","comments":true,"path":"2019/05/07/Win10-IoT-Blink/","link":"","permalink":"https://blog.inoki.cc/2019/05/07/Win10-IoT-Blink/","excerpt":"","text":"Thanks to Microsoft and its UWP application, Win 10 IoT device can share the same framework of normal Win 10 application. In this post, weâ€™ll build a simple short blink application for Win 10 IoT platform. It assums that youâ€™ve already have some knowledgements about GPIO. Connection The Raspberry Pi GPIO pins are defined in Win 10 IoT as following: There is also a â€œPower-on Pullâ€ state for each pin. â€œPullDownâ€ means the pin has no tension, meanwhile â€œPullUpâ€ means the pin has a high tension. Please check PIN Mapping for some more details. Here we choose PIN 11 and PIN 9(Ground) to use. The circuit is like this: The green wire is connected to PIN 11, the brown to PIN 9. Code Use GpioController gpio = GpioController.GetDefault(); to get GPIO controller. Use GpioPin pin = gpio.OpenPin(17) to open a gpio port. PIN 11 is GPIO 17 in Win 10 IoT. Write HIGH to this port pin.Write(GpioPinValue.High);. Set to output mode pin.SetDriveMode(GpioPinDriveMode.Output);. Close port(Here we use using to make it close automately). 1234567891011121314151617181920212223242526272829303132333435public sealed partial class MainPage : Page&#123; public MainPage() &#123; this.InitializeComponent(); this.GPIO(); &#125; DispatcherTimer dispatcherTimer; public void GPIO() &#123; // Create a timer and call dispatcherTimer_Tick every 1 second dispatcherTimer = new DispatcherTimer(); dispatcherTimer.Tick += dispatcherTimer_Tick; dispatcherTimer.Interval = new TimeSpan(0, 0, 1); dispatcherTimer.Start(); &#125; public void dispatcherTimer_Tick(object sender, object e) &#123; // Get the default GPIO controller on the system GpioController gpio = GpioController.GetDefault(); if (gpio == null) return; // GPIO not available on this system // Open GPIO 17 using (GpioPin pin = gpio.OpenPin(17)) &#123; // Latch HIGH value first. This ensures a default value when the pin is set as output pin.Write(GpioPinValue.High); // Set the IO direction as output pin.SetDriveMode(GpioPinDriveMode.Output); &#125; // Close pin - will revert to its power-on state &#125;&#125; Conclusion This video shows you the result:","categories":[{"name":"Embedded System","slug":"Embedded-System","permalink":"https://blog.inoki.cc/categories/Embedded-System/"},{"name":"Raspberry Pi","slug":"Embedded-System/Raspberry-Pi","permalink":"https://blog.inoki.cc/categories/Embedded-System/Raspberry-Pi/"},{"name":"IoT","slug":"Embedded-System/IoT","permalink":"https://blog.inoki.cc/categories/Embedded-System/IoT/"},{"name":"Win 10 IoT","slug":"Embedded-System/IoT/Win-10-IoT","permalink":"https://blog.inoki.cc/categories/Embedded-System/IoT/Win-10-IoT/"}],"tags":[{"name":"Embedded System","slug":"Embedded-System","permalink":"https://blog.inoki.cc/tags/Embedded-System/"},{"name":"Raspberry Pi","slug":"Raspberry-Pi","permalink":"https://blog.inoki.cc/tags/Raspberry-Pi/"},{"name":"Win 10 IoT","slug":"Win-10-IoT","permalink":"https://blog.inoki.cc/tags/Win-10-IoT/"}]},{"title":"ä¸º Newifi 2 (D1) è·¯ç”±å™¨æ„å»º Go è¯­è¨€","slug":"Build-go-for-newifi2-d1-router-chinese","date":"2019-04-30T13:41:40.000Z","updated":"2025-03-08T09:40:48.556Z","comments":true,"path":"2019/04/30/Build-go-for-newifi2-d1-router-chinese/","link":"","permalink":"https://blog.inoki.cc/2019/04/30/Build-go-for-newifi2-d1-router-chinese/","excerpt":"","text":"é€šè¿‡é˜…è¯»è¿™ç¯‡æ–‡ç« æ‚¨åº”å½“å¯ä»¥ä¸ºä»»ä½•ç³»ç»Ÿæ„å»º Go è¯­è¨€ã€‚ English Version å…ˆå†³æ¡ä»¶ ä» Go 1.5 å¼€å§‹ï¼ŒGo è¯­è¨€æ‰€æœ‰çš„æºä»£ç éƒ½ä½¿ç”¨äº† Go æˆ–è€…æ±‡ç¼–è¯­è¨€ã€‚å› æ­¤åœ¨ä¸€ä¸ªå®‰è£…æœ‰ Go è¯­è¨€çš„ç³»ç»Ÿä¸­ä½¿ç”¨ Go è¯­è¨€æ„å»ºå¦ä¸€ä¸ª Go è¯­è¨€ç‰ˆæœ¬ä¼šååˆ†ç®€å•ã€‚è¿™ä¸ªç‰¹æ€§å«åšè¯­è¨€çš„è‡ªä¸¾ã€‚ ä½¿ç”¨ GOOS å’Œ GOARCH ç¯å¢ƒå˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºå¦ä¸€ä¸ªå¹³å°å’Œæ¶æ„æ„å»º Go è¯­è¨€ç¨‹åºï¼Œè¿™æ˜¯ Go çš„äº¤å‰ç¼–è¯‘ç‰¹æ€§ã€‚ å› æ­¤ï¼Œä¸ºæˆ‘çš„ Lenovo Newifi 2(D2) ç¼–è¯‘ Go è¯­è¨€ç¯å¢ƒæ˜¯å¯è¡Œçš„ã€‚è¿™ä¸ªè·¯ç”±å™¨çš„å®˜æ–¹å›ºä»¶åŸºäº Openwrtï¼Œå¤„ç†å™¨ä¸º MT7621ATï¼ŒMIPS æ¶æ„å°ç«¯åºï¼Œé…æœ‰ 256M å†…å­˜ã€‚ æˆ‘å¸Œæœ›èƒ½ä¿ç•™å®˜æ–¹å›ºä»¶è€Œéåˆ·æœºï¼Œå› æ­¤æˆ‘å†³å®šä¸ºæˆ‘çš„è·¯ç”±å™¨æ„å»ºä¸€ä¸ªç‹¬ç«‹çš„ Go è¯­è¨€ç‰ˆæœ¬ã€‚ å‡†å¤‡ åœ¨æ‚¨çš„ç³»ç»Ÿä¸Šå®‰è£… Go&gt;=1.5 ç‰ˆæœ¬: 1234&gt; which go/usr/bin/go&gt; go versiongo version go1.10.4 linux/amd64 å¦‚æœæ‚¨æ²¡æœ‰å®‰è£… Go è¯­è¨€ï¼Œè¯·ä½¿ç”¨æ‚¨å‘è¡Œç‰ˆçš„åŒ…ç®¡ç†å™¨å®‰è£…ã€‚å¯¹äº Ubuntu æ¥è¯´ 1&gt; sudo apt-get install golang-go ä» ä¸‹è½½é¡µé¢ è·å– Go è¯­è¨€æºä»£ç ã€‚ æˆ‘ä½¿ç”¨äº† Golang 1.12.4: 1&gt; wget https://dl.google.com/go/go1.12.4.src.tar.gz æ„å»º è§£å‹ä»£ç åŒ…: 1&gt; tar xvf go1.12.4.src.tar.gz ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š 12345678910111213141516.â”œâ”€â”€ apiâ”œâ”€â”€ AUTHORSâ”œâ”€â”€ CONTRIBUTING.mdâ”œâ”€â”€ CONTRIBUTORSâ”œâ”€â”€ docâ”œâ”€â”€ favicon.icoâ”œâ”€â”€ libâ”œâ”€â”€ LICENSEâ”œâ”€â”€ miscâ”œâ”€â”€ PATENTSâ”œâ”€â”€ README.mdâ”œâ”€â”€ robots.txtâ”œâ”€â”€ srcâ”œâ”€â”€ testâ””â”€â”€ VERSION è¿›å…¥ src ç›®å½•ã€‚å¼€å§‹æ‚¨çš„æ„å»ºï¼š 1234567891011&gt; GOOS=linux GOARCH=mipsle GOROOT_BOOTSTRAP=&lt;your-go-root&gt; ./make.bashBuilding Go cmd/dist using &lt;your-go-path&gt;/go-1.10.Building Go toolchain1 using &lt;your-go-path&gt;/go-1.10.Building Go bootstrap cmd/go (go_bootstrap) using Go toolchain1.Building Go toolchain2 using go_bootstrap and Go toolchain1.Building Go toolchain3 using go_bootstrap and Go toolchain2.Building packages and commands for host, linux/amd64.Building packages and commands for target, linux/mipsle.---Installed Go for linux/mipsle in &lt;your-build-path&gt;/goInstalled commands in &lt;your-build-path&gt;/go/bin å®‰è£… æ„å»ºå®Œæˆåï¼Œå°†ä»¥ä¸‹æ–‡ä»¶å¤¹å¤åˆ¶åˆ°è·¯ç”±å™¨: 123456api bin misc pkg src test æ¯”å¦‚ï¼Œæˆ‘åˆ›å»ºäº† /mnt/mmcblk0p1/usr/share/go æ–‡ä»¶å¤¹æ¥å­˜æ”¾å®ƒä»¬ã€‚ ç´§æ¥ç€ï¼Œä» bin/mipsle å°† go å’Œ gofmt ç§»è‡³ binã€‚ æ·»åŠ  GOROOT ç¯å¢ƒå˜é‡ï¼Œå¹¶æ·»åŠ  bin åˆ° PATH ä¸­: 12&gt; export GOROOT=/mnt/mmcblk0p1/usr/share/go&gt; PATH=$GOROOT/bin:$PATH è¿è¡Œæ‚¨çš„ç¬¬ä¸€ä¸ª Go ç¨‹åº åœ¨ test.go åˆ›å»º Hello World ä»£ç : 12345678package mainimport ( \"fmt\")func main() &#123; fmt.Println(\"hello newifi2\")&#125; ç›´æ¥è¿è¡Œå®ƒ: 12&gt; go run test.gohello newifi2 æˆ–è€…æ„å»º+è¿è¡Œ: 123&gt; go build test.go&gt; ./testhello newifi2 ä¸€åˆ‡ OK!","categories":[{"name":"Embedded System","slug":"Embedded-System","permalink":"https://blog.inoki.cc/categories/Embedded-System/"},{"name":"Cross Compile","slug":"Embedded-System/Cross-Compile","permalink":"https://blog.inoki.cc/categories/Embedded-System/Cross-Compile/"},{"name":"Router","slug":"Embedded-System/Cross-Compile/Router","permalink":"https://blog.inoki.cc/categories/Embedded-System/Cross-Compile/Router/"},{"name":"Chinese","slug":"Chinese","permalink":"https://blog.inoki.cc/categories/Chinese/"}],"tags":[{"name":"ä¸­æ–‡","slug":"ä¸­æ–‡","permalink":"https://blog.inoki.cc/tags/ä¸­æ–‡/"},{"name":"Cross Compile","slug":"Cross-Compile","permalink":"https://blog.inoki.cc/tags/Cross-Compile/"},{"name":"Router","slug":"Router","permalink":"https://blog.inoki.cc/tags/Router/"},{"name":"Go","slug":"Go","permalink":"https://blog.inoki.cc/tags/Go/"}]},{"title":"Build Go for Newifi 2 (D1) router","slug":"Build-go-for-newifi2-d1-router","date":"2019-04-30T13:41:40.000Z","updated":"2025-03-08T09:40:48.556Z","comments":true,"path":"2019/04/30/Build-go-for-newifi2-d1-router/","link":"","permalink":"https://blog.inoki.cc/2019/04/30/Build-go-for-newifi2-d1-router/","excerpt":"","text":"This post will give you a guide to build Go on no matter which system. Chinese Version Prerequisite After Go 1.5, all the source codes are written in Go or Assembly. So in a system where there is a Go install, we can build another Go using Go itself. The feature is called bootstrapping. With GOOS and GOARCH flag, we can build Go program for given platform with given architecture. This is cross compile of Go. So, itâ€™s possible to build a Go environment for my Lenovo Newifi 2 (D1), which is based on OpenWRT, equiped with MIPS Little Endian MT7621AT processor, 256MB memory. But I want to keep the official firmware, so I decided to build an independant build of Go for my router. Preparing Get your Go&gt;=1.5 installed in your system: 1234&gt; which go/usr/bin/go&gt; go versiongo version go1.10.4 linux/amd64 If you donâ€™t have Go installed, please install it with your current package manager. For Ubuntu, 1&gt; sudo apt-get install golang-go Get Golang source code from the downloads page. I chose to use Golang 1.12.4: 1&gt; wget https://dl.google.com/go/go1.12.4.src.tar.gz Building Decompress the tarball: 1&gt; tar xvf go1.12.4.src.tar.gz Weâ€™ll have a directory like this: 12345678910111213141516.â”œâ”€â”€ apiâ”œâ”€â”€ AUTHORSâ”œâ”€â”€ CONTRIBUTING.mdâ”œâ”€â”€ CONTRIBUTORSâ”œâ”€â”€ docâ”œâ”€â”€ favicon.icoâ”œâ”€â”€ libâ”œâ”€â”€ LICENSEâ”œâ”€â”€ miscâ”œâ”€â”€ PATENTSâ”œâ”€â”€ README.mdâ”œâ”€â”€ robots.txtâ”œâ”€â”€ srcâ”œâ”€â”€ testâ””â”€â”€ VERSION Enter src directory. Begin directly your build for mipsle: 1234567891011&gt; GOOS=linux GOARCH=mipsle GOROOT_BOOTSTRAP=&lt;your-go-root&gt; ./make.bashBuilding Go cmd/dist using &lt;your-go-path&gt;/go-1.10.Building Go toolchain1 using &lt;your-go-path&gt;/go-1.10.Building Go bootstrap cmd/go (go_bootstrap) using Go toolchain1.Building Go toolchain2 using go_bootstrap and Go toolchain1.Building Go toolchain3 using go_bootstrap and Go toolchain2.Building packages and commands for host, linux/amd64.Building packages and commands for target, linux/mipsle.---Installed Go for linux/mipsle in &lt;your-build-path&gt;/goInstalled commands in &lt;your-build-path&gt;/go/bin Installing After the building, copy the following folders to the router: 123456api bin misc pkg src test For example, I created /mnt/mmcblk0p1/usr/share/go folder for them. Then move go and gofmt from bin/mipsle to bin. Add GOROOT to environment variables and bin to PATH: 12&gt; export GOROOT=/mnt/mmcblk0p1/usr/share/go&gt; PATH=$GOROOT/bin:$PATH Run your first Go program Create the Hello World code in test.go: 12345678package mainimport ( \"fmt\")func main() &#123; fmt.Println(\"hello newifi2\")&#125; Run it: 12&gt; go run test.gohello newifi2 or build and run it: 123&gt; go build test.go&gt; ./testhello newifi2 Enjoy your journal with Go on your router!","categories":[{"name":"Embedded System","slug":"Embedded-System","permalink":"https://blog.inoki.cc/categories/Embedded-System/"},{"name":"Cross Compile","slug":"Embedded-System/Cross-Compile","permalink":"https://blog.inoki.cc/categories/Embedded-System/Cross-Compile/"},{"name":"Router","slug":"Embedded-System/Cross-Compile/Router","permalink":"https://blog.inoki.cc/categories/Embedded-System/Cross-Compile/Router/"}],"tags":[{"name":"Cross Compile","slug":"Cross-Compile","permalink":"https://blog.inoki.cc/tags/Cross-Compile/"},{"name":"Router","slug":"Router","permalink":"https://blog.inoki.cc/tags/Router/"},{"name":"Go","slug":"Go","permalink":"https://blog.inoki.cc/tags/Go/"}]},{"title":"ã€è¯‘ã€‘ ä»æºä»£ç æ„å»º deb åŒ…","slug":"Debian-build-deb-from-source-code","date":"2019-04-02T21:08:00.000Z","updated":"2025-03-08T09:40:48.562Z","comments":true,"path":"2019/04/02/Debian-build-deb-from-source-code/","link":"","permalink":"https://blog.inoki.cc/2019/04/02/Debian-build-deb-from-source-code/","excerpt":"","text":"åŸæ–‡é“¾æ¥: https://wiki.debian.org/Packaging/Intro Debian æ‰“åŒ…ä»‹ç» æœ¬æ–‡æ˜¯ä¸€ä¸ªå…³äºå¦‚ä½•åˆ¶ä½œ Debian åŒ…çš„ä»‹ç»æ€§æ•™ç¨‹ï¼Œå®ƒä¸ä¼šå¯¹ Debian æ‰“åŒ…ç³»ç»Ÿä¸­çš„å¤æ‚æ¦‚å¿µæ·±å…¥ä»‹ç»ï¼Œä½†å®ƒä»‹ç»äº†èƒ½å¤Ÿä¸ºç®€å•è½¯ä»¶åˆ¶ä½œ Debian åŒ…çš„æ–¹æ³•ã€‚ å‡ºäºè¿™ä¸ªç›®çš„ï¼Œæˆ‘ä»¬åªä½¿ç”¨æ¥è‡ªäº debhelper 9 çš„ dh å‘½ä»¤ã€‚ éœ€æ±‚ è¿™ä¸ªæ•™ç¨‹å‡è®¾æ‚¨å·²ï¼š ç†è§£äºŒè¿›åˆ¶åŒ…çš„å®‰è£…è¿‡ç¨‹ï¼› äº†è§£å‘½ä»¤è¡Œçš„ä½¿ç”¨ï¼Œå¹¶ä¸”ä½¿ç”¨æ‚¨åçˆ±çš„æ–‡æœ¬ç¼–è¾‘å™¨ç¼–è¾‘æ–‡æœ¬æ–‡ä»¶ï¼› æŠ€æœ¯è¦æ±‚ï¼š build-essential devscripts debhelper version 9 æˆ–æ›´é«˜ç‰ˆæœ¬ ä¸‰ä¸ªæ ¸å¿ƒæ¦‚å¿µ ä¸‰ä¸ªæœ€æ ¸å¿ƒçš„æ¦‚å¿µä¸ºï¼š ä¸Šæ¸¸åŸå§‹ä»£ç åŒ…ï¼ˆupstream tarballï¼‰: é€šå¸¸ï¼Œäººä»¬ä¸ºä¸Šæ¸¸å¼€å‘è€…ï¼ˆé€šå¸¸ä¸ºç¬¬ä¸‰æ–¹ï¼‰ç¼–å†™çš„è½¯ä»¶æ‰“åŒ…ã€‚ ä¸Šæ¸¸å¼€å‘è€…ä¼šä½¿ç”¨æºä»£ç å½’æ¡£è½¯ä»¶æˆ–åŸå§‹ä»£ç åŒ…çš„æ–¹å¼å‘æ”¾ä»–ä»¬çš„è½¯ä»¶ã€‚ åŸå§‹ä»£ç åŒ…ä¸€èˆ¬æ˜¯ä¸Šæ¸¸åˆ¶ä½œçš„ .tar.gz æˆ– .tgz æ–‡ä»¶ï¼Œå®ƒä¹Ÿå¯èƒ½è¢«å‹ç¼©æˆ .tar.bz2ï¼Œ.tb2 æˆ– .tar.xz æ ¼å¼ã€‚åŸå§‹ä»£ç åŒ…å°±æ˜¯ Debian æ„å»ºåŒ…æ—¶ä½¿ç”¨çš„åŸææ–™ã€‚ æºç åŒ…ï¼š å½“æ‚¨æ‹¥æœ‰äº†ä¸Šæ¸¸åˆ¶ä½œçš„åŸå§‹ä»£ç åŒ…ï¼Œä¸‹ä¸€æ­¥å°±å¯ä»¥åˆ¶ä½œ Debian æºç åŒ…äº†ã€‚ äºŒè¿›åˆ¶åŒ…ï¼š ä»æºç åŒ…æ‚¨å¯ä»¥æ„å»º Debian äºŒè¿›åˆ¶åŒ…ï¼Œå®ƒæ‰æ˜¯æ˜¯å®é™…ä¸Šä¼šè¢«å®‰è£…çš„åŒ…ã€‚ æœ€ç®€å•çš„æºç åŒ…ç”±3ä¸ªæ–‡ä»¶ç»„æˆï¼š ä¸Šæ¸¸åŸå§‹ä»£ç åŒ…ï¼Œéœ€è¦è¢«é‡å‘½åæ¥ç¬¦åˆä¸€ä¸ªç‰¹å®šçš„æ¨¡å¼ã€‚ ä¸€ä¸ª debian ç›®å½•ï¼Œå¸¦æœ‰æ‰€æœ‰ä¸Šæ¸¸æºä»£ç çš„æ›´æ”¹è®°å½•ï¼Œå¤–åŠ æ‰€æœ‰ä¸º Debian æ‰“åŒ…ç³»ç»Ÿç”Ÿæˆçš„æ‰€æœ‰æ–‡ä»¶ã€‚è¿™ç§åŒ…æ‹¥æœ‰ .debian.tar.gz çš„æ–‡ä»¶åã€‚ ä¸€ä¸ªæè¿°æ–‡ä»¶ï¼ˆä»¥ .dsc ç»“å°¾ï¼‰ï¼Œç½—åˆ—äº†å…¶ä»–ä¸¤ä¸ªæ–‡ä»¶ã€‚ å¬èµ·æ¥æœ‰äº›è¿‡äºå¤æ‚ï¼Œäººä»¬çš„ç¬¬ä¸€å°è±¡æ˜¯ï¼šæ‰€æœ‰ä¸œè¥¿éƒ½æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œä¼šæ›´ç®€å•ã€‚ç„¶è€Œï¼Œä¿æŒä¸Šæ¸¸ä»£ç åŒ…ä¸ Debian ç‰¹å®šæ›´æ”¹åˆ†ç¦»å¯ä»¥èŠ‚çœå¤§é‡ç£ç›˜ç©ºé—´å’Œå¸¦å®½ã€‚å¯¹ Debian æ¥è¯´ï¼Œè¿½è¸ªå¿…è¦çš„ä¿®æ”¹ä¹Ÿæ›´åŠ ç®€å•ã€‚ æ‰“åŒ…å·¥ä½œæµ æ‰“åŒ…å·¥ä½œæµé€šå¸¸å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š é‡å‘½åä¸Šæ¸¸ä»£ç åŒ… è§£å‹ç¼©ä¸Šæ¸¸ä»£ç åŒ… æ·»åŠ  Debian æ‰“åŒ…æ–‡ä»¶ æ„å»ºè¿™ä¸ªåŒ… å®‰è£…è¿™ä¸ªåŒ… ä¹‹åæ‚¨å°±å¯ä»¥åœ¨æ‚¨çš„ç”µè„‘ä¸Šæµ‹è¯•å®ƒäº†ã€‚ æºç åŒ…å’ŒäºŒè¿›åˆ¶åŒ…éƒ½å¯ä»¥è¢«ä¸Šä¼ åˆ° Debianã€‚ ä¸ºäº†è¿™ä¸ªæ•™ç¨‹ï¼Œæˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªä»£ç åŒ…ï¼šhithere ç¬¬ä¸€æ­¥ï¼šæ›´æ”¹ä¸Šæ¸¸ä»£ç åŒ…åç§° Debian æ‰“åŒ…ç³»ç»Ÿå‡å®šä¸Šæ¸¸ä»£ç åŒ…æ‹¥æœ‰ä¸€ä¸ªååˆ†ç‰¹æ®Šçš„åå­—ï¼Œå¿…é¡»éµå®ˆä¸€ä¸ªç‰¹å®šçš„æ¨¡å¼ã€‚å®ƒçš„åå­—ç”±æºä»£ç åŒ…åã€ä¸€ä¸ªä¸‹åˆ’çº¿ã€ä¸Šæ¸¸ç‰ˆæœ¬å·ç»„æˆï¼Œæœ€åä»¥.orig.tar.gz ç»„æˆã€‚æºä»£ç åŒ…åº”å½“å…¨éƒ¨ä½¿ç”¨å°å†™å­—æ¯ï¼Œå¹¶ä¸”åŒ…å«å­—æ¯ã€æ•°å­—ã€ç¬¦å·ï¼Œä¸€äº›å…¶ä»–çš„å­—ç¬¦ä¹Ÿå¯ä»¥å‡ºç°ã€‚ å¦‚æœä¸Šæ¸¸å¼€å‘è€…ä½¿ç”¨äº†ä¸€ä¸ªå¾ˆå¥½çš„ Debian æºä»£ç åŒ…åï¼Œæ‚¨å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚å¦åˆ™ï¼Œè¯·å°½å¯èƒ½å°çš„å¯¹åç§°è¿›è¡Œæ”¹åŠ¨ä»¥é€‚åº” Debianã€‚åœ¨æˆ‘ä»¬çš„æƒ…å†µä¸‹ï¼Œä¸Šæ¸¸å¼€å‘è€…å·²ç»é€‰å–äº†ä¸€ä¸ªå¾ˆå¥½çš„åå­—ï¼šâ€œhithereâ€äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬æ— éœ€æ‹…å¿ƒã€‚æˆ‘ä»¬åº”å½“æœ€ç»ˆä½¿ç”¨ hithere_1.0.orig.tar.gz ä½œä¸ºä¸Šæ¸¸ä»£ç åŒ…çš„åç§°ã€‚è¯·æ³¨æ„ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªä¸‹åˆ’çº¿ï¼Œè€Œä¸æ˜¯â€œ-â€ï¼Œå› ä¸ºæ‰“åŒ…å·¥å…·æå…¶å¹æ¯›æ±‚ç–µã€‚ 1$ mv hithere-1.0.tar.gz hithere_1.0.orig.tar.gz ç¬¬äºŒæ­¥ï¼šè§£å‹ç¼©ä¸Šæ¸¸ä»£ç åŒ… é€šå¸¸æƒ…å†µä¸‹ï¼Œæºä»£ç ä¼šè¿›å…¥ä¸€ä¸ªä»¥åŒ…åå’Œä¸Šæ¸¸ç‰ˆæœ¬å·å‘½åçš„ç›®å½•ä¸­ï¼ˆä½¿ç”¨è¿æ¥ç¬¦è¿æ¥ï¼Œè€Œä¸æ˜¯ä¸‹åˆ’çº¿ï¼‰ï¼Œå› æ­¤ç†æƒ³çŠ¶å†µä¸‹æˆ‘ä»¬ä½¿ç”¨çš„ä¸Šæ¸¸ä»£ç åŒ…ä¼šè¢«è§£å‹ç¼©åˆ°ä¸€ä¸ªå«åšhithere-1.0 çš„ç›®å½•ä¸­ã€‚æ‰“åŒ…å·¥å…·ä»æ—§æŒ‘å‰”ï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»è¿™æ ·åšã€‚ 1$ tar xf hithere_1.0.orig.tar.gz ç¬¬ä¸‰æ­¥ï¼šæ·»åŠ  Debian æ‰“åŒ…æ–‡ä»¶ ä»¥ä¸‹æ‰€æœ‰æ–‡ä»¶éƒ½åœ¨æºç æ ‘çš„ debian/ å­ç›®å½•ä¸­ã€‚ 12$ cd hithere-1.0$ mkdir debian æˆ‘ä»¬éœ€è¦æä¾›ä¸å°‘æ–‡ä»¶ï¼Œè®©æˆ‘ä»¬æŒ‰é¡ºåºæ¥çœ‹ã€‚ debian/changelog ç¬¬ä¸€ä¸ªæ–‡ä»¶æ˜¯ debian/changelogï¼Œè¿™ä¸ªæ˜¯è®°å½• Debian åŒ…å˜åŒ–çš„æ—¥å¿—æ–‡ä»¶ã€‚å®ƒæ— éœ€ç½—åˆ—å‡ºä¸Šæ¸¸ä»£ç çš„æ¯ä¸€ä¸ªæ”¹å˜ï¼Œåªè¦å®ƒèƒ½å¸®åŠ©ç”¨æˆ·æ€»ç»“è¿™äº›å˜åŒ–å³å¯ã€‚æˆ‘ä»¬åœ¨åˆ¶ä½œç¬¬ä¸€ä¸ªç‰ˆæœ¬ï¼Œæ‰€ä»¥è¿™é‡Œåº”å½“ä»€ä¹ˆéƒ½æ²¡æœ‰ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬ä»éœ€åˆ¶ä½œä¸€ä¸ªå˜åŒ–æ—¥å¿—çš„å…¥å£ï¼Œå› ä¸ºæ‰“åŒ…å·¥å…·ä¼šä»æ—¥å¿—é‡Œè¯»å–ç‰¹å®šä¿¡æ¯ã€‚æœ€é‡è¦çš„æ˜¯å®ƒä¼šè¯»å–åŒ…çš„ç‰ˆæœ¬ã€‚ debian/changelog æ‹¥æœ‰ä¸€ä¸ªååˆ†ç‰¹æ®Šçš„æ ¼å¼ã€‚æœ€ç®€å•çš„åˆ›å»ºæ–¹å¼å°±æ˜¯ä½¿ç”¨ dch å·¥å…·ã€‚ 1$ dch --create -v 1.0-1 --package hithere ä¼šåœ¨æ–‡ä»¶ä¸­äº§ç”Ÿä»¥ä¸‹å†…å®¹ï¼š 12345hithere (1.0-1) UNRELEASED; urgency=low * Initial release. (Closes: #XXXXXX) -- Lars Wirzenius &lt;liw@liw.fi&gt; Thu, 18 Nov 2010 17:25:32 +0000 è¿™é‡Œæœ‰å¾ˆå¤šæ³¨æ„ç‚¹ï¼š hithere éƒ¨åˆ†å¿…é¡»ä¸æºä»£ç åŒ…çš„åå­—ç›¸åŒã€‚1.0-1 æ˜¯ç‰ˆæœ¬å·ï¼Œ1.0 éƒ¨åˆ†æ˜¯ä¸Šæ¸¸ç‰ˆæœ¬å·ã€‚-1 éƒ¨åˆ†æ˜¯ Debian çš„ç‰ˆæœ¬ï¼šå®ƒæ˜¯ç¬¬ä¸€ä¸ªä¸Šæ¸¸ç‰ˆæœ¬ä¸º 1.0 çš„ Debian åŒ…ã€‚å¦‚æœè¿™ä¸ª Debian åŒ…æœ‰é”™è¯¯ï¼Œå¹¶ä¸”è¢«ä¿®å¤äº†ï¼Œé‚£ä¹ˆä¸Šæ¸¸ç‰ˆæœ¬å·ä»ä¿æŒç›¸åŒï¼Œä¸‹ä¸€ä¸ªç‰ˆæœ¬åº”å½“è¢«å«åš 1.0-2ï¼Œæ¥ä¸‹æ¥æ˜¯ 1.0-3ï¼Œä¾æ­¤ç±»æ¨ã€‚ UNRELEASED è¢«ç§°ä½œä¸Šä¼ ç›®æ ‡ã€‚å®ƒä¼šå‘Šè¯‰ä¸Šä¼ å·¥å…·è¿™ä¸ªäºŒè¿›åˆ¶åŒ…åº”å½“è¢«ä¸Šä¼ åˆ°å“ªé‡Œã€‚UNRELEASED æ„å‘³ç€è¿™ä¸ªåŒ…è¿˜æ²¡æœ‰åšå¥½ä¸Šä¼ çš„å‡†å¤‡ã€‚ä¿æŒ UNRELEASED æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ï¼Œä»¥é¿å…æ‚¨é”™è¯¯ä¸Šä¼ å®ƒã€‚ ç›®å‰è¯·å…ˆå¿½ç•¥ urgency=lowã€‚ (Closesï¼š#XXXXXX) ä½œç”¨åœ¨äºä¸Šä¼ åŒ…æ—¶å…³é—­é”™è¯¯ã€‚è¿™æ˜¯åœ¨ Debian ä¸­å…³é—­é”™è¯¯çš„å¸¸ç”¨æ–¹æ³•ï¼šå½“ä¸Šä¼ ä¿®å¤é”™è¯¯çš„åŒ…æ—¶ï¼Œé”™è¯¯è·Ÿè¸ªå™¨ä¼šæ³¨æ„åˆ°è¿™ä¸€ç‚¹ï¼Œå¹¶å°†é”™è¯¯æ ‡è®°ä¸ºå·²å…³é—­ã€‚æˆ‘ä»¬å¯ä»¥åˆ é™¤ (Closes...) ä½ã€‚æˆ–è€…ä¸ç®¡å®ƒï¼Œç°åœ¨å®ƒä¸é‡è¦ã€‚ æ›´æ”¹æ—¥å¿—ä¸­çš„æœ€åä¸€è¡ŒæŒ‡å‡ºæ˜¯è°åœ¨ä½•æ—¶åˆ¶ä½œäº†è¿™ä¸ªç‰ˆæœ¬çš„è½¯ä»¶åŒ…ã€‚dch å·¥å…·ä¼šå°è¯•çŒœæµ‹åç§°å’Œç”µå­é‚®ä»¶åœ°å€ï¼Œä½†æ‚¨åº”å½“ä½¿ç”¨æ­£ç¡®çš„è¯¦ç»†ä¿¡æ¯å¯¹å…¶è¿›è¡Œé…ç½®ã€‚è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… dch(1) æ‰‹å†Œé¡µã€‚ debian/compat debian/compat æ˜ç¡® debhelper å·¥å…·çš„å…¼å®¹ç­‰çº§ã€‚æˆ‘ä»¬ç›®å‰ä¸éœ€è¦çŸ¥é“å®ƒæ„å‘³ç€ä»€ä¹ˆã€‚ 110 debian/control æ§åˆ¶æ–‡ä»¶æè¿°ä»£ç å’ŒäºŒè¿›åˆ¶åŒ…ï¼Œå¹¶ç»™å‡ºä»–ä»¬çš„è¯¦ç»†ä¿¡æ¯ï¼Œæ¯”å¦‚åç§°ã€åŒ…çš„ç»´æŠ¤è€…æ˜¯è°ï¼Œç­‰ç­‰ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼š 123456789101112Source: hithereMaintainer: Lars Wirzenius &lt;liw@liw.fi&gt;Section: miscPriority: optionalStandards-Version: 3.9.2Build-Depends: debhelper (&gt;= 9)Package: hithereArchitecture: anyDepends: $&#123;shlibs:Depends&#125;, $&#123;misc:Depends&#125;Description: greet user hithere greets the user, or the world. åœ¨è¿™ä¸ªæ–‡ä»¶é‡Œæœ‰è®¸å¤šéœ€æ±‚çš„å­—æ®µï¼Œä½†æ˜¯ç°åœ¨æ‚¨å¯ä»¥åƒå¯¹å¾…é­”æ³•ä¸€æ ·å¯¹å¾…å®ƒã€‚é‚£ä¹ˆï¼Œåœ¨ debian/control ä¸­æœ‰ä¸¤æ®µæ–‡å­—ã€‚ ç¬¬ä¸€æ®µæ–‡å­—æè¿°äº†æºä»£ç åŒ…ï¼Œä½¿ç”¨ä»¥ä¸‹å­—æ®µï¼š Source æºä»£ç åŒ…åã€‚ Maintainer ç»´æŠ¤è€…çš„å§“åå’Œç”µå­é‚®ç®±ã€‚ Priority åŒ…çš„é‡è¦æ€§ï¼ˆâ€˜required å¯é€‰çš„â€™, â€˜important é‡è¦çš„â€™, â€˜standard æ ‡å‡†â€™ æˆ– â€˜optionalâ€™ å…¶ä¸­ä¹‹ä¸€ï¼‰ã€‚é€šå¸¸ï¼ŒåŒ…æ˜¯â€œå¯é€‰â€çš„ï¼Œé™¤éå®ƒå¯¹äºæ ‡å‡†ç³»ç»ŸåŠŸèƒ½æ˜¯â€œå¿…ä¸å¯å°‘çš„â€ï¼Œå³å¯åŠ¨æˆ–ç½‘ç»œåŠŸèƒ½ã€‚ å¦‚æœåŒ…ä¸å¦ä¸€ä¸ªâ€œå¯é€‰â€åŒ…å†²çªï¼Œæˆ–è€…å®ƒä¸æ‰“ç®—ç”¨äºæ ‡å‡†æ¡Œé¢å®‰è£…ï¼Œåˆ™åº”è¯¥æ˜¯â€œé¢å¤–â€çš„è€Œä¸æ˜¯â€œå¯é€‰â€çš„ã€‚ â€œé¢å¤–â€åŒ…çš„æ˜¾ç€ä¾‹å­æ˜¯è°ƒè¯•åŒ…ã€‚ ï¼ˆç”±Sebastian Tennantæ·»åŠ ï¼‰ã€‚ Build-Depends éœ€è¦å®‰è£…ä»¥æ„å»ºç¨‹åºåŒ…çš„ç¨‹åºåŒ…åˆ—è¡¨ã€‚å®é™…ä½¿ç”¨åŒ…æ—¶æœ‰å¯èƒ½éœ€è¦å®ƒä»¬ã€‚ ç¬¬ä¸€ä¸ªä¹‹åçš„æ‰€æœ‰æ®µè½éƒ½æè¿°äº†ä»æ­¤æºæ„å»ºçš„äºŒè¿›åˆ¶åŒ…ã€‚ å¯ä»¥æœ‰è®¸å¤šä»åŒä¸€æ¥æºæ„å»ºçš„äºŒè¿›åˆ¶åŒ…; ä½†å¯¹äºæˆ‘ä»¬çš„ä¾‹å­åªæœ‰ä¸€ä¸ªã€‚ æˆ‘ä»¬ä½¿ç”¨è¿™äº›å­—æ®µï¼š Package äºŒè¿›åˆ¶åŒ…çš„åç§°ã€‚ åç§°å¯èƒ½ä¸æºåŒ…åç§°ä¸åŒã€‚ Architecture æŒ‡å®šäºŒè¿›åˆ¶åŒ…é¢„æœŸä½¿ç”¨çš„è®¡ç®—æœºä½“ç³»ç»“æ„ï¼šç”¨äº32ä½Intel CPUçš„i386ï¼Œç”¨äº64ä½çš„amd64ï¼Œç”¨äºARMå¤„ç†å™¨çš„armelç­‰ç­‰ã€‚ Debianæ€»å…±å¯ä»¥å¤„ç†å¤§çº¦åå‡ ç§è®¡ç®—æœºä½“ç³»ç»“æ„ï¼Œå› æ­¤è¿™ç§ä½“ç³»ç»“æ„æ”¯æŒè‡³å…³é‡è¦ã€‚ â€œArchitectureâ€å­—æ®µå¯ä»¥åŒ…å«ç‰¹å®šä½“ç³»ç»“æ„çš„åç§°ï¼Œä½†é€šå¸¸å®ƒåŒ…å«ä¸¤ä¸ªç‰¹æ®Šå€¼ä¸­çš„ä¸€ä¸ªã€‚ any ï¼ˆæˆ‘ä»¬åœ¨ç¤ºä¾‹ä¸­çœ‹åˆ°ï¼‰æ„å‘³ç€å¯ä»¥ä¸ºä»»ä½•ä½“ç³»ç»“æ„æ„å»ºåŒ…ã€‚ æ¢å¥è¯è¯´ï¼Œä»£ç æ˜¯å¯ç§»æ¤çš„ï¼Œå› æ­¤å®ƒä¸ä¼šå¯¹ç¡¬ä»¶åšå¤ªå¤šå‡è®¾ã€‚ ä½†æ˜¯ï¼Œä»ç„¶éœ€è¦ä¸ºæ¯ä¸ªä½“ç³»ç»“æ„å•ç‹¬æ„å»ºäºŒè¿›åˆ¶åŒ…ã€‚ all æ„å‘³ç€ç›¸åŒçš„äºŒè¿›åˆ¶åŒ…å°†é€‚ç”¨äºæ‰€æœ‰ä½“ç³»ç»“æ„ï¼Œè€Œæ— éœ€ä¸ºæ¯ä¸ªä½“ç³»ç»“æ„å•ç‹¬æ„å»ºã€‚ ä¾‹å¦‚ï¼Œä»…åŒ…å«shellè„šæœ¬çš„åŒ…å°†æ˜¯â€œallâ€ã€‚ Shellè„šæœ¬åœ¨ä»»ä½•åœ°æ–¹éƒ½å¯ä»¥å·¥ä½œï¼Œä¸éœ€è¦ç¼–è¯‘ã€‚ Depends ä¸ºäº†è®©äºŒè¿›åˆ¶åŒ…ä¸­ç¨‹åºèƒ½å¤Ÿæ­£å¸¸è¿è¡Œï¼Œéœ€è¦å®‰è£…çš„åŒ…åˆ—è¡¨ã€‚æ‰‹åŠ¨åˆ—å‡ºè¿™äº›ä¾èµ–é¡¹æ˜¯ç¹çä¸”å®¹æ˜“å‡ºé”™çš„å·¥ä½œã€‚ä¸ºäº†èƒ½å¤Ÿè®©å…¶å·¥ä½œï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªç¥å¥‡çš„å°ä¸œè¥¿ ${shlibs:Depends}ã€‚å¦ä¸€ä¸ªç¥å¥‡çš„ä¸œè¥¿æ˜¯ç»™ debhelper çš„ï¼Œå®ƒæ˜¯ ${misc:Depends}ã€‚shlibs æ˜¯ä¸ºäº†åŠ¨æ€é“¾æ¥åº“ï¼Œè€Œ misc æ˜¯ä¸ºäº† debherlper çš„ä¸€äº›å·¥ä½œã€‚å¯¹äºåˆ«çš„ä¾èµ–ï¼Œæ‚¨å¯ä»¥å°†å…¶æ‰‹åŠ¨åŠ å…¥åˆ° Depends æˆ– Build-Depends ä¸­ã€‚ä½†è¯·æ³¨æ„ï¼Œ${...} ä»…åœ¨ Depends ä¸­æœ‰æ•ˆã€‚ Description äºŒè¿›åˆ¶åŒ…çš„å®Œæ•´æè¿°ã€‚å®ƒå¸Œæœ›å¯¹ç”¨æˆ·æœ‰æ‰€å¸®åŠ©ã€‚ç¬¬ä¸€è¡Œç”¨ä½œç®€è¦æ¦‚è¦ï¼ˆæ‘˜è¦ï¼‰æè¿°ï¼Œå…¶ä½™éƒ¨åˆ†æ˜¯åŒ…çš„æ›´é•¿çš„æè¿°ã€‚ å‘½ä»¤ cme edit dpkg æä¾›äº†ä¸€ä¸ªGUIèƒ½å¤Ÿç”¨æ¥ç¼–è¾‘å¤§å¤šæ•°æ‰“åŒ…æ–‡ä»¶ï¼ŒåŒ…æ‹¬ debian/controlã€‚ è¯·å‚é˜…ä½¿ç”¨ cme é¡µé¢ç®¡ç† Debian è½¯ä»¶åŒ…ã€‚cmeå‘½ä»¤åœ¨ Debian ä¸­çš„ cme åŒ…ä¸­æä¾›ã€‚æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ cme edit dpkg-control å‘½ä»¤ä»…ç¼–è¾‘ debian/control æ–‡ä»¶ã€‚ debian/copyright è¿™æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„æ–‡ä»¶ï¼Œä½†æ˜¯ç°åœ¨æˆ‘ä»¬å°†å…ˆä½¿ç”¨ä¸€ä¸ªç©ºæ–‡ä»¶ã€‚ å¯¹äº Debian ï¼Œæ­¤æ–‡ä»¶ç”¨äºè·Ÿè¸ªæœ‰å…³åŒ…çš„åˆæ³•æ€§ã€ç‰ˆæƒç›¸å…³ä¿¡æ¯ã€‚ä½†æ˜¯ï¼Œä»æŠ€æœ¯è§’åº¦æ¥çœ‹ï¼Œè¿™å¹¶ä¸é‡è¦ã€‚ç›®å‰ï¼Œæˆ‘ä»¬å°†ä¸“æ³¨äºæŠ€æœ¯æ–¹é¢ã€‚å¦‚æœæœ‰å…´è¶£ï¼Œæˆ‘ä»¬å¯ä»¥ç¨åå†å›åˆ° debian/copyrightã€‚ debian/rules å®ƒåº”å½“é•¿è¿™ä¸ªæ ·ï¼š 123#!/usr/bin/make -f%: dh $@ æ³¨æ„ï¼š æœ€åä¸€è¡Œåº”å½“ä½¿ç”¨ä¸€ä¸ª Tab å­—ç¬¦è¿›è¡Œç¼©è¿›ï¼Œè€Œä¸ä½¿ç”¨ç©ºæ ¼ã€‚è¿™ä¸ªæ–‡ä»¶æ˜¯ä¸€ä¸ª Makefileï¼Œå› æ­¤ Tab å­—ç¬¦æ˜¯ make æ‰€æœŸæœ›çš„ã€‚ äº‹å®ä¸Š debian/rules å¯èƒ½æ˜¯ä¸€ä¸ªç›¸å½“å¤æ‚çš„æ–‡ä»¶ã€‚ç„¶è€Œï¼Œåœ¨ debhelper 7 ä¸­çš„ dh å‘½ä»¤è®©å®ƒå¯ä»¥åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹å˜å¾—æ›´ç®€å•ã€‚ debian/source/format æœ€åä¸€ä¸ªæˆ‘ä»¬éœ€è¦çš„æ–‡ä»¶æ˜¯ debian/source/formatï¼Œå®ƒåº”å½“åŒ…å«æºä»£ç åŒ…çš„ç‰ˆæœ¬å·ï¼Œè¿™é‡Œä¸º 3.0 (quilt)ã€‚ 13.0 (quilt) ç¬¬å››æ­¥ï¼šæ„å»ºè¿™ä¸ªåŒ… ç¬¬ä¸€æ¬¡å°è¯• ç°åœ¨æˆ‘ä»¬å¯ä»¥æ„å»ºè¿™ä¸ªåŒ…äº†ã€‚æœ‰å¾ˆå¤šæˆ‘ä»¬å¯ä»¥ä½¿ç”¨çš„å‘½ä»¤ï¼Œä½†æ˜¯æˆ‘ä»¬åªä½¿ç”¨å…¶ä¸­ä¸€ä¸ªï¼Œå¦‚æœæ‚¨è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œæ‚¨ä¼šå¾—åˆ°åƒä¸‹é¢çš„è¾“å‡ºï¼š 1234567891011$ debuild -us -ucmake[1]: Entering directory '/home/liw/debian-packaging-tutorial/x/hithere-1.0'install hithere /home/liw/debian-packaging-tutorial/x/hithere-1.0/debian/hithere/usr/local/bininstall: cannot create regular file '/home/liw/debian-packaging-tutorial/x/hithere-1.0/debian/hithere/usr/local/bin': No such file or directorymake[1]: *** [install] Error 1make[1]: Leaving directory '/home/liw/debian-packaging-tutorial/x/hithere-1.0'dh_auto_install: make -j1 install DESTDIR=/home/liw/debian-packaging-tutorial/x/hithere-1.0/debian/hithere returned exit code 2make: *** [binary] Error 29dpkg-buildpackage: error: fakeroot debian/rules binary gave error exit status 2debuild: fatal error at line 1325:dpkg-buildpackage -rfakeroot -D -us -uc failed æœ‰äº›åœ°æ–¹ä¸å¤ªå¯¹åŠ²ã€‚è¿™ç»å¸¸å‘ç”Ÿï¼šæ‚¨å·²ç»å°½åŠ›åˆ›å»ºäº†ç¬¦åˆè§„èŒƒçš„ debian/* æ–‡ä»¶äº†ï¼Œä½†æ˜¯ä»æœ‰ä¸€äº›ä¸œè¥¿ä¸å¤ªå¯¹åŠ²ã€‚å¯è§ï¼Œå‡ºé”™çš„åœ°æ–¹åœ¨ï¼š 1install hithere /home/liw/debian-packaging-tutorial/x/hithere-1.0/debian/hithere/usr/local/bin ä¸Šæ¸¸ä»£ç ä¸­çš„ Makefile å°è¯•å°†ç¨‹åºå®‰è£…åˆ°é”™è¯¯çš„åœ°æ–¹ã€‚ è¿™è¾¹æœ‰è®¸å¤šå¯ä»¥åšçš„äº‹æƒ…ï¼Œæ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼šç¬¬ä¸€ä»¶äº‹æ˜¯ Debian æ‰“åŒ…ç³»ç»Ÿå¦‚ä½•å·¥ä½œã€‚ ä¿®æ­£ å½“ç¨‹åºè¢«æ„å»ºå¹¶è¢«â€œå®‰è£…â€æ—¶ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œå®ƒè¿˜ä¸ä¼šè¢«å®‰è£…åˆ° /usr æˆ–è€… /usr/localï¼Œè€Œæ˜¯è¢«å®‰è£…åˆ° debian/ å­ç›®å½•ã€‚ æˆ‘ä»¬åœ¨ debian/hithere ç›®å½•ä¸‹åˆ›å»ºäº†ä¸€ä¸ªæ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿçš„å­é›†ï¼Œå¹¶å°†å…¶æ‰“åŒ…è¿›äºŒè¿›åˆ¶åŒ…ä¸­ã€‚å› æ­¤ .../debian/hithere/usr/local/bin æ˜¯æ²¡é—®é¢˜çš„ï¼Œé™¤éå®ƒä¸åº”å½“è¢«å®‰è£…åˆ° usr/local è€Œæ˜¯ usr ç›®å½•ã€‚æˆ‘ä»¬éœ€è¦åšä¸€äº›äº‹æƒ…æ¥ç¡®ä¿ç¨‹åºè¢«å®‰è£…åˆ°æ­£ç¡®çš„ä½ç½® debian/hithere/usr/binã€‚æ­£ç¡®çš„æ–¹æ³•æ˜¯ä¿®æ”¹ debian/rules æ–‡ä»¶æ¥å‘Šè¯‰ Makefile åº”å½“åœ¨å“ªé‡Œå®‰è£…è½¯ä»¶ã€‚ 123456#!/usr/bin/make -f%: dh $@override_dh_auto_install: $(MAKE) DESTDIR=$$(pwd)/debian/hithere prefix=/usr install è¿™ä¸ªä»æ˜¯ä¸€ä¸ªå°é­”æ³•ï¼Œä¸ºäº†ç†è§£å®ƒï¼Œæ‚¨åº”å½“çŸ¥é“ Makefile å¦‚ä½•å·¥ä½œï¼Œè¿˜åº”å½“çŸ¥é“ debhelper çš„ä¸åŒé˜¶æ®µã€‚ ç›®å‰ï¼Œæˆ‘å¯ä»¥å¤§æ¦‚è¯´æ˜ä¸‹ï¼šæœ‰ä¸€ä¸ªåä¸º debherlper çš„å‘½ä»¤è´Ÿè´£å®‰è£…ä¸Šæ¸¸æ–‡ä»¶ï¼Œè¿™ä¸ªé˜¶æ®µè¢«ç§°ä¸º dh_auto_installã€‚æˆ‘ä»¬éœ€è¦è¦†ç›–è¿™ä¸ªé˜¶æ®µï¼Œä¸ºæ­¤ï¼Œæˆ‘ä»¬åœ¨ debian/rule ä¸­é‡å†™äº† override_dh_auto_install è§„åˆ™ã€‚è¿™ä¸ªæ–‡ä»¶çš„æœ€åä¸€è¡Œæ˜¯ä¸€ç§1970å¹´ä»£çš„æŠ€æœ¯ï¼Œä¸ºäº†ä» debian/rules ä¸­ä½¿ç”¨æ­£ç¡®çš„å‚æ•°è°ƒç”¨ä¸Šæ¸¸ä¸­çš„ Makefile æ–‡ä»¶ã€‚ è®©æˆ‘ä»¬å†è¯•ä¸€ä¸‹ã€‚ 1$ debuild -us -uc ä»ç„¶å¤±è´¥äº†ï¼ä½†è¿™æ¬¡å¤±è´¥çš„å‘½ä»¤æ˜¯ï¼š 1install hithere /home/liw/debian-packaging-tutorial/x/hithere-1.0/debian/hithere/usr/bin æˆ‘ä»¬æ­£åœ¨å°è¯•å°†è½¯ä»¶å®‰è£…è‡³æ­£ç¡®çš„åœ°æ–¹ï¼Œä½†æ˜¯è¿™ä¸ªç›®å½•ä¸å­˜åœ¨ã€‚ä¸ºäº†ä¿®æ­£è¿™ä¸ªé”™è¯¯ï¼Œæˆ‘ä»¬åº”å½“å‘Šè¯‰æ‰“åŒ…å·¥å…·å…ˆåˆ›å»ºè¿™ä¸ªç›®å½•ã€‚ ç†æƒ³çŠ¶å†µä¸‹ï¼Œä¸Šæ¸¸ Makefile æ–‡ä»¶ä¼šè‡ªåŠ¨åˆ›å»ºç›®å½•ï¼Œä½†è¿™ç§æƒ…å†µä¸‹ï¼Œæ˜¯ä¸Šæ¸¸å¼€å‘è€…å¤ªæ‡’æƒ°äº†ï¼Œä»–æ²¡æœ‰åˆ›å»ºè¿™ä¸ªç›®å½•ã€‚ å¦ä¸€ä¸ªä¿®æ­£ æ‰“åŒ…å·¥å…·ï¼ˆç‰¹åˆ«æ˜¯debhelperï¼‰æä¾›äº†ä¸€ç§å®ç°æ–¹å¼ã€‚åˆ›å»ºä¸€ä¸ªåä¸º debian/hithere.dirs çš„æ–‡ä»¶ï¼Œé‡Œé¢çš„å†…å®¹åº”å½“æ˜¯ï¼š 12usr/binusr/share/man/man1 ç¬¬äºŒè¡Œåˆ›å»ºäº†ä¸€ä¸ªç»™æ‰‹å†Œé¡µé¢çš„ç›®å½•ã€‚ä¹‹åæˆ‘ä»¬ä¼šéœ€è¦å®ƒã€‚æ‚¨åº”å½“å°å¿ƒçš„ç»´æŠ¤è¿™æ ·çš„æ–‡ä»¶ï¼Œå› ä¸ºå®ƒå¯èƒ½ä¼šå¯¼è‡´æ‚¨çš„åŒ…åœ¨æœªæ¥ç‰ˆæœ¬äº§ç”Ÿç©ºç›®å½•ï¼Œå½“åŒ…ä¸­çš„é¡¹ç›®ä¸å†æœ‰æ•ˆæ—¶ã€‚ è®©æˆ‘ä»¬å†è¯•ä¸€ä¸‹ï¼š 1$ debuild -us -uc ç°åœ¨æ„å»ºæˆåŠŸäº†ï¼Œä½†æ˜¯ä»æœ‰ä¸€äº›å°é—®é¢˜ã€‚debuild è¿è¡Œäº† lintian å·¥å…·ï¼Œè¿™ä¸ªå·¥å…·å¯ä»¥æ£€æµ‹æ„å»ºçš„åŒ…çš„ä¸€äº›å¸¸è§çš„é”™è¯¯ï¼Œå®ƒç»™å‡ºäº†æˆ‘ä»¬åˆ›å»ºçš„åŒ…çš„ä¸€äº›é”™è¯¯ï¼š 123456Now running lintian...W: hithere source: out-of-date-standards-version 3.9.0 (current is 3.9.1)W: hithere: copyright-without-copyright-noticeW: hithere: new-package-should-close-itp-bugW: hithere: wrong-bug-number-in-closes l3:#XXXXXXFinished running lintian. è¿™äº›é”™è¯¯åº”å½“è¢«ä¿®æ­£ï¼Œä½†æ˜¯å¯¹æˆ‘ä»¬æ¥è¯´å®ƒä»¬ä¸ä¼šå¯¼è‡´é”™è¯¯ã€‚ç°åœ¨æˆ‘ä»¬å…ˆå¿½ç•¥ä»–ä»¬ã€‚æŸ¥çœ‹çˆ¶ç›®å½•ï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°æ„å»ºå¥½çš„åŒ…ã€‚ 1234$ ls ..hithere-1.0 hithere_1.0-1_amd64.deb hithere_1.0.orig.tar.gzhithere_1.0-1_amd64.build hithere_1.0-1.debian.tar.gzhithere_1.0-1_amd64.changes hithere_1.0-1.dsc ç¬¬äº”æ­¥ï¼šå®‰è£…æ„å»ºå¥½çš„åŒ… æ¥ä¸‹æ¥çš„å‘½ä»¤ä¼šå®‰è£…æ‚¨æ„å»ºå¥½çš„åŒ…ã€‚ä¸è¦åœ¨è®¡ç®—æœºä¸Šç›´æ¥è¿è¡Œå®ƒï¼Œé™¤éæ‚¨ä¸ä»‹æ„æŸåç³»ç»Ÿã€‚ é€šå¸¸æƒ…å†µä¸‹ï¼Œåœ¨å¤‡ä»½å¥½çš„è®¡ç®—æœºä¸Šè¿›è¡ŒåŒ…å¼€å‘æ˜¯æœ€å¥½çš„ï¼Œè¿™æ ·ï¼Œåœ¨æ‰€æœ‰äº‹æƒ…å˜ç³Ÿç³•çš„æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥ä¸ç”¨å®Œå…¨å®‰è£…æ•´ä¸ªç³»ç»Ÿã€‚è™šæ‹Ÿæœºæ˜¯ä¸€ä¸ªä¸é”™çš„è¿›è¡Œå¼€å‘çš„åœ°æ–¹ã€‚ 123456789$ sudo dpkg -i ../hithere_1.0-1_amd64.deb[sudo] password for liw:Selecting previously deselected package hithere.(Reading database ... 154793 files and directories currently installed.)Unpacking hithere (from ../hithere_1.0-1_amd64.deb) ...Setting up hithere (1.0-1) ...Processing triggers for man-db ...liw@havelock$ é‚£ä¹ˆï¼Œå¦‚ä½•æµ‹è¯•æ‰“å¥½çš„åŒ…å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥è¿è¡Œå‘½ä»¤ï¼š 1$ hithere OK äº†ï¼ ä½†ç°åœ¨å¹¶ä¸å®Œç¾ã€‚è®°å¾— lintian è¿˜æœ‰ä¸€äº›äº‹æƒ…æ¶µå¾…è§£å†³ï¼Œdebian/copyright ä»ç„¶æ˜¯ç©ºçš„ï¼Œç­‰ç­‰ã€‚æˆ‘ä»¬ç°åœ¨æœ‰äº†ä¸€ä¸ªå¯ä»¥è¿è¡Œçš„ deb åŒ…äº†ï¼Œä½†æ˜¯å®ƒè¿˜å¹¶ä¸æ˜¯æˆ‘ä»¬æ‰€æœŸå¾…çš„é«˜è´¨é‡çš„ Debian åŒ…ã€‚ ç»“è®º ä¸€æ—¦æ‚¨æ„å»ºäº†æ‚¨è‡ªå·±çš„åŒ…ï¼Œè‡ªç„¶è€Œç„¶åœ°ï¼Œæ‚¨ä¼šæƒ³è¦çŸ¥é“å¦‚ä½•è®¾ç½®æ‚¨è‡ªå·±çš„ apt ä»“åº“ï¼Œè¿™æ ·æ‚¨è‡ªå·±çš„åŒ…ä¼šå¾ˆå®¹æ˜“è¢«å®‰è£…ã€‚æˆ‘æ‰€çŸ¥é“çš„æœ€å¥½çš„å·¥å…·æ˜¯ repreproã€‚ä¸ºäº†æ›´å¤šçš„æµ‹è¯•æ‚¨çš„åŒ…ï¼Œæ‚¨å¯èƒ½ä¹Ÿä¼šæƒ³è¦äº†è§£ piupartsã€‚åŸä½œè€…ç¼–å†™çš„è¿™ä¸ªå·¥å…·ï¼Œä»–è§‰å¾—è¿™ä¸ªå·¥å…·å¾ˆæ£’å¹¶ä¸”æ²¡æœ‰ä»»ä½• bug ï¼ æœ€åï¼Œå¦‚æœæ‚¨å¼€å§‹ä¿®æ”¹ä¸Šæ¸¸ä»£ç ï¼Œæ‚¨å¯èƒ½æƒ³è¦äº†è§£ä¸€ä¸‹ quilt å·¥å…·ã€‚ å…¶ä»–æ‚¨å¯èƒ½æƒ³è¦é˜…è¯»çš„ä¿¡æ¯å¯ä»¥åœ¨ http://www.debian.org/devel/ é¡µé¢æ‰¾åˆ°ã€‚","categories":[{"name":"Package","slug":"Package","permalink":"https://blog.inoki.cc/categories/Package/"},{"name":"Debian","slug":"Package/Debian","permalink":"https://blog.inoki.cc/categories/Package/Debian/"}],"tags":[{"name":"ç¿»è¯‘","slug":"ç¿»è¯‘","permalink":"https://blog.inoki.cc/tags/ç¿»è¯‘/"},{"name":"ä¸­æ–‡","slug":"ä¸­æ–‡","permalink":"https://blog.inoki.cc/tags/ä¸­æ–‡/"},{"name":"Pack","slug":"Pack","permalink":"https://blog.inoki.cc/tags/Pack/"},{"name":"Debian","slug":"Debian","permalink":"https://blog.inoki.cc/tags/Debian/"}]},{"title":"Linux manual epoll(7)","slug":"man-epoll","date":"2019-03-24T10:49:40.000Z","updated":"2025-03-08T09:40:48.611Z","comments":true,"path":"2019/03/24/man-epoll/","link":"","permalink":"https://blog.inoki.cc/2019/03/24/man-epoll/","excerpt":"","text":"NAME epoll - I/O event notification facility SYNOPSIS #include &lt;sys/epoll.h&gt; DESCRIPTION The epoll API performs a similar task to poll(2): monitoring multiple file descriptors to see if I/O is possible on any of them. The epoll API can be used either as an edge-triggered or a level-triggered interface and scales well to large numbers of watched file descriptors. The central concept of the epoll API is the epoll instance, an inkernel data structure which, from a user-space perspective, can be considered as a container for two lists: The interest list (sometimes also called the epoll set): the set of file descriptors that the process has registered an interest in monitoring. The ready list: the set of file descriptors that are â€œreadyâ€ for I/O. The ready list is a subset of (or, more precisely, a set of references to) the file descriptors in the interest list that is dynamically populated by the kernel as a result of I/O activity on those file descriptors. The following system calls are provided to create and manage an epoll instance: epoll_create(2) creates a new epoll instance and returns a file descriptor referring to that instance. (The more recent epoll_create1(2) extends the functionality of epoll_create(2).) Interest in particular file descriptors is then registered via epoll_ctl(2), which adds items to the interest list of the epoll instance. epoll_wait(2) waits for I/O events, blocking the calling thread if no events are currently available. (This system call can be thought of as fetching items from the ready list of the epoll instance.) Level-triggered and edge-triggered The epoll event distribution interface is able to behave both as edge-triggered (ET) and as level-triggered (LT). The difference between the two mechanisms can be described as follows. Suppose that this scenario happens: The file descriptor that represents the read side of a pipe (rfd) is registered on the epoll instance. A pipe writer writes 2 kB of data on the write side of the pipe. A call to epoll_wait(2) is done that will return rfd as a ready file descriptor. The pipe reader reads 1 kB of data from rfd. A call to epoll_wait(2) is done. If the rfd file descriptor has been added to the epoll interface using the EPOLLET (edge-triggered) flag, the call to epoll_wait(2) done in step 5 will probably hang despite the available data still present in the file input buffer; meanwhile the remote peer might be expecting a response based on the data it already sent. The reason for this is that edge-triggered mode delivers events only when changes occur on the monitored file descriptor. So, in step 5 the caller might end up waiting for some data that is already present inside the input buffer. In the above example, an event on rfd will be generated because of the write done in 2 and the event is consumed in 3. Since the read operation done in 4 does not consume the whole buffer data, the call to epoll_wait(2) done in step 5 might block indefinitely. An application that employs the EPOLLET flag should use nonblocking file descriptors to avoid having a blocking read or write starve a task that is handling multiple file descriptors. The suggested way to use epoll as an edge-triggered (EPOLLET) interface is as follows: i with nonblocking file descriptors; and ii by waiting for an event only after read(2) or write(2) return EAGAIN. By contrast, when used as a level-triggered interface (the default, when EPOLLET is not specified), epoll is simply a faster poll(2), and can be used wherever the latter is used since it shares the same semantics. Since even with edge-triggered epoll, multiple events can be generated upon receipt of multiple chunks of data, the caller has the option to specify the EPOLLONESHOT flag, to tell epoll to disable the associated file descriptor after the receipt of an event with epoll_wait(2). When the EPOLLONESHOT flag is specified, it is the caller's responsibility to rearm the file descriptor using epoll_ctl(2) with EPOLL_CTL_MOD. If multiple threads (or processes, if child processes have inherited the epoll file descriptor across fork(2)) are blocked in epoll_wait(2) waiting on the same the same epoll file descriptor and a file descriptor in the interest list that is marked for edge- triggered (EPOLLET) notification becomes ready, just one of the threads (or processes) is awoken from epoll_wait(2). This provides a useful optimization for avoiding &quot;thundering herd&quot; wake-ups in some scenarios. Interaction with autosleep If the system is in autosleep mode via /sys/power/autosleep and an event happens which wakes the device from sleep, the device driver will keep the device awake only until that event is queued. To keep the device awake until the event has been processed, it is necessary to use the epoll_ctl(2) EPOLLWAKEUP flag. When the EPOLLWAKEUP flag is set in the events field for a struct epoll_event, the system will be kept awake from the moment the event is queued, through the epoll_wait(2) call which returns the event until the subsequent epoll_wait(2) call. If the event should keep the system awake beyond that time, then a separate wake_lock should be taken before the second epoll_wait(2) call. /proc interfaces The following interfaces can be used to limit the amount of kernel memory consumed by epoll: /proc/sys/fs/epoll/max_user_watches (since Linux 2.6.28) This specifies a limit on the total number of file descriptors that a user can register across all epoll instances on the system. The limit is per real user ID. Each registered file descriptor costs roughly 90 bytes on a 32-bit kernel, and roughly 160 bytes on a 64-bit kernel. Currently, the default value for max_user_watches is 1/25 (4%) of the available low memory, divided by the registration cost in bytes. Example for suggested usage While the usage of epoll when employed as a level-triggered interface does have the same semantics as poll(2), the edge-triggered usage requires more clarification to avoid stalls in the application event loop. In this example, listener is a nonblocking socket on which listen(2) has been called. The function do_use_fd() uses the new ready file descriptor until EAGAIN is returned by either read(2) or write(2). An event-driven state machine application should, after having received EAGAIN, record its current state so that at the next call to do_use_fd() it will continue to read(2) or write(2) from where it stopped before. 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748#define MAX_EVENTS 10struct epoll_event ev, events[MAX_EVENTS];int listen_sock, conn_sock, nfds, epollfd;/* Code to set up listening socket, 'listen_sock', (socket(), bind(), listen()) omitted */epollfd = epoll_create1(0);if (epollfd == -1) &#123; perror(\"epoll_create1\"); exit(EXIT_FAILURE);&#125;ev.events = EPOLLIN;ev.data.fd = listen_sock;if (epoll_ctl(epollfd, EPOLL_CTL_ADD, listen_sock, &amp;ev) == -1) &#123; perror(\"epoll_ctl: listen_sock\"); exit(EXIT_FAILURE);&#125;for (;;) &#123; nfds = epoll_wait(epollfd, events, MAX_EVENTS, -1); if (nfds == -1) &#123; perror(\"epoll_wait\"); exit(EXIT_FAILURE); &#125; for (n = 0; n &lt; nfds; ++n) &#123; if (events[n].data.fd == listen_sock) &#123; conn_sock = accept(listen_sock, (struct sockaddr *) &amp;addr, &amp;addrlen); if (conn_sock == -1) &#123; perror(\"accept\"); exit(EXIT_FAILURE); &#125; setnonblocking(conn_sock); ev.events = EPOLLIN | EPOLLET; ev.data.fd = conn_sock; if (epoll_ctl(epollfd, EPOLL_CTL_ADD, conn_sock, &amp;ev) == -1) &#123; perror(\"epoll_ctl: conn_sock\"); exit(EXIT_FAILURE); &#125; &#125; else &#123; do_use_fd(events[n].data.fd); &#125; &#125;&#125; When used as an edge-triggered interface, for performance reasons, it is possible to add the file descriptor inside the epoll interface (EPOLL_CTL_ADD) once by specifying (EPOLLIN|EPOLLOUT). This allows you to avoid continuously switching between EPOLLIN and EPOLLOUT calling epoll_ctl(2) with EPOLL_CTL_MOD. Questions and answers 0. What is the key used to distinguish the file descriptors regisâ€ tered in an interest list? The key is the combination of the file descriptor number and the open file description (also known as an &quot;open file handle&quot;, the kernel's internal representation of an open file). 1. What happens if you register the same file descriptor on an epoll instance twice? You will probably get EEXIST. However, it is possible to add a duplicate (dup(2), dup2(2), fcntl(2) F_DUPFD) file descriptor to the same epoll instance. This can be a useful technique for filâ€ tering events, if the duplicate file descriptors are registered with different events masks. 2. Can two epoll instances wait for the same file descriptor? If so, are events reported to both epoll file descriptors? Yes, and events would be reported to both. However, careful proâ€ gramming may be needed to do this correctly. 3. Is the epoll file descriptor itself poll/epoll/selectable? Yes. If an epoll file descriptor has events waiting, then it will indicate as being readable. 4. What happens if one attempts to put an epoll file descriptor into its own file descriptor set? The epoll_ctl(2) call fails (EINVAL). However, you can add an epoll file descriptor inside another epoll file descriptor set. 5. Can I send an epoll file descriptor over a UNIX domain socket to another process? Yes, but it does not make sense to do this, since the receiving process would not have copies of the file descriptors in the interest list. 6. Will closing a file descriptor cause it to be removed from all epoll interest lists? Yes, but be aware of the following point. A file descriptor is a reference to an open file description (see open(2)). Whenever a file descriptor is duplicated via dup(2), dup2(2), fcntl(2) F_DUPFD, or fork(2), a new file descriptor referring to the same open file description is created. An open file description conâ€ tinues to exist until all file descriptors referring to it have been closed. A file descriptor is removed from an interest list only after all the file descriptors referring to the underlying open file description have been closed. This means that even after a file descriptor that is part of an interest list has been closed, events may be reported for that file descriptor if other file descriptors referring to the same underlying file description remain open. To prevent this happening, the file descriptor must be explicitly removed from the interest list (using epoll_ctl(2) EPOLL_CTL_DEL) before it is duplicated. Alternatively, the application must ensure that all file descriptors are closed (which may be difficult if file descriptors were duplicated behind the scenes by library functions that used dup(2) or fork(2)). 7. If more than one event occurs between epoll_wait(2) calls, are they combined or reported separately? They will be combined. 8. Does an operation on a file descriptor affect the already colâ€ lected but not yet reported events? You can do two operations on an existing file descriptor. Remove would be meaningless for this case. Modify will reread available I/O. 9. Do I need to continuously read/write a file descriptor until EAGAIN when using the EPOLLET flag (edge-triggered behavior)? Receiving an event from epoll_wait(2) should suggest to you that such file descriptor is ready for the requested I/O operation. You must consider it ready until the next (nonblocking) read/write yields EAGAIN. When and how you will use the file descriptor is entirely up to you. For packet/token-oriented files (e.g., datagram socket, terminal in canonical mode), the only way to detect the end of the read/write I/O space is to continue to read/write until EAGAIN. For stream-oriented files (e.g., pipe, FIFO, stream socket), the condition that the read/write I/O space is exhausted can also be detected by checking the amount of data read from / written to the target file descriptor. For example, if you call read(2) by asking to read a certain amount of data and read(2) returns a lower number of bytes, you can be sure of having exhausted the read I/O space for the file descriptor. The same is true when writing using write(2). (Avoid this latter technique if you canâ€ not guarantee that the monitored file descriptor always refers to a stream-oriented file.) Possible pitfalls and ways to avoid them o Starvation (edge-triggered) If there is a large amount of I/O space, it is possible that by tryâ€ ing to drain it the other files will not get processed causing starâ€ vation. (This problem is not specific to epoll.) The solution is to maintain a ready list and mark the file descriptor as ready in its associated data structure, thereby allowing the application to remember which files need to be processed but still round robin amongst all the ready files. This also supports ignoring subsequent events you receive for file descriptors that are already ready. o If using an event cache... If you use an event cache or store all the file descriptors returned from epoll_wait(2), then make sure to provide a way to mark its cloâ€ sure dynamically (i.e., caused by a previous event's processing). Suppose you receive 100 events from epoll_wait(2), and in event #47 a condition causes event #13 to be closed. If you remove the structure and close(2) the file descriptor for event #13, then your event cache might still say there are events waiting for that file descriptor causing confusion. One solution for this is to call, during the processing of event 47, epoll_ctl(EPOLL_CTL_DEL) to delete file descriptor 13 and close(2), then mark its associated data structure as removed and link it to a cleanup list. If you find another event for file descriptor 13 in your batch processing, you will discover the file descriptor had been previously removed and there will be no confusion. VERSIONS The epoll API was introduced in Linux kernel 2.5.44. Support was added to glibc in version 2.3.2. CONFORMING TO The epoll API is Linux-specific. Some other systems provide similar mechanisms, for example, FreeBSD has kqueue, and Solaris has /dev/poll. NOTES The set of file descriptors that is being monitored via an epoll file descriptor can be viewed via the entry for the epoll file descriptor in the processâ€™s /proc/[pid]/fdinfo directory. See proc(5) for further details. The kcmp(2) KCMP_EPOLL_TFD operation can be used to test whether a file descriptor is present in an epoll instance. SEE ALSO epoll_create(2), epoll_create1(2), epoll_ctl(2), epoll_wait(2), poll(2), select(2) COLOPHON This page is part of release 5.00 of the Linux man-pages project. A description of the project, information about reporting bugs, and the latest version of this page, can be found at https://www.kernel.org/doc/man-pages/.","categories":[{"name":"Linux","slug":"Linux","permalink":"https://blog.inoki.cc/categories/Linux/"},{"name":"man","slug":"Linux/man","permalink":"https://blog.inoki.cc/categories/Linux/man/"},{"name":"7-Miscellanea","slug":"Linux/man/7-Miscellanea","permalink":"https://blog.inoki.cc/categories/Linux/man/7-Miscellanea/"}],"tags":[{"name":"Linux","slug":"Linux","permalink":"https://blog.inoki.cc/tags/Linux/"},{"name":"Man","slug":"Man","permalink":"https://blog.inoki.cc/tags/Man/"},{"name":"epoll","slug":"epoll","permalink":"https://blog.inoki.cc/tags/epoll/"}]},{"title":"ã€è¯‘ã€‘Quic-HTTP/3","slug":"Quic-HTTP-3","date":"2018-11-26T12:48:24.000Z","updated":"2025-03-08T09:40:48.592Z","comments":true,"path":"2018/11/26/Quic-HTTP-3/","link":"","permalink":"https://blog.inoki.cc/2018/11/26/Quic-HTTP-3/","excerpt":"","text":"åŸæ–‡é“¾æ¥: https://daniel.haxx.se/blog/2018/11/11/http-3/ æ›¾ç»è¢«ç§°ä¸º HTTP-over-QUIC çš„åè®®æ”¹å¤´æ¢é¢ï¼Œæˆä¸ºäº†å®˜æ–¹çš„ HTTP/3 åè®®ã€‚Mark Nottingham æå‡ºäº†è¿™ä¸ªæè®®ï¼Œå¹¶ä¸”è¢«å·¥ä½œç»„æ¥å—ã€‚ ç¤¾åŒºä¸­ä½¿ç”¨ä¸åŒçš„åå­—æ¥ç§°å‘¼ä¸åŒçš„ç‰ˆæœ¬ï¼Œæ¯”å¦‚ iQUIC å’Œ gQUIC æ¥åŒºåˆ† IEFT å’Œ Google çš„ QUIC åè®®ï¼ˆå› ä¸ºåœ¨ç»†èŠ‚ä¸Šå®ƒä»¬çš„ç¡®æœ‰å¾ˆå¤šä¸åŒï¼‰ã€‚åœ¨å¾ˆé•¿ä¸€æ®µæ—¶é—´é‡Œï¼Œç»ç”± iQUIC ä¼ è¾“çš„ HTTP åè®®è¢«ç§°ä¸º HTTP-over-QUICã€‚ ç›®å‰ï¼ŒIETF ä¸­çš„ QUIC å·¥ä½œç»„è‡´åŠ›äºåˆ›é€  QUIC ä¼ è¾“åè®®ã€‚QUIC åè®®ä½œä¸ºä¸€ä¸ªåŸºäºUDPåè®®çš„ TCP åè®®çš„æ›¿ä»£å“ï¼Œæœ€æ—©ç”± Google æå‡ºï¼Œåæ¥è¢«ä½œä¸º HTTP/2-encrypted-over-UDP ä½¿ç”¨ã€‚ å½“è¿™é¡¹å·¥ä½œç”± IETF æ¥æ‰‹æ¥æ ‡å‡†åŒ–æ—¶ï¼Œå®ƒè¢«åˆ†ä¸ºäº†ä¸¤ä¸ªéƒ¨åˆ†ï¼šä¼ è¾“éƒ¨åˆ†å’ŒHTTPéƒ¨åˆ†ã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬ä¹Ÿå¸Œæœ›èƒ½å¤Ÿä½¿ç”¨è¿™ä¸ªåè®®ä¼ è¾“å…¶ä»–æ•°æ®ï¼Œè€Œä¸ä»…ä»…æ˜¯HTTPæˆ–ç±»HTTPåè®®ï¼Œä½†æ˜¯æˆ‘ä»¬ä¿ç•™äº† QUIC è¿™ä¸ªåå­—ã€‚ Mark Bishop åœ¨ IETF 103 ä¸¾è¡Œçš„ QUIC å·¥ä½œç»„ä¼šè®®ä¸ŠæƒŠå“åˆ°äº†ä»–ä»¬ï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸ªå¹»ç¯ç‰‡ä¸Šå·²ç»æ”¾å‡ºäº†ä¸€ä¸ª Logo â€¦ 2018å¹´1æœˆ7æ—¥ï¼ŒLitespeed çš„ Dmitri å®£å¸ƒä»–ä»¬å’Œ Facebook å·²ç»æˆåŠŸçš„å®ç°äº†ä¸¤ä¸ª HTTP/3 å®ç°çš„äº’æ“ä½œã€‚ç´§æ¥ç€ Mike Bishop åœ¨ HTTPbis çš„æ¼”è®²çš„å¹»ç¯ç‰‡å¦‚ä¸Šã€‚ä¼šè®®æœ€åè¾¾æˆå…±è¯†ï¼Œæ–°çš„åå­—ä¸º HTTP/3 ã€‚ é‚£ä¹ˆï¼Œä¸å†æœ‰ä»»ä½•äº‰è®®ã€‚HTTP/3 å°†ä¼šæˆä¸ºæ–°çš„ä½¿ç”¨ QUIC ä¼ è¾“çš„ HTTP ç‰ˆæœ¬ï¼","categories":[{"name":"Translation","slug":"Translation","permalink":"https://blog.inoki.cc/categories/Translation/"},{"name":"Chinese","slug":"Translation/Chinese","permalink":"https://blog.inoki.cc/categories/Translation/Chinese/"},{"name":"Protocol","slug":"Protocol","permalink":"https://blog.inoki.cc/categories/Protocol/"}],"tags":[{"name":"ç¿»è¯‘","slug":"ç¿»è¯‘","permalink":"https://blog.inoki.cc/tags/ç¿»è¯‘/"},{"name":"ä¸­æ–‡","slug":"ä¸­æ–‡","permalink":"https://blog.inoki.cc/tags/ä¸­æ–‡/"},{"name":"QUIC","slug":"QUIC","permalink":"https://blog.inoki.cc/tags/QUIC/"},{"name":"HTTP","slug":"HTTP","permalink":"https://blog.inoki.cc/tags/HTTP/"}]},{"title":"Leetcode 300 Longest Increasing Subsequence","slug":"Leetcode-300-Longest-Increasing-Subsequence","date":"2018-11-07T23:34:40.000Z","updated":"2025-03-08T09:40:48.582Z","comments":true,"path":"2018/11/07/Leetcode-300-Longest-Increasing-Subsequence/","link":"","permalink":"https://blog.inoki.cc/2018/11/07/Leetcode-300-Longest-Increasing-Subsequence/","excerpt":"","text":"Here the question: Given an unsorted array of integers, find the length of longest increasing subsequence. Example: 123Input: [10,9,2,5,3,7,101,18]Output: 4 Explanation: The longest increasing subsequence is [2,3,7,101], therefore the length is 4. There may be more than one LIS combination, it is only necessary for you to return the length. Your algorithm should run in O(n2) complexity. There is a more simple algorithm to solve this question. But we would like to learn about Dynamic Programming. So we will take the O(n2) solution. Dynamic Programming A condition necessary for Dynamic Programming: 1In computer science, a problem is said to have optimal substructure if an optimal solution can be constructed from optimal solutions of its subproblems. This property is used to determine the usefulness of dynamic programming and greedy algorithms for a problem. It means that the optimal result is constructed by the optimal result of its subproblem. Another condition: 1In computer science, a problem is said to have overlapping subproblems if the problem can be broken down into subproblems which are reused several times or a recursive algorithm for the problem solves the same subproblem over and over rather than always generating new subproblems. It means that we can reuse the result of the subproblem of the problem that we are facing. If a problem tallies with the two conditions, then the problem can be solved by Dynamic Programming. Solution The prototype of this function is 1int lengthOfLIS(int *A, int length) A is an array, length is the length of array A. For overlapping subproblems property, to reuse the result of subproblems, we have to store the result of subproblems. We assigned an array with enougn slots for results. 12int F[length];memset(F, 0, length); The first element must be a valid increasing subsequence because there is only one element. So for the problem with only one element, we have the result: 1F[0] = 1; And then, for the next subproblems, we can execute a loop to solve them one by one. 1234for (int k=1;k&lt;length;k++)&#123; ...&#125; By using this loop, we can solve firstly F[1], then F[2]â€¦ until F[length-1]. For each F[k], we search all previous elements to find out which is smaller than A[k], the element on which we pause. If an element is smaller than A[k], it means that at worst, we have an increasing sequence with two elements (A[k] and the element itself), so itâ€™s possible to increase the length at the position of that element by 1 to fill F[k]. 1234567for (int i=0;i&lt;k;i++)&#123; if (A[k] &gt; A[i]) &#123; ... &#125;&#125; We have one slot to be filled, to find out the longest one, we can pick up the largest length at the positions before k, and assign length+1 to F[k]. So we can garantee that, at this position, there is the length of longest increasing sequence, which is the optimal solution of such a problem(or subproblem). So we can mix the process of finding the largest length and the process of finding the possible lengths. 123456789101112131415161718192021222324// Iteration for searching the max of each positionint max = -1;for (int i=0;i&lt;k;i++)&#123; if (A[k] &gt; A[i]) &#123; // Init max if (max == -1) max = i; if (F[i] &gt;= F[max]) &#123; max = i; &#125; &#125;&#125;// Check if max value existif (max != -1)&#123; F[k] = F[max] + 1;&#125;else&#123; F[k] = 1;&#125; It should be noticed that we check the existence of max length with the condition A[k]&gt;A[i]. If we cannot find anyone, it means that at this position there is a new start of increasing sequence, so we give F[k] a 1. After the loop, the results are well calculated and stored in the array F. So we can find the largest one and return it. Itâ€™s not very difficult, we can glance at the full code. Final Code 1234567891011121314151617181920212223242526272829303132333435363738394041int lengthOfLIS(int *A, int length)&#123; if (length&lt;1) return 0; int F[length]; memset(F, 0, length); F[0] = 1; for (int k=1;k&lt;length;k++) &#123; // Iteration for searching the max of each position int max = -1; for (int i=0;i&lt;k;i++) &#123; if (A[k] &gt; A[i]) &#123; // Init max if (max == -1) max = i; if (F[i] &gt;= F[max]) &#123; max = i; &#125; &#125; &#125; // Check if max value exist if (max != -1) &#123; F[k] = F[max] + 1; &#125; else F[k] = 1; &#125; int max = 0; for (int k=0;k&lt;length;k++) &#123; if (max &lt; F[k]) &#123; max = F[k]; &#125; &#125; return max;&#125; TO DO: There should be a solution with time complexity O(nlogn), find it out !","categories":[{"name":"Leetcode","slug":"Leetcode","permalink":"https://blog.inoki.cc/categories/Leetcode/"},{"name":"Dynamic Programming","slug":"Leetcode/Dynamic-Programming","permalink":"https://blog.inoki.cc/categories/Leetcode/Dynamic-Programming/"}],"tags":[{"name":"Leetcode","slug":"Leetcode","permalink":"https://blog.inoki.cc/tags/Leetcode/"},{"name":"Dynamic Programming","slug":"Dynamic-Programming","permalink":"https://blog.inoki.cc/tags/Dynamic-Programming/"}]},{"title":"Cross compile beginning without Makefile","slug":"Cross-compile-beginning-without-Makefile","date":"2018-10-25T02:42:40.000Z","updated":"2025-03-08T09:40:48.561Z","comments":true,"path":"2018/10/25/Cross-compile-beginning-without-Makefile/","link":"","permalink":"https://blog.inoki.cc/2018/10/25/Cross-compile-beginning-without-Makefile/","excerpt":"","text":"For building a cross compiling system for my router Newifi D1(2nd Generation), I tried crosstools-ng. In Ubuntu 18.04, because of the version of perl, the environment cannot be built correctly with ct-ng build after the configuration. I will not talk about the error here. In fact, the error has been fixed in the pull request Pull 1043.As the latest version is crosstool-ng-1.23.0 released at Apr 20, 2017. We can do nothing except waiting (although we can build the tool manually, itâ€™s better to wait for an officiel release). We come back for the theme. The CPU of my router is mt7621a, and the system is based on openwrt Barrier Breaker. The architecture of this CPU is mipsel 32. We can download openwrt toolchain for mipsel and decompress it. The compiler is based on toolchain-mipsel_24kec+dsp_gcc-4.8-linaro_uClibc-0.9.33.2/bin. To test, we create a simple hello world: 1234567#include &lt;stdio.h&gt;int main()&#123; printf(\"Hello World\\n\"); return 0;&#125; Compile it: 1toolchain-mipsel_24kec+dsp_gcc-4.8-linaro_uClibc-0.9.33.2/bin/mipsel-openwrt-linux-gcc helloworld.c -o helloworld Upload it: 1scp helloworld root@192.168.99.1:/ We connect to the router with ssh and test it: 12&gt;./helloHello World It works! There will be a tutorial more advanced in some days.","categories":[{"name":"Embedded System","slug":"Embedded-System","permalink":"https://blog.inoki.cc/categories/Embedded-System/"},{"name":"Cross Compile","slug":"Embedded-System/Cross-Compile","permalink":"https://blog.inoki.cc/categories/Embedded-System/Cross-Compile/"},{"name":"Router","slug":"Embedded-System/Cross-Compile/Router","permalink":"https://blog.inoki.cc/categories/Embedded-System/Cross-Compile/Router/"}],"tags":[{"name":"Cross Compile","slug":"Cross-Compile","permalink":"https://blog.inoki.cc/tags/Cross-Compile/"},{"name":"Router","slug":"Router","permalink":"https://blog.inoki.cc/tags/Router/"},{"name":"openwrt","slug":"openwrt","permalink":"https://blog.inoki.cc/tags/openwrt/"}]},{"title":"Uninstall docker in WSL Ubuntu","slug":"Uninstall-docker-in-WSL-Ubuntu","date":"2018-10-21T08:47:00.000Z","updated":"2018-10-21T18:48:15.000Z","comments":true,"path":"2018/10/21/Uninstall-docker-in-WSL-Ubuntu/","link":"","permalink":"https://blog.inoki.cc/2018/10/21/Uninstall-docker-in-WSL-Ubuntu/","excerpt":"","text":"After my installation of docker in Windows Sous-System Linux by the command following: 1sudo apt-get install docker.io I regret and Iâ€™d like to uninstall it immediately. The error occured ! dpkg told me that he canâ€™t work well with the command sudo apt-get remove --purge docker.io. 123456789101112Removing docker.io (17.03.2-0ubuntu2~16.04.1) ...invoke-rc.d: could not determine current runlevel * Stopping Docker: docker No process in pidfile &apos;/var/run/docker-ssd.pid&apos; found running; none killed.invoke-rc.d: initscript docker, action &quot;stop&quot; failed.dpkg: error processing package docker.io (--purge): subprocess installed pre-removal script returned error exit status 1dmesg: read kernel buffer failed: Function not implemented dpkg: error while cleaning up: subprocess installed post-installation script returned error exit status 1Errors were encountered while processing: docker.ioE: Sub-process /usr/bin/dpkg returned an error code (1) Obviously, the error is from the process of stopping the docker itself. We can show the content of docker-ssd.pid. It told us the pid of docker daemon is 22391. Normally, as the docker daemon hasnâ€™t been booted, the docker daemon process will not be in the process table. So the error is that: We cannot stop a process with a pid which has never been booted. So the uninstallation script stopped when it cannot stop the docker daemon. To avoid the error and then uninstall the docker, we can modify the pid in docker-ssd.pid with a pid of a process which is not so important. Okay, we can launch sleep 200. In 200 seconds, we can run ps -ef | grep sleep to obtain the pid of process of sleep. 123&gt; ps -ef | grep sleepinoki 25219 21212 0 19:01 tty1 00:00:00 sleep 200inoki 25221 24653 0 19:01 tty2 00:00:00 grep --color=auto sleep We fill docker-ssd.pid with such pid. Okay, we uninstall docker.io. 12345678910111213141516171819&gt; sudo apt-get remove docker.ioReading package lists... DoneBuilding dependency treeReading state information... DoneThe following packages were automatically installed and are no longer required: bridge-utils cgroupfs-mount ubuntu-fanUse &apos;sudo apt autoremove&apos; to remove them.The following packages will be REMOVED: docker.io0 upgraded, 0 newly installed, 1 to remove and 0 not upgraded.1 not fully installed or removed.After this operation, 90.2 MB disk space will be freed.Do you want to continue? [Y/n](Reading database ... 76380 files and directories currently installed.)Removing docker.io (17.03.2-0ubuntu2~16.04.1) ...&apos;/usr/share/docker.io/contrib/nuke-graph-directory.sh&apos; -&gt; &apos;/var/lib/docker/nuke-graph-directory.sh&apos;invoke-rc.d: could not determine current runlevel * Stopping Docker: docker [ OK ]Processing triggers for man-db (2.7.5-1) ... All goes well and tout va bien!","categories":[{"name":"Bug","slug":"Bug","permalink":"https://blog.inoki.cc/categories/Bug/"},{"name":"WSL","slug":"Bug/WSL","permalink":"https://blog.inoki.cc/categories/Bug/WSL/"},{"name":"Docker","slug":"Bug/Docker","permalink":"https://blog.inoki.cc/categories/Bug/Docker/"}],"tags":[{"name":"Bug","slug":"Bug","permalink":"https://blog.inoki.cc/tags/Bug/"},{"name":"Ubuntu","slug":"Ubuntu","permalink":"https://blog.inoki.cc/tags/Ubuntu/"},{"name":"WSL","slug":"WSL","permalink":"https://blog.inoki.cc/tags/WSL/"},{"name":"Docker","slug":"Docker","permalink":"https://blog.inoki.cc/tags/Docker/"}]},{"title":"Cuda Sample Error Configuration for VS2017","slug":"Cuda-Sample-Error-Configuration-for-VS2017","date":"2018-09-03T16:38:00.000Z","updated":"2018-10-22T08:29:16.000Z","comments":true,"path":"2018/09/03/Cuda-Sample-Error-Configuration-for-VS2017/","link":"","permalink":"https://blog.inoki.cc/2018/09/03/Cuda-Sample-Error-Configuration-for-VS2017/","excerpt":"","text":"123456789101112CUDA Version: v9.2Visual Studio 2017 Microsoft Visual Studio Community 2017 ç‰ˆæœ¬ 15.8.2 VisualStudio.15.Release/15.8.2+28010.2016 Microsoft .NET Framework ç‰ˆæœ¬ 4.7.03056 å·²å®‰è£…çš„ç‰ˆæœ¬: Community Visual C++ 2017 00369-60000-00001-AA285 Microsoft Visual C++ 2017 When I compiled a sample named â€œvectorAddâ€, it occurs an error with message: 1C1189 #error: -- unsupported Microsoft Visual Studio version! Only the versions 2012, 2013, 2015 and 2017 are supported! vectorAdd c:\\program files\\nvidia gpu computing toolkit\\cuda\\v9.2\\include\\crt\\host_config.h 133 Itâ€™s the file host_config.h who has limited the version. So we can change the version limit in this file: 1131 #if _MSC_VER &lt; 1600 || _MSC_VER &gt; 1913 to 1131 #if _MSC_VER &lt; 1600 || _MSC_VER &gt; 1920 It depends on your Visual Studio version that which version should you indicate, which means that probably _MSC_VER &gt; 19xx is written in your host_config.h, while your actual _MSC_VER could also be greater than 1920. Itâ€™s all up to your situation, the principle is to modify the limit, youâ€™ve got it! For another error: If we open an individual sample in the grand project, it will occur another problem. The message shows that all the head files for CUDA have not been added. So we can add them manually: Right click on the solution-&gt;Properties-&gt;VC++ Directories-&gt;include path, add &quot;C:\\ProgramData\\NVIDIA Corporation\\CUDA Samples\\v9.2\\common\\inc;&quot; (which is your CUDA head files directory). All will be well. God bless you!","categories":[{"name":"Bug","slug":"Bug","permalink":"https://blog.inoki.cc/categories/Bug/"},{"name":"Cuda","slug":"Bug/Cuda","permalink":"https://blog.inoki.cc/categories/Bug/Cuda/"}],"tags":[{"name":"Bug","slug":"Bug","permalink":"https://blog.inoki.cc/tags/Bug/"},{"name":"Windows","slug":"Windows","permalink":"https://blog.inoki.cc/tags/Windows/"},{"name":"Cuda","slug":"Cuda","permalink":"https://blog.inoki.cc/tags/Cuda/"},{"name":"Visual Studio","slug":"Visual-Studio","permalink":"https://blog.inoki.cc/tags/Visual-Studio/"}]},{"title":"ELFhash algorithm understanding by GDB","slug":"ELFhash-algorithm-understanding-by-GDB","date":"2018-08-11T12:06:00.000Z","updated":"2018-10-24T23:12:32.000Z","comments":true,"path":"2018/08/11/ELFhash-algorithm-understanding-by-GDB/","link":"","permalink":"https://blog.inoki.cc/2018/08/11/ELFhash-algorithm-understanding-by-GDB/","excerpt":"","text":"ELFhash algorithm is a hash function who works very well with great string and tiny string. The source code is as follows: 1234567891011121314unsigned int ELFhash(char *str)&#123; unsigned int hash=0; unsigned int x=0; while(*str) &#123; hash=(hash&lt;&lt;4)+*str; if(( x=hash &amp; 0xf0000000 ) != 0) &#123; hash^=(x&gt;&gt;24); hash&amp;=~x; // Clear high 4 bit &#125; str++; &#125; return (hash &amp; 0x7fffffff);&#125; The time complexity is O(n) because of the loop of source string has n characters. While the space complexity is O(1). 12(gdb) b 5Breakpoint 1 at 0x725: file test.c, line 5. We set a breakpoint at the beginning of function main. There is nothing to do at this line, so we let it go. 12(gdb) n7 scanf(&quot;%s&quot;, source); At this line, we will input abcdefghijkl as the string to be hashed. 123(gdb) nabcdefghijkl8 unsigned int r = ELFhash(source); When we reached line 8, enter the function. 12345678(gdb) p str$1 = 0x7fffffffdba0 &quot;abcdefghijkl&quot;(gdb) n9 hash=(hash&lt;&lt;4)+*str;(gdb) n10 if(( x=hash &amp; 0xf0000000 ) != 0)(gdb) p hash$2 = 97 At the end of the first loop, we got str abcdefghijkl, and hash became 97(0x00000061). 1234(gdb) p hash$3 = 1650(gdb) p str$4 = 0x7fffffffdba1 &quot;bcdefghijkl&quot; After the second loop, 0x00000061 will be moved 4 bits to the left. So itâ€™s 0x00000610 + 0x00000062 = 0x00000672 (1650). For the mixture of the first 7 number, itâ€™s simply moving to the left with 4 bits and an addition. At the 7th times, 6 is moved to the first bit of the hash. So if we continue the operations, it will be removed. To avoid this, the algorithm provides a serial of operations to guarantee the mixture between every bit near. For the moment, x=0x06, hash=0x6789abc7. 123450 if(( x=hash &amp; 0xf0000000 ) != 0)(gdb) 12 hash^=(x&gt;&gt;24); (gdb) n13 hash&amp;=~x; // Clear high 4 bit After these operations, the high 4 bits at the first bit is cleared to be 0. And the operation exclusive OR (^) will keep the bits from the second to the last second with 789ab. For x, itâ€™s the high 4 bits of the first character. As the similarity between exclusive OR and the addition, itâ€™s the same operation as the code hash=(hash&lt;&lt;4)+*str. But itâ€™s a looped one. So in the end, the hash became, 0x0789aba7. Obviously, the following characters will be handled as the seventh bit (â€œgâ€ for the string), and it can be a ring of addition while a new character added. Iâ€™m waiting for a proof of the homogeneity.","categories":[{"name":"Algorithm","slug":"Algorithm","permalink":"https://blog.inoki.cc/categories/Algorithm/"},{"name":"Hash","slug":"Algorithm/Hash","permalink":"https://blog.inoki.cc/categories/Algorithm/Hash/"}],"tags":[{"name":"Algorithm","slug":"Algorithm","permalink":"https://blog.inoki.cc/tags/Algorithm/"},{"name":"Hash","slug":"Hash","permalink":"https://blog.inoki.cc/tags/Hash/"},{"name":"GDB","slug":"GDB","permalink":"https://blog.inoki.cc/tags/GDB/"}]},{"title":"æ³•å…°è¥¿","slug":"France","date":"2015-10-01T01:15:00.000Z","updated":"2025-03-08T09:40:48.564Z","comments":true,"path":"2015/10/01/France/","link":"","permalink":"https://blog.inoki.cc/2015/10/01/France/","excerpt":"","text":"ä»è¿œå¤æ—¶ä»£å¼€å§‹ï¼Œé«˜å¢äººç”Ÿæ´»ç€çš„è¿™å—åœŸåœ°ï¼Œä¸€ç›´é£èµ·äº‘æ¶Œã€‚åŸæœ¬çƒ­çˆ±è‡ªç”±çš„é«˜å¢äººï¼Œéšç€æ—¥è€³æ›¼è›®æ—çš„å…¥ä¾µï¼Œå¼€å§‹æ´»åœ¨å…‹æ´›ç»´ç‹çš„ææ€–ä¹‹ä¸‹ï¼Œè¿™å……æ–¥ç€å¹³åº¸ã€åªé¡¾äº«ä¹çš„æ³•å…°å…‹å›½ç‹çš„å¢¨æ´›æ¸©ç‹æœï¼Œç»™åˆšå½¢æˆä¸ä¹…çš„æ³•å…°è¥¿å¸¦æ¥äº†æ— å°½çš„ç¾éš¾ï¼Œå®«æ–—ä¸€èˆ¬çš„ç›¸æƒä¹‹äº‰ï¼Œç»™äºˆäº†ä¸•å¹³å®¶æ—å‡ ä»£çš„å…´æ—ºã€‚æœ€åçŸ®å­ä¸•å¹³ä¸ç½—é©¬æ•™çš‡çš„è‹Ÿåˆï¼Œä¿ƒæˆäº†å¡æ´›æ—ç‹æœçš„å´›èµ·ï¼Œä¸•å¹³çŒ®åœŸä¹Ÿä»¤æ¢µè’‚å†ˆæ‚„ç„¶è¯ç”Ÿã€‚ä¸ä¹…çŸ®å­ä¸•å¹³çš„å­å—£æ¥ç®¡æ•´ä¸ªæ³•å…°å…‹ï¼Œåœ¨é‡‘æˆˆé“é©¬ä¹‹ä¸­ï¼Œç»ˆäºè¯ç”Ÿäº†ä¸€ä¸ªç©ºå‰å¼ºå¤§çš„æ³•å›½â€”æŸ¥ç†æ›¼å¸å›½ã€‚ å¤©ä¸‹åˆ†ä¹…å¿…åˆï¼Œåˆä¹…å¿…åˆ†ã€‚æŸ¥ç†æ›¼å¸å›½ï¼Œè¿™ä¸€æ›¾ç»è¢«æ‰¿è®¤ä¸ºç½—é©¬å¸å›½ç»§æ‰¿è€…çš„å­˜åœ¨ï¼Œåœ¨æŸ¥ç†åˆ«äºäººä¸–ä¹‹åä¸€åˆ†ä¸ºä¸‰ï¼Œã€Šå‡¡å°”ç™»æ¡çº¦ã€‹ç”Ÿç”Ÿå°†è¥¿æ¬§åˆ‡å¼€ï¼Œåˆ†å‡ºäº†ç°ä»£å¾·æ³•æ„å¤§è‡´çš„å½¢çŠ¶ã€‚æ­¤æ—¶ï¼Œä»æŸç§æ„ä¹‰ä¸Šè¯´ï¼Œæ³•å…°è¥¿çš„å†å²æ‰ç®—çœŸæ­£å¼€å§‹ã€‚æŸ¥ç†æ›¼å¸å›½ï¼Œæ‰€è°“ç››æä¸€æ—¶ï¼Œä¹Ÿæ˜¯å†å²å¿…ç„¶çš„è§„å¾‹ï¼Œç››æï¼Œåˆ™ä¸å†å¯èƒ½æœ‰æ›´åŠ å¼ºç››ä¹‹æ—¶ï¼Œè€Œä¸€æ—¶ï¼Œä¹Ÿæ³¨å®šå¼ºç››æ— æ³•ä¿æŒã€‚æ—¢ç„¶æ²¡æœ‰æ›´åŠ å¼ºç››ä¹‹æ—¶ï¼Œä¹Ÿä¸èƒ½ä¿æŒå¼ºç››å¤ªä¹…ï¼Œå¼ºç››ä¹‹åå¿…ç„¶æ˜¯æ¯«æ— åœæ»çš„ä¸‹é™ã€‚æŸ¥ç†å¤§å¸ä¹‹å­å—£ï¼Œä¸§å°½äº†å…¶ç¥–å…ˆçš„æ–‡æ­¦ä¹‹åŠ›ï¼Œæ³•å…°è¥¿åˆšåˆšå»ºå›½ï¼Œæƒ…å†µå°±æ€¥è½¬ç›´ä¸‹ã€‚æ˜™èŠ±ä¸€ç°çš„å¼ºç››ï¼Œä¹Ÿä¼šåœ¨ç”µå…‰çŸ³ç«ä¹‹ä¸­ç»ˆç»“ã€‚ ç‹å¼±çš„å¤ªä¹…ï¼Œè‡£ä¾¿ä¸ç”˜äºä¸ºè‡£ã€‚æ— æ•°è¯¸ä¾¯è¶ç‹å®¤è¡°å¾®ï¼Œç«ç›¸äº‰å¤ºåœŸåœ°ï¼Œå¦‚åŒä¸­å›½å¤ä»£è—©ç‹å‰²æ®ï¼Œå åœ°ä¸ºç‹ã€‚åªæœ‰å²ç§°â€œæ³•å…°è¥¿å²›â€çš„ç‹å®¤é¢†åœ°ï¼Œæ‰æ˜¯ç‹èƒ½ç¨å¾®æŒæ§çš„ç©ºé—´ã€‚å¡ä½©ç‹æœï¼Œå°±è¿™æ ·æµ‘æµ‘å™©å™©åœ°åº¦è¿‡äº†æ•°åå¹´ï¼Œè·¯æ˜“å®¶æ—ç»ˆäºæœ‰äº†åŠ å¼ºç‹æƒçš„ä¿¡å¿µã€‚ç»è¿‡è·¯æ˜“å®¶æ—å’Œè²åˆ©æ™®å®¶æ—æ•°ä»£çš„åŠªåŠ›ï¼Œç»Ÿä¸€çš„å°å»ºç‹æœç»ˆäºå‡ºç°äº†é›å½¢ã€‚ä¹±ä¸–å‡ºè‹±é›„ï¼Œç™¾å¹´çš„è‹±æ³•æˆ˜äº‰ï¼Œè®©æ³•å›½æ¶Œç°å‡ºäº†ä¸è®¡å…¶æ•°çš„è‹±é›„ï¼Œåœ£å¥³è´å¾·æˆä¸ºå†å²ä¸Šæµ“å¢¨é‡å½©çš„ä¸€ç¬”ã€‚è‹±æ³•æˆ˜äº‰çš„èƒœåˆ©ï¼Œç»™æ³•å›½å¸¦æ¥çš„æ˜¯åŸæœ¬åœ¨è‹±ç‹æ‰‹ä¸­çš„æ³•å…°è¥¿çš„ç¥åœ£åœŸåœ°ï¼Œå…­è¾¹å½¢é¢†åœŸåœ¨è¿™æ¬¡æˆ˜äº‰ä¸­åˆæ­¥å½¢æˆã€‚ ç»è¿‡æ•°ç™¾å¹´çš„å‘å±•ï¼Œå½“å­Ÿå¾·æ–¯é¸ æå‡ºä¸‰æƒåˆ†ç«‹çš„å£å·ï¼Œæ–°å¤§é™†çš„äººä»¬é ç€è¿™å£å·èµ¶èµ°äº†è‹±å›½äººï¼Œå½“å¢æ¢­çœ‹é€äº†ç¤¾ä¼šçš„å¥‘çº¦æœ¬è´¨ï¼Œå½“åœ£è¥¿é—¨å’Œå‚…é‡Œå¶å¸Œæœ›å»ºç«‹ä¸€ä¸ªè‡ªç”±çš„ç¤¾ä¼šä¹‹æ—¶ï¼Œæ³•å…°è¥¿å´æ˜¯åˆšåˆšè¾¾åˆ°ä»–çš„å°å»ºå·…å³°ï¼Œå‰¥å‰Šå’Œå‹è¿«è®©äººä»¬è‹¦ä¸å ªè¨€ï¼Œè·¯æ˜“åå…­çš„éšæ„å¾ç¨æ•›è´¢ï¼Œå®«å»·å’Œè´µæ—çš„éšæ„çš„å¥¢ä¾ˆæµªè´¹ï¼Œè®©å·²ç»å½¢æˆäº†ä¸ªæ€§çš„æ³•å›½äººä¸èƒ½å¿å—ã€‚ä¸€åœºå³å°†ä¸¾ä¸–ç©ç›®çš„é©å‘½è“„åŠ¿å¾…å‘----æ³•å›½å¤§é©å‘½ã€‚ ç‹å°†ä¸ç‹ä¹Ÿã€‚ä¿ç‹å…šä¹Ÿæ›¾äº‰å–è¿‡å›ä¸»ç«‹å®ªï¼ŒåŒé‚»é‚¦è‹±å›½ä¸€æ ·ï¼Œç„¶è€Œæ³•å›½å¤§é©å‘½çš„æ­»ä¼¤äºç‹å…šå’Œè´µæ—æ— è¶³è½»é‡ï¼Œä»–ä»¬ä¾æ—§æ˜¯â€œä»€ä¹ˆä¹Ÿæ²¡æœ‰å¿˜è®°ï¼Œä»€ä¹ˆä¹Ÿæ²¡æœ‰å­¦ä¼šâ€ï¼Œåœ¨æ³•å›½å¹³æ°‘æŠŠè·¯æ˜“åå…­é€ä¸Šæ–­å¤´å°åï¼Œä¿ç‹å…šæ‹¥æŠ¤èµ·æ¥çš„å›½ç‹ä¾æ—§è¯•å›¾æ¢å¤æ³¢æ—ç‹æœçš„å°å»ºä¸“åˆ¶ï¼Œä¾æ—§è¯•å›¾æŠŠè·¯æ˜“åå…­çš„å¿Œæ—¥è®¾ä¸ºå›½ä¸§æ—¥ï¼Œä¾æ—§è¯•å›¾æŠŠæ³•å›½å¤§é©å‘½çš„æˆæœå¦å®šã€‚è¿™æ ·çš„ç‹æœå¼ƒä¹‹ä¹Ÿä¸æ¯«ä¸æƒœã€‚ç¬¬ä¸€å…±å’Œå›½å°±è¿™æ ·åœ¨å¹³æ°‘çš„æ”¯æŒä¸‹å»ºç«‹èµ·æ¥ã€‚ä½†æ˜¯ï¼Œè·¯æ˜“åå…­ä¹‹æ­»ï¼Œç»™å…¶ä»–æ¬§æ´²å°å»ºä¸“åˆ¶å›½å®¶ä»¥å£å®ï¼Œæ‰“ç€æ¶ˆç­å¼‘å›è€…çš„åå·ï¼Œä»–ä»¬åœ¨ä¸æ‡ˆçš„å›´æ”»æ³•å›½çš„æ–°ç”Ÿçš„å…±å’Œå›½ã€‚è¿™ä¹ˆçœ‹æ¥ï¼Œæ‰€æœ‰çš„æ–°åˆ¶åº¦ä¹Ÿè®¸éƒ½ä¼šé­åˆ°ä¸å…¶åˆ¶åº¦ä¸åŒçš„å›½å®¶çš„ä¸€è‡´åå¯¹ï¼Œç™¾å¹´åçš„è‹è”ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ç„¶è€Œé›…å„å®¾ä¸“æ”¿ç»™æ³•å›½å¸¦æ¥äº†æ›´å¤§çš„ææ€–ï¼Œè¿™äº›å¹¶ä¸æ˜¯æ³•å›½äººæƒ³è¦çš„æ°‘ä¸»å…±å’Œã€‚ ä¹Ÿè®¸æ³•å…°è¥¿äººå¹¶ä¸æ˜¯æƒ³è¦æ°‘ä¸»å…±å’Œï¼Œä»–ä»¬åªæ˜¯æƒ³æŠŠè‡ªå·±çš„ç”Ÿæ´»è¿‡ä¸‹å»ã€‚å½“ç§‘è¥¿å˜‰å²›æ¥äº†ä¸€ä½æˆ˜äº‰æ€ªå…½ï¼Œä»–æŠŠä»¤äººçª’æ¯çš„ä¸“åˆ¶åˆ¶åº¦èµ¶èµ°äº†ï¼Œä»–è™½ç„¶ç§°å¸ï¼Œå´æ˜¯èµ„äº§é˜¶çº§çš„åšå†³æ‹¥æŠ¤è€…ï¼Œä»–ä»¥ç»å¯¹çš„ç¥¨æ•°ä¼˜åŠ¿å®ç°äº†ç™»åŸºç§°å¸çš„æ¢¦æƒ³ã€‚è™½ç„¶æœ‰äº†å¸ç‹ï¼Œä½†æ³•å›½äººæ°‘æ¬¢å‘¼é›€è·ƒï¼Œæ— ä»–ï¼Œè¿™å¸ç‹æ˜¯å¯ä»¥ç»™ä»–ä»¬å¸¦æ¥ç”Ÿæ´»çš„å¸Œæœ›çš„å¸ç‹ã€‚ç»è¿‡ä¸€ç³»åˆ—çš„æˆ˜äº‰ï¼Œä»–æŠŠå…¶ä»–ç‹å›½çš„å›½ç‹æ‰“è¾“äº†ï¼Œæ‰“æ€•äº†ï¼Œæ³•å…°è¥¿ä¸‰ä¸ªå­—è¦†ç›–äº†å¤§åŠä¸ªæ¬§æ´²ï¼Œç©ºå‰çš„å¼ºå¤§ï¼Œç»™äº†æ‰€æœ‰äººä»¥å¸Œæœ›ã€‚ç„¶è€Œï¼Œå¥½æ™¯ä¸é•¿ï¼Œè¿œå¾ä¿„å›½è®©ä»–è´¥åŒ—ï¼Œåœ¨äººç”Ÿä¸­è´¥åŒ—ã€‚ç¬¬ä¸€æ¬¡å›šç¦å¸¦ç»™äº†ä»–æ²¡æœ‰ç»å†è¿‡çš„ç—›è‹¦ï¼Œä¸œå±±å†èµ·ä¹‹æ—¶ï¼Œä»–ç”šè‡³æ²¡æœ‰å¼€ä¸€æªå°±ä»å—ç«¯çš„å°å²›å›åˆ°äº†å·´é»ï¼Œå¼€å¯äº†ä»–ç™¾æ—¥çš„ç‹æœã€‚è¿™ä¸€åˆ‡ï¼Œåªå› ä¸ºä»–æ˜¯æ³•å…°è¥¿äººæ°‘çš„å›½ç‹ï¼Œæ˜¯æ³•å…°è¥¿äººå¿ƒç›®å½“ä¸­çš„ç¥ã€‚åªæ˜¯ï¼Œç™¾æ—¥ç‹æœï¼Œä»¥å…µè´¥æ»‘é“å¢ä¸ºç»ˆç»“ã€‚æ³•å›½äººä½ä¸‹å¤´ï¼Œçœ‹åˆ°çš„æ˜¯å¡çº³æ²³ä¸‹è‡ªç”±çš„æ²³æ°´ï¼Œåœ£èµ«å‹’æ‹¿å²›ä¸Šå‹æŠ‘çš„çµé­‚ã€‚ æ³•å›½çš„é©å‘½å¯ä»¥è¯´ä¸€ç›´æ²¡æœ‰åœæ­¢ã€‚äº”ä½å›½ç‹ç™»åŸºï¼Œåˆç©¿æ’ç€å…±å’Œå›½çš„å»ºç«‹ã€‚æ­¤æ¶ˆå½¼é•¿ï¼Œæ­¤èµ·å½¼ä¼ã€‚æ°‘ä¸»å…±å’Œçš„åŠ›é‡ä»æœªåœæ­¢å¢é•¿ï¼Œè€Œå¦ä¸€è¾¹ï¼Œä¼å›¾å¤è¾Ÿçš„å°å»ºåŠ›é‡å´ä¹Ÿæ˜¯ä»æœªæ¶ˆå¤±ã€‚åªæ˜¯ï¼Œæ³•å›½äººä¸åŒæ„ï¼Œä¸åŒæ„ä»–ä»¬çš„é©å‘½æˆæœå°±è¿™ä¹ˆè¢«è·µè¸ã€‚äºæ˜¯ï¼Œäº”æ¬¡å›ä¸»å¤è¾Ÿï¼Œæƒåˆ©è¶Šæ¥è¶Šå¾®ä¸è¶³é“ã€‚æ—¢ç„¶å¦‚æ­¤ï¼Œåˆä½•å¿…è¦å›½ç‹å‘¢ï¼Ÿäºæ˜¯ï¼Œä¸€åˆ‡åœ¨æ³•å…°è¥¿ç¬¬ä¸‰å…±å’Œå›½å»ºç«‹åå°˜åŸƒè½å®šã€‚æ—¶è‡³ä»Šæ—¥ï¼Œæ³•å…°è¥¿å…±å’Œå›½çš„å…‰è¾‰ä»æ—§é—ªè€€åœ¨å…­è¾¹å½¢é¢†åœŸçš„ä¸Šç©ºï¼Œè‡ªç”±å¹³ç­‰åšçˆ±çš„ä¿¡å¿µæ°¸è¿œæ²‰æ·€åœ¨æ³•å›½äººçš„å¿ƒåº•ã€‚ åœ¨æ—·ä¸–å¤§æˆ˜ä¸€æˆ˜å’ŒäºŒæˆ˜ä¸­ï¼Œæ³•å›½éƒ½æ˜¯æˆ˜èƒœå›½ã€‚ä½†ä¸€æˆ˜é‡Œåªæ˜¯å•çº¯çš„æ²¡æœ‰å¤ªå¤§çš„æŸå¤±ï¼Œåœ¨äºŒæˆ˜é‡Œç”šè‡³å¤±æ‰äº†ä¸€æµå›½å®¶çš„åœ°ä½ã€‚å¤§éƒ¨åˆ†æ³•å›½äººå¤§æ¦‚æ˜¯ä¸å¥½æˆ˜çš„ï¼Œä¸€æˆ˜å¦‚æœè¢«å¾·å›½è¿™ä¸€å®¿æ•Œå¨èƒåˆ°ï¼Œä¹Ÿè®¸æ³•å›½ä¹Ÿä¼šåªæ˜¯ä¸€ä¸ªä¸­ç«‹å›½ã€‚ä½†ï¼Œå®¿æ•Œå¾·å›½åœ¨ï¼Œæ³•å›½å°±æ— ä¸€å¤©å®‰å®ä¹‹æ—¥ã€‚äºŒæˆ˜ä¸­å¾·å›½ç”šè‡³å°†æ³•å›½å…¨çº¿æ”»ç ´ï¼Œç›´åˆ°è¯ºæ›¼åº•ç™»é™†ï¼Œæ³•å›½å…‰å¤ï¼Œä¸‰è‰²æ——æ‰é‡æ–°é£˜æ‰¬åœ¨è¥¿æ¬§çš„æµ·å²¸çº¿ä¸Šã€‚æ³•å›½å…‰å¤ä¹‹åå…±äº§å…šä¹Ÿå¼€å§‹è¿›å…¥æ”¿æ²»èˆå°ï¼Œå¦‚è‹¥ä¸æ˜¯å†·æˆ˜æœŸé—´å› ä¸ºé˜µè¥é—®é¢˜å¿…é¡»åšå‡ºé€‰æ‹©ï¼Œæ³•å›½å…±äº§å…šä¹Ÿè®¸ä¼šåœ¨æ³•å›½æ”¿å›å¤§æ”¾å¼‚å½©å§ï¼Œä»è¿™ä¸€ç‚¹çœ‹ï¼Œæ³•å…°è¥¿çš„è‡ªç”±ã€å¹³ç­‰ä¸åšçˆ±æ­¤æ—¶å·²æ·±å…¥äººå¿ƒã€‚ä½†å®é™…ä¸Šï¼Œå³ä½¿æœ‰å…±äº§å…šçš„å‚ä¸ï¼Œæ³•å…°è¥¿çš„è¿›ç¨‹ä¹Ÿå¯èƒ½ä¸ç°åœ¨å¹¶æ— å·®åˆ«ï¼Œå› ä¸ºï¼Œæ— è®ºå“ªä¸ªå…šæ´¾ï¼Œéƒ½æƒ³ä¸ºäº†è®©æ³•å›½å˜å¾—æ›´åŠ å¼ºç››ï¼Œè®©æ³•å›½äººæ°‘æ›´åŠ å¹¸ç¦å§ï¼ æ³•å…°è¥¿ï¼Œå› ä¸ºä»–çš„æ°‘æ—æ€§æ ¼è€Œä¸å…¶ä»–æ°‘æ—å†å²æˆªç„¶ä¸åŒã€‚å¥¹æ›¾ç››æä¸€æ—¶ï¼Œå´ä¸æ›¾ä¸»åŠ¨ä¾µç•¥ï¼›å¥¹æ›¾ç»å› ä¸ºå›½ç‹çš„æ— èƒ½è€Œç¾¸å¼±ä¸å ªï¼Œå´åˆä¸æƒ§æ€•å¤–æ•Œçš„å…¥ä¾µï¼›å¥¹æ›¾ä¸‹å®šå†³å¿ƒé©æ—§è¿æ–°ï¼Œä½†å´åˆåœ¨å›ä¸»ä¸å…±å’Œä¹‹é—´ä¸æ–­å¾˜å¾Šã€‚å¥¹æ²¡æœ‰ç»å¯¹çš„å€¾å‘ï¼Œåªæ˜¯æ€æ ·å¯¹è‡ªå·±çš„å›½æ°‘å¥½ï¼Œå°±æ€æ ·å»åšï¼Œæ‰€ä»¥å¥¹æ‘’å¼ƒäº†ç½—ä¼¯æ–¯åº‡å°”ä¸“åˆ¶çš„å…±å’Œï¼ŒæŠ•å‘äº†æ‹¿ç ´ä»‘å…ˆè¿›çš„å¸åˆ¶ï¼Œæ‰€ä»¥å¥¹æ‘’å¼ƒäº†æ³•å…°è¥¿ç¬¬å››å…±å’Œå›½æ— èƒ½çš„æ°‘ä¸»ï¼ŒæŠ•å‘äº†æˆ´é«˜ä¹ä¸€å®¶ç‹¬å¤§çš„æ–°æ”¿åºœã€‚ å¦‚ä»Šçš„å¥¹ï¼Œè™½ç„¶çœ‹ä¸Šå»åœ¨è¡°è½ï¼Œä½†æ˜¯ï¼Œåªè¦å¥¹çš„è‡ªç”±ã€å¹³ç­‰å’Œåšçˆ±è¿˜å­˜åœ¨äºæ³•å›½äººå¿ƒé‡Œï¼Œè¿˜å­˜äºä¸–äººè„‘ä¸­ï¼Œå¥¹å°±æ°¸è¿œä¸ä¼šè¡°è½ï¼Œå¥¹å°±æ— è®ºå¦‚ä½•éƒ½ä¸å¯èƒ½æ¶ˆå¤±ã€‚ å¥¹ï¼Œæ˜¯æ³•å›½äººçš„æ³•å…°è¥¿ï¼Œæ˜¯å…¨ä¸–ç•Œçš„æ€æƒ³æ——å¸œã€‚","categories":[{"name":"Dairy","slug":"Dairy","permalink":"https://blog.inoki.cc/categories/Dairy/"}],"tags":[{"name":"ä¸­æ–‡","slug":"ä¸­æ–‡","permalink":"https://blog.inoki.cc/tags/ä¸­æ–‡/"},{"name":"private","slug":"private","permalink":"https://blog.inoki.cc/tags/private/"}]}]}